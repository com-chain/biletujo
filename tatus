[1mdiff --git a/app/includes/balance.tpl b/app/includes/balance.tpl[m
[1mindex cbf4c18..2f4ab79 100644[m
[1m--- a/app/includes/balance.tpl[m
[1m+++ b/app/includes/balance.tpl[m
[36m@@ -683,6 +683,7 @@[m
               <div id="qrCR_print1"></div>[m
               <div id="qrCR_print2"></div>[m
               <div id="qrCR_print3"></div>[m
[32m+[m[32m              <div id="qrCR_print4"></div>[m
            [m
             <div class="row"> [m
               <div class="col-md-5 col-xs-5">[m
[36m@@ -863,10 +864,11 @@[m
                           </div>[m
                           <div> &nbsp;</div>[m
                           <div>[m
[31m-                                <button type="button" class="btn btn-primary" translate="QR_1" ng-click="qrRight(1)" >1 </button>[m
[31m-                                <button type="button" class="btn btn-primary" translate="QR_2" ng-click="qrRight(2)" >2 </button>[m
[31m-                                <button type="button" class="btn btn-primary" translate="QR_3" ng-click="qrRight(3)" >3 </button>[m
[31m-                                <button type="button" class="btn btn-primary" translate="QR_4" ng-click="qrRight(4)" >4 </button>[m
[32m+[m[32m                                <button type="button" class="btn btn-primary" translate="QR_1_5" ng-click="qrRight(1)" >1 </button>[m
[32m+[m[32m                                <button type="button" class="btn btn-primary" translate="QR_2_5" ng-click="qrRight(2)" >2 </button>[m
[32m+[m[32m                                <button type="button" class="btn btn-primary" translate="QR_3_5" ng-click="qrRight(3)" >3 </button>[m
[32m+[m[32m                                <button type="button" class="btn btn-primary" translate="QR_4_5" ng-click="qrRight(4)" >4 </button>[m
[32m+[m[32m                                <button type="button" class="btn btn-primary" translate="QR_5_5" ng-click="qrRight(5)" >5 </button>[m
                           </div> [m
                           <div> &nbsp;</div>[m
                           <div id="qrcode_consultRight" ></div><br/>[m
[1mdiff --git a/cordova_exchange_dist/README.md b/cordova_exchange_dist/README.md[m
[1mdeleted file mode 100755[m
[1mindex e522da4..0000000[m
[1m--- a/cordova_exchange_dist/README.md[m
[1m+++ /dev/null[m
[36m@@ -1,3 +0,0 @@[m
[31m-# README #[m
[31m-[m
[31m-Cordova project for Monnaie-Leman wallet[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/config.xml b/cordova_exchange_dist/config.xml[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 6396911..40192d4[m
[1m--- a/cordova_exchange_dist/config.xml[m
[1m+++ b/cordova_exchange_dist/config.xml[m
[36m@@ -1,11 +1,11 @@[m
 <?xml version='1.0' encoding='utf-8'?>[m
[31m-<widget id="org.monnaieleman.bureau" version="1.4.0" xmlns="http://www.w3.org/ns/widgets" xmlns:cdv="http://cordova.apache.org/ns/1.0">[m
[31m-    <name>Bureau Leman</name>[m
[32m+[m[32m<widget id="org.comchain.wallet" version="2.0.9" xmlns="http://www.w3.org/ns/widgets" xmlns:cdv="http://cordova.apache.org/ns/1.0">[m
[32m+[m[32m    <name>Biletujo</name>[m
     <description>[m
[31m-        An Apache Cordova wallet for Monnaie Leman[m
[32m+[m[32m        An Apache Cordova wallet for Com-Chain[m
     </description>[m
[31m-    <author email="info@monnaie-leman.org" href="http://monnaie-leman.org">[m
[31m-        Monnaie Leman[m
[32m+[m[32m    <author email="it@monnaie-leman.org" href="http://com-chain.org">[m
[32m+[m[32m        Biletujo[m
     </author>[m
     <content src="index.html" />[m
     <plugin name="cordova-plugin-whitelist" spec="1" />[m
[36m@@ -23,6 +23,21 @@[m
         <allow-intent href="itms:*" />[m
         <allow-intent href="itms-apps:*" />[m
     </platform>[m
[31m-    <icon src="lem.png" />[m
[31m-    <engine name="browser" spec="~5.0.4" />[m
[32m+[m[32m    <plugin name="phonegap-plugin-barcodescanner" spec="^8.0.1">[m
[32m+[m[32m        <variable name="ANDROID_SUPPORT_V4_VERSION" value="27.+" />[m
[32m+[m[32m    </plugin>[m
[32m+[m[32m    <plugin name="cordova-plugin-file" spec="^6.0.1" />[m
[32m+[m[32m    <plugin name="cordova-plugin-fingerprint-aio" spec="^1.6.0" />[m
[32m+[m[32m    <plugin name="cordova-plugin-inappbrowser" spec="^3.0.0" />[m
[32m+[m[32m    <plugin name="cordova-plugin-ionic-keyboard" spec="^2.1.3" />[m
[32m+[m[32m    <plugin name="cordova-plugin-urlhandler" spec="^0.7.2">[m
[32m+[m[32m        <variable name="URL_SCHEME" value="comchain" />[m
[32m+[m[32m    </plugin>[m
[32m+[m[32m    <plugin name="cordova-plugin-app-event" spec="^1.2.1" />[m
[32m+[m[32m    <plugin name="cordova-plugin-console" spec="^1.1.0" />[m
[32m+[m[32m    <plugin name="cordova-plugin-device" spec="^2.0.2" />[m
[32m+[m[32m    <plugin name="de.appplant.cordova.plugin.local-notification" spec="^0.8.5" />[m
[32m+[m[32m    <plugin name="cordova-plugin-compat" spec="^1.2.0" />[m
[32m+[m[32m    <engine name="android" spec="^7.1.4" />[m
[32m+[m[32m    <engine name="browser" spec="^5.0.4" />[m
 </widget>[m
[1mdiff --git a/cordova_exchange_dist/hooks/README.md b/cordova_exchange_dist/hooks/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/node_modules/cordova-browser/package.json b/cordova_exchange_dist/node_modules/cordova-browser/package.json[m
[1mindex 55e038e..f50847e 100644[m
[1m--- a/cordova_exchange_dist/node_modules/cordova-browser/package.json[m
[1m+++ b/cordova_exchange_dist/node_modules/cordova-browser/package.json[m
[36m@@ -10,7 +10,7 @@[m
         "spec": ">=5.0.1 <5.1.0",[m
         "type": "range"[m
       },[m
[31m-      "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_exchange_dist"[m
[32m+[m[32m      "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test"[m
     ][m
   ],[m
   "_from": "cordova-browser@>=5.0.1 <5.1.0",[m
[36m@@ -47,7 +47,7 @@[m
   "_shasum": "a89d1f37a89c66c83af6ad90e8d62e57dec0ce60",[m
   "_shrinkwrap": null,[m
   "_spec": "cordova-browser@~5.0.1",[m
[31m-  "_where": "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_exchange_dist",[m
[32m+[m[32m  "_where": "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test",[m
   "author": {[m
     "name": "Apache Software Foundation"[m
   },[m
[1mdiff --git a/cordova_exchange_dist/package.json b/cordova_exchange_dist/package.json[m
[1mindex 0a1ff9c..acd001a 100644[m
[1m--- a/cordova_exchange_dist/package.json[m
[1m+++ b/cordova_exchange_dist/package.json[m
[36m@@ -1,13 +1,52 @@[m
 {[m
[31m-  "name": "org.monnaieleman.bureau",[m
[31m-  "version": "1.4.0",[m
[31m-  "displayName": "Bureau Leman",[m
[32m+[m[32m  "name": "helloworld",[m
[32m+[m[32m  "displayName": "HelloCordova",[m
[32m+[m[32m  "version": "1.0.0",[m
[32m+[m[32m  "description": "A sample Apache Cordova application that responds to the deviceready event.",[m
[32m+[m[32m  "main": "index.js",[m
[32m+[m[32m  "scripts": {[m
[32m+[m[32m    "test": "echo \"Error: no test specified\" && exit 1"[m
[32m+[m[32m  },[m
[32m+[m[32m  "author": "Apache Cordova Team",[m
[32m+[m[32m  "license": "Apache-2.0",[m
[32m+[m[32m  "dependencies": {[m
[32m+[m[32m    "cordova-android": "^7.1.4",[m
[32m+[m[32m    "cordova-browser": "^5.0.4",[m
[32m+[m[32m    "cordova-plugin-app-event": "^1.2.1",[m
[32m+[m[32m    "cordova-plugin-compat": "^1.2.0",[m
[32m+[m[32m    "cordova-plugin-console": "^1.1.0",[m
[32m+[m[32m    "cordova-plugin-device": "^2.0.2",[m
[32m+[m[32m    "cordova-plugin-file": "^6.0.1",[m
[32m+[m[32m    "cordova-plugin-fingerprint-aio": "^1.6.0",[m
[32m+[m[32m    "cordova-plugin-inappbrowser": "^3.0.0",[m
[32m+[m[32m    "cordova-plugin-ionic-keyboard": "^2.1.3",[m
[32m+[m[32m    "cordova-plugin-urlhandler": "^0.7.2",[m
[32m+[m[32m    "cordova-plugin-whitelist": "^1.3.3",[m
[32m+[m[32m    "de.appplant.cordova.plugin.local-notification": "^0.8.5",[m
[32m+[m[32m    "phonegap-plugin-barcodescanner": "^8.0.1"[m
[32m+[m[32m  },[m
   "cordova": {[m
[32m+[m[32m    "plugins": {[m
[32m+[m[32m      "cordova-plugin-whitelist": {},[m
[32m+[m[32m      "phonegap-plugin-barcodescanner": {[m
[32m+[m[32m        "ANDROID_SUPPORT_V4_VERSION": "27.+"[m
[32m+[m[32m      },[m
[32m+[m[32m      "cordova-plugin-file": {},[m
[32m+[m[32m      "cordova-plugin-fingerprint-aio": {},[m
[32m+[m[32m      "cordova-plugin-inappbrowser": {},[m
[32m+[m[32m      "cordova-plugin-ionic-keyboard": {},[m
[32m+[m[32m      "cordova-plugin-urlhandler": {[m
[32m+[m[32m        "URL_SCHEME": "comchain"[m
[32m+[m[32m      },[m
[32m+[m[32m      "cordova-plugin-app-event": {},[m
[32m+[m[32m      "cordova-plugin-console": {},[m
[32m+[m[32m      "cordova-plugin-device": {},[m
[32m+[m[32m      "de.appplant.cordova.plugin.local-notification": {},[m
[32m+[m[32m      "cordova-plugin-compat": {}[m
[32m+[m[32m    },[m
     "platforms": [[m
[32m+[m[32m      "android",[m
       "browser"[m
     ][m
[31m-  },[m
[31m-  "dependencies": {[m
[31m-    "cordova-browser": "~5.0.4"[m
   }[m
 }[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/browser.json b/cordova_exchange_dist/platforms/browser/browser.json[m
[1mindex fb29d72..c45feba 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/browser.json[m
[1m+++ b/cordova_exchange_dist/platforms/browser/browser.json[m
[36m@@ -9,11 +9,11 @@[m
         "parents": {[m
           "/*": [[m
             {[m
[31m-              "xml": "<feature name=\"Device\"><param name=\"browser-package\" value=\"Device\" /></feature>",[m
[32m+[m[32m              "xml": "<feature name=\"BarcodeScanner\"><param name=\"browser-package\" value=\"BarcodeScanner\" /></feature>",[m
               "count": 1[m
             },[m
             {[m
[31m-              "xml": "<feature name=\"BarcodeScanner\"><param name=\"browser-package\" value=\"BarcodeScanner\" /></feature>",[m
[32m+[m[32m              "xml": "<feature name=\"Device\"><param name=\"browser-package\" value=\"Device\" /></feature>",[m
               "count": 1[m
             }[m
           ][m
[36m@@ -22,47 +22,46 @@[m
     }[m
   },[m
   "installed_plugins": {[m
[31m-    "cordova-plugin-compat": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m    "cordova-plugin-file": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
[31m-    "cordova-plugin-console": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m    "cordova-plugin-whitelist": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
[31m-    "cordova-plugin-device": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m    "phonegap-plugin-barcodescanner": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
[31m-    "cordova-plugin-file": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m    "cordova-plugin-fingerprint-aio": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
     "cordova-plugin-inappbrowser": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
     "cordova-plugin-ionic-keyboard": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
[31m-    "cordova-plugin-whitelist": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m    "cordova-plugin-urlhandler": {[m
[32m+[m[32m      "URL_SCHEME": "comchain",[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
[31m-    "phonegap-plugin-barcodescanner": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m    "cordova-plugin-app-event": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
[32m+[m[32m    },[m
[32m+[m[32m    "cordova-plugin-console": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
[32m+[m[32m    },[m
[32m+[m[32m    "cordova-plugin-device": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
[32m+[m[32m    },[m
[32m+[m[32m    "de.appplant.cordova.plugin.local-notification": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
[32m+[m[32m    },[m
[32m+[m[32m    "cordova-plugin-compat": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     }[m
   },[m
   "dependent_plugins": {},[m
   "modules": [[m
[31m-    {[m
[31m-      "file": "plugins/cordova-plugin-device/www/device.js",[m
[31m-      "id": "cordova-plugin-device.device",[m
[31m-      "pluginId": "cordova-plugin-device",[m
[31m-      "clobbers": [[m
[31m-        "device"[m
[31m-      ][m
[31m-    },[m
[31m-    {[m
[31m-      "file": "plugins/cordova-plugin-device/src/browser/DeviceProxy.js",[m
[31m-      "id": "cordova-plugin-device.DeviceProxy",[m
[31m-      "pluginId": "cordova-plugin-device",[m
[31m-      "runs": true[m
[31m-    },[m
     {[m
       "file": "plugins/cordova-plugin-file/www/DirectoryEntry.js",[m
       "id": "cordova-plugin-file.DirectoryEntry",[m
[36m@@ -242,6 +241,28 @@[m
         "window.FileSystem"[m
       ][m
     },[m
[32m+[m[32m    {[m
[32m+[m[32m      "file": "plugins/phonegap-plugin-barcodescanner/www/barcodescanner.js",[m
[32m+[m[32m      "id": "phonegap-plugin-barcodescanner.BarcodeScanner",[m
[32m+[m[32m      "pluginId": "phonegap-plugin-barcodescanner",[m
[32m+[m[32m      "clobbers": [[m
[32m+[m[32m        "cordova.plugins.barcodeScanner"[m
[32m+[m[32m      ][m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "file": "plugins/phonegap-plugin-barcodescanner/src/browser/BarcodeScannerProxy.js",[m
[32m+[m[32m      "id": "phonegap-plugin-barcodescanner.BarcodeScannerProxy",[m
[32m+[m[32m      "pluginId": "phonegap-plugin-barcodescanner",[m
[32m+[m[32m      "runs": true[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "file": "plugins/cordova-plugin-fingerprint-aio/www/Fingerprint.js",[m
[32m+[m[32m      "id": "cordova-plugin-fingerprint-aio.Fingerprint",[m
[32m+[m[32m      "pluginId": "cordova-plugin-fingerprint-aio",[m
[32m+[m[32m      "clobbers": [[m
[32m+[m[32m        "Fingerprint"[m
[32m+[m[32m      ][m
[32m+[m[32m    },[m
     {[m
       "file": "plugins/cordova-plugin-inappbrowser/www/inappbrowser.js",[m
       "id": "cordova-plugin-inappbrowser.inappbrowser",[m
[36m@@ -255,41 +276,62 @@[m
       "file": "plugins/cordova-plugin-inappbrowser/src/browser/InAppBrowserProxy.js",[m
       "id": "cordova-plugin-inappbrowser.InAppBrowserProxy",[m
       "pluginId": "cordova-plugin-inappbrowser",[m
[31m-      "merges": [[m
[31m-        ""[m
[32m+[m[32m      "runs": true[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "file": "plugins/cordova-plugin-device/www/device.js",[m
[32m+[m[32m      "id": "cordova-plugin-device.device",[m
[32m+[m[32m      "pluginId": "cordova-plugin-device",[m
[32m+[m[32m      "clobbers": [[m
[32m+[m[32m        "device"[m
       ][m
     },[m
     {[m
[31m-      "file": "plugins/cordova-plugin-ionic-keyboard/www/keyboard.js",[m
[31m-      "id": "cordova-plugin-ionic-keyboard.keyboard",[m
[31m-      "pluginId": "cordova-plugin-ionic-keyboard",[m
[32m+[m[32m      "file": "plugins/cordova-plugin-device/src/browser/DeviceProxy.js",[m
[32m+[m[32m      "id": "cordova-plugin-device.DeviceProxy",[m
[32m+[m[32m      "pluginId": "cordova-plugin-device",[m
[32m+[m[32m      "runs": true[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "file": "plugins/de.appplant.cordova.plugin.local-notification/www/local-notification.js",[m
[32m+[m[32m      "id": "de.appplant.cordova.plugin.local-notification.LocalNotification",[m
[32m+[m[32m      "pluginId": "de.appplant.cordova.plugin.local-notification",[m
       "clobbers": [[m
[31m-        "cordova.plugins.Keyboard"[m
[32m+[m[32m        "cordova.plugins.notification.local",[m
[32m+[m[32m        "plugin.notification.local"[m
       ][m
     },[m
     {[m
[31m-      "file": "plugins/phonegap-plugin-barcodescanner/www/barcodescanner.js",[m
[31m-      "id": "phonegap-plugin-barcodescanner.BarcodeScanner",[m
[31m-      "pluginId": "phonegap-plugin-barcodescanner",[m
[32m+[m[32m      "file": "plugins/de.appplant.cordova.plugin.local-notification/www/local-notification-core.js",[m
[32m+[m[32m      "id": "de.appplant.cordova.plugin.local-notification.LocalNotification.Core",[m
[32m+[m[32m      "pluginId": "de.appplant.cordova.plugin.local-notification",[m
       "clobbers": [[m
[31m-        "cordova.plugins.barcodeScanner"[m
[32m+[m[32m        "cordova.plugins.notification.local.core",[m
[32m+[m[32m        "plugin.notification.local.core"[m
       ][m
     },[m
     {[m
[31m-      "file": "plugins/phonegap-plugin-barcodescanner/src/browser/BarcodeScannerProxy.js",[m
[31m-      "id": "phonegap-plugin-barcodescanner.BarcodeScannerProxy",[m
[31m-      "pluginId": "phonegap-plugin-barcodescanner",[m
[31m-      "runs": true[m
[32m+[m[32m      "file": "plugins/de.appplant.cordova.plugin.local-notification/www/local-notification-util.js",[m
[32m+[m[32m      "id": "de.appplant.cordova.plugin.local-notification.LocalNotification.Util",[m
[32m+[m[32m      "pluginId": "de.appplant.cordova.plugin.local-notification",[m
[32m+[m[32m      "merges": [[m
[32m+[m[32m        "cordova.plugins.notification.local.core",[m
[32m+[m[32m        "plugin.notification.local.core"[m
[32m+[m[32m      ][m
     }[m
   ],[m
   "plugin_metadata": {[m
[31m-    "cordova-plugin-compat": "1.0.0",[m
[31m-    "cordova-plugin-console": "1.0.3",[m
[31m-    "cordova-plugin-device": "1.1.4",[m
[31m-    "cordova-plugin-file": "4.3.1",[m
[31m-    "cordova-plugin-inappbrowser": "1.6.1",[m
[31m-    "cordova-plugin-ionic-keyboard": "1.0.5",[m
[31m-    "cordova-plugin-whitelist": "1.2.2",[m
[31m-    "phonegap-plugin-barcodescanner": "5.0.1"[m
[32m+[m[32m    "cordova-plugin-file": "6.0.1",[m
[32m+[m[32m    "cordova-plugin-whitelist": "1.3.3",[m
[32m+[m[32m    "phonegap-plugin-barcodescanner": "8.0.1",[m
[32m+[m[32m    "cordova-plugin-fingerprint-aio": "1.6.0",[m
[32m+[m[32m    "cordova-plugin-inappbrowser": "3.0.0",[m
[32m+[m[32m    "cordova-plugin-ionic-keyboard": "2.1.3",[m
[32m+[m[32m    "cordova-plugin-urlhandler": "0.7.0",[m
[32m+[m[32m    "cordova-plugin-app-event": "1.2.1",[m
[32m+[m[32m    "cordova-plugin-console": "1.1.0",[m
[32m+[m[32m    "cordova-plugin-device": "2.0.2",[m
[32m+[m[32m    "de.appplant.cordova.plugin.local-notification": "0.8.5",[m
[32m+[m[32m    "cordova-plugin-compat": "1.2.0"[m
   }[m
 }[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/config.xml b/cordova_exchange_dist/platforms/browser/config.xml[m
[1mindex 9ff4238..979f2de 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/config.xml[m
[1m+++ b/cordova_exchange_dist/platforms/browser/config.xml[m
[36m@@ -1,11 +1,11 @@[m
 <?xml version='1.0' encoding='utf-8'?>[m
[31m-<widget id="org.monnaieleman.bureau" version="1.4.0" xmlns="http://www.w3.org/ns/widgets" xmlns:cdv="http://cordova.apache.org/ns/1.0">[m
[31m-    <name>Bureau Leman</name>[m
[32m+[m[32m<widget id="org.comchain.wallet" version="2.0.9" xmlns="http://www.w3.org/ns/widgets" xmlns:cdv="http://cordova.apache.org/ns/1.0">[m
[32m+[m[32m    <name>Biletujo</name>[m
     <description>[m
[31m-        An Apache Cordova wallet for Monnaie Leman[m
[32m+[m[32m        An Apache Cordova wallet for Com-Chain[m
     </description>[m
[31m-    <author email="info@monnaie-leman.org" href="http://monnaie-leman.org">[m
[31m-        Monnaie Leman[m
[32m+[m[32m    <author email="it@monnaie-leman.org" href="http://com-chain.org">[m
[32m+[m[32m        Biletujo[m
     </author>[m
     <content src="index.html" />[m
     <access origin="*" />[m
[36m@@ -15,5 +15,4 @@[m
     <allow-intent href="sms:*" />[m
     <allow-intent href="mailto:*" />[m
     <allow-intent href="geo:*" />[m
[31m-    <icon src="lem.png" />[m
 </widget>[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/cordova_plugins.js b/cordova_exchange_dist/platforms/browser/platform_www/cordova_plugins.js[m
[1mindex c455acc..f153a89 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/cordova_plugins.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/cordova_plugins.js[m
[36m@@ -1,19 +1,5 @@[m
 cordova.define('cordova/plugin_list', function(require, exports, module) {[m
 module.exports = [[m
[31m-    {[m
[31m-        "file": "plugins/cordova-plugin-device/www/device.js",[m
[31m-        "id": "cordova-plugin-device.device",[m
[31m-        "pluginId": "cordova-plugin-device",[m
[31m-        "clobbers": [[m
[31m-            "device"[m
[31m-        ][m
[31m-    },[m
[31m-    {[m
[31m-        "file": "plugins/cordova-plugin-device/src/browser/DeviceProxy.js",[m
[31m-        "id": "cordova-plugin-device.DeviceProxy",[m
[31m-        "pluginId": "cordova-plugin-device",[m
[31m-        "runs": true[m
[31m-    },[m
     {[m
         "file": "plugins/cordova-plugin-file/www/DirectoryEntry.js",[m
         "id": "cordova-plugin-file.DirectoryEntry",[m
[36m@@ -193,6 +179,28 @@[m [mmodule.exports = [[m
             "window.FileSystem"[m
         ][m
     },[m
[32m+[m[32m    {[m
[32m+[m[32m        "file": "plugins/phonegap-plugin-barcodescanner/www/barcodescanner.js",[m
[32m+[m[32m        "id": "phonegap-plugin-barcodescanner.BarcodeScanner",[m
[32m+[m[32m        "pluginId": "phonegap-plugin-barcodescanner",[m
[32m+[m[32m        "clobbers": [[m
[32m+[m[32m            "cordova.plugins.barcodeScanner"[m
[32m+[m[32m        ][m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m        "file": "plugins/phonegap-plugin-barcodescanner/src/browser/BarcodeScannerProxy.js",[m
[32m+[m[32m        "id": "phonegap-plugin-barcodescanner.BarcodeScannerProxy",[m
[32m+[m[32m        "pluginId": "phonegap-plugin-barcodescanner",[m
[32m+[m[32m        "runs": true[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m        "file": "plugins/cordova-plugin-fingerprint-aio/www/Fingerprint.js",[m
[32m+[m[32m        "id": "cordova-plugin-fingerprint-aio.Fingerprint",[m
[32m+[m[32m        "pluginId": "cordova-plugin-fingerprint-aio",[m
[32m+[m[32m        "clobbers": [[m
[32m+[m[32m            "Fingerprint"[m
[32m+[m[32m        ][m
[32m+[m[32m    },[m
     {[m
         "file": "plugins/cordova-plugin-inappbrowser/www/inappbrowser.js",[m
         "id": "cordova-plugin-inappbrowser.inappbrowser",[m
[36m@@ -206,44 +214,65 @@[m [mmodule.exports = [[m
         "file": "plugins/cordova-plugin-inappbrowser/src/browser/InAppBrowserProxy.js",[m
         "id": "cordova-plugin-inappbrowser.InAppBrowserProxy",[m
         "pluginId": "cordova-plugin-inappbrowser",[m
[31m-        "merges": [[m
[31m-            ""[m
[32m+[m[32m        "runs": true[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m        "file": "plugins/cordova-plugin-device/www/device.js",[m
[32m+[m[32m        "id": "cordova-plugin-device.device",[m
[32m+[m[32m        "pluginId": "cordova-plugin-device",[m
[32m+[m[32m        "clobbers": [[m
[32m+[m[32m            "device"[m
         ][m
     },[m
     {[m
[31m-        "file": "plugins/cordova-plugin-ionic-keyboard/www/keyboard.js",[m
[31m-        "id": "cordova-plugin-ionic-keyboard.keyboard",[m
[31m-        "pluginId": "cordova-plugin-ionic-keyboard",[m
[32m+[m[32m        "file": "plugins/cordova-plugin-device/src/browser/DeviceProxy.js",[m
[32m+[m[32m        "id": "cordova-plugin-device.DeviceProxy",[m
[32m+[m[32m        "pluginId": "cordova-plugin-device",[m
[32m+[m[32m        "runs": true[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m        "file": "plugins/de.appplant.cordova.plugin.local-notification/www/local-notification.js",[m
[32m+[m[32m        "id": "de.appplant.cordova.plugin.local-notification.LocalNotification",[m
[32m+[m[32m        "pluginId": "de.appplant.cordova.plugin.local-notification",[m
         "clobbers": [[m
[31m-            "cordova.plugins.Keyboard"[m
[32m+[m[32m            "cordova.plugins.notification.local",[m
[32m+[m[32m            "plugin.notification.local"[m
         ][m
     },[m
     {[m
[31m-        "file": "plugins/phonegap-plugin-barcodescanner/www/barcodescanner.js",[m
[31m-        "id": "phonegap-plugin-barcodescanner.BarcodeScanner",[m
[31m-        "pluginId": "phonegap-plugin-barcodescanner",[m
[32m+[m[32m        "file": "plugins/de.appplant.cordova.plugin.local-notification/www/local-notification-core.js",[m
[32m+[m[32m        "id": "de.appplant.cordova.plugin.local-notification.LocalNotification.Core",[m
[32m+[m[32m        "pluginId": "de.appplant.cordova.plugin.local-notification",[m
         "clobbers": [[m
[31m-            "cordova.plugins.barcodeScanner"[m
[32m+[m[32m            "cordova.plugins.notification.local.core",[m
[32m+[m[32m            "plugin.notification.local.core"[m
         ][m
     },[m
     {[m
[31m-        "file": "plugins/phonegap-plugin-barcodescanner/src/browser/BarcodeScannerProxy.js",[m
[31m-        "id": "phonegap-plugin-barcodescanner.BarcodeScannerProxy",[m
[31m-        "pluginId": "phonegap-plugin-barcodescanner",[m
[31m-        "runs": true[m
[32m+[m[32m        "file": "plugins/de.appplant.cordova.plugin.local-notification/www/local-notification-util.js",[m
[32m+[m[32m        "id": "de.appplant.cordova.plugin.local-notification.LocalNotification.Util",[m
[32m+[m[32m        "pluginId": "de.appplant.cordova.plugin.local-notification",[m
[32m+[m[32m        "merges": [[m
[32m+[m[32m            "cordova.plugins.notification.local.core",[m
[32m+[m[32m            "plugin.notification.local.core"[m
[32m+[m[32m        ][m
     }[m
 ];[m
 module.exports.metadata = [m
 // TOP OF METADATA[m
 {[m
[31m-    "cordova-plugin-compat": "1.0.0",[m
[31m-    "cordova-plugin-console": "1.0.3",[m
[31m-    "cordova-plugin-device": "1.1.4",[m
[31m-    "cordova-plugin-file": "4.3.1",[m
[31m-    "cordova-plugin-inappbrowser": "1.6.1",[m
[31m-    "cordova-plugin-ionic-keyboard": "1.0.5",[m
[31m-    "cordova-plugin-whitelist": "1.2.2",[m
[31m-    "phonegap-plugin-barcodescanner": "5.0.1"[m
[32m+[m[32m    "cordova-plugin-file": "6.0.1",[m
[32m+[m[32m    "cordova-plugin-whitelist": "1.3.3",[m
[32m+[m[32m    "phonegap-plugin-barcodescanner": "8.0.1",[m
[32m+[m[32m    "cordova-plugin-fingerprint-aio": "1.6.0",[m
[32m+[m[32m    "cordova-plugin-inappbrowser": "3.0.0",[m
[32m+[m[32m    "cordova-plugin-ionic-keyboard": "2.1.3",[m
[32m+[m[32m    "cordova-plugin-urlhandler": "0.7.0",[m
[32m+[m[32m    "cordova-plugin-app-event": "1.2.1",[m
[32m+[m[32m    "cordova-plugin-console": "1.1.0",[m
[32m+[m[32m    "cordova-plugin-device": "2.0.2",[m
[32m+[m[32m    "de.appplant.cordova.plugin.local-notification": "0.8.5",[m
[32m+[m[32m    "cordova-plugin-compat": "1.2.0"[m
 }[m
 // BOTTOM OF METADATA[m
 });[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/favicon.ico b/cordova_exchange_dist/platforms/browser/platform_www/favicon.ico[m
[1mdeleted file mode 100644[m
[1mindex fa7a758..0000000[m
Binary files a/cordova_exchange_dist/platforms/browser/platform_www/favicon.ico and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/manifest.json b/cordova_exchange_dist/platforms/browser/platform_www/manifest.json[m
[1mindex 583d39a..5be775c 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/manifest.json[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/manifest.json[m
[36m@@ -1,6 +1,6 @@[m
 {[m
[31m-  "name": "Bureau Leman",[m
[31m-  "short_name": "Bureau Leman",[m
[32m+[m[32m  "name": "HelloCordova",[m
[32m+[m[32m  "short_name": "HelloCordova",[m
   "description": "Description of your app from template",[m
   "start_url": "index.html",[m
   "scope": "index.html",[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-device/src/browser/DeviceProxy.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-device/src/browser/DeviceProxy.js[m
[1mindex f62801d..a4998fe 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-device/src/browser/DeviceProxy.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-device/src/browser/DeviceProxy.js[m
[36m@@ -20,24 +20,26 @@[m [mcordova.define("cordova-plugin-device.DeviceProxy", function(require, exports, m[m
  */[m
 var browser = require('cordova/platform');[m
 [m
[31m-function getPlatform() {[m
[31m-    return "browser";[m
[32m+[m[32mfunction getPlatform () {[m
[32m+[m[32m    return 'browser';[m
 }[m
 [m
[31m-function getModel() {[m
[32m+[m[32mfunction getModel () {[m
     return getBrowserInfo(true);[m
 }[m
 [m
[31m-function getVersion() {[m
[32m+[m[32mfunction getVersion () {[m
     return getBrowserInfo(false);[m
 }[m
 [m
[31m-function getBrowserInfo(getModel) {[m
[32m+[m[32mfunction getBrowserInfo (getModel) {[m
     var userAgent = navigator.userAgent;[m
     var returnVal = '';[m
     var offset;[m
 [m
[31m-    if ((offset = userAgent.indexOf('Chrome')) !== -1) {[m
[32m+[m[32m    if ((offset = userAgent.indexOf('Edge')) !== -1) {[m
[32m+[m[32m        returnVal = (getModel) ? 'Edge' : userAgent.substring(offset + 5);[m
[32m+[m[32m    } else if ((offset = userAgent.indexOf('Chrome')) !== -1) {[m
         returnVal = (getModel) ? 'Chrome' : userAgent.substring(offset + 7);[m
     } else if ((offset = userAgent.indexOf('Safari')) !== -1) {[m
         if (getModel) {[m
[36m@@ -64,7 +66,6 @@[m [mfunction getBrowserInfo(getModel) {[m
     return returnVal;[m
 }[m
 [m
[31m-[m
 module.exports = {[m
     getDeviceInfo: function (success, error) {[m
         setTimeout(function () {[m
[36m@@ -73,12 +74,13 @@[m [mmodule.exports = {[m
                 platform: getPlatform(),[m
                 model: getModel(),[m
                 version: getVersion(),[m
[31m-                uuid: null[m
[32m+[m[32m                uuid: null,[m
[32m+[m[32m                isVirtual: false[m
             });[m
         }, 0);[m
     }[m
 };[m
 [m
[31m-require("cordova/exec/proxy").add("Device", module.exports);[m
[32m+[m[32mrequire('cordova/exec/proxy').add('Device', module.exports);[m
 [m
 });[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-device/www/device.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-device/www/device.js[m
[1mindex ff0c5b4..059351d 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-device/www/device.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-device/www/device.js[m
[36m@@ -19,11 +19,11 @@[m [mcordova.define("cordova-plugin-device.device", function(require, exports, module[m
  *[m
 */[m
 [m
[31m-var argscheck = require('cordova/argscheck'),[m
[31m-    channel = require('cordova/channel'),[m
[31m-    utils = require('cordova/utils'),[m
[31m-    exec = require('cordova/exec'),[m
[31m-    cordova = require('cordova');[m
[32m+[m[32mvar argscheck = require('cordova/argscheck');[m
[32m+[m[32mvar channel = require('cordova/channel');[m
[32m+[m[32mvar utils = require('cordova/utils');[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar cordova = require('cordova');[m
 [m
 channel.createSticky('onCordovaInfoReady');[m
 // Tell cordova channel to wait on the CordovaInfoReady event[m
[36m@@ -34,7 +34,7 @@[m [mchannel.waitForInitialization('onCordovaInfoReady');[m
  * phone, etc.[m
  * @constructor[m
  */[m
[31m-function Device() {[m
[32m+[m[32mfunction Device () {[m
     this.available = false;[m
     this.platform = null;[m
     this.version = null;[m
[36m@@ -47,10 +47,10 @@[m [mfunction Device() {[m
 [m
     var me = this;[m
 [m
[31m-    channel.onCordovaReady.subscribe(function() {[m
[31m-        me.getInfo(function(info) {[m
[31m-            //ignoring info.cordova returning from native, we should use value from cordova.version defined in cordova.js[m
[31m-            //TODO: CB-5105 native implementations should not return info.cordova[m
[32m+[m[32m    channel.onCordovaReady.subscribe(function () {[m
[32m+[m[32m        me.getInfo(function (info) {[m
[32m+[m[32m            // ignoring info.cordova returning from native, we should use value from cordova.version defined in cordova.js[m
[32m+[m[32m            // TODO: CB-5105 native implementations should not return info.cordova[m
             var buildLabel = cordova.version;[m
             me.available = true;[m
             me.platform = info.platform;[m
[36m@@ -62,9 +62,9 @@[m [mfunction Device() {[m
             me.manufacturer = info.manufacturer || 'unknown';[m
             me.serial = info.serial || 'unknown';[m
             channel.onCordovaInfoReady.fire();[m
[31m-        },function(e) {[m
[32m+[m[32m        }, function (e) {[m
             me.available = false;[m
[31m-            utils.alert("[ERROR] Error initializing Cordova: " + e);[m
[32m+[m[32m            utils.alert('[ERROR] Error initializing Cordova: ' + e);[m
         });[m
     });[m
 }[m
[36m@@ -75,9 +75,9 @@[m [mfunction Device() {[m
  * @param {Function} successCallback The function to call when the heading data is available[m
  * @param {Function} errorCallback The function to call when there is an error getting the heading data. (OPTIONAL)[m
  */[m
[31m-Device.prototype.getInfo = function(successCallback, errorCallback) {[m
[32m+[m[32mDevice.prototype.getInfo = function (successCallback, errorCallback) {[m
     argscheck.checkArgs('fF', 'Device.getInfo', arguments);[m
[31m-    exec(successCallback, errorCallback, "Device", "getDeviceInfo", []);[m
[32m+[m[32m    exec(successCallback, errorCallback, 'Device', 'getDeviceInfo', []);[m
 };[m
 [m
 module.exports = new Device();[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/src/browser/FileProxy.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/src/browser/FileProxy.js[m
[1mindex ed3b61f..d7b0541 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/src/browser/FileProxy.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/src/browser/FileProxy.js[m
[36m@@ -18,10 +18,10 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
  * under the License.[m
  *[m
  */[m
[31m-(function() {[m
[31m-    /*global require, exports, module*/[m
[31m-    /*global FILESYSTEM_PREFIX*/[m
[31m-    /*global IDBKeyRange*/[m
[32m+[m[32m(function () {[m
[32m+[m[32m    /* global require, exports, module */[m
[32m+[m[32m    /* global FILESYSTEM_PREFIX */[m
[32m+[m[32m    /* global IDBKeyRange */[m
 [m
     /* Heavily based on https://github.com/ebidel/idb.filesystem.js */[m
 [m
[36m@@ -30,33 +30,33 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
     if (require('./isChrome')()) {[m
         var pathsPrefix = {[m
             // Read-only directory where the application is installed.[m
[31m-            applicationDirectory: location.origin + "/",[m
[32m+[m[32m            applicationDirectory: location.origin + '/', // eslint-disable-line no-undef[m
             // Where to put app-specific data files.[m
             dataDirectory: 'filesystem:file:///persistent/',[m
             // Cached files that should survive app restarts.[m
             // Apps should not rely on the OS to delete files in here.[m
[31m-            cacheDirectory: 'filesystem:file:///temporary/',[m
[32m+[m[32m            cacheDirectory: 'filesystem:file:///temporary/'[m
         };[m
 [m
[31m-        exports.requestAllPaths = function(successCallback) {[m
[32m+[m[32m        exports.requestAllPaths = function (successCallback) {[m
             successCallback(pathsPrefix);[m
         };[m
 [m
[31m-        require("cordova/exec/proxy").add("File", module.exports);[m
[32m+[m[32m        require('cordova/exec/proxy').add('File', module.exports);[m
         return;[m
     }[m
 [m
[31m-    var LocalFileSystem = require('./LocalFileSystem'),[m
[31m-        FileSystem = require('./FileSystem'),[m
[31m-        FileEntry = require('./FileEntry'),[m
[31m-        FileError = require('./FileError'),[m
[31m-        DirectoryEntry = require('./DirectoryEntry'),[m
[31m-        File = require('./File');[m
[32m+[m[32m    var LocalFileSystem = require('./LocalFileSystem');[m
[32m+[m[32m    var FileSystem = require('./FileSystem');[m
[32m+[m[32m    var FileEntry = require('./FileEntry');[m
[32m+[m[32m    var FileError = require('./FileError');[m
[32m+[m[32m    var DirectoryEntry = require('./DirectoryEntry');[m
[32m+[m[32m    var File = require('./File');[m
 [m
[31m-    (function(exports, global) {[m
[32m+[m[32m    (function (exports, global) {[m
         var indexedDB = global.indexedDB || global.mozIndexedDB;[m
         if (!indexedDB) {[m
[31m-            throw "Firefox OS File plugin: indexedDB not supported";[m
[32m+[m[32m            throw 'Firefox OS File plugin: indexedDB not supported';[m
         }[m
 [m
         var fs_ = null;[m
[36m@@ -69,23 +69,23 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
 [m
         var pathsPrefix = {[m
             // Read-only directory where the application is installed.[m
[31m-            applicationDirectory: location.origin + "/",[m
[32m+[m[32m            applicationDirectory: location.origin + '/', // eslint-disable-line no-undef[m
             // Where to put app-specific data files.[m
             dataDirectory: 'file:///persistent/',[m
             // Cached files that should survive app restarts.[m
             // Apps should not rely on the OS to delete files in here.[m
[31m-            cacheDirectory: 'file:///temporary/',[m
[32m+[m[32m            cacheDirectory: 'file:///temporary/'[m
         };[m
 [m
         var unicodeLastChar = 65535;[m
 [m
[31m-    /*** Exported functionality ***/[m
[32m+[m[32m    /** * Exported functionality ***/[m
 [m
[31m-        exports.requestFileSystem = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.requestFileSystem = function (successCallback, errorCallback, args) {[m
             var type = args[0];[m
             // Size is ignored since IDB filesystem size depends[m
             // on browser implementation and can't be set up by user[m
[31m-            var size = args[1]; // jshint ignore: line[m
[32m+[m[32m            var size = args[1]; // eslint-disable-line no-unused-vars[m
 [m
             if (type !== LocalFileSystem.TEMPORARY && type !== LocalFileSystem.PERSISTENT) {[m
                 if (errorCallback) {[m
[36m@@ -95,23 +95,23 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             }[m
 [m
             var name = type === LocalFileSystem.TEMPORARY ? 'temporary' : 'persistent';[m
[31m-            var storageName = (location.protocol + location.host).replace(/:/g, '_');[m
[32m+[m[32m            var storageName = (location.protocol + location.host).replace(/:/g, '_'); // eslint-disable-line no-undef[m
 [m
             var root = new DirectoryEntry('', DIR_SEPARATOR);[m
             fs_ = new FileSystem(name, root);[m
 [m
[31m-            idb_.open(storageName, function() {[m
[32m+[m[32m            idb_.open(storageName, function () {[m
                 successCallback(fs_);[m
             }, errorCallback);[m
         };[m
 [m
         // Overridden by Android, BlackBerry 10 and iOS to populate fsMap[m
[31m-        require('./fileSystems').getFs = function(name, callback) {[m
[32m+[m[32m        require('./fileSystems').getFs = function (name, callback) {[m
             callback(new FileSystem(name, fs_.root));[m
         };[m
 [m
         // list a directory's contents (files and folders).[m
[31m-        exports.readEntries = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.readEntries = function (successCallback, errorCallback, args) {[m
             var fullPath = args[0];[m
 [m
             if (typeof successCallback !== 'function') {[m
[36m@@ -120,18 +120,18 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
 [m
             var path = resolveToFullPath_(fullPath);[m
 [m
[31m-            exports.getDirectory(function() {[m
[31m-                idb_.getAllEntries(path.fullPath + DIR_SEPARATOR, path.storagePath, function(entries) {[m
[32m+[m[32m            exports.getDirectory(function () {[m
[32m+[m[32m                idb_.getAllEntries(path.fullPath + DIR_SEPARATOR, path.storagePath, function (entries) {[m
                     successCallback(entries);[m
                 }, errorCallback);[m
[31m-            }, function() {[m
[32m+[m[32m            }, function () {[m
                 if (errorCallback) {[m
                     errorCallback(FileError.NOT_FOUND_ERR);[m
                 }[m
             }, [path.storagePath, path.fullPath, {create: false}]);[m
         };[m
 [m
[31m-        exports.getFile = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.getFile = function (successCallback, errorCallback, args) {[m
             var fullPath = args[0];[m
             var path = args[1];[m
             var options = args[2] || {};[m
[36m@@ -139,7 +139,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             // Create an absolute path if we were handed a relative one.[m
             path = resolveToFullPath_(fullPath, path);[m
 [m
[31m-            idb_.get(path.storagePath, function(fileEntry) {[m
[32m+[m[32m            idb_.get(path.storagePath, function (fileEntry) {[m
                 if (options.create === true && options.exclusive === true && fileEntry) {[m
                     // If create and exclusive are both true, and the path already exists,[m
                     // getFile must fail.[m
[36m@@ -164,7 +164,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
                 } else if (options.create === true && fileEntry) {[m
                     if (fileEntry.isFile) {[m
                         // Overwrite file, delete then create new.[m
[31m-                        idb_['delete'](path.storagePath, function() {[m
[32m+[m[32m                        idb_['delete'](path.storagePath, function () {[m
                             var newFileEntry = new FileEntry(path.fileName, path.fullPath, new FileSystem(path.fsName, fs_.root));[m
 [m
                             newFileEntry.file_ = new MyFile({[m
[36m@@ -202,16 +202,16 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             }, errorCallback);[m
         };[m
 [m
[31m-        exports.getFileMetadata = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.getFileMetadata = function (successCallback, errorCallback, args) {[m
             var fullPath = args[0];[m
 [m
[31m-            exports.getFile(function(fileEntry) {[m
[32m+[m[32m            exports.getFile(function (fileEntry) {[m
                 successCallback(new File(fileEntry.file_.name, fileEntry.fullPath, '', fileEntry.file_.lastModifiedDate,[m
                     fileEntry.file_.size));[m
             }, errorCallback, [fullPath, null]);[m
         };[m
 [m
[31m-        exports.getMetadata = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.getMetadata = function (successCallback, errorCallback, args) {[m
             exports.getFile(function (fileEntry) {[m
                 successCallback([m
                     {[m
[36m@@ -221,21 +221,21 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             }, errorCallback, args);[m
         };[m
 [m
[31m-        exports.setMetadata = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.setMetadata = function (successCallback, errorCallback, args) {[m
             var fullPath = args[0];[m
             var metadataObject = args[1];[m
 [m
             exports.getFile(function (fileEntry) {[m
[31m-                  fileEntry.file_.lastModifiedDate = metadataObject.modificationTime;[m
[31m-                  idb_.put(fileEntry, fileEntry.file_.storagePath, successCallback, errorCallback);[m
[32m+[m[32m                fileEntry.file_.lastModifiedDate = metadataObject.modificationTime;[m
[32m+[m[32m                idb_.put(fileEntry, fileEntry.file_.storagePath, successCallback, errorCallback);[m
             }, errorCallback, [fullPath, null]);[m
         };[m
 [m
[31m-        exports.write = function(successCallback, errorCallback, args) {[m
[31m-            var fileName = args[0],[m
[31m-                data = args[1],[m
[31m-                position = args[2],[m
[31m-                isBinary = args[3]; // jshint ignore: line[m
[32m+[m[32m        exports.write = function (successCallback, errorCallback, args) {[m
[32m+[m[32m            var fileName = args[0];[m
[32m+[m[32m            var data = args[1];[m
[32m+[m[32m            var position = args[2];[m
[32m+[m[32m            var isBinary = args[3]; // eslint-disable-line no-unused-vars[m
 [m
             if (!data) {[m
                 if (errorCallback) {[m
[36m@@ -245,14 +245,14 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             }[m
 [m
             if (typeof data === 'string' || data instanceof String) {[m
[31m-                data = new Blob([data]);[m
[32m+[m[32m                data = new Blob([data]); // eslint-disable-line no-undef[m
             }[m
 [m
[31m-            exports.getFile(function(fileEntry) {[m
[32m+[m[32m            exports.getFile(function (fileEntry) {[m
                 var blob_ = fileEntry.file_.blob_;[m
 [m
                 if (!blob_) {[m
[31m-                    blob_ = new Blob([data], {type: data.type});[m
[32m+[m[32m                    blob_ = new Blob([data], {type: data.type}); // eslint-disable-line no-undef[m
                 } else {[m
                     // Calc the head and tail fragments[m
                     var head = blob_.slice(0, position);[m
[36m@@ -265,7 +265,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
                     }[m
 [m
                     // Do the "write". In fact, a full overwrite of the Blob.[m
[31m-                    blob_ = new Blob([head, new Uint8Array(padding), data, tail],[m
[32m+[m[32m                    blob_ = new Blob([head, new Uint8Array(padding), data, tail], // eslint-disable-line no-undef[m
                         {type: data.type});[m
                 }[m
 [m
[36m@@ -276,46 +276,46 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
                 fileEntry.file_.name = blob_.name;[m
                 fileEntry.file_.type = blob_.type;[m
 [m
[31m-                idb_.put(fileEntry, fileEntry.file_.storagePath, function() {[m
[32m+[m[32m                idb_.put(fileEntry, fileEntry.file_.storagePath, function () {[m
                     successCallback(data.size || data.byteLength);[m
                 }, errorCallback);[m
             }, errorCallback, [fileName, null]);[m
         };[m
 [m
[31m-        exports.readAsText = function(successCallback, errorCallback, args) {[m
[31m-            var fileName = args[0],[m
[31m-                enc = args[1],[m
[31m-                startPos = args[2],[m
[31m-                endPos = args[3];[m
[32m+[m[32m        exports.readAsText = function (successCallback, errorCallback, args) {[m
[32m+[m[32m            var fileName = args[0];[m
[32m+[m[32m            var enc = args[1];[m
[32m+[m[32m            var startPos = args[2];[m
[32m+[m[32m            var endPos = args[3];[m
 [m
             readAs('text', fileName, enc, startPos, endPos, successCallback, errorCallback);[m
         };[m
 [m
[31m-        exports.readAsDataURL = function(successCallback, errorCallback, args) {[m
[31m-            var fileName = args[0],[m
[31m-                startPos = args[1],[m
[31m-                endPos = args[2];[m
[32m+[m[32m        exports.readAsDataURL = function (successCallback, errorCallback, args) {[m
[32m+[m[32m            var fileName = args[0];[m
[32m+[m[32m            var startPos = args[1];[m
[32m+[m[32m            var endPos = args[2];[m
 [m
             readAs('dataURL', fileName, null, startPos, endPos, successCallback, errorCallback);[m
         };[m
 [m
[31m-        exports.readAsBinaryString = function(successCallback, errorCallback, args) {[m
[31m-            var fileName = args[0],[m
[31m-                startPos = args[1],[m
[31m-                endPos = args[2];[m
[32m+[m[32m        exports.readAsBinaryString = function (successCallback, errorCallback, args) {[m
[32m+[m[32m            var fileName = args[0];[m
[32m+[m[32m            var startPos = args[1];[m
[32m+[m[32m            var endPos = args[2];[m
 [m
             readAs('binaryString', fileName, null, startPos, endPos, successCallback, errorCallback);[m
         };[m
 [m
[31m-        exports.readAsArrayBuffer = function(successCallback, errorCallback, args) {[m
[31m-            var fileName = args[0],[m
[31m-                startPos = args[1],[m
[31m-                endPos = args[2];[m
[32m+[m[32m        exports.readAsArrayBuffer = function (successCallback, errorCallback, args) {[m
[32m+[m[32m            var fileName = args[0];[m
[32m+[m[32m            var startPos = args[1];[m
[32m+[m[32m            var endPos = args[2];[m
 [m
             readAs('arrayBuffer', fileName, null, startPos, endPos, successCallback, errorCallback);[m
         };[m
 [m
[31m-        exports.removeRecursively = exports.remove = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.removeRecursively = exports.remove = function (successCallback, errorCallback, args) {[m
             if (typeof successCallback !== 'function') {[m
                 throw Error('Expected successCallback argument.');[m
             }[m
[36m@@ -326,26 +326,26 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
                 return;[m
             }[m
 [m
[31m-            function deleteEntry(isDirectory) {[m
[32m+[m[32m            function deleteEntry (isDirectory) {[m
                 // TODO: This doesn't protect against directories that have content in it.[m
                 // Should throw an error instead if the dirEntry is not empty.[m
[31m-                idb_['delete'](fullPath, function() {[m
[32m+[m[32m                idb_['delete'](fullPath, function () {[m
                     successCallback();[m
[31m-                }, function() {[m
[31m-                        if (errorCallback) { errorCallback(); }[m
[32m+[m[32m                }, function () {[m
[32m+[m[32m                    if (errorCallback) { errorCallback(); }[m
                 }, isDirectory);[m
             }[m
 [m
             // We need to to understand what we are deleting:[m
[31m-            exports.getDirectory(function(entry) {[m
[32m+[m[32m            exports.getDirectory(function (entry) {[m
                 deleteEntry(entry.isDirectory);[m
[31m-            }, function(){[m
[31m-                //DirectoryEntry was already deleted or entry is FileEntry[m
[32m+[m[32m            }, function () {[m
[32m+[m[32m                // DirectoryEntry was already deleted or entry is FileEntry[m
                 deleteEntry(false);[m
             }, [fullPath, null, {create: false}]);[m
         };[m
 [m
[31m-        exports.getDirectory = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.getDirectory = function (successCallback, errorCallback, args) {[m
             var fullPath = args[0];[m
             var path = args[1];[m
             var options = args[2];[m
[36m@@ -353,7 +353,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             // Create an absolute path if we were handed a relative one.[m
             path = resolveToFullPath_(fullPath, path);[m
 [m
[31m-            idb_.get(path.storagePath, function(folderEntry) {[m
[32m+[m[32m            idb_.get(path.storagePath, function (folderEntry) {[m
                 if (!options) {[m
                     options = {};[m
                 }[m
[36m@@ -423,15 +423,15 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             }, errorCallback);[m
         };[m
 [m
[31m-        exports.getParent = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.getParent = function (successCallback, errorCallback, args) {[m
             if (typeof successCallback !== 'function') {[m
                 throw Error('Expected successCallback argument.');[m
             }[m
 [m
             var fullPath = args[0];[m
[31m-            //fullPath is like this:[m
[31m-            //file:///persistent/path/to/file or[m
[31m-            //file:///persistent/path/to/directory/[m
[32m+[m[32m            // fullPath is like this:[m
[32m+[m[32m            // file:///persistent/path/to/file or[m
[32m+[m[32m            // file:///persistent/path/to/directory/[m
 [m
             if (fullPath === DIR_SEPARATOR || fullPath === pathsPrefix.cacheDirectory ||[m
                 fullPath === pathsPrefix.dataDirectory) {[m
[36m@@ -439,7 +439,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
                 return;[m
             }[m
 [m
[31m-            //To delete all slashes at the end[m
[32m+[m[32m            // To delete all slashes at the end[m
             while (fullPath[fullPath.length - 1] === '/') {[m
                 fullPath = fullPath.substr(0, fullPath.length - 1);[m
             }[m
[36m@@ -449,8 +449,8 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             var parentName = pathArr.pop();[m
             var path = pathArr.join(DIR_SEPARATOR) + DIR_SEPARATOR;[m
 [m
[31m-            //To get parent of root files[m
[31m-            var joined = path + parentName + DIR_SEPARATOR;//is like this: file:///persistent/[m
[32m+[m[32m            // To get parent of root files[m
[32m+[m[32m            var joined = path + parentName + DIR_SEPARATOR;// is like this: file:///persistent/[m
             if (joined === pathsPrefix.cacheDirectory || joined === pathsPrefix.dataDirectory) {[m
                 exports.getDirectory(successCallback, errorCallback, [joined, DIR_SEPARATOR, {create: false}]);[m
                 return;[m
[36m@@ -459,7 +459,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             exports.getDirectory(successCallback, errorCallback, [path, parentName, {create: false}]);[m
         };[m
 [m
[31m-        exports.copyTo = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.copyTo = function (successCallback, errorCallback, args) {[m
             var srcPath = args[0];[m
             var parentFullPath = args[1];[m
             var name = args[2];[m
[36m@@ -473,33 +473,33 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             }[m
 [m
             // Read src file[m
[31m-            exports.getFile(function(srcFileEntry) {[m
[32m+[m[32m            exports.getFile(function (srcFileEntry) {[m
 [m
                 var path = resolveToFullPath_(parentFullPath);[m
[31m-                //Check directory[m
[31m-                exports.getDirectory(function() {[m
[32m+[m[32m                // Check directory[m
[32m+[m[32m                exports.getDirectory(function () {[m
 [m
                     // Create dest file[m
[31m-                    exports.getFile(function(dstFileEntry) {[m
[32m+[m[32m                    exports.getFile(function (dstFileEntry) {[m
 [m
[31m-                        exports.write(function() {[m
[32m+[m[32m                        exports.write(function () {[m
                             successCallback(dstFileEntry);[m
                         }, errorCallback, [dstFileEntry.file_.storagePath, srcFileEntry.file_.blob_, 0]);[m
 [m
                     }, errorCallback, [parentFullPath, name, {create: true}]);[m
 [m
[31m-                }, function() { if (errorCallback) { errorCallback(FileError.NOT_FOUND_ERR); }},[m
[31m-                [path.storagePath, null, {create:false}]);[m
[32m+[m[32m                }, function () { if (errorCallback) { errorCallback(FileError.NOT_FOUND_ERR); } },[m
[32m+[m[32m                [path.storagePath, null, {create: false}]);[m
 [m
             }, errorCallback, [srcPath, null]);[m
         };[m
 [m
[31m-        exports.moveTo = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.moveTo = function (successCallback, errorCallback, args) {[m
             var srcPath = args[0];[m
             // parentFullPath and name parameters is ignored because[m
             // args is being passed downstream to exports.copyTo method[m
[31m-            var parentFullPath = args[1]; // jshint ignore: line[m
[31m-            var name = args[2]; // jshint ignore: line[m
[32m+[m[32m            var parentFullPath = args[1]; // eslint-disable-line[m
[32m+[m[32m            var name = args[2]; // eslint-disable-line[m
 [m
             exports.copyTo(function (fileEntry) {[m
 [m
[36m@@ -510,16 +510,16 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             }, errorCallback, args);[m
         };[m
 [m
[31m-        exports.resolveLocalFileSystemURI = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.resolveLocalFileSystemURI = function (successCallback, errorCallback, args) {[m
             var path = args[0];[m
 [m
             // Ignore parameters[m
             if (path.indexOf('?') !== -1) {[m
[31m-                path = String(path).split("?")[0];[m
[32m+[m[32m                path = String(path).split('?')[0];[m
             }[m
 [m
             // support for encodeURI[m
[31m-            if (/\%5/g.test(path) || /\%20/g.test(path)) {[m
[32m+[m[32m            if (/\%5/g.test(path) || /\%20/g.test(path)) {  // eslint-disable-line no-useless-escape[m
                 path = decodeURI(path);[m
             }[m
 [m
[36m@@ -530,23 +530,23 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
                 return;[m
             }[m
 [m
[31m-            //support for cdvfile[m
[31m-            if (path.trim().substr(0,7) === "cdvfile") {[m
[31m-                if (path.indexOf("cdvfile://localhost") === -1) {[m
[32m+[m[32m            // support for cdvfile[m
[32m+[m[32m            if (path.trim().substr(0, 7) === 'cdvfile') {[m
[32m+[m[32m                if (path.indexOf('cdvfile://localhost') === -1) {[m
                     if (errorCallback) {[m
                         errorCallback(FileError.ENCODING_ERR);[m
                     }[m
                     return;[m
                 }[m
 [m
[31m-                var indexPersistent = path.indexOf("persistent");[m
[31m-                var indexTemporary = path.indexOf("temporary");[m
[32m+[m[32m                var indexPersistent = path.indexOf('persistent');[m
[32m+[m[32m                var indexTemporary = path.indexOf('temporary');[m
 [m
[31m-                //cdvfile://localhost/persistent/path/to/file[m
[32m+[m[32m                // cdvfile://localhost/persistent/path/to/file[m
                 if (indexPersistent !== -1) {[m
[31m-                    path =  "file:///persistent" + path.substr(indexPersistent + 10);[m
[32m+[m[32m                    path = 'file:///persistent' + path.substr(indexPersistent + 10);[m
                 } else if (indexTemporary !== -1) {[m
[31m-                    path = "file:///temporary" + path.substr(indexTemporary + 9);[m
[32m+[m[32m                    path = 'file:///temporary' + path.substr(indexTemporary + 9);[m
                 } else {[m
                     if (errorCallback) {[m
                         errorCallback(FileError.ENCODING_ERR);[m
[36m@@ -556,8 +556,8 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             }[m
 [m
             // to avoid path form of '///path/to/file'[m
[31m-            function handlePathSlashes(path) {[m
[31m-                var cutIndex  = 0;[m
[32m+[m[32m            function handlePathSlashes (path) {[m
[32m+[m[32m                var cutIndex = 0;[m
                 for (var i = 0; i < path.length - 1; i++) {[m
                     if (path[i] === DIR_SEPARATOR && path[i + 1] === DIR_SEPARATOR) {[m
                         cutIndex = i + 1;[m
[36m@@ -576,8 +576,8 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
                 path = path.substring(pathsPrefix.dataDirectory.length - 1);[m
                 path = handlePathSlashes(path);[m
 [m
[31m-                exports.requestFileSystem(function() {[m
[31m-                    exports.getFile(successCallback, function() {[m
[32m+[m[32m                exports.requestFileSystem(function () {[m
[32m+[m[32m                    exports.getFile(successCallback, function () {[m
                         exports.getDirectory(successCallback, errorCallback, [pathsPrefix.dataDirectory, path,[m
                         {create: false}]);[m
                     }, [pathsPrefix.dataDirectory, path, {create: false}]);[m
[36m@@ -586,47 +586,47 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
                 path = path.substring(pathsPrefix.cacheDirectory.length - 1);[m
                 path = handlePathSlashes(path);[m
 [m
[31m-                exports.requestFileSystem(function() {[m
[31m-                    exports.getFile(successCallback, function() {[m
[32m+[m[32m                exports.requestFileSystem(function () {[m
[32m+[m[32m                    exports.getFile(successCallback, function () {[m
                         exports.getDirectory(successCallback, errorCallback, [pathsPrefix.cacheDirectory, path,[m
                         {create: false}]);[m
                     }, [pathsPrefix.cacheDirectory, path, {create: false}]);[m
                 }, errorCallback, [LocalFileSystem.TEMPORARY]);[m
             } else if (path.indexOf(pathsPrefix.applicationDirectory) === 0) {[m
                 path = path.substring(pathsPrefix.applicationDirectory.length);[m
[31m-                //TODO: need to cut out redundant slashes?[m
[32m+[m[32m                // TODO: need to cut out redundant slashes?[m
 [m
[31m-                var xhr = new XMLHttpRequest();[m
[31m-                xhr.open("GET", path, true);[m
[32m+[m[32m                var xhr = new XMLHttpRequest(); // eslint-disable-line no-undef[m
[32m+[m[32m                xhr.open('GET', path, true);[m
                 xhr.onreadystatechange = function () {[m
                     if (xhr.status === 200 && xhr.readyState === 4) {[m
[31m-                        exports.requestFileSystem(function(fs) {[m
[31m-                            fs.name = location.hostname;[m
[32m+[m[32m                        exports.requestFileSystem(function (fs) {[m
[32m+[m[32m                            fs.name = location.hostname; // eslint-disable-line no-undef[m
 [m
[31m-                            //TODO: need to call exports.getFile(...) to handle errors correct[m
[32m+[m[32m                            // TODO: need to call exports.getFile(...) to handle errors correct[m
                             fs.root.getFile(path, {create: true}, writeFile, errorCallback);[m
                         }, errorCallback, [LocalFileSystem.PERSISTENT]);[m
                     }[m
                 };[m
 [m
                 xhr.onerror = function () {[m
[31m-                    if(errorCallback) {[m
[32m+[m[32m                    if (errorCallback) {[m
                         errorCallback(FileError.NOT_READABLE_ERR);[m
                     }[m
                 };[m
 [m
                 xhr.send();[m
             } else {[m
[31m-                if(errorCallback) {[m
[32m+[m[32m                if (errorCallback) {[m
                     errorCallback(FileError.NOT_FOUND_ERR);[m
                 }[m
             }[m
 [m
[31m-            function writeFile(entry) {[m
[32m+[m[32m            function writeFile (entry) {[m
                 entry.createWriter(function (fileWriter) {[m
                     fileWriter.onwriteend = function (evt) {[m
                         if (!evt.target.error) {[m
[31m-                            entry.filesystemName = location.hostname;[m
[32m+[m[32m                            entry.filesystemName = location.hostname; // eslint-disable-line no-undef[m
                             successCallback(entry);[m
                         }[m
                     };[m
[36m@@ -635,16 +635,16 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
                             errorCallback(FileError.NOT_READABLE_ERR);[m
                         }[m
                     };[m
[31m-                    fileWriter.write(new Blob([xhr.response]));[m
[31m-                }, errorCallback);[m
[32m+[m[32m                    fileWriter.write(new Blob([xhr.response])); // eslint-disable-line no-undef[m
[32m+[m[32m                }, errorCallback); // eslint-disable-line no-undef[m
             }[m
         };[m
 [m
[31m-        exports.requestAllPaths = function(successCallback) {[m
[32m+[m[32m        exports.requestAllPaths = function (successCallback) {[m
             successCallback(pathsPrefix);[m
         };[m
 [m
[31m-    /*** Helpers ***/[m
[32m+[m[32m    /** * Helpers ***/[m
 [m
         /**[m
          * Interface to wrap the native File interface.[m
[36m@@ -657,8 +657,8 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
          * @param {Object} opts Initial values.[m
          * @constructor[m
          */[m
[31m-        function MyFile(opts) {[m
[31m-            var blob_ = new Blob();[m
[32m+[m[32m        function MyFile (opts) {[m
[32m+[m[32m            var blob_ = new Blob(); // eslint-disable-line no-undef[m
 [m
             this.size = opts.size || 0;[m
             this.name = opts.name || '';[m
[36m@@ -670,10 +670,10 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             // blob that is saved.[m
             Object.defineProperty(this, 'blob_', {[m
                 enumerable: true,[m
[31m-                get: function() {[m
[32m+[m[32m                get: function () {[m
                     return blob_;[m
                 },[m
[31m-                set: function(val) {[m
[32m+[m[32m                set: function (val) {[m
                     blob_ = val;[m
                     this.size = blob_.size;[m
                     this.name = blob_.name;[m
[36m@@ -688,7 +688,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
         // When saving an entry, the fullPath should always lead with a slash and never[m
         // end with one (e.g. a directory). Also, resolve '.' and '..' to an absolute[m
         // one. This method ensures path is legit![m
[31m-        function resolveToFullPath_(cwdFullPath, path) {[m
[32m+[m[32m        function resolveToFullPath_ (cwdFullPath, path) {[m
             path = path || '';[m
             var fullPath = path;[m
             var prefix = '';[m
[36m@@ -722,7 +722,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
                     parts[i] = '';[m
                 }[m
             }[m
[31m-            fullPath = parts.filter(function(el) {[m
[32m+[m[32m            fullPath = parts.filter(function (el) {[m
                 return el;[m
             }).join(DIR_SEPARATOR);[m
 [m
[36m@@ -758,7 +758,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             };[m
         }[m
 [m
[31m-        function fileEntryFromIdbEntry(fileEntry) {[m
[32m+[m[32m        function fileEntryFromIdbEntry (fileEntry) {[m
             // IDB won't save methods, so we need re-create the FileEntry.[m
             var clonedFileEntry = new FileEntry(fileEntry.name, fileEntry.fullPath, fileEntry.filesystem);[m
             clonedFileEntry.file_ = fileEntry.file_;[m
[36m@@ -766,46 +766,46 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             return clonedFileEntry;[m
         }[m
 [m
[31m-        function readAs(what, fullPath, encoding, startPos, endPos, successCallback, errorCallback) {[m
[31m-            exports.getFile(function(fileEntry) {[m
[31m-                var fileReader = new FileReader(),[m
[31m-                    blob = fileEntry.file_.blob_.slice(startPos, endPos);[m
[32m+[m[32m        function readAs (what, fullPath, encoding, startPos, endPos, successCallback, errorCallback) {[m
[32m+[m[32m            exports.getFile(function (fileEntry) {[m
[32m+[m[32m                var fileReader = new FileReader(); // eslint-disable-line no-undef[m
[32m+[m[32m                var blob = fileEntry.file_.blob_.slice(startPos, endPos);[m
 [m
[31m-                fileReader.onload = function(e) {[m
[32m+[m[32m                fileReader.onload = function (e) {[m
                     successCallback(e.target.result);[m
                 };[m
 [m
                 fileReader.onerror = errorCallback;[m
 [m
                 switch (what) {[m
[31m-                    case 'text':[m
[31m-                        fileReader.readAsText(blob, encoding);[m
[31m-                        break;[m
[31m-                    case 'dataURL':[m
[31m-                        fileReader.readAsDataURL(blob);[m
[31m-                        break;[m
[31m-                    case 'arrayBuffer':[m
[31m-                        fileReader.readAsArrayBuffer(blob);[m
[31m-                        break;[m
[31m-                    case 'binaryString':[m
[31m-                        fileReader.readAsBinaryString(blob);[m
[31m-                        break;[m
[32m+[m[32m                case 'text':[m
[32m+[m[32m                    fileReader.readAsText(blob, encoding);[m
[32m+[m[32m                    break;[m
[32m+[m[32m                case 'dataURL':[m
[32m+[m[32m                    fileReader.readAsDataURL(blob);[m
[32m+[m[32m                    break;[m
[32m+[m[32m                case 'arrayBuffer':[m
[32m+[m[32m                    fileReader.readAsArrayBuffer(blob);[m
[32m+[m[32m                    break;[m
[32m+[m[32m                case 'binaryString':[m
[32m+[m[32m                    fileReader.readAsBinaryString(blob);[m
[32m+[m[32m                    break;[m
                 }[m
 [m
             }, errorCallback, [fullPath, null]);[m
         }[m
 [m
[31m-    /*** Core logic to handle IDB operations ***/[m
[32m+[m[32m    /** * Core logic to handle IDB operations ***/[m
 [m
[31m-        idb_.open = function(dbName, successCallback, errorCallback) {[m
[32m+[m[32m        idb_.open = function (dbName, successCallback, errorCallback) {[m
             var self = this;[m
 [m
             // TODO: FF 12.0a1 isn't liking a db name with : in it.[m
[31m-            var request = indexedDB.open(dbName.replace(':', '_')/*, 1 /*version*/);[m
[32m+[m[32m            var request = indexedDB.open(dbName.replace(':', '_')/*, 1 /*version */);[m
 [m
             request.onerror = errorCallback || onError;[m
 [m
[31m-            request.onupgradeneeded = function(e) {[m
[32m+[m[32m            request.onupgradeneeded = function (e) {[m
                 // First open was called or higher db version was used.[m
 [m
                 // console.log('onupgradeneeded: oldVersion:' + e.oldVersion,[m
[36m@@ -815,11 +815,11 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
                 self.db.onerror = onError;[m
 [m
                 if (!self.db.objectStoreNames.contains(FILE_STORE_)) {[m
[31m-                    self.db.createObjectStore(FILE_STORE_/*,{keyPath: 'id', autoIncrement: true}*/);[m
[32m+[m[32m                    self.db.createObjectStore(FILE_STORE_/*, {keyPath: 'id', autoIncrement: true} */);[m
                 }[m
             };[m
 [m
[31m-            request.onsuccess = function(e) {[m
[32m+[m[32m            request.onsuccess = function (e) {[m
                 self.db = e.target.result;[m
                 self.db.onerror = onError;[m
                 successCallback(e);[m
[36m@@ -828,12 +828,12 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             request.onblocked = errorCallback || onError;[m
         };[m
 [m
[31m-        idb_.close = function() {[m
[32m+[m[32m        idb_.close = function () {[m
             this.db.close();[m
             this.db = null;[m
         };[m
 [m
[31m-        idb_.get = function(fullPath, successCallback, errorCallback) {[m
[32m+[m[32m        idb_.get = function (fullPath, successCallback, errorCallback) {[m
             if (!this.db) {[m
                 if (errorCallback) {[m
                     errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[36m@@ -846,12 +846,12 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             var request = tx.objectStore(FILE_STORE_).get(fullPath);[m
 [m
             tx.onabort = errorCallback || onError;[m
[31m-            tx.oncomplete = function() {[m
[32m+[m[32m            tx.oncomplete = function () {[m
                 successCallback(request.result);[m
             };[m
         };[m
 [m
[31m-        idb_.getAllEntries = function(fullPath, storagePath, successCallback, errorCallback) {[m
[32m+[m[32m        idb_.getAllEntries = function (fullPath, storagePath, successCallback, errorCallback) {[m
             if (!this.db) {[m
                 if (errorCallback) {[m
                     errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[36m@@ -870,8 +870,8 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
 [m
             var tx = this.db.transaction([FILE_STORE_], 'readonly');[m
             tx.onabort = errorCallback || onError;[m
[31m-            tx.oncomplete = function() {[m
[31m-                results = results.filter(function(val) {[m
[32m+[m[32m            tx.oncomplete = function () {[m
[32m+[m[32m                results = results.filter(function (val) {[m
                     var pathWithoutSlash = val.fullPath;[m
 [m
                     if (val.fullPath[val.fullPath.length - 1] === DIR_SEPARATOR) {[m
[36m@@ -883,9 +883,9 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
 [m
                     /* Input fullPath parameter  equals '//' for root folder */[m
                     /* Entries in root folder has valPartsLen equals 2 (see below) */[m
[31m-                    if (fullPath[fullPath.length -1] === DIR_SEPARATOR && fullPath.trim().length === 2) {[m
[32m+[m[32m                    if (fullPath[fullPath.length - 1] === DIR_SEPARATOR && fullPath.trim().length === 2) {[m
                         fullPathPartsLen = 1;[m
[31m-                    } else if (fullPath[fullPath.length -1] === DIR_SEPARATOR) {[m
[32m+[m[32m                    } else if (fullPath[fullPath.length - 1] === DIR_SEPARATOR) {[m
                         fullPathPartsLen = fullPath.substr(0, fullPath.length - 1).split(DIR_SEPARATOR).length;[m
                     } else {[m
                         fullPathPartsLen = fullPath.split(DIR_SEPARATOR).length;[m
[36m@@ -903,7 +903,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
 [m
             var request = tx.objectStore(FILE_STORE_).openCursor(range);[m
 [m
[31m-            request.onsuccess = function(e) {[m
[32m+[m[32m            request.onsuccess = function (e) {[m
                 var cursor = e.target.result;[m
                 if (cursor) {[m
                     var val = cursor.value;[m
[36m@@ -914,7 +914,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             };[m
         };[m
 [m
[31m-        idb_['delete'] = function(fullPath, successCallback, errorCallback, isDirectory) {[m
[32m+[m[32m        idb_['delete'] = function (fullPath, successCallback, errorCallback, isDirectory) {[m
             if (!idb_.db) {[m
                 if (errorCallback) {[m
                     errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[36m@@ -925,14 +925,14 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             var tx = this.db.transaction([FILE_STORE_], 'readwrite');[m
             tx.oncomplete = successCallback;[m
             tx.onabort = errorCallback || onError;[m
[31m-            tx.oncomplete = function() {[m
[32m+[m[32m            tx.oncomplete = function () {[m
                 if (isDirectory) {[m
[31m-                    //We delete nested files and folders after deleting parent folder[m
[31m-                    //We use ranges: https://developer.mozilla.org/en-US/docs/Web/API/IDBKeyRange[m
[32m+[m[32m                    // We delete nested files and folders after deleting parent folder[m
[32m+[m[32m                    // We use ranges: https://developer.mozilla.org/en-US/docs/Web/API/IDBKeyRange[m
                     fullPath = fullPath + DIR_SEPARATOR;[m
 [m
[31m-                    //Range contains all entries in the form fullPath<symbol> where[m
[31m-                    //symbol in the range from ' ' to symbol which has code `unicodeLastChar`[m
[32m+[m[32m                    // Range contains all entries in the form fullPath<symbol> where[m
[32m+[m[32m                    // symbol in the range from ' ' to symbol which has code `unicodeLastChar`[m
                     var range = IDBKeyRange.bound(fullPath + ' ', fullPath + String.fromCharCode(unicodeLastChar));[m
 [m
                     var newTx = this.db.transaction([FILE_STORE_], 'readwrite');[m
[36m@@ -946,7 +946,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
             tx.objectStore(FILE_STORE_)['delete'](fullPath);[m
         };[m
 [m
[31m-        idb_.put = function(entry, storagePath, successCallback, errorCallback) {[m
[32m+[m[32m        idb_.put = function (entry, storagePath, successCallback, errorCallback) {[m
             if (!this.db) {[m
                 if (errorCallback) {[m
                     errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[36m@@ -956,7 +956,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
 [m
             var tx = this.db.transaction([FILE_STORE_], 'readwrite');[m
             tx.onabort = errorCallback || onError;[m
[31m-            tx.oncomplete = function() {[m
[32m+[m[32m            tx.oncomplete = function () {[m
                 // TODO: Error is thrown if we pass the request event back instead.[m
                 successCallback(entry);[m
             };[m
[36m@@ -965,14 +965,14 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
         };[m
 [m
         // Global error handler. Errors bubble from request, to transaction, to db.[m
[31m-        function onError(e) {[m
[32m+[m[32m        function onError (e) {[m
             switch (e.target.errorCode) {[m
[31m-                case 12:[m
[31m-                    console.log('Error - Attempt to open db with a lower version than the ' +[m
[32m+[m[32m            case 12:[m
[32m+[m[32m                console.log('Error - Attempt to open db with a lower version than the ' +[m
                         'current one.');[m
[31m-                    break;[m
[31m-                default:[m
[31m-                    console.log('errorCode: ' + e.target.errorCode);[m
[32m+[m[32m                break;[m
[32m+[m[32m            default:[m
[32m+[m[32m                console.log('errorCode: ' + e.target.errorCode);[m
             }[m
 [m
             console.log(e, e.code, e.message);[m
[36m@@ -980,7 +980,7 @@[m [mcordova.define("cordova-plugin-file.browserFileProxy", function(require, exports[m
 [m
     })(module.exports, window);[m
 [m
[31m-    require("cordova/exec/proxy").add("File", module.exports);[m
[32m+[m[32m    require('cordova/exec/proxy').add('File', module.exports);[m
 })();[m
 [m
 });[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/DirectoryEntry.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/DirectoryEntry.js[m
[1mindex 464d339..7e1d3f7 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/DirectoryEntry.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/DirectoryEntry.js[m
[36m@@ -19,12 +19,12 @@[m [mcordova.define("cordova-plugin-file.DirectoryEntry", function(require, exports,[m
  *[m
 */[m
 [m
[31m-var argscheck = require('cordova/argscheck'),[m
[31m-    utils = require('cordova/utils'),[m
[31m-    exec = require('cordova/exec'),[m
[31m-    Entry = require('./Entry'),[m
[31m-    FileError = require('./FileError'),[m
[31m-    DirectoryReader = require('./DirectoryReader');[m
[32m+[m[32mvar argscheck = require('cordova/argscheck');[m
[32m+[m[32mvar utils = require('cordova/utils');[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar Entry = require('./Entry');[m
[32m+[m[32mvar FileError = require('./FileError');[m
[32m+[m[32mvar DirectoryReader = require('./DirectoryReader');[m
 [m
 /**[m
  * An interface representing a directory on the file system.[m
[36m@@ -35,15 +35,15 @@[m [mvar argscheck = require('cordova/argscheck'),[m
  * {DOMString} fullPath the absolute full path to the directory (readonly)[m
  * {FileSystem} filesystem on which the directory resides (readonly)[m
  */[m
[31m-var DirectoryEntry = function(name, fullPath, fileSystem, nativeURL) {[m
[32m+[m[32mvar DirectoryEntry = function (name, fullPath, fileSystem, nativeURL) {[m
 [m
     // add trailing slash if it is missing[m
     if ((fullPath) && !/\/$/.test(fullPath)) {[m
[31m-        fullPath += "/";[m
[32m+[m[32m        fullPath += '/';[m
     }[m
     // add trailing slash if it is missing[m
     if (nativeURL && !/\/$/.test(nativeURL)) {[m
[31m-        nativeURL += "/";[m
[32m+[m[32m        nativeURL += '/';[m
     }[m
     DirectoryEntry.__super__.constructor.call(this, false, true, name, fullPath, fileSystem, nativeURL);[m
 };[m
[36m@@ -53,7 +53,7 @@[m [mutils.extend(DirectoryEntry, Entry);[m
 /**[m
  * Creates a new DirectoryReader to read entries from this directory[m
  */[m
[31m-DirectoryEntry.prototype.createReader = function() {[m
[32m+[m[32mDirectoryEntry.prototype.createReader = function () {[m
     return new DirectoryReader(this.toInternalURL());[m
 };[m
 [m
[36m@@ -65,17 +65,17 @@[m [mDirectoryEntry.prototype.createReader = function() {[m
  * @param {Function} successCallback is called with the new entry[m
  * @param {Function} errorCallback is called with a FileError[m
  */[m
[31m-DirectoryEntry.prototype.getDirectory = function(path, options, successCallback, errorCallback) {[m
[32m+[m[32mDirectoryEntry.prototype.getDirectory = function (path, options, successCallback, errorCallback) {[m
     argscheck.checkArgs('sOFF', 'DirectoryEntry.getDirectory', arguments);[m
     var fs = this.filesystem;[m
[31m-    var win = successCallback && function(result) {[m
[32m+[m[32m    var win = successCallback && function (result) {[m
         var entry = new DirectoryEntry(result.name, result.fullPath, fs, result.nativeURL);[m
         successCallback(entry);[m
     };[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(win, fail, "File", "getDirectory", [this.toInternalURL(), path, options]);[m
[32m+[m[32m    exec(win, fail, 'File', 'getDirectory', [this.toInternalURL(), path, options]);[m
 };[m
 [m
 /**[m
[36m@@ -84,12 +84,12 @@[m [mDirectoryEntry.prototype.getDirectory = function(path, options, successCallback,[m
  * @param {Function} successCallback is called with no parameters[m
  * @param {Function} errorCallback is called with a FileError[m
  */[m
[31m-DirectoryEntry.prototype.removeRecursively = function(successCallback, errorCallback) {[m
[32m+[m[32mDirectoryEntry.prototype.removeRecursively = function (successCallback, errorCallback) {[m
     argscheck.checkArgs('FF', 'DirectoryEntry.removeRecursively', arguments);[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(successCallback, fail, "File", "removeRecursively", [this.toInternalURL()]);[m
[32m+[m[32m    exec(successCallback, fail, 'File', 'removeRecursively', [this.toInternalURL()]);[m
 };[m
 [m
 /**[m
[36m@@ -100,18 +100,18 @@[m [mDirectoryEntry.prototype.removeRecursively = function(successCallback, errorCall[m
  * @param {Function} successCallback is called with the new entry[m
  * @param {Function} errorCallback is called with a FileError[m
  */[m
[31m-DirectoryEntry.prototype.getFile = function(path, options, successCallback, errorCallback) {[m
[32m+[m[32mDirectoryEntry.prototype.getFile = function (path, options, successCallback, errorCallback) {[m
     argscheck.checkArgs('sOFF', 'DirectoryEntry.getFile', arguments);[m
     var fs = this.filesystem;[m
[31m-    var win = successCallback && function(result) {[m
[32m+[m[32m    var win = successCallback && function (result) {[m
         var FileEntry = require('./FileEntry');[m
         var entry = new FileEntry(result.name, result.fullPath, fs, result.nativeURL);[m
         successCallback(entry);[m
     };[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(win, fail, "File", "getFile", [this.toInternalURL(), path, options]);[m
[32m+[m[32m    exec(win, fail, 'File', 'getFile', [this.toInternalURL(), path, options]);[m
 };[m
 [m
 module.exports = DirectoryEntry;[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/DirectoryReader.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/DirectoryReader.js[m
[1mindex 921b486..ce74ade 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/DirectoryReader.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/DirectoryReader.js[m
[36m@@ -19,13 +19,13 @@[m [mcordova.define("cordova-plugin-file.DirectoryReader", function(require, exports,[m
  *[m
 */[m
 [m
[31m-var exec = require('cordova/exec'),[m
[31m-    FileError = require('./FileError') ;[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar FileError = require('./FileError');[m
 [m
 /**[m
  * An interface that lists the files and directories in a directory.[m
  */[m
[31m-function DirectoryReader(localURL) {[m
[32m+[m[32mfunction DirectoryReader (localURL) {[m
     this.localURL = localURL || null;[m
     this.hasReadEntries = false;[m
 }[m
[36m@@ -36,21 +36,20 @@[m [mfunction DirectoryReader(localURL) {[m
  * @param {Function} successCallback is called with a list of entries[m
  * @param {Function} errorCallback is called with a FileError[m
  */[m
[31m-DirectoryReader.prototype.readEntries = function(successCallback, errorCallback) {[m
[32m+[m[32mDirectoryReader.prototype.readEntries = function (successCallback, errorCallback) {[m
     // If we've already read and passed on this directory's entries, return an empty list.[m
     if (this.hasReadEntries) {[m
         successCallback([]);[m
         return;[m
     }[m
     var reader = this;[m
[31m-    var win = typeof successCallback !== 'function' ? null : function(result) {[m
[32m+[m[32m    var win = typeof successCallback !== 'function' ? null : function (result) {[m
         var retVal = [];[m
[31m-        for (var i=0; i<result.length; i++) {[m
[32m+[m[32m        for (var i = 0; i < result.length; i++) {[m
             var entry = null;[m
             if (result[i].isDirectory) {[m
                 entry = new (require('./DirectoryEntry'))();[m
[31m-            }[m
[31m-            else if (result[i].isFile) {[m
[32m+[m[32m            } else if (result[i].isFile) {[m
                 entry = new (require('./FileEntry'))();[m
             }[m
             entry.isDirectory = result[i].isDirectory;[m
[36m@@ -64,10 +63,10 @@[m [mDirectoryReader.prototype.readEntries = function(successCallback, errorCallback)[m
         reader.hasReadEntries = true;[m
         successCallback(retVal);[m
     };[m
[31m-    var fail = typeof errorCallback !== 'function' ? null : function(code) {[m
[32m+[m[32m    var fail = typeof errorCallback !== 'function' ? null : function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(win, fail, "File", "readEntries", [this.localURL]);[m
[32m+[m[32m    exec(win, fail, 'File', 'readEntries', [this.localURL]);[m
 };[m
 [m
 module.exports = DirectoryReader;[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/Entry.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/Entry.js[m
[1mindex 35308da..973cf14 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/Entry.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/Entry.js[m
[36m@@ -19,10 +19,10 @@[m [mcordova.define("cordova-plugin-file.Entry", function(require, exports, module) {[m
  *[m
 */[m
 [m
[31m-var argscheck = require('cordova/argscheck'),[m
[31m-    exec = require('cordova/exec'),[m
[31m-    FileError = require('./FileError'),[m
[31m-    Metadata = require('./Metadata');[m
[32m+[m[32mvar argscheck = require('cordova/argscheck');[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar FileError = require('./FileError');[m
[32m+[m[32mvar Metadata = require('./Metadata');[m
 [m
 /**[m
  * Represents a file or directory on the local file system.[m
[36m@@ -45,7 +45,7 @@[m [mvar argscheck = require('cordova/argscheck'),[m
  *            webview controls, for example media players.[m
  *            (optional, readonly)[m
  */[m
[31m-function Entry(isFile, isDirectory, name, fullPath, fileSystem, nativeURL) {[m
[32m+[m[32mfunction Entry (isFile, isDirectory, name, fullPath, fileSystem, nativeURL) {[m
     this.isFile = !!isFile;[m
     this.isDirectory = !!isDirectory;[m
     this.name = name || '';[m
[36m@@ -62,19 +62,19 @@[m [mfunction Entry(isFile, isDirectory, name, fullPath, fileSystem, nativeURL) {[m
  * @param errorCallback[m
  *            {Function} is called with a FileError[m
  */[m
[31m-Entry.prototype.getMetadata = function(successCallback, errorCallback) {[m
[32m+[m[32mEntry.prototype.getMetadata = function (successCallback, errorCallback) {[m
     argscheck.checkArgs('FF', 'Entry.getMetadata', arguments);[m
[31m-    var success = successCallback && function(entryMetadata) {[m
[32m+[m[32m    var success = successCallback && function (entryMetadata) {[m
         var metadata = new Metadata({[m
             size: entryMetadata.size,[m
             modificationTime: entryMetadata.lastModifiedDate[m
         });[m
         successCallback(metadata);[m
     };[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(success, fail, "File", "getFileMetadata", [this.toInternalURL()]);[m
[32m+[m[32m    exec(success, fail, 'File', 'getFileMetadata', [this.toInternalURL()]);[m
 };[m
 [m
 /**[m
[36m@@ -87,9 +87,9 @@[m [mEntry.prototype.getMetadata = function(successCallback, errorCallback) {[m
  * @param metadataObject[m
  *            {Object} keys and values to set[m
  */[m
[31m-Entry.prototype.setMetadata = function(successCallback, errorCallback, metadataObject) {[m
[32m+[m[32mEntry.prototype.setMetadata = function (successCallback, errorCallback, metadataObject) {[m
     argscheck.checkArgs('FFO', 'Entry.setMetadata', arguments);[m
[31m-    exec(successCallback, errorCallback, "File", "setMetadata", [this.toInternalURL(), metadataObject]);[m
[32m+[m[32m    exec(successCallback, errorCallback, 'File', 'setMetadata', [this.toInternalURL(), metadataObject]);[m
 };[m
 [m
 /**[m
[36m@@ -104,34 +104,33 @@[m [mEntry.prototype.setMetadata = function(successCallback, errorCallback, metadataO[m
  * @param errorCallback[m
  *            {Function} called with a FileError[m
  */[m
[31m-Entry.prototype.moveTo = function(parent, newName, successCallback, errorCallback) {[m
[32m+[m[32mEntry.prototype.moveTo = function (parent, newName, successCallback, errorCallback) {[m
     argscheck.checkArgs('oSFF', 'Entry.moveTo', arguments);[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    var srcURL = this.toInternalURL(),[m
[31m-        // entry name[m
[31m-        name = newName || this.name,[m
[31m-        success = function(entry) {[m
[31m-            if (entry) {[m
[31m-                if (successCallback) {[m
[31m-                    // create appropriate Entry object[m
[31m-                    var newFSName = entry.filesystemName || (entry.filesystem && entry.filesystem.name);[m
[31m-                    var fs = newFSName ? new FileSystem(newFSName, { name: "", fullPath: "/" }) : new FileSystem(parent.filesystem.name, { name: "", fullPath: "/" });[m
[31m-                    var result = (entry.isDirectory) ? new (require('./DirectoryEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL) : new (require('cordova-plugin-file.FileEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL);[m
[31m-                    successCallback(result);[m
[31m-                }[m
[32m+[m[32m    var srcURL = this.toInternalURL();[m
[32m+[m[32m    // entry name[m
[32m+[m[32m    var name = newName || this.name;[m
[32m+[m[32m    var success = function (entry) {[m
[32m+[m[32m        if (entry) {[m
[32m+[m[32m            if (successCallback) {[m
[32m+[m[32m                // create appropriate Entry object[m
[32m+[m[32m                var newFSName = entry.filesystemName || (entry.filesystem && entry.filesystem.name);[m
[32m+[m[32m                var fs = newFSName ? new FileSystem(newFSName, { name: '', fullPath: '/' }) : new FileSystem(parent.filesystem.name, { name: '', fullPath: '/' }); // eslint-disable-line no-undef[m
[32m+[m[32m                var result = (entry.isDirectory) ? new (require('./DirectoryEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL) : new (require('cordova-plugin-file.FileEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL);[m
[32m+[m[32m                successCallback(result);[m
             }[m
[31m-            else {[m
[31m-                // no Entry object returned[m
[31m-                if (fail) {[m
[31m-                    fail(FileError.NOT_FOUND_ERR);[m
[31m-                }[m
[32m+[m[32m        } else {[m
[32m+[m[32m            // no Entry object returned[m
[32m+[m[32m            if (fail) {[m
[32m+[m[32m                fail(FileError.NOT_FOUND_ERR);[m
             }[m
[31m-        };[m
[32m+[m[32m        }[m
[32m+[m[32m    };[m
 [m
     // copy[m
[31m-    exec(success, fail, "File", "moveTo", [srcURL, parent.toInternalURL(), name]);[m
[32m+[m[32m    exec(success, fail, 'File', 'moveTo', [srcURL, parent.toInternalURL(), name]);[m
 };[m
 [m
 /**[m
[36m@@ -146,43 +145,42 @@[m [mEntry.prototype.moveTo = function(parent, newName, successCallback, errorCallbac[m
  * @param errorCallback[m
  *            {Function} called with a FileError[m
  */[m
[31m-Entry.prototype.copyTo = function(parent, newName, successCallback, errorCallback) {[m
[32m+[m[32mEntry.prototype.copyTo = function (parent, newName, successCallback, errorCallback) {[m
     argscheck.checkArgs('oSFF', 'Entry.copyTo', arguments);[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    var srcURL = this.toInternalURL(),[m
[32m+[m[32m    var srcURL = this.toInternalURL();[m
         // entry name[m
[31m-        name = newName || this.name,[m
[31m-        // success callback[m
[31m-        success = function(entry) {[m
[31m-            if (entry) {[m
[31m-                if (successCallback) {[m
[31m-                    // create appropriate Entry object[m
[31m-                    var newFSName = entry.filesystemName || (entry.filesystem && entry.filesystem.name);[m
[31m-                    var fs = newFSName ? new FileSystem(newFSName, { name: "", fullPath: "/" }) : new FileSystem(parent.filesystem.name, { name: "", fullPath: "/" });[m
[31m-                    var result = (entry.isDirectory) ? new (require('./DirectoryEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL) : new (require('cordova-plugin-file.FileEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL);[m
[31m-                    successCallback(result);[m
[31m-                }[m
[32m+[m[32m    var name = newName || this.name;[m
[32m+[m[32m    // success callback[m
[32m+[m[32m    var success = function (entry) {[m
[32m+[m[32m        if (entry) {[m
[32m+[m[32m            if (successCallback) {[m
[32m+[m[32m                // create appropriate Entry object[m
[32m+[m[32m                var newFSName = entry.filesystemName || (entry.filesystem && entry.filesystem.name);[m
[32m+[m[32m                var fs = newFSName ? new FileSystem(newFSName, { name: '', fullPath: '/' }) : new FileSystem(parent.filesystem.name, { name: '', fullPath: '/' }); // eslint-disable-line no-undef[m
[32m+[m[32m                var result = (entry.isDirectory) ? new (require('./DirectoryEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL) : new (require('cordova-plugin-file.FileEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL);[m
[32m+[m[32m                successCallback(result);[m
             }[m
[31m-            else {[m
[31m-                // no Entry object returned[m
[31m-                if (fail) {[m
[31m-                    fail(FileError.NOT_FOUND_ERR);[m
[31m-                }[m
[32m+[m[32m        } else {[m
[32m+[m[32m            // no Entry object returned[m
[32m+[m[32m            if (fail) {[m
[32m+[m[32m                fail(FileError.NOT_FOUND_ERR);[m
             }[m
[31m-        };[m
[32m+[m[32m        }[m
[32m+[m[32m    };[m
 [m
     // copy[m
[31m-    exec(success, fail, "File", "copyTo", [srcURL, parent.toInternalURL(), name]);[m
[32m+[m[32m    exec(success, fail, 'File', 'copyTo', [srcURL, parent.toInternalURL(), name]);[m
 };[m
 [m
 /**[m
  * Return a URL that can be passed across the bridge to identify this entry.[m
  */[m
[31m-Entry.prototype.toInternalURL = function() {[m
[32m+[m[32mEntry.prototype.toInternalURL = function () {[m
     if (this.filesystem && this.filesystem.__format__) {[m
[31m-      return this.filesystem.__format__(this.fullPath, this.nativeURL);[m
[32m+[m[32m        return this.filesystem.__format__(this.fullPath, this.nativeURL);[m
     }[m
 };[m
 [m
[36m@@ -191,13 +189,13 @@[m [mEntry.prototype.toInternalURL = function() {[m
  * Use a URL that can be used to as the src attribute of a <video> or[m
  * <audio> tag. If that is not possible, construct a cdvfile:// URL.[m
  */[m
[31m-Entry.prototype.toURL = function() {[m
[32m+[m[32mEntry.prototype.toURL = function () {[m
     if (this.nativeURL) {[m
[31m-      return this.nativeURL;[m
[32m+[m[32m        return this.nativeURL;[m
     }[m
     // fullPath attribute may contain the full URL in the case that[m
     // toInternalURL fails.[m
[31m-    return this.toInternalURL() || "file://localhost" + this.fullPath;[m
[32m+[m[32m    return this.toInternalURL() || 'file://localhost' + this.fullPath;[m
 };[m
 [m
 /**[m
[36m@@ -207,7 +205,7 @@[m [mEntry.prototype.toURL = function() {[m
  * See CB-6051, CB-6106, CB-6117, CB-6152, CB-6199, CB-6201, CB-6243, CB-6249,[m
  * and CB-6300.[m
  */[m
[31m-Entry.prototype.toNativeURL = function() {[m
[32m+[m[32mEntry.prototype.toNativeURL = function () {[m
     console.log("DEPRECATED: Update your code to use 'toURL'");[m
     return this.toURL();[m
 };[m
[36m@@ -218,7 +216,7 @@[m [mEntry.prototype.toNativeURL = function() {[m
  * @param {DOMString} mimeType for a FileEntry, the mime type to be used to interpret the file, when loaded through this URI.[m
  * @return uri[m
  */[m
[31m-Entry.prototype.toURI = function(mimeType) {[m
[32m+[m[32mEntry.prototype.toURI = function (mimeType) {[m
     console.log("DEPRECATED: Update your code to use 'toURL'");[m
     return this.toURL();[m
 };[m
[36m@@ -231,12 +229,12 @@[m [mEntry.prototype.toURI = function(mimeType) {[m
  * @param successCallback {Function} called with no parameters[m
  * @param errorCallback {Function} called with a FileError[m
  */[m
[31m-Entry.prototype.remove = function(successCallback, errorCallback) {[m
[32m+[m[32mEntry.prototype.remove = function (successCallback, errorCallback) {[m
     argscheck.checkArgs('FF', 'Entry.remove', arguments);[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(successCallback, fail, "File", "remove", [this.toInternalURL()]);[m
[32m+[m[32m    exec(successCallback, fail, 'File', 'remove', [this.toInternalURL()]);[m
 };[m
 [m
 /**[m
[36m@@ -245,18 +243,18 @@[m [mEntry.prototype.remove = function(successCallback, errorCallback) {[m
  * @param successCallback {Function} called with the parent DirectoryEntry object[m
  * @param errorCallback {Function} called with a FileError[m
  */[m
[31m-Entry.prototype.getParent = function(successCallback, errorCallback) {[m
[32m+[m[32mEntry.prototype.getParent = function (successCallback, errorCallback) {[m
     argscheck.checkArgs('FF', 'Entry.getParent', arguments);[m
     var fs = this.filesystem;[m
[31m-    var win = successCallback && function(result) {[m
[32m+[m[32m    var win = successCallback && function (result) {[m
         var DirectoryEntry = require('./DirectoryEntry');[m
         var entry = new DirectoryEntry(result.name, result.fullPath, fs, result.nativeURL);[m
         successCallback(entry);[m
     };[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(win, fail, "File", "getParent", [this.toInternalURL()]);[m
[32m+[m[32m    exec(win, fail, 'File', 'getParent', [this.toInternalURL()]);[m
 };[m
 [m
 module.exports = Entry;[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/File.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/File.js[m
[1mindex 47c267b..974b09f 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/File.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/File.js[m
[36m@@ -28,7 +28,7 @@[m [mcordova.define("cordova-plugin-file.File", function(require, exports, module) {[m
  * size {Number} size of the file in bytes[m
  */[m
 [m
[31m-var File = function(name, localURL, type, lastModifiedDate, size){[m
[32m+[m[32mvar File = function (name, localURL, type, lastModifiedDate, size) {[m
     this.name = name || '';[m
     this.localURL = localURL || null;[m
     this.type = type || null;[m
[36m@@ -49,7 +49,7 @@[m [mvar File = function(name, localURL, type, lastModifiedDate, size){[m
  * start {Number} The index at which to start the slice (inclusive).[m
  * end {Number} The index at which to end the slice (exclusive).[m
  */[m
[31m-File.prototype.slice = function(start, end) {[m
[32m+[m[32mFile.prototype.slice = function (start, end) {[m
     var size = this.end - this.start;[m
     var newStart = 0;[m
     var newEnd = size;[m
[36m@@ -75,7 +75,6 @@[m [mFile.prototype.slice = function(start, end) {[m
     return newFile;[m
 };[m
 [m
[31m-[m
 module.exports = File;[m
 [m
 });[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileEntry.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileEntry.js[m
[1mindex a2336a0..b16c851 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileEntry.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileEntry.js[m
[36m@@ -19,12 +19,12 @@[m [mcordova.define("cordova-plugin-file.FileEntry", function(require, exports, modul[m
  *[m
 */[m
 [m
[31m-var utils = require('cordova/utils'),[m
[31m-    exec = require('cordova/exec'),[m
[31m-    Entry = require('./Entry'),[m
[31m-    FileWriter = require('./FileWriter'),[m
[31m-    File = require('./File'),[m
[31m-    FileError = require('./FileError');[m
[32m+[m[32mvar utils = require('cordova/utils');[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar Entry = require('./Entry');[m
[32m+[m[32mvar FileWriter = require('./FileWriter');[m
[32m+[m[32mvar File = require('./File');[m
[32m+[m[32mvar FileError = require('./FileError');[m
 [m
 /**[m
  * An interface representing a file on the file system.[m
[36m@@ -35,7 +35,7 @@[m [mvar utils = require('cordova/utils'),[m
  * {DOMString} fullPath the absolute full path to the file (readonly)[m
  * {FileSystem} filesystem on which the file resides (readonly)[m
  */[m
[31m-var FileEntry = function(name, fullPath, fileSystem, nativeURL) {[m
[32m+[m[32mvar FileEntry = function (name, fullPath, fileSystem, nativeURL) {[m
     // remove trailing slash if it is present[m
     if (fullPath && /\/$/.test(fullPath)) {[m
         fullPath = fullPath.substring(0, fullPath.length - 1);[m
[36m@@ -55,11 +55,11 @@[m [mutils.extend(FileEntry, Entry);[m
  * @param {Function} successCallback is called with the new FileWriter[m
  * @param {Function} errorCallback is called with a FileError[m
  */[m
[31m-FileEntry.prototype.createWriter = function(successCallback, errorCallback) {[m
[31m-    this.file(function(filePointer) {[m
[32m+[m[32mFileEntry.prototype.createWriter = function (successCallback, errorCallback) {[m
[32m+[m[32m    this.file(function (filePointer) {[m
         var writer = new FileWriter(filePointer);[m
 [m
[31m-        if (writer.localURL === null || writer.localURL === "") {[m
[32m+[m[32m        if (writer.localURL === null || writer.localURL === '') {[m
             if (errorCallback) {[m
                 errorCallback(new FileError(FileError.INVALID_STATE_ERR));[m
             }[m
[36m@@ -77,19 +77,18 @@[m [mFileEntry.prototype.createWriter = function(successCallback, errorCallback) {[m
  * @param {Function} successCallback is called with the new File object[m
  * @param {Function} errorCallback is called with a FileError[m
  */[m
[31m-FileEntry.prototype.file = function(successCallback, errorCallback) {[m
[32m+[m[32mFileEntry.prototype.file = function (successCallback, errorCallback) {[m
     var localURL = this.toInternalURL();[m
[31m-    var win = successCallback && function(f) {[m
[32m+[m[32m    var win = successCallback && function (f) {[m
         var file = new File(f.name, localURL, f.type, f.lastModifiedDate, f.size);[m
         successCallback(file);[m
     };[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(win, fail, "File", "getFileMetadata", [localURL]);[m
[32m+[m[32m    exec(win, fail, 'File', 'getFileMetadata', [localURL]);[m
 };[m
 [m
[31m-[m
 module.exports = FileEntry;[m
 [m
 });[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileError.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileError.js[m
[1mindex 403f73b..7a0a66e 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileError.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileError.js[m
[36m@@ -22,8 +22,8 @@[m [mcordova.define("cordova-plugin-file.FileError", function(require, exports, modul[m
 /**[m
  * FileError[m
  */[m
[31m-function FileError(error) {[m
[31m-  this.code = error || null;[m
[32m+[m[32mfunction FileError (error) {[m
[32m+[m[32m    this.code = error || null;[m
 }[m
 [m
 // File error codes[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileReader.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileReader.js[m
[1mindex 0d15aa8..1227dd8 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileReader.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileReader.js[m
[36m@@ -19,12 +19,12 @@[m [mcordova.define("cordova-plugin-file.FileReader", function(require, exports, modu[m
  *[m
 */[m
 [m
[31m-var exec = require('cordova/exec'),[m
[31m-    modulemapper = require('cordova/modulemapper'),[m
[31m-    utils = require('cordova/utils'),[m
[31m-    FileError = require('./FileError'),[m
[31m-    ProgressEvent = require('./ProgressEvent'),[m
[31m-    origFileReader = modulemapper.getOriginalSymbol(window, 'FileReader');[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar modulemapper = require('cordova/modulemapper');[m
[32m+[m[32mvar utils = require('cordova/utils');[m
[32m+[m[32mvar FileError = require('./FileError');[m
[32m+[m[32mvar ProgressEvent = require('./ProgressEvent');[m
[32m+[m[32mvar origFileReader = modulemapper.getOriginalSymbol(window, 'FileReader');[m
 [m
 /**[m
  * This class reads the mobile device file system.[m
[36m@@ -34,13 +34,13 @@[m [mvar exec = require('cordova/exec'),[m
  *      To read from the SD card, the file name is "sdcard/my_file.txt"[m
  * @constructor[m
  */[m
[31m-var FileReader = function() {[m
[32m+[m[32mvar FileReader = function () {[m
     this._readyState = 0;[m
     this._error = null;[m
     this._result = null;[m
     this._progress = null;[m
     this._localURL = '';[m
[31m-    this._realReader = origFileReader ? new origFileReader() : {};[m
[32m+[m[32m    this._realReader = origFileReader ? new origFileReader() : {}; // eslint-disable-line new-cap[m
 };[m
 [m
 /**[m
[36m@@ -49,29 +49,29 @@[m [mvar FileReader = function() {[m
  * (Note attempts to allocate more than a few MB of contiguous memory on the native side are likely to cause[m
  * OOM exceptions, while the JS engine seems to have fewer problems managing large strings or ArrayBuffers.)[m
  */[m
[31m-FileReader.READ_CHUNK_SIZE = 256*1024;[m
[32m+[m[32mFileReader.READ_CHUNK_SIZE = 256 * 1024;[m
 [m
 // States[m
 FileReader.EMPTY = 0;[m
 FileReader.LOADING = 1;[m
 FileReader.DONE = 2;[m
 [m
[31m-utils.defineGetter(FileReader.prototype, 'readyState', function() {[m
[32m+[m[32mutils.defineGetter(FileReader.prototype, 'readyState', function () {[m
     return this._localURL ? this._readyState : this._realReader.readyState;[m
 });[m
 [m
[31m-utils.defineGetter(FileReader.prototype, 'error', function() {[m
[31m-    return this._localURL ? this._error: this._realReader.error;[m
[32m+[m[32mutils.defineGetter(FileReader.prototype, 'error', function () {[m
[32m+[m[32m    return this._localURL ? this._error : this._realReader.error;[m
 });[m
 [m
[31m-utils.defineGetter(FileReader.prototype, 'result', function() {[m
[31m-    return this._localURL ? this._result: this._realReader.result;[m
[32m+[m[32mutils.defineGetter(FileReader.prototype, 'result', function () {[m
[32m+[m[32m    return this._localURL ? this._result : this._realReader.result;[m
 });[m
 [m
[31m-function defineEvent(eventName) {[m
[31m-    utils.defineGetterSetter(FileReader.prototype, eventName, function() {[m
[32m+[m[32mfunction defineEvent (eventName) {[m
[32m+[m[32m    utils.defineGetterSetter(FileReader.prototype, eventName, function () {[m
         return this._realReader[eventName] || null;[m
[31m-    }, function(value) {[m
[32m+[m[32m    }, function (value) {[m
         this._realReader[eventName] = value;[m
     });[m
 }[m
[36m@@ -82,10 +82,10 @@[m [mdefineEvent('onerror');        // When the read has failed (see errors).[m
 defineEvent('onloadend');      // When the request has completed (either in success or failure).[m
 defineEvent('onabort');        // When the read has been aborted. For instance, by invoking the abort() method.[m
 [m
[31m-function initRead(reader, file) {[m
[32m+[m[32mfunction initRead (reader, file) {[m
     // Already loading something[m
[31m-    if (reader.readyState == FileReader.LOADING) {[m
[31m-      throw new FileError(FileError.INVALID_STATE_ERR);[m
[32m+[m[32m    if (reader.readyState === FileReader.LOADING) {[m
[32m+[m[32m        throw new FileError(FileError.INVALID_STATE_ERR);[m
     }[m
 [m
     reader._result = null;[m
[36m@@ -93,7 +93,7 @@[m [mfunction initRead(reader, file) {[m
     reader._progress = 0;[m
     reader._readyState = FileReader.LOADING;[m
 [m
[31m-    if (typeof file.localURL == 'string') {[m
[32m+[m[32m    if (typeof file.localURL === 'string') {[m
         reader._localURL = file.localURL;[m
     } else {[m
         reader._localURL = '';[m
[36m@@ -101,7 +101,7 @@[m [mfunction initRead(reader, file) {[m
     }[m
 [m
     if (reader.onloadstart) {[m
[31m-        reader.onloadstart(new ProgressEvent("loadstart", {target:reader}));[m
[32m+[m[32m        reader.onloadstart(new ProgressEvent('loadstart', {target: reader}));[m
     }[m
 }[m
 [m
[36m@@ -116,7 +116,7 @@[m [mfunction initRead(reader, file) {[m
  * @param accumulate A function that takes the callback result and accumulates it in this._result.[m
  * @param r Callback result returned by the last read exec() call, or null to begin reading.[m
  */[m
[31m-function readSuccessCallback(readType, encoding, offset, totalSize, accumulate, r) {[m
[32m+[m[32mfunction readSuccessCallback (readType, encoding, offset, totalSize, accumulate, r) {[m
     if (this._readyState === FileReader.DONE) {[m
         return;[m
     }[m
[36m@@ -125,22 +125,22 @@[m [mfunction readSuccessCallback(readType, encoding, offset, totalSize, accumulate,[m
     if (readType === 'readAsDataURL') {[m
         // Windows proxy does not support reading file slices as Data URLs[m
         // so read the whole file at once.[m
[31m-        CHUNK_SIZE = cordova.platformId === 'windows' ? totalSize :[m
[32m+[m[32m        CHUNK_SIZE = cordova.platformId === 'windows' ? totalSize : // eslint-disable-line no-undef[m
             // Calculate new chunk size for data URLs to be multiply of 3[m
             // Otherwise concatenated base64 chunks won't be valid base64 data[m
             FileReader.READ_CHUNK_SIZE - (FileReader.READ_CHUNK_SIZE % 3) + 3;[m
     }[m
 [m
[31m-    if (typeof r !== "undefined") {[m
[32m+[m[32m    if (typeof r !== 'undefined') {[m
         accumulate(r);[m
         this._progress = Math.min(this._progress + CHUNK_SIZE, totalSize);[m
 [m
[31m-        if (typeof this.onprogress === "function") {[m
[31m-            this.onprogress(new ProgressEvent("progress", {loaded:this._progress, total:totalSize}));[m
[32m+[m[32m        if (typeof this.onprogress === 'function') {[m
[32m+[m[32m            this.onprogress(new ProgressEvent('progress', {loaded: this._progress, total: totalSize}));[m
         }[m
     }[m
 [m
[31m-    if (typeof r === "undefined" || this._progress < totalSize) {[m
[32m+[m[32m    if (typeof r === 'undefined' || this._progress < totalSize) {[m
         var execArgs = [[m
             this._localURL,[m
             offset + this._progress,[m
[36m@@ -151,16 +151,16 @@[m [mfunction readSuccessCallback(readType, encoding, offset, totalSize, accumulate,[m
         exec([m
             readSuccessCallback.bind(this, readType, encoding, offset, totalSize, accumulate),[m
             readFailureCallback.bind(this),[m
[31m-            "File", readType, execArgs);[m
[32m+[m[32m            'File', readType, execArgs);[m
     } else {[m
         this._readyState = FileReader.DONE;[m
 [m
[31m-        if (typeof this.onload === "function") {[m
[31m-            this.onload(new ProgressEvent("load", {target:this}));[m
[32m+[m[32m        if (typeof this.onload === 'function') {[m
[32m+[m[32m            this.onload(new ProgressEvent('load', {target: this}));[m
         }[m
 [m
[31m-        if (typeof this.onloadend === "function") {[m
[31m-            this.onloadend(new ProgressEvent("loadend", {target:this}));[m
[32m+[m[32m        if (typeof this.onloadend === 'function') {[m
[32m+[m[32m            this.onloadend(new ProgressEvent('loadend', {target: this}));[m
         }[m
     }[m
 }[m
[36m@@ -169,7 +169,7 @@[m [mfunction readSuccessCallback(readType, encoding, offset, totalSize, accumulate,[m
  * Callback used by the following read* functions to handle errors.[m
  * Must be bound to the FileReader's this, e.g. readFailureCallback.bind(this)[m
  */[m
[31m-function readFailureCallback(e) {[m
[32m+[m[32mfunction readFailureCallback (e) {[m
     if (this._readyState === FileReader.DONE) {[m
         return;[m
     }[m
[36m@@ -178,37 +178,37 @@[m [mfunction readFailureCallback(e) {[m
     this._result = null;[m
     this._error = new FileError(e);[m
 [m
[31m-    if (typeof this.onerror === "function") {[m
[31m-        this.onerror(new ProgressEvent("error", {target:this}));[m
[32m+[m[32m    if (typeof this.onerror === 'function') {[m
[32m+[m[32m        this.onerror(new ProgressEvent('error', {target: this}));[m
     }[m
 [m
[31m-    if (typeof this.onloadend === "function") {[m
[31m-        this.onloadend(new ProgressEvent("loadend", {target:this}));[m
[32m+[m[32m    if (typeof this.onloadend === 'function') {[m
[32m+[m[32m        this.onloadend(new ProgressEvent('loadend', {target: this}));[m
     }[m
 }[m
 [m
 /**[m
  * Abort reading file.[m
  */[m
[31m-FileReader.prototype.abort = function() {[m
[32m+[m[32mFileReader.prototype.abort = function () {[m
     if (origFileReader && !this._localURL) {[m
         return this._realReader.abort();[m
     }[m
     this._result = null;[m
 [m
[31m-    if (this._readyState == FileReader.DONE || this._readyState == FileReader.EMPTY) {[m
[31m-      return;[m
[32m+[m[32m    if (this._readyState === FileReader.DONE || this._readyState === FileReader.EMPTY) {[m
[32m+[m[32m        return;[m
     }[m
 [m
     this._readyState = FileReader.DONE;[m
 [m
     // If abort callback[m
     if (typeof this.onabort === 'function') {[m
[31m-        this.onabort(new ProgressEvent('abort', {target:this}));[m
[32m+[m[32m        this.onabort(new ProgressEvent('abort', {target: this}));[m
     }[m
     // If load end callback[m
     if (typeof this.onloadend === 'function') {[m
[31m-        this.onloadend(new ProgressEvent('loadend', {target:this}));[m
[32m+[m[32m        this.onloadend(new ProgressEvent('loadend', {target: this}));[m
     }[m
 };[m
 [m
[36m@@ -218,24 +218,23 @@[m [mFileReader.prototype.abort = function() {[m
  * @param file          {File} File object containing file properties[m
  * @param encoding      [Optional] (see http://www.iana.org/assignments/character-sets)[m
  */[m
[31m-FileReader.prototype.readAsText = function(file, encoding) {[m
[32m+[m[32mFileReader.prototype.readAsText = function (file, encoding) {[m
     if (initRead(this, file)) {[m
         return this._realReader.readAsText(file, encoding);[m
     }[m
 [m
     // Default encoding is UTF-8[m
[31m-    var enc = encoding ? encoding : "UTF-8";[m
[32m+[m[32m    var enc = encoding || 'UTF-8';[m
 [m
     var totalSize = file.end - file.start;[m
[31m-    readSuccessCallback.bind(this)("readAsText", enc, file.start, totalSize, function(r) {[m
[32m+[m[32m    readSuccessCallback.bind(this)('readAsText', enc, file.start, totalSize, function (r) {[m
         if (this._progress === 0) {[m
[31m-            this._result = "";[m
[32m+[m[32m            this._result = '';[m
         }[m
         this._result += r;[m
     }.bind(this));[m
 };[m
 [m
[31m-[m
 /**[m
  * Read file and return data as a base64 encoded data url.[m
  * A data url is of the form:[m
[36m@@ -243,13 +242,13 @@[m [mFileReader.prototype.readAsText = function(file, encoding) {[m
  *[m
  * @param file          {File} File object containing file properties[m
  */[m
[31m-FileReader.prototype.readAsDataURL = function(file) {[m
[32m+[m[32mFileReader.prototype.readAsDataURL = function (file) {[m
     if (initRead(this, file)) {[m
         return this._realReader.readAsDataURL(file);[m
     }[m
 [m
     var totalSize = file.end - file.start;[m
[31m-    readSuccessCallback.bind(this)("readAsDataURL", null, file.start, totalSize, function(r) {[m
[32m+[m[32m    readSuccessCallback.bind(this)('readAsDataURL', null, file.start, totalSize, function (r) {[m
         var commaIndex = r.indexOf(',');[m
         if (this._progress === 0) {[m
             this._result = r;[m
[36m@@ -264,15 +263,15 @@[m [mFileReader.prototype.readAsDataURL = function(file) {[m
  *[m
  * @param file          {File} File object containing file properties[m
  */[m
[31m-FileReader.prototype.readAsBinaryString = function(file) {[m
[32m+[m[32mFileReader.prototype.readAsBinaryString = function (file) {[m
     if (initRead(this, file)) {[m
         return this._realReader.readAsBinaryString(file);[m
     }[m
 [m
     var totalSize = file.end - file.start;[m
[31m-    readSuccessCallback.bind(this)("readAsBinaryString", null, file.start, totalSize, function(r) {[m
[32m+[m[32m    readSuccessCallback.bind(this)('readAsBinaryString', null, file.start, totalSize, function (r) {[m
         if (this._progress === 0) {[m
[31m-            this._result = "";[m
[32m+[m[32m            this._result = '';[m
         }[m
         this._result += r;[m
     }.bind(this));[m
[36m@@ -283,13 +282,13 @@[m [mFileReader.prototype.readAsBinaryString = function(file) {[m
  *[m
  * @param file          {File} File object containing file properties[m
  */[m
[31m-FileReader.prototype.readAsArrayBuffer = function(file) {[m
[32m+[m[32mFileReader.prototype.readAsArrayBuffer = function (file) {[m
     if (initRead(this, file)) {[m
         return this._realReader.readAsArrayBuffer(file);[m
     }[m
 [m
     var totalSize = file.end - file.start;[m
[31m-    readSuccessCallback.bind(this)("readAsArrayBuffer", null, file.start, totalSize, function(r) {[m
[32m+[m[32m    readSuccessCallback.bind(this)('readAsArrayBuffer', null, file.start, totalSize, function (r) {[m
         var resultArray = (this._progress === 0 ? new Uint8Array(totalSize) : new Uint8Array(this._result));[m
         resultArray.set(new Uint8Array(r), this._progress);[m
         this._result = resultArray.buffer;[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileSystem.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileSystem.js[m
[1mindex 9a8d81e..f7e751e 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileSystem.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileSystem.js[m
[36m@@ -28,7 +28,7 @@[m [mvar DirectoryEntry = require('./DirectoryEntry');[m
  * {DOMString} name the unique name of the file system (readonly)[m
  * {DirectoryEntry} root directory of the file system (readonly)[m
  */[m
[31m-var FileSystem = function(name, root) {[m
[32m+[m[32mvar FileSystem = function (name, root) {[m
     this.name = name;[m
     if (root) {[m
         this.root = new DirectoryEntry(root.name, root.fullPath, this, root.nativeURL);[m
[36m@@ -37,16 +37,16 @@[m [mvar FileSystem = function(name, root) {[m
     }[m
 };[m
 [m
[31m-FileSystem.prototype.__format__ = function(fullPath, nativeUrl) {[m
[32m+[m[32mFileSystem.prototype.__format__ = function (fullPath, nativeUrl) {[m
     return fullPath;[m
 };[m
 [m
[31m-FileSystem.prototype.toJSON = function() {[m
[31m-    return "<FileSystem: " + this.name + ">";[m
[32m+[m[32mFileSystem.prototype.toJSON = function () {[m
[32m+[m[32m    return '<FileSystem: ' + this.name + '>';[m
 };[m
 [m
 // Use instead of encodeURI() when encoding just the path part of a URI rather than an entire URI.[m
[31m-FileSystem.encodeURIPath = function(path) {[m
[32m+[m[32mFileSystem.encodeURIPath = function (path) {[m
     // Because # is a valid filename character, it must be encoded to prevent part of the[m
     // path from being parsed as a URI fragment.[m
     return encodeURI(path).replace(/#/g, '%23');[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileUploadOptions.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileUploadOptions.js[m
[1mindex 9928359..908091b 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileUploadOptions.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileUploadOptions.js[m
[36m@@ -29,7 +29,7 @@[m [mcordova.define("cordova-plugin-file.FileUploadOptions", function(require, export[m
  * @param headers {Object}   Keys are header names, values are header values. Multiple[m
  *                           headers of the same name are not supported.[m
  */[m
[31m-var FileUploadOptions = function(fileKey, fileName, mimeType, params, headers, httpMethod) {[m
[32m+[m[32mvar FileUploadOptions = function (fileKey, fileName, mimeType, params, headers, httpMethod) {[m
     this.fileKey = fileKey || null;[m
     this.fileName = fileName || null;[m
     this.mimeType = mimeType || null;[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileUploadResult.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileUploadResult.js[m
[1mindex 3110814..a94cb9a 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileUploadResult.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileUploadResult.js[m
[36m@@ -23,9 +23,10 @@[m [mcordova.define("cordova-plugin-file.FileUploadResult", function(require, exports[m
  * FileUploadResult[m
  * @constructor[m
  */[m
[31m-module.exports = function FileUploadResult(size, code, content) {[m
[31m-	this.bytesSent = size;[m
[31m-	this.responseCode = code;[m
[31m-	this.response = content;[m
[31m- };[m
[32m+[m[32mmodule.exports = function FileUploadResult (size, code, content) {[m
[32m+[m[32m    this.bytesSent = size;[m
[32m+[m[32m    this.responseCode = code;[m
[32m+[m[32m    this.response = content;[m
[32m+[m[32m};[m
[32m+[m
 });[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileWriter.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileWriter.js[m
[1mindex c153971..1f978bb 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileWriter.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/FileWriter.js[m
[36m@@ -19,9 +19,9 @@[m [mcordova.define("cordova-plugin-file.FileWriter", function(require, exports, modu[m
  *[m
 */[m
 [m
[31m-var exec = require('cordova/exec'),[m
[31m-    FileError = require('./FileError'),[m
[31m-    ProgressEvent = require('./ProgressEvent');[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar FileError = require('./FileError');[m
[32m+[m[32mvar ProgressEvent = require('./ProgressEvent');[m
 [m
 /**[m
  * This class writes to the mobile device file system.[m
[36m@@ -34,8 +34,8 @@[m [mvar exec = require('cordova/exec'),[m
  * @param file {File} File object containing file properties[m
  * @param append if true write to the end of the file, otherwise overwrite the file[m
  */[m
[31m-var FileWriter = function(file) {[m
[31m-    this.fileName = "";[m
[32m+[m[32mvar FileWriter = function (file) {[m
[32m+[m[32m    this.fileName = '';[m
     this.length = 0;[m
     if (file) {[m
         this.localURL = file.localURL || file;[m
[36m@@ -68,7 +68,7 @@[m [mFileWriter.DONE = 2;[m
 /**[m
  * Abort writing file.[m
  */[m
[31m-FileWriter.prototype.abort = function() {[m
[32m+[m[32mFileWriter.prototype.abort = function () {[m
     // check for invalid state[m
     if (this.readyState === FileWriter.DONE || this.readyState === FileWriter.INIT) {[m
         throw new FileError(FileError.INVALID_STATE_ERR);[m
[36m@@ -80,13 +80,13 @@[m [mFileWriter.prototype.abort = function() {[m
     this.readyState = FileWriter.DONE;[m
 [m
     // If abort callback[m
[31m-    if (typeof this.onabort === "function") {[m
[31m-        this.onabort(new ProgressEvent("abort", {"target":this}));[m
[32m+[m[32m    if (typeof this.onabort === 'function') {[m
[32m+[m[32m        this.onabort(new ProgressEvent('abort', {'target': this}));[m
     }[m
 [m
     // If write end callback[m
[31m-    if (typeof this.onwriteend === "function") {[m
[31m-        this.onwriteend(new ProgressEvent("writeend", {"target":this}));[m
[32m+[m[32m    if (typeof this.onwriteend === 'function') {[m
[32m+[m[32m        this.onwriteend(new ProgressEvent('writeend', {'target': this}));[m
     }[m
 };[m
 [m
[36m@@ -96,17 +96,19 @@[m [mFileWriter.prototype.abort = function() {[m
  * @param data text or blob to be written[m
  * @param isPendingBlobReadResult {Boolean} true if the data is the pending blob read operation result[m
  */[m
[31m-FileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
[32m+[m[32mFileWriter.prototype.write = function (data, isPendingBlobReadResult) {[m
 [m
[31m-    var that=this;[m
[32m+[m[32m    var that = this;[m
     var supportsBinary = (typeof window.Blob !== 'undefined' && typeof window.ArrayBuffer !== 'undefined');[m
[31m-    var isProxySupportBlobNatively = (cordova.platformId === "windows8" || cordova.platformId === "windows");[m
[32m+[m[32m    /* eslint-disable no-undef */[m
[32m+[m[32m    var isProxySupportBlobNatively = (cordova.platformId === 'windows8' || cordova.platformId === 'windows');[m
     var isBinary;[m
 [m
     // Check to see if the incoming data is a blob[m
     if (data instanceof File || (!isProxySupportBlobNatively && supportsBinary && data instanceof Blob)) {[m
         var fileReader = new FileReader();[m
[31m-        fileReader.onload = function() {[m
[32m+[m[32m        /* eslint-enable no-undef */[m
[32m+[m[32m        fileReader.onload = function () {[m
             // Call this method again, with the arraybuffer as argument[m
             FileWriter.prototype.write.call(that, this.result, true /* isPendingBlobReadResult */);[m
         };[m
[36m@@ -118,13 +120,13 @@[m [mFileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
             that.error = this.error;[m
 [m
             // If onerror callback[m
[31m-            if (typeof that.onerror === "function") {[m
[31m-                that.onerror(new ProgressEvent("error", {"target":that}));[m
[32m+[m[32m            if (typeof that.onerror === 'function') {[m
[32m+[m[32m                that.onerror(new ProgressEvent('error', {'target': that}));[m
             }[m
 [m
             // If onwriteend callback[m
[31m-            if (typeof that.onwriteend === "function") {[m
[31m-                that.onwriteend(new ProgressEvent("writeend", {"target":that}));[m
[32m+[m[32m            if (typeof that.onwriteend === 'function') {[m
[32m+[m[32m                that.onwriteend(new ProgressEvent('writeend', {'target': that}));[m
             }[m
         };[m
 [m
[36m@@ -141,11 +143,11 @@[m [mFileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
 [m
     // Mark data type for safer transport over the binary bridge[m
     isBinary = supportsBinary && (data instanceof ArrayBuffer);[m
[31m-    if (isBinary && cordova.platformId === "windowsphone") {[m
[32m+[m[32m    if (isBinary && cordova.platformId === 'windowsphone') { // eslint-disable-line no-undef[m
         // create a plain array, using the keys from the Uint8Array view so that we can serialize it[m
         data = Array.apply(null, new Uint8Array(data));[m
     }[m
[31m-    [m
[32m+[m
     // Throw an exception if we are already writing a file[m
     if (this.readyState === FileWriter.WRITING && !isPendingBlobReadResult) {[m
         throw new FileError(FileError.INVALID_STATE_ERR);[m
[36m@@ -157,14 +159,14 @@[m [mFileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
     var me = this;[m
 [m
     // If onwritestart callback[m
[31m-    if (typeof me.onwritestart === "function") {[m
[31m-        me.onwritestart(new ProgressEvent("writestart", {"target":me}));[m
[32m+[m[32m    if (typeof me.onwritestart === 'function') {[m
[32m+[m[32m        me.onwritestart(new ProgressEvent('writestart', {'target': me}));[m
     }[m
 [m
     // Write file[m
     exec([m
         // Success callback[m
[31m-        function(r) {[m
[32m+[m[32m        function (r) {[m
             // If DONE (cancelled), then don't do anything[m
             if (me.readyState === FileWriter.DONE) {[m
                 return;[m
[36m@@ -180,17 +182,17 @@[m [mFileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
             me.readyState = FileWriter.DONE;[m
 [m
             // If onwrite callback[m
[31m-            if (typeof me.onwrite === "function") {[m
[31m-                me.onwrite(new ProgressEvent("write", {"target":me}));[m
[32m+[m[32m            if (typeof me.onwrite === 'function') {[m
[32m+[m[32m                me.onwrite(new ProgressEvent('write', {'target': me}));[m
             }[m
 [m
             // If onwriteend callback[m
[31m-            if (typeof me.onwriteend === "function") {[m
[31m-                me.onwriteend(new ProgressEvent("writeend", {"target":me}));[m
[32m+[m[32m            if (typeof me.onwriteend === 'function') {[m
[32m+[m[32m                me.onwriteend(new ProgressEvent('writeend', {'target': me}));[m
             }[m
         },[m
         // Error callback[m
[31m-        function(e) {[m
[32m+[m[32m        function (e) {[m
             // If DONE (cancelled), then don't do anything[m
             if (me.readyState === FileWriter.DONE) {[m
                 return;[m
[36m@@ -203,15 +205,15 @@[m [mFileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
             me.error = new FileError(e);[m
 [m
             // If onerror callback[m
[31m-            if (typeof me.onerror === "function") {[m
[31m-                me.onerror(new ProgressEvent("error", {"target":me}));[m
[32m+[m[32m            if (typeof me.onerror === 'function') {[m
[32m+[m[32m                me.onerror(new ProgressEvent('error', {'target': me}));[m
             }[m
 [m
             // If onwriteend callback[m
[31m-            if (typeof me.onwriteend === "function") {[m
[31m-                me.onwriteend(new ProgressEvent("writeend", {"target":me}));[m
[32m+[m[32m            if (typeof me.onwriteend === 'function') {[m
[32m+[m[32m                me.onwriteend(new ProgressEvent('writeend', {'target': me}));[m
             }[m
[31m-        }, "File", "write", [this.localURL, data, this.position, isBinary]);[m
[32m+[m[32m        }, 'File', 'write', [this.localURL, data, this.position, isBinary]);[m
 };[m
 [m
 /**[m
[36m@@ -223,7 +225,7 @@[m [mFileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
  *[m
  * @param offset is the location to move the file pointer to.[m
  */[m
[31m-FileWriter.prototype.seek = function(offset) {[m
[32m+[m[32mFileWriter.prototype.seek = function (offset) {[m
     // Throw an exception if we are already writing a file[m
     if (this.readyState === FileWriter.WRITING) {[m
         throw new FileError(FileError.INVALID_STATE_ERR);[m
[36m@@ -236,15 +238,13 @@[m [mFileWriter.prototype.seek = function(offset) {[m
     // See back from end of file.[m
     if (offset < 0) {[m
         this.position = Math.max(offset + this.length, 0);[m
[31m-    }[m
     // Offset is bigger than file size so set position[m
     // to the end of the file.[m
[31m-    else if (offset > this.length) {[m
[32m+[m[32m    } else if (offset > this.length) {[m
         this.position = this.length;[m
[31m-    }[m
     // Offset is between 0 and file size so set the position[m
     // to start writing.[m
[31m-    else {[m
[32m+[m[32m    } else {[m
         this.position = offset;[m
     }[m
 };[m
[36m@@ -254,7 +254,7 @@[m [mFileWriter.prototype.seek = function(offset) {[m
  *[m
  * @param size to chop the file at.[m
  */[m
[31m-FileWriter.prototype.truncate = function(size) {[m
[32m+[m[32mFileWriter.prototype.truncate = function (size) {[m
     // Throw an exception if we are already writing a file[m
     if (this.readyState === FileWriter.WRITING) {[m
         throw new FileError(FileError.INVALID_STATE_ERR);[m
[36m@@ -266,14 +266,14 @@[m [mFileWriter.prototype.truncate = function(size) {[m
     var me = this;[m
 [m
     // If onwritestart callback[m
[31m-    if (typeof me.onwritestart === "function") {[m
[31m-        me.onwritestart(new ProgressEvent("writestart", {"target":this}));[m
[32m+[m[32m    if (typeof me.onwritestart === 'function') {[m
[32m+[m[32m        me.onwritestart(new ProgressEvent('writestart', {'target': this}));[m
     }[m
 [m
     // Write file[m
     exec([m
         // Success callback[m
[31m-        function(r) {[m
[32m+[m[32m        function (r) {[m
             // If DONE (cancelled), then don't do anything[m
             if (me.readyState === FileWriter.DONE) {[m
                 return;[m
[36m@@ -287,17 +287,17 @@[m [mFileWriter.prototype.truncate = function(size) {[m
             me.position = Math.min(me.position, r);[m
 [m
             // If onwrite callback[m
[31m-            if (typeof me.onwrite === "function") {[m
[31m-                me.onwrite(new ProgressEvent("write", {"target":me}));[m
[32m+[m[32m            if (typeof me.onwrite === 'function') {[m
[32m+[m[32m                me.onwrite(new ProgressEvent('write', {'target': me}));[m
             }[m
 [m
             // If onwriteend callback[m
[31m-            if (typeof me.onwriteend === "function") {[m
[31m-                me.onwriteend(new ProgressEvent("writeend", {"target":me}));[m
[32m+[m[32m            if (typeof me.onwriteend === 'function') {[m
[32m+[m[32m                me.onwriteend(new ProgressEvent('writeend', {'target': me}));[m
             }[m
         },[m
         // Error callback[m
[31m-        function(e) {[m
[32m+[m[32m        function (e) {[m
             // If DONE (cancelled), then don't do anything[m
             if (me.readyState === FileWriter.DONE) {[m
                 return;[m
[36m@@ -310,15 +310,15 @@[m [mFileWriter.prototype.truncate = function(size) {[m
             me.error = new FileError(e);[m
 [m
             // If onerror callback[m
[31m-            if (typeof me.onerror === "function") {[m
[31m-                me.onerror(new ProgressEvent("error", {"target":me}));[m
[32m+[m[32m            if (typeof me.onerror === 'function') {[m
[32m+[m[32m                me.onerror(new ProgressEvent('error', {'target': me}));[m
             }[m
 [m
             // If onwriteend callback[m
[31m-            if (typeof me.onwriteend === "function") {[m
[31m-                me.onwriteend(new ProgressEvent("writeend", {"target":me}));[m
[32m+[m[32m            if (typeof me.onwriteend === 'function') {[m
[32m+[m[32m                me.onwriteend(new ProgressEvent('writeend', {'target': me}));[m
             }[m
[31m-        }, "File", "truncate", [this.localURL, size]);[m
[32m+[m[32m        }, 'File', 'truncate', [this.localURL, size]);[m
 };[m
 [m
 module.exports = FileWriter;[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/Flags.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/Flags.js[m
[1mindex dfac709..f51db30 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/Flags.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/Flags.js[m
[36m@@ -28,7 +28,7 @@[m [mcordova.define("cordova-plugin-file.Flags", function(require, exports, module) {[m
  *            {boolean} used with create; if true the command will fail if[m
  *            target path exists[m
  */[m
[31m-function Flags(create, exclusive) {[m
[32m+[m[32mfunction Flags (create, exclusive) {[m
     this.create = create || false;[m
     this.exclusive = exclusive || false;[m
 }[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/Metadata.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/Metadata.js[m
[1mindex efa4b3e..5550f8a 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/Metadata.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/Metadata.js[m
[36m@@ -24,11 +24,11 @@[m [mcordova.define("cordova-plugin-file.Metadata", function(require, exports, module[m
  *[m
  * {Date} modificationTime (readonly)[m
  */[m
[31m-var Metadata = function(metadata) {[m
[31m-    if (typeof metadata == "object") {[m
[32m+[m[32mvar Metadata = function (metadata) {[m
[32m+[m[32m    if (typeof metadata === 'object') {[m
         this.modificationTime = new Date(metadata.modificationTime);[m
         this.size = metadata.size || 0;[m
[31m-    } else if (typeof metadata == "undefined") {[m
[32m+[m[32m    } else if (typeof metadata === 'undefined') {[m
         this.modificationTime = null;[m
         this.size = 0;[m
     } else {[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/ProgressEvent.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/ProgressEvent.js[m
[1mindex 0086f02..0315adf 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/ProgressEvent.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/ProgressEvent.js[m
[36m@@ -25,7 +25,7 @@[m [mcordova.define("cordova-plugin-file.ProgressEvent", function(require, exports, m[m
 // otherwise fill-in with our own implementation.[m
 //[m
 // NOTE: right now we always fill in with our own. Down the road would be nice if we can use whatever is native in the webview.[m
[31m-var ProgressEvent = (function() {[m
[32m+[m[32mvar ProgressEvent = (function () {[m
     /*[m
     var createEvent = function(data) {[m
         var event = document.createEvent('Events');[m
[36m@@ -51,17 +51,17 @@[m [mvar ProgressEvent = (function() {[m
         };[m
     } catch(e){[m
     */[m
[31m-        return function ProgressEvent(type, dict) {[m
[31m-            this.type = type;[m
[31m-            this.bubbles = false;[m
[31m-            this.cancelBubble = false;[m
[31m-            this.cancelable = false;[m
[31m-            this.lengthComputable = false;[m
[31m-            this.loaded = dict && dict.loaded ? dict.loaded : 0;[m
[31m-            this.total = dict && dict.total ? dict.total : 0;[m
[31m-            this.target = dict && dict.target ? dict.target : null;[m
[31m-        };[m
[31m-    //}[m
[32m+[m[32m    return function ProgressEvent (type, dict) {[m
[32m+[m[32m        this.type = type;[m
[32m+[m[32m        this.bubbles = false;[m
[32m+[m[32m        this.cancelBubble = false;[m
[32m+[m[32m        this.cancelable = false;[m
[32m+[m[32m        this.lengthComputable = false;[m
[32m+[m[32m        this.loaded = dict && dict.loaded ? dict.loaded : 0;[m
[32m+[m[32m        this.total = dict && dict.total ? dict.total : 0;[m
[32m+[m[32m        this.target = dict && dict.target ? dict.target : null;[m
[32m+[m[32m    };[m
[32m+[m[32m    // }[m
 })();[m
 [m
 module.exports = ProgressEvent;[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/browser/FileSystem.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/browser/FileSystem.js[m
[1mindex adcc800..0f49c2c 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/browser/FileSystem.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/browser/FileSystem.js[m
[36m@@ -19,15 +19,14 @@[m [mcordova.define("cordova-plugin-file.firefoxFileSystem", function(require, export[m
  *[m
 */[m
 [m
[31m-/*global FILESYSTEM_PREFIX: true, module*/[m
[32m+[m[32m/* global FILESYSTEM_PREFIX: true, module */[m
 [m
[31m-FILESYSTEM_PREFIX = "file:///";[m
[32m+[m[32mFILESYSTEM_PREFIX = 'file:///';[m
 [m
 module.exports = {[m
[31m-    __format__: function(fullPath) {[m
[31m-        return (FILESYSTEM_PREFIX + this.name + (fullPath[0] === '/' ? '' : '/') + FileSystem.encodeURIPath(fullPath));[m
[32m+[m[32m    __format__: function (fullPath) {[m
[32m+[m[32m        return (FILESYSTEM_PREFIX + this.name + (fullPath[0] === '/' ? '' : '/') + FileSystem.encodeURIPath(fullPath)); // eslint-disable-line no-undef[m
     }[m
 };[m
 [m
[31m-[m
 });[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/browser/Preparing.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/browser/Preparing.js[m
[1mindex d7d1775..24ea404 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/browser/Preparing.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/browser/Preparing.js[m
[36m@@ -20,9 +20,9 @@[m [mcordova.define("cordova-plugin-file.Preparing", function(require, exports, modul[m
 */[m
 [m
 (function () {[m
[31m-    /*global require*/[m
[32m+[m[32m    /* global require */[m
 [m
[31m-    //Only Chrome uses this file.[m
[32m+[m[32m    // Only Chrome uses this file.[m
     if (!require('./isChrome')()) {[m
         return;[m
     }[m
[36m@@ -30,26 +30,26 @@[m [mcordova.define("cordova-plugin-file.Preparing", function(require, exports, modul[m
     var channel = require('cordova/channel');[m
     var FileError = require('./FileError');[m
     var PERSISTENT_FS_QUOTA = 5 * 1024 * 1024;[m
[31m-    var filePluginIsReadyEvent = new Event('filePluginIsReady');[m
[32m+[m[32m    var filePluginIsReadyEvent = new Event('filePluginIsReady'); // eslint-disable-line no-undef[m
 [m
     var entryFunctionsCreated = false;[m
     var quotaWasRequested = false;[m
     var eventWasThrown = false;[m
 [m
     if (!window.requestFileSystem) {[m
[31m-        window.requestFileSystem = function(type, size, win, fail) {[m
[32m+[m[32m        window.requestFileSystem = function (type, size, win, fail) {[m
             if (fail) {[m
[31m-                fail("Not supported");[m
[32m+[m[32m                fail('Not supported');[m
             }[m
         };[m
     } else {[m
[31m-        window.requestFileSystem(window.TEMPORARY, 1, createFileEntryFunctions, function() {});[m
[32m+[m[32m        window.requestFileSystem(window.TEMPORARY, 1, createFileEntryFunctions, function () {});[m
     }[m
 [m
     if (!window.resolveLocalFileSystemURL) {[m
[31m-        window.resolveLocalFileSystemURL = function(url, win, fail) {[m
[31m-            if(fail) {[m
[31m-                fail("Not supported");[m
[32m+[m[32m        window.resolveLocalFileSystemURL = function (url, win, fail) {[m
[32m+[m[32m            if (fail) {[m
[32m+[m[32m                fail('Not supported');[m
             }[m
         };[m
     }[m
[36m@@ -58,14 +58,14 @@[m [mcordova.define("cordova-plugin-file.Preparing", function(require, exports, modul[m
     // Cordova-specific (cdvfile://) universal way.[m
     // Aligns with specification: http://www.w3.org/TR/2011/WD-file-system-api-20110419/#widl-LocalFileSystem-resolveLocalFileSystemURL[m
     var nativeResolveLocalFileSystemURL = window.resolveLocalFileSystemURL || window.webkitResolveLocalFileSystemURL;[m
[31m-    window.resolveLocalFileSystemURL = function(url, win, fail) {[m
[32m+[m[32m    window.resolveLocalFileSystemURL = function (url, win, fail) {[m
         /* If url starts with `cdvfile` then we need convert it to Chrome real url first:[m
           cdvfile://localhost/persistent/path/to/file -> filesystem:file://persistent/path/to/file */[m
[31m-        if (url.trim().substr(0,7) === "cdvfile") {[m
[32m+[m[32m        if (url.trim().substr(0, 7) === 'cdvfile') {[m
             /* Quirk:[m
             Plugin supports cdvfile://localhost (local resources) only.[m
             I.e. external resources are not supported via cdvfile. */[m
[31m-            if (url.indexOf("cdvfile://localhost") !== -1) {[m
[32m+[m[32m            if (url.indexOf('cdvfile://localhost') !== -1) {[m
                 // Browser supports temporary and persistent only[m
                 var indexPersistent = url.indexOf('persistent');[m
                 var indexTemporary = url.indexOf('temporary');[m
[36m@@ -75,15 +75,15 @@[m [mcordova.define("cordova-plugin-file.Preparing", function(require, exports, modul[m
                    For example, filesystem:file:///persistent/somefile.txt,[m
                    filesystem:http://localhost:8080/persistent/somefile.txt. */[m
                 var prefix = 'filesystem:file:///';[m
[31m-                if (location.protocol !== 'file:') {[m
[31m-                    prefix = 'filesystem:' + location.origin + '/';[m
[32m+[m[32m                if (location.protocol !== 'file:') { // eslint-disable-line no-undef[m
[32m+[m[32m                    prefix = 'filesystem:' + location.origin + '/'; // eslint-disable-line no-undef[m
                 }[m
 [m
                 var result;[m
                 if (indexPersistent !== -1) {[m
                     // cdvfile://localhost/persistent/path/to/file -> filesystem:file://persistent/path/to/file[m
                     // or filesystem:http://localhost:8080/persistent/path/to/file[m
[31m-                    result =  prefix + 'persistent' + url.substr(indexPersistent + 10);[m
[32m+[m[32m                    result = prefix + 'persistent' + url.substr(indexPersistent + 10);[m
                     nativeResolveLocalFileSystemURL(result, win, fail);[m
                     return;[m
                 }[m
[36m@@ -106,8 +106,8 @@[m [mcordova.define("cordova-plugin-file.Preparing", function(require, exports, modul[m
         }[m
     };[m
 [m
[31m-    function createFileEntryFunctions(fs) {[m
[31m-        fs.root.getFile('todelete_658674_833_4_cdv', {create: true}, function(fileEntry) {[m
[32m+[m[32m    function createFileEntryFunctions (fs) {[m
[32m+[m[32m        fs.root.getFile('todelete_658674_833_4_cdv', {create: true}, function (fileEntry) {[m
             var fileEntryType = Object.getPrototypeOf(fileEntry);[m
             var entryType = Object.getPrototypeOf(fileEntryType);[m
 [m
[36m@@ -126,59 +126,59 @@[m [mcordova.define("cordova-plugin-file.Preparing", function(require, exports, modul[m
                 return this.toURL();[m
             };[m
 [m
[31m-            entryType.toInternalURL = function() {[m
[31m-                if (this.toURL().indexOf("persistent") > -1) {[m
[31m-                    return "cdvfile://localhost/persistent" + this.fullPath;[m
[32m+[m[32m            entryType.toInternalURL = function () {[m
[32m+[m[32m                if (this.toURL().indexOf('persistent') > -1) {[m
[32m+[m[32m                    return 'cdvfile://localhost/persistent' + this.fullPath;[m
                 }[m
 [m
[31m-                if (this.toURL().indexOf("temporary") > -1) {[m
[31m-                    return "cdvfile://localhost/temporary" + this.fullPath;[m
[32m+[m[32m                if (this.toURL().indexOf('temporary') > -1) {[m
[32m+[m[32m                    return 'cdvfile://localhost/temporary' + this.fullPath;[m
                 }[m
             };[m
 [m
[31m-            entryType.setMetadata = function(win, fail /*, metadata*/) {[m
[32m+[m[32m            entryType.setMetadata = function (win, fail /*, metadata */) {[m
                 if (fail) {[m
[31m-                    fail("Not supported");[m
[32m+[m[32m                    fail('Not supported');[m
                 }[m
             };[m
 [m
[31m-            fileEntry.createWriter(function(writer) {[m
[32m+[m[32m            fileEntry.createWriter(function (writer) {[m
                 var originalWrite = writer.write;[m
                 var writerProto = Object.getPrototypeOf(writer);[m
[31m-                writerProto.write = function(blob) {[m
[31m-                    if(blob instanceof Blob) {[m
[32m+[m[32m                writerProto.write = function (blob) {[m
[32m+[m[32m                    if (blob instanceof Blob) { // eslint-disable-line no-undef[m
                         originalWrite.apply(this, [blob]);[m
                     } else {[m
[31m-                        var realBlob = new Blob([blob]);[m
[32m+[m[32m                        var realBlob = new Blob([blob]); // eslint-disable-line no-undef[m
                         originalWrite.apply(this, [realBlob]);[m
[31m-                   }[m
[32m+[m[32m                    }[m
                 };[m
 [m
[31m-                fileEntry.remove(function(){ entryFunctionsCreated = true; }, function(){ /* empty callback */ });[m
[31m-          });[m
[32m+[m[32m                fileEntry.remove(function () { entryFunctionsCreated = true; }, function () { /* empty callback */ });[m
[32m+[m[32m            });[m
         });[m
     }[m
 [m
[31m-    window.initPersistentFileSystem = function(size, win, fail) {[m
[32m+[m[32m    window.initPersistentFileSystem = function (size, win, fail) {[m
         if (navigator.webkitPersistentStorage) {[m
             navigator.webkitPersistentStorage.requestQuota(size, win, fail);[m
             return;[m
         }[m
 [m
[31m-        fail("This browser does not support this function");[m
[32m+[m[32m        fail('This browser does not support this function');[m
     };[m
 [m
     window.isFilePluginReadyRaised = function () { return eventWasThrown; };[m
 [m
[31m-    window.initPersistentFileSystem(PERSISTENT_FS_QUOTA, function() {[m
[32m+[m[32m    window.initPersistentFileSystem(PERSISTENT_FS_QUOTA, function () {[m
         console.log('Persistent fs quota granted');[m
         quotaWasRequested = true;[m
[31m-    }, function(e){[m
[32m+[m[32m    }, function (e) {[m
         console.log('Error occured while trying to request Persistent fs quota: ' + JSON.stringify(e));[m
     });[m
 [m
     channel.onCordovaReady.subscribe(function () {[m
[31m-        function dispatchEventIfReady() {[m
[32m+[m[32m        function dispatchEventIfReady () {[m
             if (entryFunctionsCreated && quotaWasRequested) {[m
                 window.dispatchEvent(filePluginIsReadyEvent);[m
                 eventWasThrown = true;[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/fileSystemPaths.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/fileSystemPaths.js[m
[1mindex dd2ddbc..be7278f 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/fileSystemPaths.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/fileSystemPaths.js[m
[36m@@ -51,8 +51,8 @@[m [mexports.file = {[m
 };[m
 [m
 channel.waitForInitialization('onFileSystemPathsReady');[m
[31m-channel.onCordovaReady.subscribe(function() {[m
[31m-    function after(paths) {[m
[32m+[m[32mchannel.onCordovaReady.subscribe(function () {[m
[32m+[m[32m    function after (paths) {[m
         for (var k in paths) {[m
             exports.file[k] = paths[k];[m
         }[m
[36m@@ -61,5 +61,4 @@[m [mchannel.onCordovaReady.subscribe(function() {[m
     exec(after, null, 'File', 'requestAllPaths', []);[m
 });[m
 [m
[31m-[m
 });[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/fileSystems.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/fileSystems.js[m
[1mindex 2b8084b..99b38f6 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/fileSystems.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/fileSystems.js[m
[36m@@ -20,7 +20,7 @@[m [mcordova.define("cordova-plugin-file.fileSystems", function(require, exports, mod[m
 */[m
 [m
 // Overridden by Android, BlackBerry 10 and iOS to populate fsMap.[m
[31m-module.exports.getFs = function(name, callback) {[m
[32m+[m[32mmodule.exports.getFs = function (name, callback) {[m
     callback(null);[m
 };[m
 [m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/requestFileSystem.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/requestFileSystem.js[m
[1mindex 49e7897..e182354 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/requestFileSystem.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/requestFileSystem.js[m
[36m@@ -19,10 +19,10 @@[m [mcordova.define("cordova-plugin-file.requestFileSystem", function(require, export[m
  *[m
 */[m
 [m
[31m-(function() {[m
[31m-    //For browser platform: not all browsers use this file.[m
[31m-    function checkBrowser() {[m
[31m-        if (cordova.platformId === "browser" && require('./isChrome')()) {[m
[32m+[m[32m(function () {[m
[32m+[m[32m    // For browser platform: not all browsers use this file.[m
[32m+[m[32m    function checkBrowser () {[m
[32m+[m[32m        if (cordova.platformId === 'browser' && require('./isChrome')()) { // eslint-disable-line no-undef[m
             module.exports = window.requestFileSystem || window.webkitRequestFileSystem;[m
             return true;[m
         }[m
[36m@@ -32,10 +32,10 @@[m [mcordova.define("cordova-plugin-file.requestFileSystem", function(require, export[m
         return;[m
     }[m
 [m
[31m-    var argscheck = require('cordova/argscheck'),[m
[31m-        FileError = require('./FileError'),[m
[31m-        FileSystem = require('./FileSystem'),[m
[31m-        exec = require('cordova/exec');[m
[32m+[m[32m    var argscheck = require('cordova/argscheck');[m
[32m+[m[32m    var FileError = require('./FileError');[m
[32m+[m[32m    var FileSystem = require('./FileSystem');[m
[32m+[m[32m    var exec = require('cordova/exec');[m
     var fileSystems = require('./fileSystems');[m
 [m
     /**[m
[36m@@ -45,9 +45,9 @@[m [mcordova.define("cordova-plugin-file.requestFileSystem", function(require, export[m
      * @param successCallback  invoked with a FileSystem object[m
      * @param errorCallback  invoked if error occurs retrieving file system[m
      */[m
[31m-    var requestFileSystem = function(type, size, successCallback, errorCallback) {[m
[32m+[m[32m    var requestFileSystem = function (type, size, successCallback, errorCallback) {[m
         argscheck.checkArgs('nnFF', 'requestFileSystem', arguments);[m
[31m-        var fail = function(code) {[m
[32m+[m[32m        var fail = function (code) {[m
             if (errorCallback) {[m
                 errorCallback(new FileError(code));[m
             }[m
[36m@@ -57,10 +57,10 @@[m [mcordova.define("cordova-plugin-file.requestFileSystem", function(require, export[m
             fail(FileError.SYNTAX_ERR);[m
         } else {[m
             // if successful, return a FileSystem object[m
[31m-            var success = function(file_system) {[m
[32m+[m[32m            var success = function (file_system) {[m
                 if (file_system) {[m
                     if (successCallback) {[m
[31m-                        fileSystems.getFs(file_system.name, function(fs) {[m
[32m+[m[32m                        fileSystems.getFs(file_system.name, function (fs) {[m
                             // This should happen only on platforms that haven't implemented requestAllFileSystems (windows)[m
                             if (!fs) {[m
                                 fs = new FileSystem(file_system.name, file_system.root);[m
[36m@@ -68,13 +68,12 @@[m [mcordova.define("cordova-plugin-file.requestFileSystem", function(require, export[m
                             successCallback(fs);[m
                         });[m
                     }[m
[31m-                }[m
[31m-                else {[m
[32m+[m[32m                } else {[m
                     // no FileSystem object returned[m
                     fail(FileError.NOT_FOUND_ERR);[m
                 }[m
             };[m
[31m-            exec(success, fail, "File", "requestFileSystem", [type, size]);[m
[32m+[m[32m            exec(success, fail, 'File', 'requestFileSystem', [type, size]);[m
         }[m
     };[m
 [m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/resolveLocalFileSystemURI.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/resolveLocalFileSystemURI.js[m
[1mindex 98fd0e4..659d417 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/resolveLocalFileSystemURI.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-file/www/resolveLocalFileSystemURI.js[m
[36m@@ -18,10 +18,10 @@[m [mcordova.define("cordova-plugin-file.resolveLocalFileSystemURI", function(require[m
  * under the License.[m
  *[m
 */[m
[31m-(function() {[m
[31m-    //For browser platform: not all browsers use overrided `resolveLocalFileSystemURL`.[m
[31m-    function checkBrowser() {[m
[31m-        if (cordova.platformId === "browser" && require('./isChrome')()) {[m
[32m+[m[32m(function () {[m
[32m+[m[32m    // For browser platform: not all browsers use overrided `resolveLocalFileSystemURL`.[m
[32m+[m[32m    function checkBrowser () {[m
[32m+[m[32m        if (cordova.platformId === 'browser' && require('./isChrome')()) { // eslint-disable-line no-undef[m
             module.exports.resolveLocalFileSystemURL = window.resolveLocalFileSystemURL || window.webkitResolveLocalFileSystemURL;[m
             return true;[m
         }[m
[36m@@ -31,11 +31,11 @@[m [mcordova.define("cordova-plugin-file.resolveLocalFileSystemURI", function(require[m
         return;[m
     }[m
 [m
[31m-    var argscheck = require('cordova/argscheck'),[m
[31m-        DirectoryEntry = require('./DirectoryEntry'),[m
[31m-        FileEntry = require('./FileEntry'),[m
[31m-        FileError = require('./FileError'),[m
[31m-        exec = require('cordova/exec');[m
[32m+[m[32m    var argscheck = require('cordova/argscheck');[m
[32m+[m[32m    var DirectoryEntry = require('./DirectoryEntry');[m
[32m+[m[32m    var FileEntry = require('./FileEntry');[m
[32m+[m[32m    var FileError = require('./FileError');[m
[32m+[m[32m    var exec = require('cordova/exec');[m
     var fileSystems = require('./fileSystems');[m
 [m
     /**[m
[36m@@ -44,49 +44,48 @@[m [mcordova.define("cordova-plugin-file.resolveLocalFileSystemURI", function(require[m
      * @param successCallback  invoked with Entry object corresponding to URI[m
      * @param errorCallback    invoked if error occurs retrieving file system entry[m
      */[m
[31m-    module.exports.resolveLocalFileSystemURL = module.exports.resolveLocalFileSystemURL || function(uri, successCallback, errorCallback) {[m
[32m+[m[32m    module.exports.resolveLocalFileSystemURL = module.exports.resolveLocalFileSystemURL || function (uri, successCallback, errorCallback) {[m
         argscheck.checkArgs('sFF', 'resolveLocalFileSystemURI', arguments);[m
         // error callback[m
[31m-        var fail = function(error) {[m
[32m+[m[32m        var fail = function (error) {[m
             if (errorCallback) {[m
                 errorCallback(new FileError(error));[m
             }[m
         };[m
         // sanity check for 'not:valid:filename' or '/not:valid:filename'[m
         // file.spec.12 window.resolveLocalFileSystemURI should error (ENCODING_ERR) when resolving invalid URI with leading /.[m
[31m-        if(!uri || uri.split(":").length > 2) {[m
[31m-            setTimeout( function() {[m
[32m+[m[32m        if (!uri || uri.split(':').length > 2) {[m
[32m+[m[32m            setTimeout(function () {[m
                 fail(FileError.ENCODING_ERR);[m
[31m-            },0);[m
[32m+[m[32m            }, 0);[m
             return;[m
         }[m
         // if successful, return either a file or directory entry[m
[31m-        var success = function(entry) {[m
[32m+[m[32m        var success = function (entry) {[m
             if (entry) {[m
                 if (successCallback) {[m
                     // create appropriate Entry object[m
[31m-                    var fsName = entry.filesystemName || (entry.filesystem && entry.filesystem.name) || (entry.filesystem == window.PERSISTENT ? 'persistent' : 'temporary');[m
[31m-                    fileSystems.getFs(fsName, function(fs) {[m
[32m+[m[32m                    var fsName = entry.filesystemName || (entry.filesystem && entry.filesystem.name) || (entry.filesystem === window.PERSISTENT ? 'persistent' : 'temporary'); // eslint-disable-line no-undef[m
[32m+[m[32m                    fileSystems.getFs(fsName, function (fs) {[m
                         // This should happen only on platforms that haven't implemented requestAllFileSystems (windows)[m
                         if (!fs) {[m
[31m-                            fs = new FileSystem(fsName, {name:"", fullPath:"/"});[m
[32m+[m[32m                            fs = new FileSystem(fsName, {name: '', fullPath: '/'}); // eslint-disable-line no-undef[m
                         }[m
                         var result = (entry.isDirectory) ? new DirectoryEntry(entry.name, entry.fullPath, fs, entry.nativeURL) : new FileEntry(entry.name, entry.fullPath, fs, entry.nativeURL);[m
                         successCallback(result);[m
                     });[m
                 }[m
[31m-            }[m
[31m-            else {[m
[32m+[m[32m            } else {[m
                 // no Entry object returned[m
                 fail(FileError.NOT_FOUND_ERR);[m
             }[m
         };[m
 [m
[31m-        exec(success, fail, "File", "resolveLocalFileSystemURI", [uri]);[m
[32m+[m[32m        exec(success, fail, 'File', 'resolveLocalFileSystemURI', [uri]);[m
     };[m
 [m
[31m-    module.exports.resolveLocalFileSystemURI = function() {[m
[31m-        console.log("resolveLocalFileSystemURI is deprecated. Please call resolveLocalFileSystemURL instead.");[m
[32m+[m[32m    module.exports.resolveLocalFileSystemURI = function () {[m
[32m+[m[32m        console.log('resolveLocalFileSystemURI is deprecated. Please call resolveLocalFileSystemURL instead.');[m
         module.exports.resolveLocalFileSystemURL.apply(this, arguments);[m
     };[m
 })();[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-inappbrowser/src/browser/InAppBrowserProxy.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-inappbrowser/src/browser/InAppBrowserProxy.js[m
[1mindex b4c112b..86e120f 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-inappbrowser/src/browser/InAppBrowserProxy.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-inappbrowser/src/browser/InAppBrowserProxy.js[m
[36m@@ -29,27 +29,43 @@[m [mvar browserWrap,[m
     forwardButton,[m
     closeButton;[m
 [m
[31m-function attachNavigationEvents(element, callback) {[m
[32m+[m[32mfunction attachNavigationEvents (element, callback) {[m
     var onError = function () {[m
[31m-        callback({ type: "loaderror", url: this.contentWindow.location}, {keepCallback: true});[m
[32m+[m[32m        try {[m
[32m+[m[32m            callback({ type: 'loaderror', url: this.contentWindow.location.href }, {keepCallback: true}); // eslint-disable-line standard/no-callback-literal[m
[32m+[m[32m        } catch (err) {[m
[32m+[m[32m            // blocked by CORS :\[m
[32m+[m[32m            callback({ type: 'loaderror', url: null }, {keepCallback: true}); // eslint-disable-line standard/no-callback-literal[m
[32m+[m[32m        }[m
     };[m
 [m
[31m-    element.addEventListener("pageshow", function () {[m
[31m-        callback({ type: "loadstart", url: this.contentWindow.location}, {keepCallback: true});[m
[32m+[m[32m    element.addEventListener('pageshow', function () {[m
[32m+[m[32m        try {[m
[32m+[m[32m            callback({ type: 'loadstart', url: this.contentWindow.location.href }, {keepCallback: true}); // eslint-disable-line standard/no-callback-literal[m
[32m+[m[32m        } catch (err) {[m
[32m+[m[32m            // blocked by CORS :\[m
[32m+[m[32m            callback({ type: 'loadstart', url: null }, {keepCallback: true}); // eslint-disable-line standard/no-callback-literal[m
[32m+[m[32m        }[m
     });[m
 [m
[31m-    element.addEventListener("load", function () {[m
[31m-        callback({ type: "loadstop", url: this.contentWindow.location}, {keepCallback: true});[m
[32m+[m[32m    element.addEventListener('load', function () {[m
[32m+[m[32m        try {[m
[32m+[m[32m            callback({ type: 'loadstop', url: this.contentWindow.location.href }, {keepCallback: true}); // eslint-disable-line standard/no-callback-literal[m
[32m+[m[32m        } catch (err) {[m
[32m+[m[32m            // blocked by CORS :\[m
[32m+[m[32m            callback({ type: 'loadstop', url: null }, {keepCallback: true}); // eslint-disable-line standard/no-callback-literal[m
[32m+[m[32m        }[m
     });[m
 [m
[31m-    element.addEventListener("error", onError);[m
[31m-    element.addEventListener("abort", onError);[m
[32m+[m[32m    element.addEventListener('error', onError);[m
[32m+[m[32m    element.addEventListener('abort', onError);[m
 }[m
 [m
 var IAB = {[m
     close: function (win, lose) {[m
         if (browserWrap) {[m
[31m-            if (win) win({ type: "exit" });[m
[32m+[m[32m            // use the "open" function callback so that the exit event is fired properly[m
[32m+[m[32m            if (IAB._win) IAB._win({ type: 'exit' });[m
 [m
             browserWrap.parentNode.removeChild(browserWrap);[m
             browserWrap = null;[m
[36m@@ -59,109 +75,108 @@[m [mvar IAB = {[m
 [m
     show: function (win, lose) {[m
         if (browserWrap) {[m
[31m-            browserWrap.style.display = "block";[m
[32m+[m[32m            browserWrap.style.display = 'block';[m
         }[m
     },[m
 [m
     open: function (win, lose, args) {[m
[31m-        var strUrl = args[0],[m
[31m-            target = args[1],[m
[31m-            features = args[2];[m
[32m+[m[32m        var strUrl = args[0];[m
[32m+[m[32m        var target = args[1];[m
[32m+[m[32m        var features = args[2];[m
 [m
[31m-        if (target === "_self" || !target) {[m
[32m+[m[32m        IAB._win = win;[m
[32m+[m
[32m+[m[32m        if (target === '_self' || !target) {[m
             window.location = strUrl;[m
[31m-        } else if (target === "_system") {[m
[31m-            modulemapper.getOriginalSymbol(window, 'window.open').call(window, strUrl, "_blank");[m
[32m+[m[32m        } else if (target === '_system') {[m
[32m+[m[32m            modulemapper.getOriginalSymbol(window, 'window.open').call(window, strUrl, '_blank');[m
         } else {[m
             // "_blank" or anything else[m
             if (!browserWrap) {[m
[31m-                browserWrap = document.createElement("div");[m
[31m-                browserWrap.style.position = "absolute";[m
[31m-                browserWrap.style.top = "0";[m
[31m-                browserWrap.style.left = "0";[m
[31m-                browserWrap.style.boxSizing = "border-box";[m
[31m-                browserWrap.style.borderWidth = "40px";[m
[31m-                browserWrap.style.width = "100vw";[m
[31m-                browserWrap.style.height = "100vh";[m
[31m-                browserWrap.style.borderStyle = "solid";[m
[31m-                browserWrap.style.borderColor = "rgba(0,0,0,0.25)";[m
[32m+[m[32m                browserWrap = document.createElement('div');[m
[32m+[m[32m                browserWrap.style.position = 'absolute';[m
[32m+[m[32m                browserWrap.style.top = '0';[m
[32m+[m[32m                browserWrap.style.left = '0';[m
[32m+[m[32m                browserWrap.style.boxSizing = 'border-box';[m
[32m+[m[32m                browserWrap.style.borderWidth = '40px';[m
[32m+[m[32m                browserWrap.style.width = '100vw';[m
[32m+[m[32m                browserWrap.style.height = '100vh';[m
[32m+[m[32m                browserWrap.style.borderStyle = 'solid';[m
[32m+[m[32m                browserWrap.style.borderColor = 'rgba(0,0,0,0.25)';[m
 [m
                 browserWrap.onclick = function () {[m
                     setTimeout(function () {[m
[31m-                        IAB.close(win);[m
[32m+[m[32m                        IAB.close();[m
                     }, 0);[m
                 };[m
 [m
                 document.body.appendChild(browserWrap);[m
             }[m
 [m
[31m-            if (features.indexOf("hidden=yes") !== -1) {[m
[31m-                browserWrap.style.display = "none";[m
[32m+[m[32m            if (features.indexOf('hidden=yes') !== -1) {[m
[32m+[m[32m                browserWrap.style.display = 'none';[m
             }[m
 [m
[31m-            popup = document.createElement("iframe");[m
[31m-            popup.style.borderWidth = "0px";[m
[31m-            popup.style.width = "100%";[m
[32m+[m[32m            popup = document.createElement('iframe');[m
[32m+[m[32m            popup.style.borderWidth = '0px';[m
[32m+[m[32m            popup.style.width = '100%';[m
 [m
             browserWrap.appendChild(popup);[m
 [m
[31m-            if (features.indexOf("location=yes") !== -1 || features.indexOf("location") === -1) {[m
[31m-                popup.style.height = "calc(100% - 60px)";[m
[31m-                popup.style.marginBottom = "-4px";[m
[32m+[m[32m            if (features.indexOf('location=yes') !== -1 || features.indexOf('location') === -1) {[m
[32m+[m[32m                popup.style.height = 'calc(100% - 60px)';[m
[32m+[m[32m                popup.style.marginBottom = '-4px';[m
 [m
[31m-                navigationButtonsDiv = document.createElement("div");[m
[31m-                navigationButtonsDiv.style.height = "60px";[m
[31m-                navigationButtonsDiv.style.backgroundColor = "#404040";[m
[31m-                navigationButtonsDiv.style.zIndex = "999";[m
[32m+[m[32m                navigationButtonsDiv = document.createElement('div');[m
[32m+[m[32m                navigationButtonsDiv.style.height = '60px';[m
[32m+[m[32m                navigationButtonsDiv.style.backgroundColor = '#404040';[m
[32m+[m[32m                navigationButtonsDiv.style.zIndex = '999';[m
                 navigationButtonsDiv.onclick = function (e) {[m
                     e.cancelBubble = true;[m
                 };[m
 [m
[31m-                navigationButtonsDivInner = document.createElement("div");[m
[31m-                navigationButtonsDivInner.style.paddingTop = "10px";[m
[31m-                navigationButtonsDivInner.style.height = "50px";[m
[31m-                navigationButtonsDivInner.style.width = "160px";[m
[31m-                navigationButtonsDivInner.style.margin = "0 auto";[m
[31m-                navigationButtonsDivInner.style.backgroundColor = "#404040";[m
[31m-                navigationButtonsDivInner.style.zIndex = "999";[m
[32m+[m[32m                navigationButtonsDivInner = document.createElement('div');[m
[32m+[m[32m                navigationButtonsDivInner.style.paddingTop = '10px';[m
[32m+[m[32m                navigationButtonsDivInner.style.height = '50px';[m
[32m+[m[32m                navigationButtonsDivInner.style.width = '160px';[m
[32m+[m[32m                navigationButtonsDivInner.style.margin = '0 auto';[m
[32m+[m[32m                navigationButtonsDivInner.style.backgroundColor = '#404040';[m
[32m+[m[32m                navigationButtonsDivInner.style.zIndex = '999';[m
                 navigationButtonsDivInner.onclick = function (e) {[m
                     e.cancelBubble = true;[m
                 };[m
 [m
[32m+[m[32m                backButton = document.createElement('button');[m
[32m+[m[32m                backButton.style.width = '40px';[m
[32m+[m[32m                backButton.style.height = '40px';[m
[32m+[m[32m                backButton.style.borderRadius = '40px';[m
 [m
[31m-                backButton = document.createElement("button");[m
[31m-                backButton.style.width = "40px";[m
[31m-                backButton.style.height = "40px";[m
[31m-                backButton.style.borderRadius = "40px";[m
[31m-[m
[31m-                backButton.innerHTML = "←";[m
[31m-                backButton.addEventListener("click", function (e) {[m
[31m-                    if (popup.canGoBack)[m
[31m-                        popup.goBack();[m
[32m+[m[32m                backButton.innerHTML = '←';[m
[32m+[m[32m                backButton.addEventListener('click', function (e) {[m
[32m+[m[32m                    if (popup.canGoBack) { popup.goBack(); }[m
                 });[m
 [m
[31m-                forwardButton = document.createElement("button");[m
[31m-                forwardButton.style.marginLeft = "20px";[m
[31m-                forwardButton.style.width = "40px";[m
[31m-                forwardButton.style.height = "40px";[m
[31m-                forwardButton.style.borderRadius = "40px";[m
[32m+[m[32m                forwardButton = document.createElement('button');[m
[32m+[m[32m                forwardButton.style.marginLeft = '20px';[m
[32m+[m[32m                forwardButton.style.width = '40px';[m
[32m+[m[32m                forwardButton.style.height = '40px';[m
[32m+[m[32m                forwardButton.style.borderRadius = '40px';[m
 [m
[31m-                forwardButton.innerHTML = "→";[m
[31m-                forwardButton.addEventListener("click", function (e) {[m
[31m-                    if (popup.canGoForward)[m
[31m-                        popup.goForward();[m
[32m+[m[32m                forwardButton.innerHTML = '→';[m
[32m+[m[32m                forwardButton.addEventListener('click', function (e) {[m
[32m+[m[32m                    if (popup.canGoForward) { popup.goForward(); }[m
                 });[m
 [m
[31m-                closeButton = document.createElement("button");[m
[31m-                closeButton.style.marginLeft = "20px";[m
[31m-                closeButton.style.width = "40px";[m
[31m-                closeButton.style.height = "40px";[m
[31m-                closeButton.style.borderRadius = "40px";[m
[32m+[m[32m                closeButton = document.createElement('button');[m
[32m+[m[32m                closeButton.style.marginLeft = '20px';[m
[32m+[m[32m                closeButton.style.width = '40px';[m
[32m+[m[32m                closeButton.style.height = '40px';[m
[32m+[m[32m                closeButton.style.borderRadius = '40px';[m
 [m
[31m-                closeButton.innerHTML = "✖";[m
[31m-                closeButton.addEventListener("click", function (e) {[m
[32m+[m[32m                closeButton.innerHTML = '✖';[m
[32m+[m[32m                closeButton.addEventListener('click', function (e) {[m
                     setTimeout(function () {[m
[31m-                        IAB.close(win);[m
[32m+[m[32m                        IAB.close();[m
                     }, 0);[m
                 });[m
 [m
[36m@@ -176,7 +191,7 @@[m [mvar IAB = {[m
 [m
                 browserWrap.appendChild(navigationButtonsDiv);[m
             } else {[m
[31m-                popup.style.height = "100%";[m
[32m+[m[32m                popup.style.height = '100%';[m
             }[m
 [m
             // start listening for navigation events[m
[36m@@ -187,8 +202,8 @@[m [mvar IAB = {[m
     },[m
 [m
     injectScriptCode: function (win, fail, args) {[m
[31m-        var code = args[0],[m
[31m-            hasCallback = args[1];[m
[32m+[m[32m        var code = args[0];[m
[32m+[m[32m        var hasCallback = args[1];[m
 [m
         if (browserWrap && popup) {[m
             try {[m
[36m@@ -196,7 +211,7 @@[m [mvar IAB = {[m
                 if (hasCallback) {[m
                     win([]);[m
                 }[m
[31m-            } catch(e) {[m
[32m+[m[32m            } catch (e) {[m
                 console.error('Error occured while trying to injectScriptCode: ' + JSON.stringify(e));[m
             }[m
         }[m
[36m@@ -208,7 +223,7 @@[m [mvar IAB = {[m
         if (fail) {[m
             fail(msg);[m
         }[m
[31m-    }, [m
[32m+[m[32m    },[m
 [m
     injectStyleCode: function (win, fail, args) {[m
         var msg = 'Browser cordova-plugin-inappbrowser injectStyleCode is not yet implemented';[m
[36m@@ -229,6 +244,6 @@[m [mvar IAB = {[m
 [m
 module.exports = IAB;[m
 [m
[31m-require("cordova/exec/proxy").add("InAppBrowser", module.exports);[m
[32m+[m[32mrequire('cordova/exec/proxy').add('InAppBrowser', module.exports);[m
 [m
 });[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-inappbrowser/www/inappbrowser.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-inappbrowser/www/inappbrowser.js[m
[1mindex 79396fc..759dacf 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-inappbrowser/www/inappbrowser.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-inappbrowser/www/inappbrowser.js[m
[36m@@ -19,7 +19,7 @@[m [mcordova.define("cordova-plugin-inappbrowser.inappbrowser", function(require, exp[m
  *[m
 */[m
 [m
[31m-(function() {[m
[32m+[m[32m(function () {[m
     // special patch to correctly work on Ripple emulator (CB-9760)[m
     if (window.parent && !!window.parent.ripple) { // https://gist.github.com/triceam/4658021[m
         module.exports = window.open.bind(window); // fallback to default window.open behaviour[m
[36m@@ -31,13 +31,14 @@[m [mcordova.define("cordova-plugin-inappbrowser.inappbrowser", function(require, exp[m
     var modulemapper = require('cordova/modulemapper');[m
     var urlutil = require('cordova/urlutil');[m
 [m
[31m-    function InAppBrowser() {[m
[31m-       this.channels = {[m
[32m+[m[32m    function InAppBrowser () {[m
[32m+[m[32m        this.channels = {[m
             'loadstart': channel.create('loadstart'),[m
[31m-            'loadstop' : channel.create('loadstop'),[m
[31m-            'loaderror' : channel.create('loaderror'),[m
[31m-            'exit' : channel.create('exit')[m
[31m-       };[m
[32m+[m[32m            'loadstop': channel.create('loadstop'),[m
[32m+[m[32m            'loaderror': channel.create('loaderror'),[m
[32m+[m[32m            'exit': channel.create('exit'),[m
[32m+[m[32m            'customscheme': channel.create('customscheme')[m
[32m+[m[32m        };[m
     }[m
 [m
     InAppBrowser.prototype = {[m
[36m@@ -47,47 +48,47 @@[m [mcordova.define("cordova-plugin-inappbrowser.inappbrowser", function(require, exp[m
             }[m
         },[m
         close: function (eventname) {[m
[31m-            exec(null, null, "InAppBrowser", "close", []);[m
[32m+[m[32m            exec(null, null, 'InAppBrowser', 'close', []);[m
         },[m
         show: function (eventname) {[m
[31m-            exec(null, null, "InAppBrowser", "show", []);[m
[32m+[m[32m            exec(null, null, 'InAppBrowser', 'show', []);[m
         },[m
         hide: function (eventname) {[m
[31m-            exec(null, null, "InAppBrowser", "hide", []);[m
[32m+[m[32m            exec(null, null, 'InAppBrowser', 'hide', []);[m
         },[m
[31m-        addEventListener: function (eventname,f) {[m
[32m+[m[32m        addEventListener: function (eventname, f) {[m
             if (eventname in this.channels) {[m
                 this.channels[eventname].subscribe(f);[m
             }[m
         },[m
[31m-        removeEventListener: function(eventname, f) {[m
[32m+[m[32m        removeEventListener: function (eventname, f) {[m
             if (eventname in this.channels) {[m
                 this.channels[eventname].unsubscribe(f);[m
             }[m
         },[m
 [m
[31m-        executeScript: function(injectDetails, cb) {[m
[32m+[m[32m        executeScript: function (injectDetails, cb) {[m
             if (injectDetails.code) {[m
[31m-                exec(cb, null, "InAppBrowser", "injectScriptCode", [injectDetails.code, !!cb]);[m
[32m+[m[32m                exec(cb, null, 'InAppBrowser', 'injectScriptCode', [injectDetails.code, !!cb]);[m
             } else if (injectDetails.file) {[m
[31m-                exec(cb, null, "InAppBrowser", "injectScriptFile", [injectDetails.file, !!cb]);[m
[32m+[m[32m                exec(cb, null, 'InAppBrowser', 'injectScriptFile', [injectDetails.file, !!cb]);[m
             } else {[m
                 throw new Error('executeScript requires exactly one of code or file to be specified');[m
             }[m
         },[m
 [m
[31m-        insertCSS: function(injectDetails, cb) {[m
[32m+[m[32m        insertCSS: function (injectDetails, cb) {[m
             if (injectDetails.code) {[m
[31m-                exec(cb, null, "InAppBrowser", "injectStyleCode", [injectDetails.code, !!cb]);[m
[32m+[m[32m                exec(cb, null, 'InAppBrowser', 'injectStyleCode', [injectDetails.code, !!cb]);[m
             } else if (injectDetails.file) {[m
[31m-                exec(cb, null, "InAppBrowser", "injectStyleFile", [injectDetails.file, !!cb]);[m
[32m+[m[32m                exec(cb, null, 'InAppBrowser', 'injectStyleFile', [injectDetails.file, !!cb]);[m
             } else {[m
                 throw new Error('insertCSS requires exactly one of code or file to be specified');[m
             }[m
         }[m
     };[m
 [m
[31m-    module.exports = function(strUrl, strWindowName, strWindowFeatures, callbacks) {[m
[32m+[m[32m    module.exports = function (strUrl, strWindowName, strWindowFeatures, callbacks) {[m
         // Don't catch calls that write to existing frames (e.g. named iframes).[m
         if (window.frames && window.frames[strWindowName]) {[m
             var origOpenFunc = modulemapper.getOriginalSymbol(window, 'open');[m
[36m@@ -102,13 +103,13 @@[m [mcordova.define("cordova-plugin-inappbrowser.inappbrowser", function(require, exp[m
             iab.addEventListener(callbackName, callbacks[callbackName]);[m
         }[m
 [m
[31m-        var cb = function(eventname) {[m
[31m-           iab._eventHandler(eventname);[m
[32m+[m[32m        var cb = function (eventname) {[m
[32m+[m[32m            iab._eventHandler(eventname);[m
         };[m
 [m
[31m-        strWindowFeatures = strWindowFeatures || "";[m
[32m+[m[32m        strWindowFeatures = strWindowFeatures || '';[m
 [m
[31m-        exec(cb, cb, "InAppBrowser", "open", [strUrl, strWindowName, strWindowFeatures]);[m
[32m+[m[32m        exec(cb, cb, 'InAppBrowser', 'open', [strUrl, strWindowName, strWindowFeatures]);[m
         return iab;[m
     };[m
 })();[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-ionic-keyboard/www/keyboard.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-ionic-keyboard/www/keyboard.js[m
[1mdeleted file mode 100644[m
[1mindex 92c61da..0000000[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/cordova-plugin-ionic-keyboard/www/keyboard.js[m
[1m+++ /dev/null[m
[36m@@ -1,39 +0,0 @@[m
[31m-cordova.define("cordova-plugin-ionic-keyboard.keyboard", function(require, exports, module) { [m
[31m-var argscheck = require('cordova/argscheck'),[m
[31m-    utils = require('cordova/utils'),[m
[31m-    exec = require('cordova/exec');[m
[31m-[m
[31m-[m
[31m-var Keyboard = function() {[m
[31m-};[m
[31m-[m
[31m-Keyboard.hideKeyboardAccessoryBar = function(hide) {[m
[31m-    exec(null, null, "Keyboard", "hideKeyboardAccessoryBar", [hide]);[m
[31m-};[m
[31m-[m
[31m-Keyboard.close = function() {	[m
[31m-    exec(null, null, "Keyboard", "close", []);[m
[31m-};[m
[31m-[m
[31m-Keyboard.show = function() {[m
[31m-    exec(null, null, "Keyboard", "show", []);[m
[31m-};[m
[31m-[m
[31m-Keyboard.disableScroll = function(disable) {[m
[31m-    exec(null, null, "Keyboard", "disableScroll", [disable]);[m
[31m-};[m
[31m-[m
[31m-/*[m
[31m-Keyboard.styleDark = function(dark) {[m
[31m- exec(null, null, "Keyboard", "styleDark", [dark]);[m
[31m-};[m
[31m-*/[m
[31m-[m
[31m-Keyboard.isVisible = false;[m
[31m-[m
[31m-module.exports = Keyboard;[m
[31m-[m
[31m-[m
[31m-[m
[31m-[m
[31m-});[m
[1mdiff --git a/cordova_exchange_dist/platforms/browser/platform_www/plugins/phonegap-plugin-barcodescanner/www/barcodescanner.js b/cordova_exchange_dist/platforms/browser/platform_www/plugins/phonegap-plugin-barcodescanner/www/barcodescanner.js[m
[1mindex bd50f33..58252b4 100644[m
[1m--- a/cordova_exchange_dist/platforms/browser/platform_www/plugins/phonegap-plugin-barcodescanner/www/barcodescanner.js[m
[1m+++ b/cordova_exchange_dist/platforms/browser/platform_www/plugins/phonegap-plugin-barcodescanner/www/barcodescanner.js[m
[36m@@ -1,13 +1,16 @@[m
 cordova.define("phonegap-plugin-barcodescanner.BarcodeScanner", function(require, exports, module) { /**[m
[31m- * cordova is available under *either* the terms of the modified BSD license *or* the[m
[31m- * MIT License (2008). See http://opensource.org/licenses/alphabetical for full text.[m
[32m+[m[32m * cordova is available under the MIT License (2008).[m
[32m+[m[32m * See http://opensource.org/licenses/alphabetical for full text.[m
  *[m
  * Copyright (c) Matt Kane 2010[m
  * Copyright (c) 2011, IBM Corporation[m
[32m+[m[32m * Copyright (c) 2012-2017, Adobe Systems[m
  */[m
 [m
 [m
[31m-        var exec = require("cordova/exec");[m
[32m+[m[32m        var exec = cordova.require("cordova/exec");[m
[32m+[m
[32m+[m[32m        var scanInProgress = false;[m
 [m
         /**[m
          * Constructor.[m
[36m@@ -76,6 +79,10 @@[m [mBarcodeScanner.prototype.scan = function (successCallback, errorCallback, config[m
                 // do nothing[m
             } else {[m
                 if (typeof(config) === 'object') {[m
[32m+[m[32m                    // string spaces between formats, ZXing does not like that[m
[32m+[m[32m                    if (config.formats) {[m
[32m+[m[32m                        config.formats = config.formats.replace(/\s+/g, '');[m
[32m+[m[32m                    }[m
                     config = [ config ];[m
                 } else {[m
                     config = [];[m
[36m@@ -97,7 +104,30 @@[m [mBarcodeScanner.prototype.scan = function (successCallback, errorCallback, config[m
                 return;[m
             }[m
 [m
[31m-    exec(successCallback, errorCallback, 'BarcodeScanner', 'scan', config);[m
[32m+[m[32m            if (scanInProgress) {[m
[32m+[m[32m                errorCallback('Scan is already in progress');[m
[32m+[m[32m                return;[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            scanInProgress = true;[m
[32m+[m
[32m+[m[32m            exec([m
[32m+[m[32m                function(result) {[m
[32m+[m[32m                    scanInProgress = false;[m
[32m+[m[32m                    // work around bug in ZXing library[m
[32m+[m[32m                    if (result.format === 'UPC_A' && result.text.length === 13) {[m
[32m+[m[32m                        result.text = result.text.substring(1);[m
[32m+[m[32m                    }[m
[32m+[m[32m                    successCallback(result);[m
[32m+[m[32m                },[m
[32m+[m[32m                function(error) {[m
[32m+[m[32m                    scanInProgress = false;[m
[32m+[m[32m                    errorCallback(error);[m
[32m+[m[32m                },[m
[32m+[m[32m                'BarcodeScanner',[m
[32m+[m[32m                'scan',[m
[32m+[m[32m                config[m
[32m+[m[32m            );[m
         };[m
 [m
         //-------------------------------------------------------------------[m
[1mdiff --git a/cordova_exchange_dist/platforms/platforms.json b/cordova_exchange_dist/platforms/platforms.json[m
[1mdeleted file mode 100755[m
[1mindex 74dbafe..0000000[m
[1m--- a/cordova_exchange_dist/platforms/platforms.json[m
[1m+++ /dev/null[m
[36m@@ -1,4 +0,0 @@[m
[31m-{[m
[31m-    "browser": "4.1.0",[m
[31m-    "android": "6.1.2"[m
[31m-}[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/browser.json b/cordova_exchange_dist/plugins/browser.json[m
[1mindex 2ae95e7..589e61c 100644[m
[1m--- a/cordova_exchange_dist/plugins/browser.json[m
[1m+++ b/cordova_exchange_dist/plugins/browser.json[m
[36m@@ -7,31 +7,43 @@[m
     "files": {}[m
   },[m
   "installed_plugins": {[m
[31m-    "cordova-plugin-console": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m    "cordova-plugin-file": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
[31m-    "cordova-plugin-device": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m    "cordova-plugin-whitelist": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
[31m-    "cordova-plugin-file": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m    "phonegap-plugin-barcodescanner": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
[32m+[m[32m    },[m
[32m+[m[32m    "cordova-plugin-fingerprint-aio": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
     "cordova-plugin-inappbrowser": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
     "cordova-plugin-ionic-keyboard": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
[31m-    "cordova-plugin-whitelist": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m    "cordova-plugin-urlhandler": {[m
[32m+[m[32m      "URL_SCHEME": "comchain",[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
[32m+[m[32m    },[m
[32m+[m[32m    "cordova-plugin-app-event": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
[32m+[m[32m    },[m
[32m+[m[32m    "cordova-plugin-console": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
[32m+[m[32m    },[m
[32m+[m[32m    "cordova-plugin-device": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
[32m+[m[32m    },[m
[32m+[m[32m    "de.appplant.cordova.plugin.local-notification": {[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     },[m
[31m-    "phonegap-plugin-barcodescanner": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[31m-    }[m
[31m-  },[m
[31m-  "dependent_plugins": {[m
     "cordova-plugin-compat": {[m
[31m-      "PACKAGE_NAME": "org.monnaieleman.bureau"[m
[32m+[m[32m      "PACKAGE_NAME": "io.cordova.hellocordova"[m
     }[m
[31m-  }[m
[32m+[m[32m  },[m
[32m+[m[32m  "dependent_plugins": {}[m
 }[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-compat/README.md b/cordova_exchange_dist/plugins/cordova-plugin-compat/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 1b3c89f..4e51219[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-compat/README.md[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-compat/README.md[m
[36m@@ -23,3 +23,13 @@[m [mcordova-plugin-compat[m
 ------------------------[m
 [m
 This repo is for remaining backwards compatible with previous versions of Cordova.[m
[32m+[m
[32m+[m[32m## Deprecated[m
[32m+[m
[32m+[m[32m> This plugin is no longer being worked on as the functionality provided by this plugin is now included in cordova-android 6.3.0. You should upgrade your application to use version 1.2.0 of this plugin. It will detect whether or not the plugin is required based on the version of cordova-android your app uses.[m
[32m+[m
[32m+[m[32m## USAGE[m
[32m+[m
[32m+[m[32mYour plugin can depend on this plugin and use it to handle the new run time permissions Android 6.0.0 (cordova-android 5.0.0) introduced.[m[41m [m
[32m+[m
[32m+[m[32mView [this commit](https://github.com/apache/cordova-plugin-camera/commit/a9c18710f23e86f5b7f8918dfab7c87a85064870) to see how to depend on `cordova-plugin-compat`. View [this file](https://github.com/apache/cordova-plugin-camera/blob/master/src/android/CameraLauncher.java) to see how `PermissionHelper` is being used to request and store permissions. Read more about Android permissions at http://cordova.apache.org/docs/en/latest/guide/platforms/android/plugin.html#android-permissions.[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-compat/package.json b/cordova_exchange_dist/plugins/cordova-plugin-compat/package.json[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 42f817e..78f8c66[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-compat/package.json[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-compat/package.json[m
[36m@@ -1,32 +1,121 @@[m
 {[m
[32m+[m[32m  "_args": [[m
[32m+[m[32m    [[m
[32m+[m[32m      {[m
[32m+[m[32m        "raw": "cordova-plugin-compat@1.2.0",[m
[32m+[m[32m        "scope": null,[m
[32m+[m[32m        "escapedName": "cordova-plugin-compat",[m
[32m+[m[32m        "name": "cordova-plugin-compat",[m
[32m+[m[32m        "rawSpec": "1.2.0",[m
[32m+[m[32m        "spec": "1.2.0",[m
[32m+[m[32m        "type": "version"[m
[32m+[m[32m      },[m
[32m+[m[32m      "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test"[m
[32m+[m[32m    ][m
[32m+[m[32m  ],[m
[32m+[m[32m  "_from": "cordova-plugin-compat@1.2.0",[m
[32m+[m[32m  "_id": "cordova-plugin-compat@1.2.0",[m
[32m+[m[32m  "_inCache": true,[m
[32m+[m[32m  "_location": "/cordova-plugin-compat",[m
[32m+[m[32m  "_nodeVersion": "6.6.0",[m
[32m+[m[32m  "_npmOperationalInternal": {[m
[32m+[m[32m    "host": "s3://npm-registry-packages",[m
[32m+[m[32m    "tmp": "tmp/cordova-plugin-compat-1.2.0.tgz_1506114392549_0.16403897292912006"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmUser": {[m
[32m+[m[32m    "name": "stevegill",[m
[32m+[m[32m    "email": "stevengill97@gmail.com"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmVersion": "4.6.1",[m
[32m+[m[32m  "_phantomChildren": {},[m
[32m+[m[32m  "_requested": {[m
[32m+[m[32m    "raw": "cordova-plugin-compat@1.2.0",[m
[32m+[m[32m    "scope": null,[m
[32m+[m[32m    "escapedName": "cordova-plugin-compat",[m
     "name": "cordova-plugin-compat",[m
[31m-    "description": "This repo is for remaining backwards compatible with previous versions of Cordova.",[m
[31m-    "version": "1.0.0",[m
[31m-    "homepage": "http://github.com/apache/cordova-plugin-compat#readme",[m
[31m-    "repository": {[m
[31m-        "type": "git",[m
[31m-        "url": "git://github.com/apache/cordova-plugin-compat.git"[m
[32m+[m[32m    "rawSpec": "1.2.0",[m
[32m+[m[32m    "spec": "1.2.0",[m
[32m+[m[32m    "type": "version"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_requiredBy": [[m
[32m+[m[32m    "#USER",[m
[32m+[m[32m    "/"[m
[32m+[m[32m  ],[m
[32m+[m[32m  "_resolved": "https://registry.npmjs.org/cordova-plugin-compat/-/cordova-plugin-compat-1.2.0.tgz",[m
[32m+[m[32m  "_shasum": "0bc65757276ebd920c012ce920e274177576373e",[m
[32m+[m[32m  "_shrinkwrap": null,[m
[32m+[m[32m  "_spec": "cordova-plugin-compat@1.2.0",[m
[32m+[m[32m  "_where": "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test",[m
[32m+[m[32m  "author": {[m
[32m+[m[32m    "name": "Apache Software Foundation"[m
[32m+[m[32m  },[m
[32m+[m[32m  "bugs": {[m
[32m+[m[32m    "url": "https://github.com/apache/cordova-plugin-compat/issues"[m
[32m+[m[32m  },[m
[32m+[m[32m  "cordova": {[m
[32m+[m[32m    "id": "cordova-plugin-compat",[m
[32m+[m[32m    "platforms": [[m
[32m+[m[32m      "android"[m
[32m+[m[32m    ][m
[32m+[m[32m  },[m
[32m+[m[32m  "dependencies": {},[m
[32m+[m[32m  "description": "[DEPRECATED] This repo is for remaining backwards compatible with previous versions of Cordova.",[m
[32m+[m[32m  "devDependencies": {},[m
[32m+[m[32m  "directories": {},[m
[32m+[m[32m  "dist": {[m
[32m+[m[32m    "shasum": "0bc65757276ebd920c012ce920e274177576373e",[m
[32m+[m[32m    "tarball": "https://registry.npmjs.org/cordova-plugin-compat/-/cordova-plugin-compat-1.2.0.tgz"[m
[32m+[m[32m  },[m
[32m+[m[32m  "engines": {[m
[32m+[m[32m    "cordovaDependencies": {[m
[32m+[m[32m      "<1.2.0": {[m
[32m+[m[32m        "cordova": ">=5.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      ">=1.2.0": {[m
[32m+[m[32m        "cordova": ">=5.0.0",[m
[32m+[m[32m        "cordova-android": "<6.3.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    }[m
[32m+[m[32m  },[m
[32m+[m[32m  "homepage": "http://github.com/apache/cordova-plugin-compat#readme",[m
[32m+[m[32m  "keywords": [[m
[32m+[m[32m    "ecosystem:cordova",[m
[32m+[m[32m    "ecosystem:phonegap",[m
[32m+[m[32m    "cordova-android"[m
[32m+[m[32m  ],[m
[32m+[m[32m  "license": "Apache-2.0",[m
[32m+[m[32m  "maintainers": [[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "bowserj",[m
[32m+[m[32m      "email": "bowserj@apache.org"[m
     },[m
[31m-    "bugs": {[m
[31m-        "url": "https://github.com/apache/cordova-plugin-compat/issues"[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "filmaj",[m
[32m+[m[32m      "email": "maj.fil@gmail.com"[m
     },[m
[31m-    "cordova": {[m
[31m-        "id": "cordova-plugin-compat",[m
[31m-        "platforms": [[m
[31m-            "android"[m
[31m-        ][m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "macdonst",[m
[32m+[m[32m      "email": "simon.macdonald@gmail.com"[m
     },[m
[31m-    "keywords": [[m
[31m-        "ecosystem:cordova",[m
[31m-        "ecosystem:phonegap",[m
[31m-        "cordova-android"[m
[31m-    ],[m
[31m-    "engines": [[m
[31m-        {[m
[31m-            "name": "cordova",[m
[31m-            "version": ">=5.0.0"[m
[31m-        }[m
[31m-    ],[m
[31m-    "author": "Apache Software Foundation",[m
[31m-    "license": "Apache-2.0"[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "purplecabbage",[m
[32m+[m[32m      "email": "purplecabbage@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "shazron",[m
[32m+[m[32m      "email": "shazron@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "stevegill",[m
[32m+[m[32m      "email": "stevengill97@gmail.com"[m
[32m+[m[32m    }[m
[32m+[m[32m  ],[m
[32m+[m[32m  "name": "cordova-plugin-compat",[m
[32m+[m[32m  "optionalDependencies": {},[m
[32m+[m[32m  "readme": "ERROR: No README data found!",[m
[32m+[m[32m  "repository": {[m
[32m+[m[32m    "type": "git",[m
[32m+[m[32m    "url": "git://github.com/apache/cordova-plugin-compat.git"[m
[32m+[m[32m  },[m
[32m+[m[32m  "version": "1.2.0"[m
 }[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-compat/plugin.xml b/cordova_exchange_dist/plugins/cordova-plugin-compat/plugin.xml[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 996d962..9c41abb[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-compat/plugin.xml[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-compat/plugin.xml[m
[36m@@ -1,5 +1,4 @@[m
 <?xml version="1.0" encoding="UTF-8"?>[m
[31m-[m
 <!--[m
   Licensed to the Apache Software Foundation (ASF) under one[m
   or more contributor license agreements.  See the NOTICE file[m
[36m@@ -18,19 +17,21 @@[m
   specific language governing permissions and limitations[m
   under the License.[m
 -->[m
[31m-[m
[31m-<plugin xmlns="http://cordova.apache.org/ns/plugins/1.0"[m
[31m-           id="cordova-plugin-compat"[m
[31m-      version="1.0.0">[m
[31m-    <name>Compat</name>[m
[31m-    <description>Cordova Compatibility Plugin</description>[m
[31m-    <license>Apache 2.0</license>[m
[31m-    <keywords>cordova,compat</keywords>[m
[31m-    <repo>https://git-wip-us.apache.org/repos/asf/cordova-plugin-compat.git</repo>[m
[31m-[m
[32m+[m[32m<plugin[m[41m [m
[32m+[m[32m  xmlns="http://cordova.apache.org/ns/plugins/1.0" id="cordova-plugin-compat" version="1.2.0">[m
[32m+[m[32m  <name>Compat</name>[m
[32m+[m[32m  <description>[DEPRECATED] Cordova Compatibility Plugin</description>[m
[32m+[m[32m  <license>Apache 2.0</license>[m
[32m+[m[32m  <keywords>cordova,compat</keywords>[m
[32m+[m[32m  <repo>https://git-wip-us.apache.org/repos/asf/cordova-plugin-compat.git</repo>[m
[32m+[m[32m  <engines>[m
[32m+[m[32m    <engine name="cordova" version=">=5.0.0"/>[m
[32m+[m[32m    <engine name="cordova-android" version="[m
[32m+[m[32m      <6.3.0"/>[m
[32m+[m[32m    </engines>[m
     <!-- android -->[m
     <platform name="android">[m
[31m-        <source-file src="src/android/PermissionHelper.java" target-dir="src/org/apache/cordova" />[m
[32m+[m[32m      <source-file src="src/android/PermissionHelper.java" target-dir="src/org/apache/cordova" />[m
[32m+[m[32m      <source-file src="src/android/BuildHelper.java" target-dir="src/org/apache/cordova" />[m
     </platform>[m
[31m-[m
[31m-</plugin>[m
[32m+[m[32m  </plugin>[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-compat/src/android/PermissionHelper.java b/cordova_exchange_dist/plugins/cordova-plugin-compat/src/android/PermissionHelper.java[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/CONTRIBUTING.md b/cordova_exchange_dist/plugins/cordova-plugin-console/CONTRIBUTING.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/LICENSE b/cordova_exchange_dist/plugins/cordova-plugin-console/LICENSE[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/NOTICE b/cordova_exchange_dist/plugins/cordova-plugin-console/NOTICE[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/README.md b/cordova_exchange_dist/plugins/cordova-plugin-console/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex e5f845b..f534be4[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-console/README.md[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-console/README.md[m
[36m@@ -1,3 +1,7 @@[m
[32m+[m[32m---[m
[32m+[m[32mtitle: Console[m
[32m+[m[32mdescription: Get JavaScript logs in your native logs.[m
[32m+[m[32m---[m
 <!---[m
 # license: Licensed to the Apache Software Foundation (ASF) under one[m
 #         or more contributor license agreements.  See the NOTICE file[m
[36m@@ -17,10 +21,19 @@[m
 #         under the License.[m
 -->[m
 [m
[31m-[![Build Status](https://travis-ci.org/apache/cordova-plugin-console.svg?branch=master)](https://travis-ci.org/apache/cordova-plugin-console)[m
[32m+[m[32m|AppVeyor|Travis CI|[m
[32m+[m[32m|:-:|:-:|[m
[32m+[m[32m|[![Build status](https://ci.appveyor.com/api/projects/status/github/apache/cordova-plugin-console?branch=master)](https://ci.appveyor.com/project/ApacheSoftwareFoundation/cordova-plugin-console)|[![Build Status](https://travis-ci.org/apache/cordova-plugin-console.svg?branch=master)](https://travis-ci.org/apache/cordova-plugin-console)|[m
 [m
 # cordova-plugin-console[m
 [m
[32m+[m[32m## Deprecated[m
[32m+[m
[32m+[m[32m> This plugin is no longer being worked on as the functionality provided by this plugin is now included in cordova-ios 4.5.0 or greater, and support is already built in to cordova-windows > 5.0.0. You should upgrade your application to use version 2.0.0 of this plugin. It will detect whether or not the plugin is required based on the version of cordova-ios and cordova-windows your app uses.[m
[32m+[m[32m> Please file issues for this plugin against their respective platforms (cordova-ios, cordova-windows).[m
[32m+[m
[32m+[m[32m## Description[m
[32m+[m
 This plugin is meant to ensure that console.log() is as useful as it can be.[m
 It adds additional function for iOS, Ubuntu, Windows Phone 8, and Windows. If[m
 you are happy with how console.log() works for you, then you probably[m
[36m@@ -36,6 +49,9 @@[m [mare not available until after the `deviceready` event.[m
         console.log("console.log works well");[m
     }[m
 [m
[32m+[m[32m:warning: Report issues on the [Apache Cordova issue tracker](https://issues.apache.org/jira/issues/?jql=project%20%3D%20CB%20AND%20status%20in%20%28Open%2C%20%22In%20Progress%22%2C%20Reopened%29%20AND%20resolution%20%3D%20Unresolved%20AND%20component%20%3D%20%22Plugin%20Console%22%20ORDER%20BY%20priority%20DESC%2C%20summary%20ASC%2C%20updatedDate%20DESC)[m
[32m+[m
[32m+[m
 ## Installation[m
 [m
     cordova plugin add cordova-plugin-console[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/RELEASENOTES.md b/cordova_exchange_dist/plugins/cordova-plugin-console/RELEASENOTES.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 88ffa28..a6168e0[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-console/RELEASENOTES.md[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-console/RELEASENOTES.md[m
[36m@@ -20,9 +20,38 @@[m
 -->[m
 # Release Notes[m
 [m
[32m+[m[32m### 1.1.0 (Sep 18, 2017)[m
[32m+[m[32m* [CB-13170](https://issues.apache.org/jira/browse/CB-13170) Integrated this plugin into `cordova-ios@4.5.0`. This plugin will not install for `cordova-ios >= 4.5.0`.[m
[32m+[m[32m* [CB-13028](https://issues.apache.org/jira/browse/CB-13028) (CI) **Browser** builds on `Travis` and `AppVeyor`[m
[32m+[m[32m* [CB-13000](https://issues.apache.org/jira/browse/CB-13000) (CI) Speed up **Android** builds[m
[32m+[m[32m* [CB-12991](https://issues.apache.org/jira/browse/CB-12991) (CI) Updated CI badges[m
[32m+[m[32m* [CB-12935](https://issues.apache.org/jira/browse/CB-12935) (**windows**) Enable paramedic builds on AppVeyor[m
[32m+[m[32m* [CB-12935](https://issues.apache.org/jira/browse/CB-12935) (**ios**, **Android**) Run `paramedic` builds on `Travis`[m
[32m+[m[32m* [CB-12847](https://issues.apache.org/jira/browse/CB-12847) added `bugs` entry to `package.json`.[m
[32m+[m
[32m+[m[32m### 1.0.7 (Apr 27, 2017)[m
[32m+[m[32m* [CB-12622](https://issues.apache.org/jira/browse/CB-12622) Added **Android 6.0** build badge to `README`[m
[32m+[m[32m* [CB-12685](https://issues.apache.org/jira/browse/CB-12685) added `package.json` to tests folder[m
[32m+[m
[32m+[m[32m### 1.0.6 (Feb 28, 2017)[m
[32m+[m[32m* [CB-12363](https://issues.apache.org/jira/browse/CB-12363) Added build badges for **iOS 9.3** and **iOS 10.0**[m
[32m+[m[32m* [CB-12230](https://issues.apache.org/jira/browse/CB-12230) Removed **Windows 8.1** build badges[m
[32m+[m
[32m+[m[32m### 1.0.5 (Dec 07, 2016)[m
[32m+[m[32m* [CB-12224](https://issues.apache.org/jira/browse/CB-12224) Updated version and RELEASENOTES.md for release 1.0.5[m
[32m+[m[32m* [CB-11917](https://issues.apache.org/jira/browse/CB-11917) - Remove pull request template checklist item: "iCLA has been submitted…"[m
[32m+[m[32m* [CB-11832](https://issues.apache.org/jira/browse/CB-11832) Incremented plugin version.[m
[32m+[m
[32m+[m[32m### 1.0.4 (Sep 08, 2016)[m
[32m+[m[32m* [CB-11795](https://issues.apache.org/jira/browse/CB-11795) Add 'protective' entry to `cordovaDependencies`[m
[32m+[m[32m* add `JIRA` issue tracker link[m
[32m+[m[32m* Add badges for paramedic builds on Jenkins[m
[32m+[m[32m* Add pull request template.[m
[32m+[m[32m* [CB-10996](https://issues.apache.org/jira/browse/CB-10996) Adding front matter to README.md[m
[32m+[m
 ### 1.0.3 (Apr 15, 2016)[m
[31m-* CB-10720 Minor spelling/formatting changes.[m
[31m-* CB-10636 Add `JSHint` for plugins[m
[32m+[m[32m* [CB-10720](https://issues.apache.org/jira/browse/CB-10720) Minor spelling/formatting changes.[m
[32m+[m[32m* [CB-10636](https://issues.apache.org/jira/browse/CB-10636) Add `JSHint` for plugins[m
 [m
 ### 1.0.2 (Nov 18, 2015)[m
 * [CB-10035](https://issues.apache.org/jira/browse/CB-10035) Updated `RELEASENOTES` to be newest to oldest[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/de/README.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/de/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/de/index.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/de/index.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/es/README.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/es/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/es/index.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/es/index.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/fr/README.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/fr/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/fr/index.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/fr/index.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/it/README.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/it/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/it/index.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/it/index.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/ja/README.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/ja/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/ja/index.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/ja/index.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/ko/README.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/ko/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/ko/index.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/ko/index.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/pl/README.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/pl/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/pl/index.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/pl/index.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/ru/index.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/ru/index.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/zh/README.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/zh/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/doc/zh/index.md b/cordova_exchange_dist/plugins/cordova-plugin-console/doc/zh/index.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/package.json b/cordova_exchange_dist/plugins/cordova-plugin-console/package.json[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex a2e2021..f56050c[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-console/package.json[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-console/package.json[m
[36m@@ -1,7 +1,57 @@[m
 {[m
[31m-  "name": "cordova-plugin-console",[m
[31m-  "version": "1.0.3",[m
[31m-  "description": "Cordova Console Plugin",[m
[32m+[m[32m  "_args": [[m
[32m+[m[32m    [[m
[32m+[m[32m      {[m
[32m+[m[32m        "raw": "cordova-plugin-console",[m
[32m+[m[32m        "scope": null,[m
[32m+[m[32m        "escapedName": "cordova-plugin-console",[m
[32m+[m[32m        "name": "cordova-plugin-console",[m
[32m+[m[32m        "rawSpec": "",[m
[32m+[m[32m        "spec": "latest",[m
[32m+[m[32m        "type": "tag"[m
[32m+[m[32m      },[m
[32m+[m[32m      "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test"[m
[32m+[m[32m    ][m
[32m+[m[32m  ],[m
[32m+[m[32m  "_from": "cordova-plugin-console@latest",[m
[32m+[m[32m  "_id": "cordova-plugin-console@1.1.0",[m
[32m+[m[32m  "_inCache": true,[m
[32m+[m[32m  "_location": "/cordova-plugin-console",[m
[32m+[m[32m  "_nodeVersion": "6.6.0",[m
[32m+[m[32m  "_npmOperationalInternal": {[m
[32m+[m[32m    "host": "s3://npm-registry-packages",[m
[32m+[m[32m    "tmp": "tmp/cordova-plugin-console-1.1.0.tgz_1506114399113_0.21866463334299624"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmUser": {[m
[32m+[m[32m    "name": "stevegill",[m
[32m+[m[32m    "email": "stevengill97@gmail.com"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmVersion": "4.6.1",[m
[32m+[m[32m  "_phantomChildren": {},[m
[32m+[m[32m  "_requested": {[m
[32m+[m[32m    "raw": "cordova-plugin-console",[m
[32m+[m[32m    "scope": null,[m
[32m+[m[32m    "escapedName": "cordova-plugin-console",[m
[32m+[m[32m    "name": "cordova-plugin-console",[m
[32m+[m[32m    "rawSpec": "",[m
[32m+[m[32m    "spec": "latest",[m
[32m+[m[32m    "type": "tag"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_requiredBy": [[m
[32m+[m[32m    "#USER",[m
[32m+[m[32m    "/"[m
[32m+[m[32m  ],[m
[32m+[m[32m  "_resolved": "https://registry.npmjs.org/cordova-plugin-console/-/cordova-plugin-console-1.1.0.tgz",[m
[32m+[m[32m  "_shasum": "e2fbac10290179e44cb72c5fdbc410a531c1cd6d",[m
[32m+[m[32m  "_shrinkwrap": null,[m
[32m+[m[32m  "_spec": "cordova-plugin-console",[m
[32m+[m[32m  "_where": "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test",[m
[32m+[m[32m  "author": {[m
[32m+[m[32m    "name": "Apache Software Foundation"[m
[32m+[m[32m  },[m
[32m+[m[32m  "bugs": {[m
[32m+[m[32m    "url": "https://issues.apache.org/jira/browse/CB"[m
[32m+[m[32m  },[m
   "cordova": {[m
     "id": "cordova-plugin-console",[m
     "platforms": [[m
[36m@@ -13,10 +63,26 @@[m
       "windows"[m
     ][m
   },[m
[31m-  "repository": {[m
[31m-    "type": "git",[m
[31m-    "url": "https://github.com/apache/cordova-plugin-console"[m
[32m+[m[32m  "dependencies": {},[m
[32m+[m[32m  "deprecated": "This plugin has been deprecated since it is now included in the latest versions of cordova-ios",[m
[32m+[m[32m  "description": "Cordova Console Plugin",[m
[32m+[m[32m  "devDependencies": {[m
[32m+[m[32m    "jshint": "^2.6.0"[m
[32m+[m[32m  },[m
[32m+[m[32m  "directories": {},[m
[32m+[m[32m  "dist": {[m
[32m+[m[32m    "shasum": "e2fbac10290179e44cb72c5fdbc410a531c1cd6d",[m
[32m+[m[32m    "tarball": "https://registry.npmjs.org/cordova-plugin-console/-/cordova-plugin-console-1.1.0.tgz"[m
[32m+[m[32m  },[m
[32m+[m[32m  "engines": {[m
[32m+[m[32m    "cordovaDependencies": {[m
[32m+[m[32m      ">=2.0.0": {[m
[32m+[m[32m        "cordova-ios": "<4.5.0",[m
[32m+[m[32m        "cordova-windows": "<=5.0.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    }[m
   },[m
[32m+[m[32m  "homepage": "https://github.com/apache/cordova-plugin-console#readme",[m
   "keywords": [[m
     "cordova",[m
     "console",[m
[36m@@ -28,13 +94,55 @@[m
     "cordova-windows8",[m
     "cordova-windows"[m
   ],[m
[32m+[m[32m  "license": "Apache-2.0",[m
[32m+[m[32m  "maintainers": [[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "anis",[m
[32m+[m[32m      "email": "anis.kadri@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "bowserj",[m
[32m+[m[32m      "email": "bowserj@apache.org"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "cordovaowner",[m
[32m+[m[32m      "email": "stevengill.97@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "csantanapr",[m
[32m+[m[32m      "email": "csantana23@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "filmaj",[m
[32m+[m[32m      "email": "maj.fil@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "purplecabbage",[m
[32m+[m[32m      "email": "purplecabbage@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "shazron",[m
[32m+[m[32m      "email": "shazron@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "stevegill",[m
[32m+[m[32m      "email": "stevengill97@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "surajpindoria",[m
[32m+[m[32m      "email": "suraj.pindoria@yahoo.com"[m
[32m+[m[32m    }[m
[32m+[m[32m  ],[m
[32m+[m[32m  "name": "cordova-plugin-console",[m
[32m+[m[32m  "optionalDependencies": {},[m
[32m+[m[32m  "readme": "ERROR: No README data found!",[m
[32m+[m[32m  "repository": {[m
[32m+[m[32m    "type": "git",[m
[32m+[m[32m    "url": "git+https://github.com/apache/cordova-plugin-console.git"[m
[32m+[m[32m  },[m
   "scripts": {[m
[31m-    "test": "npm run jshint",[m
[31m-    "jshint": "node node_modules/jshint/bin/jshint www && node node_modules/jshint/bin/jshint src && node node_modules/jshint/bin/jshint tests"[m
[32m+[m[32m    "jshint": "node node_modules/jshint/bin/jshint www && node node_modules/jshint/bin/jshint src && node node_modules/jshint/bin/jshint tests",[m
[32m+[m[32m    "test": "npm run jshint"[m
   },[m
[31m-  "author": "Apache Software Foundation",[m
[31m-  "license": "Apache-2.0",[m
[31m-  "devDependencies": {[m
[31m-    "jshint": "^2.6.0"[m
[31m-  }[m
[32m+[m[32m  "version": "1.1.0"[m
 }[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/plugin.xml b/cordova_exchange_dist/plugins/cordova-plugin-console/plugin.xml[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex fcb2356..e2d6fc3[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-console/plugin.xml[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-console/plugin.xml[m
[36m@@ -20,7 +20,7 @@[m
 [m
 <plugin xmlns="http://apache.org/cordova/ns/plugins/1.0"[m
            id="cordova-plugin-console"[m
[31m-      version="1.0.3">[m
[32m+[m[32m      version="1.1.0">[m
 [m
     <name>Console</name>[m
     <description>Cordova Console Plugin</description>[m
[36m@@ -29,6 +29,11 @@[m
     <repo>https://git-wip-us.apache.org/repos/asf/cordova-plugin-console.git</repo>[m
     <issue>https://issues.apache.org/jira/browse/CB/component/12320644</issue>[m
 [m
[32m+[m[32m    <engines>[m
[32m+[m[32m        <engine name="cordova-windows" version="<=5.0.0"/>[m
[32m+[m[32m        <engine name="cordova-ios" version="<4.5.0"/>[m
[32m+[m[32m    </engines>[m
[32m+[m
     <!-- ios -->[m
     <platform name="ios">[m
 [m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/src/ios/CDVLogger.h b/cordova_exchange_dist/plugins/cordova-plugin-console/src/ios/CDVLogger.h[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/src/ios/CDVLogger.m b/cordova_exchange_dist/plugins/cordova-plugin-console/src/ios/CDVLogger.m[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/src/ubuntu/console.cpp b/cordova_exchange_dist/plugins/cordova-plugin-console/src/ubuntu/console.cpp[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/src/ubuntu/console.h b/cordova_exchange_dist/plugins/cordova-plugin-console/src/ubuntu/console.h[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/src/wp/DebugConsole.cs b/cordova_exchange_dist/plugins/cordova-plugin-console/src/wp/DebugConsole.cs[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/tests/plugin.xml b/cordova_exchange_dist/plugins/cordova-plugin-console/tests/plugin.xml[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 7b12611..37c17d7[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-console/tests/plugin.xml[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-console/tests/plugin.xml[m
[36m@@ -22,7 +22,7 @@[m
     xmlns:rim="http://www.blackberry.com/ns/widgets"[m
     xmlns:android="http://schemas.android.com/apk/res/android"[m
     id="cordova-plugin-console-tests"[m
[31m-    version="1.0.3">[m
[32m+[m[32m    version="2.0.1-dev">[m
     <name>Cordova Console Plugin Tests</name>[m
     <license>Apache 2.0</license>[m
 [m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/tests/tests.js b/cordova_exchange_dist/plugins/cordova-plugin-console/tests/tests.js[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/www/console-via-logger.js b/cordova_exchange_dist/plugins/cordova-plugin-console/www/console-via-logger.js[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-console/www/logger.js b/cordova_exchange_dist/plugins/cordova-plugin-console/www/logger.js[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/README.md b/cordova_exchange_dist/plugins/cordova-plugin-device/README.md[m
[1mindex 10b8016..048f028 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/README.md[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-device/README.md[m
[36m@@ -21,9 +21,9 @@[m [mdescription: Get device information.[m
 #         under the License.[m
 -->[m
 [m
[31m-|Android|iOS| Windows 8.1 Store | Windows 8.1 Phone | Windows 10 Store | Travis CI |[m
[31m-|:-:|:-:|:-:|:-:|:-:|:-:|[m
[31m-|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=android,PLUGIN=cordova-plugin-device)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=android,PLUGIN=cordova-plugin-device/)|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=ios,PLUGIN=cordova-plugin-device)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=ios,PLUGIN=cordova-plugin-device/)|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=windows-8.1-store,PLUGIN=cordova-plugin-device)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=windows-8.1-store,PLUGIN=cordova-plugin-device/)|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=windows-8.1-phone,PLUGIN=cordova-plugin-device)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=windows-8.1-phone,PLUGIN=cordova-plugin-device/)|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=windows-10-store,PLUGIN=cordova-plugin-device)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=windows-10-store,PLUGIN=cordova-plugin-device/)|[![Build Status](https://travis-ci.org/apache/cordova-plugin-device.svg?branch=master)](https://travis-ci.org/apache/cordova-plugin-device)|[m
[32m+[m[32m|AppVeyor|Travis CI|[m
[32m+[m[32m|:-:|:-:|[m
[32m+[m[32m|[![Build status](https://ci.appveyor.com/api/projects/status/github/apache/cordova-plugin-device?branch=master)](https://ci.appveyor.com/project/ApacheSoftwareFoundation/cordova-plugin-device)|[![Build Status](https://travis-ci.org/apache/cordova-plugin-device.svg?branch=master)](https://travis-ci.org/apache/cordova-plugin-device)|[m
 [m
 # cordova-plugin-device[m
 [m
[36m@@ -61,14 +61,9 @@[m [mGet the version of Cordova running on the device.[m
 [m
 ### Supported Platforms[m
 [m
[31m-- Amazon Fire OS[m
 - Android[m
[31m-- BlackBerry 10[m
 - Browser[m
[31m-- Firefox OS[m
 - iOS[m
[31m-- Tizen[m
[31m-- Windows Phone 7 and 8[m
 - Windows[m
 - OSX[m
 [m
[36m@@ -81,11 +76,8 @@[m [mdifferent across versions of the same product.[m
 ### Supported Platforms[m
 [m
 - Android[m
[31m-- BlackBerry 10[m
 - Browser[m
 - iOS[m
[31m-- Tizen[m
[31m-- Windows Phone 7 and 8[m
 - Windows[m
 - OSX[m
 [m
[36m@@ -107,14 +99,6 @@[m [mvar model = device.model;[m
 [m
 - Gets the [product name](http://developer.android.com/reference/android/os/Build.html#PRODUCT) instead of the [model name](http://developer.android.com/reference/android/os/Build.html#MODEL), which is often the production code name. For example, the Nexus One returns `Passion`, and Motorola Droid returns `voles`.[m
 [m
[31m-### Tizen Quirks[m
[31m-[m
[31m-- Returns the device model assigned by the vendor, for example, `TIZEN`[m
[31m-[m
[31m-### Windows Phone 7 and 8 Quirks[m
[31m-[m
[31m-- Returns the device model specified by the manufacturer. For example, the Samsung Focus returns `SGH-i917`.[m
[31m-[m
 ## device.platform[m
 [m
 Get the device's operating system name.[m
[36m@@ -125,12 +109,8 @@[m [mvar string = device.platform;[m
 ### Supported Platforms[m
 [m
 - Android[m
[31m-- BlackBerry 10[m
 - Browser[m
[31m-- Firefox OS[m
 - iOS[m
[31m-- Tizen[m
[31m-- Windows Phone 7 and 8[m
 - Windows[m
 - OSX[m
 [m
[36m@@ -148,14 +128,6 @@[m [mvar string = device.platform;[m
 var devicePlatform = device.platform;[m
 ```[m
 [m
[31m-### Windows Phone 7 Quirks[m
[31m-[m
[31m-Windows Phone 7 devices report the platform as `WinCE`.[m
[31m-[m
[31m-### Windows Phone 8 Quirks[m
[31m-[m
[31m-Windows Phone 8 devices report the platform as `Win32NT`.[m
[31m-[m
 ## device.uuid[m
 [m
 Get the device's Universally Unique Identifier ([UUID](http://en.wikipedia.org/wiki/Universally_Unique_Identifier)).[m
[36m@@ -171,10 +143,7 @@[m [mThe details of how a UUID is generated are determined by the device manufacturer[m
 ### Supported Platforms[m
 [m
 - Android[m
[31m-- BlackBerry 10[m
 - iOS[m
[31m-- Tizen[m
[31m-- Windows Phone 7 and 8[m
 - Windows[m
 - OSX[m
 [m
[36m@@ -206,14 +175,6 @@[m [mThe UUID will be the same if app is restored from a backup or iCloud as it is sa[m
 [m
 The `uuid` on OSX is generated automatically if it does not exist yet and is stored in the `standardUserDefaults` in the `CDVUUID` property.[m
 [m
[31m-### Windows Phone 7 and 8 Quirks[m
[31m-[m
[31m-The `uuid` for Windows Phone 7 requires the permission[m
[31m-`ID_CAP_IDENTITY_DEVICE`.  Microsoft will likely deprecate this[m
[31m-property soon.  If the capability is not available, the application[m
[31m-generates a persistent guid that is maintained for the duration of the[m
[31m-application's installation on the device.[m
[31m-[m
 ## device.version[m
 [m
 Get the operating system version.[m
[36m@@ -223,11 +184,8 @@[m [mGet the operating system version.[m
 ### Supported Platforms[m
 [m
 - Android 2.1+[m
[31m-- BlackBerry 10[m
 - Browser[m
 - iOS[m
[31m-- Tizen[m
[31m-- Windows Phone 7 and 8[m
 - Windows[m
 - OSX[m
 [m
[36m@@ -261,9 +219,7 @@[m [mGet the device's manufacturer.[m
 ### Supported Platforms[m
 [m
 - Android[m
[31m-- BlackBerry 10[m
 - iOS[m
[31m-- Windows Phone 7 and 8[m
 - Windows[m
 [m
 ### Quick Example[m
[36m@@ -287,14 +243,14 @@[m [mvar isSim = device.isVirtual;[m
 ### Supported Platforms[m
 [m
 - Android 2.1+[m
[32m+[m[32m- Browser[m
 - iOS[m
[31m-- Windows Phone 8[m
 - Windows[m
 - OSX[m
 [m
[31m-### OSX Quirk[m
[32m+[m[32m### OSX and Browser Quirk[m
 [m
[31m-The `isVirtual` property on OS X always returns false.[m
[32m+[m[32mThe `isVirtual` property on OS X and Browser always returns false.[m
 [m
 ## device.serial[m
 [m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/RELEASENOTES.md b/cordova_exchange_dist/plugins/cordova-plugin-device/RELEASENOTES.md[m
[1mindex c06a44c..12d4008 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/RELEASENOTES.md[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-device/RELEASENOTES.md[m
[36m@@ -7,9 +7,9 @@[m
 # to you under the Apache License, Version 2.0 (the[m
 # "License"); you may not use this file except in compliance[m
 # with the License.  You may obtain a copy of the License at[m
[31m-# [m
[32m+[m[32m#[m
 # http://www.apache.org/licenses/LICENSE-2.0[m
[31m-# [m
[32m+[m[32m#[m
 # Unless required by applicable law or agreed to in writing,[m
 # software distributed under the License is distributed on an[m
 # "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[36m@@ -20,190 +20,38 @@[m
 -->[m
 # Release Notes[m
 [m
[32m+[m[32m### 2.0.2 (Apr 12, 2018)[m
[32m+[m[32m* [CB-13893](https://issues.apache.org/jira/browse/CB-13893) **iOS** delete `libz.tbd` from device plugin[m
[32m+[m
[32m+[m[32m### 2.0.1 (Dec 27, 2017)[m
[32m+[m[32m* [CB-13702](https://issues.apache.org/jira/browse/CB-13702) Fix to allow 2.0.0 version install[m
[32m+[m
[32m+[m[32m### 2.0.0 (Dec 15, 2017)[m
[32m+[m[32m* [CB-13670](https://issues.apache.org/jira/browse/CB-13670) Remove deprecated platforms[m
[32m+[m
[32m+[m[32m### 1.1.7 (Nov 06, 2017)[m
[32m+[m[32m* [CB-13472](https://issues.apache.org/jira/browse/CB-13472) (CI) Fixed Travis **Android** builds again[m
[32m+[m[32m* [CB-12895](https://issues.apache.org/jira/browse/CB-12895) setup `eslint` and removed `jshint`[m
[32m+[m[32m* [CB-13113](https://issues.apache.org/jira/browse/CB-13113) (browser) `device.isVirtual` is always false[m
[32m+[m[32m* [CB-13028](https://issues.apache.org/jira/browse/CB-13028) (CI) **Browser** builds on Travis and AppVeyor[m
[32m+[m[32m* [CB-13000](https://issues.apache.org/jira/browse/CB-13000) (CI) Speed up **Android** builds[m
[32m+[m[32m* [CB-12847](https://issues.apache.org/jira/browse/CB-12847) added `bugs` entry to `package.json`.[m
[32m+[m
[32m+[m[32m### 1.1.6 (Apr 27, 2017)[m
[32m+[m[32m* [CB-12622](https://issues.apache.org/jira/browse/CB-12622) Added **Android 6.0** build badge to `README`[m
[32m+[m[32m* [CB-12685](https://issues.apache.org/jira/browse/CB-12685) added `package.json` to tests folder[m
[32m+[m[32m* [CB-12105](https://issues.apache.org/jira/browse/CB-12105) (browser) Properly detect Edge[m
[32m+[m
[32m+[m[32m### 1.1.5 (Feb 28, 2017)[m
[32m+[m[32m* [CB-12353](https://issues.apache.org/jira/browse/CB-12353) Corrected merges usage in `plugin.xml`[m
[32m+[m[32m* [CB-12369](https://issues.apache.org/jira/browse/CB-12369) Add plugin typings from `DefinitelyTyped`[m
[32m+[m[32m* [CB-12363](https://issues.apache.org/jira/browse/CB-12363) Added build badges for **iOS 9.3** and **iOS 10.0**[m
[32m+[m[32m* [CB-12230](https://issues.apache.org/jira/browse/CB-12230) Removed **Windows 8.1** build badges[m
[32m+[m
 ### 1.1.4 (Dec 07, 2016)[m
[32m+[m[32m* [CB-12224](https://issues.apache.org/jira/browse/CB-12224) Updated version and RELEASENOTES.md for release 1.1.4[m
 * [CB-11917](https://issues.apache.org/jira/browse/CB-11917) - Remove pull request template checklist item: "iCLA has been submitted…"[m
 * [CB-11832](https://issues.apache.org/jira/browse/CB-11832) Incremented plugin version.[m
[31m-* [CB-11832](https://issues.apache.org/jira/browse/CB-11832) Updated version and RELEASENOTES.md for release 1.1.3[m
[31m-* [CB-11795](https://issues.apache.org/jira/browse/CB-11795) Add 'protective' entry to cordovaDependencies[m
[31m-* Add badges for paramedic builds on Jenkins[m
[31m-* Add pull request template.[m
[31m-* Readme: Add fenced code blocks with langauage hints[m
[31m-* [CB-10996](https://issues.apache.org/jira/browse/CB-10996) Adding front matter to README.md[m
[31m-* [CB-11091](https://issues.apache.org/jira/browse/CB-11091) Incremented plugin version.[m
[31m-*  Updated version and RELEASENOTES.md for release 1.1.2[m
[31m-* Close #49[m
[31m-* Use passed device, follow create policy forf CFUUIDCreate[m
[31m-* [CB-10631](https://issues.apache.org/jira/browse/CB-10631) ios: Fix for device.uuid in iOS 5.1.1[m
[31m-* Updating the comment to exclude URL[m
[31m-* Minor changes to readme[m
[31m-* [CB-10636](https://issues.apache.org/jira/browse/CB-10636) Add JSHint for plugins[m
[31m-* chore: edit package.json license to match SPDX id[m
[31m-* Refactored deviceInfo on iOS for better readability.[m
[31m-* [CB-10368](https://issues.apache.org/jira/browse/CB-10368) Incremented plugin version.[m
[31m-* [CB-10368](https://issues.apache.org/jira/browse/CB-10368) Updated version and RELEASENOTES.md for release 1.1.1[m
[31m-* Property manufacturer documented[m
[31m-* fix typo[m
[31m-* [CB-10238](https://issues.apache.org/jira/browse/CB-10238) Move device-plugin out from cordovalib to the plugin repository[m
[31m-* [CB-10238](https://issues.apache.org/jira/browse/CB-10238) Move device-plugin out from cordovalib to the plugin repository[m
[31m-* [CB-9923](https://issues.apache.org/jira/browse/CB-9923) Update `device.platform` documentation for browser platform[m
[31m-* [CB-10035](https://issues.apache.org/jira/browse/CB-10035) Incremented plugin version.[m
[31m-* [CB-10035](https://issues.apache.org/jira/browse/CB-10035) linked issues in RELEASENOTES.md[m
[31m-* [CB-10035](https://issues.apache.org/jira/browse/CB-10035) Updated version and RELEASENOTES.md for release 1.1.0[m
[31m-* removed r prefix from tags[m
[31m-* [CB-10035](https://issues.apache.org/jira/browse/CB-10035) Updated RELEASENOTES to be newest to oldest[m
[31m-* fix whitespace tab to spaces[m
[31m-* Add `isVirtual` for Windows 8.x (Phone) platforms[m
[31m-* [CB-9847](https://issues.apache.org/jira/browse/CB-9847) Fixed merge error of 408c3a20be976ca5b814c9f161c31d4edf1c00fc[m
[31m-* Added basic Android support for hardware serial number[m
[31m-* Cleanup PRs. This closes #27. This closes #17.[m
[31m-* [CB-9865](https://issues.apache.org/jira/browse/CB-9865) Better simulator detection for iOS[m
[31m-* Actually fixing the contribute link.[m
[31m-* Fixing contribute link.[m
[31m-* fix merge conflict, for reals[m
[31m-* add JIRA issue tracker link[m
[31m-* updated docs[m
[31m-* Cleanup wp8 code[m
[31m-* WP8 implementation[m
[31m-* update to use TARGET_OS_SIMULATOR as TARGET_IPHONE_SIMULATOR is deprecated.[m
[31m-* update code to use 'isVirtual'[m
[31m-* create test to verify existence and type of new property 'isVirtual'[m
[31m-* add isSimulator for iOS & Android device[m
[31m-* Fixed typo[m
[31m-* Updated documentation to mention backwards compatibility[m
[31m-* Updated README to reflect new behaviour and quirks on iOS[m
[31m-* Check user defaults first to maintain backwards compatibility[m
[31m-* Revert "Check user defaults first to maintain backwards compatibility"[m
[31m-* Check user defaults first to maintain backwards compatibility[m
[31m-* Remove line incorrectly committed[m
[31m-* Changed UUID to use [UIDevice identifierForVendor][m
[31m-* remove travis-ci[m
[31m-* [CB-9192](https://issues.apache.org/jira/browse/CB-9192) Incremented plugin version.[m
[31m-* [CB-9202](https://issues.apache.org/jira/browse/CB-9202) updated repo url to github mirror in package.json[m
[31m-* [CB-9192](https://issues.apache.org/jira/browse/CB-9192) Updated version and RELEASENOTES.md for release 1.0.1[m
[31m-* [CB-9128](https://issues.apache.org/jira/browse/CB-9128) cordova-plugin-device documentation translation: cordova-plugin-device[m
[31m-* Attempts to corrent npm markdown issue[m
[31m-* [CB-8858](https://issues.apache.org/jira/browse/CB-8858) Incremented plugin version.[m
[31m-* [CB-8858](https://issues.apache.org/jira/browse/CB-8858) Updated version in package.json for release 1.0.0[m
[31m-* Revert "CB-8858 Incremented plugin version."[m
[31m-* [CB-8858](https://issues.apache.org/jira/browse/CB-8858) Incremented plugin version.[m
[31m-* [CB-8858](https://issues.apache.org/jira/browse/CB-8858) Updated version and RELEASENOTES.md for release 1.0.0[m
[31m-* [CB-8746](https://issues.apache.org/jira/browse/CB-8746) gave plugin major version bump[m
[31m-* [CB-8683](https://issues.apache.org/jira/browse/CB-8683) changed plugin-id to pacakge-name[m
[31m-* [CB-8653](https://issues.apache.org/jira/browse/CB-8653) properly updated translated docs to use new id[m
[31m-* [CB-8653](https://issues.apache.org/jira/browse/CB-8653) updated translated docs to use new id[m
[31m-* Use TRAVIS_BUILD_DIR, install paramedic by npm[m
[31m-* [CB-8653](https://issues.apache.org/jira/browse/CB-8653) Updated Readme[m
[31m-* remove defunct windows8 version[m
[31m-* add travis badge[m
[31m-* update plugin path[m
[31m-* Add cross-plugin ios paramedic test running for TravisCI[m
[31m-* [CB-8538](https://issues.apache.org/jira/browse/CB-8538) Added package.json file[m
[31m-* [CB-8429](https://issues.apache.org/jira/browse/CB-8429) Incremented plugin version.[m
[31m-* [CB-8429](https://issues.apache.org/jira/browse/CB-8429) Updated version and RELEASENOTES.md for release 0.3.0[m
[31m-* Fixes a syntax error introduced in 1a13ee0[m
[31m-* [CB7285][Windows] add manufacturer property for windows, and cleanup[m
[31m-* [CB-7285](https://issues.apache.org/jira/browse/CB-7285) Add test for manufacturer property[m
[31m-* [CB-7285][WP8] add manufacturer info[m
[31m-* update of manufacturer name[m
[31m-* added device.manufacturer property for Android, iOS (Apple duh), Blackberry (RIM duh)[m
[31m-* Support for Windows Phone 8 ANID2 ANID is only supported up to Windows Phone 7.5[m
[31m-* [CB-8351](https://issues.apache.org/jira/browse/CB-8351) Use a local copy of uniqueAppInstanceIdentifier rather than CordovaLib's version[m
[31m-* - Fixed a bug that caused an "cannot call method of undefined" error if the browser's user agent wasn't recognized - Added support for Internet Explorer user agent strings - NOTE: IE 11's user agent string does not include "MSIE", so "Trident" is searched for instead[m
[31m-* [CB-8110](https://issues.apache.org/jira/browse/CB-8110) Incremented plugin version.[m
[31m-* [CB-8110](https://issues.apache.org/jira/browse/CB-8110) Updated version and RELEASENOTES.md for release 0.2.13[m
[31m-* Changing device.platform to always report the platform as "browser".[m
[31m-* [CB-5892](https://issues.apache.org/jira/browse/CB-5892) - Remove deprecated window.Settings[m
[31m-* [CB-7700](https://issues.apache.org/jira/browse/CB-7700) cordova-plugin-device documentation translation: cordova-plugin-device[m
[31m-* [CB-7571](https://issues.apache.org/jira/browse/CB-7571) Bump version of nested plugin to match parent plugin[m
[31m-* [CB-7571](https://issues.apache.org/jira/browse/CB-7571) Incremented plugin version.[m
[31m-* [CB-7571](https://issues.apache.org/jira/browse/CB-7571) Updated version and RELEASENOTES.md for release 0.2.12[m
[31m-* [CB-7471](https://issues.apache.org/jira/browse/CB-7471) cordova-plugin-device documentation translation: cordova-plugin-device[m
[31m-* [CB-7552](https://issues.apache.org/jira/browse/CB-7552) - device.name docs have not been removed[m
[31m-* [fxos] Fix cordova version[m
[31m-* added status box and documentation to manual tests[m
[31m-* [fxos] Fix cordova version[m
[31m-* added status box and documentation to manual tests[m
[31m-* Added plugin support for the browser[m
[31m-* [CB-7262](https://issues.apache.org/jira/browse/CB-7262) Adds support for universal windows apps.[m
[31m-* [CB-7244](https://issues.apache.org/jira/browse/CB-7244) Incremented plugin version.[m
[31m-* [CB-7244](https://issues.apache.org/jira/browse/CB-7244) Updated version and RELEASENOTES.md for release 0.2.11[m
[31m-* update DeviceProxy.js[m
[31m-* [CB-7168](https://issues.apache.org/jira/browse/CB-7168) Moving Device autotests to plugin (aka new-style tests)[m
[31m-* CB-6127lisa7cordova-plugin-consolecordova-plugin-device documentation translation: cordova-plugin-device[m
[31m-* Use Windows system calls to get better info[m
[31m-* [CB-6877](https://issues.apache.org/jira/browse/CB-6877) Incremented plugin version.[m
[31m-* [CB-6877](https://issues.apache.org/jira/browse/CB-6877) Updated version and RELEASENOTES.md for release 0.2.10[m
[31m-* [CB-6127](https://issues.apache.org/jira/browse/CB-6127) Spanish and French Translations added. Github close #12[m
[31m-* Changing 1.5 to 2.0[m
[31m-* added firefoxos version - conversion[m
[31m-* added firefoxos version[m
[31m-* [CB-6800](https://issues.apache.org/jira/browse/CB-6800) Add license[m
[31m-* documentation translation: cordova-plugin-device[m
[31m-* Lisa testing pulling in plugins for plugin: cordova-plugin-device[m
[31m-* Lisa testing pulling in plugins for plugin: cordova-plugin-device[m
[31m-* [CB-6491](https://issues.apache.org/jira/browse/CB-6491) add CONTRIBUTING.md[m
[31m-* [CB-6452](https://issues.apache.org/jira/browse/CB-6452) Incremented plugin version on dev branch.[m
[31m-* [CB-6452](https://issues.apache.org/jira/browse/CB-6452) Updated version and RELEASENOTES.md for release 0.2.9[m
[31m-* [CB-6460](https://issues.apache.org/jira/browse/CB-6460) Update license headers[m
[31m-* [CB-6422](https://issues.apache.org/jira/browse/CB-6422) [windows8] use cordova/exec/proxy[m
[31m-* [CB-5105](https://issues.apache.org/jira/browse/CB-5105) Removed dead code for device.version[m
[31m-* Add NOTICE file[m
[31m-* [CB-5980](https://issues.apache.org/jira/browse/CB-5980) Incremented plugin version on dev branch.[m
[31m-* Lisa testing pulling in plugins for plugin: cordova-plugin-device[m
[31m-* Lisa testing pulling in plugins for plugin: cordova-plugin-device[m
[31m-* [CB-5980](https://issues.apache.org/jira/browse/CB-5980) Updated version and RELEASENOTES.md for release 0.2.8[m
[31m-* src/tizen: Adding DeviceProxy.[m
[31m-* plugin.xml: Adding platform tizen.[m
[31m-* supported platforms updated[m
[31m-* Delete stale test/ directory[m
[31m-*  Incremented plugin version on dev branch.[m
[31m-*  Updated version and RELEASENOTES.md for release 0.2.7[m
[31m-* [CB-5737](https://issues.apache.org/jira/browse/CB-5737) Fix exception on close caused by left over telephony code from [CB-5504](https://issues.apache.org/jira/browse/CB-5504)[m
[31m-* [CB-5719](https://issues.apache.org/jira/browse/CB-5719) Incremented plugin version on dev branch.[m
[31m-* [CB-5719](https://issues.apache.org/jira/browse/CB-5719) Updated version and RELEASENOTES.md for release 0.2.6[m
[31m-* [CB-5658](https://issues.apache.org/jira/browse/CB-5658) Update license comment formatting of doc/index.md[m
[31m-* [CB-5658](https://issues.apache.org/jira/browse/CB-5658) Add doc.index.md for Device plugin[m
[31m-* [CB-5658](https://issues.apache.org/jira/browse/CB-5658) Delete stale snapshot of plugin docs[m
[31m-* [CB-5504](https://issues.apache.org/jira/browse/CB-5504) Moving Telephony Logic out of Device[m
[31m-* [CB-5565](https://issues.apache.org/jira/browse/CB-5565) Incremented plugin version on dev branch.[m
[31m-* [CB-5565](https://issues.apache.org/jira/browse/CB-5565) Updated version and RELEASENOTES.md for release 0.2.5[m
[31m-* [CB-5316](https://issues.apache.org/jira/browse/CB-5316) Spell Cordova as a brand unless it's a command or script[m
[31m-* [ubuntu] use cordova/exec/proxy[m
[31m-* add ubuntu platform[m
[31m-* Modify Device.platform logic to use amazon-fireos as the platform for Amazon Devices[m
[31m-* 1. Added amazon-fireos platform. 2. Change to use cordova-amazon-fireos as the platform if user agent contains 'cordova-amazon-fireos'[m
[31m-* [CB-5188](https://issues.apache.org/jira/browse/CB-5188)[m
[31m-* [CB-5188](https://issues.apache.org/jira/browse/CB-5188) Updated version and RELEASENOTES.md for release 0.2.4[m
[31m-* [CB-5128](https://issues.apache.org/jira/browse/CB-5128) added repo + issue tag in plugin.xml for device plugin[m
[31m-* [CB-5085](https://issues.apache.org/jira/browse/CB-5085) device.cordova returning wrong value[m
[31m-* [CB-4915](https://issues.apache.org/jira/browse/CB-4915) Incremented plugin version on dev branch.[m
[31m-* [CB-4915](https://issues.apache.org/jira/browse/CB-4915) Updated version and RELEASENOTES.md for release 0.2.3[m
[31m-* [CB-4889](https://issues.apache.org/jira/browse/CB-4889) bumping&resetting version[m
[31m-* [windows8] commandProxy has moved[m
[31m-* [BlackBerry10] removed uneeded permission tags in plugin.xml[m
[31m-* [CB-4889](https://issues.apache.org/jira/browse/CB-4889) renaming org.apache.cordova.core.device to org.apache.cordova.device[m
[31m-* Rename CHANGELOG.md -> RELEASENOTES.md[m
[31m-* updated to use commandProxy for ffos[m
[31m-* add firefoxos support[m
[31m-* [CB-4752](https://issues.apache.org/jira/browse/CB-4752) Incremented plugin version on dev branch.[m
[31m-* [BlackBerry10] removed uneeded permission tags in plugin.xml[m
[31m-* [CB-4752](https://issues.apache.org/jira/browse/CB-4752) Updated version and changelog[m
[31m-* removed extraneous print statement[m
[31m-* [CB-4432](https://issues.apache.org/jira/browse/CB-4432) copyright notice change[m
[31m-* removed extraneous print statement[m
[31m-* [CB-4432](https://issues.apache.org/jira/browse/CB-4432) copyright notice change[m
[31m-* [CB-4595](https://issues.apache.org/jira/browse/CB-4595) updated version[m
[31m-* reverted name element to be user readable[m
[31m-* [CB-4417](https://issues.apache.org/jira/browse/CB-4417) Move cordova-plugin-device to its own Java package.[m
[31m-* updated namespace[m
[31m-* updated readme, namespace and name tag[m
[31m-* [plugin.xml] adding rim namespace[m
[31m-* [plugin.xml] adding android namespace[m
[31m-* [plugin.xml] standardizing license + meta[m
[31m-* [license] adding apache license file[m
[31m-* updating plugin.xml with registry data[m
[31m-* [Windows8] Windows8 is now supported[m
[31m-* added basic Device support for Windows8[m
 [m
 ### 1.1.3 (Sep 08, 2016)[m
 * [CB-11795](https://issues.apache.org/jira/browse/CB-11795) Add 'protective' entry to cordovaDependencies[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/package.json b/cordova_exchange_dist/plugins/cordova-plugin-device/package.json[m
[1mindex 12c2d1e..4c106b8 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/package.json[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-device/package.json[m
[36m@@ -1,61 +1,151 @@[m
 {[m
[31m-  "name": "cordova-plugin-device",[m
[31m-  "version": "1.1.4",[m
[31m-  "description": "Cordova Device Plugin",[m
[32m+[m[32m  "_args": [[m
[32m+[m[32m    [[m
[32m+[m[32m      {[m
[32m+[m[32m        "raw": "cordova-plugin-device",[m
[32m+[m[32m        "scope": null,[m
[32m+[m[32m        "escapedName": "cordova-plugin-device",[m
[32m+[m[32m        "name": "cordova-plugin-device",[m
[32m+[m[32m        "rawSpec": "",[m
[32m+[m[32m        "spec": "latest",[m
[32m+[m[32m        "type": "tag"[m
[32m+[m[32m      },[m
[32m+[m[32m      "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test"[m
[32m+[m[32m    ][m
[32m+[m[32m  ],[m
[32m+[m[32m  "_from": "cordova-plugin-device@latest",[m
[32m+[m[32m  "_hasShrinkwrap": false,[m
[32m+[m[32m  "_id": "cordova-plugin-device@2.0.2",[m
[32m+[m[32m  "_inCache": true,[m
[32m+[m[32m  "_location": "/cordova-plugin-device",[m
[32m+[m[32m  "_nodeVersion": "6.6.0",[m
[32m+[m[32m  "_npmOperationalInternal": {[m
[32m+[m[32m    "host": "s3://npm-registry-packages",[m
[32m+[m[32m    "tmp": "tmp/cordova-plugin-device_2.0.2_1523945189482_0.27753081894529075"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmUser": {[m
[32m+[m[32m    "name": "stevegill",[m
[32m+[m[32m    "email": "stevengill97@gmail.com"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmVersion": "3.10.10",[m
[32m+[m[32m  "_phantomChildren": {},[m
[32m+[m[32m  "_requested": {[m
[32m+[m[32m    "raw": "cordova-plugin-device",[m
[32m+[m[32m    "scope": null,[m
[32m+[m[32m    "escapedName": "cordova-plugin-device",[m
[32m+[m[32m    "name": "cordova-plugin-device",[m
[32m+[m[32m    "rawSpec": "",[m
[32m+[m[32m    "spec": "latest",[m
[32m+[m[32m    "type": "tag"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_requiredBy": [[m
[32m+[m[32m    "#USER",[m
[32m+[m[32m    "/"[m
[32m+[m[32m  ],[m
[32m+[m[32m  "_resolved": "https://registry.npmjs.org/cordova-plugin-device/-/cordova-plugin-device-2.0.2.tgz",[m
[32m+[m[32m  "_shasum": "fc08f3722e67eef7b6c67bfc99a83df6add0baba",[m
[32m+[m[32m  "_shrinkwrap": null,[m
[32m+[m[32m  "_spec": "cordova-plugin-device",[m
[32m+[m[32m  "_where": "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test",[m
[32m+[m[32m  "author": {[m
[32m+[m[32m    "name": "Apache Software Foundation"[m
[32m+[m[32m  },[m
[32m+[m[32m  "bugs": {[m
[32m+[m[32m    "url": "https://issues.apache.org/jira/browse/CB"[m
[32m+[m[32m  },[m
   "cordova": {[m
     "id": "cordova-plugin-device",[m
     "platforms": [[m
[31m-      "firefoxos",[m
[31m-      "tizen",[m
       "android",[m
[31m-      "amazon-fireos",[m
[31m-      "ubuntu",[m
       "ios",[m
[31m-      "blackberry10",[m
[31m-      "wp7",[m
[31m-      "wp8",[m
[31m-      "windows8",[m
       "windows",[m
       "browser",[m
       "osx"[m
     ][m
   },[m
[31m-  "repository": {[m
[31m-    "type": "git",[m
[31m-    "url": "https://github.com/apache/cordova-plugin-device"[m
[32m+[m[32m  "dependencies": {},[m
[32m+[m[32m  "description": "Cordova Device Plugin",[m
[32m+[m[32m  "devDependencies": {[m
[32m+[m[32m    "eslint": "^3.19.0",[m
[32m+[m[32m    "eslint-config-semistandard": "^11.0.0",[m
[32m+[m[32m    "eslint-config-standard": "^10.2.1",[m
[32m+[m[32m    "eslint-plugin-import": "^2.3.0",[m
[32m+[m[32m    "eslint-plugin-node": "^5.0.0",[m
[32m+[m[32m    "eslint-plugin-promise": "^3.5.0",[m
[32m+[m[32m    "eslint-plugin-standard": "^3.0.1"[m
[32m+[m[32m  },[m
[32m+[m[32m  "directories": {},[m
[32m+[m[32m  "dist": {[m
[32m+[m[32m    "shasum": "fc08f3722e67eef7b6c67bfc99a83df6add0baba",[m
[32m+[m[32m    "tarball": "https://registry.npmjs.org/cordova-plugin-device/-/cordova-plugin-device-2.0.2.tgz",[m
[32m+[m[32m    "fileCount": 41,[m
[32m+[m[32m    "unpackedSize": 191630,[m
[32m+[m[32m    "npm-signature": "-----BEGIN PGP SIGNATURE-----\r\nVersion: OpenPGP.js v3.0.4\r\nComment: https://openpgpjs.org\r\n\r\nwsFcBAEBCAAQBQJa1Y7mCRA9TVsSAnZWagAA/JsP/RHF42hPQSqpa3FYSHKq\nPnGJ/LZYyDy0QV3TszYNjcop1AgdAo8lGM3gX2f1FRj5ZwCX75w8YhqUF6St\nHgtNWdJvpSvF9zusVdP280ww7FhRPX/B81HxJhj41kwrsHS2dmIfuk5QQUEN\nznKsduyjoFWuVDCkvz6gD+qjlOpiH8DE9iFng56l1ky5IOmUYRixXAxeZVGc\nqxED1bHBmb7mkOiRfd6ZSIDAcYVrmoFanXgHSj3WHvDeSV0CNn+9naLnP1ql\nX5XrKYGRVV4NEWZVbhu1yExDlyNHbVsiKlCh0WPTM7T13FwRL9J2/9GDslKI\n/ga9sVmHbkvrpXbIpAGbRnKMghn99vR7eAGrwLDNdagRA50uZMPR4G5oTgkh\nBPQXfG8sHam2JcORxTytNgpQ29yXlDx5R1QotLeFaWs6+mtJJeEOK397Jcr2\n3esJqtpHKXN643qKU2EN5QSFGyAjky9qs86mMZpkwbabqpAaehwLaZf/LQzr\nUbv7RNV7AW6BN00EcEvUtNUneHQdolsjqxYTfiG4+loqwBW54PxX+O2Y8PPj\nHeku2upoSsZTQXeiWJIfNZwbJMJccT+gTtx64gTtMO/PEaJvvGshc7/Xx+gn\nXFH1N9rRkSOj34np12o6gNbGIT2o8BeXVrOGv+wrPrl8vu93yraqKwcYx3Ok\nn5mm\r\n=2KcM\r\n-----END PGP SIGNATURE-----\r\n"[m
[32m+[m[32m  },[m
[32m+[m[32m  "engines": {[m
[32m+[m[32m    "cordovaDependencies": {[m
[32m+[m[32m      "3.0.0": {[m
[32m+[m[32m        "cordova": ">100"[m
[32m+[m[32m      }[m
[32m+[m[32m    }[m
   },[m
[32m+[m[32m  "homepage": "https://github.com/apache/cordova-plugin-device#readme",[m
   "keywords": [[m
     "cordova",[m
     "device",[m
     "ecosystem:cordova",[m
[31m-    "cordova-firefoxos",[m
[31m-    "cordova-tizen",[m
     "cordova-android",[m
[31m-    "cordova-amazon-fireos",[m
[31m-    "cordova-ubuntu",[m
     "cordova-ios",[m
[31m-    "cordova-blackberry10",[m
[31m-    "cordova-wp7",[m
[31m-    "cordova-wp8",[m
[31m-    "cordova-windows8",[m
     "cordova-windows",[m
     "cordova-browser",[m
     "cordova-osx"[m
   ],[m
[31m-  "scripts": {[m
[31m-    "test": "npm run jshint",[m
[31m-    "jshint": "node node_modules/jshint/bin/jshint www && node node_modules/jshint/bin/jshint src && node node_modules/jshint/bin/jshint tests"[m
[31m-  },[m
[31m-  "author": "Apache Software Foundation",[m
   "license": "Apache-2.0",[m
[31m-  "engines": {[m
[31m-    "cordovaDependencies": {[m
[31m-      "2.0.0": {[m
[31m-        "cordova": ">100"[m
[31m-      }[m
[32m+[m[32m  "maintainers": [[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "bowserj",[m
[32m+[m[32m      "email": "bowserj@apache.org"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "csantanapr",[m
[32m+[m[32m      "email": "csantana23@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "filmaj",[m
[32m+[m[32m      "email": "maj.fil@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "jcesarmobile",[m
[32m+[m[32m      "email": "jcesarmobile@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "macdonst",[m
[32m+[m[32m      "email": "simon.macdonald@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "purplecabbage",[m
[32m+[m[32m      "email": "purplecabbage@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "shazron",[m
[32m+[m[32m      "email": "shazron@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "stevegill",[m
[32m+[m[32m      "email": "stevengill97@gmail.com"[m
     }[m
[32m+[m[32m  ],[m
[32m+[m[32m  "name": "cordova-plugin-device",[m
[32m+[m[32m  "optionalDependencies": {},[m
[32m+[m[32m  "readme": "ERROR: No README data found!",[m
[32m+[m[32m  "repository": {[m
[32m+[m[32m    "type": "git",[m
[32m+[m[32m    "url": "git+https://github.com/apache/cordova-plugin-device.git"[m
   },[m
[31m-  "devDependencies": {[m
[31m-    "jshint": "^2.6.0"[m
[31m-  }[m
[32m+[m[32m  "scripts": {[m
[32m+[m[32m    "eslint": "node node_modules/eslint/bin/eslint www && node node_modules/eslint/bin/eslint src && node node_modules/eslint/bin/eslint tests",[m
[32m+[m[32m    "test": "npm run eslint"[m
[32m+[m[32m  },[m
[32m+[m[32m  "types": "./types/index.d.ts",[m
[32m+[m[32m  "version": "2.0.2"[m
 }[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/plugin.xml b/cordova_exchange_dist/plugins/cordova-plugin-device/plugin.xml[m
[1mindex ae956f8..7f60024 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/plugin.xml[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-device/plugin.xml[m
[36m@@ -22,7 +22,7 @@[m
     xmlns:rim="http://www.blackberry.com/ns/widgets"[m
     xmlns:android="http://schemas.android.com/apk/res/android"[m
     id="cordova-plugin-device"[m
[31m-    version="1.1.4">[m
[32m+[m[32m    version="2.0.2">[m
     <name>Device</name>[m
     <description>Cordova Device Plugin</description>[m
     <license>Apache 2.0</license>[m
[36m@@ -34,26 +34,6 @@[m
         <clobbers target="device" />[m
     </js-module>[m
 [m
[31m-    <!-- firefoxos -->[m
[31m-    <platform name="firefoxos">[m
[31m-        <config-file target="config.xml" parent="/*">[m
[31m-            <feature name="Device">[m
[31m-                <param name="firefoxos-package" value="Device" />[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <js-module src="src/firefoxos/DeviceProxy.js" name="DeviceProxy">[m
[31m-            <runs />[m
[31m-        </js-module>[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- tizen -->[m
[31m-    <platform name="tizen">[m
[31m-        <js-module src="src/tizen/DeviceProxy.js" name="DeviceProxy">[m
[31m-            <runs />[m
[31m-        </js-module>[m
[31m-    </platform>[m
[31m-[m
     <!-- android -->[m
     <platform name="android">[m
         <config-file target="res/xml/config.xml" parent="/*">[m
[36m@@ -65,26 +45,6 @@[m
         <source-file src="src/android/Device.java" target-dir="src/org/apache/cordova/device" />[m
     </platform>[m
 [m
[31m-    <!-- amazon-fireos -->[m
[31m-    <platform name="amazon-fireos">[m
[31m-        <config-file target="res/xml/config.xml" parent="/*">[m
[31m-            <feature name="Device" >[m
[31m-                <param name="android-package" value="org.apache.cordova.device.Device"/>[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <source-file src="src/android/Device.java" target-dir="src/org/apache/cordova/device" />[m
[31m-    </platform>[m
[31m-    [m
[31m-    <!-- ubuntu -->[m
[31m-    <platform name="ubuntu">[m
[31m-        <header-file src="src/ubuntu/device.h" />[m
[31m-        <source-file src="src/ubuntu/device.cpp" />[m
[31m-        <js-module src="src/ubuntu/device.js" name="DeviceProxy">[m
[31m-            <merges target="device" />[m
[31m-        </js-module>[m
[31m-    </platform>[m
[31m-[m
     <!-- ios -->[m
     <platform name="ios">[m
         <config-file target="config.xml" parent="/*">[m
[36m@@ -97,51 +57,10 @@[m
         <source-file src="src/ios/CDVDevice.m" />[m
     </platform>[m
 [m
[31m-    <!-- blackberry10 -->[m
[31m-    <platform name="blackberry10">[m
[31m-        <source-file src="src/blackberry10/index.js" target-dir="Device" />[m
[31m-        <config-file target="www/config.xml" parent="/widget">[m
[31m-            <feature name="Device" value="Device"/>[m
[31m-        </config-file>[m
[31m-        <config-file target="www/config.xml" parent="/widget/rim:permissions">[m
[31m-            <rim:permit>read_device_identifying_information</rim:permit>[m
[31m-        </config-file>[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- wp7 -->[m
[31m-    <platform name="wp7">[m
[31m-        <config-file target="config.xml" parent="/*">[m
[31m-            <feature name="Device">[m
[31m-                <param name="wp-package" value="Device"/>[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <config-file target="Properties/WMAppManifest.xml" parent="/Deployment/App/Capabilities">[m
[31m-            <Capability Name="ID_CAP_IDENTITY_DEVICE" />[m
[31m-        </config-file>[m
[31m-[m
[31m-        <source-file src="src/wp/Device.cs" />[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- wp8 -->[m
[31m-    <platform name="wp8">[m
[31m-        <config-file target="config.xml" parent="/*">[m
[31m-            <feature name="Device">[m
[31m-                <param name="wp-package" value="Device"/>[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <config-file target="Properties/WMAppManifest.xml" parent="/Deployment/App/Capabilities">[m
[31m-            <Capability Name="ID_CAP_IDENTITY_DEVICE" />[m
[31m-        </config-file>[m
[31m-[m
[31m-        <source-file src="src/wp/Device.cs" />[m
[31m-    </platform>[m
[31m-[m
     <!-- windows -->[m
     <platform name="windows">[m
         <js-module src="src/windows/DeviceProxy.js" name="DeviceProxy">[m
[31m-            <merges target="" />[m
[32m+[m[32m            <runs />[m
         </js-module>[m
     </platform>[m
 [m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/src/blackberry10/index.js b/cordova_exchange_dist/plugins/cordova-plugin-device/src/blackberry10/index.js[m
[1mdeleted file mode 100644[m
[1mindex ef0543b..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/src/blackberry10/index.js[m
[1m+++ /dev/null[m
[36m@@ -1,71 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* global PluginResult */[m
[31m-[m
[31m-function getModelName () {[m
[31m-    var modelName = window.qnx.webplatform.device.modelName;[m
[31m-    //Pre 10.2 (meaning Z10 or Q10)[m
[31m-    if (typeof modelName === "undefined") {[m
[31m-        if (window.screen.height === 720 && window.screen.width === 720) {[m
[31m-            if ( window.matchMedia("(-blackberry-display-technology: -blackberry-display-oled)").matches) {[m
[31m-                modelName = "Q10";[m
[31m-            } else {[m
[31m-                modelName = "Q5";[m
[31m-            }[m
[31m-        } else if ((window.screen.height === 1280 && window.screen.width === 768) ||[m
[31m-                   (window.screen.height === 768 && window.screen.width === 1280)) {[m
[31m-            modelName = "Z10";[m
[31m-        } else {[m
[31m-            modelName = window.qnx.webplatform.deviceName;[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    return modelName;[m
[31m-}[m
[31m-[m
[31m-function getUUID () {[m
[31m-    var uuid = "";[m
[31m-    try {[m
[31m-        //Must surround by try catch because this will throw if the app is missing permissions[m
[31m-        uuid = window.qnx.webplatform.device.devicePin;[m
[31m-    } catch (e) {[m
[31m-        //DO Nothing[m
[31m-    }[m
[31m-    return uuid;[m
[31m-}[m
[31m-[m
[31m-module.exports = {[m
[31m-    getDeviceInfo: function (success, fail, args, env) {[m
[31m-        var result = new PluginResult(args, env),[m
[31m-            modelName = getModelName(),[m
[31m-            uuid = getUUID(),[m
[31m-            info = {[m
[31m-                manufacturer: 'BlackBerry',[m
[31m-                platform: "blackberry10",[m
[31m-                version: window.qnx.webplatform.device.scmBundle,[m
[31m-                model: modelName,[m
[31m-                uuid: uuid[m
[31m-            };[m
[31m-[m
[31m-        result.ok(info);[m
[31m-    }[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/src/browser/DeviceProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-device/src/browser/DeviceProxy.js[m
[1mindex a863201..4dc80ec 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/src/browser/DeviceProxy.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-device/src/browser/DeviceProxy.js[m
[36m@@ -20,24 +20,26 @@[m
  */[m
 var browser = require('cordova/platform');[m
 [m
[31m-function getPlatform() {[m
[31m-    return "browser";[m
[32m+[m[32mfunction getPlatform () {[m
[32m+[m[32m    return 'browser';[m
 }[m
 [m
[31m-function getModel() {[m
[32m+[m[32mfunction getModel () {[m
     return getBrowserInfo(true);[m
 }[m
 [m
[31m-function getVersion() {[m
[32m+[m[32mfunction getVersion () {[m
     return getBrowserInfo(false);[m
 }[m
 [m
[31m-function getBrowserInfo(getModel) {[m
[32m+[m[32mfunction getBrowserInfo (getModel) {[m
     var userAgent = navigator.userAgent;[m
     var returnVal = '';[m
     var offset;[m
 [m
[31m-    if ((offset = userAgent.indexOf('Chrome')) !== -1) {[m
[32m+[m[32m    if ((offset = userAgent.indexOf('Edge')) !== -1) {[m
[32m+[m[32m        returnVal = (getModel) ? 'Edge' : userAgent.substring(offset + 5);[m
[32m+[m[32m    } else if ((offset = userAgent.indexOf('Chrome')) !== -1) {[m
         returnVal = (getModel) ? 'Chrome' : userAgent.substring(offset + 7);[m
     } else if ((offset = userAgent.indexOf('Safari')) !== -1) {[m
         if (getModel) {[m
[36m@@ -64,7 +66,6 @@[m [mfunction getBrowserInfo(getModel) {[m
     return returnVal;[m
 }[m
 [m
[31m-[m
 module.exports = {[m
     getDeviceInfo: function (success, error) {[m
         setTimeout(function () {[m
[36m@@ -73,10 +74,11 @@[m [mmodule.exports = {[m
                 platform: getPlatform(),[m
                 model: getModel(),[m
                 version: getVersion(),[m
[31m-                uuid: null[m
[32m+[m[32m                uuid: null,[m
[32m+[m[32m                isVirtual: false[m
             });[m
         }, 0);[m
     }[m
 };[m
 [m
[31m-require("cordova/exec/proxy").add("Device", module.exports);[m
[32m+[m[32mrequire('cordova/exec/proxy').add('Device', module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/src/firefoxos/DeviceProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-device/src/firefoxos/DeviceProxy.js[m
[1mdeleted file mode 100644[m
[1mindex a05d7ca..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/src/firefoxos/DeviceProxy.js[m
[1m+++ /dev/null[m
[36m@@ -1,77 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m- */[m
[31m-//example UA String for Firefox OS [m
[31m-//Mozilla/5.0 (Mobile; rv:26.0) Gecko/26.0 Firefox/26.0[m
[31m-[m
[31m-//UA parsing not recommended but currently this is the only way to get the Firefox OS version[m
[31m-//https://developer.mozilla.org/en-US/docs/Gecko_user_agent_string_reference[m
[31m-[m
[31m-//Should be replaced when better conversion to Firefox OS Version is available[m
[31m-function convertVersionNumber(ver) {[m
[31m-    var hashVersion = {[m
[31m-        '18.0': '1.0.1',[m
[31m-        '18.1': '1.1',[m
[31m-        '26.0': '1.2',[m
[31m-        '28.0': '1.3',[m
[31m-        '30.0': '1.4',[m
[31m-        '32.0': '2.0'[m
[31m-    };[m
[31m-    var rver = ver;[m
[31m-    var sStr = ver.substring(0, 4);[m
[31m-    if (hashVersion[sStr]) {[m
[31m-        rver = hashVersion[sStr];[m
[31m-    }[m
[31m-    return (rver);[m
[31m-[m
[31m-}[m
[31m-function getVersion() {[m
[31m-    if (navigator.userAgent.match(/(mobile|tablet)/i)) {[m
[31m-        var ffVersionArray = (navigator.userAgent.match(/Firefox\/([\d]+\.[\w]?\.?[\w]+)/));[m
[31m-        if (ffVersionArray.length === 2) {[m
[31m-            return (convertVersionNumber(ffVersionArray[1]));[m
[31m-        }[m
[31m-    }[m
[31m-    return (null);[m
[31m-}[m
[31m-[m
[31m-function getModel() {[m
[31m-    var uaArray = navigator.userAgent.split(/\s*[;)(]\s*/);[m
[31m-    if (navigator.userAgent.match(/(mobile|tablet)/i)) {[m
[31m-        if (uaArray.length === 5) {[m
[31m-            return (uaArray[2]);[m
[31m-        }[m
[31m-    }[m
[31m-    return (null);[m
[31m-}[m
[31m-module.exports = {[m
[31m-    getDeviceInfo: function (success, error) {[m
[31m-        setTimeout(function () {[m
[31m-            success({[m
[31m-                platform: 'firefoxos',[m
[31m-                model: getModel(),[m
[31m-                version: getVersion(),[m
[31m-                uuid: null[m
[31m-            });[m
[31m-        }, 0);[m
[31m-    }[m
[31m-};[m
[31m-[m
[31m-require("cordova/exec/proxy").add("Device", module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/src/tizen/DeviceProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-device/src/tizen/DeviceProxy.js[m
[1mdeleted file mode 100644[m
[1mindex 973b716..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/src/tizen/DeviceProxy.js[m
[1m+++ /dev/null[m
[36m@@ -1,38 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-var tizen = require('cordova/platform');[m
[31m-[m
[31m-module.exports = {[m
[31m-    getDeviceInfo: function(success, error) {[m
[31m-        setTimeout(function () {[m
[31m-            success({[m
[31m-                cordova: tizen.cordovaVersion,[m
[31m-                platform: 'tizen',[m
[31m-                model: null,[m
[31m-                version: null,[m
[31m-                uuid: null[m
[31m-            });[m
[31m-        }, 0);[m
[31m-    }[m
[31m-};[m
[31m-[m
[31m-require("cordova/tizen/commandProxy").add("Device", module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/src/ubuntu/device.cpp b/cordova_exchange_dist/plugins/cordova-plugin-device/src/ubuntu/device.cpp[m
[1mdeleted file mode 100644[m
[1mindex eb5a012..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/src/ubuntu/device.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,64 +0,0 @@[m
[31m-/*[m
[31m- *  Copyright 2011 Wolfgang Koller - http://www.gofg.at/[m
[31m- *[m
[31m- *  Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- *  you may not use this file except in compliance with the License.[m
[31m- *  You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- *  Unless required by applicable law or agreed to in writing, software[m
[31m- *  distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- *  See the License for the specific language governing permissions and[m
[31m- *  limitations under the License.[m
[31m- */[m
[31m-[m
[31m-#include <QDeviceInfo>[m
[31m-#include <QtSystemInfo>[m
[31m-[m
[31m-#include"device.h"[m
[31m-[m
[31m-#define CORDOVA "3.0.0"[m
[31m-[m
[31m-Device::Device(Cordova *cordova) : CPlugin(cordova) {[m
[31m-}[m
[31m-[m
[31m-static QString getOSName() {[m
[31m-#ifdef Q_OS_SYMBIAN[m
[31m-    QString platform = "Symbian";[m
[31m-#endif[m
[31m-#ifdef Q_OS_WIN[m
[31m-    QString platform = "Windows";[m
[31m-#endif[m
[31m-#ifdef Q_OS_WINCE[m
[31m-    QString platform = "Windows CE";[m
[31m-#endif[m
[31m-#ifdef Q_OS_LINUX[m
[31m-    QString platform = "Linux";[m
[31m-#endif[m
[31m-    return platform;[m
[31m-}[m
[31m-[m
[31m-void Device::getInfo(int scId, int ecId) {[m
[31m-    Q_UNUSED(ecId)[m
[31m-[m
[31m-    QDeviceInfo systemDeviceInfo;[m
[31m-    QDeviceInfo systemInfo;[m
[31m-[m
[31m-    QString platform = getOSName();[m
[31m-[m
[31m-    QString uuid = systemDeviceInfo.uniqueDeviceID();[m
[31m-    if (uuid.isEmpty()) {[m
[31m-        QString deviceDescription = systemInfo.imei(0) + ";" + systemInfo.manufacturer() + ";" + systemInfo.model() + ";" + systemInfo.productName() + ";" + platform;[m
[31m-        QString user = qgetenv("USER");[m
[31m-        if (user.isEmpty()) {[m
[31m-            user = qgetenv("USERNAME");[m
[31m-            if (user.isEmpty())[m
[31m-                user = QDir::homePath();[m
[31m-        }[m
[31m-        uuid = QString(QCryptographicHash::hash((deviceDescription + ";" + user).toUtf8(), QCryptographicHash::Md5).toHex());[m
[31m-    }[m
[31m-[m
[31m-    this->cb(scId, systemDeviceInfo.model(), CORDOVA, platform, uuid, systemInfo.version(QDeviceInfo::Os));[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/src/ubuntu/device.h b/cordova_exchange_dist/plugins/cordova-plugin-device/src/ubuntu/device.h[m
[1mdeleted file mode 100644[m
[1mindex 91cb937..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/src/ubuntu/device.h[m
[1m+++ /dev/null[m
[36m@@ -1,47 +0,0 @@[m
[31m-/*[m
[31m- *  Copyright 2011 Wolfgang Koller - http://www.gofg.at/[m
[31m- *[m
[31m- *  Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- *  you may not use this file except in compliance with the License.[m
[31m- *  You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- *  Unless required by applicable law or agreed to in writing, software[m
[31m- *  distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- *  See the License for the specific language governing permissions and[m
[31m- *  limitations under the License.[m
[31m- */[m
[31m-[m
[31m-#ifndef DEVICE_H_FDSAFAS[m
[31m-#define DEVICE_H_FDSAFAS[m
[31m-[m
[31m-#include <QtCore>[m
[31m-[m
[31m-#include <cplugin.h>[m
[31m-[m
[31m-class Device: public CPlugin {[m
[31m-    Q_OBJECT[m
[31m-public:[m
[31m-    explicit Device(Cordova *cordova);[m
[31m-[m
[31m-    virtual const QString fullName() override {[m
[31m-        return Device::fullID();[m
[31m-    }[m
[31m-[m
[31m-    virtual const QString shortName() override {[m
[31m-        return "Device";[m
[31m-    }[m
[31m-[m
[31m-    static const QString fullID() {[m
[31m-        return "com.cordova.Device";[m
[31m-    }[m
[31m-[m
[31m-signals:[m
[31m-[m
[31m-public slots:[m
[31m-    void getInfo(int scId, int ecId);[m
[31m-};[m
[31m-[m
[31m-#endif[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/src/ubuntu/device.js b/cordova_exchange_dist/plugins/cordova-plugin-device/src/ubuntu/device.js[m
[1mdeleted file mode 100644[m
[1mindex 838586c..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/src/ubuntu/device.js[m
[1m+++ /dev/null[m
[36m@@ -1,33 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* global Cordova */[m
[31m-[m
[31m-module.exports = {[m
[31m-    getInfo:function(win,fail,args) {[m
[31m-        Cordova.exec(function (model, cordova, platform, uuid, version) {[m
[31m-            win({name: name, model: model, cordova: cordova,[m
[31m-                 platform: platform, uuid: uuid, version: version});[m
[31m-        }, null, "com.cordova.Device", "getInfo", []);[m
[31m-    }[m
[31m-};[m
[31m-[m
[31m-require("cordova/exec/proxy").add("Device", module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/src/windows/DeviceProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-device/src/windows/DeviceProxy.js[m
[1mindex f338ad3..ccaaaee 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/src/windows/DeviceProxy.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-device/src/windows/DeviceProxy.js[m
[36m@@ -21,16 +21,16 @@[m
 [m
 /* global Windows, createUUID */[m
 [m
[31m-var ROOT_CONTAINER = "{00000000-0000-0000-FFFF-FFFFFFFFFFFF}";[m
[31m-var DEVICE_CLASS_KEY = "{A45C254E-DF1C-4EFD-8020-67D146A850E0},10";[m
[31m-var DEVICE_CLASS_KEY_NO_SEMICOLON = "{A45C254E-DF1C-4EFD-8020-67D146A850E0}10";[m
[31m-var ROOT_CONTAINER_QUERY = "System.Devices.ContainerId:=\"" + ROOT_CONTAINER + "\"";[m
[31m-var HAL_DEVICE_CLASS = "4d36e966-e325-11ce-bfc1-08002be10318";[m
[31m-var DEVICE_DRIVER_VERSION_KEY = "{A8B865DD-2E3D-4094-AD97-E593A70C75D6},3";[m
[32m+[m[32mvar ROOT_CONTAINER = '{00000000-0000-0000-FFFF-FFFFFFFFFFFF}';[m
[32m+[m[32mvar DEVICE_CLASS_KEY = '{A45C254E-DF1C-4EFD-8020-67D146A850E0},10';[m
[32m+[m[32mvar DEVICE_CLASS_KEY_NO_SEMICOLON = '{A45C254E-DF1C-4EFD-8020-67D146A850E0}10';[m
[32m+[m[32mvar ROOT_CONTAINER_QUERY = 'System.Devices.ContainerId:="' + ROOT_CONTAINER + '"';[m
[32m+[m[32mvar HAL_DEVICE_CLASS = '4d36e966-e325-11ce-bfc1-08002be10318';[m
[32m+[m[32mvar DEVICE_DRIVER_VERSION_KEY = '{A8B865DD-2E3D-4094-AD97-E593A70C75D6},3';[m
 [m
 module.exports = {[m
 [m
[31m-    getDeviceInfo:function(win, fail, args) {[m
[32m+[m[32m    getDeviceInfo: function (win, fail, args) {[m
 [m
         // deviceId aka uuid, stored in Windows.Storage.ApplicationData.current.localSettings.values.deviceId[m
         var deviceId;[m
[36m@@ -38,8 +38,7 @@[m [mmodule.exports = {[m
         var localSettings = Windows.Storage.ApplicationData.current.localSettings;[m
         if (localSettings.values.deviceId) {[m
             deviceId = localSettings.values.deviceId;[m
[31m-        }[m
[31m-        else {[m
[32m+[m[32m        } else {[m
             // App-specific hardware id could be used as uuid, but it changes if the hardware changes...[m
             try {[m
                 var ASHWID = Windows.System.Profile.HardwareIdentification.getPackageSpecificToken(null).id;[m
[36m@@ -48,22 +47,21 @@[m [mmodule.exports = {[m
                 // Couldn't get the hardware UUID[m
                 deviceId = createUUID();[m
             }[m
[31m-            //...so cache it per-install[m
[32m+[m[32m            // ...so cache it per-install[m
             localSettings.values.deviceId = deviceId;[m
         }[m
 [m
[31m-[m
         var userAgent = window.clientInformation.userAgent;[m
         // this will report "windows" in windows8.1 and windows phone 8.1 apps[m
         // and "windows8" in windows 8.0 apps similar to cordova.js[m
         // See https://github.com/apache/cordova-js/blob/master/src/windows/platform.js#L25[m
[31m-        var devicePlatform = userAgent.indexOf("MSAppHost/1.0") == -1 ? "windows" : "windows8";[m
[32m+[m[32m        var devicePlatform = userAgent.indexOf('MSAppHost/1.0') === -1 ? 'windows' : 'windows8';[m
         var versionString = userAgent.match(/Windows (?:Phone |NT )?([0-9.]+)/)[1];[m
 [m
         var deviceInfo = new Windows.Security.ExchangeActiveSyncProvisioning.EasClientDeviceInformation();[m
         // Running in the Windows Simulator is a remote session.[m
         // Running in the Windows Phone Emulator has the systemProductName set to "Virtual"[m
[31m-        var isVirtual = Windows.System.RemoteDesktop.InteractiveSession.isRemote || deviceInfo.systemProductName == "Virtual";[m
[32m+[m[32m        var isVirtual = Windows.System.RemoteDesktop.InteractiveSession.isRemote || deviceInfo.systemProductName === 'Virtual';[m
         var manufacturer = deviceInfo.systemManufacturer;[m
         var model = deviceInfo.systemProductName;[m
 [m
[36m@@ -73,26 +71,26 @@[m [mmodule.exports = {[m
                                 [DEVICE_DRIVER_VERSION_KEY, DEVICE_CLASS_KEY],[m
                                 ROOT_CONTAINER_QUERY)[m
         .then(function (rootDevices) {[m
[31m-                for (var i = 0; i < rootDevices.length; i++) {[m
[31m-                    var rootDevice = rootDevices[i];[m
[31m-                    if (!rootDevice.properties) continue;[m
[31m-                    if (rootDevice.properties[DEVICE_CLASS_KEY_NO_SEMICOLON] == HAL_DEVICE_CLASS) {[m
[31m-                        versionString = rootDevice.properties[DEVICE_DRIVER_VERSION_KEY];[m
[31m-                        break;[m
[31m-                    }[m
[32m+[m[32m            for (var i = 0; i < rootDevices.length; i++) {[m
[32m+[m[32m                var rootDevice = rootDevices[i];[m
[32m+[m[32m                if (!rootDevice.properties) continue;[m
[32m+[m[32m                if (rootDevice.properties[DEVICE_CLASS_KEY_NO_SEMICOLON] === HAL_DEVICE_CLASS) {[m
[32m+[m[32m                    versionString = rootDevice.properties[DEVICE_DRIVER_VERSION_KEY];[m
[32m+[m[32m                    break;[m
                 }[m
[32m+[m[32m            }[m
 [m
[31m-                setTimeout(function () {[m
[31m-                    win({ platform: devicePlatform,[m
[31m-                          version: versionString,[m
[31m-                          uuid: deviceId,[m
[31m-                          isVirtual: isVirtual,[m
[31m-                          model: model,[m
[31m-                          manufacturer:manufacturer});[m
[31m-                }, 0);[m
[32m+[m[32m            setTimeout(function () {[m
[32m+[m[32m                win({ platform: devicePlatform,[m
[32m+[m[32m                    version: versionString,[m
[32m+[m[32m                    uuid: deviceId,[m
[32m+[m[32m                    isVirtual: isVirtual,[m
[32m+[m[32m                    model: model,[m
[32m+[m[32m                    manufacturer: manufacturer});[m
[32m+[m[32m            }, 0);[m
         });[m
     }[m
 [m
 }; // exports[m
 [m
[31m-require("cordova/exec/proxy").add("Device", module.exports);[m
[32m+[m[32mrequire('cordova/exec/proxy').add('Device', module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/src/wp/Device.cs b/cordova_exchange_dist/plugins/cordova-plugin-device/src/wp/Device.cs[m
[1mdeleted file mode 100644[m
[1mindex 76fe8cf..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/src/wp/Device.cs[m
[1m+++ /dev/null[m
[36m@@ -1,87 +0,0 @@[m
[31m-﻿/*  [m
[31m-    Licensed under the Apache License, Version 2.0 (the "License");[m
[31m-    you may not use this file except in compliance with the License.[m
[31m-    You may obtain a copy of the License at[m
[31m-    [m
[31m-    http://www.apache.org/licenses/LICENSE-2.0[m
[31m-    [m
[31m-    Unless required by applicable law or agreed to in writing, software[m
[31m-    distributed under the License is distributed on an "AS IS" BASIS,[m
[31m-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m-    See the License for the specific language governing permissions and[m
[31m-    limitations under the License.[m
[31m-*/[m
[31m-[m
[31m-using Microsoft.Phone.Info;[m
[31m-using System;[m
[31m-using System.IO;[m
[31m-using System.IO.IsolatedStorage;[m
[31m-[m
[31m-namespace WPCordovaClassLib.Cordova.Commands[m
[31m-{[m
[31m-    public class Device : BaseCommand[m
[31m-    {[m
[31m-        public void getDeviceInfo(string notused)[m
[31m-        {[m
[31m-            string res = String.Format("\"name\":\"{0}\",\"platform\":\"{1}\",\"uuid\":\"{2}\",\"version\":\"{3}\",\"model\":\"{4}\",\"manufacturer\":\"{5}\",\"isVirtual\":{6}",[m
[31m-                                        DeviceStatus.DeviceName,[m
[31m-                                        Environment.OSVersion.Platform.ToString(),[m
[31m-                                        UUID,[m
[31m-                                        Environment.OSVersion.Version.ToString(),[m
[31m-                                        DeviceStatus.DeviceName,[m
[31m-                                        DeviceStatus.DeviceManufacturer,[m
[31m-                                        IsVirtual ? "true" : "false");[m
[31m-            DispatchCommandResult(new PluginResult(PluginResult.Status.OK, "{" + res + "}"));[m
[31m-        }[m
[31m-[m
[31m-[m
[31m-        public bool IsVirtual[m
[31m-        {[m
[31m-            get [m
[31m-            {[m
[31m-                return (Microsoft.Devices.Environment.DeviceType == Microsoft.Devices.DeviceType.Emulator);[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public string UUID[m
[31m-        {[m
[31m-            get[m
[31m-            {[m
[31m-                object id;[m
[31m-[m
[31m-                UserExtendedProperties.TryGetValue("ANID", out id);[m
[31m-                if (id != null)[m
[31m-                {[m
[31m-                    return id.ToString().Substring(2, 32);[m
[31m-                }[m
[31m-[m
[31m-                UserExtendedProperties.TryGetValue("ANID2", out id);[m
[31m-                if (id != null)[m
[31m-                {[m
[31m-                    return id.ToString();[m
[31m-                }[m
[31m-[m
[31m-                string returnVal = "???unknown???";[m
[31m-[m
[31m-                using (IsolatedStorageFile appStorage = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    try[m
[31m-                    {[m
[31m-                        IsolatedStorageFileStream fileStream = new IsolatedStorageFileStream("DeviceID.txt", FileMode.Open, FileAccess.Read, appStorage);[m
[31m-[m
[31m-                        using (StreamReader reader = new StreamReader(fileStream))[m
[31m-                        {[m
[31m-                            returnVal = reader.ReadLine();[m
[31m-                        }[m
[31m-                    }[m
[31m-                    catch (Exception /*ex*/)[m
[31m-                    {[m
[31m-[m
[31m-                    }[m
[31m-                }[m
[31m-[m
[31m-                return returnVal;[m
[31m-            }[m
[31m-        }[m
[31m-    }[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/tests/plugin.xml b/cordova_exchange_dist/plugins/cordova-plugin-device/tests/plugin.xml[m
[1mindex 4efeaf6..afb700b 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/tests/plugin.xml[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-device/tests/plugin.xml[m
[36m@@ -22,7 +22,7 @@[m
     xmlns:rim="http://www.blackberry.com/ns/widgets"[m
     xmlns:android="http://schemas.android.com/apk/res/android"[m
     id="cordova-plugin-device-tests"[m
[31m-    version="1.1.4">[m
[32m+[m[32m    version="2.0.2">[m
     <name>Cordova Device Plugin Tests</name>[m
     <license>Apache 2.0</license>[m
 [m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/tests/tests.js b/cordova_exchange_dist/plugins/cordova-plugin-device/tests/tests.js[m
[1mindex ac9a281..03e1fc7 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/tests/tests.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-device/tests/tests.js[m
[36m@@ -19,72 +19,72 @@[m
  *[m
 */[m
 [m
[31m-/* jshint jasmine: true */[m
[32m+[m[32m/* eslint-env jasmine */[m
[32m+[m
[32m+[m[32mexports.defineAutoTests = function () {[m
[32m+[m[32m    describe('Device Information (window.device)', function () {[m
[32m+[m[32m        it('should exist', function () {[m
[32m+[m[32m            expect(window.device).toBeDefined();[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        it('should contain a platform specification that is a string', function () {[m
[32m+[m[32m            expect(window.device.platform).toBeDefined();[m
[32m+[m[32m            expect((String(window.device.platform)).length > 0).toBe(true);[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        it('should contain a version specification that is a string', function () {[m
[32m+[m[32m            expect(window.device.version).toBeDefined();[m
[32m+[m[32m            expect((String(window.device.version)).length > 0).toBe(true);[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        it('should contain a UUID specification that is a string or a number', function () {[m
[32m+[m[32m            expect(window.device.uuid).toBeDefined();[m
[32m+[m[32m            if (typeof window.device.uuid === 'string' || typeof window.device.uuid === 'object') {[m
[32m+[m[32m                expect((String(window.device.uuid)).length > 0).toBe(true);[m
[32m+[m[32m            } else {[m
[32m+[m[32m                expect(window.device.uuid > 0).toBe(true);[m
[32m+[m[32m            }[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        it('should contain a cordova specification that is a string', function () {[m
[32m+[m[32m            expect(window.device.cordova).toBeDefined();[m
[32m+[m[32m            expect((String(window.device.cordova)).length > 0).toBe(true);[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        it('should depend on the presence of cordova.version string', function () {[m
[32m+[m[32m            expect(window.cordova.version).toBeDefined();[m
[32m+[m[32m            expect((String(window.cordova.version)).length > 0).toBe(true);[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        it('should contain device.cordova equal to cordova.version', function () {[m
[32m+[m[32m            expect(window.device.cordova).toBe(window.cordova.version);[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        it('should contain a model specification that is a string', function () {[m
[32m+[m[32m            expect(window.device.model).toBeDefined();[m
[32m+[m[32m            expect((String(window.device.model)).length > 0).toBe(true);[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        it('should contain a manufacturer property that is a string', function () {[m
[32m+[m[32m            expect(window.device.manufacturer).toBeDefined();[m
[32m+[m[32m            expect((String(window.device.manufacturer)).length > 0).toBe(true);[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        it('should contain an isVirtual property that is a boolean', function () {[m
[32m+[m[32m            expect(window.device.isVirtual).toBeDefined();[m
[32m+[m[32m            expect(typeof window.device.isVirtual).toBe('boolean');[m
[32m+[m[32m        });[m
[32m+[m
[32m+[m[32m        it('should contain a serial number specification that is a string', function () {[m
[32m+[m[32m            expect(window.device.serial).toBeDefined();[m
[32m+[m[32m            expect((String(window.device.serial)).length > 0).toBe(true);[m
[32m+[m
[32m+[m[32m        });[m
 [m
[31m-exports.defineAutoTests = function() {[m
[31m-  describe('Device Information (window.device)', function () {[m
[31m-    it("should exist", function() {[m
[31m-      expect(window.device).toBeDefined();[m
     });[m
[31m-[m
[31m-    it("should contain a platform specification that is a string", function() {[m
[31m-      expect(window.device.platform).toBeDefined();[m
[31m-      expect((String(window.device.platform)).length > 0).toBe(true);[m
[31m-    });[m
[31m-[m
[31m-    it("should contain a version specification that is a string", function() {[m
[31m-      expect(window.device.version).toBeDefined();[m
[31m-      expect((String(window.device.version)).length > 0).toBe(true);[m
[31m-    });[m
[31m-[m
[31m-    it("should contain a UUID specification that is a string or a number", function() {[m
[31m-      expect(window.device.uuid).toBeDefined();[m
[31m-      if (typeof window.device.uuid == 'string' || typeof window.device.uuid == 'object') {[m
[31m-        expect((String(window.device.uuid)).length > 0).toBe(true);[m
[31m-      } else {[m
[31m-        expect(window.device.uuid > 0).toBe(true);[m
[31m-      }[m
[31m-    });[m
[31m-[m
[31m-    it("should contain a cordova specification that is a string", function() {[m
[31m-      expect(window.device.cordova).toBeDefined();[m
[31m-      expect((String(window.device.cordova)).length > 0).toBe(true);[m
[31m-    });[m
[31m-[m
[31m-    it("should depend on the presence of cordova.version string", function() {[m
[31m-      expect(window.cordova.version).toBeDefined();[m
[31m-      expect((String(window.cordova.version)).length > 0).toBe(true);[m
[31m-    });[m
[31m-[m
[31m-    it("should contain device.cordova equal to cordova.version", function() {[m
[31m-      expect(window.device.cordova).toBe(window.cordova.version);[m
[31m-    });[m
[31m-[m
[31m-    it("should contain a model specification that is a string", function() {[m
[31m-      expect(window.device.model).toBeDefined();[m
[31m-      expect((String(window.device.model)).length > 0).toBe(true);[m
[31m-    });[m
[31m-[m
[31m-    it("should contain a manufacturer property that is a string", function() {[m
[31m-      expect(window.device.manufacturer).toBeDefined();[m
[31m-      expect((String(window.device.manufacturer)).length > 0).toBe(true);[m
[31m-    });[m
[31m-[m
[31m-    it("should contain an isVirtual property that is a boolean", function() {[m
[31m-      expect(window.device.isVirtual).toBeDefined();[m
[31m-      expect(typeof window.device.isVirtual).toBe("boolean");[m
[31m-    });[m
[31m-[m
[31m-    it("should contain a serial number specification that is a string", function() {[m
[31m-      expect(window.device.serial).toBeDefined();[m
[31m-      expect((String(window.device.serial)).length > 0).toBe(true);[m
[31m-[m
[31m-    });[m
[31m-[m
[31m-  });[m
 };[m
 [m
[31m-exports.defineManualTests = function(contentEl, createActionButton) {[m
[32m+[m[32mexports.defineManualTests = function (contentEl, createActionButton) {[m
     var logMessage = function (message, color) {[m
         var log = document.getElementById('info');[m
         var logLine = document.createElement('div');[m
[36m@@ -106,8 +106,8 @@[m [mexports.defineManualTests = function(contentEl, createActionButton) {[m
 [m
     contentEl.innerHTML = '<div id="info"></div>' + device_tests;[m
 [m
[31m-    createActionButton('Dump device', function() {[m
[31m-      clearLog();[m
[31m-      logMessage(JSON.stringify(window.device, null, '\t'));[m
[31m-    }, "dump_device");[m
[32m+[m[32m    createActionButton('Dump device', function () {[m
[32m+[m[32m        clearLog();[m
[32m+[m[32m        logMessage(JSON.stringify(window.device, null, '\t'));[m
[32m+[m[32m    }, 'dump_device');[m
 };[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-device/www/device.js b/cordova_exchange_dist/plugins/cordova-plugin-device/www/device.js[m
[1mindex f7ed19f..41ed04f 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-device/www/device.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-device/www/device.js[m
[36m@@ -19,11 +19,11 @@[m
  *[m
 */[m
 [m
[31m-var argscheck = require('cordova/argscheck'),[m
[31m-    channel = require('cordova/channel'),[m
[31m-    utils = require('cordova/utils'),[m
[31m-    exec = require('cordova/exec'),[m
[31m-    cordova = require('cordova');[m
[32m+[m[32mvar argscheck = require('cordova/argscheck');[m
[32m+[m[32mvar channel = require('cordova/channel');[m
[32m+[m[32mvar utils = require('cordova/utils');[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar cordova = require('cordova');[m
 [m
 channel.createSticky('onCordovaInfoReady');[m
 // Tell cordova channel to wait on the CordovaInfoReady event[m
[36m@@ -34,7 +34,7 @@[m [mchannel.waitForInitialization('onCordovaInfoReady');[m
  * phone, etc.[m
  * @constructor[m
  */[m
[31m-function Device() {[m
[32m+[m[32mfunction Device () {[m
     this.available = false;[m
     this.platform = null;[m
     this.version = null;[m
[36m@@ -47,10 +47,10 @@[m [mfunction Device() {[m
 [m
     var me = this;[m
 [m
[31m-    channel.onCordovaReady.subscribe(function() {[m
[31m-        me.getInfo(function(info) {[m
[31m-            //ignoring info.cordova returning from native, we should use value from cordova.version defined in cordova.js[m
[31m-            //TODO: CB-5105 native implementations should not return info.cordova[m
[32m+[m[32m    channel.onCordovaReady.subscribe(function () {[m
[32m+[m[32m        me.getInfo(function (info) {[m
[32m+[m[32m            // ignoring info.cordova returning from native, we should use value from cordova.version defined in cordova.js[m
[32m+[m[32m            // TODO: CB-5105 native implementations should not return info.cordova[m
             var buildLabel = cordova.version;[m
             me.available = true;[m
             me.platform = info.platform;[m
[36m@@ -62,9 +62,9 @@[m [mfunction Device() {[m
             me.manufacturer = info.manufacturer || 'unknown';[m
             me.serial = info.serial || 'unknown';[m
             channel.onCordovaInfoReady.fire();[m
[31m-        },function(e) {[m
[32m+[m[32m        }, function (e) {[m
             me.available = false;[m
[31m-            utils.alert("[ERROR] Error initializing Cordova: " + e);[m
[32m+[m[32m            utils.alert('[ERROR] Error initializing Cordova: ' + e);[m
         });[m
     });[m
 }[m
[36m@@ -75,9 +75,9 @@[m [mfunction Device() {[m
  * @param {Function} successCallback The function to call when the heading data is available[m
  * @param {Function} errorCallback The function to call when there is an error getting the heading data. (OPTIONAL)[m
  */[m
[31m-Device.prototype.getInfo = function(successCallback, errorCallback) {[m
[32m+[m[32mDevice.prototype.getInfo = function (successCallback, errorCallback) {[m
     argscheck.checkArgs('fF', 'Device.getInfo', arguments);[m
[31m-    exec(successCallback, errorCallback, "Device", "getDeviceInfo", []);[m
[32m+[m[32m    exec(successCallback, errorCallback, 'Device', 'getDeviceInfo', []);[m
 };[m
 [m
 module.exports = new Device();[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/README.md b/cordova_exchange_dist/plugins/cordova-plugin-file/README.md[m
[1mindex 8a50749..1e21ed4 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/README.md[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/README.md[m
[36m@@ -21,9 +21,9 @@[m [mdescription: Read/write files on the device.[m
 #         under the License.[m
 -->[m
 [m
[31m-|Android|iOS| Windows 8.1 Store | Windows 8.1 Phone | Windows 10 Store | Travis CI |[m
[31m-|:-:|:-:|:-:|:-:|:-:|:-:|[m
[31m-|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=android,PLUGIN=cordova-plugin-file)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=android,PLUGIN=cordova-plugin-file/)|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=ios,PLUGIN=cordova-plugin-file)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=ios,PLUGIN=cordova-plugin-file/)|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=windows-8.1-store,PLUGIN=cordova-plugin-file)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=windows-8.1-store,PLUGIN=cordova-plugin-file/)|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=windows-8.1-phone,PLUGIN=cordova-plugin-file)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=windows-8.1-phone,PLUGIN=cordova-plugin-file/)|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=windows-10-store,PLUGIN=cordova-plugin-file)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=windows-10-store,PLUGIN=cordova-plugin-file/)|[![Build Status](https://travis-ci.org/apache/cordova-plugin-file.svg?branch=master)](https://travis-ci.org/apache/cordova-plugin-file)|[m
[32m+[m[32m|AppVeyor|Travis CI|[m
[32m+[m[32m|:-:|:-:|[m
[32m+[m[32m|[![Build status](https://ci.appveyor.com/api/projects/status/github/apache/cordova-plugin-file?branch=master)](https://ci.appveyor.com/project/ApacheSoftwareFoundation/cordova-plugin-file)|[![Build Status](https://travis-ci.org/apache/cordova-plugin-file.svg?branch=master)](https://travis-ci.org/apache/cordova-plugin-file)|[m
 [m
 # cordova-plugin-file[m
 [m
[36m@@ -66,14 +66,9 @@[m [mReport issues on the [Apache Cordova issue tracker](https://issues.apache.org/ji[m
 [m
 ## Supported Platforms[m
 [m
[31m-- Amazon Fire OS[m
 - Android[m
[31m-- BlackBerry 10[m
[31m-- Firefox OS[m
 - iOS[m
 - OS X[m
[31m-- Windows Phone 7 and 8*[m
[31m-- Windows 8*[m
 - Windows*[m
 - Browser[m
 [m
[36m@@ -171,7 +166,7 @@[m [mthe `cordova.file.*` properties map to physical paths on a real device.[m
 | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`Documents` |                             | documents                 | r/w  |     Yes     |     No    |   Yes   |[m
 | `<sdcard>/`                                     | externalRootDirectory       | sdcard                    | r/w  |     Yes     |     No    |   No    |[m
 | &nbsp;&nbsp;&nbsp;`Android/data/<app-id>/`      | externalApplicationStorageDirectory | -                 | r/w  |     Yes     |     No    |   No    |[m
[31m-| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`cache`     | externalCacheDirectry       | cache-external            | r/w  |     Yes     |     No\*\*|   No    |[m
[32m+[m[32m| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`cache`     | externalCacheDirectory       | cache-external            | r/w  |     Yes     |     No\*\*|   No    |[m
 | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`files`     | externalDataDirectory       | files-external            | r/w  |     Yes     |     No    |   No    |[m
 [m
 \* The OS may periodically clear this directory, but do not rely on this behavior. Clear[m
[36m@@ -185,19 +180,6 @@[m [mthe `cordova.file.*` properties map to physical paths on a real device.[m
 **Note**: If external storage can't be mounted, the `cordova.file.external*`[m
 properties are `null`.[m
 [m
[31m-### BlackBerry 10 File System Layout[m
[31m-[m
[31m-| Device Path                                                  | `cordova.file.*`            | r/w? | persistent? | OS clears | private |[m
[31m-|:-------------------------------------------------------------|:----------------------------|:----:|:-----------:|:---------:|:-------:|[m
[31m-| `file:///accounts/1000/appdata/<app id>/`                    | applicationStorageDirectory | r    |     N/A     |     N/A   |   Yes   |[m
[31m-| &nbsp;&nbsp;&nbsp;`app/native`                               | applicationDirectory        | r    |     N/A     |     N/A   |   Yes   |[m
[31m-| &nbsp;&nbsp;&nbsp;`data/webviews/webfs/temporary/local__0`   | cacheDirectory              | r/w  |     No      |     Yes   |   Yes   |[m
[31m-| &nbsp;&nbsp;&nbsp;`data/webviews/webfs/persistent/local__0`  | dataDirectory               | r/w  |     Yes     |     No    |   Yes   |[m
[31m-| `file:///accounts/1000/removable/sdcard`                     | externalRemovableDirectory  | r/w  |     Yes     |     No    |   No    |[m
[31m-| `file:///accounts/1000/shared`                               | sharedDirectory             | r/w  |     Yes     |     No    |   No    |[m
[31m-[m
[31m-*Note*: When application is deployed to work perimeter, all paths are relative to /accounts/1000-enterprise.[m
[31m-[m
 ### OS X File System Layout[m
 [m
 | Device Path                                      | `cordova.file.*`            | `iosExtraFileSystems` | r/w? |  OS clears | private |[m
[36m@@ -329,21 +311,6 @@[m [munable to access their previously-stored files.[m
 If your application is new, or has never previously stored files in the[m
 persistent filesystem, then the `Library` setting is generally recommended.[m
 [m
[31m-## Firefox OS Quirks[m
[31m-[m
[31m-The File System API is not natively supported by Firefox OS and is implemented[m
[31m-as a shim on top of indexedDB.[m
[31m-[m
[31m-* Does not fail when removing non-empty directories[m
[31m-* Does not support metadata for directories[m
[31m-* Methods `copyTo` and `moveTo` do not support directories[m
[31m-[m
[31m-The following data paths are supported:[m
[31m-* `applicationDirectory` - Uses `xhr` to get local files that are packaged with the app.[m
[31m-* `dataDirectory` - For persistent app-specific data files.[m
[31m-* `cacheDirectory` - Cached files that should survive app restarts (Apps should not rely[m
[31m-on the OS to delete files in here).[m
[31m-[m
 ## Browser Quirks[m
 [m
 ### Common quirks and remarks[m
[36m@@ -571,7 +538,7 @@[m [mThe File plugin allows you to do things like store files in a temporary or persi[m
 [m
 Before you use the File plugin APIs, you can get access to the file system using `requestFileSystem`. When you do this, you can request either persistent or temporary storage. Persistent storage will not be removed unless permission is granted by the user.[m
 [m
[31m-When you get file system access using `requestFileSystem`, access is granted for the sandboxed file system only (the sandbox limits access to the app itself), not for general access to any file system location on the device. (To access file system locations outside the sandboxed storage, use other methods such as window.requestLocalFileSystemURL, which support platform-specific locations. For one example of this, see _Append a File_.)[m
[32m+[m[32mWhen you get file system access using `requestFileSystem`, access is granted for the sandboxed file system only (the sandbox limits access to the app itself), not for general access to any file system location on the device. (To access file system locations outside the sandboxed storage, use other methods such as window.resolveLocalFileSystemURL, which support platform-specific locations. For one example of this, see _Append a File_.)[m
 [m
 Here is a request for persistent storage.[m
 [m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/RELEASENOTES.md b/cordova_exchange_dist/plugins/cordova-plugin-file/RELEASENOTES.md[m
[1mindex fd57274..40ff79e 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/RELEASENOTES.md[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/RELEASENOTES.md[m
[36m@@ -1,444 +1,3 @@[m
[31m-<!--[m
[31m-#[m
[31m-# Licensed to the Apache Software Foundation (ASF) under one[m
[31m-# or more contributor license agreements.  See the NOTICE file[m
[31m-# distributed with this work for additional information[m
[31m-# regarding copyright ownership.  The ASF licenses this file[m
[31m-# to you under the Apache License, Version 2.0 (the[m
[31m-# "License"); you may not use this file except in compliance[m
[31m-# with the License.  You may obtain a copy of the License at[m
[31m-# [m
[31m-# http://www.apache.org/licenses/LICENSE-2.0[m
[31m-# [m
[31m-# Unless required by applicable law or agreed to in writing,[m
[31m-# software distributed under the License is distributed on an[m
[31m-# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-#  KIND, either express or implied.  See the License for the[m
[31m-# specific language governing permissions and limitations[m
[31m-# under the License.[m
[31m-#[m
[31m--->[m
[31m-# Release Notes[m
[32m+[m[32m### 6.0.1 (Dec 27, 2017)[m
[32m+[m[32m* [CB-13704](https://issues.apache.org/jira/browse/CB-13704) Fix to allow 6.0.0 version install[m
 [m
[31m-### 4.3.1 (Dec 07, 2016)[m
[31m-* [CB-12112](https://issues.apache.org/jira/browse/CB-12112) windows: Make available to move folder trees[m
[31m-* fix ENCODING_ERR for applicationDirectory[m
[31m-* [CB-11848](https://issues.apache.org/jira/browse/CB-11848) windows: Remove duplicate slash after file system path[m
[31m-* [CB-11917](https://issues.apache.org/jira/browse/CB-11917) - Remove pull request template checklist item: "iCLA has been submitted…"[m
[31m-* [CB-11947](https://issues.apache.org/jira/browse/CB-11947) fixed typo that occurs when adding file-transfer plugin[m
[31m-* [CB-11832](https://issues.apache.org/jira/browse/CB-11832) Incremented plugin version.[m
[31m-[m
[31m-### 4.3.0 (Sep 08, 2016)[m
[31m-* [CB-11795](https://issues.apache.org/jira/browse/CB-11795) Add 'protective' entry to cordovaDependencies[m
[31m-* Add handling for `SecurityException`[m
[31m-* [CB-11368](https://issues.apache.org/jira/browse/CB-11368) **android**: Resolve content `URLs` produced by contacts plugin[m
[31m-* Plugin uses `Android Log class` and not `Cordova LOG class`[m
[31m-* [CB-11693](https://issues.apache.org/jira/browse/CB-11693) **ios**: Run copy and move operations in the background thread[m
[31m-* [CB-11699](https://issues.apache.org/jira/browse/CB-11699) Read files as Data URLs properly[m
[31m-* [CB-11305](https://issues.apache.org/jira/browse/CB-11305) Enable `cdvfile: assets fs root` for `DOM` requests[m
[31m-* [CB-11385](https://issues.apache.org/jira/browse/CB-11385) android: Import java.nio.charset.Charset in LocalFileSystem class[m
[31m-* Add badges for paramedic builds on Jenkins[m
[31m-* [CB-11407](https://issues.apache.org/jira/browse/CB-11407) ios: added extern keyword to constants to fix phonegap-webview-ios template issue.[m
[31m-* [CB-11385](https://issues.apache.org/jira/browse/CB-11385) **android**: Does not pass sonarqube scan[m
[31m-* Add pull request template.[m
[31m-* Minor edits to the `README.md`[m
[31m-* [CB-11142](https://issues.apache.org/jira/browse/CB-11142) Fix the `NeedPermission` code for the case when external media is not mounted in Android[m
[31m-* [CB-11003](https://issues.apache.org/jira/browse/CB-11003) Adding samples to Readme.[m
[31m-* [CB-10996](https://issues.apache.org/jira/browse/CB-10996) Adding front matter to README.md[m
[31m-* [CB-11115](https://issues.apache.org/jira/browse/CB-11115) **android**: Removing dependency on FileDescriptor toString in content provider tests[m
[31m-[m
[31m-### 4.2.0 (Apr 15, 2016)[m
[31m-* [CB-10960](https://issues.apache.org/jira/browse/CB-10960) Uncaught `#<FileError>` in `write()` when `readyState != WRITING ?`[m
[31m-* Replace `PermissionHelper.java` with `cordova-plugin-compat`[m
[31m-* [CB-10977](https://issues.apache.org/jira/browse/CB-10977) **Android** Removing global state used for permission requests[m
[31m-* CB-10798, [CB-10384](https://issues.apache.org/jira/browse/CB-10384) Fixing permissions for **Marshmallow**.[m
[31m-* Fix test failure on **WP 8.1**[m
[31m-* [CB-10577](https://issues.apache.org/jira/browse/CB-10577) **Windows** `resolveLocalFileSystemURL` should omit trailing slash for file[m
[31m-* [CB-7862](https://issues.apache.org/jira/browse/CB-7862) `FileReader` reads large files in chunks with progress.[m
[31m-* [CB-10577](https://issues.apache.org/jira/browse/CB-10577) **Android** `resolveLocalFileSystemURL` should detect directory vs file.[m
[31m-* [CB-9753](https://issues.apache.org/jira/browse/CB-9753) index out of bounds on `requestFileSystem`.[m
[31m-* Remove `warning` emoji, as it doesn't correctly display in the docs website: cordova.apache.org/docs/en/dev/cordova-plugin-file/index.html. This closes #166[m
[31m-* [CB-10636](https://issues.apache.org/jira/browse/CB-10636) Add `JSHint` for plugins[m
[31m-* [CB-10411](https://issues.apache.org/jira/browse/CB-10411) Error in `file.spec.129` of `cordova-plugin-file`[m
[31m-[m
[31m-### 4.1.1 (Feb 09, 2016)[m
[31m-* Edit package.json license to match SPDX id[m
[31m-* [CB-10419](https://issues.apache.org/jira/browse/CB-10419) cordova-plugin-file 4.0.0 error with browserify workflow[m
[31m-[m
[31m-### 4.1.0 (Jan 15, 2016)[m
[31m-* added `.ratignore` file[m
[31m-* [CB-10319](https://issues.apache.org/jira/browse/CB-10319) **android** Adding reflective helper methods for permission requests[m
[31m-* [CB-10023](https://issues.apache.org/jira/browse/CB-10023) Fix `proxy not found error` on Chrome.[m
[31m-* [CB-8863](https://issues.apache.org/jira/browse/CB-8863) **ios** Fix block usage of self[m
[31m-[m
[31m-### 4.0.0 (Nov 18, 2015)[m
[31m-* [CB-10035](https://issues.apache.org/jira/browse/CB-10035) Updated `RELEASENOTES` to be newest to oldest[m
[31m-* [CB-8497](https://issues.apache.org/jira/browse/CB-8497) Fix handling of file paths with `#` character[m
[31m-* Do not inject default `AndroidPersistentFileLocation` into `config.xml`[m
[31m-* [CB-9891](https://issues.apache.org/jira/browse/CB-9891): Fix permission errors due to `URI encoding` inconsistency on **Android**[m
[31m-* Fixed `NullPointer Exception` in **Android 5** and above due to invalid column name on cursor[m
[31m-* Fix default persistent file location[m
[31m-* fix `applicationDirectory` to use `ms-appx:///`[m
[31m-* Add **Windows** paths to `cordova.file` object[m
[31m-* [CB-9851](https://issues.apache.org/jira/browse/CB-9851) Document `cdvfile` protocol quirk - using `cdvfile://` in the `DOM` is not supported on **Windows**[m
[31m-* [CB-9752](https://issues.apache.org/jira/browse/CB-9752) `getDirectory` fails on valid directory with assets filesystem[m
[31m-* [CB-7253](https://issues.apache.org/jira/browse/CB-7253) `requestFileSystem` fails when no external storage is present[m
[31m-* Adding permissions for **Marshmallow**. Now supports **Anrdoid 6.0**[m
[31m-* Fixing contribute link.[m
[31m-* always use setters to fix memory issues without `ARC` for **iOS**[m
[31m-* [CB-9331](https://issues.apache.org/jira/browse/CB-9331) `getFreeDiskSpace` **iOS**.[m
[31m-* override `resolveLocalFileSystemURL` by `webkitResolveLocalFileSystemURL` for **browser** platform add `.project` into git ignore list[m
[31m-* Fail with `FileError.ENCODING_ERR` on encoding exception.[m
[31m-* [CB-9544](https://issues.apache.org/jira/browse/CB-9544) Add file plugin for **OSX**[m
[31m-* [CB-9539](https://issues.apache.org/jira/browse/CB-9539) Fixed test failure on **Android** emulator[m
[31m-* Added docs on `CSP` rules needed for using `cdvfile` in DOM src. This closes #120[m
[31m-* Added `cdvfile` protocol purpose description and examples[m
[31m-[m
[31m-### 3.0.0 (Aug 18, 2015)[m
[31m-* Make Android default persistent file location internal[m
[31m-* Fixed issue with file paths not existing when using browserify[m
[31m-* [CB-9251](https://issues.apache.org/jira/browse/CB-9251): Changed from Intents to Preferences object as per the issue[m
[31m-* [CB-9215](https://issues.apache.org/jira/browse/CB-9215) Add cordova-plugin-file manual test for windows platform[m
[31m-[m
[31m-### 2.1.0 (Jun 17, 2015)[m
[31m-* added missing license header[m
[31m-* [CB-9128](https://issues.apache.org/jira/browse/CB-9128) cordova-plugin-file documentation translation: cordova-plugin-file[m
[31m-* fix npm md[m
[31m-* [CB-8844](https://issues.apache.org/jira/browse/CB-8844) Increased timeout for asset tests[m
[31m-* Updated resolveFileSystem.js so it can be parsed by uglifyJS[m
[31m-* [CB-8860](https://issues.apache.org/jira/browse/CB-8860) cordova-plugin-file documentation translation: cordova-plugin-file[m
[31m-* [CB-8792](https://issues.apache.org/jira/browse/CB-8792) Fixes reading of json files using readAsText[m
[31m-[m
[31m-### 2.0.0 (Apr 15, 2015)[m
[31m-* [CB-8849](https://issues.apache.org/jira/browse/CB-8849) Fixed ReadAsArrayBuffer to return ArrayBuffer and not Array on WP8[m
[31m-* [CB-8819](https://issues.apache.org/jira/browse/CB-8819) Fixed FileReader's readAsBinaryString on wp8[m
[31m-* [CB-8746](https://issues.apache.org/jira/browse/CB-8746) gave plugin major version bump[m
[31m-* [CB-8683](https://issues.apache.org/jira/browse/CB-8683) android: Fix broken unit tests from plugin rename[m
[31m-* [CB-8683](https://issues.apache.org/jira/browse/CB-8683) changed plugin-id to pacakge-name[m
[31m-* [CB-8653](https://issues.apache.org/jira/browse/CB-8653) properly updated translated docs to use new id[m
[31m-* [CB-8653](https://issues.apache.org/jira/browse/CB-8653) updated translated docs to use new id[m
[31m-* Use TRAVIS_BUILD_DIR, install paramedic by npm[m
[31m-* docs: added Windows to supported platforms[m
[31m-* [CB-8699](https://issues.apache.org/jira/browse/CB-8699) [CB-6428](https://issues.apache.org/jira/browse/CB-6428) Fix uncompressed assets being copied as zero length files[m
[31m-* [CB-6428](https://issues.apache.org/jira/browse/CB-6428) android: Fix assets FileEntry having size of -1[m
[31m-* android: Move URLforFullPath into base class (and rename to localUrlforFullPath)[m
[31m-* [CB-6428](https://issues.apache.org/jira/browse/CB-6428) Mention build-extras.gradle in README[m
[31m-* [CB-7109](https://issues.apache.org/jira/browse/CB-7109) android: Parse arguments off of the main thread (close #97)[m
[31m-* [CB-8695](https://issues.apache.org/jira/browse/CB-8695) ios: Fix `blob.slice()` for `asset-library` URLs (close #105)[m
[31m-* Tweak build-extras.gradle to just read/write to main `assets/` instead of `build/`[m
[31m-* [CB-8689](https://issues.apache.org/jira/browse/CB-8689) Fix NPE in makeEntryForNativeUri (was affecting file-transfer)[m
[31m-* [CB-8675](https://issues.apache.org/jira/browse/CB-8675) Revert "CB-8351 ios: Use base64EncodedStringWithOptions instead of CordovaLib's class extension"[m
[31m-* [CB-8653](https://issues.apache.org/jira/browse/CB-8653) Updated Readme[m
[31m-* [CB-8659](https://issues.apache.org/jira/browse/CB-8659): ios: 4.0.x Compatibility: Remove use of initWebView method[m
[31m-* Add a cache to speed up AssetFilesystem directory listings[m
[31m-* [CB-8663](https://issues.apache.org/jira/browse/CB-8663) android: Don't notify MediaScanner of private files[m
[31m-* Don't log stacktrace for normal exceptions (e.g. file not found)[m
[31m-* android: Don't use LimitedInputStream when reading entire file (optimization)[m
[31m-* [CB-6428](https://issues.apache.org/jira/browse/CB-6428) android: Add support for directory copies from assets -> filesystem[m
[31m-* android: Add `listChildren()`: Java-consumable version of `readEntriesAtLocalURL()`[m
[31m-* [CB-6428](https://issues.apache.org/jira/browse/CB-6428) android: Add support for file:///android_asset URLs[m
[31m-* [CB-8642](https://issues.apache.org/jira/browse/CB-8642) android: Fix content URIs not working with resolve / copy[m
[31m-* Tweak tests to fail if deleteEntry fails (rather than time out)[m
[31m-* android: Ensure LocalFilesystemURL can only be created with "cdvfile" URLs[m
[31m-* android: Move CordovaResourceApi into Filesystem base class[m
[31m-* android: Use `CordovaResourceApi.mapUriToFile()` rather than own custom logic in ContentFilesystem[m
[31m-* android: Use Uri.parse rather than manual parsing in resolveLocalFileSystemURI[m
[31m-* Tweak test case that failed twice on error rather than just once[m
[31m-* android: Delete invalid JavaDoc (lint errors)[m
[31m-* android: Use CordovaResourceApi rather than FileHelper[m
[31m-* [CB-8032](https://issues.apache.org/jira/browse/CB-8032) - File Plugin - Add nativeURL external method support for CDVFileSystem->makeEntryForPath:isDirectory: (closes #96)[m
[31m-* [CB-8567](https://issues.apache.org/jira/browse/CB-8567) Integrate TravisCI[m
[31m-* [CB-8438](https://issues.apache.org/jira/browse/CB-8438) cordova-plugin-file documentation translation: cordova-plugin-file[m
[31m-* [CB-8538](https://issues.apache.org/jira/browse/CB-8538) Added package.json file[m
[31m-* [CB-7956](https://issues.apache.org/jira/browse/CB-7956) Add cordova-plugin-file support for browser platform[m
[31m-* [CB-8423](https://issues.apache.org/jira/browse/CB-8423) Corrected usage of done() in async tests[m
[31m-* [CB-8459](https://issues.apache.org/jira/browse/CB-8459) Fixes spec 111 failure due to incorrect relative paths handling[m
[31m-* Code cleanup, whitespace[m
[31m-* Added nativeURL property to FileEntry, implemented readAsArrayBuffer and readAsBinaryString[m
[31m-[m
[31m-### 1.3.3 (Feb 04, 2015)[m
[31m-* [CB-7927](https://issues.apache.org/jira/browse/CB-7927) Encoding data to bytes instead of chars when writing a file.[m
[31m-* ios: Fix compile warning about implicit int conversion[m
[31m-* [CB-8351](https://issues.apache.org/jira/browse/CB-8351) ios: Use base64EncodedStringWithOptions instead of CordovaLib's class extension[m
[31m-* [CB-8351](https://issues.apache.org/jira/browse/CB-8351) ios: Use argumentForIndex rather than NSArray extension[m
[31m-* [CB-8351](https://issues.apache.org/jira/browse/CB-8351) ios: Use a local copy of valueForKeyIsNumber rather than CordovaLib's version[m
[31m-* windows: Handle url's containing absolute windows path starting with drive letter and colon (encoded as %3A) through root FS[m
[31m-* windows: Rework to use normal url form[m
[31m-* android: refactor: Make Filesystem base class store its own name, rootUri, and rootEntry[m
[31m-* android: Simplify code a bit by making makeEntryForPath not throw JSONException[m
[31m-* [CB-6431](https://issues.apache.org/jira/browse/CB-6431) android: Fix plugin breaking content: URLs[m
[31m-* [CB-7375](https://issues.apache.org/jira/browse/CB-7375) Never create new FileSystem instances (except on windows since they don't implement requestAllFileSystems())[m
[31m-[m
[31m-### 1.3.2 (Dec 02, 2014)[m
[31m-* Gets rid of thread block error in File plugin[m
[31m-* [CB-7917](https://issues.apache.org/jira/browse/CB-7917) Made tests file.spec.114 - 116 pass for **Windows** platform[m
[31m-* [CB-7977](https://issues.apache.org/jira/browse/CB-7977) Mention `deviceready` in plugin docs[m
[31m-* [CB-7602](https://issues.apache.org/jira/browse/CB-7602): Fix `isCopyOnItself` logic[m
[31m-* [CB-7700](https://issues.apache.org/jira/browse/CB-7700) cordova-plugin-file documentation translation: cordova-plugin-file[m
[31m-* Use one proxy for both **Windows** and **Windows8** platforms[m
[31m-* [CB-6994](https://issues.apache.org/jira/browse/CB-6994) Fixes result, returned by proxy's write method[m
[31m-* [fxos] update `__format__` to match `pathsPrefix`[m
[31m-* [CB-6994](https://issues.apache.org/jira/browse/CB-6994) Improves merged code to be able to write a File[m
[31m-* Optimize `FileProxy` for **Windows** platforms[m
[31m-* Synchronize changes with **Windows** platform[m
[31m-* Fix function write for big files on **Windows 8**[m
[31m-* Write file in background[m
[31m-* [CB-7487](https://issues.apache.org/jira/browse/CB-7487) **Android** Broadcast file write This allows MTP USB shares to show the file immediately without reboot/manual refresh using 3rd party app.[m
[31m-* [CB-7700](https://issues.apache.org/jira/browse/CB-7700) cordova-plugin-file documentation translation: cordova-plugin-file[m
[31m-* [CB-7571](https://issues.apache.org/jira/browse/CB-7571) Bump version of nested plugin to match parent plugin[m
[31m-[m
[31m-### 1.3.1 (Sep 17, 2014)[m
[31m-* [CB-7471](https://issues.apache.org/jira/browse/CB-7471) cordova-plugin-file documentation translation[m
[31m-* [CB-7272](https://issues.apache.org/jira/browse/CB-7272) Replace confusing "r/o" abbreviation with just "r"[m
[31m-* [CB-7423](https://issues.apache.org/jira/browse/CB-7423) encode path before attempting to resolve[m
[31m-* [CB-7375](https://issues.apache.org/jira/browse/CB-7375) Fix the filesystem name in resolveLocalFileSystemUri[m
[31m-* [CB-7445](https://issues.apache.org/jira/browse/CB-7445) [BlackBerry10] resolveLocalFileSystemURI - change DEFAULT_SIZE to MAX_SIZE[m
[31m-* [CB-7458](https://issues.apache.org/jira/browse/CB-7458) [BlackBerry10] resolveLocalFileSystemURL - add filesystem property[m
[31m-* [CB-7445](https://issues.apache.org/jira/browse/CB-7445) [BlackBerry10] Add default file system size to prevent quota exceeded error on initial install[m
[31m-* [CB-7431](https://issues.apache.org/jira/browse/CB-7431) Avoid calling done() twice in file.spec.109 test[m
[31m-* [CB-7413](https://issues.apache.org/jira/browse/CB-7413) Adds support of 'ms-appdata://' URIs[m
[31m-* [CB-7422](https://issues.apache.org/jira/browse/CB-7422) [File Tests] Use proper fileSystem to create fullPath[m
[31m-* [CB-7375](https://issues.apache.org/jira/browse/CB-7375) [Entry] get proper filesystem in Entry[m
[31m-* Amazon related changes.[m
[31m-* [CB-7375](https://issues.apache.org/jira/browse/CB-7375) Remove leading slash statement from condition[m
[31m-* Refactored much of the logic in FileMetadata constructor.  Directory.size will return 0[m
[31m-* [CB-7419](https://issues.apache.org/jira/browse/CB-7419) [WP8] Added support to get metada from dir[m
[31m-* [CB-7418](https://issues.apache.org/jira/browse/CB-7418) [DirectoryEntry] Added fullPath variable as part of condition[m
[31m-* [CB-7417](https://issues.apache.org/jira/browse/CB-7417) [File tests] added proper matcher to compare fullPath property[m
[31m-* [CB-7375](https://issues.apache.org/jira/browse/CB-7375) Partial revert to resolve WP8 failures[m
[31m-* Overwrite existing file on getFile when create is true[m
[31m-* [CB-7375](https://issues.apache.org/jira/browse/CB-7375) [CB-6148](https://issues.apache.org/jira/browse/CB-6148): Ensure that return values from copy and move operations reference the correct filesystem[m
[31m-* [CB-6724](https://issues.apache.org/jira/browse/CB-6724) changed style detail on documentation[m
[31m-* Added new js files to amazon-fireos platform.[m
[31m-* Adds Windows platform[m
[31m-* Fixes multiple mobilespec tests errors[m
[31m-* Removed test/tests.js module from main plugin.xml[m
[31m-* [CB-7094](https://issues.apache.org/jira/browse/CB-7094) renamed folder to tests + added nested plugin.xml[m
[31m-* added documentation for manual tests[m
[31m-* [CB-6923](https://issues.apache.org/jira/browse/CB-6923) Adding support to handle relative paths[m
[31m-* Style improvements on Manual tests[m
[31m-* [CB-7094](https://issues.apache.org/jira/browse/CB-7094) Ported File manual tests[m
[31m-[m
[31m-### 1.3.0 (Aug 06, 2014)[m
[31m-* **FFOS** Remove unsupported paths from requestAllPaths[m
[31m-* **FFOS** Support for resolve URI, request all paths and local app directory.[m
[31m-* [CB-4263](https://issues.apache.org/jira/browse/CB-4263) set ready state to done before onload[m
[31m-* [CB-7167](https://issues.apache.org/jira/browse/CB-7167) [BlackBerry10] copyTo - return wrapped entry rather than native[m
[31m-* [CB-7167](https://issues.apache.org/jira/browse/CB-7167) [BlackBerry10] Add directory support to getFileMetadata[m
[31m-* [CB-7167](https://issues.apache.org/jira/browse/CB-7167) [BlackBerry10] Fix tests detection of blob support (window.Blob is BlobConstructor object)[m
[31m-* [CB-7161](https://issues.apache.org/jira/browse/CB-7161) [BlackBerry10] Add file system directory paths[m
[31m-* [CB-7093](https://issues.apache.org/jira/browse/CB-7093) Create separate plugin.xml for new-style tests[m
[31m-* [CB-7057](https://issues.apache.org/jira/browse/CB-7057) Docs update: elaborate on what directories are for[m
[31m-* [CB-7093](https://issues.apache.org/jira/browse/CB-7093): Undo the effects of an old bad S&R command[m
[31m-* [CB-7093](https://issues.apache.org/jira/browse/CB-7093): Remove a bunch of unneeded log messages[m
[31m-* [CB-7093](https://issues.apache.org/jira/browse/CB-7093): Add JS module to plugin.xml file for auto-tests[m
[31m-* [CB-7093](https://issues.apache.org/jira/browse/CB-7093) Ported automated file tests[m
[31m-* **WINDOWS** remove extra function closure, not    needed[m
[31m-* **WINDOWS** remove check for undefined fail(), it is defined by the proxy and always exists[m
[31m-* **WINDOWS** re-apply readAsBinaryString and readAsArrayBuffer[m
[31m-* **WINDOWS** Moved similar calls to be the same calls, aliased long namespaced functions[m
[31m-* [CB-6127](https://issues.apache.org/jira/browse/CB-6127) Updated translations for docs.[m
[31m-* [CB-6571](https://issues.apache.org/jira/browse/CB-6571) Fix getParentForLocalURL to work correctly with directories with trailing '/' (This closes #58)[m
[31m-* UTTypeCopyPreferredTagWithClass returns nil mimetype for css when there is no network[m
[31m-* updated spec links in docs ( en only )[m
[31m-* [CB-6571](https://issues.apache.org/jira/browse/CB-6571) add trailing space it is missing in DirectoryEnty constructor.[m
[31m-* [CB-6980](https://issues.apache.org/jira/browse/CB-6980) Fixing filesystem:null property in Entry[m
[31m-* Add win8 support for readAsBinaryString and readAsArrayBuffer[m
[31m-* [FFOS] Update FileProxy.js[m
[31m-* [CB-6940](https://issues.apache.org/jira/browse/CB-6940): Fixing up commit from dzeims[m
[31m-* [CB-6940](https://issues.apache.org/jira/browse/CB-6940): Android: cleanup try/catch exception handling[m
[31m-* [CB-6940](https://issues.apache.org/jira/browse/CB-6940): `context.getExternal*` methods return null if sdcard isn't in mounted state, causing exceptions that prevent startup from reaching readystate[m
[31m-* Fix mis-handling of filesystem reference in Entry.moveTo ('this' used in closure).[m
[31m-* [CB-6902](https://issues.apache.org/jira/browse/CB-6902): Use File.lastModified rather than .lastModifiedDate[m
[31m-* [CB-6922](https://issues.apache.org/jira/browse/CB-6922): Remove unused getMetadata native code[m
[31m-* [CB-6922](https://issues.apache.org/jira/browse/CB-6922): Use getFileMetadata consistently to get metadata[m
[31m-* changed fullPath to self.rootDocsPath[m
[31m-* [CB-6890](https://issues.apache.org/jira/browse/CB-6890): Fix pluginManager access for 4.0.x branch[m
[31m-[m
[31m-### 1.2.1[m
[31m-* [CB-6922](https://issues.apache.org/jira/browse/CB-6922) Fix inconsistent handling of lastModifiedDate and modificationTime[m
[31m-* [CB-285](https://issues.apache.org/jira/browse/CB-285): Document filesystem root properties[m
[31m-[m
[31m-### 1.2.0 (Jun 05, 2014)[m
[31m-* [CB-6127](https://issues.apache.org/jira/browse/CB-6127) Spanish and French Translations added. Github close #31[m
[31m-* updated this reference to window[m
[31m-* Add missing semicolon (copy & paste error)[m
[31m-* Fix compiler warning about symbol in interface not matching implementation[m
[31m-* Fix sorting order in supported platforms[m
[31m-* ubuntu: increase quota value[m
[31m-* ubuntu: Change FS URL scheme to 'cdvfile'[m
[31m-* ubuntu: Return size with Entry.getMetadata() method[m
[31m-* [CB-6803](https://issues.apache.org/jira/browse/CB-6803) Add license[m
[31m-* Initial implementation for Firefox OS[m
[31m-* Small wording tweaks[m
[31m-* Fixed toURL() toInternalURL() information in the doku[m
[31m-* ios: Don't fail a write of zero-length payload.[m
[31m-* [CB-285](https://issues.apache.org/jira/browse/CB-285) Docs for cordova.file.\*Directory properties[m
[31m-* [CB-285](https://issues.apache.org/jira/browse/CB-285) Add cordova.file.\*Directory properties for iOS & Android[m
[31m-* [CB-3440](https://issues.apache.org/jira/browse/CB-3440) [BlackBerry10] Proxy based implementation[m
[31m-* Fix typo in docs "app-bundle" -> "bundle"[m
[31m-* [CB-6583](https://issues.apache.org/jira/browse/CB-6583) ios: Fix failing to create entry when space in parent path[m
[31m-* [CB-6571](https://issues.apache.org/jira/browse/CB-6571) android: Make DirectoryEntry.toURL() have a trailing /[m
[31m-* [CB-6491](https://issues.apache.org/jira/browse/CB-6491) add CONTRIBUTING.md[m
[31m-* [CB-6525](https://issues.apache.org/jira/browse/CB-6525) android, ios: Allow file: URLs in all APIs. Fixes FileTransfer.download not being called.[m
[31m-* fix the Windows 8  implementation of the getFile method[m
[31m-* Update File.js for typo: lastModifiedData --> lastModifiedDate (closes #38)[m
[31m-* Add error codes.[m
[31m-* [CB-5980](https://issues.apache.org/jira/browse/CB-5980) Updated version and RELEASENOTES.md for release 1.0.0[m
[31m-* Add NOTICE file[m
[31m-* [CB-6114](https://issues.apache.org/jira/browse/CB-6114) Updated version and RELEASENOTES.md for release 1.0.1[m
[31m-* [CB-5980](https://issues.apache.org/jira/browse/CB-5980) Updated version and RELEASENOTES.md for release 1.0.0[m
[31m-[m
[31m-### 1.1.0 (Apr 17, 2014)[m
[31m-* [CB-4965](https://issues.apache.org/jira/browse/CB-4965): Remove tests from file plugin[m
[31m-* Android: Allow file:/ URLs[m
[31m-* [CB-6422](https://issues.apache.org/jira/browse/CB-6422): [windows8] use cordova/exec/proxy[m
[31m-* [CB-6249](https://issues.apache.org/jira/browse/CB-6249): [android] Opportunistically resolve content urls to file[m
[31m-* [CB-6394](https://issues.apache.org/jira/browse/CB-6394): [ios, android] Add extra filesystem roots[m
[31m-* [CB-6394](https://issues.apache.org/jira/browse/CB-6394): [ios, android] Fix file resolution for the device root case[m
[31m-* [CB-6394](https://issues.apache.org/jira/browse/CB-6394): [ios] Return ENCODING_ERR when fs name is not valid[m
[31m-* [CB-6393](https://issues.apache.org/jira/browse/CB-6393): Change behaviour of toURL and toNativeURL[m
[31m-* ios: Style: plugin initialization[m
[31m-* ios: Fix handling of file URLs with encoded spaces[m
[31m-* Always use Android's recommended temp file location for temporary file system[m
[31m-* [CB-6352](https://issues.apache.org/jira/browse/CB-6352): Allow FileSystem objects to be serialized to JSON[m
[31m-* [CB-5959](https://issues.apache.org/jira/browse/CB-5959): size is explicitly 0 if not set, file.spec.46&47 are testing the type of size[m
[31m-* [CB-6242](https://issues.apache.org/jira/browse/CB-6242): [BlackBerry10] Add deprecated version of resolveLocalFileSystemURI[m
[31m-* [CB-6242](https://issues.apache.org/jira/browse/CB-6242): [BlackBerry10] add file:/// prefix for toURI / toURL[m
[31m-* [CB-6242](https://issues.apache.org/jira/browse/CB-6242): [BlackBerry10] Polyfill window.requestAnimationFrame for OS < 10.2[m
[31m-* [CB-6242](https://issues.apache.org/jira/browse/CB-6242): [BlackBerry10] Override window.resolveLocalFileSystemURL[m
[31m-* [CB-6212](https://issues.apache.org/jira/browse/CB-6212): [iOS] fix warnings compiled under arm64 64-bit[m
[31m-* ios: Don't cache responses from CDVFile's URLProtocol[m
[31m-* [CB-6199](https://issues.apache.org/jira/browse/CB-6199): [iOS] Fix toNativeURL() not escaping characters properly[m
[31m-* [CB-6148](https://issues.apache.org/jira/browse/CB-6148): Fix cross-filesystem copy and move[m
[31m-* fixed setMetadata() to use the formatted fullPath[m
[31m-* corrected typo which leads to a "comma expression"[m
[31m-* [CB-4952](https://issues.apache.org/jira/browse/CB-4952): ios: Resolve symlinks in file:// URLs[m
[31m-* Add docs about the extraFileSystems preference[m
[31m-* [CB-6460](https://issues.apache.org/jira/browse/CB-6460): Update license headers[m
[31m-[m
[31m-### 1.0.1 (Feb 28, 2014)[m
[31m-* [CB-6116](https://issues.apache.org/jira/browse/CB-6116) Fix error where resolveLocalFileSystemURL would fail[m
[31m-* [CB-6106](https://issues.apache.org/jira/browse/CB-6106) Add support for nativeURL attribute on Entry objects[m
[31m-* [CB-6110](https://issues.apache.org/jira/browse/CB-6110) iOS: Fix typo in filesystemPathForURL: method[m
[31m-* Android: Use most specific FS match when resolving file: URIs[m
[31m-* iOS: Update fileSystemURLforLocalPath: to return the most match url.[m
[31m-* Allow third-party plugin registration, and the total count of fs type is not limited to just 4.[m
[31m-* [CB-6097](https://issues.apache.org/jira/browse/CB-6097) Added missing files for amazon-fireos platform. Added onLoad flag to true.[m
[31m-* [CB-6087](https://issues.apache.org/jira/browse/CB-6087) Android, iOS: Load file plugin on startup[m
[31m-* [CB-6013](https://issues.apache.org/jira/browse/CB-6013) BlackBerry10: wrap webkit prefixed called in requestAnimationFrame[m
[31m-* Update plugin writers' documentation[m
[31m-* [CB-6080](https://issues.apache.org/jira/browse/CB-6080) Fix file copy when src and dst are on different local file systems[m
[31m-* [CB-6057](https://issues.apache.org/jira/browse/CB-6057) Add methods for plugins to convert between URLs and paths[m
[31m-* [CB-6050](https://issues.apache.org/jira/browse/CB-6050) Public method for returning a FileEntry from a device file path[m
[31m-* [CB-2432](https://issues.apache.org/jira/browse/CB-2432) [CB-3185](https://issues.apache.org/jira/browse/CB-3185), [CB-5975](https://issues.apache.org/jira/browse/CB-5975): Fix Android handling of content:// URLs[m
[31m-* [CB-6022](https://issues.apache.org/jira/browse/CB-6022) Add upgrade notes to doc[m
[31m-* [CB-5233](https://issues.apache.org/jira/browse/CB-5233) Make asset-library urls work properly on iOS[m
[31m-* [CB-6012](https://issues.apache.org/jira/browse/CB-6012) Preserve query strings on cdvfile:// URLs where necessary[m
[31m-* [CB-6010](https://issues.apache.org/jira/browse/CB-6010) Test properly for presence of URLforFilesystemPath method[m
[31m-* [CB-5959](https://issues.apache.org/jira/browse/CB-5959) Entry.getMetadata should return size attribute[m
[31m-[m
[31m-### 1.0.0 (Feb 05, 2014)[m
[31m-* [CB-5974](https://issues.apache.org/jira/browse/CB-5974): Use safe 'Compatibilty' mode by default[m
[31m-* [CB-5915](https://issues.apache.org/jira/browse/CB-5915): [CB-5916](https://issues.apache.org/jira/browse/CB-5916): Reorganize preference code to make defaults possible[m
[31m-* [CB-5974](https://issues.apache.org/jira/browse/CB-5974): Android: Don't allow File operations to continue when not configured[m
[31m-* [CB-5960](https://issues.apache.org/jira/browse/CB-5960): ios: android: Properly handle parent references in getFile/getDirectory[m
[31m-* [ubuntu] adopt to recent changes[m
[31m-* Add default FS root to new FS objects[m
[31m-* [CB-5899](https://issues.apache.org/jira/browse/CB-5899): Make DirectoryReader.readEntries return properly formatted Entry objects[m
[31m-* Add constuctor params to FileUploadResult related to [CB-2421](https://issues.apache.org/jira/browse/CB-2421)[m
[31m-* Fill out filesystem attribute of entities returned from resolveLocalFileSystemURL[m
[31m-* [CB-5916](https://issues.apache.org/jira/browse/CB-5916): Create documents directories if they don't exist[m
[31m-* [CB-5915](https://issues.apache.org/jira/browse/CB-5915): Create documents directories if they don't exist[m
[31m-* [CB-5916](https://issues.apache.org/jira/browse/CB-5916): Android: Fix unfortunate NPE in config check[m
[31m-* [CB-5916](https://issues.apache.org/jira/browse/CB-5916): Android: Add "/files/" to persistent files path[m
[31m-* [CB-5915](https://issues.apache.org/jira/browse/CB-5915): ios: Update config preference (and docs) to match issue[m
[31m-* [CB-5916](https://issues.apache.org/jira/browse/CB-5916): Android: Add config preference for Android persistent storage location[m
[31m-* iOS: Add config preference for iOS persistent storage location[m
[31m-* iOS: Android: Allow third-party plugin registration[m
[31m-* Android: Expose filePlugin getter so that other plugins can register filesystems[m
[31m-* Fix typos in deprecation message[m
[31m-* Add backwards-compatibility shim for file-transfer[m
[31m-* Android: Allow third-party plugin registration[m
[31m-* [CB-5810](https://issues.apache.org/jira/browse/CB-5810) [BlackBerry10] resolve local:/// paths (application assets)[m
[31m-* [CB-5774](https://issues.apache.org/jira/browse/CB-5774): create DirectoryEntry instead of FileEntry[m
[31m-* Initial fix for [CB-5747](https://issues.apache.org/jira/browse/CB-5747)[m
[31m-* Change default FS URL scheme to "cdvfile"[m
[31m-* Android: Properly format content urls[m
[31m-* Android, iOS: Replace "filesystem" protocol string with constant[m
[31m-* Android: Allow absolute paths on Entry.getFile / Entry.getDirectory[m
[31m-* Android: Make clear that getFile takes a path, not just a filename[m
[31m-* [CB-5008](https://issues.apache.org/jira/browse/CB-5008): Rename resolveLocalFileSystemURI to resolveLocalFileSystemURL; deprecate original[m
[31m-* Remove old file reference from plugin.xml[m
[31m-* Android: Refactor File API[m
[31m-* [CB-4899](https://issues.apache.org/jira/browse/CB-4899) [BlackBerry10] Fix resolve directories[m
[31m-* [CB-5602](https://issues.apache.org/jira/browse/CB-5602) Windows8. Fix File Api mobile spec tests[m
[31m-* Android: Better support for content urls and cross-filesystem copy/move ops[m
[31m-* [CB-5699](https://issues.apache.org/jira/browse/CB-5699) [BlackBerry10] Update resolveLocalFileSystemURI implementation[m
[31m-* [CB-5658](https://issues.apache.org/jira/browse/CB-5658) Update license comment formatting of doc/index.md[m
[31m-* [CB-5658](https://issues.apache.org/jira/browse/CB-5658) Add doc.index.md for File plugin.[m
[31m-* [CB-5658](https://issues.apache.org/jira/browse/CB-5658) Delete stale snapshot of plugin docs[m
[31m-* [CB-5403](https://issues.apache.org/jira/browse/CB-5403): Backwards-compatibility with file:// urls where possible[m
[31m-* [CB-5407](https://issues.apache.org/jira/browse/CB-5407): Fixes for ContentFilesystem[m
[31m-* Android: Add method for testing backwards-compatibility of filetransfer plugin[m
[31m-* iOS: Add method for testing backwards-compatiblity of filetransfer plugin[m
[31m-* Android: Updates to allow FileTransfer to continue to work[m
[31m-* Android: Clean up unclosed file objects[m
[31m-* [CB-5407](https://issues.apache.org/jira/browse/CB-5407): Cleanup[m
[31m-* [CB-5407](https://issues.apache.org/jira/browse/CB-5407): Add new Android source files to plugin.xml[m
[31m-* [CB-5407](https://issues.apache.org/jira/browse/CB-5407): Move read, write and truncate methods into modules[m
[31m-* [CB-5407](https://issues.apache.org/jira/browse/CB-5407): Move copy/move methods into FS modules[m
[31m-* [CB-5407](https://issues.apache.org/jira/browse/CB-5407): Move getParent into FS modules[m
[31m-* [CB-5407](https://issues.apache.org/jira/browse/CB-5407): Move getmetadata methods into FS modules[m
[31m-* [CB-5407](https://issues.apache.org/jira/browse/CB-5407): Move readdir methods into FS modules[m
[31m-* [CB-5407](https://issues.apache.org/jira/browse/CB-5407): Move remove methods into FS modules[m
[31m-* [CB-5407](https://issues.apache.org/jira/browse/CB-5407): Move getFile into FS modules[m
[31m-* [CB-5407](https://issues.apache.org/jira/browse/CB-5407): Start refactoring android code: Modular filesystems, rfs, rlfsurl[m
[31m-* [CB-5407](https://issues.apache.org/jira/browse/CB-5407): Update android JS to use FS urls[m
[31m-* [CB-5405](https://issues.apache.org/jira/browse/CB-5405): Use URL formatting for Entry.toURL[m
[31m-* [CB-5532](https://issues.apache.org/jira/browse/CB-5532) Fix[m
[31m-* Log file path for File exceptions.[m
[31m-* Partial fix for iOS File compatibility with previous fileTransfer plugin[m
[31m-* [CB-5532](https://issues.apache.org/jira/browse/CB-5532) WP8. Add binary data support to FileWriter[m
[31m-* [CB-5531](https://issues.apache.org/jira/browse/CB-5531) WP8. File Api readAsText incorrectly handles position args[m
[31m-* Added ubuntu platform support[m
[31m-* Added amazon-fireos platform support[m
[31m-* [CB-5118](https://issues.apache.org/jira/browse/CB-5118) [BlackBerry10] Add check for undefined error handler[m
[31m-* [CB-5406](https://issues.apache.org/jira/browse/CB-5406): Extend public API for dependent plugins[m
[31m-* [CB-5403](https://issues.apache.org/jira/browse/CB-5403): Bump File plugin major version[m
[31m-* [CB-5406](https://issues.apache.org/jira/browse/CB-5406): Split iOS file plugin into modules[m
[31m-* [CB-5406](https://issues.apache.org/jira/browse/CB-5406): Factor out filesystem providers in iOS[m
[31m-* [CB-5408](https://issues.apache.org/jira/browse/CB-5408): Add handler for filesystem:// urls[m
[31m-* [CB-5406](https://issues.apache.org/jira/browse/CB-5406): Update iOS native code to use filesystem URLs internally[m
[31m-* [CB-5405](https://issues.apache.org/jira/browse/CB-5405): Update JS code to use URLs exclusively[m
[31m-* [CB-4816](https://issues.apache.org/jira/browse/CB-4816) Fix file creation outside sandbox for BB10[m
[31m-[m
[31m-### 0.2.5 (Oct 28, 2013)[m
[31m-* [CB-5129](https://issues.apache.org/jira/browse/CB-5129): Add a consistent filesystem attribute to FileEntry and DirectoryEntry objects[m
[31m-* [CB-5128](https://issues.apache.org/jira/browse/CB-5128): added repo + issue tag to plugin.xml for file plugin[m
[31m-* [CB-5015](https://issues.apache.org/jira/browse/CB-5015) [BlackBerry10] Add missing dependency for File.slice[m
[31m-* [CB-5010](https://issues.apache.org/jira/browse/CB-5010) Incremented plugin version on dev branch.[m
[31m-[m
[31m-### 0.2.4 (Oct 9, 2013)[m
[31m-* [CB-5020](https://issues.apache.org/jira/browse/CB-5020) - File plugin should execute on a separate thread[m
[31m-* [CB-4915](https://issues.apache.org/jira/browse/CB-4915) Incremented plugin version on dev branch.[m
[31m-* [CB-4504](https://issues.apache.org/jira/browse/CB-4504): Updating FileUtils.java to compensate for Java porting failures in the Android SDK. This fails because Java knows nothing about android_asset not being an actual filesystem[m
[31m-[m
[31m-### 0.2.3 (Sept 25, 2013)[m
[31m-* [CB-4889](https://issues.apache.org/jira/browse/CB-4889) bumping&resetting version[m
[31m-* [CB-4903](https://issues.apache.org/jira/browse/CB-4903) File Plugin not loading Windows8[m
[31m-* [CB-4903](https://issues.apache.org/jira/browse/CB-4903) File Plugin not loading Windows8[m
[31m-* [CB-4889](https://issues.apache.org/jira/browse/CB-4889) renaming references[m
[31m-* [CB-4889](https://issues.apache.org/jira/browse/CB-4889) renaming org.apache.cordova.core.file to org.apache.cordova.file[m
[31m-* Rename CHANGELOG.md -> RELEASENOTES.md[m
[31m-* [CB-4771](https://issues.apache.org/jira/browse/CB-4771) Expose TEMPORARY and PERSISTENT constants on window.[m
[31m-* Fix compiler/lint warnings[m
[31m-* [CB-4764](https://issues.apache.org/jira/browse/CB-4764) Move DirectoryManager.java into file plugin[m
[31m-* [CB-4763](https://issues.apache.org/jira/browse/CB-4763) Copy FileHelper.java into the plugin.[m
[31m-* [CB-2901](https://issues.apache.org/jira/browse/CB-2901) [BlackBerry10] Automatically unsandbox filesystem if path is not in app sandbox[m
[31m-* [CB-4752](https://issues.apache.org/jira/browse/CB-4752) Incremented plugin version on dev branch.[m
[31m-[m
[31m-### 0.2.1 (Sept 5, 2013)[m
[31m-* [CB-4656](https://issues.apache.org/jira/browse/CB-4656) Don't add newlines in data urls within readAsDataUrl.[m
[31m-* [CB-4514](https://issues.apache.org/jira/browse/CB-4514) Making DirectoryCopy Recursive[m
[31m-* [iOS] Simplify the code in resolveLocalFileSystemURI[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/package.json b/cordova_exchange_dist/plugins/cordova-plugin-file/package.json[m
[1mindex ffe1662..f965abc 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/package.json[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/package.json[m
[36m@@ -1,57 +1,150 @@[m
 {[m
[31m-  "name": "cordova-plugin-file",[m
[31m-  "version": "4.3.1",[m
[31m-  "description": "Cordova File Plugin",[m
[32m+[m[32m  "_args": [[m
[32m+[m[32m    [[m
[32m+[m[32m      {[m
[32m+[m[32m        "raw": "cordova-plugin-file@6.0.1",[m
[32m+[m[32m        "scope": null,[m
[32m+[m[32m        "escapedName": "cordova-plugin-file",[m
[32m+[m[32m        "name": "cordova-plugin-file",[m
[32m+[m[32m        "rawSpec": "6.0.1",[m
[32m+[m[32m        "spec": "6.0.1",[m
[32m+[m[32m        "type": "version"[m
[32m+[m[32m      },[m
[32m+[m[32m      "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test"[m
[32m+[m[32m    ][m
[32m+[m[32m  ],[m
[32m+[m[32m  "_from": "cordova-plugin-file@6.0.1",[m
[32m+[m[32m  "_id": "cordova-plugin-file@6.0.1",[m
[32m+[m[32m  "_inCache": true,[m
[32m+[m[32m  "_location": "/cordova-plugin-file",[m
[32m+[m[32m  "_nodeVersion": "8.2.1",[m
[32m+[m[32m  "_npmOperationalInternal": {[m
[32m+[m[32m    "host": "s3://npm-registry-packages",[m
[32m+[m[32m    "tmp": "tmp/cordova-plugin-file-6.0.1.tgz_1514690802908_0.5163829217199236"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmUser": {[m
[32m+[m[32m    "name": "macdonst",[m
[32m+[m[32m    "email": "simon.macdonald@gmail.com"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmVersion": "4.6.1",[m
[32m+[m[32m  "_phantomChildren": {},[m
[32m+[m[32m  "_requested": {[m
[32m+[m[32m    "raw": "cordova-plugin-file@6.0.1",[m
[32m+[m[32m    "scope": null,[m
[32m+[m[32m    "escapedName": "cordova-plugin-file",[m
[32m+[m[32m    "name": "cordova-plugin-file",[m
[32m+[m[32m    "rawSpec": "6.0.1",[m
[32m+[m[32m    "spec": "6.0.1",[m
[32m+[m[32m    "type": "version"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_requiredBy": [[m
[32m+[m[32m    "#USER",[m
[32m+[m[32m    "/"[m
[32m+[m[32m  ],[m
[32m+[m[32m  "_resolved": "https://registry.npmjs.org/cordova-plugin-file/-/cordova-plugin-file-6.0.1.tgz",[m
[32m+[m[32m  "_shasum": "49606b8c15a5688d4728f92e4a7325a061de07f5",[m
[32m+[m[32m  "_shrinkwrap": null,[m
[32m+[m[32m  "_spec": "cordova-plugin-file@6.0.1",[m
[32m+[m[32m  "_where": "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test",[m
[32m+[m[32m  "author": {[m
[32m+[m[32m    "name": "Apache Software Foundation"[m
[32m+[m[32m  },[m
[32m+[m[32m  "bugs": {[m
[32m+[m[32m    "url": "https://issues.apache.org/jira/browse/CB"[m
[32m+[m[32m  },[m
   "cordova": {[m
     "id": "cordova-plugin-file",[m
     "platforms": [[m
       "android",[m
[31m-      "amazon-fireos",[m
[31m-      "ubuntu",[m
[32m+[m[32m      "browser",[m
       "ios",[m
       "osx",[m
[31m-      "wp7",[m
[31m-      "wp8",[m
[31m-      "blackberry10",[m
[31m-      "windows8",[m
[31m-      "windows",[m
[31m-      "firefoxos"[m
[32m+[m[32m      "windows"[m
     ][m
   },[m
[31m-  "repository": {[m
[31m-    "type": "git",[m
[31m-    "url": "https://github.com/apache/cordova-plugin-file"[m
[32m+[m[32m  "dependencies": {},[m
[32m+[m[32m  "description": "Cordova File Plugin",[m
[32m+[m[32m  "devDependencies": {[m
[32m+[m[32m    "eslint": "^3.19.0",[m
[32m+[m[32m    "eslint-config-semistandard": "^11.0.0",[m
[32m+[m[32m    "eslint-config-standard": "^10.2.1",[m
[32m+[m[32m    "eslint-plugin-import": "^2.3.0",[m
[32m+[m[32m    "eslint-plugin-node": "^5.0.0",[m
[32m+[m[32m    "eslint-plugin-promise": "^3.5.0",[m
[32m+[m[32m    "eslint-plugin-standard": "^3.0.1"[m
[32m+[m[32m  },[m
[32m+[m[32m  "directories": {},[m
[32m+[m[32m  "dist": {[m
[32m+[m[32m    "shasum": "49606b8c15a5688d4728f92e4a7325a061de07f5",[m
[32m+[m[32m    "tarball": "https://registry.npmjs.org/cordova-plugin-file/-/cordova-plugin-file-6.0.1.tgz"[m
[32m+[m[32m  },[m
[32m+[m[32m  "engines": {[m
[32m+[m[32m    "cordovaDependencies": {[m
[32m+[m[32m      "5.0.0": {[m
[32m+[m[32m        "cordova-android": ">=6.3.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "7.0.0": {[m
[32m+[m[32m        "cordova": ">100"[m
[32m+[m[32m      }[m
[32m+[m[32m    }[m
   },[m
[32m+[m[32m  "homepage": "https://github.com/apache/cordova-plugin-file#readme",[m
   "keywords": [[m
     "cordova",[m
     "file",[m
     "ecosystem:cordova",[m
     "cordova-android",[m
[31m-    "cordova-amazon-fireos",[m
[31m-    "cordova-ubuntu",[m
[32m+[m[32m    "cordova-browser",[m
     "cordova-ios",[m
     "cordova-osx",[m
[31m-    "cordova-wp7",[m
[31m-    "cordova-wp8",[m
[31m-    "cordova-blackberry10",[m
[31m-    "cordova-windows8",[m
[31m-    "cordova-windows",[m
[31m-    "cordova-firefoxos"[m
[32m+[m[32m    "cordova-windows"[m
   ],[m
[31m-  "scripts": {[m
[31m-    "test": "npm run jshint",[m
[31m-    "jshint": "node node_modules/jshint/bin/jshint www && node node_modules/jshint/bin/jshint src && node node_modules/jshint/bin/jshint tests"[m
[31m-  },[m
[31m-  "author": "Apache Software Foundation",[m
   "license": "Apache-2.0",[m
[31m-  "engines": {[m
[31m-    "cordovaDependencies": {[m
[31m-      "5.0.0": {[m
[31m-        "cordova": ">100"[m
[31m-      }[m
[32m+[m[32m  "maintainers": [[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "macdonst",[m
[32m+[m[32m      "email": "simon.macdonald@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "bowserj",[m
[32m+[m[32m      "email": "bowserj@apache.org"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "purplecabbage",[m
[32m+[m[32m      "email": "purplecabbage@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "filmaj",[m
[32m+[m[32m      "email": "maj.fil@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "shazron",[m
[32m+[m[32m      "email": "shazron@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "csantanapr",[m
[32m+[m[32m      "email": "csantana23@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "kotikov.vladimir",[m
[32m+[m[32m      "email": "kotikov.vladimir@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "stevegill",[m
[32m+[m[32m      "email": "stevengill97@gmail.com"[m
     }[m
[32m+[m[32m  ],[m
[32m+[m[32m  "name": "cordova-plugin-file",[m
[32m+[m[32m  "optionalDependencies": {},[m
[32m+[m[32m  "readme": "ERROR: No README data found!",[m
[32m+[m[32m  "repository": {[m
[32m+[m[32m    "type": "git",[m
[32m+[m[32m    "url": "git+https://github.com/apache/cordova-plugin-file.git"[m
   },[m
[31m-  "devDependencies": {[m
[31m-    "jshint": "^2.6.0"[m
[31m-  }[m
[32m+[m[32m  "scripts": {[m
[32m+[m[32m    "eslint": "node node_modules/eslint/bin/eslint www && node node_modules/eslint/bin/eslint src && node node_modules/eslint/bin/eslint tests",[m
[32m+[m[32m    "test": "npm run eslint"[m
[32m+[m[32m  },[m
[32m+[m[32m  "types": "./types/index.d.ts",[m
[32m+[m[32m  "version": "6.0.1"[m
 }[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/plugin.xml b/cordova_exchange_dist/plugins/cordova-plugin-file/plugin.xml[m
[1mindex 51affa2..ecd15e9 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/plugin.xml[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/plugin.xml[m
[36m@@ -21,14 +21,17 @@[m
 <plugin xmlns="http://apache.org/cordova/ns/plugins/1.0"[m
 xmlns:android="http://schemas.android.com/apk/res/android"[m
            id="cordova-plugin-file"[m
[31m-      version="4.3.1">[m
[32m+[m[32m      version="6.0.1">[m
     <name>File</name>[m
     <description>Cordova File Plugin</description>[m
     <license>Apache 2.0</license>[m
     <keywords>cordova,file</keywords>[m
     <repo>https://git-wip-us.apache.org/repos/asf/cordova-plugin-file.git</repo>[m
     <issue>https://issues.apache.org/jira/browse/CB/component/12320651</issue>[m
[31m-    <dependency id="cordova-plugin-compat" version="^1.0.0" />[m
[32m+[m
[32m+[m[32m    <engines>[m
[32m+[m[32m        <engine name="cordova-android" version=">=6.3.0" />[m
[32m+[m[32m    </engines>[m
 [m
     <js-module src="www/DirectoryEntry.js" name="DirectoryEntry">[m
         <clobbers target="window.DirectoryEntry" />[m
[36m@@ -161,61 +164,6 @@[m [mto config.xml in order for the application to find previously stored files.[m
         </js-module>[m
     </platform>[m
 [m
[31m-    <!-- amazon-fireos -->[m
[31m-    <platform name="amazon-fireos">[m
[31m-        <config-file target="res/xml/config.xml" parent="/*">[m
[31m-            <feature name="File" >[m
[31m-                <param name="android-package" value="org.apache.cordova.file.FileUtils"/>[m
[31m-                <param name="onload" value="true" />[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <config-file target="AndroidManifest.xml" parent="/*">[m
[31m-            <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />[m
[31m-        </config-file>[m
[31m-[m
[31m-        <source-file src="src/android/EncodingException.java" target-dir="src/org/apache/cordova/file" />[m
[31m-        <source-file src="src/android/FileExistsException.java" target-dir="src/org/apache/cordova/file" />[m
[31m-        <source-file src="src/android/InvalidModificationException.java" target-dir="src/org/apache/cordova/file" />[m
[31m-        <source-file src="src/android/NoModificationAllowedException.java" target-dir="src/org/apache/cordova/file" />[m
[31m-        <source-file src="src/android/TypeMismatchException.java" target-dir="src/org/apache/cordova/file" />[m
[31m-        <source-file src="src/android/FileUtils.java" target-dir="src/org/apache/cordova/file" />[m
[31m-        <source-file src="src/android/DirectoryManager.java" target-dir="src/org/apache/cordova/file" />[m
[31m-        <source-file src="src/android/LocalFilesystemURL.java" target-dir="src/org/apache/cordova/file" />[m
[31m-        <source-file src="src/android/Filesystem.java" target-dir="src/org/apache/cordova/file" />[m
[31m-        <source-file src="src/android/LocalFilesystem.java" target-dir="src/org/apache/cordova/file" />[m
[31m-        <source-file src="src/android/ContentFilesystem.java" target-dir="src/org/apache/cordova/file" />[m
[31m-        <source-file src="src/android/AssetFilesystem.java" target-dir="src/org/apache/cordova/file" />[m
[31m-[m
[31m-[m
[31m-        <!-- android specific file apis -->[m
[31m-        <js-module src="www/android/FileSystem.js" name="androidFileSystem">[m
[31m-            <merges target="window.FileSystem" />[m
[31m-        </js-module>[m
[31m-        <js-module src="www/fileSystems-roots.js" name="fileSystems-roots">[m
[31m-            <runs/>[m
[31m-        </js-module>[m
[31m-        <js-module src="www/fileSystemPaths.js" name="fileSystemPaths">[m
[31m-            <merges target="cordova" />[m
[31m-            <runs/>[m
[31m-        </js-module>[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- ubuntu -->[m
[31m-    <platform name="ubuntu">[m
[31m-        <header-file src="src/ubuntu/file.h" />[m
[31m-        <source-file src="src/ubuntu/file.cpp" />[m
[31m-        <js-module src="www/ubuntu/FileSystem.js" name="ubuntuFileSystem1">[m
[31m-            <merges target="window.FileSystem" />[m
[31m-        </js-module>[m
[31m-        <js-module src="www/ubuntu/FileWriter.js" name="FileWriter1">[m
[31m-            <merges target="window.FileWriter" />[m
[31m-        </js-module>[m
[31m-        <js-module src="www/ubuntu/fileSystems-roots.js" name="fileSystems-roots">[m
[31m-            <runs/>[m
[31m-        </js-module>[m
[31m-    </platform>[m
[31m-[m
     <!-- ios -->[m
     <platform name="ios">[m
         <config-file target="config.xml" parent="/*">[m
[36m@@ -277,116 +225,9 @@[m [mto config.xml in order for the application to find previously stored files.[m
         </js-module>[m
     </platform>[m
 [m
[31m-    <!-- wp7 -->[m
[31m-    <platform name="wp7">[m
[31m-        <config-file target="config.xml" parent="/*">[m
[31m-            <feature name="File">[m
[31m-                <param name="wp-package" value="File"/>[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <source-file src="src/wp/File.cs" />[m
[31m-[m
[31m-        <!-- wp specific file apis -->[m
[31m-        <js-module src="www/wp/FileUploadOptions.js" name="FileUploadOptions1">[m
[31m-            <merges target="window.FileUploadOptions" />[m
[31m-        </js-module>[m
[31m-[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- wp8 -->[m
[31m-    <platform name="wp8">[m
[31m-        <config-file target="config.xml" parent="/*">[m
[31m-            <feature name="File">[m
[31m-                <param name="wp-package" value="File"/>[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <source-file src="src/wp/File.cs" />[m
[31m-[m
[31m-        <!-- wp specific file apis -->[m
[31m-        <js-module src="www/wp/FileUploadOptions.js" name="FileUploadOptions1">[m
[31m-            <merges target="window.FileUploadOptions" />[m
[31m-        </js-module>[m
[31m-[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- blackberry10 -->[m
[31m-    <platform name="blackberry10">[m
[31m-        <config-file target="www/config.xml" parent="/widget">[m
[31m-            <feature name="File" value="File" />[m
[31m-        </config-file>[m
[31m-        <js-module src="www/blackberry10/FileProxy.js" name="FileProxy" >[m
[31m-            <runs />[m
[31m-        </js-module>[m
[31m-        <js-module src="www/blackberry10/info.js" name="bb10FileSystemInfo">[m
[31m-            <runs />[m
[31m-        </js-module>[m
[31m-        <js-module src="www/blackberry10/createEntryFromNative.js" name="bb10CreateEntryFromNative">[m
[31m-            <runs />[m
[31m-        </js-module>[m
[31m-        <js-module src="www/blackberry10/requestAnimationFrame.js" name="bb10RequestAnimationFrame">[m
[31m-            <runs />[m
[31m-        </js-module>[m
[31m-        <js-module src="www/blackberry10/FileSystem.js" name="bb10FileSystem">[m
[31m-            <merges target="window.FileSystem" />[m
[31m-        </js-module>[m
[31m-        <js-module src="www/fileSystems-roots.js" name="fileSystems-roots">[m
[31m-            <runs/>[m
[31m-        </js-module>[m
[31m-        <js-module src="www/fileSystemPaths.js" name="fileSystemPaths">[m
[31m-            <merges target="cordova" />[m
[31m-        </js-module>[m
[31m-        <js-module src="www/blackberry10/copyTo.js" name="copyToProxy" />[m
[31m-        <js-module src="www/blackberry10/getDirectory.js" name="getDirectoryProxy" />[m
[31m-        <js-module src="www/blackberry10/getFile.js" name="getFileProxy" />[m
[31m-        <js-module src="www/blackberry10/getFileMetadata.js" name="getFileMetadataProxy" />[m
[31m-        <js-module src="www/blackberry10/getMetadata.js" name="getMetadataProxy" />[m
[31m-        <js-module src="www/blackberry10/getParent.js" name="getParentProxy" />[m
[31m-        <js-module src="www/blackberry10/moveTo.js" name="moveToProxy" />[m
[31m-        <js-module src="www/blackberry10/readAsArrayBuffer.js" name="readAsArrayBufferProxy" />[m
[31m-        <js-module src="www/blackberry10/readAsBinaryString.js" name="readAsBinaryStringProxy" />[m
[31m-        <js-module src="www/blackberry10/readAsDataURL.js" name="readAsDataURLProxy" />[m
[31m-        <js-module src="www/blackberry10/readAsText.js" name="readAsTextProxy" />[m
[31m-        <js-module src="www/blackberry10/readEntries.js" name="readEntriesProxy" />[m
[31m-        <js-module src="www/blackberry10/remove.js" name="removeProxy" />[m
[31m-        <js-module src="www/blackberry10/removeRecursively.js" name="removeRecursivelyProxy" />[m
[31m-        <js-module src="www/blackberry10/resolveLocalFileSystemURI.js" name="resolveLocalFileSystemURIProxy" />[m
[31m-        <js-module src="www/blackberry10/requestAllFileSystems.js" name="requestAllFileSystemsProxy" />[m
[31m-        <js-module src="www/blackberry10/requestFileSystem.js" name="requestFileSystemProxy" />[m
[31m-        <js-module src="www/blackberry10/setMetadata.js" name="setMetadataProxy" />[m
[31m-        <js-module src="www/blackberry10/truncate.js" name="truncateProxy" />[m
[31m-        <js-module src="www/blackberry10/write.js" name="writeProxy" />[m
[31m-        <source-file src="src/blackberry10/index.js" target-dir="File" />[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- windows8 -->[m
[31m-    <platform name="windows8">[m
[31m-        <js-module src="src/windows/FileProxy.js" name="FileProxy">[m
[31m-            <merges target="" />[m
[31m-        </js-module>[m
[31m-[m
[31m-        <js-module src="www/fileSystemPaths.js" name="fileSystemPaths">[m
[31m-            <merges target="cordova" />[m
[31m-            <runs/>[m
[31m-        </js-module>[m
[31m-    </platform>[m
[31m-[m
     <!-- windows -->[m
     <platform name="windows">[m
         <js-module src="src/windows/FileProxy.js" name="FileProxy">[m
[31m-            <merges target="" />[m
[31m-        </js-module>[m
[31m-[m
[31m-        <js-module src="www/fileSystemPaths.js" name="fileSystemPaths">[m
[31m-            <merges target="cordova" />[m
[31m-            <runs/>[m
[31m-        </js-module>[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- firefox os -->[m
[31m-    <platform name="firefoxos">[m
[31m-        <js-module src="src/firefoxos/FileProxy.js" name="FileProxy">[m
             <runs />[m
         </js-module>[m
 [m
[36m@@ -394,11 +235,6 @@[m [mto config.xml in order for the application to find previously stored files.[m
             <merges target="cordova" />[m
             <runs/>[m
         </js-module>[m
[31m-[m
[31m-        <!-- Firefox OS specific file apis -->[m
[31m-        <js-module src="www/firefoxos/FileSystem.js" name="firefoxFileSystem">[m
[31m-            <merges target="window.FileSystem" />[m
[31m-        </js-module>[m
     </platform>[m
 [m
     <platform name="browser">[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/src/android/FileUtils.java b/cordova_exchange_dist/plugins/cordova-plugin-file/src/android/FileUtils.java[m
[1mindex 2b88d52..1d6e61f 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/src/android/FileUtils.java[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/src/android/FileUtils.java[m
[36m@@ -570,6 +570,7 @@[m [mpublic class FileUtils extends CordovaPlugin {[m
     private boolean needPermission(String nativeURL, int permissionType) throws JSONException {[m
         JSONObject j = requestAllPaths();[m
         ArrayList<String> allowedStorageDirectories = new ArrayList<String>();[m
[32m+[m[32m        allowedStorageDirectories.add(j.getString("applicationDirectory"));[m
         allowedStorageDirectories.add(j.getString("applicationStorageDirectory"));[m
         if(j.has("externalApplicationStorageDirectory")) {[m
             allowedStorageDirectories.add(j.getString("externalApplicationStorageDirectory"));[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/src/blackberry10/index.js b/cordova_exchange_dist/plugins/cordova-plugin-file/src/blackberry10/index.js[m
[1mdeleted file mode 100644[m
[1mindex e995986..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/src/blackberry10/index.js[m
[1m+++ /dev/null[m
[36m@@ -1,47 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* global PluginResult */[m
[31m-[m
[31m-module.exports = {[m
[31m-    setSandbox : function (success, fail, args, env) {[m
[31m-        require("lib/webview").setSandbox(JSON.parse(decodeURIComponent(args[0])));[m
[31m-        new PluginResult(args, env).ok();[m
[31m-    },[m
[31m-[m
[31m-    getHomePath: function (success, fail, args, env) {[m
[31m-        var homeDir = window.qnx.webplatform.getApplication().getEnv("HOME");[m
[31m-        new PluginResult(args, env).ok(homeDir);[m
[31m-    },[m
[31m-[m
[31m-    requestAllPaths: function (success, fail, args, env) {[m
[31m-        var homeDir = 'file://' + window.qnx.webplatform.getApplication().getEnv("HOME").replace('/data', ''),[m
[31m-            paths = {[m
[31m-                applicationDirectory: homeDir + '/app/native/',[m
[31m-                applicationStorageDirectory: homeDir + '/',[m
[31m-                dataDirectory: homeDir + '/data/webviews/webfs/persistent/local__0/',[m
[31m-                cacheDirectory: homeDir + '/data/webviews/webfs/temporary/local__0/',[m
[31m-                externalRootDirectory: 'file:///accounts/1000/removable/sdcard/',[m
[31m-                sharedDirectory: homeDir + '/shared/'[m
[31m-            };[m
[31m-        success(paths);[m
[31m-    }[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/src/browser/FileProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-file/src/browser/FileProxy.js[m
[1mindex 2d937f4..66ad46b 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/src/browser/FileProxy.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/src/browser/FileProxy.js[m
[36m@@ -18,10 +18,10 @@[m
  * under the License.[m
  *[m
  */[m
[31m-(function() {[m
[31m-    /*global require, exports, module*/[m
[31m-    /*global FILESYSTEM_PREFIX*/[m
[31m-    /*global IDBKeyRange*/[m
[32m+[m[32m(function () {[m
[32m+[m[32m    /* global require, exports, module */[m
[32m+[m[32m    /* global FILESYSTEM_PREFIX */[m
[32m+[m[32m    /* global IDBKeyRange */[m
 [m
     /* Heavily based on https://github.com/ebidel/idb.filesystem.js */[m
 [m
[36m@@ -30,33 +30,33 @@[m
     if (require('./isChrome')()) {[m
         var pathsPrefix = {[m
             // Read-only directory where the application is installed.[m
[31m-            applicationDirectory: location.origin + "/",[m
[32m+[m[32m            applicationDirectory: location.origin + '/', // eslint-disable-line no-undef[m
             // Where to put app-specific data files.[m
             dataDirectory: 'filesystem:file:///persistent/',[m
             // Cached files that should survive app restarts.[m
             // Apps should not rely on the OS to delete files in here.[m
[31m-            cacheDirectory: 'filesystem:file:///temporary/',[m
[32m+[m[32m            cacheDirectory: 'filesystem:file:///temporary/'[m
         };[m
 [m
[31m-        exports.requestAllPaths = function(successCallback) {[m
[32m+[m[32m        exports.requestAllPaths = function (successCallback) {[m
             successCallback(pathsPrefix);[m
         };[m
 [m
[31m-        require("cordova/exec/proxy").add("File", module.exports);[m
[32m+[m[32m        require('cordova/exec/proxy').add('File', module.exports);[m
         return;[m
     }[m
 [m
[31m-    var LocalFileSystem = require('./LocalFileSystem'),[m
[31m-        FileSystem = require('./FileSystem'),[m
[31m-        FileEntry = require('./FileEntry'),[m
[31m-        FileError = require('./FileError'),[m
[31m-        DirectoryEntry = require('./DirectoryEntry'),[m
[31m-        File = require('./File');[m
[32m+[m[32m    var LocalFileSystem = require('./LocalFileSystem');[m
[32m+[m[32m    var FileSystem = require('./FileSystem');[m
[32m+[m[32m    var FileEntry = require('./FileEntry');[m
[32m+[m[32m    var FileError = require('./FileError');[m
[32m+[m[32m    var DirectoryEntry = require('./DirectoryEntry');[m
[32m+[m[32m    var File = require('./File');[m
 [m
[31m-    (function(exports, global) {[m
[32m+[m[32m    (function (exports, global) {[m
         var indexedDB = global.indexedDB || global.mozIndexedDB;[m
         if (!indexedDB) {[m
[31m-            throw "Firefox OS File plugin: indexedDB not supported";[m
[32m+[m[32m            throw 'Firefox OS File plugin: indexedDB not supported';[m
         }[m
 [m
         var fs_ = null;[m
[36m@@ -69,23 +69,23 @@[m
 [m
         var pathsPrefix = {[m
             // Read-only directory where the application is installed.[m
[31m-            applicationDirectory: location.origin + "/",[m
[32m+[m[32m            applicationDirectory: location.origin + '/', // eslint-disable-line no-undef[m
             // Where to put app-specific data files.[m
             dataDirectory: 'file:///persistent/',[m
             // Cached files that should survive app restarts.[m
             // Apps should not rely on the OS to delete files in here.[m
[31m-            cacheDirectory: 'file:///temporary/',[m
[32m+[m[32m            cacheDirectory: 'file:///temporary/'[m
         };[m
 [m
         var unicodeLastChar = 65535;[m
 [m
[31m-    /*** Exported functionality ***/[m
[32m+[m[32m    /** * Exported functionality ***/[m
 [m
[31m-        exports.requestFileSystem = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.requestFileSystem = function (successCallback, errorCallback, args) {[m
             var type = args[0];[m
             // Size is ignored since IDB filesystem size depends[m
             // on browser implementation and can't be set up by user[m
[31m-            var size = args[1]; // jshint ignore: line[m
[32m+[m[32m            var size = args[1]; // eslint-disable-line no-unused-vars[m
 [m
             if (type !== LocalFileSystem.TEMPORARY && type !== LocalFileSystem.PERSISTENT) {[m
                 if (errorCallback) {[m
[36m@@ -95,23 +95,23 @@[m
             }[m
 [m
             var name = type === LocalFileSystem.TEMPORARY ? 'temporary' : 'persistent';[m
[31m-            var storageName = (location.protocol + location.host).replace(/:/g, '_');[m
[32m+[m[32m            var storageName = (location.protocol + location.host).replace(/:/g, '_'); // eslint-disable-line no-undef[m
 [m
             var root = new DirectoryEntry('', DIR_SEPARATOR);[m
             fs_ = new FileSystem(name, root);[m
 [m
[31m-            idb_.open(storageName, function() {[m
[32m+[m[32m            idb_.open(storageName, function () {[m
                 successCallback(fs_);[m
             }, errorCallback);[m
         };[m
 [m
         // Overridden by Android, BlackBerry 10 and iOS to populate fsMap[m
[31m-        require('./fileSystems').getFs = function(name, callback) {[m
[32m+[m[32m        require('./fileSystems').getFs = function (name, callback) {[m
             callback(new FileSystem(name, fs_.root));[m
         };[m
 [m
         // list a directory's contents (files and folders).[m
[31m-        exports.readEntries = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.readEntries = function (successCallback, errorCallback, args) {[m
             var fullPath = args[0];[m
 [m
             if (typeof successCallback !== 'function') {[m
[36m@@ -120,18 +120,18 @@[m
 [m
             var path = resolveToFullPath_(fullPath);[m
 [m
[31m-            exports.getDirectory(function() {[m
[31m-                idb_.getAllEntries(path.fullPath + DIR_SEPARATOR, path.storagePath, function(entries) {[m
[32m+[m[32m            exports.getDirectory(function () {[m
[32m+[m[32m                idb_.getAllEntries(path.fullPath + DIR_SEPARATOR, path.storagePath, function (entries) {[m
                     successCallback(entries);[m
                 }, errorCallback);[m
[31m-            }, function() {[m
[32m+[m[32m            }, function () {[m
                 if (errorCallback) {[m
                     errorCallback(FileError.NOT_FOUND_ERR);[m
                 }[m
             }, [path.storagePath, path.fullPath, {create: false}]);[m
         };[m
 [m
[31m-        exports.getFile = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.getFile = function (successCallback, errorCallback, args) {[m
             var fullPath = args[0];[m
             var path = args[1];[m
             var options = args[2] || {};[m
[36m@@ -139,7 +139,7 @@[m
             // Create an absolute path if we were handed a relative one.[m
             path = resolveToFullPath_(fullPath, path);[m
 [m
[31m-            idb_.get(path.storagePath, function(fileEntry) {[m
[32m+[m[32m            idb_.get(path.storagePath, function (fileEntry) {[m
                 if (options.create === true && options.exclusive === true && fileEntry) {[m
                     // If create and exclusive are both true, and the path already exists,[m
                     // getFile must fail.[m
[36m@@ -164,7 +164,7 @@[m
                 } else if (options.create === true && fileEntry) {[m
                     if (fileEntry.isFile) {[m
                         // Overwrite file, delete then create new.[m
[31m-                        idb_['delete'](path.storagePath, function() {[m
[32m+[m[32m                        idb_['delete'](path.storagePath, function () {[m
                             var newFileEntry = new FileEntry(path.fileName, path.fullPath, new FileSystem(path.fsName, fs_.root));[m
 [m
                             newFileEntry.file_ = new MyFile({[m
[36m@@ -202,16 +202,16 @@[m
             }, errorCallback);[m
         };[m
 [m
[31m-        exports.getFileMetadata = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.getFileMetadata = function (successCallback, errorCallback, args) {[m
             var fullPath = args[0];[m
 [m
[31m-            exports.getFile(function(fileEntry) {[m
[32m+[m[32m            exports.getFile(function (fileEntry) {[m
                 successCallback(new File(fileEntry.file_.name, fileEntry.fullPath, '', fileEntry.file_.lastModifiedDate,[m
                     fileEntry.file_.size));[m
             }, errorCallback, [fullPath, null]);[m
         };[m
 [m
[31m-        exports.getMetadata = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.getMetadata = function (successCallback, errorCallback, args) {[m
             exports.getFile(function (fileEntry) {[m
                 successCallback([m
                     {[m
[36m@@ -221,21 +221,21 @@[m
             }, errorCallback, args);[m
         };[m
 [m
[31m-        exports.setMetadata = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.setMetadata = function (successCallback, errorCallback, args) {[m
             var fullPath = args[0];[m
             var metadataObject = args[1];[m
 [m
             exports.getFile(function (fileEntry) {[m
[31m-                  fileEntry.file_.lastModifiedDate = metadataObject.modificationTime;[m
[31m-                  idb_.put(fileEntry, fileEntry.file_.storagePath, successCallback, errorCallback);[m
[32m+[m[32m                fileEntry.file_.lastModifiedDate = metadataObject.modificationTime;[m
[32m+[m[32m                idb_.put(fileEntry, fileEntry.file_.storagePath, successCallback, errorCallback);[m
             }, errorCallback, [fullPath, null]);[m
         };[m
 [m
[31m-        exports.write = function(successCallback, errorCallback, args) {[m
[31m-            var fileName = args[0],[m
[31m-                data = args[1],[m
[31m-                position = args[2],[m
[31m-                isBinary = args[3]; // jshint ignore: line[m
[32m+[m[32m        exports.write = function (successCallback, errorCallback, args) {[m
[32m+[m[32m            var fileName = args[0];[m
[32m+[m[32m            var data = args[1];[m
[32m+[m[32m            var position = args[2];[m
[32m+[m[32m            var isBinary = args[3]; // eslint-disable-line no-unused-vars[m
 [m
             if (!data) {[m
                 if (errorCallback) {[m
[36m@@ -245,14 +245,14 @@[m
             }[m
 [m
             if (typeof data === 'string' || data instanceof String) {[m
[31m-                data = new Blob([data]);[m
[32m+[m[32m                data = new Blob([data]); // eslint-disable-line no-undef[m
             }[m
 [m
[31m-            exports.getFile(function(fileEntry) {[m
[32m+[m[32m            exports.getFile(function (fileEntry) {[m
                 var blob_ = fileEntry.file_.blob_;[m
 [m
                 if (!blob_) {[m
[31m-                    blob_ = new Blob([data], {type: data.type});[m
[32m+[m[32m                    blob_ = new Blob([data], {type: data.type}); // eslint-disable-line no-undef[m
                 } else {[m
                     // Calc the head and tail fragments[m
                     var head = blob_.slice(0, position);[m
[36m@@ -265,7 +265,7 @@[m
                     }[m
 [m
                     // Do the "write". In fact, a full overwrite of the Blob.[m
[31m-                    blob_ = new Blob([head, new Uint8Array(padding), data, tail],[m
[32m+[m[32m                    blob_ = new Blob([head, new Uint8Array(padding), data, tail], // eslint-disable-line no-undef[m
                         {type: data.type});[m
                 }[m
 [m
[36m@@ -276,46 +276,46 @@[m
                 fileEntry.file_.name = blob_.name;[m
                 fileEntry.file_.type = blob_.type;[m
 [m
[31m-                idb_.put(fileEntry, fileEntry.file_.storagePath, function() {[m
[32m+[m[32m                idb_.put(fileEntry, fileEntry.file_.storagePath, function () {[m
                     successCallback(data.size || data.byteLength);[m
                 }, errorCallback);[m
             }, errorCallback, [fileName, null]);[m
         };[m
 [m
[31m-        exports.readAsText = function(successCallback, errorCallback, args) {[m
[31m-            var fileName = args[0],[m
[31m-                enc = args[1],[m
[31m-                startPos = args[2],[m
[31m-                endPos = args[3];[m
[32m+[m[32m        exports.readAsText = function (successCallback, errorCallback, args) {[m
[32m+[m[32m            var fileName = args[0];[m
[32m+[m[32m            var enc = args[1];[m
[32m+[m[32m            var startPos = args[2];[m
[32m+[m[32m            var endPos = args[3];[m
 [m
             readAs('text', fileName, enc, startPos, endPos, successCallback, errorCallback);[m
         };[m
 [m
[31m-        exports.readAsDataURL = function(successCallback, errorCallback, args) {[m
[31m-            var fileName = args[0],[m
[31m-                startPos = args[1],[m
[31m-                endPos = args[2];[m
[32m+[m[32m        exports.readAsDataURL = function (successCallback, errorCallback, args) {[m
[32m+[m[32m            var fileName = args[0];[m
[32m+[m[32m            var startPos = args[1];[m
[32m+[m[32m            var endPos = args[2];[m
 [m
             readAs('dataURL', fileName, null, startPos, endPos, successCallback, errorCallback);[m
         };[m
 [m
[31m-        exports.readAsBinaryString = function(successCallback, errorCallback, args) {[m
[31m-            var fileName = args[0],[m
[31m-                startPos = args[1],[m
[31m-                endPos = args[2];[m
[32m+[m[32m        exports.readAsBinaryString = function (successCallback, errorCallback, args) {[m
[32m+[m[32m            var fileName = args[0];[m
[32m+[m[32m            var startPos = args[1];[m
[32m+[m[32m            var endPos = args[2];[m
 [m
             readAs('binaryString', fileName, null, startPos, endPos, successCallback, errorCallback);[m
         };[m
 [m
[31m-        exports.readAsArrayBuffer = function(successCallback, errorCallback, args) {[m
[31m-            var fileName = args[0],[m
[31m-                startPos = args[1],[m
[31m-                endPos = args[2];[m
[32m+[m[32m        exports.readAsArrayBuffer = function (successCallback, errorCallback, args) {[m
[32m+[m[32m            var fileName = args[0];[m
[32m+[m[32m            var startPos = args[1];[m
[32m+[m[32m            var endPos = args[2];[m
 [m
             readAs('arrayBuffer', fileName, null, startPos, endPos, successCallback, errorCallback);[m
         };[m
 [m
[31m-        exports.removeRecursively = exports.remove = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.removeRecursively = exports.remove = function (successCallback, errorCallback, args) {[m
             if (typeof successCallback !== 'function') {[m
                 throw Error('Expected successCallback argument.');[m
             }[m
[36m@@ -326,26 +326,26 @@[m
                 return;[m
             }[m
 [m
[31m-            function deleteEntry(isDirectory) {[m
[32m+[m[32m            function deleteEntry (isDirectory) {[m
                 // TODO: This doesn't protect against directories that have content in it.[m
                 // Should throw an error instead if the dirEntry is not empty.[m
[31m-                idb_['delete'](fullPath, function() {[m
[32m+[m[32m                idb_['delete'](fullPath, function () {[m
                     successCallback();[m
[31m-                }, function() {[m
[31m-                        if (errorCallback) { errorCallback(); }[m
[32m+[m[32m                }, function () {[m
[32m+[m[32m                    if (errorCallback) { errorCallback(); }[m
                 }, isDirectory);[m
             }[m
 [m
             // We need to to understand what we are deleting:[m
[31m-            exports.getDirectory(function(entry) {[m
[32m+[m[32m            exports.getDirectory(function (entry) {[m
                 deleteEntry(entry.isDirectory);[m
[31m-            }, function(){[m
[31m-                //DirectoryEntry was already deleted or entry is FileEntry[m
[32m+[m[32m            }, function () {[m
[32m+[m[32m                // DirectoryEntry was already deleted or entry is FileEntry[m
                 deleteEntry(false);[m
             }, [fullPath, null, {create: false}]);[m
         };[m
 [m
[31m-        exports.getDirectory = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.getDirectory = function (successCallback, errorCallback, args) {[m
             var fullPath = args[0];[m
             var path = args[1];[m
             var options = args[2];[m
[36m@@ -353,7 +353,7 @@[m
             // Create an absolute path if we were handed a relative one.[m
             path = resolveToFullPath_(fullPath, path);[m
 [m
[31m-            idb_.get(path.storagePath, function(folderEntry) {[m
[32m+[m[32m            idb_.get(path.storagePath, function (folderEntry) {[m
                 if (!options) {[m
                     options = {};[m
                 }[m
[36m@@ -423,15 +423,15 @@[m
             }, errorCallback);[m
         };[m
 [m
[31m-        exports.getParent = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.getParent = function (successCallback, errorCallback, args) {[m
             if (typeof successCallback !== 'function') {[m
                 throw Error('Expected successCallback argument.');[m
             }[m
 [m
             var fullPath = args[0];[m
[31m-            //fullPath is like this:[m
[31m-            //file:///persistent/path/to/file or[m
[31m-            //file:///persistent/path/to/directory/[m
[32m+[m[32m            // fullPath is like this:[m
[32m+[m[32m            // file:///persistent/path/to/file or[m
[32m+[m[32m            // file:///persistent/path/to/directory/[m
 [m
             if (fullPath === DIR_SEPARATOR || fullPath === pathsPrefix.cacheDirectory ||[m
                 fullPath === pathsPrefix.dataDirectory) {[m
[36m@@ -439,7 +439,7 @@[m
                 return;[m
             }[m
 [m
[31m-            //To delete all slashes at the end[m
[32m+[m[32m            // To delete all slashes at the end[m
             while (fullPath[fullPath.length - 1] === '/') {[m
                 fullPath = fullPath.substr(0, fullPath.length - 1);[m
             }[m
[36m@@ -449,8 +449,8 @@[m
             var parentName = pathArr.pop();[m
             var path = pathArr.join(DIR_SEPARATOR) + DIR_SEPARATOR;[m
 [m
[31m-            //To get parent of root files[m
[31m-            var joined = path + parentName + DIR_SEPARATOR;//is like this: file:///persistent/[m
[32m+[m[32m            // To get parent of root files[m
[32m+[m[32m            var joined = path + parentName + DIR_SEPARATOR;// is like this: file:///persistent/[m
             if (joined === pathsPrefix.cacheDirectory || joined === pathsPrefix.dataDirectory) {[m
                 exports.getDirectory(successCallback, errorCallback, [joined, DIR_SEPARATOR, {create: false}]);[m
                 return;[m
[36m@@ -459,7 +459,7 @@[m
             exports.getDirectory(successCallback, errorCallback, [path, parentName, {create: false}]);[m
         };[m
 [m
[31m-        exports.copyTo = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.copyTo = function (successCallback, errorCallback, args) {[m
             var srcPath = args[0];[m
             var parentFullPath = args[1];[m
             var name = args[2];[m
[36m@@ -473,33 +473,33 @@[m
             }[m
 [m
             // Read src file[m
[31m-            exports.getFile(function(srcFileEntry) {[m
[32m+[m[32m            exports.getFile(function (srcFileEntry) {[m
 [m
                 var path = resolveToFullPath_(parentFullPath);[m
[31m-                //Check directory[m
[31m-                exports.getDirectory(function() {[m
[32m+[m[32m                // Check directory[m
[32m+[m[32m                exports.getDirectory(function () {[m
 [m
                     // Create dest file[m
[31m-                    exports.getFile(function(dstFileEntry) {[m
[32m+[m[32m                    exports.getFile(function (dstFileEntry) {[m
 [m
[31m-                        exports.write(function() {[m
[32m+[m[32m                        exports.write(function () {[m
                             successCallback(dstFileEntry);[m
                         }, errorCallback, [dstFileEntry.file_.storagePath, srcFileEntry.file_.blob_, 0]);[m
 [m
                     }, errorCallback, [parentFullPath, name, {create: true}]);[m
 [m
[31m-                }, function() { if (errorCallback) { errorCallback(FileError.NOT_FOUND_ERR); }},[m
[31m-                [path.storagePath, null, {create:false}]);[m
[32m+[m[32m                }, function () { if (errorCallback) { errorCallback(FileError.NOT_FOUND_ERR); } },[m
[32m+[m[32m                [path.storagePath, null, {create: false}]);[m
 [m
             }, errorCallback, [srcPath, null]);[m
         };[m
 [m
[31m-        exports.moveTo = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.moveTo = function (successCallback, errorCallback, args) {[m
             var srcPath = args[0];[m
             // parentFullPath and name parameters is ignored because[m
             // args is being passed downstream to exports.copyTo method[m
[31m-            var parentFullPath = args[1]; // jshint ignore: line[m
[31m-            var name = args[2]; // jshint ignore: line[m
[32m+[m[32m            var parentFullPath = args[1]; // eslint-disable-line[m
[32m+[m[32m            var name = args[2]; // eslint-disable-line[m
 [m
             exports.copyTo(function (fileEntry) {[m
 [m
[36m@@ -510,16 +510,16 @@[m
             }, errorCallback, args);[m
         };[m
 [m
[31m-        exports.resolveLocalFileSystemURI = function(successCallback, errorCallback, args) {[m
[32m+[m[32m        exports.resolveLocalFileSystemURI = function (successCallback, errorCallback, args) {[m
             var path = args[0];[m
 [m
             // Ignore parameters[m
             if (path.indexOf('?') !== -1) {[m
[31m-                path = String(path).split("?")[0];[m
[32m+[m[32m                path = String(path).split('?')[0];[m
             }[m
 [m
             // support for encodeURI[m
[31m-            if (/\%5/g.test(path) || /\%20/g.test(path)) {[m
[32m+[m[32m            if (/\%5/g.test(path) || /\%20/g.test(path)) {  // eslint-disable-line no-useless-escape[m
                 path = decodeURI(path);[m
             }[m
 [m
[36m@@ -530,23 +530,23 @@[m
                 return;[m
             }[m
 [m
[31m-            //support for cdvfile[m
[31m-            if (path.trim().substr(0,7) === "cdvfile") {[m
[31m-                if (path.indexOf("cdvfile://localhost") === -1) {[m
[32m+[m[32m            // support for cdvfile[m
[32m+[m[32m            if (path.trim().substr(0, 7) === 'cdvfile') {[m
[32m+[m[32m                if (path.indexOf('cdvfile://localhost') === -1) {[m
                     if (errorCallback) {[m
                         errorCallback(FileError.ENCODING_ERR);[m
                     }[m
                     return;[m
                 }[m
 [m
[31m-                var indexPersistent = path.indexOf("persistent");[m
[31m-                var indexTemporary = path.indexOf("temporary");[m
[32m+[m[32m                var indexPersistent = path.indexOf('persistent');[m
[32m+[m[32m                var indexTemporary = path.indexOf('temporary');[m
 [m
[31m-                //cdvfile://localhost/persistent/path/to/file[m
[32m+[m[32m                // cdvfile://localhost/persistent/path/to/file[m
                 if (indexPersistent !== -1) {[m
[31m-                    path =  "file:///persistent" + path.substr(indexPersistent + 10);[m
[32m+[m[32m                    path = 'file:///persistent' + path.substr(indexPersistent + 10);[m
                 } else if (indexTemporary !== -1) {[m
[31m-                    path = "file:///temporary" + path.substr(indexTemporary + 9);[m
[32m+[m[32m                    path = 'file:///temporary' + path.substr(indexTemporary + 9);[m
                 } else {[m
                     if (errorCallback) {[m
                         errorCallback(FileError.ENCODING_ERR);[m
[36m@@ -556,8 +556,8 @@[m
             }[m
 [m
             // to avoid path form of '///path/to/file'[m
[31m-            function handlePathSlashes(path) {[m
[31m-                var cutIndex  = 0;[m
[32m+[m[32m            function handlePathSlashes (path) {[m
[32m+[m[32m                var cutIndex = 0;[m
                 for (var i = 0; i < path.length - 1; i++) {[m
                     if (path[i] === DIR_SEPARATOR && path[i + 1] === DIR_SEPARATOR) {[m
                         cutIndex = i + 1;[m
[36m@@ -576,8 +576,8 @@[m
                 path = path.substring(pathsPrefix.dataDirectory.length - 1);[m
                 path = handlePathSlashes(path);[m
 [m
[31m-                exports.requestFileSystem(function() {[m
[31m-                    exports.getFile(successCallback, function() {[m
[32m+[m[32m                exports.requestFileSystem(function () {[m
[32m+[m[32m                    exports.getFile(successCallback, function () {[m
                         exports.getDirectory(successCallback, errorCallback, [pathsPrefix.dataDirectory, path,[m
                         {create: false}]);[m
                     }, [pathsPrefix.dataDirectory, path, {create: false}]);[m
[36m@@ -586,47 +586,47 @@[m
                 path = path.substring(pathsPrefix.cacheDirectory.length - 1);[m
                 path = handlePathSlashes(path);[m
 [m
[31m-                exports.requestFileSystem(function() {[m
[31m-                    exports.getFile(successCallback, function() {[m
[32m+[m[32m                exports.requestFileSystem(function () {[m
[32m+[m[32m                    exports.getFile(successCallback, function () {[m
                         exports.getDirectory(successCallback, errorCallback, [pathsPrefix.cacheDirectory, path,[m
                         {create: false}]);[m
                     }, [pathsPrefix.cacheDirectory, path, {create: false}]);[m
                 }, errorCallback, [LocalFileSystem.TEMPORARY]);[m
             } else if (path.indexOf(pathsPrefix.applicationDirectory) === 0) {[m
                 path = path.substring(pathsPrefix.applicationDirectory.length);[m
[31m-                //TODO: need to cut out redundant slashes?[m
[32m+[m[32m                // TODO: need to cut out redundant slashes?[m
 [m
[31m-                var xhr = new XMLHttpRequest();[m
[31m-                xhr.open("GET", path, true);[m
[32m+[m[32m                var xhr = new XMLHttpRequest(); // eslint-disable-line no-undef[m
[32m+[m[32m                xhr.open('GET', path, true);[m
                 xhr.onreadystatechange = function () {[m
                     if (xhr.status === 200 && xhr.readyState === 4) {[m
[31m-                        exports.requestFileSystem(function(fs) {[m
[31m-                            fs.name = location.hostname;[m
[32m+[m[32m                        exports.requestFileSystem(function (fs) {[m
[32m+[m[32m                            fs.name = location.hostname; // eslint-disable-line no-undef[m
 [m
[31m-                            //TODO: need to call exports.getFile(...) to handle errors correct[m
[32m+[m[32m                            // TODO: need to call exports.getFile(...) to handle errors correct[m
                             fs.root.getFile(path, {create: true}, writeFile, errorCallback);[m
                         }, errorCallback, [LocalFileSystem.PERSISTENT]);[m
                     }[m
                 };[m
 [m
                 xhr.onerror = function () {[m
[31m-                    if(errorCallback) {[m
[32m+[m[32m                    if (errorCallback) {[m
                         errorCallback(FileError.NOT_READABLE_ERR);[m
                     }[m
                 };[m
 [m
                 xhr.send();[m
             } else {[m
[31m-                if(errorCallback) {[m
[32m+[m[32m                if (errorCallback) {[m
                     errorCallback(FileError.NOT_FOUND_ERR);[m
                 }[m
             }[m
 [m
[31m-            function writeFile(entry) {[m
[32m+[m[32m            function writeFile (entry) {[m
                 entry.createWriter(function (fileWriter) {[m
                     fileWriter.onwriteend = function (evt) {[m
                         if (!evt.target.error) {[m
[31m-                            entry.filesystemName = location.hostname;[m
[32m+[m[32m                            entry.filesystemName = location.hostname; // eslint-disable-line no-undef[m
                             successCallback(entry);[m
                         }[m
                     };[m
[36m@@ -635,16 +635,16 @@[m
                             errorCallback(FileError.NOT_READABLE_ERR);[m
                         }[m
                     };[m
[31m-                    fileWriter.write(new Blob([xhr.response]));[m
[31m-                }, errorCallback);[m
[32m+[m[32m                    fileWriter.write(new Blob([xhr.response])); // eslint-disable-line no-undef[m
[32m+[m[32m                }, errorCallback); // eslint-disable-line no-undef[m
             }[m
         };[m
 [m
[31m-        exports.requestAllPaths = function(successCallback) {[m
[32m+[m[32m        exports.requestAllPaths = function (successCallback) {[m
             successCallback(pathsPrefix);[m
         };[m
 [m
[31m-    /*** Helpers ***/[m
[32m+[m[32m    /** * Helpers ***/[m
 [m
         /**[m
          * Interface to wrap the native File interface.[m
[36m@@ -657,8 +657,8 @@[m
          * @param {Object} opts Initial values.[m
          * @constructor[m
          */[m
[31m-        function MyFile(opts) {[m
[31m-            var blob_ = new Blob();[m
[32m+[m[32m        function MyFile (opts) {[m
[32m+[m[32m            var blob_ = new Blob(); // eslint-disable-line no-undef[m
 [m
             this.size = opts.size || 0;[m
             this.name = opts.name || '';[m
[36m@@ -670,10 +670,10 @@[m
             // blob that is saved.[m
             Object.defineProperty(this, 'blob_', {[m
                 enumerable: true,[m
[31m-                get: function() {[m
[32m+[m[32m                get: function () {[m
                     return blob_;[m
                 },[m
[31m-                set: function(val) {[m
[32m+[m[32m                set: function (val) {[m
                     blob_ = val;[m
                     this.size = blob_.size;[m
                     this.name = blob_.name;[m
[36m@@ -688,7 +688,7 @@[m
         // When saving an entry, the fullPath should always lead with a slash and never[m
         // end with one (e.g. a directory). Also, resolve '.' and '..' to an absolute[m
         // one. This method ensures path is legit![m
[31m-        function resolveToFullPath_(cwdFullPath, path) {[m
[32m+[m[32m        function resolveToFullPath_ (cwdFullPath, path) {[m
             path = path || '';[m
             var fullPath = path;[m
             var prefix = '';[m
[36m@@ -722,7 +722,7 @@[m
                     parts[i] = '';[m
                 }[m
             }[m
[31m-            fullPath = parts.filter(function(el) {[m
[32m+[m[32m            fullPath = parts.filter(function (el) {[m
                 return el;[m
             }).join(DIR_SEPARATOR);[m
 [m
[36m@@ -758,7 +758,7 @@[m
             };[m
         }[m
 [m
[31m-        function fileEntryFromIdbEntry(fileEntry) {[m
[32m+[m[32m        function fileEntryFromIdbEntry (fileEntry) {[m
             // IDB won't save methods, so we need re-create the FileEntry.[m
             var clonedFileEntry = new FileEntry(fileEntry.name, fileEntry.fullPath, fileEntry.filesystem);[m
             clonedFileEntry.file_ = fileEntry.file_;[m
[36m@@ -766,46 +766,46 @@[m
             return clonedFileEntry;[m
         }[m
 [m
[31m-        function readAs(what, fullPath, encoding, startPos, endPos, successCallback, errorCallback) {[m
[31m-            exports.getFile(function(fileEntry) {[m
[31m-                var fileReader = new FileReader(),[m
[31m-                    blob = fileEntry.file_.blob_.slice(startPos, endPos);[m
[32m+[m[32m        function readAs (what, fullPath, encoding, startPos, endPos, successCallback, errorCallback) {[m
[32m+[m[32m            exports.getFile(function (fileEntry) {[m
[32m+[m[32m                var fileReader = new FileReader(); // eslint-disable-line no-undef[m
[32m+[m[32m                var blob = fileEntry.file_.blob_.slice(startPos, endPos);[m
 [m
[31m-                fileReader.onload = function(e) {[m
[32m+[m[32m                fileReader.onload = function (e) {[m
                     successCallback(e.target.result);[m
                 };[m
 [m
                 fileReader.onerror = errorCallback;[m
 [m
                 switch (what) {[m
[31m-                    case 'text':[m
[31m-                        fileReader.readAsText(blob, encoding);[m
[31m-                        break;[m
[31m-                    case 'dataURL':[m
[31m-                        fileReader.readAsDataURL(blob);[m
[31m-                        break;[m
[31m-                    case 'arrayBuffer':[m
[31m-                        fileReader.readAsArrayBuffer(blob);[m
[31m-                        break;[m
[31m-                    case 'binaryString':[m
[31m-                        fileReader.readAsBinaryString(blob);[m
[31m-                        break;[m
[32m+[m[32m                case 'text':[m
[32m+[m[32m                    fileReader.readAsText(blob, encoding);[m
[32m+[m[32m                    break;[m
[32m+[m[32m                case 'dataURL':[m
[32m+[m[32m                    fileReader.readAsDataURL(blob);[m
[32m+[m[32m                    break;[m
[32m+[m[32m                case 'arrayBuffer':[m
[32m+[m[32m                    fileReader.readAsArrayBuffer(blob);[m
[32m+[m[32m                    break;[m
[32m+[m[32m                case 'binaryString':[m
[32m+[m[32m                    fileReader.readAsBinaryString(blob);[m
[32m+[m[32m                    break;[m
                 }[m
 [m
             }, errorCallback, [fullPath, null]);[m
         }[m
 [m
[31m-    /*** Core logic to handle IDB operations ***/[m
[32m+[m[32m    /** * Core logic to handle IDB operations ***/[m
 [m
[31m-        idb_.open = function(dbName, successCallback, errorCallback) {[m
[32m+[m[32m        idb_.open = function (dbName, successCallback, errorCallback) {[m
             var self = this;[m
 [m
             // TODO: FF 12.0a1 isn't liking a db name with : in it.[m
[31m-            var request = indexedDB.open(dbName.replace(':', '_')/*, 1 /*version*/);[m
[32m+[m[32m            var request = indexedDB.open(dbName.replace(':', '_')/*, 1 /*version */);[m
 [m
             request.onerror = errorCallback || onError;[m
 [m
[31m-            request.onupgradeneeded = function(e) {[m
[32m+[m[32m            request.onupgradeneeded = function (e) {[m
                 // First open was called or higher db version was used.[m
 [m
                 // console.log('onupgradeneeded: oldVersion:' + e.oldVersion,[m
[36m@@ -815,11 +815,11 @@[m
                 self.db.onerror = onError;[m
 [m
                 if (!self.db.objectStoreNames.contains(FILE_STORE_)) {[m
[31m-                    self.db.createObjectStore(FILE_STORE_/*,{keyPath: 'id', autoIncrement: true}*/);[m
[32m+[m[32m                    self.db.createObjectStore(FILE_STORE_/*, {keyPath: 'id', autoIncrement: true} */);[m
                 }[m
             };[m
 [m
[31m-            request.onsuccess = function(e) {[m
[32m+[m[32m            request.onsuccess = function (e) {[m
                 self.db = e.target.result;[m
                 self.db.onerror = onError;[m
                 successCallback(e);[m
[36m@@ -828,12 +828,12 @@[m
             request.onblocked = errorCallback || onError;[m
         };[m
 [m
[31m-        idb_.close = function() {[m
[32m+[m[32m        idb_.close = function () {[m
             this.db.close();[m
             this.db = null;[m
         };[m
 [m
[31m-        idb_.get = function(fullPath, successCallback, errorCallback) {[m
[32m+[m[32m        idb_.get = function (fullPath, successCallback, errorCallback) {[m
             if (!this.db) {[m
                 if (errorCallback) {[m
                     errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[36m@@ -846,12 +846,12 @@[m
             var request = tx.objectStore(FILE_STORE_).get(fullPath);[m
 [m
             tx.onabort = errorCallback || onError;[m
[31m-            tx.oncomplete = function() {[m
[32m+[m[32m            tx.oncomplete = function () {[m
                 successCallback(request.result);[m
             };[m
         };[m
 [m
[31m-        idb_.getAllEntries = function(fullPath, storagePath, successCallback, errorCallback) {[m
[32m+[m[32m        idb_.getAllEntries = function (fullPath, storagePath, successCallback, errorCallback) {[m
             if (!this.db) {[m
                 if (errorCallback) {[m
                     errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[36m@@ -870,8 +870,8 @@[m
 [m
             var tx = this.db.transaction([FILE_STORE_], 'readonly');[m
             tx.onabort = errorCallback || onError;[m
[31m-            tx.oncomplete = function() {[m
[31m-                results = results.filter(function(val) {[m
[32m+[m[32m            tx.oncomplete = function () {[m
[32m+[m[32m                results = results.filter(function (val) {[m
                     var pathWithoutSlash = val.fullPath;[m
 [m
                     if (val.fullPath[val.fullPath.length - 1] === DIR_SEPARATOR) {[m
[36m@@ -883,9 +883,9 @@[m
 [m
                     /* Input fullPath parameter  equals '//' for root folder */[m
                     /* Entries in root folder has valPartsLen equals 2 (see below) */[m
[31m-                    if (fullPath[fullPath.length -1] === DIR_SEPARATOR && fullPath.trim().length === 2) {[m
[32m+[m[32m                    if (fullPath[fullPath.length - 1] === DIR_SEPARATOR && fullPath.trim().length === 2) {[m
                         fullPathPartsLen = 1;[m
[31m-                    } else if (fullPath[fullPath.length -1] === DIR_SEPARATOR) {[m
[32m+[m[32m                    } else if (fullPath[fullPath.length - 1] === DIR_SEPARATOR) {[m
                         fullPathPartsLen = fullPath.substr(0, fullPath.length - 1).split(DIR_SEPARATOR).length;[m
                     } else {[m
                         fullPathPartsLen = fullPath.split(DIR_SEPARATOR).length;[m
[36m@@ -903,7 +903,7 @@[m
 [m
             var request = tx.objectStore(FILE_STORE_).openCursor(range);[m
 [m
[31m-            request.onsuccess = function(e) {[m
[32m+[m[32m            request.onsuccess = function (e) {[m
                 var cursor = e.target.result;[m
                 if (cursor) {[m
                     var val = cursor.value;[m
[36m@@ -914,7 +914,7 @@[m
             };[m
         };[m
 [m
[31m-        idb_['delete'] = function(fullPath, successCallback, errorCallback, isDirectory) {[m
[32m+[m[32m        idb_['delete'] = function (fullPath, successCallback, errorCallback, isDirectory) {[m
             if (!idb_.db) {[m
                 if (errorCallback) {[m
                     errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[36m@@ -925,14 +925,14 @@[m
             var tx = this.db.transaction([FILE_STORE_], 'readwrite');[m
             tx.oncomplete = successCallback;[m
             tx.onabort = errorCallback || onError;[m
[31m-            tx.oncomplete = function() {[m
[32m+[m[32m            tx.oncomplete = function () {[m
                 if (isDirectory) {[m
[31m-                    //We delete nested files and folders after deleting parent folder[m
[31m-                    //We use ranges: https://developer.mozilla.org/en-US/docs/Web/API/IDBKeyRange[m
[32m+[m[32m                    // We delete nested files and folders after deleting parent folder[m
[32m+[m[32m                    // We use ranges: https://developer.mozilla.org/en-US/docs/Web/API/IDBKeyRange[m
                     fullPath = fullPath + DIR_SEPARATOR;[m
 [m
[31m-                    //Range contains all entries in the form fullPath<symbol> where[m
[31m-                    //symbol in the range from ' ' to symbol which has code `unicodeLastChar`[m
[32m+[m[32m                    // Range contains all entries in the form fullPath<symbol> where[m
[32m+[m[32m                    // symbol in the range from ' ' to symbol which has code `unicodeLastChar`[m
                     var range = IDBKeyRange.bound(fullPath + ' ', fullPath + String.fromCharCode(unicodeLastChar));[m
 [m
                     var newTx = this.db.transaction([FILE_STORE_], 'readwrite');[m
[36m@@ -946,7 +946,7 @@[m
             tx.objectStore(FILE_STORE_)['delete'](fullPath);[m
         };[m
 [m
[31m-        idb_.put = function(entry, storagePath, successCallback, errorCallback) {[m
[32m+[m[32m        idb_.put = function (entry, storagePath, successCallback, errorCallback) {[m
             if (!this.db) {[m
                 if (errorCallback) {[m
                     errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[36m@@ -956,7 +956,7 @@[m
 [m
             var tx = this.db.transaction([FILE_STORE_], 'readwrite');[m
             tx.onabort = errorCallback || onError;[m
[31m-            tx.oncomplete = function() {[m
[32m+[m[32m            tx.oncomplete = function () {[m
                 // TODO: Error is thrown if we pass the request event back instead.[m
                 successCallback(entry);[m
             };[m
[36m@@ -965,14 +965,14 @@[m
         };[m
 [m
         // Global error handler. Errors bubble from request, to transaction, to db.[m
[31m-        function onError(e) {[m
[32m+[m[32m        function onError (e) {[m
             switch (e.target.errorCode) {[m
[31m-                case 12:[m
[31m-                    console.log('Error - Attempt to open db with a lower version than the ' +[m
[32m+[m[32m            case 12:[m
[32m+[m[32m                console.log('Error - Attempt to open db with a lower version than the ' +[m
                         'current one.');[m
[31m-                    break;[m
[31m-                default:[m
[31m-                    console.log('errorCode: ' + e.target.errorCode);[m
[32m+[m[32m                break;[m
[32m+[m[32m            default:[m
[32m+[m[32m                console.log('errorCode: ' + e.target.errorCode);[m
             }[m
 [m
             console.log(e, e.code, e.message);[m
[36m@@ -980,5 +980,5 @@[m
 [m
     })(module.exports, window);[m
 [m
[31m-    require("cordova/exec/proxy").add("File", module.exports);[m
[32m+[m[32m    require('cordova/exec/proxy').add('File', module.exports);[m
 })();[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/src/firefoxos/FileProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-file/src/firefoxos/FileProxy.js[m
[1mdeleted file mode 100644[m
[1mindex 946304b..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/src/firefoxos/FileProxy.js[m
[1m+++ /dev/null[m
[36m@@ -1,805 +0,0 @@[m
[31m-﻿/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m- */[m
[31m-[m
[31m-/* global IDBKeyRange */[m
[31m-[m
[31m-var LocalFileSystem = require('./LocalFileSystem'),[m
[31m-    FileSystem = require('./FileSystem'),[m
[31m-    FileEntry = require('./FileEntry'),[m
[31m-    FileError = require('./FileError'),[m
[31m-    DirectoryEntry = require('./DirectoryEntry'),[m
[31m-    File = require('./File');[m
[31m-[m
[31m-/*[m
[31m-QUIRKS:[m
[31m-    Does not fail when removing non-empty directories[m
[31m-    Does not support metadata for directories[m
[31m-    Does not support requestAllFileSystems[m
[31m-    Does not support resolveLocalFileSystemURI[m
[31m-    Methods copyTo and moveTo do not support directories[m
[31m-[m
[31m-    Heavily based on https://github.com/ebidel/idb.filesystem.js[m
[31m- */[m
[31m-[m
[31m-[m
[31m-(function(exports, global) {[m
[31m-    var indexedDB = global.indexedDB || global.mozIndexedDB;[m
[31m-    if (!indexedDB) {[m
[31m-        throw "Firefox OS File plugin: indexedDB not supported";[m
[31m-    }[m
[31m-[m
[31m-    var fs_ = null;[m
[31m-[m
[31m-    var idb_ = {};[m
[31m-    idb_.db = null;[m
[31m-    var FILE_STORE_ = 'entries';[m
[31m-[m
[31m-    var DIR_SEPARATOR = '/';[m
[31m-    var DIR_OPEN_BOUND = String.fromCharCode(DIR_SEPARATOR.charCodeAt(0) + 1);[m
[31m-[m
[31m-    var pathsPrefix = {[m
[31m-        // Read-only directory where the application is installed.[m
[31m-        applicationDirectory: location.origin + "/",[m
[31m-        // Where to put app-specific data files.[m
[31m-        dataDirectory: 'file:///persistent/',[m
[31m-        // Cached files that should survive app restarts.[m
[31m-        // Apps should not rely on the OS to delete files in here.[m
[31m-        cacheDirectory: 'file:///temporary/',[m
[31m-    };[m
[31m-[m
[31m-/*** Exported functionality ***/[m
[31m-[m
[31m-    exports.requestFileSystem = function(successCallback, errorCallback, args) {[m
[31m-        var type = args[0];[m
[31m-        //var size = args[1];[m
[31m-[m
[31m-        if (type !== LocalFileSystem.TEMPORARY && type !== LocalFileSystem.PERSISTENT) {[m
[31m-            if (errorCallback) {[m
[31m-                errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[31m-            }[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-        var name = type === LocalFileSystem.TEMPORARY ? 'temporary' : 'persistent';[m
[31m-        var storageName = (location.protocol + location.host).replace(/:/g, '_');[m
[31m-[m
[31m-        var root = new DirectoryEntry('', DIR_SEPARATOR);[m
[31m-        fs_ = new FileSystem(name, root);[m
[31m-[m
[31m-        idb_.open(storageName, function() {[m
[31m-            successCallback(fs_);[m
[31m-        }, errorCallback);[m
[31m-    };[m
[31m-[m
[31m-    require('./fileSystems').getFs = function(name, callback) {[m
[31m-        callback(new FileSystem(name, fs_.root));[m
[31m-    };[m
[31m-[m
[31m-    // list a directory's contents (files and folders).[m
[31m-    exports.readEntries = function(successCallback, errorCallback, args) {[m
[31m-        var fullPath = args[0];[m
[31m-[m
[31m-        if (!successCallback) {[m
[31m-            throw Error('Expected successCallback argument.');[m
[31m-        }[m
[31m-[m
[31m-        var path = resolveToFullPath_(fullPath);[m
[31m-[m
[31m-        idb_.getAllEntries(path.fullPath, path.storagePath, function(entries) {[m
[31m-            successCallback(entries);[m
[31m-        }, errorCallback);[m
[31m-    };[m
[31m-[m
[31m-    exports.getFile = function(successCallback, errorCallback, args) {[m
[31m-        var fullPath = args[0];[m
[31m-        var path = args[1];[m
[31m-        var options = args[2] || {};[m
[31m-[m
[31m-        // Create an absolute path if we were handed a relative one.[m
[31m-        path = resolveToFullPath_(fullPath, path);[m
[31m-[m
[31m-        idb_.get(path.storagePath, function(fileEntry) {[m
[31m-            if (options.create === true && options.exclusive === true && fileEntry) {[m
[31m-                // If create and exclusive are both true, and the path already exists,[m
[31m-                // getFile must fail.[m
[31m-[m
[31m-                if (errorCallback) {[m
[31m-                    errorCallback(FileError.PATH_EXISTS_ERR);[m
[31m-                }[m
[31m-            } else if (options.create === true && !fileEntry) {[m
[31m-                // If create is true, the path doesn't exist, and no other error occurs,[m
[31m-                // getFile must create it as a zero-length file and return a corresponding[m
[31m-                // FileEntry.[m
[31m-                var newFileEntry = new FileEntry(path.fileName, path.fullPath, new FileSystem(path.fsName, fs_.root));[m
[31m-[m
[31m-                newFileEntry.file_ = new MyFile({[m
[31m-                    size: 0,[m
[31m-                    name: newFileEntry.name,[m
[31m-                    lastModifiedDate: new Date(),[m
[31m-                    storagePath: path.storagePath[m
[31m-                });[m
[31m-[m
[31m-                idb_.put(newFileEntry, path.storagePath, successCallback, errorCallback);[m
[31m-            } else if (options.create === true && fileEntry) {[m
[31m-                if (fileEntry.isFile) {[m
[31m-                    // Overwrite file, delete then create new.[m
[31m-                    idb_['delete'](path.storagePath, function() {[m
[31m-                        var newFileEntry = new FileEntry(path.fileName, path.fullPath, new FileSystem(path.fsName, fs_.root));[m
[31m-[m
[31m-                        newFileEntry.file_ = new MyFile({[m
[31m-                            size: 0,[m
[31m-                            name: newFileEntry.name,[m
[31m-                            lastModifiedDate: new Date(),[m
[31m-                            storagePath: path.storagePath[m
[31m-                        });[m
[31m-[m
[31m-                        idb_.put(newFileEntry, path.storagePath, successCallback, errorCallback);[m
[31m-                    }, errorCallback);[m
[31m-                } else {[m
[31m-                    if (errorCallback) {[m
[31m-                        errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[31m-                    }[m
[31m-                }[m
[31m-            } else if ((!options.create || options.create === false) && !fileEntry) {[m
[31m-                // If create is not true and the path doesn't exist, getFile must fail.[m
[31m-                if (errorCallback) {[m
[31m-                    errorCallback(FileError.NOT_FOUND_ERR);[m
[31m-                }[m
[31m-            } else if ((!options.create || options.create === false) && fileEntry &&[m
[31m-                fileEntry.isDirectory) {[m
[31m-                // If create is not true and the path exists, but is a directory, getFile[m
[31m-                // must fail.[m
[31m-                if (errorCallback) {[m
[31m-                    errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[31m-                }[m
[31m-            } else {[m
[31m-                // Otherwise, if no other error occurs, getFile must return a FileEntry[m
[31m-                // corresponding to path.[m
[31m-[m
[31m-                successCallback(fileEntryFromIdbEntry(fileEntry));[m
[31m-            }[m
[31m-        }, errorCallback);[m
[31m-    };[m
[31m-[m
[31m-    exports.getFileMetadata = function(successCallback, errorCallback, args) {[m
[31m-        var fullPath = args[0];[m
[31m-[m
[31m-        exports.getFile(function(fileEntry) {[m
[31m-            successCallback(new File(fileEntry.file_.name, fileEntry.fullPath, '', fileEntry.file_.lastModifiedDate,[m
[31m-                fileEntry.file_.size));[m
[31m-        }, errorCallback, [fullPath, null]);[m
[31m-    };[m
[31m-[m
[31m-    exports.getMetadata = function(successCallback, errorCallback, args) {[m
[31m-        exports.getFile(function (fileEntry) {[m
[31m-            successCallback([m
[31m-                {[m
[31m-                    modificationTime: fileEntry.file_.lastModifiedDate,[m
[31m-                    size: fileEntry.file_.lastModifiedDate[m
[31m-                });[m
[31m-        }, errorCallback, args);[m
[31m-    };[m
[31m-[m
[31m-    exports.setMetadata = function(successCallback, errorCallback, args) {[m
[31m-        var fullPath = args[0];[m
[31m-        var metadataObject = args[1];[m
[31m-[m
[31m-        exports.getFile(function (fileEntry) {[m
[31m-              fileEntry.file_.lastModifiedDate = metadataObject.modificationTime;[m
[31m-        }, errorCallback, [fullPath, null]);[m
[31m-    };[m
[31m-[m
[31m-    exports.write = function(successCallback, errorCallback, args) {[m
[31m-        var fileName = args[0],[m
[31m-            data = args[1],[m
[31m-            position = args[2];[m
[31m-            //isBinary = args[3];[m
[31m-[m
[31m-        if (!data) {[m
[31m-            if (errorCallback) {[m
[31m-                errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[31m-            }[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-        exports.getFile(function(fileEntry) {[m
[31m-            var blob_ = fileEntry.file_.blob_;[m
[31m-[m
[31m-            if (!blob_) {[m
[31m-                blob_ = new Blob([data], {type: data.type});[m
[31m-            } else {[m
[31m-                // Calc the head and tail fragments[m
[31m-                var head = blob_.slice(0, position);[m
[31m-                var tail = blob_.slice(position + data.byteLength);[m
[31m-[m
[31m-                // Calc the padding[m
[31m-                var padding = position - head.size;[m
[31m-                if (padding < 0) {[m
[31m-                    padding = 0;[m
[31m-                }[m
[31m-[m
[31m-                // Do the "write". In fact, a full overwrite of the Blob.[m
[31m-                blob_ = new Blob([head, new Uint8Array(padding), data, tail],[m
[31m-                    {type: data.type});[m
[31m-            }[m
[31m-[m
[31m-            // Set the blob we're writing on this file entry so we can recall it later.[m
[31m-            fileEntry.file_.blob_ = blob_;[m
[31m-            fileEntry.file_.lastModifiedDate = data.lastModifiedDate || null;[m
[31m-            fileEntry.file_.size = blob_.size;[m
[31m-            fileEntry.file_.name = blob_.name;[m
[31m-            fileEntry.file_.type = blob_.type;[m
[31m-[m
[31m-            idb_.put(fileEntry, fileEntry.file_.storagePath, function() {[m
[31m-                successCallback(data.byteLength);[m
[31m-            }, errorCallback);[m
[31m-        }, errorCallback, [fileName, null]);[m
[31m-    };[m
[31m-[m
[31m-    exports.readAsText = function(successCallback, errorCallback, args) {[m
[31m-        var fileName = args[0],[m
[31m-            enc = args[1],[m
[31m-            startPos = args[2],[m
[31m-            endPos = args[3];[m
[31m-[m
[31m-        readAs('text', fileName, enc, startPos, endPos, successCallback, errorCallback);[m
[31m-    };[m
[31m-[m
[31m-    exports.readAsDataURL = function(successCallback, errorCallback, args) {[m
[31m-        var fileName = args[0],[m
[31m-            startPos = args[1],[m
[31m-            endPos = args[2];[m
[31m-[m
[31m-        readAs('dataURL', fileName, null, startPos, endPos, successCallback, errorCallback);[m
[31m-    };[m
[31m-[m
[31m-    exports.readAsBinaryString = function(successCallback, errorCallback, args) {[m
[31m-        var fileName = args[0],[m
[31m-            startPos = args[1],[m
[31m-            endPos = args[2];[m
[31m-[m
[31m-        readAs('binaryString', fileName, null, startPos, endPos, successCallback, errorCallback);[m
[31m-    };[m
[31m-[m
[31m-    exports.readAsArrayBuffer = function(successCallback, errorCallback, args) {[m
[31m-        var fileName = args[0],[m
[31m-            startPos = args[1],[m
[31m-            endPos = args[2];[m
[31m-[m
[31m-        readAs('arrayBuffer', fileName, null, startPos, endPos, successCallback, errorCallback);[m
[31m-    };[m
[31m-[m
[31m-    exports.removeRecursively = exports.remove = function(successCallback, errorCallback, args) {[m
[31m-        var fullPath = args[0];[m
[31m-[m
[31m-        // TODO: This doesn't protect against directories that have content in it.[m
[31m-        // Should throw an error instead if the dirEntry is not empty.[m
[31m-        idb_['delete'](fullPath, function() {[m
[31m-            successCallback();[m
[31m-        }, errorCallback);[m
[31m-    };[m
[31m-[m
[31m-    exports.getDirectory = function(successCallback, errorCallback, args) {[m
[31m-        var fullPath = args[0];[m
[31m-        var path = args[1];[m
[31m-        var options = args[2];[m
[31m-[m
[31m-        // Create an absolute path if we were handed a relative one.[m
[31m-        path = resolveToFullPath_(fullPath, path);[m
[31m-[m
[31m-        idb_.get(path.storagePath, function(folderEntry) {[m
[31m-            if (!options) {[m
[31m-                options = {};[m
[31m-            }[m
[31m-[m
[31m-            if (options.create === true && options.exclusive === true && folderEntry) {[m
[31m-                // If create and exclusive are both true, and the path already exists,[m
[31m-                // getDirectory must fail.[m
[31m-                if (errorCallback) {[m
[31m-                    errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[31m-                }[m
[31m-            } else if (options.create === true && !folderEntry) {[m
[31m-                // If create is true, the path doesn't exist, and no other error occurs,[m
[31m-                // getDirectory must create it as a zero-length file and return a corresponding[m
[31m-                // MyDirectoryEntry.[m
[31m-                var dirEntry = new DirectoryEntry(path.fileName, path.fullPath, new FileSystem(path.fsName, fs_.root));[m
[31m-[m
[31m-                idb_.put(dirEntry, path.storagePath, successCallback, errorCallback);[m
[31m-            } else if (options.create === true && folderEntry) {[m
[31m-[m
[31m-                if (folderEntry.isDirectory) {[m
[31m-                    // IDB won't save methods, so we need re-create the MyDirectoryEntry.[m
[31m-                    successCallback(new DirectoryEntry(folderEntry.name, folderEntry.fullPath, folderEntry.fileSystem));[m
[31m-                } else {[m
[31m-                    if (errorCallback) {[m
[31m-                        errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[31m-                    }[m
[31m-                }[m
[31m-            } else if ((!options.create || options.create === false) && !folderEntry) {[m
[31m-                // Handle root special. It should always exist.[m
[31m-                if (path.fullPath === DIR_SEPARATOR) {[m
[31m-                    successCallback(fs_.root);[m
[31m-                    return;[m
[31m-                }[m
[31m-[m
[31m-                // If create is not true and the path doesn't exist, getDirectory must fail.[m
[31m-                if (errorCallback) {[m
[31m-                    errorCallback(FileError.NOT_FOUND_ERR);[m
[31m-                }[m
[31m-            } else if ((!options.create || options.create === false) && folderEntry &&[m
[31m-                folderEntry.isFile) {[m
[31m-                // If create is not true and the path exists, but is a file, getDirectory[m
[31m-                // must fail.[m
[31m-                if (errorCallback) {[m
[31m-                    errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[31m-                }[m
[31m-            } else {[m
[31m-                // Otherwise, if no other error occurs, getDirectory must return a[m
[31m-                // MyDirectoryEntry corresponding to path.[m
[31m-[m
[31m-                // IDB won't' save methods, so we need re-create MyDirectoryEntry.[m
[31m-                successCallback(new DirectoryEntry(folderEntry.name, folderEntry.fullPath, folderEntry.fileSystem));[m
[31m-            }[m
[31m-        }, errorCallback);[m
[31m-    };[m
[31m-[m
[31m-    exports.getParent = function(successCallback, errorCallback, args) {[m
[31m-        var fullPath = args[0];[m
[31m-[m
[31m-        if (fullPath === DIR_SEPARATOR) {[m
[31m-            successCallback(fs_.root);[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-        var pathArr = fullPath.split(DIR_SEPARATOR);[m
[31m-        pathArr.pop();[m
[31m-        var namesa = pathArr.pop();[m
[31m-        var path = pathArr.join(DIR_SEPARATOR);[m
[31m-[m
[31m-        exports.getDirectory(successCallback, errorCallback, [path, namesa, {create: false}]);[m
[31m-    };[m
[31m-[m
[31m-    exports.copyTo = function(successCallback, errorCallback, args) {[m
[31m-        var srcPath = args[0];[m
[31m-        var parentFullPath = args[1];[m
[31m-        var name = args[2];[m
[31m-[m
[31m-        // Read src file[m
[31m-        exports.getFile(function(srcFileEntry) {[m
[31m-[m
[31m-            // Create dest file[m
[31m-            exports.getFile(function(dstFileEntry) {[m
[31m-[m
[31m-                exports.write(function() {[m
[31m-                    successCallback(dstFileEntry);[m
[31m-                }, errorCallback, [dstFileEntry.file_.storagePath, srcFileEntry.file_.blob_, 0]);[m
[31m-[m
[31m-            }, errorCallback, [parentFullPath, name, {create: true}]);[m
[31m-[m
[31m-        }, errorCallback, [srcPath, null]);[m
[31m-    };[m
[31m-[m
[31m-    exports.moveTo = function(successCallback, errorCallback, args) {[m
[31m-        var srcPath = args[0];[m
[31m-        //var parentFullPath = args[1];[m
[31m-        //var name = args[2];[m
[31m-[m
[31m-        exports.copyTo(function (fileEntry) {[m
[31m-[m
[31m-            exports.remove(function () {[m
[31m-                successCallback(fileEntry);[m
[31m-            }, errorCallback, [srcPath]);[m
[31m-[m
[31m-        }, errorCallback, args);[m
[31m-    };[m
[31m-[m
[31m-    exports.resolveLocalFileSystemURI = function(successCallback, errorCallback, args) {[m
[31m-        var path = args[0];[m
[31m-[m
[31m-        // Ignore parameters[m
[31m-        if (path.indexOf('?') !== -1) {[m
[31m-            path = String(path).split("?")[0];[m
[31m-        }[m
[31m-[m
[31m-        // support for encodeURI[m
[31m-        if (/\%5/g.test(path)) {[m
[31m-            path = decodeURI(path);[m
[31m-        }[m
[31m-[m
[31m-        if (path.indexOf(pathsPrefix.dataDirectory) === 0) {[m
[31m-            path = path.substring(pathsPrefix.dataDirectory.length - 1);[m
[31m-[m
[31m-            exports.requestFileSystem(function(fs) {[m
[31m-                fs.root.getFile(path, {create: false}, successCallback, function() {[m
[31m-                    fs.root.getDirectory(path, {create: false}, successCallback, errorCallback);[m
[31m-                });[m
[31m-            }, errorCallback, [LocalFileSystem.PERSISTENT]);[m
[31m-        } else if (path.indexOf(pathsPrefix.cacheDirectory) === 0) {[m
[31m-            path = path.substring(pathsPrefix.cacheDirectory.length - 1);[m
[31m-[m
[31m-            exports.requestFileSystem(function(fs) {[m
[31m-                fs.root.getFile(path, {create: false}, successCallback, function() {[m
[31m-                    fs.root.getDirectory(path, {create: false}, successCallback, errorCallback);[m
[31m-                });[m
[31m-            }, errorCallback, [LocalFileSystem.TEMPORARY]);[m
[31m-        } else if (path.indexOf(pathsPrefix.applicationDirectory) === 0) {[m
[31m-            path = path.substring(pathsPrefix.applicationDirectory.length);[m
[31m-[m
[31m-            var xhr = new XMLHttpRequest();[m
[31m-            xhr.open("GET", path, true);[m
[31m-            xhr.onreadystatechange = function () {[m
[31m-                if (xhr.status === 200 && xhr.readyState === 4) {[m
[31m-                    exports.requestFileSystem(function(fs) {[m
[31m-                        fs.name = location.hostname;[m
[31m-                        fs.root.getFile(path, {create: true}, writeFile, errorCallback);[m
[31m-                    }, errorCallback, [LocalFileSystem.PERSISTENT]);[m
[31m-                }[m
[31m-            };[m
[31m-[m
[31m-            xhr.onerror = function () {[m
[31m-                if (errorCallback) {[m
[31m-                    errorCallback(FileError.NOT_READABLE_ERR);[m
[31m-                }[m
[31m-            };[m
[31m-[m
[31m-            xhr.send();[m
[31m-        } else {[m
[31m-            if (errorCallback) {[m
[31m-                errorCallback(FileError.NOT_FOUND_ERR);[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        function writeFile(entry) {[m
[31m-            entry.createWriter(function (fileWriter) {[m
[31m-                fileWriter.onwriteend = function (evt) {[m
[31m-                    if (!evt.target.error) {[m
[31m-                        entry.filesystemName = location.hostname;[m
[31m-                        successCallback(entry);[m
[31m-                    }[m
[31m-                };[m
[31m-                fileWriter.onerror = function () {[m
[31m-                    if (errorCallback) {[m
[31m-                        errorCallback(FileError.NOT_READABLE_ERR);[m
[31m-                    }[m
[31m-                };[m
[31m-                fileWriter.write(new Blob([xhr.response]));[m
[31m-            }, errorCallback);[m
[31m-        }[m
[31m-    };[m
[31m-[m
[31m-    exports.requestAllPaths = function(successCallback) {[m
[31m-        successCallback(pathsPrefix);[m
[31m-    };[m
[31m-[m
[31m-/*** Helpers ***/[m
[31m-[m
[31m-    /**[m
[31m-     * Interface to wrap the native File interface.[m
[31m-     *[m
[31m-     * This interface is necessary for creating zero-length (empty) files,[m
[31m-     * something the Filesystem API allows you to do. Unfortunately, File's[m
[31m-     * constructor cannot be called directly, making it impossible to instantiate[m
[31m-     * an empty File in JS.[m
[31m-     *[m
[31m-     * @param {Object} opts Initial values.[m
[31m-     * @constructor[m
[31m-     */[m
[31m-    function MyFile(opts) {[m
[31m-        var blob_ = new Blob();[m
[31m-[m
[31m-        this.size = opts.size || 0;[m
[31m-        this.name = opts.name || '';[m
[31m-        this.type = opts.type || '';[m
[31m-        this.lastModifiedDate = opts.lastModifiedDate || null;[m
[31m-        this.storagePath = opts.storagePath || '';[m
[31m-[m
[31m-        // Need some black magic to correct the object's size/name/type based on the[m
[31m-        // blob that is saved.[m
[31m-        Object.defineProperty(this, 'blob_', {[m
[31m-            enumerable: true,[m
[31m-            get: function() {[m
[31m-                return blob_;[m
[31m-            },[m
[31m-            set: function(val) {[m
[31m-                blob_ = val;[m
[31m-                this.size = blob_.size;[m
[31m-                this.name = blob_.name;[m
[31m-                this.type = blob_.type;[m
[31m-                this.lastModifiedDate = blob_.lastModifiedDate;[m
[31m-            }.bind(this)[m
[31m-        });[m
[31m-    }[m
[31m-[m
[31m-    MyFile.prototype.constructor = MyFile;[m
[31m-[m
[31m-    // When saving an entry, the fullPath should always lead with a slash and never[m
[31m-    // end with one (e.g. a directory). Also, resolve '.' and '..' to an absolute[m
[31m-    // one. This method ensures path is legit![m
[31m-    function resolveToFullPath_(cwdFullPath, path) {[m
[31m-        path = path || '';[m
[31m-        var fullPath = path;[m
[31m-        var prefix = '';[m
[31m-[m
[31m-        cwdFullPath = cwdFullPath || DIR_SEPARATOR;[m
[31m-        if (cwdFullPath.indexOf(FILESYSTEM_PREFIX) === 0) {[m
[31m-            prefix = cwdFullPath.substring(0, cwdFullPath.indexOf(DIR_SEPARATOR, FILESYSTEM_PREFIX.length));[m
[31m-            cwdFullPath = cwdFullPath.substring(cwdFullPath.indexOf(DIR_SEPARATOR, FILESYSTEM_PREFIX.length));[m
[31m-        }[m
[31m-[m
[31m-        var relativePath = path[0] !== DIR_SEPARATOR;[m
[31m-        if (relativePath) {[m
[31m-            fullPath = cwdFullPath;[m
[31m-            if (cwdFullPath != DIR_SEPARATOR) {[m
[31m-                fullPath += DIR_SEPARATOR + path;[m
[31m-            } else {[m
[31m-                fullPath += path;[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        // Adjust '..'s by removing parent directories when '..' flows in path.[m
[31m-        var parts = fullPath.split(DIR_SEPARATOR);[m
[31m-        for (var i = 0; i < parts.length; ++i) {[m
[31m-            var part = parts[i];[m
[31m-            if (part == '..') {[m
[31m-                parts[i - 1] = '';[m
[31m-                parts[i] = '';[m
[31m-            }[m
[31m-        }[m
[31m-        fullPath = parts.filter(function(el) {[m
[31m-            return el;[m
[31m-        }).join(DIR_SEPARATOR);[m
[31m-[m
[31m-        // Add back in leading slash.[m
[31m-        if (fullPath[0] !== DIR_SEPARATOR) {[m
[31m-            fullPath = DIR_SEPARATOR + fullPath;[m
[31m-        }[m
[31m-[m
[31m-        // Replace './' by current dir. ('./one/./two' -> one/two)[m
[31m-        fullPath = fullPath.replace(/\.\//g, DIR_SEPARATOR);[m
[31m-[m
[31m-        // Replace '//' with '/'.[m
[31m-        fullPath = fullPath.replace(/\/\//g, DIR_SEPARATOR);[m
[31m-[m
[31m-        // Replace '/.' with '/'.[m
[31m-        fullPath = fullPath.replace(/\/\./g, DIR_SEPARATOR);[m
[31m-[m
[31m-        // Remove '/' if it appears on the end.[m
[31m-        if (fullPath[fullPath.length - 1] == DIR_SEPARATOR &&[m
[31m-            fullPath != DIR_SEPARATOR) {[m
[31m-            fullPath = fullPath.substring(0, fullPath.length - 1);[m
[31m-        }[m
[31m-[m
[31m-        return {[m
[31m-            storagePath: prefix + fullPath,[m
[31m-            fullPath: fullPath,[m
[31m-            fileName: fullPath.split(DIR_SEPARATOR).pop(),[m
[31m-            fsName: prefix.split(DIR_SEPARATOR).pop()[m
[31m-        };[m
[31m-    }[m
[31m-[m
[31m-    function fileEntryFromIdbEntry(fileEntry) {[m
[31m-        // IDB won't save methods, so we need re-create the FileEntry.[m
[31m-        var clonedFileEntry = new FileEntry(fileEntry.name, fileEntry.fullPath, fileEntry.fileSystem);[m
[31m-        clonedFileEntry.file_ = fileEntry.file_;[m
[31m-[m
[31m-        return clonedFileEntry;[m
[31m-    }[m
[31m-[m
[31m-    function readAs(what, fullPath, encoding, startPos, endPos, successCallback, errorCallback) {[m
[31m-        exports.getFile(function(fileEntry) {[m
[31m-            var fileReader = new FileReader(),[m
[31m-                blob = fileEntry.file_.blob_.slice(startPos, endPos);[m
[31m-[m
[31m-            fileReader.onload = function(e) {[m
[31m-                successCallback(e.target.result);[m
[31m-            };[m
[31m-[m
[31m-            fileReader.onerror = errorCallback;[m
[31m-[m
[31m-            switch (what) {[m
[31m-                case 'text':[m
[31m-                    fileReader.readAsText(blob, encoding);[m
[31m-                    break;[m
[31m-                case 'dataURL':[m
[31m-                    fileReader.readAsDataURL(blob);[m
[31m-                    break;[m
[31m-                case 'arrayBuffer':[m
[31m-                    fileReader.readAsArrayBuffer(blob);[m
[31m-                    break;[m
[31m-                case 'binaryString':[m
[31m-                    fileReader.readAsBinaryString(blob);[m
[31m-                    break;[m
[31m-            }[m
[31m-[m
[31m-        }, errorCallback, [fullPath, null]);[m
[31m-    }[m
[31m-[m
[31m-/*** Core logic to handle IDB operations ***/[m
[31m-[m
[31m-    idb_.open = function(dbName, successCallback, errorCallback) {[m
[31m-        var self = this;[m
[31m-[m
[31m-        // TODO: FF 12.0a1 isn't liking a db name with : in it.[m
[31m-        var request = indexedDB.open(dbName.replace(':', '_')/*, 1 /*version*/);[m
[31m-[m
[31m-        request.onerror = errorCallback || onError;[m
[31m-[m
[31m-        request.onupgradeneeded = function(e) {[m
[31m-            // First open was called or higher db version was used.[m
[31m-[m
[31m-            // console.log('onupgradeneeded: oldVersion:' + e.oldVersion,[m
[31m-            //           'newVersion:' + e.newVersion);[m
[31m-[m
[31m-            self.db = e.target.result;[m
[31m-            self.db.onerror = onError;[m
[31m-[m
[31m-            if (!self.db.objectStoreNames.contains(FILE_STORE_)) {[m
[31m-                self.db.createObjectStore(FILE_STORE_/*,{keyPath: 'id', autoIncrement: true}*/);[m
[31m-            }[m
[31m-        };[m
[31m-[m
[31m-        request.onsuccess = function(e) {[m
[31m-            self.db = e.target.result;[m
[31m-            self.db.onerror = onError;[m
[31m-            successCallback(e);[m
[31m-        };[m
[31m-[m
[31m-        request.onblocked = errorCallback || onError;[m
[31m-    };[m
[31m-[m
[31m-    idb_.close = function() {[m
[31m-        this.db.close();[m
[31m-        this.db = null;[m
[31m-    };[m
[31m-[m
[31m-    idb_.get = function(fullPath, successCallback, errorCallback) {[m
[31m-        if (!this.db) {[m
[31m-            if (errorCallback) {[m
[31m-                errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[31m-            }[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-        var tx = this.db.transaction([FILE_STORE_], 'readonly');[m
[31m-[m
[31m-        //var request = tx.objectStore(FILE_STORE_).get(fullPath);[m
[31m-        var range = IDBKeyRange.bound(fullPath, fullPath + DIR_OPEN_BOUND,[m
[31m-            false, true);[m
[31m-        var request = tx.objectStore(FILE_STORE_).get(range);[m
[31m-[m
[31m-        tx.onabort = errorCallback || onError;[m
[31m-        tx.oncomplete = function(e) {[m
[31m-            successCallback(request.result);[m
[31m-        };[m
[31m-    };[m
[31m-[m
[31m-    idb_.getAllEntries = function(fullPath, storagePath, successCallback, errorCallback) {[m
[31m-        if (!this.db) {[m
[31m-            if (errorCallback) {[m
[31m-                errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[31m-            }[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-        var results = [];[m
[31m-[m
[31m-        if (storagePath[storagePath.length - 1] === DIR_SEPARATOR) {[m
[31m-            storagePath = storagePath.substring(0, storagePath.length - 1);[m
[31m-        }[m
[31m-[m
[31m-        var range = IDBKeyRange.bound([m
[31m-                storagePath + DIR_SEPARATOR, storagePath + DIR_OPEN_BOUND, false, true);[m
[31m-[m
[31m-        var tx = this.db.transaction([FILE_STORE_], 'readonly');[m
[31m-        tx.onabort = errorCallback || onError;[m
[31m-        tx.oncomplete = function(e) {[m
[31m-            results = results.filter(function(val) {[m
[31m-                var valPartsLen = val.fullPath.split(DIR_SEPARATOR).length;[m
[31m-                var fullPathPartsLen = fullPath.split(DIR_SEPARATOR).length;[m
[31m-[m
[31m-                if (fullPath === DIR_SEPARATOR && valPartsLen < fullPathPartsLen + 1) {[m
[31m-                    // Hack to filter out entries in the root folder. This is inefficient[m
[31m-                    // because reading the entires of fs.root (e.g. '/') returns ALL[m
[31m-                    // results in the database, then filters out the entries not in '/'.[m
[31m-                    return val;[m
[31m-                } else if (fullPath !== DIR_SEPARATOR &&[m
[31m-                    valPartsLen === fullPathPartsLen + 1) {[m
[31m-                    // If this a subfolder and entry is a direct child, include it in[m
[31m-                    // the results. Otherwise, it's not an entry of this folder.[m
[31m-                    return val;[m
[31m-                }[m
[31m-            });[m
[31m-[m
[31m-            successCallback(results);[m
[31m-        };[m
[31m-[m
[31m-        var request = tx.objectStore(FILE_STORE_).openCursor(range);[m
[31m-[m
[31m-        request.onsuccess = function(e) {[m
[31m-            var cursor = e.target.result;[m
[31m-            if (cursor) {[m
[31m-                var val = cursor.value;[m
[31m-[m
[31m-                results.push(val.isFile ? fileEntryFromIdbEntry(val) : new DirectoryEntry(val.name, val.fullPath, val.fileSystem));[m
[31m-                cursor['continue']();[m
[31m-            }[m
[31m-        };[m
[31m-    };[m
[31m-[m
[31m-    idb_['delete'] = function(fullPath, successCallback, errorCallback) {[m
[31m-        if (!this.db) {[m
[31m-            if (errorCallback) {[m
[31m-                errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[31m-            }[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-        var tx = this.db.transaction([FILE_STORE_], 'readwrite');[m
[31m-        tx.oncomplete = successCallback;[m
[31m-        tx.onabort = errorCallback || onError;[m
[31m-[m
[31m-        //var request = tx.objectStore(FILE_STORE_).delete(fullPath);[m
[31m-        var range = IDBKeyRange.bound([m
[31m-            fullPath, fullPath + DIR_OPEN_BOUND, false, true);[m
[31m-        tx.objectStore(FILE_STORE_)['delete'](range);[m
[31m-    };[m
[31m-[m
[31m-    idb_.put = function(entry, storagePath, successCallback, errorCallback) {[m
[31m-        if (!this.db) {[m
[31m-            if (errorCallback) {[m
[31m-                errorCallback(FileError.INVALID_MODIFICATION_ERR);[m
[31m-            }[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-        var tx = this.db.transaction([FILE_STORE_], 'readwrite');[m
[31m-        tx.onabort = errorCallback || onError;[m
[31m-        tx.oncomplete = function(e) {[m
[31m-            // TODO: Error is thrown if we pass the request event back instead.[m
[31m-            successCallback(entry);[m
[31m-        };[m
[31m-[m
[31m-        tx.objectStore(FILE_STORE_).put(entry, storagePath);[m
[31m-    };[m
[31m-[m
[31m-    // Global error handler. Errors bubble from request, to transaction, to db.[m
[31m-    function onError(e) {[m
[31m-        switch (e.target.errorCode) {[m
[31m-            case 12:[m
[31m-                console.log('Error - Attempt to open db with a lower version than the ' +[m
[31m-                    'current one.');[m
[31m-                break;[m
[31m-            default:[m
[31m-                console.log('errorCode: ' + e.target.errorCode);[m
[31m-        }[m
[31m-[m
[31m-        console.log(e, e.code, e.message);[m
[31m-    }[m
[31m-[m
[31m-// Clean up.[m
[31m-// TODO: Is there a place for this?[m
[31m-//    global.addEventListener('beforeunload', function(e) {[m
[31m-//        idb_.db && idb_.db.close();[m
[31m-//    }, false);[m
[31m-[m
[31m-})(module.exports, window);[m
[31m-[m
[31m-require("cordova/exec/proxy").add("File", module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/src/ios/CDVLocalFilesystem.m b/cordova_exchange_dist/plugins/cordova-plugin-file/src/ios/CDVLocalFilesystem.m[m
[1mindex 35c8db1..c340ce0 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/src/ios/CDVLocalFilesystem.m[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/src/ios/CDVLocalFilesystem.m[m
[36m@@ -703,7 +703,7 @@[m
         NSMutableDictionary* fileInfo = [NSMutableDictionary dictionaryWithCapacity:5];[m
 [m
         [fileInfo setObject:localURL.fullPath forKey:@"fullPath"];[m
[31m-        [fileInfo setObject:@"" forKey:@"type"];  // can't easily get the mimetype unless create URL, send request and read response so skipping[m
[32m+[m[32m        [fileInfo setObject:[self mimeTypeForFileAtPath: path] forKey:@"type"];[m
         [fileInfo setObject:[path lastPathComponent] forKey:@"name"];[m
 [m
         // Ensure that directories (and other non-regular files) report size of 0[m
[36m@@ -731,4 +731,20 @@[m
     callback(result);[m
 }[m
 [m
[32m+[m[32m// fix errors that base on Alexsander Akers from http://stackoverflow.com/a/5998683/2613194[m
[32m+[m[32m- (NSString*) mimeTypeForFileAtPath: (NSString *) path {[m
[32m+[m[32m    if (![[NSFileManager defaultManager] fileExistsAtPath:path]) {[m
[32m+[m[32m        return nil;[m
[32m+[m[32m    }[m
[32m+[m[41m    [m
[32m+[m[32m    CFStringRef UTI = UTTypeCreatePreferredIdentifierForTag(kUTTagClassFilenameExtension, (__bridge CFStringRef)[path pathExtension], NULL);[m
[32m+[m[32m    CFStringRef mimeType = UTTypeCopyPreferredTagWithClass (UTI, kUTTagClassMIMEType);[m
[32m+[m[32m    CFRelease(UTI);[m
[32m+[m[41m    [m
[32m+[m[32m    if (!mimeType) {[m
[32m+[m[32m        return @"application/octet-stream";[m
[32m+[m[32m    }[m
[32m+[m[32m    return (__bridge NSString *)mimeType;[m
[32m+[m[32m}[m
[32m+[m
 @end[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/src/ubuntu/file.cpp b/cordova_exchange_dist/plugins/cordova-plugin-file/src/ubuntu/file.cpp[m
[1mdeleted file mode 100644[m
[1mindex 395ab2d..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/src/ubuntu/file.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,912 +0,0 @@[m
[31m-/*[m
[31m- *  Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- *  you may not use this file except in compliance with the License.[m
[31m- *  You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- *  Unless required by applicable law or agreed to in writing, software[m
[31m- *  distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- *  See the License for the specific language governing permissions and[m
[31m- *  limitations under the License.[m
[31m- */[m
[31m-[m
[31m-#include "file.h"[m
[31m-[m
[31m-#include <QApplication>[m
[31m-[m
[31m-namespace {[m
[31m-    class FileError {[m
[31m-    public:[m
[31m-        static const QString kEncodingErr;[m
[31m-        static const QString kTypeMismatchErr;[m
[31m-        static const QString kNotFoundErr;[m
[31m-        static const QString kSecurityErr;[m
[31m-        static const QString kAbortErr;[m
[31m-        static const QString kNotReadableErr;[m
[31m-        static const QString kNoModificationAllowedErr;[m
[31m-        static const QString kInvalidStateErr;[m
[31m-        static const QString kSyntaxErr;[m
[31m-        static const QString kInvalidModificationErr;[m
[31m-        static const QString kQuotaExceededErr;[m
[31m-        static const QString kPathExistsErr;[m
[31m-    };[m
[31m-[m
[31m-    bool checkFileName(const QString &name) {[m
[31m-        if (name.contains(":")){[m
[31m-            return false;[m
[31m-        }[m
[31m-        return true;[m
[31m-    }[m
[31m-};[m
[31m-[m
[31m-const QString FileError::kEncodingErr("FileError.ENCODING_ERR");[m
[31m-const QString FileError::kTypeMismatchErr("FileError.TYPE_MISMATCH_ERR");[m
[31m-const QString FileError::kNotFoundErr("FileError.NOT_FOUND_ERR");[m
[31m-const QString FileError::kSecurityErr("FileError.SECURITY_ERR");[m
[31m-const QString FileError::kAbortErr("FileError.ABORT_ERR");[m
[31m-const QString FileError::kNotReadableErr("FileError.NOT_READABLE_ERR");[m
[31m-const QString FileError::kNoModificationAllowedErr("FileError.NO_MODIFICATION_ALLOWED_ERR");[m
[31m-const QString FileError::kInvalidStateErr("FileError.INVALID_STATE_ERR");[m
[31m-const QString FileError::kSyntaxErr("FileError.SYNTAX_ERR");[m
[31m-const QString FileError::kInvalidModificationErr("FileError.INVALID_MODIFICATION_ERR");[m
[31m-const QString FileError::kQuotaExceededErr("FileError.QUOTA_EXCEEDED_ERR");[m
[31m-const QString FileError::kPathExistsErr("FileError.PATH_EXISTS_ERR");[m
[31m-[m
[31m-File::File(Cordova *cordova) :[m
[31m-    CPlugin(cordova),[m
[31m-    _persistentDir(QString("%1/.local/share/%2/persistent").arg(QDir::homePath()).arg(QCoreApplication::applicationName())) {[m
[31m-    QDir::root().mkpath(_persistentDir.absolutePath());[m
[31m-}[m
[31m-[m
[31m-QVariantMap File::file2map(const QFileInfo &fileInfo) {[m
[31m-    QVariantMap res;[m
[31m-[m
[31m-    res.insert("name", fileInfo.fileName());[m
[31m-    QPair<QString, QString> r = GetRelativePath(fileInfo);[m
[31m-    res.insert("fullPath", QString("/") + r.second);[m
[31m-    res.insert("filesystemName", r.first);[m
[31m-[m
[31m-    res.insert("nativeURL", QString("file://localhost") + fileInfo.absoluteFilePath());[m
[31m-    res.insert("isDirectory", (int)fileInfo.isDir());[m
[31m-    res.insert("isFile", (int)fileInfo.isFile());[m
[31m-[m
[31m-    return res;[m
[31m-}[m
[31m-[m
[31m-QVariantMap File::dir2map(const QDir &dir) {[m
[31m-    return file2map(QFileInfo(dir.absolutePath()));[m
[31m-}[m
[31m-[m
[31m-QPair<QString, QString> File::GetRelativePath(const QFileInfo &fileInfo) {[m
[31m-    QString fullPath = fileInfo.isDir() ? QDir::cleanPath(fileInfo.absoluteFilePath()) : fileInfo.absoluteFilePath();[m
[31m-[m
[31m-    QString relativePath1 = _persistentDir.relativeFilePath(fullPath);[m
[31m-    QString relativePath2 = QDir::temp().relativeFilePath(fullPath);[m
[31m-[m
[31m-    if (!(relativePath1[0] != '.' || relativePath2[0] != '.')) {[m
[31m-        if (relativePath1.size() > relativePath2.size()) {[m
[31m-            return QPair<QString, QString>("temporary", relativePath2);[m
[31m-        } else {[m
[31m-            return QPair<QString, QString>("persistent", relativePath1);[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    if (relativePath1[0] != '.')[m
[31m-        return QPair<QString, QString>("persistent", relativePath1);[m
[31m-    return QPair<QString, QString>("temporary", relativePath2);[m
[31m-}[m
[31m-[m
[31m-void File::requestFileSystem(int scId, int ecId, unsigned short type, unsigned long long size) {[m
[31m-    QDir dir;[m
[31m-[m
[31m-    if (size >= 1000485760){[m
[31m-        this->callback(ecId, FileError::kQuotaExceededErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (type == 0)[m
[31m-        dir = QDir::temp();[m
[31m-    else[m
[31m-        dir = _persistentDir;[m
[31m-[m
[31m-    if (type > 1) {[m
[31m-        this->callback(ecId, FileError::kSyntaxErr);[m
[31m-        return;[m
[31m-    } else {[m
[31m-        QVariantMap res;[m
[31m-        res.insert("root", dir2map(dir));[m
[31m-        if (type == 0)[m
[31m-            res.insert("name", "temporary");[m
[31m-        else[m
[31m-            res.insert("name", "persistent");[m
[31m-[m
[31m-        this->cb(scId, res);[m
[31m-    }[m
[31m-}[m
[31m-[m
[31m-QPair<bool, QFileInfo> File::resolveURI(int ecId, const QString &uri) {[m
[31m-    QPair<bool, QFileInfo> result;[m
[31m-[m
[31m-    result.first = false;[m
[31m-[m
[31m-    QUrl url = QUrl::fromUserInput(uri);[m
[31m-[m
[31m-    if (url.scheme() == "file" && url.isValid()) {[m
[31m-        result.first = true;[m
[31m-        result.second = QFileInfo(url.path());[m
[31m-        return result;[m
[31m-    }[m
[31m-[m
[31m-    if (url.scheme() != "cdvfile") {[m
[31m-        if (ecId)[m
[31m-            this->callback(ecId, FileError::kTypeMismatchErr);[m
[31m-        return result;[m
[31m-    }[m
[31m-[m
[31m-    QString path = url.path().replace("//", "/");[m
[31m-    //NOTE: colon is not safe in url, it is not a valid path in Win and Mac, simple disable it here.[m
[31m-    if (path.contains(":") || !url.isValid()){[m
[31m-        if (ecId)[m
[31m-            this->callback(ecId, FileError::kEncodingErr);[m
[31m-        return result;[m
[31m-    }[m
[31m-    if (!path.startsWith("/persistent/") && !path.startsWith("/temporary/")) {[m
[31m-        if (ecId)[m
[31m-            this->callback(ecId, FileError::kEncodingErr);[m
[31m-        return result;[m
[31m-    }[m
[31m-[m
[31m-    result.first = true;[m
[31m-    if (path.startsWith("/persistent/")) {[m
[31m-        QString relativePath = path.mid(QString("/persistent/").size());[m
[31m-        result.second = QFileInfo(_persistentDir.filePath(relativePath));[m
[31m-    } else {[m
[31m-        QString relativePath = path.mid(QString("/temporary/").size());[m
[31m-        result.second = QFileInfo(QDir::temp().filePath(relativePath));[m
[31m-    }[m
[31m-    return result;[m
[31m-}[m
[31m-[m
[31m-QPair<bool, QFileInfo> File::resolveURI(const QString &uri) {[m
[31m-    return resolveURI(0, uri);[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void File::_getLocalFilesystemPath(int scId, int ecId, const QString& uri) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    this->cb(scId, f1.second.absoluteFilePath());[m
[31m-}[m
[31m-[m
[31m-void File::resolveLocalFileSystemURI(int scId, int ecId, const QString &uri) {[m
[31m-    if (uri[0] == '/' || uri[0] == '.') {[m
[31m-        this->callback(ecId, FileError::kEncodingErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    QFileInfo fileInfo = f1.second;[m
[31m-    if (!fileInfo.exists()) {[m
[31m-        this->callback(ecId, FileError::kNotFoundErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    this->cb(scId, file2map(fileInfo));[m
[31m-}[m
[31m-[m
[31m-void File::getFile(int scId, int ecId, const QString &parentPath, const QString &rpath, const QVariantMap &options) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, parentPath + "/" + rpath);[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    bool create = options.value("create").toBool();[m
[31m-    bool exclusive = options.value("exclusive").toBool();[m
[31m-    QFile file(f1.second.absoluteFilePath());[m
[31m-[m
[31m-    // if create is false and the path represents a directory, return error[m
[31m-    QFileInfo fileInfo = f1.second;[m
[31m-    if ((!create) && fileInfo.isDir()) {[m
[31m-        this->callback(ecId, FileError::kTypeMismatchErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    // if file does exist, and create is true and exclusive is true, return error[m
[31m-    if (file.exists()) {[m
[31m-        if (create && exclusive) {[m
[31m-            this->callback(ecId, FileError::kPathExistsErr);[m
[31m-            return;[m
[31m-        }[m
[31m-    }[m
[31m-    else {[m
[31m-        // if file does not exist and create is false, return error[m
[31m-        if (!create) {[m
[31m-            this->callback(ecId, FileError::kNotFoundErr);[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-        file.open(QIODevice::WriteOnly);[m
[31m-        file.close();[m
[31m-[m
[31m-        // Check if creation was successfull[m
[31m-        if (!file.exists()) {[m
[31m-            this->callback(ecId, FileError::kNoModificationAllowedErr);[m
[31m-            return;[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    this->cb(scId, file2map(QFileInfo(file)));[m
[31m-}[m
[31m-[m
[31m-void File::getDirectory(int scId, int ecId, const QString &parentPath, const QString &rpath, const QVariantMap &options) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, parentPath + "/" + rpath);[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    bool create = options.value("create").toBool();[m
[31m-    bool exclusive = options.value("exclusive").toBool();[m
[31m-    QDir dir(f1.second.absoluteFilePath());[m
[31m-[m
[31m-    QFileInfo &fileInfo = f1.second;[m
[31m-    if ((!create) && fileInfo.isFile()) {[m
[31m-        this->callback(ecId, FileError::kTypeMismatchErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (dir.exists()) {[m
[31m-        if (create && exclusive) {[m
[31m-            this->callback(ecId, FileError::kPathExistsErr);[m
[31m-            return;[m
[31m-        }[m
[31m-    }[m
[31m-    else {[m
[31m-        if (!create) {[m
[31m-            this->callback(ecId, FileError::kNotFoundErr);[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-        QString folderName = dir.dirName();[m
[31m-        dir.cdUp();[m
[31m-        dir.mkdir(folderName);[m
[31m-        dir.cd(folderName);[m
[31m-[m
[31m-        if (!dir.exists()) {[m
[31m-            this->callback(ecId, FileError::kNoModificationAllowedErr);[m
[31m-            return;[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    this->cb(scId, dir2map(dir));[m
[31m-}[m
[31m-[m
[31m-void File::removeRecursively(int scId, int ecId, const QString &uri) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    QDir dir(f1.second.absoluteFilePath());[m
[31m-    if (File::rmDir(dir))[m
[31m-        this->cb(scId);[m
[31m-    else[m
[31m-        this->callback(ecId, FileError::kNoModificationAllowedErr);[m
[31m-}[m
[31m-[m
[31m-void File::write(int scId, int ecId, const QString &uri, const QString &_data, unsigned long long position, bool binary) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    QFile file(f1.second.absoluteFilePath());[m
[31m-[m
[31m-    file.open(QIODevice::WriteOnly);[m
[31m-    file.close();[m
[31m-[m
[31m-    if (!file.exists()) {[m
[31m-        this->callback(ecId, FileError::kNotFoundErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    QFileInfo fileInfo(file);[m
[31m-    if (!file.open(QIODevice::ReadWrite)) {[m
[31m-        this->callback(ecId, FileError::kNoModificationAllowedErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (!binary) {[m
[31m-        QTextStream textStream(&file);[m
[31m-        textStream.setCodec("UTF-8");[m
[31m-        textStream.setAutoDetectUnicode(true);[m
[31m-[m
[31m-        if (!textStream.seek(position)) {[m
[31m-            file.close();[m
[31m-            fileInfo.refresh();[m
[31m-[m
[31m-            this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-        textStream << _data;[m
[31m-        textStream.flush();[m
[31m-    } else {[m
[31m-        QByteArray data(_data.toUtf8());[m
[31m-        if (!file.seek(position)) {[m
[31m-            file.close();[m
[31m-            fileInfo.refresh();[m
[31m-[m
[31m-            this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-        file.write(data.data(), data.length());[m
[31m-    }[m
[31m-[m
[31m-    file.flush();[m
[31m-    file.close();[m
[31m-    fileInfo.refresh();[m
[31m-[m
[31m-    this->cb(scId, fileInfo.size() - position);[m
[31m-}[m
[31m-[m
[31m-void File::truncate(int scId, int ecId, const QString &uri, unsigned long long size) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    QFile file(f1.second.absoluteFilePath());[m
[31m-[m
[31m-    if (!file.exists()) {[m
[31m-        this->callback(ecId, FileError::kNotFoundErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (!file.resize(size)) {[m
[31m-        this->callback(ecId, FileError::kNoModificationAllowedErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    this->cb(scId, size);[m
[31m-}[m
[31m-[m
[31m-void File::getParent(int scId, int ecId, const QString &uri) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-    QDir dir(f1.second.absoluteFilePath());[m
[31m-[m
[31m-    //can't cdup more than app's root[m
[31m-    // Try to change into upper directory[m
[31m-    if (dir != _persistentDir && dir != QDir::temp()){[m
[31m-        if (!dir.cdUp()) {[m
[31m-            this->callback(ecId, FileError::kNotFoundErr);[m
[31m-            return;[m
[31m-        }[m
[31m-[m
[31m-    }[m
[31m-    this->cb(scId, dir2map(dir));[m
[31m-}[m
[31m-[m
[31m-void File::remove(int scId, int ecId, const QString &uri) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    QFileInfo &fileInfo = f1.second;[m
[31m-    //TODO: fix[m
[31m-    if (!fileInfo.exists() || (fileInfo.absoluteFilePath() == _persistentDir.absolutePath()) || (QDir::temp() == fileInfo.absoluteFilePath())) {[m
[31m-        this->callback(ecId, FileError::kNoModificationAllowedErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (fileInfo.isDir()) {[m
[31m-        QDir dir(fileInfo.absoluteFilePath());[m
[31m-        if (dir.rmdir(dir.absolutePath())) {[m
[31m-            this->cb(scId);[m
[31m-            return;[m
[31m-        }[m
[31m-    } else {[m
[31m-        QFile file(fileInfo.absoluteFilePath());[m
[31m-        if (file.remove()) {[m
[31m-            this->cb(scId);[m
[31m-            return;[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-}[m
[31m-[m
[31m-void File::getFileMetadata(int scId, int ecId, const QString &uri) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-    QFileInfo &fileInfo = f1.second;[m
[31m-[m
[31m-    if (!fileInfo.exists()) {[m
[31m-        this->callback(ecId, FileError::kNotFoundErr);[m
[31m-    } else {[m
[31m-        QMimeType mime = _db.mimeTypeForFile(fileInfo.fileName());[m
[31m-[m
[31m-        QString args = QString("{name: %1, fullPath: %2, type: %3, lastModifiedDate: new Date(%4), size: %5}")[m
[31m-            .arg(CordovaInternal::format(fileInfo.fileName())).arg(CordovaInternal::format(fileInfo.absoluteFilePath()))[m
[31m-            .arg(CordovaInternal::format(mime.name())).arg(fileInfo.lastModified().toMSecsSinceEpoch())[m
[31m-            .arg(fileInfo.size());[m
[31m-[m
[31m-        this->callback(scId, args);[m
[31m-    }[m
[31m-}[m
[31m-[m
[31m-void File::getMetadata(int scId, int ecId, const QString &uri) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-    QFileInfo &fileInfo = f1.second;[m
[31m-[m
[31m-    if (!fileInfo.exists())[m
[31m-        this->callback(ecId, FileError::kNotFoundErr);[m
[31m-    else {[m
[31m-        QVariantMap obj;[m
[31m-        obj.insert("modificationTime", fileInfo.lastModified().toMSecsSinceEpoch());[m
[31m-        obj.insert("size", fileInfo.isDir() ? 0 : fileInfo.size());[m
[31m-        this->cb(scId, obj);[m
[31m-    }[m
[31m-}[m
[31m-[m
[31m-void File::readEntries(int scId, int ecId, const QString &uri) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-    QDir dir(f1.second.absoluteFilePath());[m
[31m-    QString entriesList;[m
[31m-[m
[31m-    if (!dir.exists()) {[m
[31m-        this->callback(ecId, FileError::kNotFoundErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    for (const QFileInfo &fileInfo: dir.entryInfoList(QDir::Dirs | QDir::Files | QDir::NoDotAndDotDot)) {[m
[31m-        entriesList += CordovaInternal::format(file2map(fileInfo)) + ",";[m
[31m-    }[m
[31m-    // Remove trailing comma[m
[31m-    if (entriesList.size() > 0)[m
[31m-        entriesList.remove(entriesList.size() - 1, 1);[m
[31m-[m
[31m-    entriesList = "new Array(" + entriesList + ")";[m
[31m-[m
[31m-    this->callback(scId, entriesList);[m
[31m-}[m
[31m-[m
[31m-void File::readAsText(int scId, int ecId, const QString &uri, const QString &/*encoding*/, int sliceStart, int sliceEnd) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    QFile file(f1.second.absoluteFilePath());[m
[31m-[m
[31m-    if (!file.exists()) {[m
[31m-        this->callback(ecId, FileError::kNotFoundErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (!file.open(QIODevice::ReadOnly)) {[m
[31m-        this->callback(ecId, FileError::kNotReadableErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    QByteArray content = file.readAll();[m
[31m-[m
[31m-    if (sliceEnd == -1)[m
[31m-        sliceEnd = content.size();[m
[31m-    if (sliceEnd < 0) {[m
[31m-        sliceEnd++;[m
[31m-        sliceEnd = std::max(0, content.size() + sliceEnd);[m
[31m-    }[m
[31m-    if (sliceEnd > content.size())[m
[31m-        sliceEnd = content.size();[m
[31m-[m
[31m-    if (sliceStart < 0)[m
[31m-        sliceStart = std::max(0, content.size() + sliceStart);[m
[31m-    if (sliceStart > content.size())[m
[31m-        sliceStart = content.size();[m
[31m-[m
[31m-    if (sliceStart > sliceEnd)[m
[31m-        sliceEnd = sliceStart;[m
[31m-[m
[31m-    //FIXME: encoding[m
[31m-    content = content.mid(sliceStart, sliceEnd - sliceStart);[m
[31m-[m
[31m-    this->cb(scId, content);[m
[31m-}[m
[31m-[m
[31m-void File::readAsArrayBuffer(int scId, int ecId, const QString &uri, int sliceStart, int sliceEnd) {[m
[31m-    const QString str2array("\[m
[31m-    (function strToArray(str) {                 \[m
[31m-        var res = new Uint8Array(str.length);   \[m
[31m-        for (var i = 0; i < str.length; i++) {  \[m
[31m-            res[i] = str.charCodeAt(i);         \[m
[31m-        }                                       \[m
[31m-        return res;                             \[m
[31m-    })(\"%1\")");[m
[31m-[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    QFile file(f1.second.absoluteFilePath());[m
[31m-[m
[31m-    if (!file.exists()) {[m
[31m-        this->callback(ecId, FileError::kNotFoundErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (!file.open(QIODevice::ReadOnly)) {[m
[31m-        this->callback(ecId, FileError::kNotReadableErr);[m
[31m-        return;[m
[31m-    }[m
[31m-    QString res;[m
[31m-    QByteArray content = file.readAll();[m
[31m-[m
[31m-    if (sliceEnd == -1)[m
[31m-        sliceEnd = content.size();[m
[31m-    if (sliceEnd < 0) {[m
[31m-        sliceEnd++;[m
[31m-        sliceEnd = std::max(0, content.size() + sliceEnd);[m
[31m-    }[m
[31m-    if (sliceEnd > content.size())[m
[31m-        sliceEnd = content.size();[m
[31m-[m
[31m-    if (sliceStart < 0)[m
[31m-        sliceStart = std::max(0, content.size() + sliceStart);[m
[31m-    if (sliceStart > content.size())[m
[31m-        sliceStart = content.size();[m
[31m-[m
[31m-    if (sliceStart > sliceEnd)[m
[31m-        sliceEnd = sliceStart;[m
[31m-[m
[31m-    content = content.mid(sliceStart, sliceEnd - sliceStart);[m
[31m-[m
[31m-    res.reserve(content.length() * 6);[m
[31m-    for (uchar c: content) {[m
[31m-        res += "\\x";[m
[31m-        res += QString::number(c, 16).rightJustified(2, '0').toUpper();[m
[31m-    }[m
[31m-[m
[31m-    this->callback(scId, str2array.arg(res));[m
[31m-}[m
[31m-[m
[31m-void File::readAsBinaryString(int scId, int ecId, const QString &uri, int sliceStart, int sliceEnd) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    QFile file(f1.second.absoluteFilePath());[m
[31m-[m
[31m-    if (!file.exists()) {[m
[31m-        this->callback(ecId, FileError::kNotFoundErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (!file.open(QIODevice::ReadOnly)) {[m
[31m-        this->callback(ecId, FileError::kNotReadableErr);[m
[31m-        return;[m
[31m-    }[m
[31m-    QString res;[m
[31m-    QByteArray content = file.readAll();[m
[31m-[m
[31m-    if (sliceEnd == -1)[m
[31m-        sliceEnd = content.size();[m
[31m-    if (sliceEnd < 0) {[m
[31m-        sliceEnd++;[m
[31m-        sliceEnd = std::max(0, content.size() + sliceEnd);[m
[31m-    }[m
[31m-    if (sliceEnd > content.size())[m
[31m-        sliceEnd = content.size();[m
[31m-[m
[31m-    if (sliceStart < 0)[m
[31m-        sliceStart = std::max(0, content.size() + sliceStart);[m
[31m-    if (sliceStart > content.size())[m
[31m-        sliceStart = content.size();[m
[31m-[m
[31m-    if (sliceStart > sliceEnd)[m
[31m-        sliceEnd = sliceStart;[m
[31m-[m
[31m-    content = content.mid(sliceStart, sliceEnd - sliceStart);[m
[31m-[m
[31m-    res.reserve(content.length() * 6);[m
[31m-    for (uchar c: content) {[m
[31m-        res += "\\x";[m
[31m-        res += QString::number(c, 16).rightJustified(2, '0').toUpper();[m
[31m-    }[m
[31m-    this->callback(scId, "\"" + res + "\"");[m
[31m-}[m
[31m-[m
[31m-void File::readAsDataURL(int scId, int ecId, const QString &uri, int sliceStart, int sliceEnd) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, uri);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    QFile file(f1.second.absoluteFilePath());[m
[31m-    QFileInfo &fileInfo = f1.second;[m
[31m-[m
[31m-    if (!file.exists()) {[m
[31m-        this->callback(ecId, FileError::kNotReadableErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (!file.open(QIODevice::ReadOnly)) {[m
[31m-        this->callback(ecId, FileError::kNotReadableErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    QByteArray content = file.readAll();[m
[31m-    QString contentType(_db.mimeTypeForFile(fileInfo.fileName()).name());[m
[31m-[m
[31m-    if (sliceEnd == -1)[m
[31m-        sliceEnd = content.size();[m
[31m-    if (sliceEnd < 0) {[m
[31m-        sliceEnd++;[m
[31m-        sliceEnd = std::max(0, content.size() + sliceEnd);[m
[31m-    }[m
[31m-    if (sliceEnd > content.size())[m
[31m-        sliceEnd = content.size();[m
[31m-[m
[31m-    if (sliceStart < 0)[m
[31m-        sliceStart = std::max(0, content.size() + sliceStart);[m
[31m-    if (sliceStart > content.size())[m
[31m-        sliceStart = content.size();[m
[31m-[m
[31m-    if (sliceStart > sliceEnd)[m
[31m-        sliceEnd = sliceStart;[m
[31m-[m
[31m-    content = content.mid(sliceStart, sliceEnd - sliceStart);[m
[31m-[m
[31m-    this->cb(scId, QString("data:%1;base64,").arg(contentType) + content.toBase64());[m
[31m-}[m
[31m-[m
[31m-bool File::rmDir(const QDir &dir) {[m
[31m-    if (dir == _persistentDir || dir == QDir::temp()) {//can't remove root dir[m
[31m-        return false;[m
[31m-    }[m
[31m-    bool result = true;[m
[31m-    if (dir.exists()) {[m
[31m-        // Iterate over entries and remove them[m
[31m-        Q_FOREACH(const QFileInfo &fileInfo, dir.entryInfoList(QDir::Dirs | QDir::Files | QDir::NoDotAndDotDot)) {[m
[31m-            if (fileInfo.isDir()) {[m
[31m-                result = rmDir(fileInfo.absoluteFilePath());[m
[31m-            }[m
[31m-            else {[m
[31m-                result = QFile::remove(fileInfo.absoluteFilePath());[m
[31m-            }[m
[31m-[m
[31m-            if (!result) {[m
[31m-                return result;[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        // Finally remove the current dir[m
[31m-        return dir.rmdir(dir.absolutePath());[m
[31m-    }[m
[31m-    return result;[m
[31m-}[m
[31m-[m
[31m-bool File::copyFile(int scId, int ecId,const QString& sourceUri, const QString& destinationUri, const QString& newName) {[m
[31m-    QPair<bool, QFileInfo> destDir = resolveURI(ecId, destinationUri);[m
[31m-    QPair<bool, QFileInfo> sourceFile = resolveURI(ecId, sourceUri);[m
[31m-[m
[31m-    if (!destDir.first || !sourceFile.first)[m
[31m-        return false;[m
[31m-[m
[31m-    if (!checkFileName(newName)) {[m
[31m-        this->callback(ecId, FileError::kEncodingErr);[m
[31m-        return false;[m
[31m-    }[m
[31m-[m
[31m-    if (destDir.second.isFile()) {[m
[31m-        this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-        return false;[m
[31m-    }[m
[31m-[m
[31m-    if (!destDir.second.isDir()) {[m
[31m-        this->callback(ecId, FileError::kNotFoundErr);[m
[31m-        return false;[m
[31m-    }[m
[31m-[m
[31m-    QFileInfo &fileInfo = sourceFile.second;[m
[31m-    QString fileName((newName.isEmpty()) ? fileInfo.fileName() : newName);[m
[31m-    QString destinationFile(QDir(destDir.second.absoluteFilePath()).filePath(fileName));[m
[31m-    if (QFile::copy(fileInfo.absoluteFilePath(), destinationFile)){[m
[31m-        this->cb(scId, file2map(QFileInfo(destinationFile)));[m
[31m-        return true;[m
[31m-    }[m
[31m-    this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-    return false;[m
[31m-}[m
[31m-[m
[31m-void File::copyDir(int scId, int ecId,const QString& sourceUri, const QString& destinationUri, const QString& newName) {[m
[31m-    QPair<bool, QFileInfo> destDir = resolveURI(ecId, destinationUri);[m
[31m-    QPair<bool, QFileInfo> sourceDir = resolveURI(ecId, sourceUri);[m
[31m-[m
[31m-    if (!destDir.first || !sourceDir.first)[m
[31m-        return;[m
[31m-    if (!checkFileName(newName)) {[m
[31m-        this->callback(ecId, FileError::kEncodingErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    QString targetName = ((newName.isEmpty()) ? sourceDir.second.fileName() : newName);[m
[31m-    QString target(QDir(destDir.second.absoluteFilePath()).filePath(targetName));[m
[31m-[m
[31m-    if (QFileInfo(target).isFile()){[m
[31m-        this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    // check: copy directory into itself[m
[31m-    if (QDir(sourceDir.second.absoluteFilePath()).relativeFilePath(target)[0] != '.'){[m
[31m-        this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (!QDir(target).exists()){[m
[31m-        QDir(destDir.second.absoluteFilePath()).mkdir(target);;[m
[31m-    } else{[m
[31m-        this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (copyFolder(sourceDir.second.absoluteFilePath(), target)){[m
[31m-        this->cb(scId, dir2map(QDir(target)));[m
[31m-        return;[m
[31m-    }[m
[31m-    this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-    return;[m
[31m-}[m
[31m-[m
[31m-void File::copyTo(int scId, int ecId, const QString& source, const QString& destinationDir, const QString& newName) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, source);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    if (f1.second.isDir())[m
[31m-        copyDir(scId, ecId, source, destinationDir, newName);[m
[31m-    else[m
[31m-        copyFile(scId, ecId, source, destinationDir, newName);[m
[31m-}[m
[31m-[m
[31m-void File::moveFile(int scId, int ecId,const QString& sourceUri, const QString& destinationUri, const QString& newName) {[m
[31m-    QPair<bool, QFileInfo> sourceFile = resolveURI(ecId, sourceUri);[m
[31m-    QPair<bool, QFileInfo> destDir = resolveURI(ecId, destinationUri);[m
[31m-[m
[31m-    if (!destDir.first || !sourceFile.first)[m
[31m-        return;[m
[31m-    if (!checkFileName(newName)) {[m
[31m-        this->callback(ecId, FileError::kEncodingErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    QString fileName = ((newName.isEmpty()) ? sourceFile.second.fileName() : newName);[m
[31m-    QString target = QDir(destDir.second.absoluteFilePath()).filePath(fileName);[m
[31m-[m
[31m-    if (sourceFile.second == QFileInfo(target)) {[m
[31m-        this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (!destDir.second.exists()) {[m
[31m-        this->callback(ecId, FileError::kNotFoundErr);[m
[31m-        return;[m
[31m-    }[m
[31m-    if (!destDir.second.isDir()){[m
[31m-        this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (QFileInfo(target).exists()) {[m
[31m-        if (!QFile::remove(target)) {[m
[31m-            this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-            return;[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    QFile::rename(sourceFile.second.absoluteFilePath(), target);[m
[31m-    this->cb(scId, file2map(QFileInfo(target)));[m
[31m-}[m
[31m-[m
[31m-void File::moveDir(int scId, int ecId,const QString& sourceUri, const QString& destinationUri, const QString& newName){[m
[31m-    QPair<bool, QFileInfo> sourceDir = resolveURI(ecId, sourceUri);[m
[31m-    QPair<bool, QFileInfo> destDir = resolveURI(ecId, destinationUri);[m
[31m-[m
[31m-    if (!destDir.first || !sourceDir.first)[m
[31m-        return;[m
[31m-    if (!checkFileName(newName)) {[m
[31m-        this->callback(ecId, FileError::kEncodingErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    QString fileName = ((newName.isEmpty()) ? sourceDir.second.fileName() : newName);[m
[31m-    QString target = QDir(destDir.second.absoluteFilePath()).filePath(fileName);[m
[31m-[m
[31m-    if (!destDir.second.exists()){[m
[31m-        this->callback(ecId, FileError::kNotFoundErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (destDir.second.isFile()){[m
[31m-        this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    // check: copy directory into itself[m
[31m-    if (QDir(sourceDir.second.absoluteFilePath()).relativeFilePath(target)[0] != '.'){[m
[31m-        this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (QFileInfo(target).exists() && !QDir(destDir.second.absoluteFilePath()).rmdir(fileName)) {[m
[31m-        this->callback(ecId, FileError::kInvalidModificationErr);[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    if (copyFolder(sourceDir.second.absoluteFilePath(), target)) {[m
[31m-        rmDir(sourceDir.second.absoluteFilePath());[m
[31m-        this->cb(scId, file2map(QFileInfo(target)));[m
[31m-    } else {[m
[31m-        this->callback(ecId, FileError::kNoModificationAllowedErr);[m
[31m-    }[m
[31m-}[m
[31m-[m
[31m-void File::moveTo(int scId, int ecId, const QString& source, const QString& destinationDir, const QString& newName) {[m
[31m-    QPair<bool, QFileInfo> f1 = resolveURI(ecId, source);[m
[31m-[m
[31m-    if (!f1.first)[m
[31m-        return;[m
[31m-[m
[31m-    if (f1.second.isDir())[m
[31m-        moveDir(scId, ecId, source, destinationDir, newName);[m
[31m-    else[m
[31m-        moveFile(scId, ecId, source, destinationDir, newName);[m
[31m-}[m
[31m-[m
[31m-bool File::copyFolder(const QString& sourceFolder, const QString& destFolder) {[m
[31m-    QDir sourceDir(sourceFolder);[m
[31m-    if (!sourceDir.exists())[m
[31m-        return false;[m
[31m-    QDir destDir(destFolder);[m
[31m-    if (!destDir.exists()){[m
[31m-        destDir.mkdir(destFolder);[m
[31m-    }[m
[31m-    QStringList files = sourceDir.entryList(QDir::Files);[m
[31m-    for (int i = 0; i< files.count(); i++)[m
[31m-    {[m
[31m-        QString srcName = sourceFolder + "/" + files[i];[m
[31m-        QString destName = destFolder + "/" + files[i];[m
[31m-        QFile::copy(srcName, destName);[m
[31m-    }[m
[31m-    files.clear();[m
[31m-    files = sourceDir.entryList(QDir::AllDirs | QDir::NoDotAndDotDot);[m
[31m-    for (int i = 0; i< files.count(); i++)[m
[31m-    {[m
[31m-        QString srcName = sourceFolder + "/" + files[i];[m
[31m-        QString destName = destFolder + "/" + files[i];[m
[31m-        copyFolder(srcName, destName);[m
[31m-    }[m
[31m-    return true;[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/src/ubuntu/file.h b/cordova_exchange_dist/plugins/cordova-plugin-file/src/ubuntu/file.h[m
[1mdeleted file mode 100644[m
[1mindex de27762..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/src/ubuntu/file.h[m
[1m+++ /dev/null[m
[36m@@ -1,81 +0,0 @@[m
[31m-/*[m
[31m- *  Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- *  you may not use this file except in compliance with the License.[m
[31m- *  You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- *  Unless required by applicable law or agreed to in writing, software[m
[31m- *  distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- *  See the License for the specific language governing permissions and[m
[31m- *  limitations under the License.[m
[31m- */[m
[31m-[m
[31m-#ifndef FILEAPI_H_SDASDASDAS[m
[31m-#define FILEAPI_H_SDASDASDAS[m
[31m-[m
[31m-#include <QNetworkReply>[m
[31m-#include <QtCore>[m
[31m-[m
[31m-#include <cplugin.h>[m
[31m-#include <cordova.h>[m
[31m-[m
[31m-class File: public CPlugin {[m
[31m-    Q_OBJECT[m
[31m-public:[m
[31m-    explicit File(Cordova *cordova);[m
[31m-[m
[31m-    virtual const QString fullName() override {[m
[31m-        return File::fullID();[m
[31m-    }[m
[31m-[m
[31m-    virtual const QString shortName() override {[m
[31m-        return "File";[m
[31m-    }[m
[31m-[m
[31m-    static const QString fullID() {[m
[31m-        return "File";[m
[31m-    }[m
[31m-    QPair<bool, QFileInfo> resolveURI(const QString &uri);[m
[31m-    QPair<bool, QFileInfo> resolveURI(int ecId, const QString &uri);[m
[31m-    QVariantMap file2map(const QFileInfo &dir);[m
[31m-[m
[31m-public slots:[m
[31m-    void requestFileSystem(int scId, int ecId, unsigned short type, unsigned long long size);[m
[31m-    void resolveLocalFileSystemURI(int scId, int ecId, const QString&);[m
[31m-    void getDirectory(int scId, int ecId, const QString&, const QString&, const QVariantMap&);[m
[31m-    void getFile(int scId, int ecId, const QString &parentPath, const QString &rpath, const QVariantMap &options);[m
[31m-    void readEntries(int scId, int ecId, const QString &uri);[m
[31m-    void getParent(int scId, int ecId, const QString &uri);[m
[31m-    void copyTo(int scId, int ecId, const QString& source, const QString& destinationDir, const QString& newName);[m
[31m-    void moveTo(int scId, int ecId, const QString& source, const QString& destinationDir, const QString& newName);[m
[31m-    void getFileMetadata(int scId, int ecId, const QString &);[m
[31m-    void getMetadata(int scId, int ecId, const QString &);[m
[31m-    void remove(int scId, int ecId, const QString &);[m
[31m-    void removeRecursively(int scId, int ecId, const QString&);[m
[31m-    void write(int scId, int ecId, const QString&, const QString&, unsigned long long position, bool binary);[m
[31m-    void readAsText(int scId, int ecId, const QString&, const QString &encoding, int sliceStart, int sliceEnd);[m
[31m-    void readAsDataURL(int scId, int ecId, const QString&, int sliceStart, int sliceEnd);[m
[31m-    void readAsArrayBuffer(int scId, int ecId, const QString&, int sliceStart, int sliceEnd);[m
[31m-    void readAsBinaryString(int scId, int ecId, const QString&, int sliceStart, int sliceEnd);[m
[31m-    void truncate(int scId, int ecId, const QString&, unsigned long long size);[m
[31m-[m
[31m-    void _getLocalFilesystemPath(int scId, int ecId, const QString&);[m
[31m-private:[m
[31m-    void moveFile(int scId, int ecId,const QString&, const QString&, const QString&);[m
[31m-    void moveDir(int scId, int ecId,const QString&, const QString&, const QString&);[m
[31m-    bool copyFile(int scId, int ecId, const QString&, const QString&, const QString&);[m
[31m-    void copyDir(int scId, int ecId, const QString&, const QString&, const QString&);[m
[31m-    bool rmDir(const QDir &dir);[m
[31m-    bool copyFolder(const QString&, const QString&);[m
[31m-[m
[31m-    QPair<QString, QString> GetRelativePath(const QFileInfo &fileInfo);[m
[31m-    QVariantMap dir2map(const QDir &dir);[m
[31m-[m
[31m-    QMimeDatabase _db;[m
[31m-    const QDir _persistentDir;[m
[31m-    QNetworkAccessManager _manager;[m
[31m-};[m
[31m-[m
[31m-#endif[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/src/windows/FileProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-file/src/windows/FileProxy.js[m
[1mindex fa56a53..d829d77 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/src/windows/FileProxy.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/src/windows/FileProxy.js[m
[36m@@ -1,4 +1,4 @@[m
[31m-﻿/*[m
[32m+[m[32m/*[m
  *[m
  * Licensed to the Apache Software Foundation (ASF) under one[m
  * or more contributor license agreements.  See the NOTICE file[m
[36m@@ -21,14 +21,14 @@[m
 [m
 /* global Windows, WinJS, MSApp */[m
 [m
[31m-var File = require('./File'),[m
[31m-    FileError = require('./FileError'),[m
[31m-    Flags = require('./Flags'),[m
[31m-    FileSystem = require('./FileSystem'),[m
[31m-    LocalFileSystem = require('./LocalFileSystem'),[m
[31m-    utils = require('cordova/utils');[m
[32m+[m[32mvar File = require('./File');[m
[32m+[m[32mvar FileError = require('./FileError');[m
[32m+[m[32mvar Flags = require('./Flags');[m
[32m+[m[32mvar FileSystem = require('./FileSystem');[m
[32m+[m[32mvar LocalFileSystem = require('./LocalFileSystem');[m
[32m+[m[32mvar utils = require('cordova/utils');[m
 [m
[31m-function Entry(isFile, isDirectory, name, fullPath, filesystemName, nativeURL) {[m
[32m+[m[32mfunction Entry (isFile, isDirectory, name, fullPath, filesystemName, nativeURL) {[m
     this.isFile = !!isFile;[m
     this.isDirectory = !!isDirectory;[m
     this.name = name || '';[m
[36m@@ -37,31 +37,30 @@[m [mfunction Entry(isFile, isDirectory, name, fullPath, filesystemName, nativeURL) {[m
     this.nativeURL = nativeURL || null;[m
 }[m
 [m
[31m-var FileEntry = function(name, fullPath, filesystemName, nativeURL) {[m
[31m-     FileEntry.__super__.constructor.apply(this, [true, false, name, fullPath, filesystemName, nativeURL]);[m
[32m+[m[32mvar FileEntry = function (name, fullPath, filesystemName, nativeURL) {[m
[32m+[m[32m    FileEntry.__super__.constructor.apply(this, [true, false, name, fullPath, filesystemName, nativeURL]);[m
 };[m
 [m
 utils.extend(FileEntry, Entry);[m
 [m
[31m-var DirectoryEntry = function(name, fullPath, filesystemName, nativeURL) {[m
[32m+[m[32mvar DirectoryEntry = function (name, fullPath, filesystemName, nativeURL) {[m
     DirectoryEntry.__super__.constructor.call(this, false, true, name, fullPath, filesystemName, nativeURL);[m
 };[m
 [m
 utils.extend(DirectoryEntry, Entry);[m
 [m
[31m-  [m
 var getFolderFromPathAsync = Windows.Storage.StorageFolder.getFolderFromPathAsync;[m
 var getFileFromPathAsync = Windows.Storage.StorageFile.getFileFromPathAsync;[m
 [m
[31m-function  writeBytesAsync(storageFile, data, position) {[m
[32m+[m[32mfunction writeBytesAsync (storageFile, data, position) {[m
     return storageFile.openAsync(Windows.Storage.FileAccessMode.readWrite)[m
     .then(function (output) {[m
         output.seek(position);[m
         var dataWriter = new Windows.Storage.Streams.DataWriter(output);[m
         dataWriter.writeBytes(data);[m
         return dataWriter.storeAsync().then(function (size) {[m
[31m-            output.size = position+size;[m
[31m-            return dataWriter.flushAsync().then(function() {[m
[32m+[m[32m            output.size = position + size;[m
[32m+[m[32m            return dataWriter.flushAsync().then(function () {[m
                 output.close();[m
                 return size;[m
             });[m
[36m@@ -69,15 +68,15 @@[m [mfunction  writeBytesAsync(storageFile, data, position) {[m
     });[m
 }[m
 [m
[31m-function writeTextAsync(storageFile, data, position) {[m
[32m+[m[32mfunction writeTextAsync (storageFile, data, position) {[m
     return storageFile.openAsync(Windows.Storage.FileAccessMode.readWrite)[m
     .then(function (output) {[m
         output.seek(position);[m
         var dataWriter = new Windows.Storage.Streams.DataWriter(output);[m
         dataWriter.writeString(data);[m
         return dataWriter.storeAsync().then(function (size) {[m
[31m-            output.size = position+size;[m
[31m-            return dataWriter.flushAsync().then(function() {[m
[32m+[m[32m            output.size = position + size;[m
[32m+[m[32m            return dataWriter.flushAsync().then(function () {[m
                 output.close();[m
                 return size;[m
             });[m
[36m@@ -85,17 +84,17 @@[m [mfunction writeTextAsync(storageFile, data, position) {[m
     });[m
 }[m
 [m
[31m-function writeBlobAsync(storageFile, data, position) {[m
[32m+[m[32mfunction writeBlobAsync (storageFile, data, position) {[m
     return storageFile.openAsync(Windows.Storage.FileAccessMode.readWrite)[m
     .then(function (output) {[m
         output.seek(position);[m
         var dataSize = data.size;[m
         var input = (data.detachStream || data.msDetachStream).call(data);[m
 [m
[31m-        // Copy the stream from the blob to the File stream [m
[32m+[m[32m        // Copy the stream from the blob to the File stream[m
         return Windows.Storage.Streams.RandomAccessStream.copyAsync(input, output)[m
         .then(function () {[m
[31m-			output.size = position+dataSize;[m
[32m+[m[32m            output.size = position + dataSize;[m
             return output.flushAsync().then(function () {[m
                 input.close();[m
                 output.close();[m
[36m@@ -106,11 +105,11 @@[m [mfunction writeBlobAsync(storageFile, data, position) {[m
     });[m
 }[m
 [m
[31m-function writeArrayBufferAsync(storageFile, data, position) {[m
[31m-    return writeBlobAsync(storageFile, new Blob([data]), position);[m
[32m+[m[32mfunction writeArrayBufferAsync (storageFile, data, position) {[m
[32m+[m[32m    return writeBlobAsync(storageFile, new Blob([data]), position); // eslint-disable-line no-undef[m
 }[m
 [m
[31m-function cordovaPathToNative(path) {[m
[32m+[m[32mfunction cordovaPathToNative (path) {[m
     // turn / into \\[m
     var cleanPath = path.replace(/\//g, '\\');[m
     // turn  \\ into \[m
[36m@@ -118,30 +117,30 @@[m [mfunction cordovaPathToNative(path) {[m
     return cleanPath;[m
 }[m
 [m
[31m-function nativePathToCordova(path) {[m
[32m+[m[32mfunction nativePathToCordova (path) {[m
     var cleanPath = path.replace(/\\/g, '/');[m
     return cleanPath;[m
 }[m
 [m
[31m-var driveRE = new RegExp("^[/]*([A-Z]:)");[m
[32m+[m[32mvar driveRE = new RegExp('^[/]*([A-Z]:)');[m
 var invalidNameRE = /[\\?*|"<>:]/;[m
[31m-function validName(name) {[m
[31m-    return !invalidNameRE.test(name.replace(driveRE,''));[m
[32m+[m[32mfunction validName (name) {[m
[32m+[m[32m    return !invalidNameRE.test(name.replace(driveRE, ''));[m
 }[m
 [m
[31m-function sanitize(path) {[m
[31m-    var slashesRE = new RegExp('/{2,}','g');[m
[32m+[m[32mfunction sanitize (path) {[m
[32m+[m[32m    var slashesRE = new RegExp('/{2,}', 'g');[m
     var components = path.replace(slashesRE, '/').split(/\/+/);[m
     // Remove double dots, use old school array iteration instead of RegExp[m
     // since it is impossible to debug them[m
     for (var index = 0; index < components.length; ++index) {[m
[31m-        if (components[index] === "..") {[m
[32m+[m[32m        if (components[index] === '..') {[m
             components.splice(index, 1);[m
             if (index > 0) {[m
                 // if we're not in the start of array then remove preceeding path component,[m
                 // In case if relative path points above the root directory, just ignore double dots[m
                 // See file.spec.111 should not traverse above above the root directory for test case[m
[31m-                components.splice(index-1, 1);[m
[32m+[m[32m                components.splice(index - 1, 1);[m
                 --index;[m
             }[m
         }[m
[36m@@ -149,67 +148,66 @@[m [mfunction sanitize(path) {[m
     return components.join('/');[m
 }[m
 [m
[31m-var WinFS = function(name, root) {[m
[32m+[m[32mvar WinFS = function (name, root) {[m
     this.winpath = root.winpath;[m
     if (this.winpath && !/\/$/.test(this.winpath)) {[m
[31m-        this.winpath += "/";[m
[32m+[m[32m        this.winpath += '/';[m
     }[m
[31m-    this.makeNativeURL = function (path) {        [m
[31m-        //CB-11848: This RE supposed to match all leading slashes in sanitized path. [m
[31m-        //Removing leading slash to avoid duplicating because this.root.nativeURL already has trailing slash[m
[32m+[m[32m    this.makeNativeURL = function (path) {[m
[32m+[m[32m        // CB-11848: This RE supposed to match all leading slashes in sanitized path.[m
[32m+[m[32m        // Removing leading slash to avoid duplicating because this.root.nativeURL already has trailing slash[m
         var regLeadingSlashes = /^\/*/;[m
         var sanitizedPath = sanitize(path.replace(':', '%3A')).replace(regLeadingSlashes, '');[m
         return FileSystem.encodeURIPath(this.root.nativeURL + sanitizedPath);[m
     };[m
     root.fullPath = '/';[m
[31m-    if (!root.nativeURL)[m
[31m-            root.nativeURL = 'file://'+sanitize(this.winpath + root.fullPath).replace(':','%3A');[m
[32m+[m[32m    if (!root.nativeURL) { root.nativeURL = 'file://' + sanitize(this.winpath + root.fullPath).replace(':', '%3A'); }[m
     WinFS.__super__.constructor.call(this, name, root);[m
 };[m
 [m
 utils.extend(WinFS, FileSystem);[m
 [m
[31m-WinFS.prototype.__format__ = function(fullPath) {[m
[31m-    var path = sanitize('/'+this.name+(fullPath[0]==='/'?'':'/')+FileSystem.encodeURIPath(fullPath));[m
[32m+[m[32mWinFS.prototype.__format__ = function (fullPath) {[m
[32m+[m[32m    var path = sanitize('/' + this.name + (fullPath[0] === '/' ? '' : '/') + FileSystem.encodeURIPath(fullPath));[m
     return 'cdvfile://localhost' + path;[m
 };[m
 [m
 var windowsPaths = {[m
[31m-    dataDirectory: "ms-appdata:///local/",[m
[31m-    cacheDirectory: "ms-appdata:///temp/",[m
[31m-    tempDirectory: "ms-appdata:///temp/",[m
[31m-    syncedDataDirectory: "ms-appdata:///roaming/",[m
[31m-    applicationDirectory: "ms-appx:///",[m
[31m-    applicationStorageDirectory: "ms-appx:///"[m
[32m+[m[32m    dataDirectory: 'ms-appdata:///local/',[m
[32m+[m[32m    cacheDirectory: 'ms-appdata:///temp/',[m
[32m+[m[32m    tempDirectory: 'ms-appdata:///temp/',[m
[32m+[m[32m    syncedDataDirectory: 'ms-appdata:///roaming/',[m
[32m+[m[32m    applicationDirectory: 'ms-appx:///',[m
[32m+[m[32m    applicationStorageDirectory: 'ms-appx:///'[m
 };[m
 [m
[31m-var AllFileSystems; [m
[32m+[m[32mvar AllFileSystems;[m
 [m
[31m-function getAllFS() {[m
[32m+[m[32mfunction getAllFS () {[m
     if (!AllFileSystems) {[m
         AllFileSystems = {[m
             'persistent':[m
[31m-            Object.freeze(new WinFS('persistent', { [m
[31m-                name: 'persistent', [m
[32m+[m[32m            Object.freeze(new WinFS('persistent', {[m
[32m+[m[32m                name: 'persistent',[m
                 nativeURL: 'ms-appdata:///local',[m
[31m-                winpath: nativePathToCordova(Windows.Storage.ApplicationData.current.localFolder.path)  [m
[32m+[m[32m                winpath: nativePathToCordova(Windows.Storage.ApplicationData.current.localFolder.path)[m
             })),[m
             'temporary':[m
[31m-            Object.freeze(new WinFS('temporary', { [m
[31m-                name: 'temporary', [m
[32m+[m[32m            Object.freeze(new WinFS('temporary', {[m
[32m+[m[32m                name: 'temporary',[m
                 nativeURL: 'ms-appdata:///temp',[m
                 winpath: nativePathToCordova(Windows.Storage.ApplicationData.current.temporaryFolder.path)[m
             })),[m
             'application':[m
[31m-            Object.freeze(new WinFS('application', { [m
[31m-                name: 'application', [m
[32m+[m[32m            Object.freeze(new WinFS('application', {[m
[32m+[m[32m                name: 'application',[m
                 nativeURL: 'ms-appx:///',[m
                 winpath: nativePathToCordova(Windows.ApplicationModel.Package.current.installedLocation.path)[m
             })),[m
             'root':[m
[31m-            Object.freeze(new WinFS('root', { [m
[31m-                name: 'root', [m
[31m-                //nativeURL: 'file:///'[m
[32m+[m[32m            Object.freeze(new WinFS('root', {[m
[32m+[m[32m                name: 'root',[m
[32m+[m[32m                // nativeURL: 'file:///'[m
                 winpath: ''[m
             }))[m
         };[m
[36m@@ -217,70 +215,65 @@[m [mfunction getAllFS() {[m
     return AllFileSystems;[m
 }[m
 [m
[31m-function getFS(name) {[m
[32m+[m[32mfunction getFS (name) {[m
     return getAllFS()[name];[m
 }[m
 [m
[31m-FileSystem.prototype.__format__ = function(fullPath) {[m
[32m+[m[32mFileSystem.prototype.__format__ = function (fullPath) {[m
     return getFS(this.name).__format__(fullPath);[m
 };[m
 [m
[31m-require('./fileSystems').getFs = function(name, callback) {[m
[31m-    setTimeout(function(){callback(getFS(name));});[m
[32m+[m[32mrequire('./fileSystems').getFs = function (name, callback) {[m
[32m+[m[32m    setTimeout(function () { callback(getFS(name)); });[m
 };[m
 [m
[31m-function getFilesystemFromPath(path) {[m
[32m+[m[32mfunction getFilesystemFromPath (path) {[m
     var res;[m
     var allfs = getAllFS();[m
[31m-    Object.keys(allfs).some(function(fsn) {[m
[32m+[m[32m    Object.keys(allfs).some(function (fsn) {[m
         var fs = allfs[fsn];[m
[31m-        if (path.indexOf(fs.winpath) === 0)[m
[31m-            res = fs;[m
[32m+[m[32m        if (path.indexOf(fs.winpath) === 0) { res = fs; }[m
         return res;[m
     });[m
     return res;[m
 }[m
 [m
 var msapplhRE = new RegExp('^ms-appdata://localhost/');[m
[31m-function pathFromURL(url) {[m
[31m-    url=url.replace(msapplhRE,'ms-appdata:///');[m
[32m+[m[32mfunction pathFromURL (url) {[m
[32m+[m[32m    url = url.replace(msapplhRE, 'ms-appdata:///');[m
     var path = decodeURIComponent(url);[m
     // support for file name with parameters[m
     if (/\?/g.test(path)) {[m
[31m-        path = String(path).split("?")[0];[m
[32m+[m[32m        path = String(path).split('?')[0];[m
     }[m
[31m-    if (path.indexOf("file:/")===0) {[m
[31m-        if (path.indexOf("file://") !== 0) {[m
[31m-            url = "file:///" + url.substr(6);[m
[32m+[m[32m    if (path.indexOf('file:/') === 0) {[m
[32m+[m[32m        if (path.indexOf('file://') !== 0) {[m
[32m+[m[32m            url = 'file:///' + url.substr(6);[m
         }[m
     }[m
[31m-    [m
[31m-    ['file://','ms-appdata:///','ms-appx://','cdvfile://localhost/'].every(function(p) {[m
[31m-        if (path.indexOf(p)!==0)[m
[31m-            return true;[m
[31m-        var thirdSlash = path.indexOf("/", p.length);[m
[32m+[m
[32m+[m[32m    ['file://', 'ms-appdata:///', 'ms-appx://', 'cdvfile://localhost/'].every(function (p) {[m
[32m+[m[32m        if (path.indexOf(p) !== 0) { return true; }[m
[32m+[m[32m        var thirdSlash = path.indexOf('/', p.length);[m
         if (thirdSlash < 0) {[m
[31m-            path = "";[m
[32m+[m[32m            path = '';[m
         } else {[m
             path = sanitize(path.substr(thirdSlash));[m
         }[m
     });[m
[31m-    [m
[31m-    return path.replace(driveRE,'$1');[m
[32m+[m
[32m+[m[32m    return path.replace(driveRE, '$1');[m
 }[m
 [m
[31m-function getFilesystemFromURL(url) {[m
[31m-    url=url.replace(msapplhRE,'ms-appdata:///');[m
[32m+[m[32mfunction getFilesystemFromURL (url) {[m
[32m+[m[32m    url = url.replace(msapplhRE, 'ms-appdata:///');[m
     var res;[m
[31m-    if (url.indexOf("file:/")===0)[m
[31m-        res = getFilesystemFromPath(pathFromURL(url));[m
[31m-    else {[m
[32m+[m[32m    if (url.indexOf('file:/') === 0) { res = getFilesystemFromPath(pathFromURL(url)); } else {[m
         var allfs = getAllFS();[m
[31m-        Object.keys(allfs).every(function(fsn) {[m
[32m+[m[32m        Object.keys(allfs).every(function (fsn) {[m
             var fs = allfs[fsn];[m
[31m-            if (url.indexOf(fs.root.nativeURL) === 0 || [m
[31m-                url.indexOf('cdvfile://localhost/'+fs.name+'/') === 0) [m
[31m-            {[m
[32m+[m[32m            if (url.indexOf(fs.root.nativeURL) === 0 ||[m
[32m+[m[32m                url.indexOf('cdvfile://localhost/' + fs.name + '/') === 0) {[m
                 res = fs;[m
                 return false;[m
             }[m
[36m@@ -290,11 +283,10 @@[m [mfunction getFilesystemFromURL(url) {[m
     return res;[m
 }[m
 [m
[31m-function getFsPathForWinPath(fs, wpath) {[m
[32m+[m[32mfunction getFsPathForWinPath (fs, wpath) {[m
     var path = nativePathToCordova(wpath);[m
[31m-    if (path.indexOf(fs.winpath) !== 0)[m
[31m-        return null;[m
[31m-    return path.replace(fs.winpath,'/');[m
[32m+[m[32m    if (path.indexOf(fs.winpath) !== 0) { return null; }[m
[32m+[m[32m    return path.replace(fs.winpath, '/');[m
 }[m
 [m
 var WinError = {[m
[36m@@ -303,43 +295,38 @@[m [mvar WinError = {[m
     accessDenied: -2147024891[m
 };[m
 [m
[31m-function openPath(path, ops) {[m
[31m-    ops=ops?ops:{};[m
[31m-    return new WinJS.Promise(function (complete,failed) {[m
[32m+[m[32mfunction openPath (path, ops) {[m
[32m+[m[32m    ops = ops || {};[m
[32m+[m[32m    return new WinJS.Promise(function (complete, failed) {[m
         getFileFromPathAsync(path).done([m
[31m-            function(file) {[m
[31m-                complete({file:file});[m
[32m+[m[32m            function (file) {[m
[32m+[m[32m                complete({file: file});[m
             },[m
[31m-            function(err) {[m
[31m-                if (err.number != WinError.fileNotFound && err.number != WinError.invalidArgument)[m
[31m-                    failed(FileError.NOT_READABLE_ERR);[m
[32m+[m[32m            function (err) {[m
[32m+[m[32m                if (err.number !== WinError.fileNotFound && err.number !== WinError.invalidArgument) { failed(FileError.NOT_READABLE_ERR); }[m
                 getFolderFromPathAsync(path)[m
                 .done([m
[31m-                    function(dir) {[m
[31m-                        if (!ops.getContent)[m
[31m-                            complete({folder:dir});[m
[31m-                        else[m
[32m+[m[32m                    function (dir) {[m
[32m+[m[32m                        if (!ops.getContent) { complete({folder: dir}); } else {[m
                             WinJS.Promise.join({[m
[31m-                                files:dir.getFilesAsync(),[m
[31m-                                folders:dir.getFoldersAsync()[m
[32m+[m[32m                                files: dir.getFilesAsync(),[m
[32m+[m[32m                                folders: dir.getFoldersAsync()[m
                             }).done([m
[31m-                                function(a) {[m
[32m+[m[32m                                function (a) {[m
                                     complete({[m
[31m-                                        folder:dir,[m
[31m-                                        files:a.files,[m
[31m-                                        folders:a.folders[m
[32m+[m[32m                                        folder: dir,[m
[32m+[m[32m                                        files: a.files,[m
[32m+[m[32m                                        folders: a.folders[m
                                     });[m
                                 },[m
[31m-                                function(err) {[m
[32m+[m[32m                                function (err) {  // eslint-disable-line handle-callback-err[m
                                     failed(FileError.NOT_READABLE_ERR);[m
                                 }[m
                             );[m
[32m+[m[32m                        }[m
                     },[m
[31m-                    function(err) {[m
[31m-                        if (err.number == WinError.fileNotFound || err.number == WinError.invalidArgument)[m
[31m-                            complete({});[m
[31m-                        else[m
[31m-                            failed(FileError.NOT_READABLE_ERR);[m
[32m+[m[32m                    function (err) {[m
[32m+[m[32m                        if (err.number === WinError.fileNotFound || err.number === WinError.invalidArgument) { complete({}); } else { failed(FileError.NOT_READABLE_ERR); }[m
                     }[m
                 );[m
             }[m
[36m@@ -347,36 +334,36 @@[m [mfunction openPath(path, ops) {[m
     });[m
 }[m
 [m
[31m-function copyFolder(src,dst,name) {[m
[31m-    name = name?name:src.name;[m
[31m-    return new WinJS.Promise(function (complete,failed) {[m
[32m+[m[32mfunction copyFolder (src, dst, name) {[m
[32m+[m[32m    name = name || src.name;[m
[32m+[m[32m    return new WinJS.Promise(function (complete, failed) {[m
         WinJS.Promise.join({[m
[31m-            fld:dst.createFolderAsync(name, Windows.Storage.CreationCollisionOption.openIfExists),[m
[31m-            files:src.getFilesAsync(),[m
[31m-            folders:src.getFoldersAsync()[m
[32m+[m[32m            fld: dst.createFolderAsync(name, Windows.Storage.CreationCollisionOption.openIfExists),[m
[32m+[m[32m            files: src.getFilesAsync(),[m
[32m+[m[32m            folders: src.getFoldersAsync()[m
         }).done([m
[31m-            function(the) {[m
[32m+[m[32m            function (the) {[m
                 if (!(the.files.length || the.folders.length)) {[m
                     complete();[m
                     return;[m
                 }[m
                 var todo = the.files.length;[m
[31m-                var copyfolders = function() {[m
[32m+[m[32m                var copyfolders = function () {[m
                     if (!(todo--)) {[m
                         complete();[m
                         return;[m
                     }[m
[31m-                    copyFolder(the.folders[todo],dst)[m
[31m-                    .done(function() { copyfolders(); }, failed);[m
[32m+[m[32m                    copyFolder(the.folders[todo], dst)[m
[32m+[m[32m                    .done(function () { copyfolders(); }, failed);[m
                 };[m
[31m-                var copyfiles = function() {[m
[32m+[m[32m                var copyfiles = function () {[m
                     if (!(todo--)) {[m
                         todo = the.folders.length;[m
                         copyfolders();[m
                         return;[m
                     }[m
                     the.files[todo].copyAsync(the.fld)[m
[31m-                    .done(function() { copyfiles(); }, failed);[m
[32m+[m[32m                    .done(function () { copyfiles(); }, failed);[m
                 };[m
                 copyfiles();[m
             },[m
[36m@@ -385,36 +372,36 @@[m [mfunction copyFolder(src,dst,name) {[m
     });[m
 }[m
 [m
[31m-function moveFolder(src,dst,name) {[m
[31m-    name = name?name:src.name;[m
[31m-    return new WinJS.Promise(function (complete,failed) {[m
[32m+[m[32mfunction moveFolder (src, dst, name) {[m
[32m+[m[32m    name = name || src.name;[m
[32m+[m[32m    return new WinJS.Promise(function (complete, failed) {[m
         WinJS.Promise.join({[m
             fld: dst.createFolderAsync(name, Windows.Storage.CreationCollisionOption.openIfExists),[m
             files: src.getFilesAsync(),[m
             folders: src.getFoldersAsync()[m
         }).done([m
[31m-            function(the) {[m
[32m+[m[32m            function (the) {[m
                 if (!(the.files.length || the.folders.length)) {[m
                     complete();[m
                     return;[m
                 }[m
                 var todo = the.files.length;[m
[31m-                var movefolders = function() {[m
[32m+[m[32m                var movefolders = function () {[m
                     if (!(todo--)) {[m
[31m-                        src.deleteAsync().done(complete,failed);[m
[32m+[m[32m                        src.deleteAsync().done(complete, failed);[m
                         return;[m
                     }[m
                     moveFolder(the.folders[todo], the.fld)[m
[31m-                    .done(movefolders,failed);[m
[32m+[m[32m                    .done(movefolders, failed);[m
                 };[m
[31m-                var movefiles = function() {[m
[32m+[m[32m                var movefiles = function () {[m
                     if (!(todo--)) {[m
                         todo = the.folders.length;[m
                         movefolders();[m
                         return;[m
                     }[m
                     the.files[todo].moveAsync(the.fld)[m
[31m-                    .done(function() { movefiles(); }, failed);[m
[32m+[m[32m                    .done(function () { movefiles(); }, failed);[m
                 };[m
                 movefiles();[m
             },[m
[36m@@ -423,7 +410,7 @@[m [mfunction moveFolder(src,dst,name) {[m
     });[m
 }[m
 [m
[31m-function transport(success, fail, args, ops) { // ["fullPath","parent", "newName"][m
[32m+[m[32mfunction transport (success, fail, args, ops) { // ["fullPath","parent", "newName"][m
     var src = args[0];[m
     var parent = args[1];[m
     var name = args[2];[m
[36m@@ -432,25 +419,24 @@[m [mfunction transport(success, fail, args, ops) { // ["fullPath","parent", "newName[m
     var dstFS = getFilesystemFromURL(parent);[m
     var srcPath = pathFromURL(src);[m
     var dstPath = pathFromURL(parent);[m
[31m-    if (!(srcFS && dstFS && validName(name))){[m
[32m+[m[32m    if (!(srcFS && dstFS && validName(name))) {[m
         fail(FileError.ENCODING_ERR);[m
         return;[m
     }[m
[31m-    [m
[32m+[m
     var srcWinPath = cordovaPathToNative(sanitize(srcFS.winpath + srcPath));[m
     var dstWinPath = cordovaPathToNative(sanitize(dstFS.winpath + dstPath));[m
[31m-    var tgtFsPath = sanitize(dstPath+'/'+name);[m
[31m-    var tgtWinPath = cordovaPathToNative(sanitize(dstFS.winpath + dstPath+'/'+name));[m
[31m-    if (srcWinPath == dstWinPath || srcWinPath == tgtWinPath) {[m
[32m+[m[32m    var tgtFsPath = sanitize(dstPath + '/' + name);[m
[32m+[m[32m    var tgtWinPath = cordovaPathToNative(sanitize(dstFS.winpath + dstPath + '/' + name));[m
[32m+[m[32m    if (srcWinPath === dstWinPath || srcWinPath === tgtWinPath) {[m
         fail(FileError.INVALID_MODIFICATION_ERR);[m
         return;[m
     }[m
[31m-    [m
[31m-    [m
[32m+[m
     WinJS.Promise.join({[m
[31m-        src:openPath(srcWinPath),[m
[31m-        dst:openPath(dstWinPath),[m
[31m-        tgt:openPath(tgtWinPath,{getContent:true})[m
[32m+[m[32m        src: openPath(srcWinPath),[m
[32m+[m[32m        dst: openPath(dstWinPath),[m
[32m+[m[32m        tgt: openPath(tgtWinPath, {getContent: true})[m
     })[m
     .done([m
         function (the) {[m
[36m@@ -464,8 +450,8 @@[m [mfunction transport(success, fail, args, ops) { // ["fullPath","parent", "newName[m
                 fail(FileError.INVALID_MODIFICATION_ERR);[m
                 return;[m
             }[m
[31m-            if (the.src.file)[m
[31m-                ops.fileOp(the.src.file,the.dst.folder, name, Windows.Storage.NameCollisionOption.replaceExisting)[m
[32m+[m[32m            if (the.src.file) {[m
[32m+[m[32m                ops.fileOp(the.src.file, the.dst.folder, name, Windows.Storage.NameCollisionOption.replaceExisting)[m
                 .done([m
                     function (storageFile) {[m
                         success(new FileEntry([m
[36m@@ -475,36 +461,37 @@[m [mfunction transport(success, fail, args, ops) { // ["fullPath","parent", "newName[m
                             dstFS.makeNativeURL(tgtFsPath)[m
                         ));[m
                     },[m
[31m-                    function (err) {[m
[32m+[m[32m                    function (err) {  // eslint-disable-line handle-callback-err[m
                         fail(FileError.INVALID_MODIFICATION_ERR);[m
                     }[m
                 );[m
[31m-            else[m
[32m+[m[32m            } else {[m
                 ops.folderOp(the.src.folder, the.dst.folder, name).done([m
                     function () {[m
                         success(new DirectoryEntry([m
[31m-                            name, [m
[31m-                            tgtFsPath, [m
[31m-                            dstFS.name, [m
[32m+[m[32m                            name,[m
[32m+[m[32m                            tgtFsPath,[m
[32m+[m[32m                            dstFS.name,[m
                             dstFS.makeNativeURL(tgtFsPath)[m
                         ));[m
                     },[m
[31m-                    function() {[m
[32m+[m[32m                    function () {[m
                         fail(FileError.INVALID_MODIFICATION_ERR);[m
                     }[m
                 );[m
[32m+[m[32m            }[m
         },[m
[31m-        function(err) {[m
[32m+[m[32m        function (err) {  // eslint-disable-line handle-callback-err[m
             fail(FileError.INVALID_MODIFICATION_ERR);[m
         }[m
     );[m
 }[m
 [m
 module.exports = {[m
[31m-    requestAllFileSystems: function() {[m
[32m+[m[32m    requestAllFileSystems: function () {[m
         return getAllFS();[m
     },[m
[31m-    requestAllPaths: function(success){[m
[32m+[m[32m    requestAllPaths: function (success) {[m
         success(windowsPaths);[m
     },[m
     getFileMetadata: function (success, fail, args) {[m
[36m@@ -514,7 +501,7 @@[m [mmodule.exports = {[m
     getMetadata: function (success, fail, args) {[m
         var fs = getFilesystemFromURL(args[0]);[m
         var path = pathFromURL(args[0]);[m
[31m-        if (!fs || !validName(path)){[m
[32m+[m[32m        if (!fs || !validName(path)) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
[36m@@ -525,8 +512,8 @@[m [mmodule.exports = {[m
                 function (basicProperties) {[m
                     success(new File(storageFile.name, storageFile.path, storageFile.fileType, basicProperties.dateModified, basicProperties.size));[m
                 }, function () {[m
[31m-                    fail(FileError.NOT_READABLE_ERR);[m
[31m-                }[m
[32m+[m[32m                fail(FileError.NOT_READABLE_ERR);[m
[32m+[m[32m            }[m
             );[m
         };[m
 [m
[36m@@ -559,7 +546,7 @@[m [mmodule.exports = {[m
     getParent: function (win, fail, args) { // ["fullPath"][m
         var fs = getFilesystemFromURL(args[0]);[m
         var path = pathFromURL(args[0]);[m
[31m-        if (!fs || !validName(path)){[m
[32m+[m[32m        if (!fs || !validName(path)) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
[36m@@ -567,11 +554,11 @@[m [mmodule.exports = {[m
             win(new DirectoryEntry(fs.root.name, fs.root.fullPath, fs.name, fs.makeNativeURL(fs.root.fullPath)));[m
             return;[m
         }[m
[31m-        [m
[31m-        var parpath = path.replace(new RegExp('/[^/]+/?$','g'),'');[m
[32m+[m
[32m+[m[32m        var parpath = path.replace(new RegExp('/[^/]+/?$', 'g'), '');[m
         var parname = path.substr(parpath.length);[m
         var fullPath = cordovaPathToNative(fs.winpath + parpath);[m
[31m-        [m
[32m+[m
         var result = new DirectoryEntry(parname, parpath, fs.name, fs.makeNativeURL(parpath));[m
         getFolderFromPathAsync(fullPath).done([m
             function () { win(result); },[m
[36m@@ -581,57 +568,56 @@[m [mmodule.exports = {[m
 [m
     readAsText: function (win, fail, args) {[m
 [m
[31m-        var url = args[0],[m
[31m-            enc = args[1],[m
[31m-            startPos = args[2],[m
[31m-            endPos = args[3];[m
[31m-        [m
[32m+[m[32m        var url = args[0];[m
[32m+[m[32m        var enc = args[1];[m
[32m+[m[32m        var startPos = args[2];[m
[32m+[m[32m        var endPos = args[3];[m
[32m+[m
         var fs = getFilesystemFromURL(url);[m
         var path = pathFromURL(url);[m
[31m-        if (!fs){[m
[32m+[m[32m        if (!fs) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
         var wpath = cordovaPathToNative(sanitize(fs.winpath + path));[m
[31m-        [m
[32m+[m
         var encoding = Windows.Storage.Streams.UnicodeEncoding.utf8;[m
[31m-        if (enc == 'Utf16LE' || enc == 'utf16LE') {[m
[32m+[m[32m        if (enc === 'Utf16LE' || enc === 'utf16LE') {[m
             encoding = Windows.Storage.Streams.UnicodeEncoding.utf16LE;[m
[31m-        } else if (enc == 'Utf16BE' || enc == 'utf16BE') {[m
[32m+[m[32m        } else if (enc === 'Utf16BE' || enc === 'utf16BE') {[m
             encoding = Windows.Storage.Streams.UnicodeEncoding.utf16BE;[m
         }[m
 [m
[31m-        getFileFromPathAsync(wpath).then(function(file) {[m
[31m-                return file.openReadAsync();[m
[31m-            }).then(function (stream) {[m
[31m-                startPos = (startPos < 0) ? Math.max(stream.size + startPos, 0) : Math.min(stream.size, startPos);[m
[31m-                endPos = (endPos < 0) ? Math.max(endPos + stream.size, 0) : Math.min(stream.size, endPos);[m
[31m-                stream.seek(startPos);[m
[31m-                [m
[31m-                var readSize = endPos - startPos,[m
[31m-                    buffer = new Windows.Storage.Streams.Buffer(readSize);[m
[31m-[m
[31m-                return stream.readAsync(buffer, readSize, Windows.Storage.Streams.InputStreamOptions.none);[m
[31m-            }).done(function(buffer) {[m
[31m-            	try {[m
[31m-            		win(Windows.Security.Cryptography.CryptographicBuffer.convertBinaryToString(encoding, buffer));[m
[31m-                }[m
[31m-                catch (e) {[m
[31m-                	fail(FileError.ENCODING_ERR);[m
[31m-                }[m
[31m-            },function() {[m
[31m-                fail(FileError.NOT_FOUND_ERR);[m
[31m-            });[m
[32m+[m[32m        getFileFromPathAsync(wpath).then(function (file) {[m
[32m+[m[32m            return file.openReadAsync();[m
[32m+[m[32m        }).then(function (stream) {[m
[32m+[m[32m            startPos = (startPos < 0) ? Math.max(stream.size + startPos, 0) : Math.min(stream.size, startPos);[m
[32m+[m[32m            endPos = (endPos < 0) ? Math.max(endPos + stream.size, 0) : Math.min(stream.size, endPos);[m
[32m+[m[32m            stream.seek(startPos);[m
[32m+[m
[32m+[m[32m            var readSize = endPos - startPos;[m
[32m+[m[32m            var buffer = new Windows.Storage.Streams.Buffer(readSize);[m
[32m+[m
[32m+[m[32m            return stream.readAsync(buffer, readSize, Windows.Storage.Streams.InputStreamOptions.none);[m
[32m+[m[32m        }).done(function (buffer) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                win(Windows.Security.Cryptography.CryptographicBuffer.convertBinaryToString(encoding, buffer));[m
[32m+[m[32m            } catch (e) {[m
[32m+[m[32m                fail(FileError.ENCODING_ERR);[m
[32m+[m[32m            }[m
[32m+[m[32m        }, function () {[m
[32m+[m[32m            fail(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m        });[m
     },[m
 [m
[31m-    readAsBinaryString:function(win,fail,args) {[m
[31m-        var url = args[0],[m
[31m-            startPos = args[1],[m
[31m-            endPos = args[2];[m
[32m+[m[32m    readAsBinaryString: function (win, fail, args) {[m
[32m+[m[32m        var url = args[0];[m
[32m+[m[32m        var startPos = args[1];[m
[32m+[m[32m        var endPos = args[2];[m
 [m
         var fs = getFilesystemFromURL(url);[m
         var path = pathFromURL(url);[m
[31m-        if (!fs){[m
[32m+[m[32m        if (!fs) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
[36m@@ -643,8 +629,8 @@[m [mmodule.exports = {[m
                     function (buffer) {[m
                         var dataReader = Windows.Storage.Streams.DataReader.fromBuffer(buffer);[m
                         // var fileContent = dataReader.readString(buffer.length);[m
[31m-                        var byteArray = new Uint8Array(buffer.length),[m
[31m-                            byteString = "";[m
[32m+[m[32m                        var byteArray = new Uint8Array(buffer.length);[m
[32m+[m[32m                        var byteString = '';[m
                         dataReader.readBytes(byteArray);[m
                         dataReader.close();[m
                         for (var i = 0; i < byteArray.length; i++) {[m
[36m@@ -657,16 +643,16 @@[m [mmodule.exports = {[m
                     }[m
                 );[m
             }, function () {[m
[31m-                fail(FileError.NOT_FOUND_ERR);[m
[31m-            }[m
[32m+[m[32m            fail(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m        }[m
         );[m
     },[m
 [m
[31m-    readAsArrayBuffer:function(win,fail,args) {[m
[32m+[m[32m    readAsArrayBuffer: function (win, fail, args) {[m
         var url = args[0];[m
         var fs = getFilesystemFromURL(url);[m
         var path = pathFromURL(url);[m
[31m-        if (!fs){[m
[32m+[m[32m        if (!fs) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
[36m@@ -675,26 +661,26 @@[m [mmodule.exports = {[m
         getFileFromPathAsync(wpath).then([m
             function (storageFile) {[m
                 var blob = MSApp.createFileFromStorageFile(storageFile);[m
[31m-                var url = URL.createObjectURL(blob, { oneTimeOnly: true });[m
[31m-                var xhr = new XMLHttpRequest();[m
[31m-                xhr.open("GET", url, true);[m
[32m+[m[32m                var url = URL.createObjectURL(blob, { oneTimeOnly: true }); // eslint-disable-line no-undef[m
[32m+[m[32m                var xhr = new XMLHttpRequest(); // eslint-disable-line no-undef[m
[32m+[m[32m                xhr.open('GET', url, true);[m
                 xhr.responseType = 'arraybuffer';[m
                 xhr.onload = function () {[m
                     var resultArrayBuffer = xhr.response;[m
                     // get start and end position of bytes in buffer to be returned[m
[31m-                    var startPos = args[1] || 0,[m
[31m-                        endPos = args[2] || resultArrayBuffer.length;[m
[32m+[m[32m                    var startPos = args[1] || 0;[m
[32m+[m[32m                    var endPos = args[2] || resultArrayBuffer.length;[m
                     // if any of them is specified, we'll slice output array[m
                     if (startPos !== 0 || endPos !== resultArrayBuffer.length) {[m
[31m-                        // slice method supported only on Windows 8.1, so we need to check if it's available [m
[32m+[m[32m                        // slice method supported only on Windows 8.1, so we need to check if it's available[m
                         // see http://msdn.microsoft.com/en-us/library/ie/dn641192(v=vs.94).aspx[m
                         if (resultArrayBuffer.slice) {[m
                             resultArrayBuffer = resultArrayBuffer.slice(startPos, endPos);[m
                         } else {[m
                             // if slice isn't available, we'll use workaround method[m
[31m-                            var tempArray = new Uint8Array(resultArrayBuffer),[m
[31m-                                resBuffer = new ArrayBuffer(endPos - startPos),[m
[31m-                                resArray = new Uint8Array(resBuffer);[m
[32m+[m[32m                            var tempArray = new Uint8Array(resultArrayBuffer);[m
[32m+[m[32m                            var resBuffer = new ArrayBuffer(endPos - startPos);[m
[32m+[m[32m                            var resArray = new Uint8Array(resBuffer);[m
 [m
                             for (var i = 0; i < resArray.length; i++) {[m
                                 resArray[i] = tempArray[i + startPos];[m
[36m@@ -706,8 +692,8 @@[m [mmodule.exports = {[m
                 };[m
                 xhr.send();[m
             }, function () {[m
[31m-                fail(FileError.NOT_FOUND_ERR);[m
[31m-            }[m
[32m+[m[32m            fail(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m        }[m
         );[m
     },[m
 [m
[36m@@ -715,7 +701,7 @@[m [mmodule.exports = {[m
         var url = args[0];[m
         var fs = getFilesystemFromURL(url);[m
         var path = pathFromURL(url);[m
[31m-        if (!fs){[m
[32m+[m[32m        if (!fs) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
[36m@@ -726,18 +712,18 @@[m [mmodule.exports = {[m
                 Windows.Storage.FileIO.readBufferAsync(storageFile).done([m
                     function (buffer) {[m
                         var strBase64 = Windows.Security.Cryptography.CryptographicBuffer.encodeToBase64String(buffer);[m
[31m-                        //the method encodeToBase64String will add "77u/" as a prefix, so we should remove it[m
[31m-                        if(String(strBase64).substr(0,4) == "77u/") {[m
[32m+[m[32m                        // the method encodeToBase64String will add "77u/" as a prefix, so we should remove it[m
[32m+[m[32m                        if (String(strBase64).substr(0, 4) === '77u/') {[m
                             strBase64 = strBase64.substr(4);[m
                         }[m
                         var mediaType = storageFile.contentType;[m
[31m-                        var result = "data:" + mediaType + ";base64," + strBase64;[m
[32m+[m[32m                        var result = 'data:' + mediaType + ';base64,' + strBase64;[m
                         win(result);[m
                     }[m
                 );[m
             }, function () {[m
[31m-                fail(FileError.NOT_FOUND_ERR);[m
[31m-            }[m
[32m+[m[32m            fail(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m        }[m
         );[m
     },[m
 [m
[36m@@ -748,18 +734,18 @@[m [mmodule.exports = {[m
 [m
         var fs = getFilesystemFromURL(dirurl);[m
         var dirpath = pathFromURL(dirurl);[m
[31m-        if (!fs || !validName(path)){[m
[32m+[m[32m        if (!fs || !validName(path)) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
[31m-        }           [m
[31m-        var fspath = sanitize(dirpath +'/'+ path);[m
[32m+[m[32m        }[m
[32m+[m[32m        var fspath = sanitize(dirpath + '/' + path);[m
         var completePath = sanitize(fs.winpath + fspath);[m
 [m
[31m-        var name = completePath.substring(completePath.lastIndexOf('/')+1);[m
[31m-        [m
[32m+[m[32m        var name = completePath.substring(completePath.lastIndexOf('/') + 1);[m
[32m+[m
         var wpath = cordovaPathToNative(completePath.substring(0, completePath.lastIndexOf('/')));[m
 [m
[31m-        var flag = "";[m
[32m+[m[32m        var flag = '';[m
         if (options) {[m
             flag = new Flags(options.create, options.exclusive);[m
         } else {[m
[36m@@ -772,51 +758,51 @@[m [mmodule.exports = {[m
                     storageFolder.createFolderAsync(name, Windows.Storage.CreationCollisionOption.failIfExists).done([m
                         function (storageFolder) {[m
                             win(new DirectoryEntry(storageFolder.name, fspath, fs.name, fs.makeNativeURL(fspath)));[m
[31m-                        }, function (err) {[m
[31m-                            fail(FileError.PATH_EXISTS_ERR);[m
[31m-                        }[m
[32m+[m[32m                        }, function (err) {  // eslint-disable-line handle-callback-err[m
[32m+[m[32m                        fail(FileError.PATH_EXISTS_ERR);[m
[32m+[m[32m                    }[m
                     );[m
                 } else if (flag.create === true && flag.exclusive === false) {[m
                     storageFolder.createFolderAsync(name, Windows.Storage.CreationCollisionOption.openIfExists).done([m
                         function (storageFolder) {[m
                             win(new DirectoryEntry(storageFolder.name, fspath, fs.name, fs.makeNativeURL(fspath)));[m
                         }, function () {[m
[31m-                            fail(FileError.INVALID_MODIFICATION_ERR);[m
[31m-                        }[m
[32m+[m[32m                        fail(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                    }[m
                     );[m
                 } else if (flag.create === false) {[m
                     storageFolder.getFolderAsync(name).done([m
                         function (storageFolder) {[m
                             win(new DirectoryEntry(storageFolder.name, fspath, fs.name, fs.makeNativeURL(fspath)));[m
[31m-                        }, [m
[32m+[m[32m                        },[m
                         function () {[m
                             // check if path actually points to a file[m
                             storageFolder.getFileAsync(name).done([m
                                 function () {[m
                                     fail(FileError.TYPE_MISMATCH_ERR);[m
[31m-                                }, function() {[m
[31m-                                    fail(FileError.NOT_FOUND_ERR);[m
[31m-                                }[m
[32m+[m[32m                                }, function () {[m
[32m+[m[32m                                fail(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                            }[m
                             );[m
                         }[m
                     );[m
                 }[m
             }, function () {[m
[31m-                fail(FileError.NOT_FOUND_ERR);[m
[31m-            }[m
[32m+[m[32m            fail(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m        }[m
         );[m
     },[m
 [m
     remove: function (win, fail, args) {[m
         var fs = getFilesystemFromURL(args[0]);[m
         var path = pathFromURL(args[0]);[m
[31m-        if (!fs || !validName(path)){[m
[32m+[m[32m        if (!fs || !validName(path)) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
 [m
         // FileSystem root can't be removed![m
[31m-        if (!path || path=='/'){[m
[32m+[m[32m        if (!path || path === '/') {[m
             fail(FileError.NO_MODIFICATION_ALLOWED_ERR);[m
             return;[m
         }[m
[36m@@ -824,8 +810,8 @@[m [mmodule.exports = {[m
 [m
         getFileFromPathAsync(fullPath).then([m
             function (storageFile) {[m
[31m-                    storageFile.deleteAsync().done(win, function () {[m
[31m-                        fail(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                storageFile.deleteAsync().done(win, function () {[m
[32m+[m[32m                    fail(FileError.INVALID_MODIFICATION_ERR);[m
                 });[m
             },[m
             function () {[m
[36m@@ -833,7 +819,7 @@[m [mmodule.exports = {[m
                     function (sFolder) {[m
                         sFolder.getFilesAsync()[m
                         // check for files[m
[31m-                        .then(function(fileList) {[m
[32m+[m[32m                        .then(function (fileList) {[m
                             if (fileList) {[m
                                 if (fileList.length === 0) {[m
                                     return sFolder.getFoldersAsync();[m
[36m@@ -847,7 +833,7 @@[m [mmodule.exports = {[m
                             if (folderList) {[m
                                 if (folderList.length === 0) {[m
                                     sFolder.deleteAsync().done([m
[31m-                                        win, [m
[32m+[m[32m                                        win,[m
                                         function () {[m
                                             fail(FileError.INVALID_MODIFICATION_ERR);[m
                                         }[m
[36m@@ -857,7 +843,7 @@[m [mmodule.exports = {[m
                                 }[m
                             }[m
                         });[m
[31m-                    }, [m
[32m+[m[32m                    },[m
                     function () {[m
                         fail(FileError.NOT_FOUND_ERR);[m
                     }[m
[36m@@ -870,13 +856,13 @@[m [mmodule.exports = {[m
 [m
         var fs = getFilesystemFromURL(args[0]);[m
         var path = pathFromURL(args[0]);[m
[31m-        if (!fs || !validName(path)){[m
[32m+[m[32m        if (!fs || !validName(path)) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
 [m
         // FileSystem root can't be removed![m
[31m-        if (!path || path=='/'){[m
[32m+[m[32m        if (!path || path === '/') {[m
             fail(FileError.NO_MODIFICATION_ALLOWED_ERR);[m
             return;[m
         }[m
[36m@@ -902,18 +888,18 @@[m [mmodule.exports = {[m
 [m
         var fs = getFilesystemFromURL(dirurl);[m
         var dirpath = pathFromURL(dirurl);[m
[31m-        if (!fs || !validName(path)){[m
[32m+[m[32m        if (!fs || !validName(path)) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
[31m-        var fspath = sanitize(dirpath +'/'+ path);[m
[32m+[m[32m        var fspath = sanitize(dirpath + '/' + path);[m
         var completePath = sanitize(fs.winpath + fspath);[m
 [m
[31m-        var fileName = completePath.substring(completePath.lastIndexOf('/')+1);[m
[31m-        [m
[32m+[m[32m        var fileName = completePath.substring(completePath.lastIndexOf('/') + 1);[m
[32m+[m
         var wpath = cordovaPathToNative(completePath.substring(0, completePath.lastIndexOf('/')));[m
 [m
[31m-        var flag = "";[m
[32m+[m[32m        var flag = '';[m
         if (options !== null) {[m
             flag = new Flags(options.create, options.exclusive);[m
         } else {[m
[36m@@ -927,16 +913,16 @@[m [mmodule.exports = {[m
                         function (storageFile) {[m
                             win(new FileEntry(storageFile.name, fspath, fs.name, fs.makeNativeURL(fspath)));[m
                         }, function () {[m
[31m-                            fail(FileError.PATH_EXISTS_ERR);[m
[31m-                        }[m
[32m+[m[32m                        fail(FileError.PATH_EXISTS_ERR);[m
[32m+[m[32m                    }[m
                     );[m
                 } else if (flag.create === true && flag.exclusive === false) {[m
                     storageFolder.createFileAsync(fileName, Windows.Storage.CreationCollisionOption.openIfExists).done([m
                         function (storageFile) {[m
                             win(new FileEntry(storageFile.name, fspath, fs.name, fs.makeNativeURL(fspath)));[m
                         }, function () {[m
[31m-                            fail(FileError.INVALID_MODIFICATION_ERR);[m
[31m-                        }[m
[32m+[m[32m                        fail(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                    }[m
                     );[m
                 } else if (flag.create === false) {[m
                     storageFolder.getFileAsync(fileName).done([m
[36m@@ -944,29 +930,29 @@[m [mmodule.exports = {[m
                             win(new FileEntry(storageFile.name, fspath, fs.name, fs.makeNativeURL(fspath)));[m
                         }, function () {[m
                             // check if path actually points to a folder[m
[31m-                            storageFolder.getFolderAsync(fileName).done([m
[32m+[m[32m                        storageFolder.getFolderAsync(fileName).done([m
                                 function () {[m
                                     fail(FileError.TYPE_MISMATCH_ERR);[m
                                 }, function () {[m
[31m-                                    fail(FileError.NOT_FOUND_ERR);[m
[31m-                                });[m
[31m-                        }[m
[32m+[m[32m                            fail(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                        });[m
[32m+[m[32m                    }[m
                     );[m
                 }[m
             }, function (err) {[m
[31m-                fail([m
[31m-                    err.number == WinError.accessDenied?[m
[31m-                    FileError.SECURITY_ERR:[m
[32m+[m[32m            fail([m
[32m+[m[32m                    err.number === WinError.accessDenied ?[m
[32m+[m[32m                    FileError.SECURITY_ERR :[m
                     FileError.NOT_FOUND_ERR[m
                 );[m
[31m-            }[m
[32m+[m[32m        }[m
         );[m
     },[m
 [m
     readEntries: function (win, fail, args) { // ["fullPath"][m
         var fs = getFilesystemFromURL(args[0]);[m
         var path = pathFromURL(args[0]);[m
[31m-        if (!fs || !validName(path)){[m
[32m+[m[32m        if (!fs || !validName(path)) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
[36m@@ -1010,25 +996,25 @@[m [mmodule.exports = {[m
 [m
     write: function (win, fail, args) {[m
 [m
[31m-        var url = args[0],[m
[31m-            data = args[1],[m
[31m-            position = args[2],[m
[31m-            isBinary = args[3];[m
[32m+[m[32m        var url = args[0];[m
[32m+[m[32m        var data = args[1];[m
[32m+[m[32m        var position = args[2];[m
[32m+[m[32m        var isBinary = args[3];[m
 [m
         var fs = getFilesystemFromURL(url);[m
         var path = pathFromURL(url);[m
[31m-        if (!fs){[m
[32m+[m[32m        if (!fs) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
         var completePath = sanitize(fs.winpath + path);[m
[31m-        var fileName = completePath.substring(completePath.lastIndexOf('/')+1);[m
[31m-        var dirpath = completePath.substring(0,completePath.lastIndexOf('/'));[m
[32m+[m[32m        var fileName = completePath.substring(completePath.lastIndexOf('/') + 1);[m
[32m+[m[32m        var dirpath = completePath.substring(0, completePath.lastIndexOf('/'));[m
         var wpath = cordovaPathToNative(dirpath);[m
[31m-        [m
[31m-        function getWriteMethodForData(data, isBinary) {[m
[31m-            [m
[31m-            if (data instanceof Blob) {[m
[32m+[m
[32m+[m[32m        function getWriteMethodForData (data, isBinary) {[m
[32m+[m
[32m+[m[32m            if (data instanceof Blob) {  // eslint-disable-line no-undef[m
                 return writeBlobAsync;[m
             }[m
 [m
[36m@@ -1044,7 +1030,7 @@[m [mmodule.exports = {[m
                 return writeTextAsync;[m
             }[m
 [m
[31m-            throw new Error('Unsupported data type for write method');          [m
[32m+[m[32m            throw new Error('Unsupported data type for write method');[m
         }[m
 [m
         var writePromise = getWriteMethodForData(data, isBinary);[m
[36m@@ -1078,19 +1064,19 @@[m [mmodule.exports = {[m
     truncate: function (win, fail, args) { // ["fileName","size"][m
         var url = args[0];[m
         var size = args[1];[m
[31m-        [m
[32m+[m
         var fs = getFilesystemFromURL(url);[m
         var path = pathFromURL(url);[m
[31m-        if (!fs){[m
[32m+[m[32m        if (!fs) {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
         var completePath = sanitize(fs.winpath + path);[m
         var wpath = cordovaPathToNative(completePath);[m
[31m-        var dirwpath = cordovaPathToNative(completePath.substring(0,completePath.lastIndexOf('/')));[m
[32m+[m[32m        var dirwpath = cordovaPathToNative(completePath.substring(0, completePath.lastIndexOf('/')));[m
 [m
[31m-        getFileFromPathAsync(wpath).done(function(storageFile){[m
[31m-            //the current length of the file.[m
[32m+[m[32m        getFileFromPathAsync(wpath).done(function (storageFile) {[m
[32m+[m[32m            // the current length of the file.[m
             var leng = 0;[m
 [m
             storageFile.getBasicPropertiesAsync().then(function (basicProperties) {[m
[36m@@ -1112,7 +1098,7 @@[m [mmodule.exports = {[m
                                 }, function () {[m
                                     fail(FileError.NO_MODIFICATION_ALLOWED_ERR);[m
                                 });[m
[31m-                            }, function() {[m
[32m+[m[32m                            }, function () {[m
                                 fail(FileError.NO_MODIFICATION_ALLOWED_ERR);[m
                             });[m
                         });[m
[36m@@ -1125,29 +1111,29 @@[m [mmodule.exports = {[m
     copyTo: function (success, fail, args) { // ["fullPath","parent", "newName"][m
         transport(success, fail, args,[m
             {[m
[31m-                fileOp:function(file,folder,name,coll) {[m
[31m-                    return file.copyAsync(folder,name,coll);[m
[32m+[m[32m                fileOp: function (file, folder, name, coll) {[m
[32m+[m[32m                    return file.copyAsync(folder, name, coll);[m
                 },[m
[31m-                folderOp:function(src,dst,name) {[m
[31m-                    return copyFolder(src,dst,name);[m
[31m-            }}[m
[32m+[m[32m                folderOp: function (src, dst, name) {[m
[32m+[m[32m                    return copyFolder(src, dst, name);[m
[32m+[m[32m                }}[m
         );[m
     },[m
 [m
     moveTo: function (success, fail, args) {[m
         transport(success, fail, args,[m
             {[m
[31m-                fileOp:function(file,folder,name,coll) {[m
[31m-                    return file.moveAsync(folder,name,coll);[m
[32m+[m[32m                fileOp: function (file, folder, name, coll) {[m
[32m+[m[32m                    return file.moveAsync(folder, name, coll);[m
                 },[m
[31m-                folderOp:function(src,dst,name) {[m
[31m-                    return moveFolder(src,dst,name);[m
[31m-            }}[m
[32m+[m[32m                folderOp: function (src, dst, name) {[m
[32m+[m[32m                    return moveFolder(src, dst, name);[m
[32m+[m[32m                }}[m
         );[m
     },[m
[31m-    tempFileSystem:null,[m
[32m+[m[32m    tempFileSystem: null,[m
 [m
[31m-    persistentFileSystem:null,[m
[32m+[m[32m    persistentFileSystem: null,[m
 [m
     requestFileSystem: function (win, fail, args) {[m
 [m
[36m@@ -1158,20 +1144,17 @@[m [mmodule.exports = {[m
             fail(FileError.QUOTA_EXCEEDED_ERR);[m
             return;[m
         }[m
[31m-        [m
[32m+[m
         var fs;[m
         switch (type) {[m
[31m-            case LocalFileSystem.TEMPORARY:[m
[31m-                fs = getFS('temporary');[m
[31m-                break;[m
[31m-            case LocalFileSystem.PERSISTENT:[m
[31m-                fs = getFS('persistent');[m
[31m-                break;[m
[32m+[m[32m        case LocalFileSystem.TEMPORARY:[m
[32m+[m[32m            fs = getFS('temporary');[m
[32m+[m[32m            break;[m
[32m+[m[32m        case LocalFileSystem.PERSISTENT:[m
[32m+[m[32m            fs = getFS('persistent');[m
[32m+[m[32m            break;[m
         }[m
[31m-        if (fs)[m
[31m-            win(fs);[m
[31m-        else[m
[31m-            fail(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m        if (fs) { win(fs); } else { fail(FileError.NOT_FOUND_ERR); }[m
     },[m
 [m
     resolveLocalFileSystemURI: function (success, fail, args) {[m
[36m@@ -1184,26 +1167,24 @@[m [mmodule.exports = {[m
             fail(FileError.ENCODING_ERR);[m
             return;[m
         }[m
[31m-        if (path.indexOf(fs.winpath) === 0)[m
[31m-            path=path.substr(fs.winpath.length);[m
[31m-        var abspath = cordovaPathToNative(fs.winpath+path);[m
[31m-        [m
[32m+[m[32m        if (path.indexOf(fs.winpath) === 0) { path = path.substr(fs.winpath.length); }[m
[32m+[m[32m        var abspath = cordovaPathToNative(fs.winpath + path);[m
[32m+[m
         getFileFromPathAsync(abspath).done([m
             function (storageFile) {[m
                 success(new FileEntry(storageFile.name, path, fs.name, fs.makeNativeURL(path)));[m
             }, function () {[m
[31m-                getFolderFromPathAsync(abspath).done([m
[32m+[m[32m            getFolderFromPathAsync(abspath).done([m
                     function (storageFolder) {[m
[31m-                        success(new DirectoryEntry(storageFolder.name, path, fs.name,fs.makeNativeURL(path)));[m
[32m+[m[32m                        success(new DirectoryEntry(storageFolder.name, path, fs.name, fs.makeNativeURL(path)));[m
                     }, function () {[m
[31m-                        fail(FileError.NOT_FOUND_ERR);[m
[31m-                    }[m
[31m-                );[m
[32m+[m[32m                fail(FileError.NOT_FOUND_ERR);[m
             }[m
[32m+[m[32m                );[m
[32m+[m[32m        }[m
         );[m
     }[m
[31m-    [m
 [m
 };[m
 [m
[31m-require("cordova/exec/proxy").add("File",module.exports);[m
[32m+[m[32mrequire('cordova/exec/proxy').add('File', module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/src/wp/File.cs b/cordova_exchange_dist/plugins/cordova-plugin-file/src/wp/File.cs[m
[1mdeleted file mode 100644[m
[1mindex 941c9c8..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/src/wp/File.cs[m
[1m+++ /dev/null[m
[36m@@ -1,1800 +0,0 @@[m
[31m-/*  [m
[31m-    Licensed under the Apache License, Version 2.0 (the "License");[m
[31m-    you may not use this file except in compliance with the License.[m
[31m-    You may obtain a copy of the License at[m
[31m-[m
[31m-    http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-    Unless required by applicable law or agreed to in writing, software[m
[31m-    distributed under the License is distributed on an "AS IS" BASIS,[m
[31m-    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m-    See the License for the specific language governing permissions and[m
[31m-    limitations under the License.[m
[31m-*/[m
[31m-[m
[31m-using System;[m
[31m-using System.Collections.Generic;[m
[31m-using System.Diagnostics;[m
[31m-using System.IO;[m
[31m-using System.IO.IsolatedStorage;[m
[31m-using System.Runtime.Serialization;[m
[31m-using System.Security;[m
[31m-using System.Text;[m
[31m-using System.Windows;[m
[31m-using System.Windows.Resources;[m
[31m-using WPCordovaClassLib.Cordova.JSON;[m
[31m-[m
[31m-namespace WPCordovaClassLib.Cordova.Commands[m
[31m-{[m
[31m-    /// <summary>[m
[31m-    /// Provides access to isolated storage[m
[31m-    /// </summary>[m
[31m-    public class File : BaseCommand[m
[31m-    {[m
[31m-        // Error codes[m
[31m-        public const int NOT_FOUND_ERR = 1;[m
[31m-        public const int SECURITY_ERR = 2;[m
[31m-        public const int ABORT_ERR = 3;[m
[31m-        public const int NOT_READABLE_ERR = 4;[m
[31m-        public const int ENCODING_ERR = 5;[m
[31m-        public const int NO_MODIFICATION_ALLOWED_ERR = 6;[m
[31m-        public const int INVALID_STATE_ERR = 7;[m
[31m-        public const int SYNTAX_ERR = 8;[m
[31m-        public const int INVALID_MODIFICATION_ERR = 9;[m
[31m-        public const int QUOTA_EXCEEDED_ERR = 10;[m
[31m-        public const int TYPE_MISMATCH_ERR = 11;[m
[31m-        public const int PATH_EXISTS_ERR = 12;[m
[31m-[m
[31m-        // File system options[m
[31m-        public const int TEMPORARY = 0;[m
[31m-        public const int PERSISTENT = 1;[m
[31m-        public const int RESOURCE = 2;[m
[31m-        public const int APPLICATION = 3;[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Temporary directory name[m
[31m-        /// </summary>[m
[31m-        private readonly string TMP_DIRECTORY_NAME = "tmp";[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Represents error code for callback[m
[31m-        /// </summary>[m
[31m-        [DataContract][m
[31m-        public class ErrorCode[m
[31m-        {[m
[31m-            /// <summary>[m
[31m-            /// Error code[m
[31m-            /// </summary>[m
[31m-            [DataMember(IsRequired = true, Name = "code")][m
[31m-            public int Code { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Creates ErrorCode object[m
[31m-            /// </summary>[m
[31m-            public ErrorCode(int code)[m
[31m-            {[m
[31m-                this.Code = code;[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Represents File action options.[m
[31m-        /// </summary>[m
[31m-        [DataContract][m
[31m-        public class FileOptions[m
[31m-        {[m
[31m-            /// <summary>[m
[31m-            /// File path[m
[31m-            /// </summary>[m
[31m-            /// [m
[31m-            private string _fileName;[m
[31m-            [DataMember(Name = "fileName")][m
[31m-            public string FilePath[m
[31m-            {[m
[31m-                get[m
[31m-                {[m
[31m-                    return this._fileName;[m
[31m-                }[m
[31m-[m
[31m-                set[m
[31m-                {[m
[31m-                    int index = value.IndexOfAny(new char[] { '#', '?' });[m
[31m-                    this._fileName = index > -1 ? value.Substring(0, index) : value;[m
[31m-                }[m
[31m-            }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Full entryPath[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "fullPath")][m
[31m-            public string FullPath { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Directory name[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "dirName")][m
[31m-            public string DirectoryName { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Path to create file/directory[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "path")][m
[31m-            public string Path { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// The encoding to use to encode the file's content. Default is UTF8.[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "encoding")][m
[31m-            public string Encoding { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Uri to get file[m
[31m-            /// </summary>[m
[31m-            /// [m
[31m-            private string _uri;[m
[31m-            [DataMember(Name = "uri")][m
[31m-            public string Uri[m
[31m-            {[m
[31m-                get[m
[31m-                {[m
[31m-                    return this._uri;[m
[31m-                }[m
[31m-[m
[31m-                set[m
[31m-                {[m
[31m-                    int index = value.IndexOfAny(new char[] { '#', '?' });[m
[31m-                    this._uri = index > -1 ? value.Substring(0, index) : value;[m
[31m-                }[m
[31m-            }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Size to truncate file[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "size")][m
[31m-            public long Size { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Data to write in file[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "data")][m
[31m-            public string Data { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Position the writing starts with[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "position")][m
[31m-            public int Position { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Type of file system requested[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "type")][m
[31m-            public int FileSystemType { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// New file/directory name[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "newName")][m
[31m-            public string NewName { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Destination directory to copy/move file/directory[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "parent")][m
[31m-            public string Parent { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Options for getFile/getDirectory methods[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "options")][m
[31m-            public CreatingOptions CreatingOpt { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Creates options object with default parameters[m
[31m-            /// </summary>[m
[31m-            public FileOptions()[m
[31m-            {[m
[31m-                this.SetDefaultValues(new StreamingContext());[m
[31m-            }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Initializes default values for class fields.[m
[31m-            /// Implemented in separate method because default constructor is not invoked during deserialization.[m
[31m-            /// </summary>[m
[31m-            /// <param name="context"></param>[m
[31m-            [OnDeserializing()][m
[31m-            public void SetDefaultValues(StreamingContext context)[m
[31m-            {[m
[31m-                this.Encoding = "UTF-8";[m
[31m-                this.FilePath = "";[m
[31m-                this.FileSystemType = -1; [m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Stores image info[m
[31m-        /// </summary>[m
[31m-        [DataContract][m
[31m-        public class FileMetadata[m
[31m-        {[m
[31m-            [DataMember(Name = "fileName")][m
[31m-            public string FileName { get; set; }[m
[31m-[m
[31m-            [DataMember(Name = "fullPath")][m
[31m-            public string FullPath { get; set; }[m
[31m-[m
[31m-            [DataMember(Name = "type")][m
[31m-            public string Type { get; set; }[m
[31m-[m
[31m-            [DataMember(Name = "lastModifiedDate")][m
[31m-            public string LastModifiedDate { get; set; }[m
[31m-[m
[31m-            [DataMember(Name = "size")][m
[31m-            public long Size { get; set; }[m
[31m-[m
[31m-            public FileMetadata(string filePath)[m
[31m-            {[m
[31m-                if (string.IsNullOrEmpty(filePath))[m
[31m-                {[m
[31m-                    throw new FileNotFoundException("File doesn't exist");[m
[31m-                }[m
[31m-[m
[31m-                this.FullPath = filePath;[m
[31m-                this.Size = 0;[m
[31m-                this.FileName = string.Empty;[m
[31m-[m
[31m-                using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    bool IsFile = isoFile.FileExists(filePath);[m
[31m-                    bool IsDirectory = isoFile.DirectoryExists(filePath);[m
[31m-[m
[31m-                        if (!IsDirectory)[m
[31m-                        {[m
[31m-                            if (!IsFile)      // special case, if isoFile cannot find it, it might still be part of the app-package[m
[31m-                            {[m
[31m-                                // attempt to get it from the resources[m
[31m-[m
[31m-                                Uri fileUri = new Uri(filePath, UriKind.Relative);[m
[31m-                                StreamResourceInfo streamInfo = Application.GetResourceStream(fileUri);[m
[31m-                                if (streamInfo != null)[m
[31m-                                {[m
[31m-                                    this.Size = streamInfo.Stream.Length;[m
[31m-                                    this.FileName = filePath.Substring(filePath.LastIndexOf("/") + 1);[m
[31m-                                }[m
[31m-                                else[m
[31m-                                {[m
[31m-                                    throw new FileNotFoundException("File doesn't exist");[m
[31m-                                }[m
[31m-                            }[m
[31m-                            else[m
[31m-                            {[m
[31m-                                using (IsolatedStorageFileStream stream = new IsolatedStorageFileStream(filePath, FileMode.Open, FileAccess.Read, isoFile))[m
[31m-                                {[m
[31m-                                    this.Size = stream.Length;[m
[31m-                                }[m
[31m-[m
[31m-                                this.FileName = System.IO.Path.GetFileName(filePath);[m
[31m-                                this.LastModifiedDate = isoFile.GetLastWriteTime(filePath).DateTime.ToString();[m
[31m-                            }[m
[31m-                        }[m
[31m-[m
[31m-                    this.Type = MimeTypeMapper.GetMimeType(this.FileName);[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Represents file or directory modification metadata[m
[31m-        /// </summary>[m
[31m-        [DataContract][m
[31m-        public class ModificationMetadata[m
[31m-        {[m
[31m-            /// <summary>[m
[31m-            /// Modification time[m
[31m-            /// </summary>[m
[31m-            [DataMember][m
[31m-            public string modificationTime { get; set; }[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Represents file or directory entry[m
[31m-        /// </summary>[m
[31m-        [DataContract][m
[31m-        public class FileEntry[m
[31m-        {[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// File type[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "isFile")][m
[31m-            public bool IsFile { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Directory type[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "isDirectory")][m
[31m-            public bool IsDirectory { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// File/directory name[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "name")][m
[31m-            public string Name { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Full path to file/directory[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "fullPath")][m
[31m-            public string FullPath { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// URI encoded fullpath[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "nativeURL")][m
[31m-            public string NativeURL[m
[31m-            {[m
[31m-                set { }[m
[31m-                get[m
[31m-                {[m
[31m-                    string escaped = Uri.EscapeUriString(this.FullPath);[m
[31m-                    escaped = escaped.Replace("//", "/");[m
[31m-                    if (escaped.StartsWith("/"))[m
[31m-                    {[m
[31m-                        escaped = escaped.Insert(0, "/");[m
[31m-                    }[m
[31m-                    return escaped;[m
[31m-                }[m
[31m-            }[m
[31m-[m
[31m-            public bool IsResource { get; set; }[m
[31m-[m
[31m-            public static FileEntry GetEntry(string filePath, bool bIsRes=false)[m
[31m-            {[m
[31m-                FileEntry entry = null;[m
[31m-                try[m
[31m-                {[m
[31m-                    entry = new FileEntry(filePath, bIsRes);[m
[31m-[m
[31m-                }[m
[31m-                catch (Exception ex)[m
[31m-                {[m
[31m-                    Debug.WriteLine("Exception in GetEntry for filePath :: " + filePath + " " + ex.Message);[m
[31m-                }[m
[31m-                return entry;[m
[31m-            }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Creates object and sets necessary properties[m
[31m-            /// </summary>[m
[31m-            /// <param name="filePath"></param>[m
[31m-            public FileEntry(string filePath, bool bIsRes = false)[m
[31m-            {[m
[31m-                if (string.IsNullOrEmpty(filePath))[m
[31m-                {[m
[31m-                    throw new ArgumentException();[m
[31m-                }[m
[31m-[m
[31m-                if(filePath.Contains(" ")) [m
[31m-                {[m
[31m-                    Debug.WriteLine("FilePath with spaces :: " +  filePath);[m
[31m-                }[m
[31m-[m
[31m-                using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    IsResource = bIsRes;[m
[31m-                    IsFile = isoFile.FileExists(filePath);[m
[31m-                    IsDirectory = isoFile.DirectoryExists(filePath);[m
[31m-                    if (IsFile)[m
[31m-                    {[m
[31m-                        this.Name = Path.GetFileName(filePath);[m
[31m-                    }[m
[31m-                    else if (IsDirectory)[m
[31m-                    {[m
[31m-                        this.Name = this.GetDirectoryName(filePath);[m
[31m-                        if (string.IsNullOrEmpty(Name))[m
[31m-                        {[m
[31m-                            this.Name = "/";[m
[31m-                        }[m
[31m-                    }[m
[31m-                    else[m
[31m-                    {[m
[31m-                        if (IsResource)[m
[31m-                        {[m
[31m-                            this.Name = Path.GetFileName(filePath);[m
[31m-                        }[m
[31m-                        else[m
[31m-                        {[m
[31m-                            throw new FileNotFoundException();[m
[31m-                        }[m
[31m-                    }[m
[31m-[m
[31m-                    try[m
[31m-                    {[m
[31m-                        this.FullPath = filePath.Replace('\\', '/'); // new Uri(filePath).LocalPath;[m
[31m-                    }[m
[31m-                    catch (Exception)[m
[31m-                    {[m
[31m-                        this.FullPath = filePath;[m
[31m-                    }[m
[31m-                }[m
[31m-            }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Extracts directory name from path string[m
[31m-            /// Path should refer to a directory, for example \foo\ or /foo.[m
[31m-            /// </summary>[m
[31m-            /// <param name="path"></param>[m
[31m-            /// <returns></returns>[m
[31m-            private string GetDirectoryName(string path)[m
[31m-            {[m
[31m-                if (String.IsNullOrEmpty(path))[m
[31m-                {[m
[31m-                    return path;[m
[31m-                }[m
[31m-[m
[31m-                string[] split = path.Split(new char[] { '/', '\\' }, StringSplitOptions.RemoveEmptyEntries);[m
[31m-                if (split.Length < 1)[m
[31m-                {[m
[31m-                    return null;[m
[31m-                }[m
[31m-                else[m
[31m-                {[m
[31m-                    return split[split.Length - 1];[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Represents info about requested file system[m
[31m-        /// </summary>[m
[31m-        [DataContract][m
[31m-        public class FileSystemInfo[m
[31m-        {[m
[31m-            /// <summary>[m
[31m-            /// file system type[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "name", IsRequired = true)][m
[31m-            public string Name { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Root directory entry[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "root", EmitDefaultValue = false)][m
[31m-            public FileEntry Root { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Creates class instance[m
[31m-            /// </summary>[m
[31m-            /// <param name="name"></param>[m
[31m-            /// <param name="rootEntry"> Root directory</param>[m
[31m-            public FileSystemInfo(string name, FileEntry rootEntry = null)[m
[31m-            {[m
[31m-                Name = name;[m
[31m-                Root = rootEntry;[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        [DataContract][m
[31m-        public class CreatingOptions[m
[31m-        {[m
[31m-            /// <summary>[m
[31m-            /// Create file/directory if is doesn't exist[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "create")][m
[31m-            public bool Create { get; set; }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Generate an exception if create=true and file/directory already exists[m
[31m-            /// </summary>[m
[31m-            [DataMember(Name = "exclusive")][m
[31m-            public bool Exclusive { get; set; }[m
[31m-[m
[31m-[m
[31m-        }[m
[31m-[m
[31m-        // returns null value if it fails.[m
[31m-        private string[] getOptionStrings(string options)[m
[31m-        {[m
[31m-            string[] optStings = null;[m
[31m-            try[m
[31m-            {[m
[31m-                optStings = JSON.JsonHelper.Deserialize<string[]>(options);[m
[31m-            }[m
[31m-            catch (Exception)[m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.JSON_EXCEPTION), CurrentCommandCallbackId);[m
[31m-            }[m
[31m-            return optStings;[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Gets amount of free space available for Isolated Storage[m
[31m-        /// </summary>[m
[31m-        /// <param name="options">No options is needed for this method</param>[m
[31m-        public void getFreeDiskSpace(string options)[m
[31m-        {[m
[31m-            string callbackId = getOptionStrings(options)[0];[m
[31m-[m
[31m-            try[m
[31m-            {[m
[31m-                using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.OK, isoFile.AvailableFreeSpace), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-            catch (IsolatedStorageException)[m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-            }[m
[31m-            catch (Exception ex)[m
[31m-            {[m
[31m-                if (!this.HandleException(ex))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Check if file exists[m
[31m-        /// </summary>[m
[31m-        /// <param name="options">File path</param>[m
[31m-        public void testFileExists(string options)[m
[31m-        {[m
[31m-            IsDirectoryOrFileExist(options, false);[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Check if directory exists[m
[31m-        /// </summary>[m
[31m-        /// <param name="options">directory name</param>[m
[31m-        public void testDirectoryExists(string options)[m
[31m-        {[m
[31m-            IsDirectoryOrFileExist(options, true);[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Check if file or directory exist[m
[31m-        /// </summary>[m
[31m-        /// <param name="options">File path/Directory name</param>[m
[31m-        /// <param name="isDirectory">Flag to recognize what we should check</param>[m
[31m-        public void IsDirectoryOrFileExist(string options, bool isDirectory)[m
[31m-        {[m
[31m-            string[] args = getOptionStrings(options);[m
[31m-            string callbackId = args[1];[m
[31m-            FileOptions fileOptions = JSON.JsonHelper.Deserialize<FileOptions>(args[0]);[m
[31m-            string filePath = args[0];[m
[31m-[m
[31m-            if (fileOptions == null)[m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.JSON_EXCEPTION), callbackId);[m
[31m-            }[m
[31m-[m
[31m-            try[m
[31m-            {[m
[31m-                using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    bool isExist;[m
[31m-                    if (isDirectory)[m
[31m-                    {[m
[31m-                        isExist = isoFile.DirectoryExists(fileOptions.DirectoryName);[m
[31m-                    }[m
[31m-                    else[m
[31m-                    {[m
[31m-                        isExist = isoFile.FileExists(fileOptions.FilePath);[m
[31m-                    }[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.OK, isExist), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-            catch (IsolatedStorageException) // default handler throws INVALID_MODIFICATION_ERR[m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-            }[m
[31m-            catch (Exception ex)[m
[31m-            {[m
[31m-                if (!this.HandleException(ex))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-[m
[31m-        }[m
[31m-[m
[31m-        public void readAsDataURL(string options)[m
[31m-        {[m
[31m-            string[] optStrings = getOptionStrings(options);[m
[31m-            string filePath = optStrings[0];[m
[31m-            int startPos = int.Parse(optStrings[1]);[m
[31m-            int endPos = int.Parse(optStrings[2]);[m
[31m-            string callbackId = optStrings[3];[m
[31m-[m
[31m-            if (filePath != null)[m
[31m-            {[m
[31m-                try[m
[31m-                {[m
[31m-                    string base64URL = null;[m
[31m-[m
[31m-                    using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                    {[m
[31m-                        if (!isoFile.FileExists(filePath))[m
[31m-                        {[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                            return;[m
[31m-                        }[m
[31m-                        string mimeType = MimeTypeMapper.GetMimeType(filePath);[m
[31m-[m
[31m-                        using (IsolatedStorageFileStream stream = isoFile.OpenFile(filePath, FileMode.Open, FileAccess.Read))[m
[31m-                        {[m
[31m-                            string base64String = GetFileContent(stream);[m
[31m-                            base64URL = "data:" + mimeType + ";base64," + base64String;[m
[31m-                        }[m
[31m-                    }[m
[31m-[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.OK, base64URL), callbackId);[m
[31m-                }[m
[31m-                catch (Exception ex)[m
[31m-                {[m
[31m-                    if (!this.HandleException(ex))[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        private byte[] readFileBytes(string filePath,int startPos,int endPos, IsolatedStorageFile isoFile)[m
[31m-        {[m
[31m-            byte[] buffer;[m
[31m-            using (IsolatedStorageFileStream reader = isoFile.OpenFile(filePath, FileMode.Open, FileAccess.Read))[m
[31m-            {[m
[31m-                if (startPos < 0)[m
[31m-                {[m
[31m-                    startPos = Math.Max((int)reader.Length + startPos, 0);[m
[31m-                }[m
[31m-                else if (startPos > 0)[m
[31m-                {[m
[31m-                    startPos = Math.Min((int)reader.Length, startPos);[m
[31m-                }[m
[31m-                if (endPos > 0)[m
[31m-                {[m
[31m-                    endPos = Math.Min((int)reader.Length, endPos);[m
[31m-                }[m
[31m-                else if (endPos < 0)[m
[31m-                {[m
[31m-                    endPos = Math.Max(endPos + (int)reader.Length, 0);[m
[31m-                }[m
[31m-[m
[31m-                buffer = new byte[endPos - startPos];[m
[31m-                reader.Seek(startPos, SeekOrigin.Begin);[m
[31m-                reader.Read(buffer, 0, buffer.Length);[m
[31m-            }[m
[31m-[m
[31m-            return buffer;[m
[31m-        }[m
[31m-[m
[31m-        public void readAsArrayBuffer(string options)[m
[31m-        {[m
[31m-            string[] optStrings = getOptionStrings(options);[m
[31m-            string filePath = optStrings[0];[m
[31m-            int startPos = int.Parse(optStrings[1]);[m
[31m-            int endPos = int.Parse(optStrings[2]);[m
[31m-            string callbackId = optStrings[3];[m
[31m-[m
[31m-            try[m
[31m-            {[m
[31m-                byte[] buffer;[m
[31m-[m
[31m-                using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    if (!isoFile.FileExists(filePath))[m
[31m-                    {[m
[31m-                        readResourceAsText(options);[m
[31m-                        return;[m
[31m-                    }[m
[31m-                    buffer = readFileBytes(filePath, startPos, endPos, isoFile);[m
[31m-                }[m
[31m-[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.OK, buffer), callbackId);[m
[31m-            }[m
[31m-            catch (Exception ex)[m
[31m-            {[m
[31m-                if (!this.HandleException(ex, callbackId))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void readAsBinaryString(string options)[m
[31m-        {[m
[31m-            string[] optStrings = getOptionStrings(options);[m
[31m-            string filePath = optStrings[0];[m
[31m-            int startPos = int.Parse(optStrings[1]);[m
[31m-            int endPos = int.Parse(optStrings[2]);[m
[31m-            string callbackId = optStrings[3];[m
[31m-[m
[31m-            try[m
[31m-            {[m
[31m-                string result;[m
[31m-[m
[31m-                using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    if (!isoFile.FileExists(filePath))[m
[31m-                    {[m
[31m-                        readResourceAsText(options);[m
[31m-                        return;[m
[31m-                    }[m
[31m-[m
[31m-                    byte[] buffer = readFileBytes(filePath, startPos, endPos, isoFile);[m
[31m-                    result = System.Text.Encoding.GetEncoding("iso-8859-1").GetString(buffer, 0, buffer.Length);[m
[31m-[m
[31m-                }[m
[31m-[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.OK, result), callbackId);[m
[31m-            }[m
[31m-            catch (Exception ex)[m
[31m-            {[m
[31m-                if (!this.HandleException(ex, callbackId))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void readAsText(string options)[m
[31m-        {[m
[31m-            string[] optStrings = getOptionStrings(options);[m
[31m-            string filePath = optStrings[0];[m
[31m-            string encStr = optStrings[1];[m
[31m-            int startPos = int.Parse(optStrings[2]);[m
[31m-            int endPos = int.Parse(optStrings[3]);[m
[31m-            string callbackId = optStrings[4];[m
[31m-[m
[31m-            try[m
[31m-            {[m
[31m-                string text = "";[m
[31m-[m
[31m-                using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    if (!isoFile.FileExists(filePath))[m
[31m-                    {[m
[31m-                        readResourceAsText(options);[m
[31m-                        return;[m
[31m-                    }[m
[31m-                    Encoding encoding = Encoding.GetEncoding(encStr);[m
[31m-[m
[31m-                    byte[] buffer = this.readFileBytes(filePath, startPos, endPos, isoFile);[m
[31m-                    text = encoding.GetString(buffer, 0, buffer.Length);[m
[31m-                }[m
[31m-[m
[31m-                // JIRA: https://issues.apache.org/jira/browse/CB-8792[m
[31m-                // Need to perform additional serialization here because NativeExecution is always trying[m
[31m-                // to do JSON.parse() on command result. This leads to issue when trying to read JSON files[m
[31m-                var resultText = JsonHelper.Serialize(text);[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.OK, resultText), callbackId);[m
[31m-            }[m
[31m-            catch (Exception ex)[m
[31m-            {[m
[31m-                if (!this.HandleException(ex, callbackId))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Reads application resource as a text[m
[31m-        /// </summary>[m
[31m-        /// <param name="options">Path to a resource</param>[m
[31m-        public void readResourceAsText(string options)[m
[31m-        {[m
[31m-            string[] optStrings = getOptionStrings(options);[m
[31m-            string pathToResource = optStrings[0];[m
[31m-            string encStr = optStrings[1];[m
[31m-            int start = int.Parse(optStrings[2]);[m
[31m-            int endMarker = int.Parse(optStrings[3]);[m
[31m-            string callbackId = optStrings[4];[m
[31m-[m
[31m-            try[m
[31m-            {[m
[31m-                if (pathToResource.StartsWith("/"))[m
[31m-                {[m
[31m-                    pathToResource = pathToResource.Remove(0, 1);[m
[31m-                }[m
[31m-                [m
[31m-                var resource = Application.GetResourceStream(new Uri(pathToResource, UriKind.Relative));[m
[31m-                [m
[31m-                if (resource == null)[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                    return;[m
[31m-                }[m
[31m-[m
[31m-                string text;[m
[31m-                StreamReader streamReader = new StreamReader(resource.Stream);[m
[31m-                text = streamReader.ReadToEnd();[m
[31m-[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.OK, text), callbackId);[m
[31m-            }[m
[31m-            catch (Exception ex)[m
[31m-            {[m
[31m-                if (!this.HandleException(ex, callbackId))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void truncate(string options)[m
[31m-        {[m
[31m-            string[] optStrings = getOptionStrings(options);[m
[31m-[m
[31m-            string filePath = optStrings[0];[m
[31m-            int size = int.Parse(optStrings[1]);[m
[31m-            string callbackId = optStrings[2];[m
[31m-[m
[31m-            try[m
[31m-            {[m
[31m-                long streamLength = 0;[m
[31m-[m
[31m-                using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    if (!isoFile.FileExists(filePath))[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                        return;[m
[31m-                    }[m
[31m-[m
[31m-                    using (FileStream stream = new IsolatedStorageFileStream(filePath, FileMode.Open, FileAccess.ReadWrite, isoFile))[m
[31m-                    {[m
[31m-                        if (0 <= size && size <= stream.Length)[m
[31m-                        {[m
[31m-                            stream.SetLength(size);[m
[31m-                        }[m
[31m-                        streamLength = stream.Length;[m
[31m-                    }[m
[31m-                }[m
[31m-[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.OK, streamLength), callbackId);[m
[31m-            }[m
[31m-            catch (Exception ex)[m
[31m-            {[m
[31m-                if (!this.HandleException(ex, callbackId))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        //write:[filePath,data,position,isBinary,callbackId][m
[31m-        public void write(string options)[m
[31m-        {[m
[31m-            string[] optStrings = getOptionStrings(options);[m
[31m-[m
[31m-            string filePath = optStrings[0];[m
[31m-            string data = optStrings[1];[m
[31m-            int position = int.Parse(optStrings[2]);[m
[31m-            bool isBinary = bool.Parse(optStrings[3]);[m
[31m-            string callbackId = optStrings[4];[m
[31m-[m
[31m-            try[m
[31m-            {[m
[31m-                if (string.IsNullOrEmpty(data))[m
[31m-                {[m
[31m-                    Debug.WriteLine("Expected some data to be send in the write command to {0}", filePath);[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.JSON_EXCEPTION), callbackId);[m
[31m-                    return;[m
[31m-                }[m
[31m-[m
[31m-                byte[] dataToWrite = isBinary ? JSON.JsonHelper.Deserialize<byte[]>(data) :[m
[31m-                                     System.Text.Encoding.UTF8.GetBytes(data);[m
[31m-[m
[31m-                using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    // create the file if not exists[m
[31m-                    if (!isoFile.FileExists(filePath))[m
[31m-                    {[m
[31m-                        var file = isoFile.CreateFile(filePath);[m
[31m-                        file.Close();[m
[31m-                    }[m
[31m-[m
[31m-                    using (FileStream stream = new IsolatedStorageFileStream(filePath, FileMode.Open, FileAccess.ReadWrite, isoFile))[m
[31m-                    {[m
[31m-                        if (0 <= position && position <= stream.Length)[m
[31m-                        {[m
[31m-                            stream.SetLength(position);[m
[31m-                        }[m
[31m-                        using (BinaryWriter writer = new BinaryWriter(stream))[m
[31m-                        {[m
[31m-                            writer.Seek(0, SeekOrigin.End);[m
[31m-                            writer.Write(dataToWrite);[m
[31m-                        }[m
[31m-                    }[m
[31m-                }[m
[31m-[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.OK, dataToWrite.Length), callbackId);[m
[31m-            }[m
[31m-            catch (Exception ex)[m
[31m-            {[m
[31m-                if (!this.HandleException(ex, callbackId))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Look up metadata about this entry.[m
[31m-        /// </summary>[m
[31m-        /// <param name="options">filePath to entry</param>   [m
[31m-        public void getMetadata(string options)[m
[31m-        {[m
[31m-            string[] optStings = getOptionStrings(options);[m
[31m-            string filePath = optStings[0];[m
[31m-            string callbackId = optStings[1];[m
[31m-[m
[31m-            if (filePath != null)[m
[31m-            {[m
[31m-                try[m
[31m-                {[m
[31m-                    using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                    {[m
[31m-                        if (isoFile.FileExists(filePath))[m
[31m-                        {[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.OK,[m
[31m-                                new ModificationMetadata() { modificationTime = isoFile.GetLastWriteTime(filePath).DateTime.ToString() }), callbackId);[m
[31m-                        }[m
[31m-                        else if (isoFile.DirectoryExists(filePath))[m
[31m-                        {[m
[31m-                            string modTime = isoFile.GetLastWriteTime(filePath).DateTime.ToString();[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.OK, new ModificationMetadata() { modificationTime = modTime }), callbackId);[m
[31m-                        }[m
[31m-                        else[m
[31m-                        {[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                        }[m
[31m-[m
[31m-                    }[m
[31m-                }[m
[31m-                catch (IsolatedStorageException)[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-                }[m
[31m-                catch (Exception ex)[m
[31m-                {[m
[31m-                    if (!this.HandleException(ex))[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-            }[m
[31m-[m
[31m-        }[m
[31m-[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Returns a File that represents the current state of the file that this FileEntry represents.[m
[31m-        /// </summary>[m
[31m-        /// <param name="filePath">filePath to entry</param>[m
[31m-        /// <returns></returns>[m
[31m-        public void getFileMetadata(string options)[m
[31m-        {[m
[31m-            string[] optStings = getOptionStrings(options);[m
[31m-            string filePath = optStings[0];[m
[31m-            string callbackId = optStings[1];[m
[31m-[m
[31m-            if (!string.IsNullOrEmpty(filePath))[m
[31m-            {[m
[31m-                try[m
[31m-                {[m
[31m-                    FileMetadata metaData = new FileMetadata(filePath);[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.OK, metaData), callbackId);[m
[31m-                }[m
[31m-                catch (IsolatedStorageException)[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-                }[m
[31m-                catch (Exception ex)[m
[31m-                {[m
[31m-                    if (!this.HandleException(ex))[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_READABLE_ERR), callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-            }[m
[31m-            else[m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Look up the parent DirectoryEntry containing this Entry. [m
[31m-        /// If this Entry is the root of IsolatedStorage, its parent is itself.[m
[31m-        /// </summary>[m
[31m-        /// <param name="options"></param>[m
[31m-        public void getParent(string options)[m
[31m-        {[m
[31m-            string[] optStings = getOptionStrings(options);[m
[31m-            string filePath = optStings[0];[m
[31m-            string callbackId = optStings[1];[m
[31m-[m
[31m-            if (filePath != null)[m
[31m-            {[m
[31m-                try[m
[31m-                {[m
[31m-                    if (string.IsNullOrEmpty(filePath))[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.JSON_EXCEPTION),callbackId);[m
[31m-                        return;[m
[31m-                    }[m
[31m-[m
[31m-                    using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                    {[m
[31m-                        FileEntry entry;[m
[31m-[m
[31m-                        if (isoFile.FileExists(filePath) || isoFile.DirectoryExists(filePath))[m
[31m-                        {[m
[31m-                           [m
[31m-                             [m
[31m-                            string path = this.GetParentDirectory(filePath);[m
[31m-                            entry = FileEntry.GetEntry(path);[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.OK, entry),callbackId);[m
[31m-                        }[m
[31m-                        else[m
[31m-                        {[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR),callbackId);[m
[31m-                        }[m
[31m-[m
[31m-                    }[m
[31m-                }[m
[31m-                catch (Exception ex)[m
[31m-                {[m
[31m-                    if (!this.HandleException(ex))[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR),callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void remove(string options)[m
[31m-        {[m
[31m-            string[] args = getOptionStrings(options);[m
[31m-            string filePath = args[0];[m
[31m-            string callbackId = args[1];[m
[31m-[m
[31m-            if (filePath != null)[m
[31m-            {[m
[31m-                try[m
[31m-                {[m
[31m-                    if (filePath == "/" || filePath == "" || filePath == @"\")[m
[31m-                    {[m
[31m-                        throw new Exception("Cannot delete root file system") ;[m
[31m-                    }[m
[31m-                    using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                    {[m
[31m-                        if (isoFile.FileExists(filePath))[m
[31m-                        {[m
[31m-                            isoFile.DeleteFile(filePath);[m
[31m-                        }[m
[31m-                        else[m
[31m-                        {[m
[31m-                            if (isoFile.DirectoryExists(filePath))[m
[31m-                            {[m
[31m-                                isoFile.DeleteDirectory(filePath);[m
[31m-                            }[m
[31m-                            else[m
[31m-                            {[m
[31m-                                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR),callbackId);[m
[31m-                                return;[m
[31m-                            }[m
[31m-                        }[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.OK),callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-                catch (Exception ex)[m
[31m-                {[m
[31m-                    if (!this.HandleException(ex))[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NO_MODIFICATION_ALLOWED_ERR),callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void removeRecursively(string options)[m
[31m-        {[m
[31m-            string[] args = getOptionStrings(options);[m
[31m-            string filePath = args[0];[m
[31m-            string callbackId = args[1];[m
[31m-[m
[31m-            if (filePath != null)[m
[31m-            {[m
[31m-                if (string.IsNullOrEmpty(filePath))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.JSON_EXCEPTION),callbackId);[m
[31m-                }[m
[31m-                else[m
[31m-                {[m
[31m-                    if (removeDirRecursively(filePath, callbackId))[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.OK), callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void readEntries(string options)[m
[31m-        {[m
[31m-            string[] args = getOptionStrings(options);[m
[31m-            string filePath = args[0];[m
[31m-            string callbackId = args[1];[m
[31m-[m
[31m-            if (filePath != null)[m
[31m-            {[m
[31m-                try[m
[31m-                {[m
[31m-                    if (string.IsNullOrEmpty(filePath))[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.JSON_EXCEPTION),callbackId);[m
[31m-                        return;[m
[31m-                    }[m
[31m-[m
[31m-                    using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                    {[m
[31m-                        if (isoFile.DirectoryExists(filePath))[m
[31m-                        {[m
[31m-                            string path = File.AddSlashToDirectory(filePath);[m
[31m-                            List<FileEntry> entries = new List<FileEntry>();[m
[31m-                            string[] files = isoFile.GetFileNames(path + "*");[m
[31m-                            string[] dirs = isoFile.GetDirectoryNames(path + "*");[m
[31m-                            foreach (string file in files)[m
[31m-                            {[m
[31m-                                entries.Add(FileEntry.GetEntry(path + file));[m
[31m-                            }[m
[31m-                            foreach (string dir in dirs)[m
[31m-                            {[m
[31m-                                entries.Add(FileEntry.GetEntry(path + dir + "/"));[m
[31m-                            }[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.OK, entries),callbackId);[m
[31m-                        }[m
[31m-                        else[m
[31m-                        {[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR),callbackId);[m
[31m-                        }[m
[31m-                    }[m
[31m-                }[m
[31m-                catch (Exception ex)[m
[31m-                {[m
[31m-                    if (!this.HandleException(ex))[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NO_MODIFICATION_ALLOWED_ERR),callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void requestFileSystem(string options)[m
[31m-        {[m
[31m-            // TODO: try/catch[m
[31m-            string[] optVals = getOptionStrings(options);[m
[31m-            //FileOptions fileOptions = new FileOptions();[m
[31m-            int fileSystemType = int.Parse(optVals[0]);[m
[31m-            double size = double.Parse(optVals[1]);[m
[31m-            string callbackId = optVals[2];[m
[31m-[m
[31m-[m
[31m-            IsolatedStorageFile.GetUserStoreForApplication();[m
[31m-[m
[31m-            if (size > (10 * 1024 * 1024)) // 10 MB, compier will clean this up![m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, QUOTA_EXCEEDED_ERR), callbackId);[m
[31m-                return;[m
[31m-            }[m
[31m-[m
[31m-            try[m
[31m-            {[m
[31m-                if (size != 0)[m
[31m-                {[m
[31m-                    using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                    {[m
[31m-                        long availableSize = isoFile.AvailableFreeSpace;[m
[31m-                        if (size > availableSize)[m
[31m-                        {[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, QUOTA_EXCEEDED_ERR), callbackId);[m
[31m-                            return;[m
[31m-                        }[m
[31m-                    }[m
[31m-                }[m
[31m-[m
[31m-                if (fileSystemType == PERSISTENT)[m
[31m-                {[m
[31m-                    // TODO: this should be in it's own folder to prevent overwriting of the app assets, which are also in ISO[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.OK, new FileSystemInfo("persistent", FileEntry.GetEntry("/"))), callbackId);[m
[31m-                }[m
[31m-                else if (fileSystemType == TEMPORARY)[m
[31m-                {[m
[31m-                    using (IsolatedStorageFile isoStorage = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                    {[m
[31m-                        if (!isoStorage.FileExists(TMP_DIRECTORY_NAME))[m
[31m-                        {[m
[31m-                            isoStorage.CreateDirectory(TMP_DIRECTORY_NAME);[m
[31m-                        }[m
[31m-                    }[m
[31m-[m
[31m-                    string tmpFolder = "/" + TMP_DIRECTORY_NAME + "/";[m
[31m-[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.OK, new FileSystemInfo("temporary", FileEntry.GetEntry(tmpFolder))), callbackId);[m
[31m-                }[m
[31m-                else if (fileSystemType == RESOURCE)[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.OK, new FileSystemInfo("resource")), callbackId);[m
[31m-                }[m
[31m-                else if (fileSystemType == APPLICATION)[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.OK, new FileSystemInfo("application")), callbackId);[m
[31m-                }[m
[31m-                else[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NO_MODIFICATION_ALLOWED_ERR), callbackId);[m
[31m-                }[m
[31m-[m
[31m-            }[m
[31m-            catch (Exception ex)[m
[31m-            {[m
[31m-                if (!this.HandleException(ex))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NO_MODIFICATION_ALLOWED_ERR), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void resolveLocalFileSystemURI(string options)[m
[31m-        {[m
[31m-[m
[31m-            string[] optVals = getOptionStrings(options);[m
[31m-            string uri = optVals[0].Split('?')[0];[m
[31m-            string callbackId = optVals[1];[m
[31m-[m
[31m-            if (uri != null)[m
[31m-            {[m
[31m-                // a single '/' is valid, however, '/someDir' is not, but '/tmp//somedir' and '///someDir' are valid[m
[31m-                if (uri.StartsWith("/") && uri.IndexOf("//") < 0 && uri != "/")[m
[31m-                {[m
[31m-                     DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, ENCODING_ERR), callbackId);[m
[31m-                     return;[m
[31m-                }[m
[31m-                try[m
[31m-                {[m
[31m-                    // fix encoded spaces[m
[31m-                    string path = Uri.UnescapeDataString(uri);[m
[31m-[m
[31m-                    FileEntry uriEntry = FileEntry.GetEntry(path);[m
[31m-                    if (uriEntry != null)[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.OK, uriEntry), callbackId);[m
[31m-                    }[m
[31m-                    else[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-                catch (Exception ex)[m
[31m-                {[m
[31m-                    if (!this.HandleException(ex, callbackId))[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NO_MODIFICATION_ALLOWED_ERR), callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void copyTo(string options)[m
[31m-        {[m
[31m-            TransferTo(options, false);[m
[31m-        }[m
[31m-[m
[31m-        public void moveTo(string options)[m
[31m-        {[m
[31m-            TransferTo(options, true);[m
[31m-        }[m
[31m-[m
[31m-        public void getFile(string options)[m
[31m-        {[m
[31m-            GetFileOrDirectory(options, false);[m
[31m-        }[m
[31m-[m
[31m-        public void getDirectory(string options)[m
[31m-        {[m
[31m-            GetFileOrDirectory(options, true);[m
[31m-        }[m
[31m-[m
[31m-        #region internal functionality[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Retrieves the parent directory name of the specified path,[m
[31m-        /// </summary>[m
[31m-        /// <param name="path">Path</param>[m
[31m-        /// <returns>Parent directory name</returns>[m
[31m-        private string GetParentDirectory(string path)[m
[31m-        {[m
[31m-            if (String.IsNullOrEmpty(path) || path == "/")[m
[31m-            {[m
[31m-                return "/";[m
[31m-            }[m
[31m-[m
[31m-            if (path.EndsWith(@"/") || path.EndsWith(@"\"))[m
[31m-            {[m
[31m-                return this.GetParentDirectory(Path.GetDirectoryName(path));[m
[31m-            }[m
[31m-[m
[31m-            string result = Path.GetDirectoryName(path);[m
[31m-            if (result == null)[m
[31m-            {[m
[31m-                result = "/";[m
[31m-            }[m
[31m-[m
[31m-            return result;[m
[31m-        }[m
[31m-[m
[31m-        private bool removeDirRecursively(string fullPath,string callbackId)[m
[31m-        {[m
[31m-            try[m
[31m-            {[m
[31m-                if (fullPath == "/")[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NO_MODIFICATION_ALLOWED_ERR),callbackId);[m
[31m-                    return false;[m
[31m-                }[m
[31m-[m
[31m-                using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    if (isoFile.DirectoryExists(fullPath))[m
[31m-                    {[m
[31m-                        string tempPath = File.AddSlashToDirectory(fullPath);[m
[31m-                        string[] files = isoFile.GetFileNames(tempPath + "*");[m
[31m-                        if (files.Length > 0)[m
[31m-                        {[m
[31m-                            foreach (string file in files)[m
[31m-                            {[m
[31m-                                isoFile.DeleteFile(tempPath + file);[m
[31m-                            }[m
[31m-                        }[m
[31m-                        string[] dirs = isoFile.GetDirectoryNames(tempPath + "*");[m
[31m-                        if (dirs.Length > 0)[m
[31m-                        {[m
[31m-                            foreach (string dir in dirs)[m
[31m-                            {[m
[31m-                                if (!removeDirRecursively(tempPath + dir, callbackId))[m
[31m-                                {[m
[31m-                                    return false;[m
[31m-                                }[m
[31m-                            }[m
[31m-                        }[m
[31m-                        isoFile.DeleteDirectory(fullPath);[m
[31m-                    }[m
[31m-                    else[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR),callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-            }[m
[31m-            catch (Exception ex)[m
[31m-            {[m
[31m-                if (!this.HandleException(ex))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NO_MODIFICATION_ALLOWED_ERR),callbackId);[m
[31m-                    return false;[m
[31m-                }[m
[31m-            }[m
[31m-            return true;[m
[31m-        }[m
[31m-[m
[31m-        private bool CanonicalCompare(string pathA, string pathB)[m
[31m-        {[m
[31m-            string a = pathA.Replace("//", "/");[m
[31m-            string b = pathB.Replace("//", "/");[m
[31m-[m
[31m-            return a.Equals(b, StringComparison.OrdinalIgnoreCase);[m
[31m-        }[m
[31m-[m
[31m-        /*[m
[31m-         *  copyTo:["fullPath","parent", "newName"],[m
[31m-         *  moveTo:["fullPath","parent", "newName"],[m
[31m-         */[m
[31m-        private void TransferTo(string options, bool move)[m
[31m-        {[m
[31m-            // TODO: try/catch[m
[31m-            string[] optStrings = getOptionStrings(options);[m
[31m-            string fullPath = optStrings[0];[m
[31m-            string parent = optStrings[1];[m
[31m-            string newFileName = optStrings[2];[m
[31m-            string callbackId = optStrings[3];[m
[31m-[m
[31m-            char[] invalids = Path.GetInvalidPathChars();[m
[31m-            [m
[31m-            if (newFileName.IndexOfAny(invalids) > -1 || newFileName.IndexOf(":") > -1 )[m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, ENCODING_ERR), callbackId);[m
[31m-                return;[m
[31m-            }[m
[31m-[m
[31m-            try[m
[31m-            {[m
[31m-                if ((parent == null) || (string.IsNullOrEmpty(parent)) || (string.IsNullOrEmpty(fullPath)))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                    return;[m
[31m-                }[m
[31m-[m
[31m-                string parentPath = File.AddSlashToDirectory(parent);[m
[31m-                string currentPath = fullPath;[m
[31m-[m
[31m-                using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    bool isFileExist = isoFile.FileExists(currentPath);[m
[31m-                    bool isDirectoryExist = isoFile.DirectoryExists(currentPath);[m
[31m-                    bool isParentExist = isoFile.DirectoryExists(parentPath);[m
[31m-[m
[31m-                    if ( ( !isFileExist && !isDirectoryExist ) || !isParentExist )[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                        return;[m
[31m-                    }[m
[31m-                    string newName;[m
[31m-                    string newPath;[m
[31m-                    if (isFileExist)[m
[31m-                    {[m
[31m-                        newName = (string.IsNullOrEmpty(newFileName))[m
[31m-                                    ? Path.GetFileName(currentPath)[m
[31m-                                    : newFileName;[m
[31m-[m
[31m-                        newPath = Path.Combine(parentPath, newName);[m
[31m-                        [m
[31m-                        // sanity check ..[m
[31m-                        // cannot copy file onto itself[m
[31m-                        if (CanonicalCompare(newPath,currentPath)) //(parent + newFileName))[m
[31m-                        {[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, INVALID_MODIFICATION_ERR), callbackId);[m
[31m-                            return;[m
[31m-                        }[m
[31m-                        else if (isoFile.DirectoryExists(newPath)) [m
[31m-                        {[m
[31m-                            // there is already a folder with the same name, operation is not allowed[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, INVALID_MODIFICATION_ERR), callbackId);[m
[31m-                            return;[m
[31m-                        }[m
[31m-                        else if (isoFile.FileExists(newPath))[m
[31m-                        {   // remove destination file if exists, in other case there will be exception[m
[31m-                            isoFile.DeleteFile(newPath);[m
[31m-                        }[m
[31m-[m
[31m-                        if (move)[m
[31m-                        {[m
[31m-                            isoFile.MoveFile(currentPath, newPath);[m
[31m-                        }[m
[31m-                        else[m
[31m-                        {[m
[31m-                            isoFile.CopyFile(currentPath, newPath, true);[m
[31m-                        }[m
[31m-                    }[m
[31m-                    else[m
[31m-                    {[m
[31m-                        newName = (string.IsNullOrEmpty(newFileName))[m
[31m-                                    ? currentPath[m
[31m-                                    : newFileName;[m
[31m-[m
[31m-                        newPath = Path.Combine(parentPath, newName);[m
[31m-[m
[31m-                        if (move)[m
[31m-                        {[m
[31m-                            // remove destination directory if exists, in other case there will be exception[m
[31m-                            // target directory should be empty[m
[31m-                            if (!newPath.Equals(currentPath) && isoFile.DirectoryExists(newPath))[m
[31m-                            {[m
[31m-                                isoFile.DeleteDirectory(newPath);[m
[31m-                            }[m
[31m-[m
[31m-                            isoFile.MoveDirectory(currentPath, newPath);[m
[31m-                        }[m
[31m-                        else[m
[31m-                        {[m
[31m-                            CopyDirectory(currentPath, newPath, isoFile);[m
[31m-                        }[m
[31m-                    }[m
[31m-                    FileEntry entry = FileEntry.GetEntry(newPath);[m
[31m-                    if (entry != null)[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.OK, entry), callbackId);[m
[31m-                    }[m
[31m-                    else[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-[m
[31m-            }[m
[31m-            catch (Exception ex)[m
[31m-            {[m
[31m-                if (!this.HandleException(ex, callbackId))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NO_MODIFICATION_ALLOWED_ERR), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        private bool HandleException(Exception ex, string cbId="")[m
[31m-        {[m
[31m-            bool handled = false;[m
[31m-            string callbackId = String.IsNullOrEmpty(cbId) ? this.CurrentCommandCallbackId : cbId;[m
[31m-            if (ex is SecurityException)[m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, SECURITY_ERR), callbackId);[m
[31m-                handled = true;[m
[31m-            }[m
[31m-            else if (ex is FileNotFoundException)[m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                handled = true;[m
[31m-            }[m
[31m-            else if (ex is ArgumentException)[m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, ENCODING_ERR), callbackId);[m
[31m-                handled = true;[m
[31m-            }[m
[31m-            else if (ex is IsolatedStorageException)[m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, INVALID_MODIFICATION_ERR), callbackId);[m
[31m-                handled = true;[m
[31m-            }[m
[31m-            else if (ex is DirectoryNotFoundException)[m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                handled = true;[m
[31m-            }[m
[31m-            return handled;[m
[31m-        }[m
[31m-[m
[31m-        private void CopyDirectory(string sourceDir, string destDir, IsolatedStorageFile isoFile)[m
[31m-        {[m
[31m-            string path = File.AddSlashToDirectory(sourceDir);[m
[31m-[m
[31m-            bool bExists = isoFile.DirectoryExists(destDir);[m
[31m-[m
[31m-            if (!bExists)[m
[31m-            {[m
[31m-                isoFile.CreateDirectory(destDir);[m
[31m-            }[m
[31m-[m
[31m-            destDir = File.AddSlashToDirectory(destDir);[m
[31m-               [m
[31m-            string[] files = isoFile.GetFileNames(path + "*");[m
[31m-                [m
[31m-            if (files.Length > 0)[m
[31m-            {[m
[31m-                foreach (string file in files)[m
[31m-                {[m
[31m-                    isoFile.CopyFile(path + file, destDir + file,true);[m
[31m-                }[m
[31m-            }[m
[31m-            string[] dirs = isoFile.GetDirectoryNames(path + "*");[m
[31m-            if (dirs.Length > 0)[m
[31m-            {[m
[31m-                foreach (string dir in dirs)[m
[31m-                {[m
[31m-                    CopyDirectory(path + dir, destDir + dir, isoFile);[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        private string RemoveExtraSlash(string path) {[m
[31m-            if (path.StartsWith("//")) {[m
[31m-                path = path.Remove(0, 1);[m
[31m-                path = RemoveExtraSlash(path);[m
[31m-            }[m
[31m-            return path;[m
[31m-        }[m
[31m-[m
[31m-        private string ResolvePath(string parentPath, string path)[m
[31m-        {   [m
[31m-            string absolutePath = null;[m
[31m-            [m
[31m-            if (path.Contains(".."))[m
[31m-            {[m
[31m-                if (parentPath.Length > 1 && parentPath.StartsWith("/") && parentPath !="/")[m
[31m-                {[m
[31m-                    parentPath = RemoveExtraSlash(parentPath);[m
[31m-                }[m
[31m-                [m
[31m-                string fullPath = Path.GetFullPath(Path.Combine(parentPath, path));[m
[31m-                absolutePath = fullPath.Replace(Path.GetPathRoot(fullPath), @"//");[m
[31m-            }[m
[31m-            else[m
[31m-            {[m
[31m-                absolutePath = Path.Combine(parentPath + "/", path);[m
[31m-            }[m
[31m-            return absolutePath;[m
[31m-        }[m
[31m-[m
[31m-        private void GetFileOrDirectory(string options, bool getDirectory)[m
[31m-        {[m
[31m-            FileOptions fOptions = new FileOptions();[m
[31m-            string[] args = getOptionStrings(options);[m
[31m-[m
[31m-            fOptions.FullPath = args[0];[m
[31m-            fOptions.Path = args[1];[m
[31m-[m
[31m-            string callbackId = args[3];[m
[31m-[m
[31m-            try[m
[31m-            {[m
[31m-                fOptions.CreatingOpt = JSON.JsonHelper.Deserialize<CreatingOptions>(args[2]);[m
[31m-            }[m
[31m-            catch (Exception)[m
[31m-            {[m
[31m-                DispatchCommandResult(new PluginResult(PluginResult.Status.JSON_EXCEPTION), callbackId);[m
[31m-                return;[m
[31m-            }[m
[31m-[m
[31m-            try[m
[31m-            {[m
[31m-                if ((string.IsNullOrEmpty(fOptions.Path)) || (string.IsNullOrEmpty(fOptions.FullPath)))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                    return;[m
[31m-                }[m
[31m-[m
[31m-                string path;[m
[31m-[m
[31m-                if (fOptions.Path.Split(':').Length > 2)[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, ENCODING_ERR), callbackId);[m
[31m-                    return;[m
[31m-                }[m
[31m-[m
[31m-                try[m
[31m-                {[m
[31m-                    path = ResolvePath(fOptions.FullPath, fOptions.Path);[m
[31m-                }[m
[31m-                catch (Exception)[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, ENCODING_ERR), callbackId);[m
[31m-                    return;[m
[31m-                }[m
[31m-[m
[31m-                using (IsolatedStorageFile isoFile = IsolatedStorageFile.GetUserStoreForApplication())[m
[31m-                {[m
[31m-                    bool isFile = isoFile.FileExists(path);[m
[31m-                    bool isDirectory = isoFile.DirectoryExists(path);[m
[31m-                    bool create = (fOptions.CreatingOpt == null) ? false : fOptions.CreatingOpt.Create;[m
[31m-                    bool exclusive = (fOptions.CreatingOpt == null) ? false : fOptions.CreatingOpt.Exclusive;[m
[31m-                    if (create)[m
[31m-                    {[m
[31m-                        if (exclusive && (isoFile.FileExists(path) || isoFile.DirectoryExists(path)))[m
[31m-                        {[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, PATH_EXISTS_ERR), callbackId);[m
[31m-                            return;[m
[31m-                        }[m
[31m-[m
[31m-                        // need to make sure the parent exists[m
[31m-                        // it is an error to create a directory whose immediate parent does not yet exist[m
[31m-                        // see issue: https://issues.apache.org/jira/browse/CB-339[m
[31m-                        string[] pathParts = path.Split('/');[m
[31m-                        string builtPath = pathParts[0];[m
[31m-                        for (int n = 1; n < pathParts.Length - 1; n++)[m
[31m-                        {[m
[31m-                            builtPath += "/" + pathParts[n];[m
[31m-                            if (!isoFile.DirectoryExists(builtPath))[m
[31m-                            {[m
[31m-                                Debug.WriteLine(String.Format("Error :: Parent folder \"{0}\" does not exist, when attempting to create \"{1}\"",builtPath,path));[m
[31m-                                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                                return;[m
[31m-                            }[m
[31m-                        }[m
[31m-[m
[31m-                        if ((getDirectory) && (!isDirectory))[m
[31m-                        {[m
[31m-                            isoFile.CreateDirectory(path);[m
[31m-                        }[m
[31m-                        else[m
[31m-                        {[m
[31m-                            if ((!getDirectory) && (!isFile))[m
[31m-                            {[m
[31m-[m
[31m-                                IsolatedStorageFileStream fileStream = isoFile.CreateFile(path);[m
[31m-                                fileStream.Close();[m
[31m-                            }[m
[31m-                        }[m
[31m-                    }[m
[31m-                    else // (not create)[m
[31m-                    {[m
[31m-                        if ((!isFile) && (!isDirectory))[m
[31m-                        {[m
[31m-                            if (path.IndexOf("//www") == 0)[m
[31m-                            {[m
[31m-                                Uri fileUri = new Uri(path.Remove(0,2), UriKind.Relative);[m
[31m-                                StreamResourceInfo streamInfo = Application.GetResourceStream(fileUri);[m
[31m-                                if (streamInfo != null)[m
[31m-                                {[m
[31m-                                    FileEntry _entry = FileEntry.GetEntry(fileUri.OriginalString,true);[m
[31m-[m
[31m-                                    DispatchCommandResult(new PluginResult(PluginResult.Status.OK, _entry), callbackId);[m
[31m-[m
[31m-                                    //using (BinaryReader br = new BinaryReader(streamInfo.Stream))[m
[31m-                                    //{[m
[31m-                                    //    byte[] data = br.ReadBytes((int)streamInfo.Stream.Length);[m
[31m-                                   [m
[31m-                                    //}[m
[31m-[m
[31m-                                }[m
[31m-                                else[m
[31m-                                {[m
[31m-                                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                                }[m
[31m-[m
[31m-[m
[31m-                            }[m
[31m-                            else[m
[31m-                            {[m
[31m-                                DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                            }[m
[31m-                            return;[m
[31m-                        }[m
[31m-                        if (((getDirectory) && (!isDirectory)) || ((!getDirectory) && (!isFile)))[m
[31m-                        {[m
[31m-                            DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, TYPE_MISMATCH_ERR), callbackId);[m
[31m-                            return;[m
[31m-                        }[m
[31m-                    }[m
[31m-                    FileEntry entry = FileEntry.GetEntry(path);[m
[31m-                    if (entry != null)[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.OK, entry), callbackId);[m
[31m-                    }[m
[31m-                    else[m
[31m-                    {[m
[31m-                        DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NOT_FOUND_ERR), callbackId);[m
[31m-                    }[m
[31m-                }[m
[31m-            }[m
[31m-            catch (Exception ex)[m
[31m-            {[m
[31m-                if (!this.HandleException(ex))[m
[31m-                {[m
[31m-                    DispatchCommandResult(new PluginResult(PluginResult.Status.ERROR, NO_MODIFICATION_ALLOWED_ERR), callbackId);[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        private static string AddSlashToDirectory(string dirPath)[m
[31m-        {[m
[31m-            if (dirPath.EndsWith("/"))[m
[31m-            {[m
[31m-                return dirPath;[m
[31m-            }[m
[31m-            else[m
[31m-            {[m
[31m-                return dirPath + "/";[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Returns file content in a form of base64 string[m
[31m-        /// </summary>[m
[31m-        /// <param name="stream">File stream</param>[m
[31m-        /// <returns>Base64 representation of the file</returns>[m
[31m-        private string GetFileContent(Stream stream)[m
[31m-        {[m
[31m-            int streamLength = (int)stream.Length;[m
[31m-            byte[] fileData = new byte[streamLength + 1];[m
[31m-            stream.Read(fileData, 0, streamLength);[m
[31m-            stream.Close();[m
[31m-            return Convert.ToBase64String(fileData);[m
[31m-        }[m
[31m-[m
[31m-        #endregion[m
[31m-[m
[31m-    }[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/tests/plugin.xml b/cordova_exchange_dist/plugins/cordova-plugin-file/tests/plugin.xml[m
[1mindex 29e531f..9074699 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/tests/plugin.xml[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/tests/plugin.xml[m
[36m@@ -22,7 +22,7 @@[m
     xmlns:rim="http://www.blackberry.com/ns/widgets"[m
     xmlns:android="http://schemas.android.com/apk/res/android"[m
     id="cordova-plugin-file-tests"[m
[31m-    version="4.3.1">[m
[32m+[m[32m    version="6.0.1">[m
 [m
     <name>Cordova File Plugin Tests</name>[m
     <license>Apache 2.0</license>[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/tests/tests.js b/cordova_exchange_dist/plugins/cordova-plugin-file/tests/tests.js[m
[1mindex acdcfa0..a9ae20a 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/tests/tests.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/tests/tests.js[m
[36m@@ -18,80 +18,81 @@[m
  *[m
  */[m
 [m
[31m-/* jshint jasmine: true */[m
[32m+[m[32m/* eslint-env jasmine */[m
 /* global WebKitBlobBuilder */[m
 [m
 exports.defineAutoTests = function () {[m
[31m-    var isBrowser = (cordova.platformId === "browser");[m
[32m+[m[32m    /* eslint-disable no-undef */[m
[32m+[m[32m    var isBrowser = (cordova.platformId === 'browser');[m
     // Use feature detection to determine current browser instead of checking user-agent[m
     var isChrome = isBrowser && window.webkitRequestFileSystem && window.webkitResolveLocalFileSystemURL;[m
     var isIE = isBrowser && (window.msIndexedDB);[m
     var isIndexedDBShim = isBrowser && !isChrome;   // Firefox and IE for example[m
 [m
[31m-    var isWindows = (cordova.platformId === "windows" || cordova.platformId === "windows8");[m
[31m-[m
[32m+[m[32m    var isWindows = (cordova.platformId === 'windows' || cordova.platformId === 'windows8');[m
[32m+[m[32m    /* eslint-enable no-undef */[m
     var MEDIUM_TIMEOUT = 15000;[m
 [m
     describe('File API', function () {[m
         // Adding a Jasmine helper matcher, to report errors when comparing to FileError better.[m
         var fileErrorMap = {[m
[31m-            1 : 'NOT_FOUND_ERR',[m
[31m-            2 : 'SECURITY_ERR',[m
[31m-            3 : 'ABORT_ERR',[m
[31m-            4 : 'NOT_READABLE_ERR',[m
[31m-            5 : 'ENCODING_ERR',[m
[31m-            6 : 'NO_MODIFICATION_ALLOWED_ERR',[m
[31m-            7 : 'INVALID_STATE_ERR',[m
[31m-            8 : 'SYNTAX_ERR',[m
[31m-            9 : 'INVALID_MODIFICATION_ERR',[m
[31m-            10 : 'QUOTA_EXCEEDED_ERR',[m
[31m-            11 : 'TYPE_MISMATCH_ERR',[m
[31m-            12 : 'PATH_EXISTS_ERR'[m
[31m-        },[m
[31m-        root,[m
[31m-        temp_root,[m
[31m-        persistent_root;[m
[32m+[m[32m            1: 'NOT_FOUND_ERR',[m
[32m+[m[32m            2: 'SECURITY_ERR',[m
[32m+[m[32m            3: 'ABORT_ERR',[m
[32m+[m[32m            4: 'NOT_READABLE_ERR',[m
[32m+[m[32m            5: 'ENCODING_ERR',[m
[32m+[m[32m            6: 'NO_MODIFICATION_ALLOWED_ERR',[m
[32m+[m[32m            7: 'INVALID_STATE_ERR',[m
[32m+[m[32m            8: 'SYNTAX_ERR',[m
[32m+[m[32m            9: 'INVALID_MODIFICATION_ERR',[m
[32m+[m[32m            10: 'QUOTA_EXCEEDED_ERR',[m
[32m+[m[32m            11: 'TYPE_MISMATCH_ERR',[m
[32m+[m[32m            12: 'PATH_EXISTS_ERR'[m
[32m+[m[32m        };[m
[32m+[m[32m        var root;[m
[32m+[m[32m        var temp_root;[m
[32m+[m[32m        var persistent_root;[m
         beforeEach(function (done) {[m
             // Custom Matchers[m
             jasmine.Expectation.addMatchers({[m
[31m-                toBeFileError : function () {[m
[32m+[m[32m                toBeFileError: function () {[m
                     return {[m
[31m-                        compare : function (error, code) {[m
[32m+[m[32m                        compare: function (error, code) {[m
                             var pass = error.code === code;[m
                             return {[m
[31m-                                pass : pass,[m
[31m-                                message : 'Expected FileError with code ' + fileErrorMap[error.code] + ' (' + error.code + ') to be ' + fileErrorMap[code] + '(' + code + ')'[m
[32m+[m[32m                                pass: pass,[m
[32m+[m[32m                                message: 'Expected FileError with code ' + fileErrorMap[error.code] + ' (' + error.code + ') to be ' + fileErrorMap[code] + '(' + code + ')'[m
                             };[m
                         }[m
                     };[m
                 },[m
[31m-                toCanonicallyMatch : function () {[m
[32m+[m[32m                toCanonicallyMatch: function () {[m
                     return {[m
[31m-                        compare : function (currentPath, path) {[m
[31m-                            var a = path.split("/").join("").split("\\").join(""),[m
[31m-                            b = currentPath.split("/").join("").split("\\").join(""),[m
[31m-                            pass = a === b;[m
[32m+[m[32m                        compare: function (currentPath, path) {[m
[32m+[m[32m                            var a = path.split('/').join('').split('\\').join('');[m
[32m+[m[32m                            var b = currentPath.split('/').join('').split('\\').join('');[m
[32m+[m[32m                            var pass = a === b;[m
                             return {[m
[31m-                                pass : pass,[m
[31m-                                message : 'Expected paths to match : ' + path + ' should be ' + currentPath[m
[32m+[m[32m                                pass: pass,[m
[32m+[m[32m                                message: 'Expected paths to match : ' + path + ' should be ' + currentPath[m
                             };[m
                         }[m
                     };[m
                 },[m
[31m-                toFailWithMessage : function () {[m
[32m+[m[32m                toFailWithMessage: function () {[m
                     return {[m
[31m-                        compare : function (error, message) {[m
[32m+[m[32m                        compare: function (error, message) { // eslint-disable-line handle-callback-err[m
                             var pass = false;[m
                             return {[m
[31m-                                pass : pass,[m
[31m-                                message : message[m
[32m+[m[32m                                pass: pass,[m
[32m+[m[32m                                message: message[m
                             };[m
                         }[m
                     };[m
                 },[m
                 toBeDataUrl: function () {[m
                     return {[m
[31m-                        compare : function (url) {[m
[32m+[m[32m                        compare: function (url) {[m
                             var pass = false;[m
                             // "data:application/octet-stream;base64,"[m
                             var header = url.substr(0, url.indexOf(','));[m
[36m@@ -103,23 +104,23 @@[m [mexports.defineAutoTests = function () {[m
                             }[m
                             var message = 'Expected ' + url + ' to be a valid data url. ' + header + ' is not valid header for data uris';[m
                             return {[m
[31m-                                pass : pass,[m
[31m-                                message : message[m
[32m+[m[32m                                pass: pass,[m
[32m+[m[32m                                message: message[m
                             };[m
                         }[m
                     };[m
                 }[m
             });[m
[31m-            //Define global variables[m
[32m+[m[32m            // Define global variables[m
             var onError = function (e) {[m
                 console.log('[ERROR] Problem setting up root filesystem for test running! Error to follow.');[m
                 console.log(JSON.stringify(e));[m
             };[m
[31m-            window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function (fileSystem) {[m
[32m+[m[32m            window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function (fileSystem) { // eslint-disable-line no-undef[m
                 root = fileSystem.root;[m
                 // set in file.tests.js[m
                 persistent_root = root;[m
[31m-                window.requestFileSystem(LocalFileSystem.TEMPORARY, 0, function (fileSystem) {[m
[32m+[m[32m                window.requestFileSystem(LocalFileSystem.TEMPORARY, 0, function (fileSystem) { // eslint-disable-line no-undef[m
                     temp_root = fileSystem.root;[m
                     // set in file.tests.js[m
                     done();[m
[36m@@ -131,7 +132,7 @@[m [mexports.defineAutoTests = function () {[m
         var deleteEntry = function (name, success, error) {[m
             // deletes entry, if it exists[m
             // entry.remove success callback is required: http://www.w3.org/TR/2011/WD-file-system-api-20110419/#the-entry-interface[m
[31m-            success = success || function() {};[m
[32m+[m[32m            success = success || function () {};[m
             error = error || failed.bind(null, success, 'deleteEntry failed.');[m
 [m
             window.resolveLocalFileSystemURL(root.toURL() + '/' + name, function (entry) {[m
[36m@@ -145,21 +146,21 @@[m [mexports.defineAutoTests = function () {[m
         // deletes file, if it exists, then invokes callback[m
         var deleteFile = function (fileName, callback) {[m
             // entry.remove success callback is required: http://www.w3.org/TR/2011/WD-file-system-api-20110419/#the-entry-interface[m
[31m-            callback = callback || function() {};[m
[32m+[m[32m            callback = callback || function () {};[m
 [m
             root.getFile(fileName, null, // remove file system entry[m
                 function (entry) {[m
[31m-                entry.remove(callback, function () {[m
[31m-                    console.log('[ERROR] deleteFile cleanup method invoked fail callback.');[m
[31m-                });[m
[31m-            }, // doesn't exist[m
[32m+[m[32m                    entry.remove(callback, function () {[m
[32m+[m[32m                        console.log('[ERROR] deleteFile cleanup method invoked fail callback.');[m
[32m+[m[32m                    });[m
[32m+[m[32m                }, // doesn't exist[m
                 callback);[m
         };[m
         // deletes and re-creates the specified file[m
         var createFile = function (fileName, success, error) {[m
             deleteEntry(fileName, function () {[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, success, error);[m
             }, error);[m
         };[m
[36m@@ -167,18 +168,18 @@[m [mexports.defineAutoTests = function () {[m
         var createDirectory = function (dirName, success, error) {[m
             deleteEntry(dirName, function () {[m
                 root.getDirectory(dirName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, success, error);[m
             }, error);[m
         };[m
[31m-        function failed(done, msg, error) {[m
[31m-            var info = typeof msg == 'undefined' ? 'Unexpected error callback' : msg;[m
[32m+[m[32m        function failed (done, msg, error) {[m
[32m+[m[32m            var info = typeof msg === 'undefined' ? 'Unexpected error callback' : msg;[m
             var codeMsg = (error && error.code) ? (': ' + fileErrorMap[error.code]) : '';[m
             expect(true).toFailWithMessage(info + '\n' + JSON.stringify(error) + codeMsg);[m
             done();[m
         }[m
         var succeed = function (done, msg) {[m
[31m-            var info = typeof msg == 'undefined' ? 'Unexpected success callback' : msg;[m
[32m+[m[32m            var info = typeof msg === 'undefined' ? 'Unexpected success callback' : msg;[m
             expect(true).toFailWithMessage(info);[m
             done();[m
         };[m
[36m@@ -192,7 +193,8 @@[m [mexports.defineAutoTests = function () {[m
             return base + extension;[m
         };[m
         describe('FileError object', function () {[m
[31m-            it("file.spec.1 should define FileError constants", function () {[m
[32m+[m[32m            /* eslint-disable no-undef */[m
[32m+[m[32m            it('file.spec.1 should define FileError constants', function () {[m
                 expect(FileError.NOT_FOUND_ERR).toBe(1);[m
                 expect(FileError.SECURITY_ERR).toBe(2);[m
                 expect(FileError.ABORT_ERR).toBe(3);[m
[36m@@ -208,22 +210,23 @@[m [mexports.defineAutoTests = function () {[m
             });[m
         });[m
         describe('LocalFileSystem', function () {[m
[31m-            it("file.spec.2 should define LocalFileSystem constants", function () {[m
[32m+[m[32m            it('file.spec.2 should define LocalFileSystem constants', function () {[m
                 expect(LocalFileSystem.TEMPORARY).toBe(0);[m
                 expect(LocalFileSystem.PERSISTENT).toBe(1);[m
[32m+[m[32m                /* eslint-enable no-undef */[m
             });[m
             describe('window.requestFileSystem', function () {[m
[31m-                it("file.spec.3 should be defined", function () {[m
[32m+[m[32m                it('file.spec.3 should be defined', function () {[m
                     expect(window.requestFileSystem).toBeDefined();[m
                 });[m
[31m-                it("file.spec.4 should be able to retrieve a PERSISTENT file system", function (done) {[m
[32m+[m[32m                it('file.spec.4 should be able to retrieve a PERSISTENT file system', function (done) {[m
                     var win = function (fileSystem) {[m
                         expect(fileSystem).toBeDefined();[m
                         expect(fileSystem.name).toBeDefined();[m
                         if (isChrome) {[m
[31m-                            expect(fileSystem.name).toContain("Persistent");[m
[32m+[m[32m                            expect(fileSystem.name).toContain('Persistent');[m
                         } else {[m
[31m-                            expect(fileSystem.name).toBe("persistent");[m
[32m+[m[32m                            expect(fileSystem.name).toBe('persistent');[m
                         }[m
                         expect(fileSystem.root).toBeDefined();[m
                         expect(fileSystem.root.filesystem).toBeDefined();[m
[36m@@ -238,54 +241,54 @@[m [mexports.defineAutoTests = function () {[m
                     var spaceRequired = isBrowser ? 0 : 1024;[m
 [m
                     // retrieve PERSISTENT file system[m
[31m-                    window.requestFileSystem(LocalFileSystem.PERSISTENT, spaceRequired, win, failed.bind(null, done, 'window.requestFileSystem - Error retrieving PERSISTENT file system'));[m
[32m+[m[32m                    window.requestFileSystem(LocalFileSystem.PERSISTENT, spaceRequired, win, failed.bind(null, done, 'window.requestFileSystem - Error retrieving PERSISTENT file system')); // eslint-disable-line no-undef[m
                 });[m
[31m-                it("file.spec.5 should be able to retrieve a TEMPORARY file system", function (done) {[m
[32m+[m[32m                it('file.spec.5 should be able to retrieve a TEMPORARY file system', function (done) {[m
                     var win = function (fileSystem) {[m
                         expect(fileSystem).toBeDefined();[m
                         if (isChrome) {[m
[31m-                            expect(fileSystem.name).toContain("Temporary");[m
[32m+[m[32m                            expect(fileSystem.name).toContain('Temporary');[m
                         } else {[m
[31m-                            expect(fileSystem.name).toBe("temporary");[m
[32m+[m[32m                            expect(fileSystem.name).toBe('temporary');[m
                         }[m
                         expect(fileSystem.root).toBeDefined();[m
                         expect(fileSystem.root.filesystem).toBeDefined();[m
                         expect(fileSystem.root.filesystem).toBe(fileSystem);[m
                         done();[m
                     };[m
[31m-                    //retrieve TEMPORARY file system[m
[31m-                    window.requestFileSystem(LocalFileSystem.TEMPORARY, 0, win, failed.bind(null, done, 'window.requestFileSystem - Error retrieving TEMPORARY file system'));[m
[32m+[m[32m                    // retrieve TEMPORARY file system[m
[32m+[m[32m                    window.requestFileSystem(LocalFileSystem.TEMPORARY, 0, win, failed.bind(null, done, 'window.requestFileSystem - Error retrieving TEMPORARY file system')); // eslint-disable-line no-undef[m
                 });[m
[31m-                it("file.spec.6 should error if you request a file system that is too large", function (done) {[m
[32m+[m[32m                it('file.spec.6 should error if you request a file system that is too large', function (done) {[m
                     if (isBrowser) {[m
[31m-                        /*window.requestFileSystem TEMPORARY and PERSISTENT filesystem quota is not limited in Chrome.[m
[32m+[m[32m                        /* window.requestFileSystem TEMPORARY and PERSISTENT filesystem quota is not limited in Chrome.[m
                         Firefox filesystem size is not limited but every 50MB request user permission.[m
                         IE10 allows up to 10mb of combined AppCache and IndexedDB used in implementation[m
                         of filesystem without prompting, once you hit that level you will be asked if you[m
                         want to allow it to be increased up to a max of 250mb per site.[m
[31m-                        So `size` parameter for `requestFileSystem` function does not affect on filesystem in Firefox and IE.*/[m
[32m+[m[32m                        So `size` parameter for `requestFileSystem` function does not affect on filesystem in Firefox and IE. */[m
                         pending();[m
                     }[m
 [m
                     var fail = function (error) {[m
                         expect(error).toBeDefined();[m
[31m-                        expect(error).toBeFileError(FileError.QUOTA_EXCEEDED_ERR);[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.QUOTA_EXCEEDED_ERR); // eslint-disable-line no-undef[m
                         done();[m
                     };[m
[31m-                    //win = createWin('window.requestFileSystem');[m
[32m+[m[32m                    // win = createWin('window.requestFileSystem');[m
                     // Request the file system[m
[31m-                    window.requestFileSystem(LocalFileSystem.TEMPORARY, 1000000000000000, failed.bind(null, done, 'window.requestFileSystem - Error retrieving TEMPORARY file system'), fail);[m
[32m+[m[32m                    window.requestFileSystem(LocalFileSystem.TEMPORARY, 1000000000000000, failed.bind(null, done, 'window.requestFileSystem - Error retrieving TEMPORARY file system'), fail); // eslint-disable-line no-undef[m
                 });[m
[31m-                it("file.spec.7 should error out if you request a file system that does not exist", function (done) {[m
[32m+[m[32m                it('file.spec.7 should error out if you request a file system that does not exist', function (done) {[m
 [m
                     var fail = function (error) {[m
                         expect(error).toBeDefined();[m
                         if (isChrome) {[m
[31m-                            /*INVALID_MODIFICATION_ERR (code: 9) is thrown instead of SYNTAX_ERR(code: 8)[m
[31m-                            on requesting of a non-existant filesystem.*/[m
[31m-                            expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                            /* INVALID_MODIFICATION_ERR (code: 9) or ??? (code: 13) is thrown instead of SYNTAX_ERR(code: 8)[m
[32m+[m[32m                            on requesting of a non-existant filesystem. */[m
[32m+[m[32m                            // expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
                         } else {[m
[31m-                            expect(error).toBeFileError(FileError.SYNTAX_ERR);[m
[32m+[m[32m                            expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
                         }[m
                         done();[m
                     };[m
[36m@@ -294,10 +297,10 @@[m [mexports.defineAutoTests = function () {[m
                 });[m
             });[m
             describe('window.resolveLocalFileSystemURL', function () {[m
[31m-                it("file.spec.8 should be defined", function () {[m
[32m+[m[32m                it('file.spec.8 should be defined', function () {[m
                     expect(window.resolveLocalFileSystemURL).toBeDefined();[m
                 });[m
[31m-                it("file.spec.9 should resolve a valid file name", function (done) {[m
[32m+[m[32m                it('file.spec.9 should resolve a valid file name', function (done) {[m
                     var fileName = 'file.spec.9';[m
                     var win = function (fileEntry) {[m
                         expect(fileEntry).toBeDefined();[m
[36m@@ -313,7 +316,7 @@[m [mexports.defineAutoTests = function () {[m
                         window.resolveLocalFileSystemURL(entry.toURL(), win, failed.bind(null, done, 'window.resolveLocalFileSystemURL - Error resolving file URL: ' + entry.toURL()));[m
                     }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName), failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
                 });[m
[31m-                it("file.spec.9.1 should resolve a file even with a terminating slash", function (done) {[m
[32m+[m[32m                it('file.spec.9.1 should resolve a file even with a terminating slash', function (done) {[m
                     var fileName = 'file.spec.9.1';[m
                     var win = function (fileEntry) {[m
                         expect(fileEntry).toBeDefined();[m
[36m@@ -330,7 +333,7 @@[m [mexports.defineAutoTests = function () {[m
                         window.resolveLocalFileSystemURL(entryURL, win, failed.bind(null, done, 'window.resolveLocalFileSystemURL - Error resolving file URL: ' + entryURL));[m
                     }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName), failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
                 });[m
[31m-                it("file.spec.9.5 should resolve a directory", function (done) {[m
[32m+[m[32m                it('file.spec.9.5 should resolve a directory', function (done) {[m
                     var fileName = 'file.spec.9.5';[m
                     var win = function (fileEntry) {[m
                         expect(fileEntry).toBeDefined();[m
[36m@@ -342,13 +345,13 @@[m [mexports.defineAutoTests = function () {[m
                         // cleanup[m
                         deleteEntry(fileName, done);[m
                     };[m
[31m-                    function gotDirectory(entry) {[m
[32m+[m[32m                    function gotDirectory (entry) {[m
                         // lookup file system entry[m
                         window.resolveLocalFileSystemURL(entry.toURL(), win, failed.bind(null, done, 'window.resolveLocalFileSystemURL - Error resolving directory URL: ' + entry.toURL()));[m
                     }[m
                     createDirectory(fileName, gotDirectory, failed.bind(null, done, 'createDirectory - Error creating directory: ' + fileName), failed.bind(null, done, 'createDirectory - Error creating directory: ' + fileName));[m
                 });[m
[31m-                it("file.spec.9.6 should resolve a directory even without a terminating slash", function (done) {[m
[32m+[m[32m                it('file.spec.9.6 should resolve a directory even without a terminating slash', function (done) {[m
                     var fileName = 'file.spec.9.6';[m
                     var win = function (fileEntry) {[m
                         expect(fileEntry).toBeDefined();[m
[36m@@ -360,7 +363,7 @@[m [mexports.defineAutoTests = function () {[m
                         // cleanup[m
                         deleteEntry(fileName, done);[m
                     };[m
[31m-                    function gotDirectory(entry) {[m
[32m+[m[32m                    function gotDirectory (entry) {[m
                         // lookup file system entry[m
                         var entryURL = entry.toURL();[m
                         entryURL = entryURL.substring(0, entryURL.length - 1);[m
[36m@@ -369,9 +372,12 @@[m [mexports.defineAutoTests = function () {[m
                     createDirectory(fileName, gotDirectory, failed.bind(null, done, 'createDirectory - Error creating directory: ' + fileName), failed.bind(null, done, 'createDirectory - Error creating directory: ' + fileName));[m
                 });[m
 [m
[31m-                it("file.spec.9.7 should resolve a file with valid nativeURL", function (done) {[m
[31m-                    var fileName = "de.create.file",[m
[31m-                    win = function (entry) {[m
[32m+[m[32m                it('file.spec.9.7 should resolve a file with valid nativeURL', function (done) {[m
[32m+[m[32m                    if (isBrowser) {[m
[32m+[m[32m                        pending('browsers doesn\'t return nativeURL');[m
[32m+[m[32m                    }[m
[32m+[m[32m                    var fileName = 'de.create.file';[m
[32m+[m[32m                    var win = function (entry) {[m
                         var path = entry.nativeURL.split('///')[1];[m
                         expect(/\/{2,}/.test(path)).toBeFalsy();[m
                         // cleanup[m
[36m@@ -382,12 +388,12 @@[m [mexports.defineAutoTests = function () {[m
                     }, win, succeed.bind(null, done, 'root.getFile - Error unexpected callback, file should not exists: ' + fileName));[m
                 });[m
 [m
[31m-                it("file.spec.10 resolve valid file name with parameters", function (done) {[m
[31m-                    var fileName = "resolve.file.uri.params",[m
[31m-                    win = function (fileEntry) {[m
[32m+[m[32m                it('file.spec.10 resolve valid file name with parameters', function (done) {[m
[32m+[m[32m                    var fileName = 'resolve.file.uri.params';[m
[32m+[m[32m                    var win = function (fileEntry) {[m
                         expect(fileEntry).toBeDefined();[m
[31m-                        if (fileEntry.toURL().toLowerCase().substring(0, 10) === "cdvfile://") {[m
[31m-                            expect(fileEntry.fullPath).toBe("/" + fileName + "?1234567890");[m
[32m+[m[32m                        if (fileEntry.toURL().toLowerCase().substring(0, 10) === 'cdvfile://') {[m
[32m+[m[32m                            expect(fileEntry.fullPath).toBe('/' + fileName + '?1234567890');[m
                         }[m
                         expect(fileEntry.name).toBe(fileName);[m
                         // cleanup[m
[36m@@ -395,24 +401,32 @@[m [mexports.defineAutoTests = function () {[m
                     };[m
                     // create a new file entry[m
                     createFile(fileName, function (entry) {[m
[31m-                        window.resolveLocalFileSystemURL(entry.toURL() + "?1234567890", win, failed.bind(null, done, 'window.resolveLocalFileSystemURL - Error resolving file URI: ' + entry.toURL()));[m
[32m+[m[32m                        window.resolveLocalFileSystemURL(entry.toURL() + '?1234567890', win, failed.bind(null, done, 'window.resolveLocalFileSystemURL - Error resolving file URI: ' + entry.toURL()));[m
                     }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
                 });[m
[31m-                it("file.spec.11 should error (NOT_FOUND_ERR) when resolving (non-existent) invalid file name", function (done) {[m
[31m-                    var fileName = cordova.platformId === 'windowsphone' ? root.toURL() + "/" + "this.is.not.a.valid.file.txt" : joinURL(root.toURL(), "this.is.not.a.valid.file.txt"),[m
[31m-                        fail = function (error) {[m
[32m+[m[32m                it('file.spec.11 should error (NOT_FOUND_ERR) when resolving (non-existent) invalid file name', function (done) {[m
[32m+[m[32m                    var fileName = cordova.platformId === 'windowsphone' ? root.toURL() + '/' + 'this.is.not.a.valid.file.txt' : joinURL(root.toURL(), 'this.is.not.a.valid.file.txt'); // eslint-disable-line no-undef[m
[32m+[m[32m                    var fail = function (error) {[m
                         expect(error).toBeDefined();[m
[31m-                        expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                        if (isChrome) {[m
[32m+[m[32m                            expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                        }[m
                         done();[m
                     };[m
                     // lookup file system entry[m
                     window.resolveLocalFileSystemURL(fileName, succeed.bind(null, done, 'window.resolveLocalFileSystemURL - Error unexpected callback resolving file URI: ' + fileName), fail);[m
                 });[m
[31m-                it("file.spec.12 should error (ENCODING_ERR) when resolving invalid URI with leading /", function (done) {[m
[31m-                    var fileName = "/this.is.not.a.valid.url",[m
[31m-                        fail = function (error) {[m
[32m+[m[32m                it('file.spec.12 should error (ENCODING_ERR) when resolving invalid URI with leading /', function (done) {[m
[32m+[m[32m                    var fileName = '/this.is.not.a.valid.url';[m
[32m+[m[32m                    var fail = function (error) {[m
                         expect(error).toBeDefined();[m
[31m-                        expect(error).toBeFileError(FileError.ENCODING_ERR);[m
[32m+[m[32m                        if (isChrome) {[m
[32m+[m[32m                        // O.o chrome returns error code 0[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            expect(error).toBeFileError(FileError.ENCODING_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                        }[m
                         done();[m
                     };[m
                     // lookup file system entry[m
[36m@@ -420,17 +434,17 @@[m [mexports.defineAutoTests = function () {[m
                 });[m
             });[m
         });[m
[31m-        //LocalFileSystem[m
[32m+[m[32m        // LocalFileSystem[m
         describe('Metadata interface', function () {[m
[31m-            it("file.spec.13 should exist and have the right properties", function () {[m
[31m-                var metadata = new Metadata();[m
[32m+[m[32m            it('file.spec.13 should exist and have the right properties', function () {[m
[32m+[m[32m                var metadata = new Metadata(); // eslint-disable-line no-undef[m
                 expect(metadata).toBeDefined();[m
                 expect(metadata.modificationTime).toBeDefined();[m
             });[m
         });[m
         describe('Flags interface', function () {[m
[31m-            it("file.spec.14 should exist and have the right properties", function () {[m
[31m-                var flags = new Flags(false, true);[m
[32m+[m[32m            it('file.spec.14 should exist and have the right properties', function () {[m
[32m+[m[32m                var flags = new Flags(false, true); // eslint-disable-line no-undef[m
                 expect(flags).toBeDefined();[m
                 expect(flags.create).toBeDefined();[m
                 expect(flags.create).toBe(false);[m
[36m@@ -439,7 +453,7 @@[m [mexports.defineAutoTests = function () {[m
             });[m
         });[m
         describe('FileSystem interface', function () {[m
[31m-            it("file.spec.15 should have a root that is a DirectoryEntry", function (done) {[m
[32m+[m[32m            it('file.spec.15 should have a root that is a DirectoryEntry', function (done) {[m
                 var win = function (entry) {[m
                     expect(entry).toBeDefined();[m
                     expect(entry.isFile).toBe(false);[m
[36m@@ -462,22 +476,26 @@[m [mexports.defineAutoTests = function () {[m
             });[m
         });[m
         describe('DirectoryEntry', function () {[m
[31m-            it("file.spec.16 getFile: get Entry for file that does not exist", function (done) {[m
[31m-                var fileName = "de.no.file",[m
[31m-                fail = function (error) {[m
[32m+[m[32m            it('file.spec.16 getFile: get Entry for file that does not exist', function (done) {[m
[32m+[m[32m                var fileName = 'de.no.file';[m
[32m+[m[32m                var fail = function (error) {[m
                     expect(error).toBeDefined();[m
[31m-                    expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                    if (isChrome) {[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                    }[m
                     done();[m
                 };[m
                 // create:false, exclusive:false, file does not exist[m
                 root.getFile(fileName, {[m
[31m-                    create : false[m
[32m+[m[32m                    create: false[m
                 }, succeed.bind(null, done, 'root.getFile - Error unexpected callback, file should not exists: ' + fileName), fail);[m
             });[m
[31m-            it("file.spec.17 getFile: create new file", function (done) {[m
[31m-                var fileName = "de.create.file",[m
[31m-                filePath = joinURL(root.fullPath, fileName),[m
[31m-                win = function (entry) {[m
[32m+[m[32m            it('file.spec.17 getFile: create new file', function (done) {[m
[32m+[m[32m                var fileName = 'de.create.file';[m
[32m+[m[32m                var filePath = joinURL(root.fullPath, fileName);[m
[32m+[m[32m                var win = function (entry) {[m
                     expect(entry).toBeDefined();[m
                     expect(entry.isFile).toBe(true);[m
                     expect(entry.isDirectory).toBe(false);[m
[36m@@ -488,13 +506,13 @@[m [mexports.defineAutoTests = function () {[m
                 };[m
                 // create:true, exclusive:false, file does not exist[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, win, succeed.bind(null, done, 'root.getFile - Error unexpected callback, file should not exists: ' + fileName));[m
             });[m
[31m-            it("file.spec.18 getFile: create new file (exclusive)", function (done) {[m
[31m-                var fileName = "de.create.exclusive.file",[m
[31m-                filePath = joinURL(root.fullPath, fileName),[m
[31m-                win = function (entry) {[m
[32m+[m[32m            it('file.spec.18 getFile: create new file (exclusive)', function (done) {[m
[32m+[m[32m                var fileName = 'de.create.exclusive.file';[m
[32m+[m[32m                var filePath = joinURL(root.fullPath, fileName);[m
[32m+[m[32m                var win = function (entry) {[m
                     expect(entry).toBeDefined();[m
                     expect(entry.isFile).toBe(true);[m
                     expect(entry.isDirectory).toBe(false);[m
[36m@@ -505,15 +523,15 @@[m [mexports.defineAutoTests = function () {[m
                 };[m
                 // create:true, exclusive:true, file does not exist[m
                 root.getFile(fileName, {[m
[31m-                    create : true,[m
[31m-                    exclusive : true[m
[32m+[m[32m                    create: true,[m
[32m+[m[32m                    exclusive: true[m
                 }, win, failed.bind(null, done, 'root.getFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.19 getFile: create file that already exists", function (done) {[m
[31m-                var fileName = "de.create.existing.file",[m
[31m-                filePath = joinURL(root.fullPath, fileName);[m
[32m+[m[32m            it('file.spec.19 getFile: create file that already exists', function (done) {[m
[32m+[m[32m                var fileName = 'de.create.existing.file';[m
[32m+[m[32m                var filePath = joinURL(root.fullPath, fileName);[m
 [m
[31m-                function win(entry) {[m
[32m+[m[32m                function win (entry) {[m
                     expect(entry).toBeDefined();[m
                     expect(entry.isFile).toBe(true);[m
                     expect(entry.isDirectory).toBe(false);[m
[36m@@ -523,53 +541,53 @@[m [mexports.defineAutoTests = function () {[m
                     deleteEntry(entry.name, done);[m
                 }[m
 [m
[31m-                function getFile(file) {[m
[32m+[m[32m                function getFile (file) {[m
                     // create:true, exclusive:false, file exists[m
                     root.getFile(fileName, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, win, failed.bind(null, done, 'root.getFile - Error creating file: ' + fileName));[m
                 }[m
 [m
                 // create file to kick off it[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, getFile, failed.bind(null, done, 'root.getFile - Error on initial creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.20 getFile: create file that already exists (exclusive)", function (done) {[m
[31m-                var fileName = "de.create.exclusive.existing.file",[m
[31m-                existingFile;[m
[32m+[m[32m            it('file.spec.20 getFile: create file that already exists (exclusive)', function (done) {[m
[32m+[m[32m                var fileName = 'de.create.exclusive.existing.file';[m
[32m+[m[32m                var existingFile;[m
 [m
[31m-                function fail(error) {[m
[32m+[m[32m                function fail (error) {[m
                     expect(error).toBeDefined();[m
                     if (isChrome) {[m
[31m-                        /*INVALID_MODIFICATION_ERR (code: 9) is thrown instead of PATH_EXISTS_ERR(code: 12)[m
[31m-                        on trying to exclusively create a file, which already exists in Chrome.*/[m
[31m-                        expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                        /* INVALID_MODIFICATION_ERR (code: 9) or ??? (code: 13) is thrown instead of PATH_EXISTS_ERR(code: 12)[m
[32m+[m[32m                        on trying to exclusively create a file, which already exists in Chrome. */[m
[32m+[m[32m                        // expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
                     } else {[m
[31m-                        expect(error).toBeFileError(FileError.PATH_EXISTS_ERR);[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.PATH_EXISTS_ERR); // eslint-disable-line no-undef[m
                     }[m
                     // cleanup[m
                     deleteEntry(existingFile.name, done);[m
                 }[m
 [m
[31m-                function getFile(file) {[m
[32m+[m[32m                function getFile (file) {[m
                     existingFile = file;[m
                     // create:true, exclusive:true, file exists[m
                     root.getFile(fileName, {[m
[31m-                        create : true,[m
[31m-                        exclusive : true[m
[32m+[m[32m                        create: true,[m
[32m+[m[32m                        exclusive: true[m
                     }, succeed.bind(null, done, 'root.getFile - getFile function - Error unexpected callback, file should exists: ' + fileName), fail);[m
                 }[m
 [m
                 // create file to kick off it[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, getFile, failed.bind(null, done, 'root.getFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.21 DirectoryEntry.getFile: get Entry for existing file", function (done) {[m
[31m-                var fileName = "de.get.file",[m
[31m-                filePath = joinURL(root.fullPath, fileName),[m
[31m-                win = function (entry) {[m
[32m+[m[32m            it('file.spec.21 DirectoryEntry.getFile: get Entry for existing file', function (done) {[m
[32m+[m[32m                var fileName = 'de.get.file';[m
[32m+[m[32m                var filePath = joinURL(root.fullPath, fileName);[m
[32m+[m[32m                var win = function (entry) {[m
                     expect(entry).toBeDefined();[m
                     expect(entry.isFile).toBe(true);[m
                     expect(entry.isDirectory).toBe(false);[m
[36m@@ -577,54 +595,58 @@[m [mexports.defineAutoTests = function () {[m
                     expect(entry.fullPath).toCanonicallyMatch(filePath);[m
                     expect(entry.filesystem).toBeDefined();[m
                     expect(entry.filesystem).toBe(root.filesystem);[m
[31m-                    //clean up[m
[32m+[m[32m                    // clean up[m
                     deleteEntry(entry.name, done);[m
[31m-                },[m
[31m-                getFile = function (file) {[m
[32m+[m[32m                };[m
[32m+[m[32m                var getFile = function (file) {[m
                     // create:false, exclusive:false, file exists[m
                     root.getFile(fileName, {[m
[31m-                        create : false[m
[32m+[m[32m                        create: false[m
                     }, win, failed.bind(null, done, 'root.getFile - Error getting file entry: ' + fileName));[m
                 };[m
                 // create file to kick off it[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, getFile, failed.bind(null, done, 'root.getFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.22 DirectoryEntry.getFile: get FileEntry for invalid path", function (done) {[m
[32m+[m[32m            it('file.spec.22 DirectoryEntry.getFile: get FileEntry for invalid path', function (done) {[m
                 if (isBrowser) {[m
[31m-                    /*The plugin does not follow to ["8.3 Naming restrictions"][m
[31m-                    (http://www.w3.org/TR/2011/WD-file-system-api-20110419/#naming-restrictions).*/[m
[32m+[m[32m                    /* The plugin does not follow to ["8.3 Naming restrictions"][m
[32m+[m[32m                    (http://www.w3.org/TR/2011/WD-file-system-api-20110419/#naming-restrictions). */[m
                     pending();[m
                 }[m
 [m
[31m-                var fileName = "de:invalid:path",[m
[31m-                fail = function (error) {[m
[32m+[m[32m                var fileName = 'de:invalid:path';[m
[32m+[m[32m                var fail = function (error) {[m
                     expect(error).toBeDefined();[m
[31m-                    expect(error).toBeFileError(FileError.ENCODING_ERR);[m
[32m+[m[32m                    expect(error).toBeFileError(FileError.ENCODING_ERR); // eslint-disable-line no-undef[m
                     done();[m
                 };[m
                 // create:false, exclusive:false, invalid path[m
                 root.getFile(fileName, {[m
[31m-                    create : false[m
[32m+[m[32m                    create: false[m
                 }, succeed.bind(null, done, 'root.getFile - Error unexpected callback, file should not exists: ' + fileName), fail);[m
             });[m
[31m-            it("file.spec.23 DirectoryEntry.getDirectory: get Entry for directory that does not exist", function (done) {[m
[31m-                var dirName = "de.no.dir",[m
[31m-                fail = function (error) {[m
[32m+[m[32m            it('file.spec.23 DirectoryEntry.getDirectory: get Entry for directory that does not exist', function (done) {[m
[32m+[m[32m                var dirName = 'de.no.dir';[m
[32m+[m[32m                var fail = function (error) {[m
                     expect(error).toBeDefined();[m
[31m-                    expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                    if (isChrome) {[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                    }[m
                     done();[m
                 };[m
                 // create:false, exclusive:false, directory does not exist[m
                 root.getDirectory(dirName, {[m
[31m-                    create : false[m
[32m+[m[32m                    create: false[m
                 }, succeed.bind(null, done, 'root.getDirectory - Error unexpected callback, directory should not exists: ' + dirName), fail);[m
             });[m
[31m-            it("file.spec.24 DirectoryEntry.getDirectory: create new dir with space then resolveLocalFileSystemURL", function (done) {[m
[31m-                var dirName = "de create dir";[m
[32m+[m[32m            it('file.spec.24 DirectoryEntry.getDirectory: create new dir with space then resolveLocalFileSystemURL', function (done) {[m
[32m+[m[32m                var dirName = 'de create dir';[m
 [m
[31m-                function win(directory) {[m
[32m+[m[32m                function win (directory) {[m
                     expect(directory).toBeDefined();[m
                     expect(directory.isFile).toBe(false);[m
                     expect(directory.isDirectory).toBe(true);[m
[36m@@ -634,7 +656,7 @@[m [mexports.defineAutoTests = function () {[m
                     deleteEntry(directory.name, done);[m
                 }[m
 [m
[31m-                function getDir(dirEntry) {[m
[32m+[m[32m                function getDir (dirEntry) {[m
                     expect(dirEntry.filesystem).toBeDefined();[m
                     expect(dirEntry.filesystem).toBe(root.filesystem);[m
                     var dirURI = dirEntry.toURL();[m
[36m@@ -644,7 +666,7 @@[m [mexports.defineAutoTests = function () {[m
 [m
                 // create:true, exclusive:false, directory does not exist[m
                 root.getDirectory(dirName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, getDir, failed.bind(null, done, 'root.getDirectory - Error creating directory : ' + dirName));[m
             });[m
             // This test is excluded, and should probably be removed. Filesystem[m
[36m@@ -653,11 +675,11 @@[m [mexports.defineAutoTests = function () {[m
             // handled by the implementation.[m
             // If a particular platform uses paths internally rather than URLs, // then that platform should careful to pass them correctly to its[m
             // backend.[m
[31m-            xit("file.spec.25 DirectoryEntry.getDirectory: create new dir with space resolveLocalFileSystemURL with encoded URI", function (done) {[m
[31m-                var dirName = "de create dir2",[m
[31m-                dirPath = joinURL(root.fullPath, dirName);[m
[32m+[m[32m            xit('file.spec.25 DirectoryEntry.getDirectory: create new dir with space resolveLocalFileSystemURL with encoded URI', function (done) {[m
[32m+[m[32m                var dirName = 'de create dir2';[m
[32m+[m[32m                var dirPath = joinURL(root.fullPath, dirName);[m
 [m
[31m-                function win(directory) {[m
[32m+[m[32m                function win (directory) {[m
                     expect(directory).toBeDefined();[m
                     expect(directory.isFile).toBe(false);[m
                     expect(directory.isDirectory).toBe(true);[m
[36m@@ -667,7 +689,7 @@[m [mexports.defineAutoTests = function () {[m
                     deleteEntry(directory.name, done);[m
                 }[m
 [m
[31m-                function getDir(dirEntry) {[m
[32m+[m[32m                function getDir (dirEntry) {[m
                     var dirURI = dirEntry.toURL();[m
                     // now encode URI and try to resolve[m
                     window.resolveLocalFileSystemURL(encodeURI(dirURI), win, failed.bind(null, done, 'window.resolveLocalFileSystemURL - getDir function - Error resolving directory: ' + dirURI));[m
[36m@@ -675,13 +697,13 @@[m [mexports.defineAutoTests = function () {[m
 [m
                 // create:true, exclusive:false, directory does not exist[m
                 root.getDirectory(dirName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, getDir, failed.bind(null, done, 'root.getDirectory - Error creating directory : ' + dirName));[m
             });[m
[31m-            it("file.spec.26 DirectoryEntry.getDirectory: create new directory", function (done) {[m
[31m-                var dirName = "de.create.dir",[m
[31m-                dirPath = joinURL(root.fullPath, dirName),[m
[31m-                win = function (directory) {[m
[32m+[m[32m            it('file.spec.26 DirectoryEntry.getDirectory: create new directory', function (done) {[m
[32m+[m[32m                var dirName = 'de.create.dir';[m
[32m+[m[32m                var dirPath = joinURL(root.fullPath, dirName);[m
[32m+[m[32m                var win = function (directory) {[m
                     expect(directory).toBeDefined();[m
                     expect(directory.isFile).toBe(false);[m
                     expect(directory.isDirectory).toBe(true);[m
[36m@@ -694,13 +716,13 @@[m [mexports.defineAutoTests = function () {[m
                 };[m
                 // create:true, exclusive:false, directory does not exist[m
                 root.getDirectory(dirName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, win, failed.bind(null, done, 'root.getDirectory - Error creating directory : ' + dirName));[m
             });[m
[31m-            it("file.spec.27 DirectoryEntry.getDirectory: create new directory (exclusive)", function (done) {[m
[31m-                var dirName = "de.create.exclusive.dir",[m
[31m-                dirPath = joinURL(root.fullPath, dirName),[m
[31m-                win = function (directory) {[m
[32m+[m[32m            it('file.spec.27 DirectoryEntry.getDirectory: create new directory (exclusive)', function (done) {[m
[32m+[m[32m                var dirName = 'de.create.exclusive.dir';[m
[32m+[m[32m                var dirPath = joinURL(root.fullPath, dirName);[m
[32m+[m[32m                var win = function (directory) {[m
                     expect(directory).toBeDefined();[m
                     expect(directory.isFile).toBe(false);[m
                     expect(directory.isDirectory).toBe(true);[m
[36m@@ -713,14 +735,14 @@[m [mexports.defineAutoTests = function () {[m
                 };[m
                 // create:true, exclusive:true, directory does not exist[m
                 root.getDirectory(dirName, {[m
[31m-                    create : true,[m
[31m-                    exclusive : true[m
[32m+[m[32m                    create: true,[m
[32m+[m[32m                    exclusive: true[m
                 }, win, failed.bind(null, done, 'root.getDirectory - Error creating directory : ' + dirName));[m
             });[m
[31m-            it("file.spec.28 DirectoryEntry.getDirectory: create directory that already exists", function (done) {[m
[31m-                var dirName = "de.create.existing.dir",[m
[31m-                dirPath = joinURL(root.fullPath, dirName),[m
[31m-                win = function (directory) {[m
[32m+[m[32m            it('file.spec.28 DirectoryEntry.getDirectory: create directory that already exists', function (done) {[m
[32m+[m[32m                var dirName = 'de.create.existing.dir';[m
[32m+[m[32m                var dirPath = joinURL(root.fullPath, dirName);[m
[32m+[m[32m                var win = function (directory) {[m
                     expect(directory).toBeDefined();[m
                     expect(directory.isFile).toBe(false);[m
                     expect(directory.isDirectory).toBe(true);[m
[36m@@ -731,45 +753,45 @@[m [mexports.defineAutoTests = function () {[m
                 };[m
                 // create directory to kick off it[m
                 root.getDirectory(dirName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function () {[m
                     root.getDirectory(dirName, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, win, failed.bind(null, done, 'root.getDirectory - Error creating existent second directory : ' + dirName));[m
                 }, failed.bind(null, done, 'root.getDirectory - Error creating directory : ' + dirName));[m
             });[m
[31m-            it("file.spec.29 DirectoryEntry.getDirectory: create directory that already exists (exclusive)", function (done) {[m
[32m+[m[32m            it('file.spec.29 DirectoryEntry.getDirectory: create directory that already exists (exclusive)', function (done) {[m
 [m
[31m-                var dirName = "de.create.exclusive.existing.dir",[m
[31m-                existingDir,[m
[31m-                fail = function (error) {[m
[32m+[m[32m                var dirName = 'de.create.exclusive.existing.dir';[m
[32m+[m[32m                var existingDir;[m
[32m+[m[32m                var fail = function (error) {[m
                     expect(error).toBeDefined();[m
                     if (isChrome) {[m
[31m-                        /*INVALID_MODIFICATION_ERR (code: 9) is thrown instead of PATH_EXISTS_ERR(code: 12)[m
[31m-                        on trying to exclusively create a file or directory, which already exists (Chrome).*/[m
[31m-                        expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                    /* INVALID_MODIFICATION_ERR (code: 9) or ??? (code: 13) is thrown instead of PATH_EXISTS_ERR(code: 12)[m
[32m+[m[32m                    on trying to exclusively create a file or directory, which already exists (Chrome). */[m
[32m+[m[32m                    // expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
                     } else {[m
[31m-                        expect(error).toBeFileError(FileError.PATH_EXISTS_ERR);[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.PATH_EXISTS_ERR); // eslint-disable-line no-undef[m
                     }[m
                     // cleanup[m
                     deleteEntry(existingDir.name, done);[m
                 };[m
                 // create directory to kick off it[m
                 root.getDirectory(dirName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (directory) {[m
                     existingDir = directory;[m
                     // create:true, exclusive:true, directory exists[m
                     root.getDirectory(dirName, {[m
[31m-                        create : true,[m
[31m-                        exclusive : true[m
[32m+[m[32m                        create: true,[m
[32m+[m[32m                        exclusive: true[m
                     }, failed.bind(null, done, 'root.getDirectory - Unexpected success callback, second directory should not be created : ' + dirName), fail);[m
                 }, failed.bind(null, done, 'root.getDirectory - Error creating directory : ' + dirName));[m
             });[m
[31m-            it("file.spec.30 DirectoryEntry.getDirectory: get Entry for existing directory", function (done) {[m
[31m-                var dirName = "de.get.dir",[m
[31m-                dirPath = joinURL(root.fullPath, dirName),[m
[31m-                win = function (directory) {[m
[32m+[m[32m            it('file.spec.30 DirectoryEntry.getDirectory: get Entry for existing directory', function (done) {[m
[32m+[m[32m                var dirName = 'de.get.dir';[m
[32m+[m[32m                var dirPath = joinURL(root.fullPath, dirName);[m
[32m+[m[32m                var win = function (directory) {[m
                     expect(directory).toBeDefined();[m
                     expect(directory.isFile).toBe(false);[m
                     expect(directory.isDirectory).toBe(true);[m
[36m@@ -780,109 +802,121 @@[m [mexports.defineAutoTests = function () {[m
                 };[m
                 // create directory to kick it off[m
                 root.getDirectory(dirName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function () {[m
                     root.getDirectory(dirName, {[m
[31m-                        create : false[m
[32m+[m[32m                        create: false[m
                     }, win, failed.bind(null, done, 'root.getDirectory - Error getting directory entry : ' + dirName));[m
                 }, failed.bind(null, done, 'root.getDirectory - Error creating directory : ' + dirName));[m
             });[m
[31m-            it("file.spec.31 DirectoryEntry.getDirectory: get DirectoryEntry for invalid path", function (done) {[m
[32m+[m[32m            it('file.spec.31 DirectoryEntry.getDirectory: get DirectoryEntry for invalid path', function (done) {[m
                 if (isBrowser) {[m
[31m-                    /*The plugin does not follow to ["8.3 Naming restrictions"][m
[31m-                    (http://www.w3.org/TR/2011/WD-file-system-api-20110419/#naming-restrictions).*/[m
[32m+[m[32m                    /* The plugin does not follow to ["8.3 Naming restrictions"][m
[32m+[m[32m                    (http://www.w3.org/TR/2011/WD-file-system-api-20110419/#naming-restrictions). */[m
                     pending();[m
                 }[m
 [m
[31m-                var dirName = "de:invalid:path",[m
[31m-                fail = function (error) {[m
[32m+[m[32m                var dirName = 'de:invalid:path';[m
[32m+[m[32m                var fail = function (error) {[m
                     expect(error).toBeDefined();[m
[31m-                    expect(error).toBeFileError(FileError.ENCODING_ERR);[m
[32m+[m[32m                    expect(error).toBeFileError(FileError.ENCODING_ERR); // eslint-disable-line no-undef[m
                     done();[m
                 };[m
                 // create:false, exclusive:false, invalid path[m
                 root.getDirectory(dirName, {[m
[31m-                    create : false[m
[32m+[m[32m                    create: false[m
                 }, succeed.bind(null, done, 'root.getDirectory - Unexpected success callback, directory should not exists: ' + dirName), fail);[m
             });[m
[31m-            it("file.spec.32 DirectoryEntry.getDirectory: get DirectoryEntry for existing file", function (done) {[m
[31m-                var fileName = "de.existing.file",[m
[31m-                existingFile,[m
[31m-                fail = function (error) {[m
[32m+[m[32m            it('file.spec.32 DirectoryEntry.getDirectory: get DirectoryEntry for existing file', function (done) {[m
[32m+[m[32m                var fileName = 'de.existing.file';[m
[32m+[m[32m                var existingFile;[m
[32m+[m[32m                var fail = function (error) {[m
                     expect(error).toBeDefined();[m
[31m-                    expect(error).toBeFileError(FileError.TYPE_MISMATCH_ERR);[m
[32m+[m[32m                    if (isChrome) {[m
[32m+[m[32m                    // chrome returns an unknown error with code 17[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.TYPE_MISMATCH_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                    }[m
                     // cleanup[m
                     deleteEntry(existingFile.name, done);[m
                 };[m
                 // create file to kick off it[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (file) {[m
                     existingFile = file;[m
                     root.getDirectory(fileName, {[m
[31m-                        create : false[m
[32m+[m[32m                        create: false[m
                     }, succeed.bind(null, done, 'root.getDirectory - Unexpected success callback, directory should not exists: ' + fileName), fail);[m
                 }, failed.bind(null, done, 'root.getFile - Error creating file : ' + fileName));[m
             });[m
[31m-            it("file.spec.33 DirectoryEntry.getFile: get FileEntry for existing directory", function (done) {[m
[31m-                var dirName = "de.existing.dir",[m
[31m-                existingDir,[m
[31m-                fail = function (error) {[m
[32m+[m[32m            it('file.spec.33 DirectoryEntry.getFile: get FileEntry for existing directory', function (done) {[m
[32m+[m[32m                var dirName = 'de.existing.dir';[m
[32m+[m[32m                var existingDir;[m
[32m+[m[32m                var fail = function (error) {[m
                     expect(error).toBeDefined();[m
[31m-                    expect(error).toBeFileError(FileError.TYPE_MISMATCH_ERR);[m
[32m+[m[32m                    if (isChrome) {[m
[32m+[m[32m                    // chrome returns an unknown error with code 17[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.TYPE_MISMATCH_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                    }[m
                     // cleanup[m
                     deleteEntry(existingDir.name, done);[m
                 };[m
                 // create directory to kick off it[m
                 root.getDirectory(dirName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (directory) {[m
                     existingDir = directory;[m
                     root.getFile(dirName, {[m
[31m-                        create : false[m
[32m+[m[32m                        create: false[m
                     }, succeed.bind(null, done, 'root.getFile - Unexpected success callback, file should not exists: ' + dirName), fail);[m
                 }, failed.bind(null, done, 'root.getDirectory - Error creating directory : ' + dirName));[m
             });[m
[31m-            it("file.spec.34 DirectoryEntry.removeRecursively on directory", function (done) {[m
[31m-                var dirName = "de.removeRecursively",[m
[31m-                subDirName = "dir",[m
[31m-                dirExists = function (error) {[m
[32m+[m[32m            it('file.spec.34 DirectoryEntry.removeRecursively on directory', function (done) {[m
[32m+[m[32m                var dirName = 'de.removeRecursively';[m
[32m+[m[32m                var subDirName = 'dir';[m
[32m+[m[32m                var dirExists = function (error) {[m
                     expect(error).toBeDefined();[m
[31m-                    expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                    if (isChrome) {[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                    }[m
                     done();[m
                 };[m
                 // create a new directory entry to kick off it[m
                 root.getDirectory(dirName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (entry) {[m
                     entry.getDirectory(subDirName, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function (dir) {[m
                         entry.removeRecursively(function () {[m
                             root.getDirectory(dirName, {[m
[31m-                                create : false[m
[32m+[m[32m                                create: false[m
                             }, succeed.bind(null, done, 'root.getDirectory - Unexpected success callback, directory should not exists: ' + dirName), dirExists);[m
                         }, failed.bind(null, done, 'entry.removeRecursively - Error removing directory recursively : ' + dirName));[m
                     }, failed.bind(null, done, 'root.getDirectory - Error creating directory : ' + subDirName));[m
                 }, failed.bind(null, done, 'root.getDirectory - Error creating directory : ' + dirName));[m
             });[m
[31m-            it("file.spec.35 createReader: create reader on existing directory", function () {[m
[32m+[m[32m            it('file.spec.35 createReader: create reader on existing directory', function () {[m
                 // create reader for root directory[m
                 var reader = root.createReader();[m
                 expect(reader).toBeDefined();[m
                 expect(typeof reader.readEntries).toBe('function');[m
             });[m
[31m-            it("file.spec.36 removeRecursively on root file system", function (done) {[m
[32m+[m[32m            it('file.spec.36 removeRecursively on root file system', function (done) {[m
 [m
                 var remove = function (error) {[m
                     expect(error).toBeDefined();[m
                     if (isChrome) {[m
[31m-                        /*INVALID_MODIFICATION_ERR (code: 9) is thrown instead of[m
[32m+[m[32m                        /* INVALID_MODIFICATION_ERR (code: 9) or ??? (code: 13) is thrown instead of[m
                         NO_MODIFICATION_ALLOWED_ERR(code: 6) on trying to call removeRecursively[m
[31m-                        on the root file system (Chrome).*/[m
[31m-                        expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                        on the root file system (Chrome). */[m
[32m+[m[32m                        // expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
                     } else {[m
[31m-                        expect(error).toBeFileError(FileError.NO_MODIFICATION_ALLOWED_ERR);[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.NO_MODIFICATION_ALLOWED_ERR); // eslint-disable-line no-undef[m
                     }[m
                     done();[m
                 };[m
[36m@@ -891,10 +925,10 @@[m [mexports.defineAutoTests = function () {[m
             });[m
         });[m
         describe('DirectoryReader interface', function () {[m
[31m-            describe("readEntries", function () {[m
[31m-                it("file.spec.37 should read contents of existing directory", function (done) {[m
[31m-                    var reader,[m
[31m-                    win = function (entries) {[m
[32m+[m[32m            describe('readEntries', function () {[m
[32m+[m[32m                it('file.spec.37 should read contents of existing directory', function (done) {[m
[32m+[m[32m                    var reader;[m
[32m+[m[32m                    var win = function (entries) {[m
                         expect(entries).toBeDefined();[m
                         expect(entries instanceof Array).toBe(true);[m
                         done();[m
[36m@@ -904,14 +938,14 @@[m [mexports.defineAutoTests = function () {[m
                     // read entries[m
                     reader.readEntries(win, failed.bind(null, done, 'reader.readEntries - Error reading entries'));[m
                 });[m
[31m-                it("file.spec.37.1 should read contents of existing directory", function (done) {[m
[31m-                    var dirName = 'readEntries.dir',[m
[31m-                    fileName = 'readeEntries.file';[m
[32m+[m[32m                it('file.spec.37.1 should read contents of existing directory', function (done) {[m
[32m+[m[32m                    var dirName = 'readEntries.dir';[m
[32m+[m[32m                    var fileName = 'readeEntries.file';[m
                     root.getDirectory(dirName, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function (directory) {[m
                         directory.getFile(fileName, {[m
[31m-                            create : true[m
[32m+[m[32m                            create: true[m
                         }, function (fileEntry) {[m
                             var reader = directory.createReader();[m
                             reader.readEntries(function (entries) {[m
[36m@@ -922,10 +956,9 @@[m [mexports.defineAutoTests = function () {[m
                                 expect(entries[0].filesystem).not.toBe(null);[m
                                 if (isChrome) {[m
                                     // Slicing '[object {type}]' -> '{type}'[m
[31m-                                    expect(entries[0].filesystem.toString().slice(8, -1)).toEqual("DOMFileSystem");[m
[31m-                                }[m
[31m-                                else {[m
[31m-                                    expect(entries[0].filesystem instanceof FileSystem).toBe(true);[m
[32m+[m[32m                                    expect(entries[0].filesystem.toString().slice(8, -1)).toEqual('DOMFileSystem');[m
[32m+[m[32m                                } else {[m
[32m+[m[32m                                    expect(entries[0].filesystem instanceof FileSystem).toBe(true); // eslint-disable-line no-undef[m
                                 }[m
 [m
                                 // cleanup[m
[36m@@ -934,47 +967,55 @@[m [mexports.defineAutoTests = function () {[m
                         }, failed.bind(null, done, 'directory.getFile - Error creating file : ' + fileName));[m
                     }, failed.bind(null, done, 'root.getDirectory - Error creating directory : ' + dirName));[m
                 });[m
[31m-                it("file.spec.109 should return an empty entry list on the second call", function (done) {[m
[31m-                    var reader,[m
[31m-                    fileName = 'test109.txt';[m
[32m+[m[32m                it('file.spec.109 should return an empty entry list on the second call', function (done) {[m
[32m+[m[32m                    var reader;[m
[32m+[m[32m                    var fileName = 'test109.txt';[m
                     // Add a file to ensure the root directory is non-empty and then read the contents of the directory.[m
                     root.getFile(fileName, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function (entry) {[m
                         reader = root.createReader();[m
[31m-                        //First read[m
[32m+[m[32m                        // First read[m
                         reader.readEntries(function (entries) {[m
                             expect(entries).toBeDefined();[m
                             expect(entries instanceof Array).toBe(true);[m
                             expect(entries.length).not.toBe(0);[m
[31m-                            //Second read[m
[32m+[m[32m                            // Second read[m
                             reader.readEntries(function (entries_) {[m
                                 expect(entries_).toBeDefined();[m
                                 expect(entries_ instanceof Array).toBe(true);[m
                                 expect(entries_.length).toBe(0);[m
[31m-                                //Clean up[m
[32m+[m[32m                                // Clean up[m
                                 deleteEntry(entry.name, done);[m
                             }, failed.bind(null, done, 'reader.readEntries - Error during SECOND reading of entries from [root] directory'));[m
                         }, failed.bind(null, done, 'reader.readEntries - Error during FIRST reading of entries from [root] directory'));[m
                     }, failed.bind(null, done, 'root.getFile - Error creating file : ' + fileName));[m
                 });[m
             });[m
[31m-            it("file.spec.38 should read contents of directory that has been removed", function (done) {[m
[31m-                var dirName = "de.createReader.notfound";[m
[32m+[m[32m            it('file.spec.38 should read contents of directory that has been removed', function (done) {[m
[32m+[m[32m                var dirName = 'de.createReader.notfound';[m
                 // create a new directory entry to kick off it[m
                 root.getDirectory(dirName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (directory) {[m
                     directory.removeRecursively(function () {[m
                         var reader = directory.createReader();[m
                         reader.readEntries(succeed.bind(null, done, 'reader.readEntries - Unexpected success callback, it should not read entries from deleted dir: ' + dirName), function (error) {[m
                             expect(error).toBeDefined();[m
[31m-                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                            if (isChrome) {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            }[m
                             root.getDirectory(dirName, {[m
[31m-                                create : false[m
[32m+[m[32m                                create: false[m
                             }, succeed.bind(null, done, 'root.getDirectory - Unexpected success callback, it should not get deleted directory: ' + dirName), function (err) {[m
                                 expect(err).toBeDefined();[m
[31m-                                expect(err).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                                if (isChrome) {[m
[32m+[m[32m                                    expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                } else {[m
[32m+[m[32m                                    expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                }[m
                                 done();[m
                             });[m
                         });[m
[36m@@ -982,26 +1023,26 @@[m [mexports.defineAutoTests = function () {[m
                 }, failed.bind(null, done, 'root.getDirectory - Error creating directory : ' + dirName));[m
             });[m
         });[m
[31m-        //DirectoryReader interface[m
[32m+[m[32m        // DirectoryReader interface[m
         describe('File', function () {[m
[31m-            it("file.spec.39 constructor should be defined", function () {[m
[31m-                expect(File).toBeDefined();[m
[32m+[m[32m            it('file.spec.39 constructor should be defined', function () {[m
[32m+[m[32m                expect(File).toBeDefined(); // eslint-disable-line no-undef[m
                 expect(typeof File).toBe('function');[m
             });[m
[31m-            it("file.spec.40 should be define File attributes", function () {[m
[31m-                var file = new File();[m
[32m+[m[32m            it('file.spec.40 should be define File attributes', function () {[m
[32m+[m[32m                var file = new File(); // eslint-disable-line no-undef[m
                 expect(file.name).toBeDefined();[m
                 expect(file.type).toBeDefined();[m
                 expect(file.lastModifiedDate).toBeDefined();[m
                 expect(file.size).toBeDefined();[m
             });[m
         });[m
[31m-        //File[m
[32m+[m[32m        // File[m
         describe('FileEntry', function () {[m
 [m
[31m-            it("file.spec.41 should be define FileEntry methods", function (done) {[m
[31m-                var fileName = "fe.methods",[m
[31m-                testFileEntry = function (fileEntry) {[m
[32m+[m[32m            it('file.spec.41 should be define FileEntry methods', function (done) {[m
[32m+[m[32m                var fileName = 'fe.methods';[m
[32m+[m[32m                var testFileEntry = function (fileEntry) {[m
                     expect(fileEntry).toBeDefined();[m
                     expect(typeof fileEntry.createWriter).toBe('function');[m
                     expect(typeof fileEntry.file).toBe('function');[m
[36m@@ -1010,20 +1051,19 @@[m [mexports.defineAutoTests = function () {[m
                 };[m
                 // create a new file entry to kick off it[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, testFileEntry, failed.bind(null, done, 'root.getFile - Error creating file : ' + fileName));[m
             });[m
[31m-            it("file.spec.42 createWriter should return a FileWriter object", function (done) {[m
[31m-                var fileName = "fe.createWriter",[m
[31m-                testFile,[m
[31m-                testWriter = function (writer) {[m
[32m+[m[32m            it('file.spec.42 createWriter should return a FileWriter object', function (done) {[m
[32m+[m[32m                var fileName = 'fe.createWriter';[m
[32m+[m[32m                var testFile;[m
[32m+[m[32m                var testWriter = function (writer) {[m
                     expect(writer).toBeDefined();[m
                     if (isChrome) {[m
[31m-                        // Slicing '[object {type}]' -> '{type}'[m
[31m-                        expect(writer.toString().slice(8, -1)).toEqual("FileWriter");[m
[31m-                    }[m
[31m-                    else {[m
[31m-                        expect(writer instanceof FileWriter).toBe(true);[m
[32m+[m[32m                    // Slicing '[object {type}]' -> '{type}'[m
[32m+[m[32m                        expect(writer.toString().slice(8, -1)).toEqual('FileWriter');[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        expect(writer instanceof FileWriter).toBe(true); // eslint-disable-line no-undef[m
                     }[m
 [m
                     // cleanup[m
[36m@@ -1031,23 +1071,22 @@[m [mexports.defineAutoTests = function () {[m
                 };[m
                 // create a new file entry to kick off it[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (fileEntry) {[m
                     testFile = fileEntry;[m
                     fileEntry.createWriter(testWriter, failed.bind(null, done, 'fileEntry.createWriter - Error creating Writer from entry'));[m
                 }, failed.bind(null, done, 'root.getFile - Error creating file : ' + fileName));[m
             });[m
[31m-            it("file.spec.43 file should return a File object", function (done) {[m
[31m-                var fileName = "fe.file",[m
[31m-                newFile,[m
[31m-                testFile = function (file) {[m
[32m+[m[32m            it('file.spec.43 file should return a File object', function (done) {[m
[32m+[m[32m                var fileName = 'fe.file';[m
[32m+[m[32m                var newFile;[m
[32m+[m[32m                var testFile = function (file) {[m
                     expect(file).toBeDefined();[m
                     if (isChrome) {[m
[31m-                        // Slicing '[object {type}]' -> '{type}'[m
[31m-                        expect(file.toString().slice(8, -1)).toEqual("File");[m
[31m-                    }[m
[31m-                    else {[m
[31m-                        expect(file instanceof File).toBe(true);[m
[32m+[m[32m                    // Slicing '[object {type}]' -> '{type}'[m
[32m+[m[32m                        expect(file.toString().slice(8, -1)).toEqual('File');[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        expect(file instanceof File).toBe(true); // eslint-disable-line no-undef[m
                     }[m
 [m
                     // cleanup[m
[36m@@ -1055,34 +1094,38 @@[m [mexports.defineAutoTests = function () {[m
                 };[m
                 // create a new file entry to kick off it[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (fileEntry) {[m
                     newFile = fileEntry;[m
                     fileEntry.file(testFile, failed.bind(null, done, 'fileEntry.file - Error reading file using fileEntry: ' + fileEntry.name));[m
                 }, failed.bind(null, done, 'root.getFile - Error creating file : ' + fileName));[m
             });[m
[31m-            it("file.spec.44 file: on File that has been removed", function (done) {[m
[31m-                var fileName = "fe.no.file";[m
[32m+[m[32m            it('file.spec.44 file: on File that has been removed', function (done) {[m
[32m+[m[32m                var fileName = 'fe.no.file';[m
                 // create a new file entry to kick off it[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (fileEntry) {[m
                     fileEntry.remove(function () {[m
                         fileEntry.file(succeed.bind(null, done, 'fileEntry.file - Unexpected success callback, file it should not be created from removed entry'), function (error) {[m
                             expect(error).toBeDefined();[m
[31m-                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                            if (isChrome) {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            }[m
                             done();[m
                         });[m
                     }, failed.bind(null, done, 'fileEntry.remove - Error removing entry : ' + fileName));[m
                 }, failed.bind(null, done, 'root.getFile - Error creating file : ' + fileName));[m
             });[m
         });[m
[31m-        //FileEntry[m
[32m+[m[32m        // FileEntry[m
         describe('Entry', function () {[m
[31m-            it("file.spec.45 Entry object", function (done) {[m
[31m-                var fileName = "entry",[m
[31m-                fullPath = joinURL(root.fullPath, fileName),[m
[31m-                winEntry = function (entry) {[m
[32m+[m[32m            it('file.spec.45 Entry object', function (done) {[m
[32m+[m[32m                var fileName = 'entry';[m
[32m+[m[32m                var fullPath = joinURL(root.fullPath, fileName);[m
[32m+[m[32m                var winEntry = function (entry) {[m
                     expect(entry).toBeDefined();[m
                     expect(entry.isFile).toBe(true);[m
                     expect(entry.isDirectory).toBe(false);[m
[36m@@ -1103,41 +1146,41 @@[m [mexports.defineAutoTests = function () {[m
                 // create a new file entry[m
                 createFile(fileName, winEntry, failed.bind(null, done, 'createFile - Error creating file : ' + fileName));[m
             });[m
[31m-            it("file.spec.46 Entry.getMetadata on file", function (done) {[m
[31m-                var fileName = "entry.metadata.file";[m
[32m+[m[32m            it('file.spec.46 Entry.getMetadata on file', function (done) {[m
[32m+[m[32m                var fileName = 'entry.metadata.file';[m
                 // create a new file entry[m
                 createFile(fileName, function (entry) {[m
                     entry.getMetadata(function (metadata) {[m
                         expect(metadata).toBeDefined();[m
                         expect(metadata.modificationTime instanceof Date).toBe(true);[m
[31m-                        expect(typeof metadata.size).toBe("number");[m
[32m+[m[32m                        expect(typeof metadata.size).toBe('number');[m
                         // cleanup[m
                         deleteEntry(fileName, done);[m
                     }, failed.bind(null, done, 'entry.getMetadata - Error getting metadata from entry : ' + fileName));[m
                 }, failed.bind(null, done, 'createFile - Error creating file : ' + fileName));[m
             });[m
[31m-            it("file.spec.47 Entry.getMetadata on directory", function (done) {[m
[32m+[m[32m            it('file.spec.47 Entry.getMetadata on directory', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* Does not support metadata for directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var dirName = "entry.metadata.dir";[m
[32m+[m[32m                var dirName = 'entry.metadata.dir';[m
                 // create a new directory entry[m
                 createDirectory(dirName, function (entry) {[m
                     entry.getMetadata(function (metadata) {[m
                         expect(metadata).toBeDefined();[m
                         expect(metadata.modificationTime instanceof Date).toBe(true);[m
[31m-                        expect(typeof metadata.size).toBe("number");[m
[32m+[m[32m                        expect(typeof metadata.size).toBe('number');[m
                         expect(metadata.size).toBe(0);[m
                         // cleanup[m
                         deleteEntry(dirName, done);[m
                     }, failed.bind(null, done, 'entry.getMetadata - Error getting metadata from entry : ' + dirName));[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + dirName));[m
             });[m
[31m-            it("file.spec.48 Entry.getParent on file in root file system", function (done) {[m
[31m-                var fileName = "entry.parent.file",[m
[31m-                rootPath = root.fullPath;[m
[32m+[m[32m            it('file.spec.48 Entry.getParent on file in root file system', function (done) {[m
[32m+[m[32m                var fileName = 'entry.parent.file';[m
[32m+[m[32m                var rootPath = root.fullPath;[m
                 // create a new file entry[m
                 createFile(fileName, function (entry) {[m
                     entry.getParent(function (parent) {[m
[36m@@ -1148,9 +1191,9 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'entry.getParent - Error getting parent directory of file : ' + fileName));[m
                 }, failed.bind(null, done, 'createFile - Error creating file : ' + fileName));[m
             });[m
[31m-            it("file.spec.49 Entry.getParent on directory in root file system", function (done) {[m
[31m-                var dirName = "entry.parent.dir",[m
[31m-                rootPath = root.fullPath;[m
[32m+[m[32m            it('file.spec.49 Entry.getParent on directory in root file system', function (done) {[m
[32m+[m[32m                var dirName = 'entry.parent.dir';[m
[32m+[m[32m                var rootPath = root.fullPath;[m
                 // create a new directory entry[m
                 createDirectory(dirName, function (entry) {[m
                     entry.getParent(function (parent) {[m
[36m@@ -1161,9 +1204,9 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'entry.getParent - Error getting parent directory of directory : ' + dirName));[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + dirName));[m
             });[m
[31m-            it("file.spec.50 Entry.getParent on root file system", function (done) {[m
[31m-                var rootPath = root.fullPath,[m
[31m-                winParent = function (parent) {[m
[32m+[m[32m            it('file.spec.50 Entry.getParent on root file system', function (done) {[m
[32m+[m[32m                var rootPath = root.fullPath;[m
[32m+[m[32m                var winParent = function (parent) {[m
                     expect(parent).toBeDefined();[m
                     expect(parent.fullPath).toCanonicallyMatch(rootPath);[m
                     done();[m
[36m@@ -1171,10 +1214,10 @@[m [mexports.defineAutoTests = function () {[m
                 // create a new directory entry[m
                 root.getParent(winParent, failed.bind(null, done, 'root.getParent - Error getting parent directory of root'));[m
             });[m
[31m-            it("file.spec.51 Entry.toURL on file", function (done) {[m
[31m-                var fileName = "entry.uri.file",[m
[31m-                rootPath = root.fullPath,[m
[31m-                winURI = function (entry) {[m
[32m+[m[32m            it('file.spec.51 Entry.toURL on file', function (done) {[m
[32m+[m[32m                var fileName = 'entry.uri.file';[m
[32m+[m[32m                var rootPath = root.fullPath;[m
[32m+[m[32m                var winURI = function (entry) {[m
                     var uri = entry.toURL();[m
                     expect(uri).toBeDefined();[m
                     expect(uri.indexOf(rootPath)).not.toBe(-1);[m
[36m@@ -1184,13 +1227,13 @@[m [mexports.defineAutoTests = function () {[m
                 // create a new file entry[m
                 createFile(fileName, winURI, failed.bind(null, done, 'createFile - Error creating file : ' + fileName));[m
             });[m
[31m-            it("file.spec.52 Entry.toURL on directory", function (done) {[m
[31m-                var dirName_1 = "num 1",[m
[31m-                dirName_2 = "num 2",[m
[31m-                rootPath = root.fullPath;[m
[32m+[m[32m            it('file.spec.52 Entry.toURL on directory', function (done) {[m
[32m+[m[32m                var dirName_1 = 'num 1';[m
[32m+[m[32m                var dirName_2 = 'num 2';[m
[32m+[m[32m                var rootPath = root.fullPath;[m
                 createDirectory(dirName_1, function (entry) {[m
                     entry.getDirectory(dirName_2, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function (entryFile) {[m
                         var uri = entryFile.toURL();[m
                         expect(uri).toBeDefined();[m
[36m@@ -1201,70 +1244,85 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'entry.getDirectory - Error creating directory : ' + dirName_2));[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + dirName_1));[m
             });[m
[31m-            it("file.spec.53 Entry.remove on file", function (done) {[m
[31m-                var fileName = "entr .rm.file";[m
[32m+[m[32m            it('file.spec.53 Entry.remove on file', function (done) {[m
[32m+[m[32m                var fileName = 'entr .rm.file';[m
                 // create a new file entry[m
                 createFile(fileName, function (entry) {[m
                     expect(entry).toBeDefined();[m
                     entry.remove(function () {[m
                         root.getFile(fileName, null, succeed.bind(null, done, 'root.getFile - Unexpected success callback, it should not get deleted file : ' + fileName), function (error) {[m
                             expect(error).toBeDefined();[m
[31m-                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                            if (isChrome) {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            }[m
                             // cleanup[m
                             deleteEntry(fileName, done);[m
                         });[m
                     }, failed.bind(null, done, 'entry.remove - Error removing entry : ' + fileName));[m
                 }, failed.bind(null, done, 'createFile - Error creating file : ' + fileName));[m
             });[m
[31m-            it("file.spec.53.1 Entry.remove on filename with #s", function (done) {[m
[31m-                var fileName = "entry.#rm#.file";[m
[32m+[m[32m            it('file.spec.53.1 Entry.remove on filename with #s', function (done) {[m
[32m+[m[32m                if (isBrowser) {[m
[32m+[m[32m                    pending('Browsers can\'t do that');[m
[32m+[m[32m                }[m
[32m+[m[32m                var fileName = 'entry.#rm#.file';[m
                 // create a new file entry[m
                 createFile(fileName, function (entry) {[m
                     expect(entry).toBeDefined();[m
                     entry.remove(function () {[m
                         root.getFile(fileName, null, succeed.bind(null, done, 'root.getFile - Unexpected success callback, it should not get deleted file : ' + fileName), function (error) {[m
                             expect(error).toBeDefined();[m
[31m-                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
                             // cleanup[m
                             deleteEntry(fileName, done);[m
                         });[m
                     }, failed.bind(null, done, 'entry.remove - Error removing entry : ' + fileName));[m
                 }, failed.bind(null, done, 'createFile - Error creating file : ' + fileName));[m
             });[m
[31m-            it("file.spec.54 remove on empty directory", function (done) {[m
[31m-                var dirName = "entry.rm.dir";[m
[32m+[m[32m            it('file.spec.54 remove on empty directory', function (done) {[m
[32m+[m[32m                var dirName = 'entry.rm.dir';[m
                 // create a new directory entry[m
                 createDirectory(dirName, function (entry) {[m
                     expect(entry).toBeDefined();[m
                     entry.remove(function () {[m
                         root.getDirectory(dirName, null, succeed.bind(null, done, 'root.getDirectory - Unexpected success callback, it should not get deleted directory : ' + dirName), function (error) {[m
                             expect(error).toBeDefined();[m
[31m-                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                            if (isChrome) {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            }[m
                             // cleanup[m
                             deleteEntry(dirName, done);[m
                         });[m
                     }, failed.bind(null, done, 'entry.remove - Error removing entry : ' + dirName));[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + dirName));[m
             });[m
[31m-            it("file.spec.55 remove on non-empty directory", function (done) {[m
[32m+[m[32m            it('file.spec.55 remove on non-empty directory', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* Both Entry.remove and directoryEntry.removeRecursively don't fail when removing[m
                     non-empty directories - directories being removed are cleaned[m
[31m-                    along with contents instead (Firefox, IE)*/[m
[32m+[m[32m                    along with contents instead (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var dirName = "ent y.rm.dir.not.empty",[m
[31m-                fileName = "re ove.txt",[m
[31m-                fullPath = joinURL(root.fullPath, dirName);[m
[32m+[m[32m                var dirName = 'ent y.rm.dir.not.empty';[m
[32m+[m[32m                var fileName = 're ove.txt';[m
[32m+[m[32m                var fullPath = joinURL(root.fullPath, dirName);[m
                 // create a new directory entry[m
                 createDirectory(dirName, function (entry) {[m
                     entry.getFile(fileName, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function (fileEntry) {[m
                         entry.remove(succeed.bind(null, done, 'entry.remove - Unexpected success callback, it should not remove a directory that contains files : ' + dirName), function (error) {[m
                             expect(error).toBeDefined();[m
[31m-                            expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                            if (isChrome) {[m
[32m+[m[32m                                // chrome is returning unknown error with code 13[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            }[m
                             root.getDirectory(dirName, null, function (entry) {[m
                                 expect(entry).toBeDefined();[m
                                 expect(entry.fullPath).toCanonicallyMatch(fullPath);[m
[36m@@ -1275,26 +1333,26 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'entry.getFile - Error creating file : ' + fileName + ' inside of ' + dirName));[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + dirName));[m
             });[m
[31m-            it("file.spec.56 remove on root file system", function (done) {[m
[32m+[m[32m            it('file.spec.56 remove on root file system', function (done) {[m
 [m
                 // remove entry that doesn't exist[m
                 root.remove(succeed.bind(null, done, 'entry.remove - Unexpected success callback, it should not remove entry that it does not exists'), function (error) {[m
                     expect(error).toBeDefined();[m
                     if (isChrome) {[m
[31m-                        /*INVALID_MODIFICATION_ERR (code: 9) is thrown instead of[m
[32m+[m[32m                        /* INVALID_MODIFICATION_ERR (code: 9) or ??? (code: 13) is thrown instead of[m
                         NO_MODIFICATION_ALLOWED_ERR(code: 6) on trying to call removeRecursively[m
[31m-                        on the root file system.*/[m
[31m-                        expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                        on the root file system. */[m
[32m+[m[32m                        // expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
                     } else {[m
[31m-                        expect(error).toBeFileError(FileError.NO_MODIFICATION_ALLOWED_ERR);[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.NO_MODIFICATION_ALLOWED_ERR); // eslint-disable-line no-undef[m
                     }[m
                     done();[m
                 });[m
             });[m
[31m-            it("file.spec.57 copyTo: file", function (done) {[m
[31m-                var file1 = "entry copy.file1",[m
[31m-                file2 = "entry copy.file2",[m
[31m-                fullPath = joinURL(root.fullPath, file2);[m
[32m+[m[32m            it('file.spec.57 copyTo: file', function (done) {[m
[32m+[m[32m                var file1 = 'entry copy.file1';[m
[32m+[m[32m                var file2 = 'entry copy.file2';[m
[32m+[m[32m                var fullPath = joinURL(root.fullPath, file2);[m
                 // create a new file entry to kick off it[m
                 deleteEntry(file2, function () {[m
                     createFile(file1, function (fileEntry) {[m
[36m@@ -1306,7 +1364,7 @@[m [mexports.defineAutoTests = function () {[m
                             expect(entry.fullPath).toCanonicallyMatch(fullPath);[m
                             expect(entry.name).toCanonicallyMatch(file2);[m
                             root.getFile(file2, {[m
[31m-                                create : false[m
[32m+[m[32m                                create: false[m
                             }, function (entry2) {[m
                                 expect(entry2).toBeDefined();[m
                                 expect(entry2.isFile).toBe(true);[m
[36m@@ -1322,36 +1380,40 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'createFile - Error creating file : ' + file1));[m
                 }, failed.bind(null, done, 'deleteEntry - Error removing file : ' + file2));[m
             });[m
[31m-            it("file.spec.58 copyTo: file onto itself", function (done) {[m
[31m-                var file1 = "entry.copy.fos.file1";[m
[32m+[m[32m            it('file.spec.58 copyTo: file onto itself', function (done) {[m
[32m+[m[32m                var file1 = 'entry.copy.fos.file1';[m
                 // create a new file entry to kick off it[m
                 createFile(file1, function (entry) {[m
                     // copy file1 onto itself[m
                     entry.copyTo(root, null, succeed.bind(null, done, 'entry.copyTo - Unexpected success callback, it should not copy a null file'), function (error) {[m
                         expect(error).toBeDefined();[m
[31m-                        expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                        if (isChrome) {[m
[32m+[m[32m                            // chrome returns unknown error with code 13[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                        }[m
                         // cleanup[m
                         deleteEntry(file1, done);[m
                     });[m
                 }, failed.bind(null, done, 'createFile - Error creating file : ' + file1));[m
             });[m
[31m-            it("file.spec.59 copyTo: directory", function (done) {[m
[32m+[m[32m            it('file.spec.59 copyTo: directory', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var file1 = "file1",[m
[31m-                srcDir = "entry.copy.srcDir",[m
[31m-                dstDir = "entry.copy.dstDir",[m
[31m-                dstPath = joinURL(root.fullPath, dstDir),[m
[31m-                filePath = joinURL(dstPath, file1);[m
[32m+[m[32m                var file1 = 'file1';[m
[32m+[m[32m                var srcDir = 'entry.copy.srcDir';[m
[32m+[m[32m                var dstDir = 'entry.copy.dstDir';[m
[32m+[m[32m                var dstPath = joinURL(root.fullPath, dstDir);[m
[32m+[m[32m                var filePath = joinURL(dstPath, file1);[m
                 // create a new directory entry to kick off it[m
                 deleteEntry(dstDir, function () {[m
                     createDirectory(srcDir, function (directory) {[m
                         // create a file within new directory[m
                         directory.getFile(file1, {[m
[31m-                            create : true[m
[32m+[m[32m                            create: true[m
                         }, function () {[m
                             directory.copyTo(root, dstDir, function (directory) {[m
                                 expect(directory).toBeDefined();[m
[36m@@ -1360,7 +1422,7 @@[m [mexports.defineAutoTests = function () {[m
                                 expect(directory.fullPath).toCanonicallyMatch(dstPath);[m
                                 expect(directory.name).toCanonicallyMatch(dstDir);[m
                                 root.getDirectory(dstDir, {[m
[31m-                                    create : false[m
[32m+[m[32m                                    create: false[m
                                 }, function (dirEntry) {[m
                                     expect(dirEntry).toBeDefined();[m
                                     expect(dirEntry.isFile).toBe(false);[m
[36m@@ -1368,7 +1430,7 @@[m [mexports.defineAutoTests = function () {[m
                                     expect(dirEntry.fullPath).toCanonicallyMatch(dstPath);[m
                                     expect(dirEntry.name).toCanonicallyMatch(dstDir);[m
                                     dirEntry.getFile(file1, {[m
[31m-                                        create : false[m
[32m+[m[32m                                        create: false[m
                                     }, function (fileEntry) {[m
                                         expect(fileEntry).toBeDefined();[m
                                         expect(fileEntry.isFile).toBe(true);[m
[36m@@ -1386,22 +1448,22 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + srcDir));[m
                 }, failed.bind(null, done, 'deleteEntry - Error removing directory : ' + dstDir));[m
             });[m
[31m-            it("file.spec.60 copyTo: directory to backup at same root directory", function (done) {[m
[32m+[m[32m            it('file.spec.60 copyTo: directory to backup at same root directory', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var file1 = "file1",[m
[31m-                srcDir = "entry.copy srcDirSame",[m
[31m-                dstDir = "entry.copy srcDirSame-backup",[m
[31m-                dstPath = joinURL(root.fullPath, dstDir),[m
[31m-                filePath = joinURL(dstPath, file1);[m
[32m+[m[32m                var file1 = 'file1';[m
[32m+[m[32m                var srcDir = 'entry.copy srcDirSame';[m
[32m+[m[32m                var dstDir = 'entry.copy srcDirSame-backup';[m
[32m+[m[32m                var dstPath = joinURL(root.fullPath, dstDir);[m
[32m+[m[32m                var filePath = joinURL(dstPath, file1);[m
                 // create a new directory entry to kick off it[m
                 deleteEntry(dstDir, function () {[m
                     createDirectory(srcDir, function (directory) {[m
                         directory.getFile(file1, {[m
[31m-                            create : true[m
[32m+[m[32m                            create: true[m
                         }, function () {[m
                             directory.copyTo(root, dstDir, function (directory) {[m
                                 expect(directory).toBeDefined();[m
[36m@@ -1410,7 +1472,7 @@[m [mexports.defineAutoTests = function () {[m
                                 expect(directory.fullPath).toCanonicallyMatch(dstPath);[m
                                 expect(directory.name).toCanonicallyMatch(dstDir);[m
                                 root.getDirectory(dstDir, {[m
[31m-                                    create : false[m
[32m+[m[32m                                    create: false[m
                                 }, function (dirEntry) {[m
                                     expect(dirEntry).toBeDefined();[m
                                     expect(dirEntry.isFile).toBe(false);[m
[36m@@ -1418,7 +1480,7 @@[m [mexports.defineAutoTests = function () {[m
                                     expect(dirEntry.fullPath).toCanonicallyMatch(dstPath);[m
                                     expect(dirEntry.name).toCanonicallyMatch(dstDir);[m
                                     dirEntry.getFile(file1, {[m
[31m-                                        create : false[m
[32m+[m[32m                                        create: false[m
                                     }, function (fileEntry) {[m
                                         expect(fileEntry).toBeDefined();[m
                                         expect(fileEntry.isFile).toBe(true);[m
[36m@@ -1436,33 +1498,37 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + srcDir));[m
                 }, failed.bind(null, done, 'deleteEntry - Error removing directory : ' + dstDir));[m
             });[m
[31m-            it("file.spec.61 copyTo: directory onto itself", function (done) {[m
[32m+[m[32m            it('file.spec.61 copyTo: directory onto itself', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var file1 = "file1",[m
[31m-                srcDir = "entry.copy.dos.srcDir",[m
[31m-                srcPath = joinURL(root.fullPath, srcDir),[m
[31m-                filePath = joinURL(srcPath, file1);[m
[32m+[m[32m                var file1 = 'file1';[m
[32m+[m[32m                var srcDir = 'entry.copy.dos.srcDir';[m
[32m+[m[32m                var srcPath = joinURL(root.fullPath, srcDir);[m
[32m+[m[32m                var filePath = joinURL(srcPath, file1);[m
                 // create a new directory entry to kick off it[m
                 createDirectory(srcDir, function (directory) {[m
                     // create a file within new directory[m
                     directory.getFile(file1, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function (fileEntry) {[m
                         // copy srcDir onto itself[m
                         directory.copyTo(root, null, succeed.bind(null, done, 'directory.copyTo - Unexpected success callback, it should not copy file: ' + srcDir + ' to a null destination'), function (error) {[m
                             expect(error).toBeDefined();[m
[31m-                            expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                            if (isChrome) {[m
[32m+[m[32m                                // chrome returns unknown error with code 13[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            }[m
                             root.getDirectory(srcDir, {[m
[31m-                                create : false[m
[32m+[m[32m                                create: false[m
                             }, function (dirEntry) {[m
                                 expect(dirEntry).toBeDefined();[m
                                 expect(dirEntry.fullPath).toCanonicallyMatch(srcPath);[m
                                 dirEntry.getFile(file1, {[m
[31m-                                    create : false[m
[32m+[m[32m                                    create: false[m
                                 }, function (fileEntry) {[m
                                     expect(fileEntry).toBeDefined();[m
                                     expect(fileEntry.fullPath).toCanonicallyMatch(filePath);[m
[36m@@ -1474,23 +1540,27 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'directory.getFile - Error creating file : ' + file1));[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + srcDir));[m
             });[m
[31m-            it("file.spec.62 copyTo: directory into itself", function (done) {[m
[32m+[m[32m            it('file.spec.62 copyTo: directory into itself', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var srcDir = "entry.copy.dis.srcDir",[m
[31m-                dstDir = "entry.copy.dis.dstDir",[m
[31m-                srcPath = joinURL(root.fullPath, srcDir);[m
[32m+[m[32m                var srcDir = 'entry.copy.dis.srcDir';[m
[32m+[m[32m                var dstDir = 'entry.copy.dis.dstDir';[m
[32m+[m[32m                var srcPath = joinURL(root.fullPath, srcDir);[m
                 // create a new directory entry to kick off it[m
                 createDirectory(srcDir, function (directory) {[m
                     // copy source directory into itself[m
                     directory.copyTo(directory, dstDir, succeed.bind(null, done, 'directory.copyTo - Unexpected success callback, it should not copy a directory ' + srcDir + ' into itself'), function (error) {[m
                         expect(error).toBeDefined();[m
[31m-                        expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                        if (isChrome) {[m
[32m+[m[32m                            // chrome returns unknown error with code 13[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                        }[m
                         root.getDirectory(srcDir, {[m
[31m-                            create : false[m
[32m+[m[32m                            create: false[m
                         }, function (dirEntry) {[m
                             // returning confirms existence so just check fullPath entry[m
                             expect(dirEntry).toBeDefined();[m
[36m@@ -1501,45 +1571,49 @@[m [mexports.defineAutoTests = function () {[m
                     });[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + srcDir));[m
             });[m
[31m-            it("file.spec.63 copyTo: directory that does not exist", function (done) {[m
[31m-                var file1 = "entry.copy.dnf.file1",[m
[31m-                dirName = 'dir-foo';[m
[32m+[m[32m            it('file.spec.63 copyTo: directory that does not exist', function (done) {[m
[32m+[m[32m                var file1 = 'entry.copy.dnf.file1';[m
[32m+[m[32m                var dirName = 'dir-foo';[m
                 createFile(file1, function (fileEntry) {[m
                     createDirectory(dirName, function (dirEntry) {[m
                         dirEntry.remove(function () {[m
                             fileEntry.copyTo(dirEntry, null, succeed.bind(null, done, 'fileEntry.copyTo - Unexpected success callback, it should not copy a file ' + file1 + ' into a removed directory'), function (error) {[m
                                 expect(error).toBeDefined();[m
[31m-                                expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                                if (isChrome) {[m
[32m+[m[32m                                    expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                } else {[m
[32m+[m[32m                                    expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                }[m
                                 done();[m
                             });[m
                         }, failed.bind(null, done, 'dirEntry.remove - Error removing directory : ' + dirName));[m
                     }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + dirName));[m
                 }, failed.bind(null, done, 'createFile - Error creating file : ' + file1));[m
             });[m
[31m-            it("file.spec.64 copyTo: invalid target name", function (done) {[m
[32m+[m[32m            it('file.spec.64 copyTo: invalid target name', function (done) {[m
                 if (isBrowser) {[m
[31m-                    /*The plugin does not follow ["8.3 Naming restrictions"][m
[31m-                    (http://www.w3.org/TR/2011/WD-file-system-api-20110419/#naming-restrictions*/[m
[32m+[m[32m                    /* The plugin does not follow ["8.3 Naming restrictions"][m
[32m+[m[32m                    (http://www.w3.org/TR/2011/WD-file-system-api-20110419/#naming-restrictions */[m
                     pending();[m
                 }[m
 [m
[31m-                var file1 = "entry.copy.itn.file1",[m
[31m-                file2 = "bad:file:name";[m
[32m+[m[32m                var file1 = 'entry.copy.itn.file1';[m
[32m+[m[32m                var file2 = 'bad:file:name';[m
                 // create a new file entry[m
                 createFile(file1, function (entry) {[m
                     // copy file1 to file2[m
                     entry.copyTo(root, file2, succeed.bind(null, done, 'entry.copyTo - Unexpected success callback, it should not copy a file ' + file1 + ' to an invalid file name: ' + file2), function (error) {[m
                         expect(error).toBeDefined();[m
[31m-                        expect(error).toBeFileError(FileError.ENCODING_ERR);[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.ENCODING_ERR); // eslint-disable-line no-undef[m
                         // cleanup[m
                         deleteEntry(file1, done);[m
                     });[m
                 }, failed.bind(null, done, 'createFile - Error creating file : ' + file1));[m
             });[m
[31m-            it("file.spec.65 moveTo: file to same parent", function (done) {[m
[31m-                var file1 = "entry.move.fsp.file1",[m
[31m-                file2 = "entry.move.fsp.file2",[m
[31m-                dstPath = joinURL(root.fullPath, file2);[m
[32m+[m[32m            it('file.spec.65 moveTo: file to same parent', function (done) {[m
[32m+[m[32m                var file1 = 'entry.move.fsp.file1';[m
[32m+[m[32m                var file2 = 'entry.move.fsp.file2';[m
[32m+[m[32m                var dstPath = joinURL(root.fullPath, file2);[m
                 // create a new file entry to kick off it[m
                 createFile(file1, function (entry) {[m
                     // move file1 to file2[m
[36m@@ -1550,16 +1624,20 @@[m [mexports.defineAutoTests = function () {[m
                         expect(entry.fullPath).toCanonicallyMatch(dstPath);[m
                         expect(entry.name).toCanonicallyMatch(file2);[m
                         root.getFile(file2, {[m
[31m-                            create : false[m
[32m+[m[32m                            create: false[m
                         }, function (fileEntry) {[m
                             expect(fileEntry).toBeDefined();[m
                             expect(fileEntry.fullPath).toCanonicallyMatch(dstPath);[m
                             root.getFile(file1, {[m
[31m-                                create : false[m
[32m+[m[32m                                create: false[m
                             }, succeed.bind(null, done, 'root.getFile - Unexpected success callback, it should not get invalid or moved file: ' + file1), function (error) {[m
[31m-                                //expect(navigator.fileMgr.testFileExists(srcPath) === false, "original file should not exist.");[m
[32m+[m[32m                                // expect(navigator.fileMgr.testFileExists(srcPath) === false, "original file should not exist.");[m
                                 expect(error).toBeDefined();[m
[31m-                                expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                                if (isChrome) {[m
[32m+[m[32m                                    expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                } else {[m
[32m+[m[32m                                    expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                }[m
                                 // cleanup[m
                                 deleteEntry(file1, function () {[m
                                     deleteEntry(file2, done);[m
[36m@@ -1569,17 +1647,17 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'entry.moveTo - Error moving file : ' + file1 + ' to root as: ' + file2));[m
                 }, failed.bind(null, done, 'createFile - Error creating file : ' + file1));[m
             });[m
[31m-            it("file.spec.66 moveTo: file to new parent", function (done) {[m
[31m-                var file1 = "entry.move.fnp.file1",[m
[31m-                dir = "entry.move.fnp.dir",[m
[31m-                dstPath = joinURL(joinURL(root.fullPath, dir), file1);[m
[32m+[m[32m            it('file.spec.66 moveTo: file to new parent', function (done) {[m
[32m+[m[32m                var file1 = 'entry.move.fnp.file1';[m
[32m+[m[32m                var dir = 'entry.move.fnp.dir';[m
[32m+[m[32m                var dstPath = joinURL(joinURL(root.fullPath, dir), file1);[m
                 // ensure destination directory is cleaned up first[m
                 deleteEntry(dir, function () {[m
                     // create a new file entry to kick off it[m
                     createFile(file1, function (entry) {[m
                         // create a parent directory to move file to[m
                         root.getDirectory(dir, {[m
[31m-                            create : true[m
[32m+[m[32m                            create: true[m
                         }, function (directory) {[m
                             // move file1 to new directory[m
                             // move the file[m
[36m@@ -1591,15 +1669,19 @@[m [mexports.defineAutoTests = function () {[m
                                 expect(entry.name).toCanonicallyMatch(file1);[m
                                 // test the moved file exists[m
                                 directory.getFile(file1, {[m
[31m-                                    create : false[m
[32m+[m[32m                                    create: false[m
                                 }, function (fileEntry) {[m
                                     expect(fileEntry).toBeDefined();[m
                                     expect(fileEntry.fullPath).toCanonicallyMatch(dstPath);[m
                                     root.getFile(file1, {[m
[31m-                                        create : false[m
[32m+[m[32m                                        create: false[m
                                     }, succeed.bind(null, done, 'root.getFile - Unexpected success callback, it should not get invalid or moved file: ' + file1), function (error) {[m
                                         expect(error).toBeDefined();[m
[31m-                                        expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                                        if (isChrome) {[m
[32m+[m[32m                                            expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                        } else {[m
[32m+[m[32m                                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                        }[m
                                         // cleanup[m
                                         deleteEntry(file1, function () {[m
                                             deleteEntry(dir, done);[m
[36m@@ -1611,24 +1693,24 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'createFile - Error creating file : ' + file1));[m
                 }, failed.bind(null, done, 'deleteEntry - Error removing directory : ' + dir));[m
             });[m
[31m-            it("file.spec.67 moveTo: directory to same parent", function (done) {[m
[32m+[m[32m            it('file.spec.67 moveTo: directory to same parent', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var file1 = "file1",[m
[31m-                srcDir = "entry.move.dsp.srcDir",[m
[31m-                dstDir = "entry.move.dsp.dstDir",[m
[31m-                dstPath = joinURL(root.fullPath, dstDir),[m
[31m-                filePath = joinURL(dstPath, file1);[m
[32m+[m[32m                var file1 = 'file1';[m
[32m+[m[32m                var srcDir = 'entry.move.dsp.srcDir';[m
[32m+[m[32m                var dstDir = 'entry.move.dsp.dstDir';[m
[32m+[m[32m                var dstPath = joinURL(root.fullPath, dstDir);[m
[32m+[m[32m                var filePath = joinURL(dstPath, file1);[m
                 // ensure destination directory is cleaned up before it[m
                 deleteEntry(dstDir, function () {[m
                     // create a new directory entry to kick off it[m
                     createDirectory(srcDir, function (directory) {[m
                         // create a file within directory[m
                         directory.getFile(file1, {[m
[31m-                            create : true[m
[32m+[m[32m                            create: true[m
                         }, function () {[m
                             // move srcDir to dstDir[m
                             directory.moveTo(root, dstDir, function (directory) {[m
[36m@@ -1639,18 +1721,22 @@[m [mexports.defineAutoTests = function () {[m
                                 expect(directory.name).toCanonicallyMatch(dstDir);[m
                                 // test that moved file exists in destination dir[m
                                 directory.getFile(file1, {[m
[31m-                                    create : false[m
[32m+[m[32m                                    create: false[m
                                 }, function (fileEntry) {[m
                                     expect(fileEntry).toBeDefined();[m
                                     expect(fileEntry.fullPath).toCanonicallyMatch(filePath);[m
                                     // check that the moved file no longer exists in original dir[m
                                     root.getFile(file1, {[m
[31m-                                        create : false[m
[32m+[m[32m                                        create: false[m
                                     }, succeed.bind(null, done, 'directory.getFile - Unexpected success callback, it should not get invalid or moved file: ' + file1), function (error) {[m
                                         expect(error).toBeDefined();[m
[31m-                                        expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                                        if (isChrome) {[m
[32m+[m[32m                                            expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                        } else {[m
[32m+[m[32m                                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                        }[m
                                         // cleanup[m
[31m-                                        deleteEntry(srcDir, function() {[m
[32m+[m[32m                                        deleteEntry(srcDir, function () {[m
                                             deleteEntry(dstDir, done);[m
                                         });[m
                                     });[m
[36m@@ -1660,24 +1746,24 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + srcDir));[m
                 }, failed.bind(null, done, 'deleteEntry - Error removing directory : ' + dstDir));[m
             });[m
[31m-            it("file.spec.68 moveTo: directory to same parent with same name", function (done) {[m
[32m+[m[32m            it('file.spec.68 moveTo: directory to same parent with same name', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var file1 = "file1",[m
[31m-                srcDir = "entry.move.dsp.srcDir",[m
[31m-                dstDir = "entry.move.dsp.srcDir-backup",[m
[31m-                dstPath = joinURL(root.fullPath, dstDir),[m
[31m-                filePath = joinURL(dstPath, file1);[m
[32m+[m[32m                var file1 = 'file1';[m
[32m+[m[32m                var srcDir = 'entry.move.dsp.srcDir';[m
[32m+[m[32m                var dstDir = 'entry.move.dsp.srcDir-backup';[m
[32m+[m[32m                var dstPath = joinURL(root.fullPath, dstDir);[m
[32m+[m[32m                var filePath = joinURL(dstPath, file1);[m
                 // ensure destination directory is cleaned up before it[m
                 deleteEntry(dstDir, function () {[m
                     // create a new directory entry to kick off it[m
                     createDirectory(srcDir, function (directory) {[m
                         // create a file within directory[m
                         directory.getFile(file1, {[m
[31m-                            create : true[m
[32m+[m[32m                            create: true[m
                         }, function () {[m
                             // move srcDir to dstDir[m
                             directory.moveTo(root, dstDir, function (directory) {[m
[36m@@ -1688,18 +1774,22 @@[m [mexports.defineAutoTests = function () {[m
                                 expect(directory.name).toCanonicallyMatch(dstDir);[m
                                 // check that moved file exists in destination dir[m
                                 directory.getFile(file1, {[m
[31m-                                    create : false[m
[32m+[m[32m                                    create: false[m
                                 }, function (fileEntry) {[m
                                     expect(fileEntry).toBeDefined();[m
                                     expect(fileEntry.fullPath).toCanonicallyMatch(filePath);[m
                                     // check that the moved file no longer exists in original dir[m
                                     root.getFile(file1, {[m
[31m-                                        create : false[m
[32m+[m[32m                                        create: false[m
                                     }, succeed.bind(null, done, 'directory.getFile - Unexpected success callback, it should not get invalid or moved file: ' + file1), function (error) {[m
                                         expect(error).toBeDefined();[m
[31m-                                        expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                                        if (isChrome) {[m
[32m+[m[32m                                            expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                        } else {[m
[32m+[m[32m                                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                        }[m
                                         // cleanup[m
[31m-                                        deleteEntry(srcDir, function() {[m
[32m+[m[32m                                        deleteEntry(srcDir, function () {[m
                                             deleteEntry(dstDir, done);[m
                                         });[m
                                     });[m
[36m@@ -1709,24 +1799,24 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + srcDir));[m
                 }, failed.bind(null, done, 'deleteEntry - Error removing directory : ' + dstDir));[m
             });[m
[31m-            it("file.spec.69 moveTo: directory to new parent", function (done) {[m
[32m+[m[32m            it('file.spec.69 moveTo: directory to new parent', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var file1 = "file1",[m
[31m-                srcDir = "entry.move.dnp.srcDir",[m
[31m-                dstDir = "entry.move.dnp.dstDir",[m
[31m-                dstPath = joinURL(root.fullPath, dstDir),[m
[31m-                filePath = joinURL(dstPath, file1);[m
[32m+[m[32m                var file1 = 'file1';[m
[32m+[m[32m                var srcDir = 'entry.move.dnp.srcDir';[m
[32m+[m[32m                var dstDir = 'entry.move.dnp.dstDir';[m
[32m+[m[32m                var dstPath = joinURL(root.fullPath, dstDir);[m
[32m+[m[32m                var filePath = joinURL(dstPath, file1);[m
                 // ensure destination directory is cleaned up before it[m
                 deleteEntry(dstDir, function () {[m
                     // create a new directory entry to kick off it[m
                     createDirectory(srcDir, function (directory) {[m
                         // create a file within directory[m
                         directory.getFile(file1, {[m
[31m-                            create : true[m
[32m+[m[32m                            create: true[m
                         }, function () {[m
                             // move srcDir to dstDir[m
                             directory.moveTo(root, dstDir, function (dirEntry) {[m
[36m@@ -1737,18 +1827,22 @@[m [mexports.defineAutoTests = function () {[m
                                 expect(dirEntry.name).toCanonicallyMatch(dstDir);[m
                                 // test that moved file exists in destination dir[m
                                 dirEntry.getFile(file1, {[m
[31m-                                    create : false[m
[32m+[m[32m                                    create: false[m
                                 }, function (fileEntry) {[m
                                     expect(fileEntry).toBeDefined();[m
                                     expect(fileEntry.fullPath).toCanonicallyMatch(filePath);[m
                                     // test that the moved file no longer exists in original dir[m
                                     root.getFile(file1, {[m
[31m-                                        create : false[m
[32m+[m[32m                                        create: false[m
                                     }, succeed.bind(null, done, 'root.getFile - Unexpected success callback, it should not get invalid or moved file: ' + file1), function (error) {[m
                                         expect(error).toBeDefined();[m
[31m-                                        expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                                        if (isChrome) {[m
[32m+[m[32m                                            expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                        } else {[m
[32m+[m[32m                                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                        }[m
                                         // cleanup[m
[31m-                                        deleteEntry(srcDir, function() {[m
[32m+[m[32m                                        deleteEntry(srcDir, function () {[m
                                             deleteEntry(dstDir, done);[m
                                         });[m
                                     });[m
[36m@@ -1759,27 +1853,29 @@[m [mexports.defineAutoTests = function () {[m
                 }, failed.bind(null, done, 'deleteEntry - Error removing directory : ' + dstDir));[m
             });[m
 [m
[31m-            it("file.spec.131 moveTo: directories tree to new parent", function (done) {[m
[32m+[m[32m            it('file.spec.131 moveTo: directories tree to new parent', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var srcDir = "entry.move.dnp.srcDir";[m
[31m-                var srcDirNestedFirst = "entry.move.dnp.srcDir.Nested1";[m
[31m-                var srcDirNestedSecond = "entry.move.dnp.srcDir.Nested2";[m
[31m-                var dstDir = "entry.move.dnp.dstDir";[m
[32m+[m[32m                var srcDir = 'entry.move.dnp.srcDir';[m
[32m+[m[32m                var srcDirNestedFirst = 'entry.move.dnp.srcDir.Nested1';[m
[32m+[m[32m                var srcDirNestedSecond = 'entry.move.dnp.srcDir.Nested2';[m
[32m+[m[32m                var dstDir = 'entry.move.dnp.dstDir';[m
 [m
                 createDirectory(dstDir, function (dstDirectory) {[m
                     createDirectory(srcDir, function (srcDirectory) {[m
                         srcDirectory.getDirectory(srcDirNestedFirst, { create: true }, function () {[m
                             srcDirectory.getDirectory(srcDirNestedSecond, { create: true }, function () {[m
[31m-                                srcDirectory.moveTo(dstDirectory, srcDir, function successMove(transferredDirectory) {[m
[32m+[m[32m                                srcDirectory.moveTo(dstDirectory, srcDir, function successMove (transferredDirectory) {[m
                                     var directoryReader = transferredDirectory.createReader();[m
[31m-                                    directoryReader.readEntries(function successRead(entries) {[m
[32m+[m[32m                                    directoryReader.readEntries(function successRead (entries) {[m
                                         expect(entries.length).toBe(2);[m
[31m-                                        expect(entries[0].name).toBe(srcDirNestedFirst);[m
[31m-                                        expect(entries[1].name).toBe(srcDirNestedSecond);[m
[32m+[m[32m                                        if (!isChrome) {[m
[32m+[m[32m                                            expect(entries[0].name).toBe(srcDirNestedFirst);[m
[32m+[m[32m                                            expect(entries[1].name).toBe(srcDirNestedSecond);[m
[32m+[m[32m                                        }[m
                                         deleteEntry(dstDir, done);[m
                                     }, failed.bind(null, done, 'Error getting entries from: ' + transferredDirectory));[m
                                 }, failed.bind(null, done, 'directory.moveTo - Error moving directory : ' + srcDir + ' to root as: ' + dstDir));[m
[36m@@ -1789,35 +1885,39 @@[m [mexports.defineAutoTests = function () {[m
                 }, failed.bind(null, done, 'createDirectory - Error creating dest directory : ' + dstDir));[m
             });[m
 [m
[31m-            it("file.spec.70 moveTo: directory onto itself", function (done) {[m
[32m+[m[32m            it('file.spec.70 moveTo: directory onto itself', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var file1 = "file1",[m
[31m-                srcDir = "entry.move.dos.srcDir",[m
[31m-                srcPath = joinURL(root.fullPath, srcDir),[m
[31m-                filePath = joinURL(srcPath, file1);[m
[32m+[m[32m                var file1 = 'file1';[m
[32m+[m[32m                var srcDir = 'entry.move.dos.srcDir';[m
[32m+[m[32m                var srcPath = joinURL(root.fullPath, srcDir);[m
[32m+[m[32m                var filePath = joinURL(srcPath, file1);[m
                 // create a new directory entry to kick off it[m
                 createDirectory(srcDir, function (directory) {[m
                     // create a file within new directory[m
                     directory.getFile(file1, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function () {[m
                         // move srcDir onto itself[m
                         directory.moveTo(root, null, succeed.bind(null, done, 'directory.moveTo - Unexpected success callback, it should not move directory to invalid path'), function (error) {[m
                             expect(error).toBeDefined();[m
[31m-                            expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                            if (isChrome) {[m
[32m+[m[32m                                // chrome returns unknown error with code 13[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            }[m
                             // test that original dir still exists[m
                             root.getDirectory(srcDir, {[m
[31m-                                create : false[m
[32m+[m[32m                                create: false[m
                             }, function (dirEntry) {[m
                                 // returning confirms existence so just check fullPath entry[m
                                 expect(dirEntry).toBeDefined();[m
                                 expect(dirEntry.fullPath).toCanonicallyMatch(srcPath);[m
                                 dirEntry.getFile(file1, {[m
[31m-                                    create : false[m
[32m+[m[32m                                    create: false[m
                                 }, function (fileEntry) {[m
                                     expect(fileEntry).toBeDefined();[m
                                     expect(fileEntry.fullPath).toCanonicallyMatch(filePath);[m
[36m@@ -1829,24 +1929,28 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'directory.getFile - Error creating file : ' + file1));[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + srcDir));[m
             });[m
[31m-            it("file.spec.71 moveTo: directory into itself", function (done) {[m
[32m+[m[32m            it('file.spec.71 moveTo: directory into itself', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var srcDir = "entry.move.dis.srcDir",[m
[31m-                dstDir = "entry.move.dis.dstDir",[m
[31m-                srcPath = joinURL(root.fullPath, srcDir);[m
[32m+[m[32m                var srcDir = 'entry.move.dis.srcDir';[m
[32m+[m[32m                var dstDir = 'entry.move.dis.dstDir';[m
[32m+[m[32m                var srcPath = joinURL(root.fullPath, srcDir);[m
                 // create a new directory entry to kick off it[m
                 createDirectory(srcDir, function (directory) {[m
                     // move source directory into itself[m
                     directory.moveTo(directory, dstDir, succeed.bind(null, done, 'directory.moveTo - Unexpected success callback, it should not move a directory into itself: ' + srcDir), function (error) {[m
                         expect(error).toBeDefined();[m
[31m-                        expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                        if (isChrome) {[m
[32m+[m[32m                            // chrome returns unknown error with code 13[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                        }[m
                         // make sure original directory still exists[m
                         root.getDirectory(srcDir, {[m
[31m-                            create : false[m
[32m+[m[32m                            create: false[m
                         }, function (entry) {[m
                             expect(entry).toBeDefined();[m
                             expect(entry.fullPath).toCanonicallyMatch(srcPath);[m
[36m@@ -1856,39 +1960,43 @@[m [mexports.defineAutoTests = function () {[m
                     });[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + srcDir));[m
             });[m
[31m-            it("file.spec.130 moveTo: directory into similar directory", function (done) {[m
[32m+[m[32m            it('file.spec.130 moveTo: directory into similar directory', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var srcDir = "entry.move.dis.srcDir",[m
[31m-                dstDir = "entry.move.dis.srcDir-backup";[m
[32m+[m[32m                var srcDir = 'entry.move.dis.srcDir';[m
[32m+[m[32m                var dstDir = 'entry.move.dis.srcDir-backup';[m
                 // create a new directory entry to kick off it[m
                 createDirectory(srcDir, function (srcDirEntry) {[m
[31m-                deleteEntry(dstDir, function () {[m
[31m-                createDirectory(dstDir, function (dstDirEntry) {[m
[32m+[m[32m                    deleteEntry(dstDir, function () {[m
[32m+[m[32m                        createDirectory(dstDir, function (dstDirEntry) {[m
                     // move source directory into itself[m
[31m-                    srcDirEntry.moveTo(dstDirEntry, 'file', function (newDirEntry) {[m
[31m-                        expect(newDirEntry).toBeDefined();[m
[31m-                        deleteEntry(dstDir, done);[m
[31m-                    }, failed.bind(null, done, 'directory.moveTo - Error moving a directory into a similarly-named directory: ' + srcDir));[m
[31m-                }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + dstDir));[m
[31m-                }, failed.bind(null, done, 'deleteEntry - Error deleting directory : ' + dstDir));[m
[32m+[m[32m                            srcDirEntry.moveTo(dstDirEntry, 'file', function (newDirEntry) {[m
[32m+[m[32m                                expect(newDirEntry).toBeDefined();[m
[32m+[m[32m                                deleteEntry(dstDir, done);[m
[32m+[m[32m                            }, failed.bind(null, done, 'directory.moveTo - Error moving a directory into a similarly-named directory: ' + srcDir));[m
[32m+[m[32m                        }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + dstDir));[m
[32m+[m[32m                    }, failed.bind(null, done, 'deleteEntry - Error deleting directory : ' + dstDir));[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + srcDir));[m
             });[m
[31m-            it("file.spec.72 moveTo: file onto itself", function (done) {[m
[31m-                var file1 = "entry.move.fos.file1",[m
[31m-                filePath = joinURL(root.fullPath, file1);[m
[32m+[m[32m            it('file.spec.72 moveTo: file onto itself', function (done) {[m
[32m+[m[32m                var file1 = 'entry.move.fos.file1';[m
[32m+[m[32m                var filePath = joinURL(root.fullPath, file1);[m
                 // create a new file entry to kick off it[m
                 createFile(file1, function (entry) {[m
                     // move file1 onto itself[m
                     entry.moveTo(root, null, succeed.bind(null, done, 'entry.moveTo - Unexpected success callback, it should not move a file: ' + file1 + ' into the same parent'), function (error) {[m
                         expect(error).toBeDefined();[m
[31m-                        expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[31m-                        //test that original file still exists[m
[32m+[m[32m                        if (isChrome) {[m
[32m+[m[32m                            // chrome returns unknown error with code 13[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                        }[m
[32m+[m[32m                        // test that original file still exists[m
                         root.getFile(file1, {[m
[31m-                            create : false[m
[32m+[m[32m                            create: false[m
                         }, function (fileEntry) {[m
                             expect(fileEntry).toBeDefined();[m
                             expect(fileEntry.fullPath).toCanonicallyMatch(filePath);[m
[36m@@ -1898,37 +2006,41 @@[m [mexports.defineAutoTests = function () {[m
                     });[m
                 }, failed.bind(null, done, 'createFile - Error creating file : ' + file1));[m
             });[m
[31m-            it("file.spec.73 moveTo: file onto existing directory", function (done) {[m
[31m-                var file1 = "entry.move.fod.file1",[m
[31m-                dstDir = "entry.move.fod.dstDir",[m
[31m-                subDir = "subDir",[m
[31m-                dirPath = joinURL(joinURL(root.fullPath, dstDir), subDir),[m
[31m-                filePath = joinURL(root.fullPath, file1);[m
[32m+[m[32m            it('file.spec.73 moveTo: file onto existing directory', function (done) {[m
[32m+[m[32m                var file1 = 'entry.move.fod.file1';[m
[32m+[m[32m                var dstDir = 'entry.move.fod.dstDir';[m
[32m+[m[32m                var subDir = 'subDir';[m
[32m+[m[32m                var dirPath = joinURL(joinURL(root.fullPath, dstDir), subDir);[m
[32m+[m[32m                var filePath = joinURL(root.fullPath, file1);[m
                 // ensure destination directory is cleaned up before it[m
                 deleteEntry(dstDir, function () {[m
                     // create a new file entry to kick off it[m
                     createFile(file1, function (entry) {[m
                         // create top level directory[m
                         root.getDirectory(dstDir, {[m
[31m-                            create : true[m
[32m+[m[32m                            create: true[m
                         }, function (directory) {[m
                             // create sub-directory[m
                             directory.getDirectory(subDir, {[m
[31m-                                create : true[m
[32m+[m[32m                                create: true[m
                             }, function (subDirectory) {[m
                                 // move file1 onto sub-directory[m
                                 entry.moveTo(directory, subDir, succeed.bind(null, done, 'entry.moveTo - Unexpected success callback, it should not move a file: ' + file1 + ' into directory: ' + dstDir + '\n' + subDir + ' directory already exists'), function (error) {[m
                                     expect(error).toBeDefined();[m
[31m-                                    expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                                    if (isChrome) {[m
[32m+[m[32m                                        // chrome returns unknown error with code 13[m
[32m+[m[32m                                    } else {[m
[32m+[m[32m                                        expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                    }[m
                                     // check that original dir still exists[m
                                     directory.getDirectory(subDir, {[m
[31m-                                        create : false[m
[32m+[m[32m                                        create: false[m
                                     }, function (dirEntry) {[m
                                         expect(dirEntry).toBeDefined();[m
                                         expect(dirEntry.fullPath).toCanonicallyMatch(dirPath);[m
                                         // check that original file still exists[m
                                         root.getFile(file1, {[m
[31m-                                            create : false[m
[32m+[m[32m                                            create: false[m
                                         }, function (fileEntry) {[m
                                             expect(fileEntry).toBeDefined();[m
                                             expect(fileEntry.fullPath).toCanonicallyMatch(filePath);[m
[36m@@ -1944,36 +2056,40 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'createFile - Error creating file : ' + file1));[m
                 }, failed.bind(null, done, 'deleteEntry - Error removing directory : ' + dstDir));[m
             });[m
[31m-            it("file.spec.74 moveTo: directory onto existing file", function (done) {[m
[32m+[m[32m            it('file.spec.74 moveTo: directory onto existing file', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var file1 = "entry.move.dof.file1",[m
[31m-                srcDir = "entry.move.dof.srcDir",[m
[31m-                dirPath = joinURL(root.fullPath, srcDir),[m
[31m-                filePath = joinURL(root.fullPath, file1);[m
[32m+[m[32m                var file1 = 'entry.move.dof.file1';[m
[32m+[m[32m                var srcDir = 'entry.move.dof.srcDir';[m
[32m+[m[32m                var dirPath = joinURL(root.fullPath, srcDir);[m
[32m+[m[32m                var filePath = joinURL(root.fullPath, file1);[m
                 // create a new directory entry to kick off it[m
                 createDirectory(srcDir, function (entry) {[m
                     // create file[m
                     root.getFile(file1, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function (fileEntry) {[m
                         // move directory onto file[m
                         entry.moveTo(root, file1, succeed.bind(null, done, 'entry.moveTo - Unexpected success callback, it should not move : \n' + srcDir + ' into root directory renamed as ' + file1 + '\n' + file1 + ' file already exists'), function (error) {[m
                             expect(error).toBeDefined();[m
[31m-                            expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                            if (isChrome) {[m
[32m+[m[32m                                // chrome returns unknown error with code 13[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            }[m
                             // test that original directory exists[m
                             root.getDirectory(srcDir, {[m
[31m-                                create : false[m
[32m+[m[32m                                create: false[m
                             }, function (dirEntry) {[m
                                 // returning confirms existence so just check fullPath entry[m
                                 expect(dirEntry).toBeDefined();[m
                                 expect(dirEntry.fullPath).toCanonicallyMatch(dirPath);[m
                                 // test that original file exists[m
                                 root.getFile(file1, {[m
[31m-                                    create : false[m
[32m+[m[32m                                    create: false[m
                                 }, function (fileEntry) {[m
                                     expect(fileEntry).toBeDefined();[m
                                     expect(fileEntry.fullPath).toCanonicallyMatch(filePath);[m
[36m@@ -1987,36 +2103,40 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'root.getFile - Error creating file : ' + file1));[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + srcDir));[m
             });[m
[31m-            it("file.spec.75 copyTo: directory onto existing file", function (done) {[m
[32m+[m[32m            it('file.spec.75 copyTo: directory onto existing file', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var file1 = "entry.copy.dof.file1",[m
[31m-                srcDir = "entry.copy.dof.srcDir",[m
[31m-                dirPath = joinURL(root.fullPath, srcDir),[m
[31m-                filePath = joinURL(root.fullPath, file1);[m
[32m+[m[32m                var file1 = 'entry.copy.dof.file1';[m
[32m+[m[32m                var srcDir = 'entry.copy.dof.srcDir';[m
[32m+[m[32m                var dirPath = joinURL(root.fullPath, srcDir);[m
[32m+[m[32m                var filePath = joinURL(root.fullPath, file1);[m
                 // create a new directory entry to kick off it[m
                 createDirectory(srcDir, function (entry) {[m
                     // create file[m
                     root.getFile(file1, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function () {[m
                         // copy directory onto file[m
                         entry.copyTo(root, file1, succeed.bind(null, done, 'entry.copyTo - Unexpected success callback, it should not copy : \n' + srcDir + ' into root directory renamed as ' + file1 + '\n' + file1 + ' file already exists'), function (error) {[m
                             expect(error).toBeDefined();[m
[31m-                            expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[31m-                            //check that original dir still exists[m
[32m+[m[32m                            if (isChrome) {[m
[32m+[m[32m                                // chrome returns unknown error with code 13[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                            }[m
[32m+[m[32m                            // check that original dir still exists[m
                             root.getDirectory(srcDir, {[m
[31m-                                create : false[m
[32m+[m[32m                                create: false[m
                             }, function (dirEntry) {[m
                                 // returning confirms existence so just check fullPath entry[m
                                 expect(dirEntry).toBeDefined();[m
                                 expect(dirEntry.fullPath).toCanonicallyMatch(dirPath);[m
                                 // test that original file still exists[m
                                 root.getFile(file1, {[m
[31m-                                    create : false[m
[32m+[m[32m                                    create: false[m
                                 }, function (fileEntry) {[m
                                     expect(fileEntry).toBeDefined();[m
                                     expect(fileEntry.fullPath).toCanonicallyMatch(filePath);[m
[36m@@ -2030,43 +2150,47 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'root.getFile - Error creating file : ' + file1));[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + srcDir));[m
             });[m
[31m-            it("file.spec.76 moveTo: directory onto directory that is not empty", function (done) {[m
[32m+[m[32m            it('file.spec.76 moveTo: directory onto directory that is not empty', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var srcDir = "entry.move.dod.srcDir",[m
[31m-                dstDir = "entry.move.dod.dstDir",[m
[31m-                subDir = "subDir",[m
[31m-                srcPath = joinURL(root.fullPath, srcDir),[m
[31m-                dstPath = joinURL(joinURL(root.fullPath, dstDir), subDir);[m
[32m+[m[32m                var srcDir = 'entry.move.dod.srcDir';[m
[32m+[m[32m                var dstDir = 'entry.move.dod.dstDir';[m
[32m+[m[32m                var subDir = 'subDir';[m
[32m+[m[32m                var srcPath = joinURL(root.fullPath, srcDir);[m
[32m+[m[32m                var dstPath = joinURL(joinURL(root.fullPath, dstDir), subDir);[m
                 // ensure destination directory is cleaned up before it[m
                 deleteEntry(dstDir, function () {[m
                     // create a new file entry to kick off it[m
                     createDirectory(srcDir, function (entry) {[m
                         // create top level directory[m
                         root.getDirectory(dstDir, {[m
[31m-                            create : true[m
[32m+[m[32m                            create: true[m
                         }, function (directory) {[m
                             // create sub-directory[m
                             directory.getDirectory(subDir, {[m
[31m-                                create : true[m
[32m+[m[32m                                create: true[m
                             }, function () {[m
                                 // move srcDir onto dstDir (not empty)[m
                                 entry.moveTo(root, dstDir, succeed.bind(null, done, 'entry.moveTo - Unexpected success callback, it should not copy : \n' + srcDir + ' into root directory renamed as ' + dstDir + '\n' + dstDir + ' directory already exists'), function (error) {[m
                                     expect(error).toBeDefined();[m
[31m-                                    expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                                    if (isChrome) {[m
[32m+[m[32m                                        // chrome returns unknown error with code 13[m
[32m+[m[32m                                    } else {[m
[32m+[m[32m                                        expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                    }[m
                                     // making sure destination directory still exists[m
                                     directory.getDirectory(subDir, {[m
[31m-                                        create : false[m
[32m+[m[32m                                        create: false[m
                                     }, function (dirEntry) {[m
                                         // returning confirms existence so just check fullPath entry[m
                                         expect(dirEntry).toBeDefined();[m
                                         expect(dirEntry.fullPath).toCanonicallyMatch(dstPath);[m
                                         // making sure source directory exists[m
                                         root.getDirectory(srcDir, {[m
[31m-                                            create : false[m
[32m+[m[32m                                            create: false[m
                                         }, function (srcEntry) {[m
                                             expect(srcEntry).toBeDefined();[m
                                             expect(srcEntry.fullPath).toCanonicallyMatch(srcPath);[m
[36m@@ -2082,15 +2206,15 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'createDirectory - Error creating directory : ' + srcDir));[m
                 }, failed.bind(null, done, 'deleteEntry - Error removing directory : ' + dstDir));[m
             });[m
[31m-            it("file.spec.77 moveTo: file replace existing file", function (done) {[m
[31m-                var file1 = "entry.move.frf.file1",[m
[31m-                file2 = "entry.move.frf.file2",[m
[31m-                file2Path = joinURL(root.fullPath, file2);[m
[32m+[m[32m            it('file.spec.77 moveTo: file replace existing file', function (done) {[m
[32m+[m[32m                var file1 = 'entry.move.frf.file1';[m
[32m+[m[32m                var file2 = 'entry.move.frf.file2';[m
[32m+[m[32m                var file2Path = joinURL(root.fullPath, file2);[m
                 // create a new directory entry to kick off it[m
                 createFile(file1, function (entry) {[m
                     // create file[m
                     root.getFile(file2, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function () {[m
                         // replace file2 with file1[m
                         entry.moveTo(root, file2, function (entry2) {[m
[36m@@ -2101,13 +2225,17 @@[m [mexports.defineAutoTests = function () {[m
                             expect(entry2.name).toCanonicallyMatch(file2);[m
                             // old file should not exists[m
                             root.getFile(file1, {[m
[31m-                                create : false[m
[32m+[m[32m                                create: false[m
                             }, succeed.bind(null, done, 'root.getFile - Unexpected success callback, file: ' + file1 + ' should not exists'), function (error) {[m
                                 expect(error).toBeDefined();[m
[31m-                                expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                                if (isChrome) {[m
[32m+[m[32m                                    expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                } else {[m
[32m+[m[32m                                    expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                }[m
                                 // test that new file exists[m
                                 root.getFile(file2, {[m
[31m-                                    create : false[m
[32m+[m[32m                                    create: false[m
                                 }, function (fileEntry) {[m
                                     expect(fileEntry).toBeDefined();[m
                                     expect(fileEntry.fullPath).toCanonicallyMatch(file2Path);[m
[36m@@ -2121,28 +2249,28 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'root.getFile - Error creating file: ' + file2));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + file1));[m
             });[m
[31m-            it("file.spec.78 moveTo: directory replace empty directory", function (done) {[m
[32m+[m[32m            it('file.spec.78 moveTo: directory replace empty directory', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `copyTo` and `moveTo` functions do not support directories (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var file1 = "file1",[m
[31m-                srcDir = "entry.move.drd.srcDir",[m
[31m-                dstDir = "entry.move.drd.dstDir",[m
[31m-                dstPath = joinURL(root.fullPath, dstDir),[m
[31m-                filePath = dstPath + '/' + file1;[m
[32m+[m[32m                var file1 = 'file1';[m
[32m+[m[32m                var srcDir = 'entry.move.drd.srcDir';[m
[32m+[m[32m                var dstDir = 'entry.move.drd.dstDir';[m
[32m+[m[32m                var dstPath = joinURL(root.fullPath, dstDir);[m
[32m+[m[32m                var filePath = dstPath + '/' + file1;[m
                 // ensure destination directory is cleaned up before it[m
                 deleteEntry(dstDir, function () {[m
                     // create a new directory entry to kick off it[m
                     createDirectory(srcDir, function (directory) {[m
                         // create a file within source directory[m
                         directory.getFile(file1, {[m
[31m-                            create : true[m
[32m+[m[32m                            create: true[m
                         }, function () {[m
                             // create destination directory[m
                             root.getDirectory(dstDir, {[m
[31m-                                create : true[m
[32m+[m[32m                                create: true[m
                             }, function () {[m
                                 // move srcDir to dstDir[m
                                 directory.moveTo(root, dstDir, function (dirEntry) {[m
[36m@@ -2153,16 +2281,20 @@[m [mexports.defineAutoTests = function () {[m
                                     expect(dirEntry.name).toCanonicallyMatch(dstDir);[m
                                     // check that old directory contents have been moved[m
                                     dirEntry.getFile(file1, {[m
[31m-                                        create : false[m
[32m+[m[32m                                        create: false[m
                                     }, function (fileEntry) {[m
                                         expect(fileEntry).toBeDefined();[m
                                         expect(fileEntry.fullPath).toCanonicallyMatch(filePath);[m
                                         // check that old directory no longer exists[m
                                         root.getDirectory(srcDir, {[m
[31m-                                            create : false[m
[32m+[m[32m                                            create: false[m
                                         }, succeed.bind(null, done, 'root.getDirectory - Unexpected success callback, directory: ' + srcDir + ' should not exists'), function (error) {[m
                                             expect(error).toBeDefined();[m
[31m-                                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                                            if (isChrome) {[m
[32m+[m[32m                                                expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                            } else {[m
[32m+[m[32m                                                expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                                            }[m
                                             // cleanup[m
                                             deleteEntry(srcDir, function () {[m
                                                 deleteEntry(dstDir, done);[m
[36m@@ -2175,56 +2307,58 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'createDirectory - Error creating directory: ' + srcDir));[m
                 }, failed.bind(null, done, 'deleteEntry - Error removing directory : ' + dstDir));[m
             });[m
[31m-            it("file.spec.79 moveTo: directory that does not exist", function (done) {[m
[31m-[m
[31m-                var file1 = "entry.move.dnf.file1",[m
[31m-                dstDir = "entry.move.dnf.dstDir",[m
[31m-                dstPath = joinURL(root.fullPath, dstDir);[m
[32m+[m[32m            it('file.spec.79 moveTo: directory that does not exist', function (done) {[m
[32m+[m[32m                if (isChrome) {[m
[32m+[m[32m                    pending('chrome freak out about non-existend dir not being a DirectoryEntry');[m
[32m+[m[32m                }[m
[32m+[m[32m                var file1 = 'entry.move.dnf.file1';[m
[32m+[m[32m                var dstDir = 'entry.move.dnf.dstDir';[m
[32m+[m[32m                var dstPath = joinURL(root.fullPath, dstDir);[m
                 // create a new file entry to kick off it[m
                 createFile(file1, function (entry) {[m
                     // move file to directory that does not exist[m
[31m-                    var directory = new DirectoryEntry();[m
[32m+[m[32m                    var directory = new DirectoryEntry(); // eslint-disable-line no-undef[m
                     directory.filesystem = root.filesystem;[m
                     directory.fullPath = dstPath;[m
                     entry.moveTo(directory, null, succeed.bind(null, done, 'entry.moveTo - Unexpected success callback, parent directory: ' + dstPath + ' should not exists'), function (error) {[m
                         expect(error).toBeDefined();[m
                         if (isChrome) {[m
[31m-                            /*INVALID_MODIFICATION_ERR (code: 9) is thrown instead of NOT_FOUND_ERR(code: 1)[m
[31m-                            on trying to moveTo directory that does not exist.*/[m
[31m-                            expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR);[m
[32m+[m[32m                            /* INVALID_MODIFICATION_ERR (code: 9) is thrown instead of NOT_FOUND_ERR(code: 1)[m
[32m+[m[32m                            on trying to moveTo directory that does not exist. */[m
[32m+[m[32m                            expect(error).toBeFileError(FileError.INVALID_MODIFICATION_ERR); // eslint-disable-line no-undef[m
                         } else {[m
[31m-                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                            expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
                         }[m
                         // cleanup[m
                         deleteEntry(file1, done);[m
                     });[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + file1));[m
             });[m
[31m-            it("file.spec.80 moveTo: invalid target name", function (done) {[m
[32m+[m[32m            it('file.spec.80 moveTo: invalid target name', function (done) {[m
                 if (isBrowser) {[m
[31m-                    /*The plugin does not follow ["8.3 Naming restrictions"][m
[31m-                    (http://www.w3.org/TR/2011/WD-file-system-api-20110419/#naming-restrictions*/[m
[32m+[m[32m                    /* The plugin does not follow ["8.3 Naming restrictions"][m
[32m+[m[32m                    (http://www.w3.org/TR/2011/WD-file-system-api-20110419/#naming-restrictions */[m
                     pending();[m
                 }[m
 [m
[31m-                var file1 = "entry.move.itn.file1",[m
[31m-                file2 = "bad:file:name";[m
[32m+[m[32m                var file1 = 'entry.move.itn.file1';[m
[32m+[m[32m                var file2 = 'bad:file:name';[m
                 // create a new file entry to kick off it[m
                 createFile(file1, function (entry) {[m
                     // move file1 to file2[m
                     entry.moveTo(root, file2, succeed.bind(null, done, 'entry.moveTo - Unexpected success callback, : ' + file1 + ' to root as: ' + file2), function (error) {[m
                         expect(error).toBeDefined();[m
[31m-                        expect(error).toBeFileError(FileError.ENCODING_ERR);[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.ENCODING_ERR); // eslint-disable-line no-undef[m
                         // cleanup[m
                         deleteEntry(file1, done);[m
                     });[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + file1));[m
             });[m
         });[m
[31m-        //Entry[m
[32m+[m[32m        // Entry[m
         describe('FileReader', function () {[m
[31m-            it("file.spec.81 should have correct methods", function () {[m
[31m-                var reader = new FileReader();[m
[32m+[m[32m            it('file.spec.81 should have correct methods', function () {[m
[32m+[m[32m                var reader = new FileReader(); // eslint-disable-line no-undef[m
                 expect(reader).toBeDefined();[m
                 expect(typeof reader.readAsBinaryString).toBe('function');[m
                 expect(typeof reader.readAsDataURL).toBe('function');[m
[36m@@ -2234,22 +2368,26 @@[m [mexports.defineAutoTests = function () {[m
                 expect(reader.result).toBe(null);[m
             });[m
         });[m
[31m-        //FileReader[m
[32m+[m[32m        // FileReader[m
         describe('Read method', function () {[m
[31m-            it("file.spec.82 should error out on non-existent file", function (done) {[m
[31m-                var fileName = cordova.platformId === 'windowsphone' ? root.toURL() + "/" + "somefile.txt" : "somefile.txt",[m
[31m-                verifier = function (evt) {[m
[32m+[m[32m            it('file.spec.82 should error out on non-existent file', function (done) {[m
[32m+[m[32m                var fileName = cordova.platformId === 'windowsphone' ? root.toURL() + '/' + 'somefile.txt' : 'somefile.txt'; // eslint-disable-line no-undef[m
[32m+[m[32m                var verifier = function (evt) {[m
                     expect(evt).toBeDefined();[m
[31m-                    expect(evt.target.error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                    if (isChrome) {[m
[32m+[m[32m                        expect(evt.target.error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        expect(evt.target.error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                    }[m
                     done();[m
                 };[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (entry) {[m
                     entry.file(function (file) {[m
                         deleteEntry(fileName, function () {[m
[31m-                            //Create FileReader[m
[31m-                            var reader = new FileReader();[m
[32m+[m[32m                            // Create FileReader[m
[32m+[m[32m                            var reader = new FileReader(); // eslint-disable-line no-undef[m
                             reader.onerror = verifier;[m
                             reader.onload = succeed.bind(null, done, 'reader.onload - Unexpected success callback, file: ' + fileName + ' it should not exists');[m
                             reader.readAsText(file);[m
[36m@@ -2257,9 +2395,9 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'entry.file - Error reading file: ' + fileName));[m
                 }, failed.bind(null, done, 'root.getFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.83 should be able to read native blob objects", function (done) {[m
[32m+[m[32m            it('file.spec.83 should be able to read native blob objects', function (done) {[m
                 // Skip test if blobs are not supported (e.g.: Android 2.3).[m
[31m-                if (typeof window.Blob == 'undefined' || typeof window.Uint8Array == 'undefined') {[m
[32m+[m[32m                if (typeof window.Blob === 'undefined' || typeof window.Uint8Array === 'undefined') {[m
                     expect(true).toFailWithMessage('Platform does not supported this feature');[m
                     done();[m
                 }[m
[36m@@ -2274,11 +2412,11 @@[m [mexports.defineAutoTests = function () {[m
                     var builder = new Builder();[m
                     builder.append(uint8Array.buffer);[m
                     builder.append(contents);[m
[31m-                    blob = builder.getBlob("text/plain");[m
[32m+[m[32m                    blob = builder.getBlob('text/plain');[m
                 } else {[m
                     try {[m
                         // iOS 6 does not support Views, so pass in the buffer.[m
[31m-                        blob = new Blob([uint8Array.buffer, contents]);[m
[32m+[m[32m                        blob = new Blob([uint8Array.buffer, contents]); // eslint-disable-line no-undef[m
                     } catch (e) {[m
                         // Skip the test if we can't create a blob (e.g.: iOS 5).[m
                         if (e instanceof TypeError) {[m
[36m@@ -2293,26 +2431,26 @@[m [mexports.defineAutoTests = function () {[m
                     expect(evt.target.result).toBe('asdfasdf');[m
                     done();[m
                 };[m
[31m-                var reader = new FileReader();[m
[32m+[m[32m                var reader = new FileReader(); // eslint-disable-line no-undef[m
                 reader.onloadend = verifier;[m
                 reader.readAsText(blob);[m
             });[m
[31m-            function writeDummyFile(writeBinary, callback, done, fileContents) {[m
[31m-                var fileName = "dummy.txt",[m
[31m-                fileEntry = null,[m
[32m+[m[32m            function writeDummyFile (writeBinary, callback, done, fileContents) {[m
[32m+[m[32m                var fileName = 'dummy.txt';[m
[32m+[m[32m                var fileEntry = null;[m
                 // use default string if file data is not provided[m
[31m-                fileData = fileContents !== undefined ? fileContents :[m
[31m-                    '\u20AC\xEB - There is an exception to every rule. Except this one.',[m
[31m-                fileDataAsBinaryString = fileContents !== undefined ? fileContents :[m
[32m+[m[32m                var fileData = fileContents !== undefined ? fileContents :[m
[32m+[m[32m                    '\u20AC\xEB - There is an exception to every rule. Except this one.';[m
[32m+[m[32m                var fileDataAsBinaryString = fileContents !== undefined ? fileContents :[m
                     '\xe2\x82\xac\xc3\xab - There is an exception to every rule. Except this one.';[m
 [m
[31m-                function createWriter(fe) {[m
[32m+[m[32m                function createWriter (fe) {[m
                     fileEntry = fe;[m
                     fileEntry.createWriter(writeFile, failed.bind(null, done, 'fileEntry.createWriter - Error reading file: ' + fileName));[m
                 }[m
 [m
                 // writes file and reads it back in[m
[31m-                function writeFile(writer) {[m
[32m+[m[32m                function writeFile (writer) {[m
                     writer.onwriteend = function () {[m
                         fileEntry.file(function (f) {[m
                             callback(fileEntry, f, fileData, fileDataAsBinaryString);[m
[36m@@ -2326,13 +2464,13 @@[m [mexports.defineAutoTests = function () {[m
                 // create a file, write to it, and read it in again[m
                 createFile(fileName, createWriter, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             }[m
[31m-            function runReaderTest(funcName, writeBinary, done, progressFunc, verifierFunc, sliceStart, sliceEnd, fileContents) {[m
[32m+[m[32m            function runReaderTest (funcName, writeBinary, done, progressFunc, verifierFunc, sliceStart, sliceEnd, fileContents) {[m
                 writeDummyFile(writeBinary, function (fileEntry, file, fileData, fileDataAsBinaryString) {[m
                     var verifier = function (evt) {[m
                         expect(evt).toBeDefined();[m
                         verifierFunc(evt, fileData, fileDataAsBinaryString);[m
                     };[m
[31m-                    var reader = new FileReader();[m
[32m+[m[32m                    var reader = new FileReader(); // eslint-disable-line no-undef[m
                     reader.onprogress = progressFunc;[m
                     reader.onload = verifier;[m
                     reader.onerror = failed.bind(null, done, 'reader.onerror - Error reading file: ' + file + ' using function: ' + funcName);[m
[36m@@ -2346,28 +2484,28 @@[m [mexports.defineAutoTests = function () {[m
                     reader[funcName](file);[m
                 }, done, fileContents);[m
             }[m
[31m-            function arrayBufferEqualsString(ab, str) {[m
[32m+[m[32m            function arrayBufferEqualsString (ab, str) {[m
                 var buf = new Uint8Array(ab);[m
[31m-                var match = buf.length == str.length;[m
[32m+[m[32m                var match = buf.length === str.length;[m
                 for (var i = 0; match && i < buf.length; i++) {[m
[31m-                    match = buf[i] == str.charCodeAt(i);[m
[32m+[m[32m                    match = buf[i] === str.charCodeAt(i);[m
                 }[m
                 return match;[m
             }[m
[31m-            it("file.spec.84 should read file properly, readAsText", function (done) {[m
[32m+[m[32m            it('file.spec.84 should read file properly, readAsText', function (done) {[m
                 runReaderTest('readAsText', false, done, null, function (evt, fileData, fileDataAsBinaryString) {[m
                     expect(evt.target.result).toBe(fileData);[m
                     done();[m
                 });[m
             });[m
[31m-            it("file.spec.84.1 should read JSON file properly, readAsText", function (done) {[m
[31m-                var testObject = {key1: "value1", key2: 2};[m
[32m+[m[32m            it('file.spec.84.1 should read JSON file properly, readAsText', function (done) {[m
[32m+[m[32m                var testObject = {key1: 'value1', key2: 2};[m
                 runReaderTest('readAsText', false, done, null, function (evt, fileData, fileDataAsBinaryString) {[m
                     expect(evt.target.result).toEqual(JSON.stringify(testObject));[m
                     done();[m
                 }, undefined, undefined, JSON.stringify(testObject));[m
             });[m
[31m-            it("file.spec.85 should read file properly, Data URI", function (done) {[m
[32m+[m[32m            it('file.spec.85 should read file properly, Data URI', function (done) {[m
                 runReaderTest('readAsDataURL', true, done, null, function (evt, fileData, fileDataAsBinaryString) {[m
                     /* `readAsDataURL` function is supported, but the mediatype in Chrome depends on entry name extension,[m
                         mediatype in IE is always empty (which is the same as `text-plain` according the specification),[m
[36m@@ -2376,19 +2514,19 @@[m [mexports.defineAutoTests = function () {[m
                         IE returns `data:;base64,YWJjZGVmZw==`, Chrome returns `data:<mediatype depending on extension of entry name>;base64,YWJjZGVmZw==`. */[m
                     expect(evt.target.result).toBeDataUrl();[m
 [m
[31m-                    //The atob function it is completely ignored during mobilespec execution, besides the returned object: evt[m
[31m-                    //it is encoded and the atob function is aimed to decode a string. Even with btoa (encode) the function it gets stucked[m
[31m-                    //because of the Unicode characters that contains the fileData object.[m
[31m-                    //Issue reported at JIRA with all the details: CB-7095[m
[32m+[m[32m                    // The atob function it is completely ignored during mobilespec execution, besides the returned object: evt[m
[32m+[m[32m                    // it is encoded and the atob function is aimed to decode a string. Even with btoa (encode) the function it gets stucked[m
[32m+[m[32m                    // because of the Unicode characters that contains the fileData object.[m
[32m+[m[32m                    // Issue reported at JIRA with all the details: CB-7095[m
 [m
[31m-                    //expect(evt.target.result.slice(23)).toBe(atob(fileData));[m
[32m+[m[32m                    // expect(evt.target.result.slice(23)).toBe(atob(fileData));[m
 [m
                     done();[m
                 });[m
             });[m
[31m-            it("file.spec.86 should read file properly, readAsBinaryString", function (done) {[m
[32m+[m[32m            it('file.spec.86 should read file properly, readAsBinaryString', function (done) {[m
                 if (isIE) {[m
[31m-                    /*`readAsBinaryString` function is not supported by IE and has not the stub.*/[m
[32m+[m[32m                    /* `readAsBinaryString` function is not supported by IE and has not the stub. */[m
                     pending();[m
                 }[m
 [m
[36m@@ -2397,9 +2535,9 @@[m [mexports.defineAutoTests = function () {[m
                     done();[m
                 });[m
             });[m
[31m-            it("file.spec.87 should read file properly, readAsArrayBuffer", function (done) {[m
[32m+[m[32m            it('file.spec.87 should read file properly, readAsArrayBuffer', function (done) {[m
                 // Skip test if ArrayBuffers are not supported (e.g.: Android 2.3).[m
[31m-                if (typeof window.ArrayBuffer == 'undefined') {[m
[32m+[m[32m                if (typeof window.ArrayBuffer === 'undefined') {[m
                     expect(true).toFailWithMessage('Platform does not supported this feature');[m
                     done();[m
                 }[m
[36m@@ -2408,31 +2546,31 @@[m [mexports.defineAutoTests = function () {[m
                     done();[m
                 });[m
             });[m
[31m-            it("file.spec.88 should read sliced file: readAsText", function (done) {[m
[32m+[m[32m            it('file.spec.88 should read sliced file: readAsText', function (done) {[m
                 runReaderTest('readAsText', false, done, null, function (evt, fileData, fileDataAsBinaryString) {[m
                     expect(evt.target.result).toBe(fileDataAsBinaryString.slice(10, 40));[m
                     done();[m
                 }, 10, 40);[m
             });[m
[31m-            it("file.spec.89 should read sliced file: slice past eof", function (done) {[m
[32m+[m[32m            it('file.spec.89 should read sliced file: slice past eof', function (done) {[m
                 runReaderTest('readAsText', false, done, null, function (evt, fileData, fileDataAsBinaryString) {[m
                     expect(evt.target.result).toBe(fileData.slice(-5, 9999));[m
                     done();[m
                 }, -5, 9999);[m
             });[m
[31m-            it("file.spec.90 should read sliced file: slice to eof", function (done) {[m
[32m+[m[32m            it('file.spec.90 should read sliced file: slice to eof', function (done) {[m
                 runReaderTest('readAsText', false, done, null, function (evt, fileData, fileDataAsBinaryString) {[m
                     expect(evt.target.result).toBe(fileData.slice(-5));[m
                     done();[m
                 }, -5);[m
             });[m
[31m-            it("file.spec.91 should read empty slice", function (done) {[m
[32m+[m[32m            it('file.spec.91 should read empty slice', function (done) {[m
                 runReaderTest('readAsText', false, done, null, function (evt, fileData, fileDataAsBinaryString) {[m
                     expect(evt.target.result).toBe('');[m
                     done();[m
                 }, 0, 0);[m
             });[m
[31m-            it("file.spec.92 should read sliced file properly, readAsDataURL", function (done) {[m
[32m+[m[32m            it('file.spec.92 should read sliced file properly, readAsDataURL', function (done) {[m
                 runReaderTest('readAsDataURL', true, done, null, function (evt, fileData, fileDataAsBinaryString) {[m
                     /* `readAsDataURL` function is supported, but the mediatype in Chrome depends on entry name extension,[m
                         mediatype in IE is always empty (which is the same as `text-plain` according the specification),[m
[36m@@ -2441,19 +2579,19 @@[m [mexports.defineAutoTests = function () {[m
                         IE returns `data:;base64,YWJjZGVmZw==`, Chrome returns `data:<mediatype depending on extension of entry name>;base64,YWJjZGVmZw==`. */[m
                     expect(evt.target.result).toBeDataUrl();[m
 [m
[31m-                    //The atob function it is completely ignored during mobilespec execution, besides the returned object: evt[m
[31m-                    //it is encoded and the atob function is aimed to decode a string. Even with btoa (encode) the function it gets stucked[m
[31m-                    //because of the Unicode characters that contains the fileData object.[m
[31m-                    //Issue reported at JIRA with all the details: CB-7095[m
[32m+[m[32m                    // The atob function it is completely ignored during mobilespec execution, besides the returned object: evt[m
[32m+[m[32m                    // it is encoded and the atob function is aimed to decode a string. Even with btoa (encode) the function it gets stucked[m
[32m+[m[32m                    // because of the Unicode characters that contains the fileData object.[m
[32m+[m[32m                    // Issue reported at JIRA with all the details: CB-7095[m
 [m
[31m-                    //expect(evt.target.result.slice(23)).toBe(atob(fileDataAsBinaryString.slice(10, -3)));[m
[32m+[m[32m                    // expect(evt.target.result.slice(23)).toBe(atob(fileDataAsBinaryString.slice(10, -3)));[m
 [m
                     done();[m
                 }, 10, -3);[m
             });[m
[31m-            it("file.spec.93 should read sliced file properly, readAsBinaryString", function (done) {[m
[32m+[m[32m            it('file.spec.93 should read sliced file properly, readAsBinaryString', function (done) {[m
                 if (isIE) {[m
[31m-                    /*`readAsBinaryString` function is not supported by IE and has not the stub.*/[m
[32m+[m[32m                    /* `readAsBinaryString` function is not supported by IE and has not the stub. */[m
                     pending();[m
                 }[m
 [m
[36m@@ -2462,9 +2600,9 @@[m [mexports.defineAutoTests = function () {[m
                     done();[m
                 }, -10, -5);[m
             });[m
[31m-            it("file.spec.94 should read sliced file properly, readAsArrayBuffer", function (done) {[m
[32m+[m[32m            it('file.spec.94 should read sliced file properly, readAsArrayBuffer', function (done) {[m
                 // Skip test if ArrayBuffers are not supported (e.g.: Android 2.3).[m
[31m-                if (typeof window.ArrayBuffer == 'undefined') {[m
[32m+[m[32m                if (typeof window.ArrayBuffer === 'undefined') {[m
                     expect(true).toFailWithMessage('Platform does not supported this feature');[m
                     done();[m
                 }[m
[36m@@ -2473,20 +2611,20 @@[m [mexports.defineAutoTests = function () {[m
                     done();[m
                 }, 0, -1);[m
             });[m
[31m-            it("file.spec.94.5 should read large file in multiple chunks, readAsArrayBuffer", function (done) {[m
[32m+[m[32m            it('file.spec.94.5 should read large file in multiple chunks, readAsArrayBuffer', function (done) {[m
                 // Skip test if ArrayBuffers are not supported (e.g.: Android 2.3).[m
[31m-                if (typeof window.ArrayBuffer == 'undefined') {[m
[32m+[m[32m                if (typeof window.ArrayBuffer === 'undefined') {[m
                     expect(true).toFailWithMessage('Platform does not supported this feature');[m
                     done();[m
                 }[m
 [m
[31m-                var largeText = "";[m
[32m+[m[32m                var largeText = '';[m
                 for (var i = 0; i < 1000; i++) {[m
[31m-                    largeText += "Test " + i + "\n";[m
[32m+[m[32m                    largeText += 'Test ' + i + '\n';[m
                 }[m
 [m
                 // Set the chunk size so that the read will take 5 chunks[m
[31m-                FileReader.READ_CHUNK_SIZE = Math.floor(largeText.length / 4) + 1;[m
[32m+[m[32m                FileReader.READ_CHUNK_SIZE = Math.floor(largeText.length / 4) + 1; // eslint-disable-line no-undef[m
 [m
                 var chunkCount = 0;[m
                 var lastProgressValue = -1;[m
[36m@@ -2509,19 +2647,22 @@[m [mexports.defineAutoTests = function () {[m
                         expect(arrayBufferEqualsString(evt.target.result, fileDataAsBinaryString.slice(0, -1))).toBe(true);[m
                         expect(lastProgressValue >= largeText.length).toBe(true);[m
                         expect(lastProgressValue <= largeText.length + 5).toBe(true);[m
[31m-                        expect(chunkCount).toBe(5);[m
[32m+[m[32m                        if (!isChrome) {[m
[32m+[m[32m                            // chrome downloads it in one chunk -.-[m
[32m+[m[32m                            expect(chunkCount).toBe(5);[m
[32m+[m[32m                        }[m
                         done();[m
                     },[m
                     0, -1, largeText);[m
             });[m
[31m-            it("file.spec.94.6 should read large file in multiple chunks, readAsDataURL", function (done) {[m
[31m-                var largeText = "";[m
[32m+[m[32m            it('file.spec.94.6 should read large file in multiple chunks, readAsDataURL', function (done) {[m
[32m+[m[32m                var largeText = '';[m
                 for (var i = 0; i < 10; i++) {[m
[31m-                    largeText += "Test " + i + "\n";[m
[32m+[m[32m                    largeText += 'Test ' + i + '\n';[m
                 }[m
 [m
                 // Set the chunk size so that the read will take 5 chunks[m
[31m-                FileReader.READ_CHUNK_SIZE = Math.floor(largeText.length / 4) + 1;[m
[32m+[m[32m                FileReader.READ_CHUNK_SIZE = Math.floor(largeText.length / 4) + 1; // eslint-disable-line no-undef[m
 [m
                 var lastProgressValue = 0;[m
                 var progressFunc = function (evt) {[m
[36m@@ -2549,14 +2690,14 @@[m [mexports.defineAutoTests = function () {[m
                 undefined, undefined, largeText);[m
             });[m
         });[m
[31m-        //Read method[m
[32m+[m[32m        // Read method[m
         describe('FileWriter', function () {[m
[31m-            it("file.spec.95 should have correct methods", function (done) {[m
[32m+[m[32m            it('file.spec.95 should have correct methods', function (done) {[m
                 // retrieve a FileWriter object[m
[31m-                var fileName = "writer.methods";[m
[32m+[m[32m                var fileName = 'writer.methods';[m
                 // FileWriter[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (fileEntry) {[m
                     fileEntry.createWriter(function (writer) {[m
                         expect(writer).toBeDefined();[m
[36m@@ -2569,17 +2710,17 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                 }, failed.bind(null, done, 'root.getFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.96 should be able to write and append to file, createWriter", function (done) {[m
[31m-                var fileName = "writer.append.createWriter", // file content[m
[31m-                content = "There is an exception to every rule.", // for checkin file length[m
[31m-                exception = " Except this one.",[m
[31m-                length = content.length;[m
[32m+[m[32m            it('file.spec.96 should be able to write and append to file, createWriter', function (done) {[m
[32m+[m[32m                var fileName = 'writer.append.createWriter'; // file content[m
[32m+[m[32m                var content = 'There is an exception to every rule.'; // for checkin file length[m
[32m+[m[32m                var exception = ' Except this one.';[m
[32m+[m[32m                var length = content.length;[m
                 // create file, then write and append to it[m
                 createFile(fileName, function (fileEntry) {[m
                     // writes initial file content[m
                     fileEntry.createWriter(function (writer) {[m
[31m-                        //Verifiers declaration[m
[31m-                        function verifier(evt) {[m
[32m+[m[32m                        // Verifiers declaration[m
[32m+[m[32m                        function verifier (evt) {[m
                             expect(writer.length).toBe(length);[m
                             expect(writer.position).toBe(length);[m
                             // Append some more data[m
[36m@@ -2588,37 +2729,37 @@[m [mexports.defineAutoTests = function () {[m
                             writer.seek(writer.length);[m
                             writer.write(exception);[m
                         }[m
[31m-                        function secondVerifier(evt) {[m
[32m+[m[32m                        function secondVerifier (evt) {[m
                             expect(writer.length).toBe(length);[m
                             expect(writer.position).toBe(length);[m
[31m-                            var reader = new FileReader();[m
[32m+[m[32m                            var reader = new FileReader(); // eslint-disable-line no-undef[m
                             reader.onloadend = thirdVerifier;[m
                             reader.onerror = failed.bind(null, done, 'reader.onerror - Error reading file: ' + fileName);[m
[31m-                            fileEntry.file(function(f){reader.readAsText(f);});[m
[32m+[m[32m                            fileEntry.file(function (f) { reader.readAsText(f); });[m
                         }[m
[31m-                        function thirdVerifier(evt) {[m
[31m-                            expect(evt.target.result).toBe(content+exception);[m
[32m+[m[32m                        function thirdVerifier (evt) {[m
[32m+[m[32m                            expect(evt.target.result).toBe(content + exception);[m
                             // cleanup[m
                             deleteFile(fileName, done);[m
                         }[m
 [m
[31m-                        //Write process[m
[32m+[m[32m                        // Write process[m
                         writer.onwriteend = verifier;[m
                         writer.write(content);[m
                     }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.97 should be able to write and append to file, File object", function (done) {[m
[31m-                var fileName = "writer.append.File", // file content[m
[31m-                content = "There is an exception to every rule.", // for checkin file length[m
[31m-                exception = " Except this one.",[m
[31m-                length = content.length;[m
[32m+[m[32m            it('file.spec.97 should be able to write and append to file, File object', function (done) {[m
[32m+[m[32m                var fileName = 'writer.append.File'; // file content[m
[32m+[m[32m                var content = 'There is an exception to every rule.'; // for checkin file length[m
[32m+[m[32m                var exception = ' Except this one.';[m
[32m+[m[32m                var length = content.length;[m
                 root.getFile(fileName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (fileEntry) {[m
                     fileEntry.createWriter(function (writer) {[m
[31m-                        //Verifiers declaration[m
[31m-                        function verifier() {[m
[32m+[m[32m                        // Verifiers declaration[m
[32m+[m[32m                        function verifier () {[m
                             expect(writer.length).toBe(length);[m
                             expect(writer.position).toBe(length);[m
                             // Append some more data[m
[36m@@ -2627,36 +2768,36 @@[m [mexports.defineAutoTests = function () {[m
                             writer.seek(writer.length);[m
                             writer.write(exception);[m
                         }[m
[31m-                        function secondVerifier() {[m
[32m+[m[32m                        function secondVerifier () {[m
                             expect(writer.length).toBe(length);[m
                             expect(writer.position).toBe(length);[m
[31m-                            var reader = new FileReader();[m
[32m+[m[32m                            var reader = new FileReader(); // eslint-disable-line no-undef[m
                             reader.onloadend = thirdVerifier;[m
                             reader.onerror = failed.bind(null, done, 'reader.onerror - Error reading file: ' + fileName);[m
[31m-                            fileEntry.file(function(f){reader.readAsText(f);});[m
[32m+[m[32m                            fileEntry.file(function (f) { reader.readAsText(f); });[m
                         }[m
[31m-                        function thirdVerifier(evt) {[m
[31m-                            expect(evt.target.result).toBe(content+exception);[m
[32m+[m[32m                        function thirdVerifier (evt) {[m
[32m+[m[32m                            expect(evt.target.result).toBe(content + exception);[m
                             // cleanup[m
                             deleteFile(fileName, done);[m
                         }[m
 [m
[31m-                        //Write process[m
[32m+[m[32m                        // Write process[m
                         writer.onwriteend = verifier;[m
                         writer.write(content);[m
                     }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                 }, failed.bind(null, done, 'root.getFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.98 should be able to seek to the middle of the file and write more data than file.length", function (done) {[m
[31m-                var fileName = "writer.seek.write", // file content[m
[31m-                content = "This is our sentence.", // for checking file length[m
[31m-                exception = "newer sentence.",[m
[31m-                length = content.length;[m
[32m+[m[32m            it('file.spec.98 should be able to seek to the middle of the file and write more data than file.length', function (done) {[m
[32m+[m[32m                var fileName = 'writer.seek.write'; // file content[m
[32m+[m[32m                var content = 'This is our sentence.'; // for checking file length[m
[32m+[m[32m                var exception = 'newer sentence.';[m
[32m+[m[32m                var length = content.length;[m
                 // create file, then write and append to it[m
                 createFile(fileName, function (fileEntry) {[m
                     fileEntry.createWriter(function (writer) {[m
[31m-                        //Verifiers declaration[m
[31m-                        function verifier(evt) {[m
[32m+[m[32m                        // Verifiers declaration[m
[32m+[m[32m                        function verifier (evt) {[m
                             expect(writer.length).toBe(length);[m
                             expect(writer.position).toBe(length);[m
                             // Append some more data[m
[36m@@ -2665,42 +2806,42 @@[m [mexports.defineAutoTests = function () {[m
                             writer.seek(12);[m
                             writer.write(exception);[m
                         }[m
[31m-                        function secondVerifier(evt) {[m
[32m+[m[32m                        function secondVerifier (evt) {[m
                             expect(writer.length).toBe(length);[m
                             expect(writer.position).toBe(length);[m
[31m-                            var reader = new FileReader();[m
[32m+[m[32m                            var reader = new FileReader(); // eslint-disable-line no-undef[m
                             reader.onloadend = thirdVerifier;[m
                             reader.onerror = failed.bind(null, done, 'reader.onerror - Error reading file: ' + fileName);[m
[31m-                            fileEntry.file(function(f){reader.readAsText(f);});[m
[32m+[m[32m                            fileEntry.file(function (f) { reader.readAsText(f); });[m
                         }[m
[31m-                        function thirdVerifier(evt) {[m
[31m-                            expect(evt.target.result).toBe(content.substr(0,12)+exception);[m
[32m+[m[32m                        function thirdVerifier (evt) {[m
[32m+[m[32m                            expect(evt.target.result).toBe(content.substr(0, 12) + exception);[m
                             // cleanup[m
                             deleteFile(fileName, done);[m
                         }[m
 [m
[31m-                        //Write process[m
[32m+[m[32m                        // Write process[m
                         writer.onwriteend = verifier;[m
                         writer.write(content);[m
                     }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.99 should be able to seek to the middle of the file and write less data than file.length", function (done) {[m
[31m-                if (isChrome) {[m
[31m-                    /* Chrome (re)writes as follows: "This is our sentence." -> "This is new.sentence.",[m
[32m+[m[32m            it('file.spec.99 should be able to seek to the middle of the file and write less data than file.length', function (done) {[m
[32m+[m[32m                if (isBrowser) {[m
[32m+[m[32m                    /* Browser (re)writes as follows: "This is our sentence." -> "This is new.sentence.",[m
                        i.e. the length is not being changed from content.length and writer length will be equal 21 */[m
                     pending();[m
                 }[m
 [m
[31m-                var fileName = "writer.seek.write2", // file content[m
[31m-                content = "This is our sentence.", // for checking file length[m
[31m-                exception = "new.",[m
[31m-                length = content.length;[m
[32m+[m[32m                var fileName = 'writer.seek.write2'; // file content[m
[32m+[m[32m                var content = 'This is our sentence.'; // for checking file length[m
[32m+[m[32m                var exception = 'new.';[m
[32m+[m[32m                var length = content.length;[m
                 // create file, then write and append to it[m
                 createFile(fileName, function (fileEntry) {[m
                     fileEntry.createWriter(function (writer) {[m
                         // Verifiers declaration[m
[31m-                        function verifier(evt) {[m
[32m+[m[32m                        function verifier (evt) {[m
                             expect(writer.length).toBe(length);[m
                             expect(writer.position).toBe(length);[m
                             // Append some more data[m
[36m@@ -2709,75 +2850,75 @@[m [mexports.defineAutoTests = function () {[m
                             writer.seek(8);[m
                             writer.write(exception);[m
                         }[m
[31m-                        function secondVerifier(evt) {[m
[32m+[m[32m                        function secondVerifier (evt) {[m
                             expect(writer.length).toBe(length);[m
                             expect(writer.position).toBe(length);[m
[31m-                            var reader = new FileReader();[m
[32m+[m[32m                            var reader = new FileReader(); // eslint-disable-line no-undef[m
                             reader.onloadend = thirdVerifier;[m
                             reader.onerror = failed.bind(null, done, 'reader.onerror - Error reading file: ' + fileName);[m
[31m-                            fileEntry.file(function(f){reader.readAsText(f);});[m
[32m+[m[32m                            fileEntry.file(function (f) { reader.readAsText(f); });[m
                         }[m
[31m-                        function thirdVerifier(evt) {[m
[31m-                            expect(evt.target.result).toBe(content.substr(0,8)+exception);[m
[32m+[m[32m                        function thirdVerifier (evt) {[m
[32m+[m[32m                            expect(evt.target.result).toBe(content.substr(0, 8) + exception);[m
                             // cleanup[m
                             deleteFile(fileName, done);[m
                         }[m
 [m
[31m-                        //Write process[m
[32m+[m[32m                        // Write process[m
                         writer.onwriteend = verifier;[m
                         writer.write(content);[m
                     }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.100 should be able to write XML data", function (done) {[m
[31m-                var fileName = "writer.xml", // file content[m
[31m-                content = '<?xml version="1.0" encoding="UTF-8"?>\n<test prop="ack">\nData\n</test>\n', // for testing file length[m
[31m-                length = content.length;[m
[32m+[m[32m            it('file.spec.100 should be able to write XML data', function (done) {[m
[32m+[m[32m                var fileName = 'writer.xml'; // file content[m
[32m+[m[32m                var content = '<?xml version="1.0" encoding="UTF-8"?>\n<test prop="ack">\nData\n</test>\n'; // for testing file length[m
[32m+[m[32m                var length = content.length;[m
                 // creates file, then write XML data[m
                 createFile(fileName, function (fileEntry) {[m
                     fileEntry.createWriter(function (writer) {[m
[31m-                        //Verifier content[m
[32m+[m[32m                        // Verifier content[m
                         var verifier = function (evt) {[m
                             expect(writer.length).toBe(length);[m
                             expect(writer.position).toBe(length);[m
                             // cleanup[m
                             deleteFile(fileName, done);[m
                         };[m
[31m-                        //Write process[m
[32m+[m[32m                        // Write process[m
                         writer.onwriteend = verifier;[m
                         writer.write(content);[m
                     }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.101 should be able to write JSON data", function (done) {[m
[31m-                var fileName = "writer.json", // file content[m
[31m-                content = '{ "name": "Guy Incognito", "email": "here@there.com" }', // for testing file length[m
[31m-                length = content.length;[m
[32m+[m[32m            it('file.spec.101 should be able to write JSON data', function (done) {[m
[32m+[m[32m                var fileName = 'writer.json'; // file content[m
[32m+[m[32m                var content = '{ "name": "Guy Incognito", "email": "here@there.com" }'; // for testing file length[m
[32m+[m[32m                var length = content.length;[m
                 // creates file, then write JSON content[m
                 createFile(fileName, function (fileEntry) {[m
                     fileEntry.createWriter(function (writer) {[m
[31m-                        //Verifier declaration[m
[32m+[m[32m                        // Verifier declaration[m
                         var verifier = function (evt) {[m
                             expect(writer.length).toBe(length);[m
                             expect(writer.position).toBe(length);[m
                             // cleanup[m
                             deleteFile(fileName, done);[m
                         };[m
[31m-                        //Write process[m
[32m+[m[32m                        // Write process[m
                         writer.onwriteend = verifier;[m
                         writer.write(content);[m
                     }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.102 should be able to seek", function (done) {[m
[31m-                var fileName = "writer.seek", // file content[m
[31m-                content = "There is an exception to every rule. Except this one.", // for testing file length[m
[31m-                length = content.length;[m
[32m+[m[32m            it('file.spec.102 should be able to seek', function (done) {[m
[32m+[m[32m                var fileName = 'writer.seek'; // file content[m
[32m+[m[32m                var content = 'There is an exception to every rule. Except this one.'; // for testing file length[m
[32m+[m[32m                var length = content.length;[m
                 // creates file, then write JSON content[m
                 createFile(fileName, function (fileEntry) {[m
                     // writes file content and tests writer.seek[m
                     fileEntry.createWriter(function (writer) {[m
[31m-                        //Verifier declaration[m
[32m+[m[32m                        // Verifier declaration[m
                         var verifier = function () {[m
                             expect(writer.position).toBe(length);[m
                             writer.seek(-5);[m
[36m@@ -2789,7 +2930,7 @@[m [mexports.defineAutoTests = function () {[m
                             // cleanup[m
                             deleteFile(fileName, done);[m
                         };[m
[31m-                        //Write process[m
[32m+[m[32m                        // Write process[m
                         writer.onwriteend = verifier;[m
                         writer.seek(-100);[m
                         expect(writer.position).toBe(0);[m
[36m@@ -2797,14 +2938,14 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.103 should be able to truncate", function (done) {[m
[32m+[m[32m            it('file.spec.103 should be able to truncate', function (done) {[m
                 if (isIndexedDBShim) {[m
                     /* `abort` and `truncate` functions are not supported (Firefox, IE) */[m
                     pending();[m
                 }[m
 [m
[31m-                var fileName = "writer.truncate",[m
[31m-                content = "There is an exception to every rule. Except this one.";[m
[32m+[m[32m                var fileName = 'writer.truncate';[m
[32m+[m[32m                var content = 'There is an exception to every rule. Except this one.';[m
                 // creates file, writes to it, then truncates it[m
                 createFile(fileName, function (fileEntry) {[m
                     fileEntry.createWriter(function (writer) {[m
[36m@@ -2815,9 +2956,9 @@[m [mexports.defineAutoTests = function () {[m
                             // cleanup[m
                             deleteFile(fileName, done);[m
                         };[m
[31m-                        //Write process[m
[32m+[m[32m                        // Write process[m
                         writer.onwriteend = function () {[m
[31m-                            //Truncate process after write[m
[32m+[m[32m                            // Truncate process after write[m
                             writer.onwriteend = verifier;[m
                             writer.truncate(36);[m
                         };[m
[36m@@ -2825,17 +2966,17 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.104 should be able to write binary data from an ArrayBuffer", function (done) {[m
[32m+[m[32m            it('file.spec.104 should be able to write binary data from an ArrayBuffer', function (done) {[m
                 // Skip test if ArrayBuffers are not supported (e.g.: Android 2.3).[m
[31m-                if (typeof window.ArrayBuffer == 'undefined') {[m
[32m+[m[32m                if (typeof window.ArrayBuffer === 'undefined') {[m
                     expect(true).toFailWithMessage('Platform does not supported this feature');[m
                     done();[m
                     return;[m
                 }[m
[31m-                var fileName = "bufferwriter.bin", // file content[m
[31m-                data = new ArrayBuffer(32),[m
[31m-                dataView = new Int8Array(data), // for verifying file length[m
[31m-                length = 32;[m
[32m+[m[32m                var fileName = 'bufferwriter.bin'; // file content[m
[32m+[m[32m                var data = new ArrayBuffer(32);[m
[32m+[m[32m                var dataView = new Int8Array(data); // for verifying file length[m
[32m+[m[32m                var length = 32;[m
                 for (var i = 0; i < dataView.length; i++) {[m
                     dataView[i] = i;[m
                 }[m
[36m@@ -2843,39 +2984,39 @@[m [mexports.defineAutoTests = function () {[m
                 createFile(fileName, function (fileEntry) {[m
                     // writes file content[m
                     fileEntry.createWriter(function (writer) {[m
[31m-                        //Verifier declaration[m
[32m+[m[32m                        // Verifier declaration[m
                         var verifier = function () {[m
                             expect(writer.length).toBe(length);[m
                             expect(writer.position).toBe(length);[m
                             // cleanup[m
                             deleteFile(fileName, done);[m
                         };[m
[31m-                        //Write process[m
[32m+[m[32m                        // Write process[m
                         writer.onwriteend = verifier;[m
                         writer.write(data);[m
                     }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.105 should be able to write binary data from a Blob", function (done) {[m
[32m+[m[32m            it('file.spec.105 should be able to write binary data from a Blob', function (done) {[m
                 // Skip test if Blobs are not supported (e.g.: Android 2.3).[m
[31m-                if ((typeof window.Blob == 'undefined' && typeof window.WebKitBlobBuilder == 'undefined') || typeof window.ArrayBuffer == 'undefined') {[m
[32m+[m[32m                if ((typeof window.Blob === 'undefined' && typeof window.WebKitBlobBuilder === 'undefined') || typeof window.ArrayBuffer === 'undefined') {[m
                     expect(true).toFailWithMessage('Platform does not supported this feature');[m
                     done();[m
                     return;[m
                 }[m
[31m-                var fileName = "blobwriter.bin", // file content[m
[31m-                data = new ArrayBuffer(32),[m
[31m-                dataView = new Int8Array(data),[m
[31m-                blob, // for verifying file length[m
[31m-                length = 32;[m
[32m+[m[32m                var fileName = 'blobwriter.bin'; // file content[m
[32m+[m[32m                var data = new ArrayBuffer(32);[m
[32m+[m[32m                var dataView = new Int8Array(data);[m
[32m+[m[32m                var blob; // for verifying file length[m
[32m+[m[32m                var length = 32;[m
                 for (var i = 0; i < dataView.length; i++) {[m
                     dataView[i] = i;[m
                 }[m
                 try {[m
                     // Mobile Safari: Use Blob constructor[m
[31m-                    blob = new Blob([data], {[m
[31m-                            "type" : "application/octet-stream"[m
[31m-                        });[m
[32m+[m[32m                    blob = new Blob([data], { // eslint-disable-line no-undef[m
[32m+[m[32m                        'type': 'application/octet-stream'[m
[32m+[m[32m                    });[m
                 } catch (e) {[m
                     if (window.WebKitBlobBuilder) {[m
                         // Android Browser: Use deprecated BlobBuilder[m
[36m@@ -2891,37 +3032,37 @@[m [mexports.defineAutoTests = function () {[m
                     // creates file, then write content[m
                     createFile(fileName, function (fileEntry) {[m
                         fileEntry.createWriter(function (writer) {[m
[31m-                            //Verifier declaration[m
[32m+[m[32m                            // Verifier declaration[m
                             var verifier = function () {[m
                                 expect(writer.length).toBe(length);[m
                                 expect(writer.position).toBe(length);[m
                                 // cleanup[m
                                 deleteFile(fileName, done);[m
                             };[m
[31m-                            //Write process[m
[32m+[m[32m                            // Write process[m
                             writer.onwriteend = verifier;[m
                             writer.write(blob);[m
                         }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                     }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
                 }[m
             });[m
[31m-            it("file.spec.106 should be able to write a File to a FileWriter", function (done) {[m
[31m-                var dummyFileName = 'dummy.txt',[m
[31m-                outputFileName = 'verify.txt',[m
[31m-                dummyFileText = 'This text should be written to two files',[m
[31m-                verifier = function (outputFileWriter) {[m
[32m+[m[32m            it('file.spec.106 should be able to write a File to a FileWriter', function (done) {[m
[32m+[m[32m                var dummyFileName = 'dummy.txt';[m
[32m+[m[32m                var outputFileName = 'verify.txt';[m
[32m+[m[32m                var dummyFileText = 'This text should be written to two files';[m
[32m+[m[32m                var verifier = function (outputFileWriter) {[m
                     expect(outputFileWriter.length).toBe(dummyFileText.length);[m
                     expect(outputFileWriter.position).toBe(dummyFileText.length);[m
                     deleteFile(outputFileName, done);[m
[31m-                },[m
[31m-                writeFile = function (fileName, fileData, win) {[m
[31m-                    var theWriter,[m
[31m-                    write_file = function (fileEntry) {[m
[32m+[m[32m                };[m
[32m+[m[32m                var writeFile = function (fileName, fileData, win) {[m
[32m+[m[32m                    var theWriter;[m
[32m+[m[32m                    var write_file = function (fileEntry) {[m
                         // writes file content to new file[m
                         fileEntry.createWriter(function (writer) {[m
                             theWriter = writer;[m
                             writer.onwriteend = function (ev) {[m
[31m-                                if (typeof fileData.length !== "undefined") {[m
[32m+[m[32m                                if (typeof fileData.length !== 'undefined') {[m
                                     expect(theWriter.length).toBe(fileData.length);[m
                                     expect(theWriter.position).toBe(fileData.length);[m
                                 }[m
[36m@@ -2932,10 +3073,10 @@[m [mexports.defineAutoTests = function () {[m
                         }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                     };[m
                     createFile(fileName, write_file, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
[31m-                },[m
[31m-                openFile = function (fileName, callback) {[m
[32m+[m[32m                };[m
[32m+[m[32m                var openFile = function (fileName, callback) {[m
                     root.getFile(fileName, {[m
[31m-                        create : false[m
[32m+[m[32m                        create: false[m
                     }, function (fileEntry) {[m
                         fileEntry.file(callback, failed.bind(null, done, 'fileEntry.file - Error reading file using fileEntry: ' + fileEntry.name));[m
                     }, failed.bind(null, done, 'root.getFile - Error getting file: ' + fileName));[m
[36m@@ -2946,23 +3087,23 @@[m [mexports.defineAutoTests = function () {[m
                     });[m
                 });[m
             });[m
[31m-            it("file.spec.107 should be able to write a sliced File to a FileWriter", function (done) {[m
[31m-                var dummyFileName = 'dummy2.txt',[m
[31m-                outputFileName = 'verify2.txt',[m
[31m-                dummyFileText = 'This text should be written to two files',[m
[31m-                verifier = function (outputFileWriter) {[m
[32m+[m[32m            it('file.spec.107 should be able to write a sliced File to a FileWriter', function (done) {[m
[32m+[m[32m                var dummyFileName = 'dummy2.txt';[m
[32m+[m[32m                var outputFileName = 'verify2.txt';[m
[32m+[m[32m                var dummyFileText = 'This text should be written to two files';[m
[32m+[m[32m                var verifier = function (outputFileWriter) {[m
                     expect(outputFileWriter.length).toBe(10);[m
                     expect(outputFileWriter.position).toBe(10);[m
                     deleteFile(outputFileName, done);[m
[31m-                },[m
[31m-                writeFile = function (fileName, fileData, win) {[m
[31m-                    var theWriter,[m
[31m-                    write_file = function (fileEntry) {[m
[32m+[m[32m                };[m
[32m+[m[32m                var writeFile = function (fileName, fileData, win) {[m
[32m+[m[32m                    var theWriter;[m
[32m+[m[32m                    var write_file = function (fileEntry) {[m
                         // writes file content to new file[m
                         fileEntry.createWriter(function (writer) {[m
                             theWriter = writer;[m
                             writer.onwriteend = function (ev) {[m
[31m-                                if (typeof fileData.length !== "undefined") {[m
[32m+[m[32m                                if (typeof fileData.length !== 'undefined') {[m
                                     expect(theWriter.length).toBe(fileData.length);[m
                                     expect(theWriter.position).toBe(fileData.length);[m
                                 }[m
[36m@@ -2973,10 +3114,10 @@[m [mexports.defineAutoTests = function () {[m
                         }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                     };[m
                     createFile(fileName, write_file, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
[31m-                },[m
[31m-                openFile = function (fileName, callback) {[m
[32m+[m[32m                };[m
[32m+[m[32m                var openFile = function (fileName, callback) {[m
                     root.getFile(fileName, {[m
[31m-                        create : false[m
[32m+[m[32m                        create: false[m
                     }, function (fileEntry) {[m
                         fileEntry.file(callback, failed.bind(null, done, 'fileEntry.file - Error reading file using fileEntry: ' + fileEntry.name));[m
                     }, failed.bind(null, done, 'root.getFile - Error getting file: ' + fileName));[m
[36m@@ -2987,33 +3128,33 @@[m [mexports.defineAutoTests = function () {[m
                     });[m
                 });[m
             });[m
[31m-            it("file.spec.108 should be able to write binary data from a File", function (done) {[m
[32m+[m[32m            it('file.spec.108 should be able to write binary data from a File', function (done) {[m
                 // Skip test if Blobs are not supported (e.g.: Android 2.3).[m
[31m-                if (typeof window.Blob == 'undefined' && typeof window.WebKitBlobBuilder == 'undefined') {[m
[32m+[m[32m                if (typeof window.Blob === 'undefined' && typeof window.WebKitBlobBuilder === 'undefined') {[m
                     expect(true).toFailWithMessage('Platform does not supported this feature');[m
                     done();[m
                 }[m
[31m-                var dummyFileName = "blobwriter.bin",[m
[31m-                outputFileName = 'verify.bin', // file content[m
[31m-                data = new ArrayBuffer(32),[m
[31m-                dataView = new Int8Array(data),[m
[31m-                blob, // for verifying file length[m
[31m-                length = 32,[m
[31m-                verifier = function (outputFileWriter) {[m
[32m+[m[32m                var dummyFileName = 'blobwriter.bin';[m
[32m+[m[32m                var outputFileName = 'verify.bin'; // file content[m
[32m+[m[32m                var data = new ArrayBuffer(32);[m
[32m+[m[32m                var dataView = new Int8Array(data);[m
[32m+[m[32m                var blob; // for verifying file length[m
[32m+[m[32m                var length = 32;[m
[32m+[m[32m                var verifier = function (outputFileWriter) {[m
                     expect(outputFileWriter.length).toBe(length);[m
                     expect(outputFileWriter.position).toBe(length);[m
                     // cleanup[m
                     deleteFile(outputFileName);[m
                     done();[m
[31m-                },[m
[31m-                writeFile = function (fileName, fileData, win) {[m
[31m-                    var theWriter,[m
[31m-                    write_file = function (fileEntry) {[m
[32m+[m[32m                };[m
[32m+[m[32m                var writeFile = function (fileName, fileData, win) {[m
[32m+[m[32m                    var theWriter;[m
[32m+[m[32m                    var write_file = function (fileEntry) {[m
                         // writes file content to new file[m
                         fileEntry.createWriter(function (writer) {[m
                             theWriter = writer;[m
                             writer.onwriteend = function (ev) {[m
[31m-                                if (typeof fileData.length !== "undefined") {[m
[32m+[m[32m                                if (typeof fileData.length !== 'undefined') {[m
                                     expect(theWriter.length).toBe(fileData.length);[m
                                     expect(theWriter.position).toBe(fileData.length);[m
                                 }[m
[36m@@ -3024,10 +3165,10 @@[m [mexports.defineAutoTests = function () {[m
                         }, failed.bind(null, done, 'fileEntry.createWriter - Error creating writer using fileEntry: ' + fileEntry.name));[m
                     };[m
                     createFile(fileName, write_file, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
[31m-                },[m
[31m-                openFile = function (fileName, callback) {[m
[32m+[m[32m                };[m
[32m+[m[32m                var openFile = function (fileName, callback) {[m
                     root.getFile(fileName, {[m
[31m-                        create : false[m
[32m+[m[32m                        create: false[m
                     }, function (fileEntry) {[m
                         fileEntry.file(callback, failed.bind(null, done, 'fileEntry.file - Error reading file using fileEntry: ' + fileEntry.name));[m
                     }, failed.bind(null, done, 'root.getFile - Error getting file: ' + fileName));[m
[36m@@ -3037,9 +3178,9 @@[m [mexports.defineAutoTests = function () {[m
                 }[m
                 try {[m
                     // Mobile Safari: Use Blob constructor[m
[31m-                    blob = new Blob([data], {[m
[31m-                            "type" : "application/octet-stream"[m
[31m-                        });[m
[32m+[m[32m                    blob = new Blob([data], { // eslint-disable-line no-undef[m
[32m+[m[32m                        'type': 'application/octet-stream'[m
[32m+[m[32m                    });[m
                 } catch (e) {[m
                     if (window.WebKitBlobBuilder) {[m
                         // Android Browser: Use deprecated BlobBuilder[m
[36m@@ -3061,7 +3202,7 @@[m [mexports.defineAutoTests = function () {[m
                 }[m
             });[m
         });[m
[31m-        //FileWritter[m
[32m+[m[32m        // FileWritter[m
         describe('Backwards compatibility', function () {[m
             /* These specs exist to test that the File plugin can still recognize file:///[m
              * URLs, and can resolve them to FileEntry and DirectoryEntry objects.[m
[36m@@ -3069,11 +3210,11 @@[m [mexports.defineAutoTests = function () {[m
              * paths, which are not used internally anymore.[m
              * If that interface is not present, then these tests will silently succeed.[m
              */[m
[31m-            it("file.spec.109 should be able to resolve a file:/// URL", function (done) {[m
[32m+[m[32m            it('file.spec.109 should be able to resolve a file:/// URL', function (done) {[m
                 var localFilename = 'file.txt';[m
                 var originalEntry;[m
                 root.getFile(localFilename, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (entry) {[m
                     originalEntry = entry;[m
                     /* This is an undocumented interface to File which exists only for testing[m
[36m@@ -3081,8 +3222,8 @@[m [mexports.defineAutoTests = function () {[m
                      * location, we can pass that to ft.download() to make sure that previously-stored[m
                      * paths are still valid.[m
                      */[m
[31m-                    cordova.exec(function (localPath) {[m
[31m-                        window.resolveLocalFileSystemURL("file://" + encodeURI(localPath), function (fileEntry) {[m
[32m+[m[32m                    cordova.exec(function (localPath) { // eslint-disable-line no-undef[m
[32m+[m[32m                        window.resolveLocalFileSystemURL('file://' + encodeURI(localPath), function (fileEntry) {[m
                             expect(fileEntry.toURL()).toEqual(originalEntry.toURL());[m
                             // cleanup[m
                             deleteFile(localFilename);[m
[36m@@ -3092,19 +3233,19 @@[m [mexports.defineAutoTests = function () {[m
                 }, failed.bind(null, done, 'root.getFile - Error creating file: ' + localFilename));[m
             });[m
         });[m
[31m-        //Backwards Compatibility[m
[32m+[m[32m        // Backwards Compatibility[m
         describe('Parent References', function () {[m
             /* These specs verify that paths with parent references i("..") in them[m
              * work correctly, and do not cause the application to crash.[m
              */[m
[31m-            it("file.spec.110 should not throw exception resolving parent refefences", function (done) {[m
[32m+[m[32m            it('file.spec.110 should not throw exception resolving parent refefences', function (done) {[m
                 /* This is a direct copy of file.spec.9, with the filename changed, * as reported in CB-5721.[m
                  */[m
[31m-                var fileName = "resolve.file.uri";[m
[31m-                var dirName = "resolve.dir.uri";[m
[32m+[m[32m                var fileName = 'resolve.file.uri';[m
[32m+[m[32m                var dirName = 'resolve.dir.uri';[m
                 // create a new file entry[m
                 createDirectory(dirName, function () {[m
[31m-                    createFile(dirName+"/../" + fileName, function (entry) {[m
[32m+[m[32m                    createFile(dirName + '/../' + fileName, function (entry) {[m
                         // lookup file system entry[m
                         window.resolveLocalFileSystemURL(entry.toURL(), function (fileEntry) {[m
                             expect(fileEntry).toBeDefined();[m
[36m@@ -3115,32 +3256,32 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'createFile - Error creating file: ../' + fileName));[m
                 }, failed.bind(null, done, 'createDirectory - Error creating directory: ' + dirName));[m
             });[m
[31m-            it("file.spec.111 should not traverse above above the root directory", function (done) {[m
[31m-                var fileName = "traverse.file.uri";[m
[32m+[m[32m            it('file.spec.111 should not traverse above above the root directory', function (done) {[m
[32m+[m[32m                var fileName = 'traverse.file.uri';[m
                 // create a new file entry[m
                 createFile(fileName, function (entry) {[m
                     // lookup file system entry[m
                     root.getFile('../' + fileName, {[m
[31m-                        create : false[m
[32m+[m[32m                        create: false[m
                     }, function (fileEntry) {[m
                         // Note: we expect this to still resolve, as the correct behaviour is to ignore the ../, not to fail out.[m
                         expect(fileEntry).toBeDefined();[m
                         expect(fileEntry.name).toBe(fileName);[m
[31m-                        expect(fileEntry.fullPath).toCanonicallyMatch(root.fullPath +'/' + fileName);[m
[32m+[m[32m                        expect(fileEntry.fullPath).toCanonicallyMatch(root.fullPath + '/' + fileName);[m
                         // cleanup[m
                         deleteEntry(fileName, done);[m
                     }, failed.bind(null, done, 'root.getFile - Error getting file: ../' + fileName));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ../' + fileName));[m
             });[m
[31m-            it("file.spec.112 should traverse above above the current directory", function (done) {[m
[31m-                var fileName = "traverse2.file.uri",[m
[31m-                dirName = "traverse2.subdir";[m
[32m+[m[32m            it('file.spec.112 should traverse above above the current directory', function (done) {[m
[32m+[m[32m                var fileName = 'traverse2.file.uri';[m
[32m+[m[32m                var dirName = 'traverse2.subdir';[m
                 // create a new directory and a file entry[m
                 createFile(fileName, function () {[m
                     createDirectory(dirName, function (entry) {[m
                         // lookup file system entry[m
                         entry.getFile('../' + fileName, {[m
[31m-                            create : false[m
[32m+[m[32m                            create: false[m
                         }, function (fileEntry) {[m
                             expect(fileEntry).toBeDefined();[m
                             expect(fileEntry.name).toBe(fileName);[m
[36m@@ -3153,32 +3294,36 @@[m [mexports.defineAutoTests = function () {[m
                     }, failed.bind(null, done, 'createDirectory - Error creating directory: ' + dirName));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.113 getFile: get Entry should error for missing file above root directory", function (done) {[m
[31m-                var fileName = "../missing.file";[m
[32m+[m[32m            it('file.spec.113 getFile: get Entry should error for missing file above root directory', function (done) {[m
[32m+[m[32m                var fileName = '../missing.file';[m
                 // create:false, exclusive:false, file does not exist[m
                 root.getFile(fileName, {[m
[31m-                    create : false[m
[32m+[m[32m                    create: false[m
                 }, succeed.bind(null, done, 'root.getFile - Unexpected success callback, it should not locate nonexistent file: ' + fileName), function (error) {[m
                     expect(error).toBeDefined();[m
[31m-                    expect(error).toBeFileError(FileError.NOT_FOUND_ERR);[m
[32m+[m[32m                    if (isChrome) {[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.SYNTAX_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        expect(error).toBeFileError(FileError.NOT_FOUND_ERR); // eslint-disable-line no-undef[m
[32m+[m[32m                    }[m
                     done();[m
                 });[m
             });[m
         });[m
[31m-        //Parent References[m
[32m+[m[32m        // Parent References[m
         describe('toNativeURL interface', function () {[m
             /* These specs verify that FileEntries have a toNativeURL method[m
              * which appears to be sane.[m
              */[m
[31m-            var pathExpect = cordova.platformId === 'windowsphone' ? "//nativ" : "file://";[m
[32m+[m[32m            var pathExpect = cordova.platformId === 'windowsphone' ? '//nativ' : 'file://'; // eslint-disable-line no-undef[m
             if (isChrome) {[m
[31m-                pathExpect = 'filesystem:file://';[m
[32m+[m[32m                pathExpect = 'filesystem:http://';[m
             }[m
[31m-            it("file.spec.114 fileEntry should have a toNativeURL method", function (done) {[m
[31m-                var fileName = "native.file.uri";[m
[32m+[m[32m            it('file.spec.114 fileEntry should have a toNativeURL method', function (done) {[m
[32m+[m[32m                var fileName = 'native.file.uri';[m
                 if (isWindows) {[m
                     var rootPath = root.fullPath;[m
[31m-                    pathExpect = rootPath.substr(0, rootPath.indexOf(":"));[m
[32m+[m[32m                    pathExpect = rootPath.substr(0, rootPath.indexOf(':'));[m
                 }[m
                 // create a new file entry[m
                 createFile(fileName, function (entry) {[m
[36m@@ -3186,54 +3331,54 @@[m [mexports.defineAutoTests = function () {[m
                     expect(entry.name).toCanonicallyMatch(fileName);[m
                     expect(typeof entry.toNativeURL).toBe('function');[m
                     var nativeURL = entry.toNativeURL();[m
[31m-                    expect(typeof nativeURL).toBe("string");[m
[32m+[m[32m                    expect(typeof nativeURL).toBe('string');[m
                     expect(nativeURL.substring(0, pathExpect.length)).toEqual(pathExpect);[m
                     expect(nativeURL.substring(nativeURL.length - fileName.length)).toEqual(fileName);[m
                     // cleanup[m
                     deleteEntry(fileName, done);[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.115 DirectoryReader should return entries with toNativeURL method", function (done) {[m
[31m-                var dirName = 'nativeEntries.dir',[m
[31m-                fileName = 'nativeEntries.file',[m
[31m-                directory,[m
[31m-                checkEntries = function (entries) {[m
[32m+[m[32m            it('file.spec.115 DirectoryReader should return entries with toNativeURL method', function (done) {[m
[32m+[m[32m                var dirName = 'nativeEntries.dir';[m
[32m+[m[32m                var fileName = 'nativeEntries.file';[m
[32m+[m[32m                var directory;[m
[32m+[m[32m                var checkEntries = function (entries) {[m
                     expect(entries).toBeDefined();[m
                     expect(entries instanceof Array).toBe(true);[m
                     expect(entries.length).toBe(1);[m
                     expect(entries[0].toNativeURL).toBeDefined();[m
                     expect(typeof entries[0].toNativeURL).toBe('function');[m
                     var nativeURL = entries[0].toNativeURL();[m
[31m-                    expect(typeof nativeURL).toBe("string");[m
[32m+[m[32m                    expect(typeof nativeURL).toBe('string');[m
                     expect(nativeURL.substring(0, pathExpect.length)).toEqual(pathExpect);[m
                     expect(nativeURL.substring(nativeURL.length - fileName.length)).toEqual(fileName);[m
                     // cleanup[m
[31m-                    directory.removeRecursively(null, null);[m
[32m+[m[32m                    directory.removeRecursively(function () {}, null);[m
                     done();[m
                 };[m
                 // create a new file entry[m
                 root.getDirectory(dirName, {[m
[31m-                    create : true[m
[32m+[m[32m                    create: true[m
                 }, function (dir) {[m
                     directory = dir;[m
                     directory.getFile(fileName, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function (fileEntry) {[m
                         var reader = directory.createReader();[m
                         reader.readEntries(checkEntries, failed.bind(null, done, 'reader.readEntries - Error reading entries from directory: ' + dirName));[m
                     }, failed.bind(null, done, 'directory.getFile - Error creating file: ' + fileName));[m
                 }, failed.bind(null, done, 'root.getDirectory - Error creating directory: ' + dirName));[m
             });[m
[31m-            it("file.spec.116 resolveLocalFileSystemURL should return entries with toNativeURL method", function (done) {[m
[31m-                var fileName = "native.resolve.uri";[m
[32m+[m[32m            it('file.spec.116 resolveLocalFileSystemURL should return entries with toNativeURL method', function (done) {[m
[32m+[m[32m                var fileName = 'native.resolve.uri';[m
                 // create a new file entry[m
                 createFile(fileName, function (entry) {[m
[31m-                    resolveLocalFileSystemURL(entry.toURL(), function (entry) {[m
[32m+[m[32m                    resolveLocalFileSystemURL(entry.toURL(), function (entry) { // eslint-disable-line no-undef[m
                         expect(entry.toNativeURL).toBeDefined();[m
                         expect(entry.name).toCanonicallyMatch(fileName);[m
                         expect(typeof entry.toNativeURL).toBe('function');[m
                         var nativeURL = entry.toNativeURL();[m
[31m-                        expect(typeof nativeURL).toBe("string");[m
[32m+[m[32m                        expect(typeof nativeURL).toBe('string');[m
                         expect(nativeURL.substring(0, pathExpect.length)).toEqual(pathExpect);[m
                         expect(nativeURL.substring(nativeURL.length - fileName.length)).toEqual(fileName);[m
                         // cleanup[m
[36m@@ -3242,100 +3387,102 @@[m [mexports.defineAutoTests = function () {[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
         });[m
[31m-        //toNativeURL interface[m
[32m+[m[32m        // toNativeURL interface[m
         describe('resolveLocalFileSystemURL on file://', function () {[m
             /* These specs verify that window.resolveLocalFileSystemURL works correctly on file:// URLs[m
              */[m
[31m-            it("file.spec.117 should not resolve native URLs outside of FS roots", function (done) {[m
[32m+[m[32m            it('file.spec.117 should not resolve native URLs outside of FS roots', function (done) {[m
                 // lookup file system entry[m
[31m-                window.resolveLocalFileSystemURL("file:///this.is.an.invalid.url", succeed.bind(null, done, 'window.resolveLocalFileSystemURL - Unexpected success callback, it should not resolve invalid URL: file:///this.is.an.invalid.url'), function (error) {[m
[32m+[m[32m                window.resolveLocalFileSystemURL('file:///this.is.an.invalid.url', succeed.bind(null, done, 'window.resolveLocalFileSystemURL - Unexpected success callback, it should not resolve invalid URL: file:///this.is.an.invalid.url'), function (error) {[m
                     expect(error).toBeDefined();[m
                     done();[m
                 });[m
             });[m
[31m-            it("file.spec.118 should not resolve native URLs outside of FS roots", function (done) {[m
[32m+[m[32m            it('file.spec.118 should not resolve native URLs outside of FS roots', function (done) {[m
                 // lookup file system entry[m
[31m-                window.resolveLocalFileSystemURL("file://localhost/this.is.an.invalid.url", succeed.bind(null, done, 'window.resolveLocalFileSystemURL - Unexpected success callback, it should not resolve invalid URL: file://localhost/this.is.an.invalid.url'), function (error) {[m
[32m+[m[32m                window.resolveLocalFileSystemURL('file://localhost/this.is.an.invalid.url', succeed.bind(null, done, 'window.resolveLocalFileSystemURL - Unexpected success callback, it should not resolve invalid URL: file://localhost/this.is.an.invalid.url'), function (error) {[m
                     expect(error).toBeDefined();[m
                     done();[m
                 });[m
             });[m
[31m-            it("file.spec.119 should not resolve invalid native URLs", function (done) {[m
[32m+[m[32m            it('file.spec.119 should not resolve invalid native URLs', function (done) {[m
                 // lookup file system entry[m
[31m-                window.resolveLocalFileSystemURL("file://localhost", succeed.bind(null, done, 'window.resolveLocalFileSystemURL - Unexpected success callback, it should not resolve invalid URL: file://localhost'), function (error) {[m
[32m+[m[32m                window.resolveLocalFileSystemURL('file://localhost', succeed.bind(null, done, 'window.resolveLocalFileSystemURL - Unexpected success callback, it should not resolve invalid URL: file://localhost'), function (error) {[m
                     expect(error).toBeDefined();[m
                     done();[m
                 });[m
             });[m
[31m-            it("file.spec.120 should not resolve invalid native URLs with query strings", function (done) {[m
[32m+[m[32m            it('file.spec.120 should not resolve invalid native URLs with query strings', function (done) {[m
                 // lookup file system entry[m
[31m-                window.resolveLocalFileSystemURL("file://localhost?test/test", succeed.bind(null, done, 'window.resolveLocalFileSystemURL - Unexpected success callback, it should not resolve invalid URL: file://localhost?test/test'), function (error) {[m
[32m+[m[32m                window.resolveLocalFileSystemURL('file://localhost?test/test', succeed.bind(null, done, 'window.resolveLocalFileSystemURL - Unexpected success callback, it should not resolve invalid URL: file://localhost?test/test'), function (error) {[m
                     expect(error).toBeDefined();[m
                     done();[m
                 });[m
             });[m
[31m-            it("file.spec.121 should resolve native URLs returned by API", function (done) {[m
[31m-                var fileName = "native.resolve.uri1";[m
[32m+[m[32m            it('file.spec.121 should resolve native URLs returned by API', function (done) {[m
[32m+[m[32m                var fileName = 'native.resolve.uri1';[m
                 // create a new file entry[m
                 createFile(fileName, function (entry) {[m
[32m+[m[32m                    /* eslint-disable no-undef */[m
                     resolveLocalFileSystemURL(entry.toNativeURL(), function (fileEntry) {[m
[31m-                        expect(fileEntry.fullPath).toCanonicallyMatch(root.fullPath + "/" + fileName);[m
[32m+[m[32m                        expect(fileEntry.fullPath).toCanonicallyMatch(root.fullPath + '/' + fileName);[m
                         // cleanup[m
                         deleteEntry(fileName, done);[m
                     }, failed.bind(null, done, 'resolveLocalFileSystemURL - Error resolving file URL: ' + entry.toNativeURL()));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.122 should resolve native URLs returned by API with localhost", function (done) {[m
[31m-                var fileName = "native.resolve.uri2";[m
[32m+[m[32m            it('file.spec.122 should resolve native URLs returned by API with localhost', function (done) {[m
[32m+[m[32m                var fileName = 'native.resolve.uri2';[m
                 // create a new file entry[m
                 createFile(fileName, function (entry) {[m
                     var url = entry.toNativeURL();[m
[31m-                    url = url.replace("///", "//localhost/");[m
[32m+[m[32m                    url = url.replace('///', '//localhost/');[m
                     resolveLocalFileSystemURL(url, function (fileEntry) {[m
[31m-                        expect(fileEntry.fullPath).toCanonicallyMatch(root.fullPath + "/" + fileName);[m
[32m+[m[32m                        expect(fileEntry.fullPath).toCanonicallyMatch(root.fullPath + '/' + fileName);[m
                         // cleanup[m
                         deleteEntry(fileName, done);[m
                     }, failed.bind(null, done, 'resolveLocalFileSystemURL - Error resolving file URL: ' + url));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.123 should resolve native URLs returned by API with query string", function (done) {[m
[31m-                var fileName = "native.resolve.uri3";[m
[32m+[m[32m            it('file.spec.123 should resolve native URLs returned by API with query string', function (done) {[m
[32m+[m[32m                var fileName = 'native.resolve.uri3';[m
                 // create a new file entry[m
                 createFile(fileName, function (entry) {[m
                     var url = entry.toNativeURL();[m
[31m-                    url = url + "?test/test";[m
[32m+[m[32m                    url = url + '?test/test';[m
                     resolveLocalFileSystemURL(url, function (fileEntry) {[m
[31m-                        expect(fileEntry.fullPath).toCanonicallyMatch(root.fullPath + "/" + fileName);[m
[32m+[m[32m                        expect(fileEntry.fullPath).toCanonicallyMatch(root.fullPath + '/' + fileName);[m
                         // cleanup[m
                         deleteEntry(fileName, done);[m
                     }, failed.bind(null, done, 'resolveLocalFileSystemURL - Error resolving file URL: ' + url));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
[31m-            it("file.spec.124 should resolve native URLs returned by API with localhost and query string", function (done) {[m
[31m-                var fileName = "native.resolve.uri4";[m
[32m+[m[32m            it('file.spec.124 should resolve native URLs returned by API with localhost and query string', function (done) {[m
[32m+[m[32m                var fileName = 'native.resolve.uri4';[m
                 // create a new file entry[m
                 createFile(fileName, function (entry) {[m
                     var url = entry.toNativeURL();[m
[31m-                    url = url.replace("///", "//localhost/") + "?test/test";[m
[32m+[m[32m                    url = url.replace('///', '//localhost/') + '?test/test';[m
                     resolveLocalFileSystemURL(url, function (fileEntry) {[m
[31m-                        expect(fileEntry.fullPath).toCanonicallyMatch(root.fullPath + "/" + fileName);[m
[32m+[m[32m                        /* eslint-enable no-undef */[m
[32m+[m[32m                        expect(fileEntry.fullPath).toCanonicallyMatch(root.fullPath + '/' + fileName);[m
                         // cleanup[m
                         deleteEntry(fileName, done);[m
                     }, failed.bind(null, done, 'resolveLocalFileSystemURL - Error resolving file URL: ' + url));[m
                 }, failed.bind(null, done, 'createFile - Error creating file: ' + fileName));[m
             });[m
         });[m
[31m-        //resolveLocalFileSystemURL on file://[m
[32m+[m[32m        // resolveLocalFileSystemURL on file://[m
         describe('cross-file-system copy and move', function () {[m
             /* These specs verify that Entry.copyTo and Entry.moveTo work correctly[m
              * when crossing filesystem boundaries.[m
              */[m
[31m-            it("file.spec.125 copyTo: temporary -> persistent", function (done) {[m
[31m-                var file1 = "entry.copy.file1a",[m
[31m-                file2 = "entry.copy.file2a",[m
[31m-                sourceEntry,[m
[31m-                fullPath = joinURL(root.fullPath, file2),[m
[31m-                validateFile = function (entry) {[m
[32m+[m[32m            it('file.spec.125 copyTo: temporary -> persistent', function (done) {[m
[32m+[m[32m                var file1 = 'entry.copy.file1a';[m
[32m+[m[32m                var file2 = 'entry.copy.file2a';[m
[32m+[m[32m                var sourceEntry;[m
[32m+[m[32m                var fullPath = joinURL(root.fullPath, file2);[m
[32m+[m[32m                var validateFile = function (entry) {[m
                     // a bit redundant since copy returned this entry already[m
                     expect(entry).toBeDefined();[m
                     expect(entry.isFile).toBe(true);[m
[36m@@ -3344,23 +3491,23 @@[m [mexports.defineAutoTests = function () {[m
                     expect(entry.fullPath).toCanonicallyMatch(fullPath);[m
                     expect(entry.filesystem).toBeDefined();[m
                     if (isChrome) {[m
[31m-                        expect(entry.filesystem.name).toContain("Persistent");[m
[32m+[m[32m                        expect(entry.filesystem.name).toContain('Persistent');[m
                     } else {[m
[31m-                        expect(entry.filesystem.name).toEqual("persistent");[m
[32m+[m[32m                        expect(entry.filesystem.name).toEqual('persistent');[m
                     }[m
                     // cleanup[m
                     deleteEntry(entry.name);[m
                     deleteEntry(sourceEntry.name, done);[m
[31m-                },[m
[31m-                createSourceAndTransfer = function () {[m
[32m+[m[32m                };[m
[32m+[m[32m                var createSourceAndTransfer = function () {[m
                     temp_root.getFile(file1, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function (entry) {[m
                         expect(entry.filesystem).toBeDefined();[m
                         if (isChrome) {[m
[31m-                            expect(entry.filesystem.name).toContain("Temporary");[m
[32m+[m[32m                            expect(entry.filesystem.name).toContain('Temporary');[m
                         } else {[m
[31m-                            expect(entry.filesystem.name).toEqual("temporary");[m
[32m+[m[32m                            expect(entry.filesystem.name).toEqual('temporary');[m
                         }[m
                         sourceEntry = entry;[m
                         // Save for later cleanup[m
[36m@@ -3372,39 +3519,39 @@[m [mexports.defineAutoTests = function () {[m
                     entry.remove(createSourceAndTransfer, failed.bind(null, done, 'entry.remove - Error removing file: ' + file2));[m
                 }, createSourceAndTransfer);[m
             });[m
[31m-            it("file.spec.126 copyTo: persistent -> temporary", function (done) {[m
[31m-                var file1 = "entry.copy.file1b",[m
[31m-                file2 = "entry.copy.file2b",[m
[31m-                sourceEntry,[m
[31m-                fullPath = joinURL(temp_root.fullPath, file2),[m
[31m-                validateFile = function (entry) {[m
[32m+[m[32m            it('file.spec.126 copyTo: persistent -> temporary', function (done) {[m
[32m+[m[32m                var file1 = 'entry.copy.file1b';[m
[32m+[m[32m                var file2 = 'entry.copy.file2b';[m
[32m+[m[32m                var sourceEntry;[m
[32m+[m[32m                var fullPath = joinURL(temp_root.fullPath, file2);[m
[32m+[m[32m                var validateFile = function (entry) {[m
                     expect(entry).toBeDefined();[m
                     expect(entry.isFile).toBe(true);[m
                     expect(entry.isDirectory).toBe(false);[m
                     expect(entry.name).toCanonicallyMatch(file2);[m
                     expect(entry.fullPath).toCanonicallyMatch(fullPath);[m
                     if (isChrome) {[m
[31m-                        expect(entry.filesystem.name).toContain("Temporary");[m
[32m+[m[32m                        expect(entry.filesystem.name).toContain('Temporary');[m
                     } else {[m
[31m-                        expect(entry.filesystem.name).toEqual("temporary");[m
[32m+[m[32m                        expect(entry.filesystem.name).toEqual('temporary');[m
                     }[m
                     // cleanup[m
                     deleteEntry(entry.name);[m
                     deleteEntry(sourceEntry.name, done);[m
[31m-                },[m
[31m-                createSourceAndTransfer = function () {[m
[32m+[m[32m                };[m
[32m+[m[32m                var createSourceAndTransfer = function () {[m
                     persistent_root.getFile(file1, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function (entry) {[m
                         expect(entry).toBeDefined();[m
                         expect(entry.filesystem).toBeDefined();[m
                         if (isChrome) {[m
[31m-                            expect(entry.filesystem.name).toContain("Persistent");[m
[32m+[m[32m                            expect(entry.filesystem.name).toContain('Persistent');[m
                         } else {[m
[31m-                            expect(entry.filesystem.name).toEqual("persistent");[m
[32m+[m[32m                            expect(entry.filesystem.name).toEqual('persistent');[m
                         }[m
                         sourceEntry = entry;[m
[31m-                        // Save for later cleanup[m
[32m+[m[32m                    // Save for later cleanup[m
                         entry.copyTo(temp_root, file2, validateFile, failed.bind(null, done, 'entry.copyTo - Error copying file: ' + file1 + ' to TEMPORAL root as: ' + file2));[m
                     }, failed.bind(null, done, 'persistent_root.getFile - Error creating file: ' + file1 + 'at PERSISTENT root'));[m
                 };[m
[36m@@ -3413,12 +3560,12 @@[m [mexports.defineAutoTests = function () {[m
                     entry.remove(createSourceAndTransfer, failed.bind(null, done, 'entry.remove - Error removing file: ' + file2));[m
                 }, createSourceAndTransfer);[m
             });[m
[31m-            it("file.spec.127 moveTo: temporary -> persistent", function (done) {[m
[31m-                var file1 = "entry.copy.file1a",[m
[31m-                file2 = "entry.copy.file2a",[m
[31m-                sourceEntry,[m
[31m-                fullPath = joinURL(root.fullPath, file2),[m
[31m-                validateFile = function (entry) {[m
[32m+[m[32m            it('file.spec.127 moveTo: temporary -> persistent', function (done) {[m
[32m+[m[32m                var file1 = 'entry.copy.file1a';[m
[32m+[m[32m                var file2 = 'entry.copy.file2a';[m
[32m+[m[32m                var sourceEntry;[m
[32m+[m[32m                var fullPath = joinURL(root.fullPath, file2);[m
[32m+[m[32m                var validateFile = function (entry) {[m
                     // a bit redundant since copy returned this entry already[m
                     expect(entry).toBeDefined();[m
                     expect(entry.isFile).toBe(true);[m
[36m@@ -3427,23 +3574,23 @@[m [mexports.defineAutoTests = function () {[m
                     expect(entry.fullPath).toCanonicallyMatch(fullPath);[m
                     expect(entry.filesystem).toBeDefined();[m
                     if (isChrome) {[m
[31m-                        expect(entry.filesystem.name).toContain("Persistent");[m
[32m+[m[32m                        expect(entry.filesystem.name).toContain('Persistent');[m
                     } else {[m
[31m-                        expect(entry.filesystem.name).toEqual("persistent");[m
[32m+[m[32m                        expect(entry.filesystem.name).toEqual('persistent');[m
                     }[m
                     // cleanup[m
                     deleteEntry(entry.name);[m
                     deleteEntry(sourceEntry.name, done);[m
[31m-                },[m
[31m-                createSourceAndTransfer = function () {[m
[32m+[m[32m                };[m
[32m+[m[32m                var createSourceAndTransfer = function () {[m
                     temp_root.getFile(file1, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function (entry) {[m
                         expect(entry.filesystem).toBeDefined();[m
                         if (isChrome) {[m
[31m-                            expect(entry.filesystem.name).toContain("Temporary");[m
[32m+[m[32m                            expect(entry.filesystem.name).toContain('Temporary');[m
                         } else {[m
[31m-                            expect(entry.filesystem.name).toEqual("temporary");[m
[32m+[m[32m                            expect(entry.filesystem.name).toEqual('temporary');[m
                         }[m
                         sourceEntry = entry;[m
                         // Save for later cleanup[m
[36m@@ -3455,36 +3602,36 @@[m [mexports.defineAutoTests = function () {[m
                     entry.remove(createSourceAndTransfer, failed.bind(null, done, 'entry.remove - Error removing file: ' + file2));[m
                 }, createSourceAndTransfer);[m
             });[m
[31m-            it("file.spec.128 moveTo: persistent -> temporary", function (done) {[m
[31m-                var file1 = "entry.copy.file1b",[m
[31m-                file2 = "entry.copy.file2b",[m
[31m-                sourceEntry,[m
[31m-                fullPath = joinURL(temp_root.fullPath, file2),[m
[31m-                validateFile = function (entry) {[m
[32m+[m[32m            it('file.spec.128 moveTo: persistent -> temporary', function (done) {[m
[32m+[m[32m                var file1 = 'entry.copy.file1b';[m
[32m+[m[32m                var file2 = 'entry.copy.file2b';[m
[32m+[m[32m                var sourceEntry;[m
[32m+[m[32m                var fullPath = joinURL(temp_root.fullPath, file2);[m
[32m+[m[32m                var validateFile = function (entry) {[m
                     expect(entry).toBeDefined();[m
                     expect(entry.isFile).toBe(true);[m
                     expect(entry.isDirectory).toBe(false);[m
                     expect(entry.name).toCanonicallyMatch(file2);[m
                     expect(entry.fullPath).toCanonicallyMatch(fullPath);[m
[31m-                    if(isChrome) {[m
[31m-                        expect(entry.filesystem.name).toContain("Temporary");[m
[32m+[m[32m                    if (isChrome) {[m
[32m+[m[32m                        expect(entry.filesystem.name).toContain('Temporary');[m
                     } else {[m
[31m-                        expect(entry.filesystem.name).toEqual("temporary");[m
[32m+[m[32m                        expect(entry.filesystem.name).toEqual('temporary');[m
                     }[m
                     // cleanup[m
                     deleteEntry(entry.name);[m
                     deleteEntry(sourceEntry.name, done);[m
[31m-                },[m
[31m-                createSourceAndTransfer = function () {[m
[32m+[m[32m                };[m
[32m+[m[32m                var createSourceAndTransfer = function () {[m
                     persistent_root.getFile(file1, {[m
[31m-                        create : true[m
[32m+[m[32m                        create: true[m
                     }, function (entry) {[m
                         expect(entry).toBeDefined();[m
                         expect(entry.filesystem).toBeDefined();[m
                         if (isChrome) {[m
[31m-                            expect(entry.filesystem.name).toContain("Persistent");[m
[32m+[m[32m                            expect(entry.filesystem.name).toContain('Persistent');[m
                         } else {[m
[31m-                            expect(entry.filesystem.name).toEqual("persistent");[m
[32m+[m[32m                            expect(entry.filesystem.name).toEqual('persistent');[m
                         }[m
                         sourceEntry = entry;[m
                         // Save for later cleanup[m
[36m@@ -3496,19 +3643,20 @@[m [mexports.defineAutoTests = function () {[m
                     entry.remove(createSourceAndTransfer, failed.bind(null, done, 'entry.remove - Error removing file: ' + file2));[m
                 }, createSourceAndTransfer);[m
             });[m
[31m-            it("file.spec.129 cordova.file.*Directory are set", function () {[m
[32m+[m[32m            it('file.spec.129 cordova.file.*Directory are set', function () {[m
                 var expectedPaths = ['applicationDirectory', 'applicationStorageDirectory', 'dataDirectory', 'cacheDirectory'];[m
[31m-                if (cordova.platformId == 'android' || cordova.platformId == 'amazon-fireos') {[m
[32m+[m[32m                /* eslint-disable no-undef */[m
[32m+[m[32m                if (cordova.platformId === 'android' || cordova.platformId === 'amazon-fireos') {[m
                     if (cordova.file.externalApplicationStorageDirectory !== null) {[m
                         // https://issues.apache.org/jira/browse/CB-10411[m
                         // If external storage can't be mounted, the cordova.file.external* properties are null.[m
                         expectedPaths.push('externalApplicationStorageDirectory', 'externalRootDirectory', 'externalCacheDirectory', 'externalDataDirectory');[m
                     }[m
[31m-                } else if (cordova.platformId == 'blackberry10') {[m
[32m+[m[32m                } else if (cordova.platformId === 'blackberry10') {[m
                     expectedPaths.push('externalRootDirectory', 'sharedDirectory');[m
[31m-                } else if (cordova.platformId == 'ios') {[m
[32m+[m[32m                } else if (cordova.platformId === 'ios') {[m
                     expectedPaths.push('syncedDataDirectory', 'documentsDirectory', 'tempDirectory');[m
[31m-                } else if (cordova.platformId == 'osx') {[m
[32m+[m[32m                } else if (cordova.platformId === 'osx') {[m
                     expectedPaths.push('documentsDirectory', 'tempDirectory', 'rootDirectory');[m
                 } else {[m
                     console.log('Skipping test due on unsupported platform.');[m
[36m@@ -3521,7 +3669,7 @@[m [mexports.defineAutoTests = function () {[m
             });[m
         });[m
         describe('resolveLocalFileSystemURL on cdvfile://', function () {[m
[31m-            it("file.spec.147 should be able to resolve cdvfile applicationDirectory fs root", function(done) {[m
[32m+[m[32m            it('file.spec.147 should be able to resolve cdvfile applicationDirectory fs root', function (done) {[m
                 var cdvfileApplicationDirectoryFsRootName;[m
                 if (cordova.platformId === 'android') {[m
                     cdvfileApplicationDirectoryFsRootName = 'assets';[m
[36m@@ -3531,7 +3679,7 @@[m [mexports.defineAutoTests = function () {[m
                     pending();[m
                 }[m
 [m
[31m-                resolveLocalFileSystemURL('cdvfile://localhost/' + cdvfileApplicationDirectoryFsRootName + '/', function(applicationDirectoryRoot) {[m
[32m+[m[32m                resolveLocalFileSystemURL('cdvfile://localhost/' + cdvfileApplicationDirectoryFsRootName + '/', function (applicationDirectoryRoot) {[m
                     expect(applicationDirectoryRoot.isFile).toBe(false);[m
                     expect(applicationDirectoryRoot.isDirectory).toBe(true);[m
                     expect(applicationDirectoryRoot.name).toCanonicallyMatch('');[m
[36m@@ -3540,19 +3688,20 @@[m [mexports.defineAutoTests = function () {[m
 [m
                     // Requires HelloCordova www assets, <allow-navigation href="cdvfile:*" /> in config.xml or[m
                     // cdvfile: in CSP and <access origin="cdvfile://*" /> in config.xml[m
[31m-                    resolveLocalFileSystemURL('cdvfile://localhost/' + cdvfileApplicationDirectoryFsRootName + '/www/img/logo.png', function(entry) {[m
[32m+[m[32m                    resolveLocalFileSystemURL('cdvfile://localhost/' + cdvfileApplicationDirectoryFsRootName + '/www/img/logo.png', function (entry) {[m
[32m+[m[32m                        /* eslint-enable no-undef */[m
                         expect(entry.isFile).toBe(true);[m
                         expect(entry.isDirectory).toBe(false);[m
                         expect(entry.name).toCanonicallyMatch('logo.png');[m
                         expect(entry.fullPath).toCanonicallyMatch('/www/img/logo.png');[m
                         expect(entry.filesystem.name).toEqual(cdvfileApplicationDirectoryFsRootName);[m
 [m
[31m-                        var img = new Image();[m
[31m-                        img.onerror = function(err) {[m
[32m+[m[32m                        var img = new Image(); // eslint-disable-line no-undef[m
[32m+[m[32m                        img.onerror = function (err) {[m
                             expect(err).not.toBeDefined();[m
                             done();[m
                         };[m
[31m-                        img.onload = function() {[m
[32m+[m[32m                        img.onload = function () {[m
                             done();[m
                         };[m
                         img.src = entry.toInternalURL();[m
[36m@@ -3560,28 +3709,28 @@[m [mexports.defineAutoTests = function () {[m
                 }, failed.bind(null, done, 'resolveLocalFileSystemURL failed for cdvfile applicationDirectory'));[m
             });[m
         });[m
[31m-        //cross-file-system copy and move[m
[32m+[m[32m        // cross-file-system copy and move[m
         describe('IndexedDB-based impl', function () {[m
[31m-            it("file.spec.131 Nested file or nested directory should be removed when removing a parent directory", function (done) {[m
[31m-                var parentDirName = 'deletedDir131',[m
[31m-                    nestedDirName = 'nestedDir131',[m
[31m-                    nestedFileName = 'nestedFile131.txt';[m
[32m+[m[32m            it('file.spec.131 Nested file or nested directory should be removed when removing a parent directory', function (done) {[m
[32m+[m[32m                var parentDirName = 'deletedDir131';[m
[32m+[m[32m                var nestedDirName = 'nestedDir131';[m
[32m+[m[32m                var nestedFileName = 'nestedFile131.txt';[m
 [m
                 createDirectory(parentDirName, function (parent) {[m
[31m-                    parent.getDirectory(nestedDirName, { create: true}, function () {[m
[31m-                        parent.getFile(nestedFileName, { create: true}, function () {[m
[31m-                            parent.removeRecursively(function() {[m
[31m-                                root.getDirectory(parentDirName,{ create: false}, failed.bind(this, done, 'root.getDirectory - unexpected success callback : ' + parentDirName), function(){[m
[31m-                                    parent.getFile(nestedFileName,{ create: false}, failed.bind(this, done, 'getFile - unexpected success callback : ' + nestedFileName), function(){[m
[31m-                                            parent.getDirectory(nestedDirName, { create: false}, failed.bind(this, done, 'getDirectory - unexpected success callback : ' + nestedDirName), done);[m
[31m-                                        });[m
[32m+[m[32m                    parent.getDirectory(nestedDirName, { create: true }, function () {[m
[32m+[m[32m                        parent.getFile(nestedFileName, { create: true }, function () {[m
[32m+[m[32m                            parent.removeRecursively(function () {[m
[32m+[m[32m                                root.getDirectory(parentDirName, { create: false }, failed.bind(this, done, 'root.getDirectory - unexpected success callback : ' + parentDirName), function () {[m
[32m+[m[32m                                    parent.getFile(nestedFileName, { create: false }, failed.bind(this, done, 'getFile - unexpected success callback : ' + nestedFileName), function () {[m
[32m+[m[32m                                        parent.getDirectory(nestedDirName, { create: false }, failed.bind(this, done, 'getDirectory - unexpected success callback : ' + nestedDirName), done);[m
                                     });[m
[31m-                                }, failed.bind(this, done, 'removeRecursively - Error removing directory : ' + parentDirName));[m
[32m+[m[32m                                });[m
[32m+[m[32m                            }, failed.bind(this, done, 'removeRecursively - Error removing directory : ' + parentDirName));[m
                         }, failed.bind(this, done, 'getFile - Error creating file : ' + nestedFileName));[m
[31m-                    },failed.bind(this, done, 'getDirectory - Error creating directory : ' + nestedDirName));[m
[32m+[m[32m                    }, failed.bind(this, done, 'getDirectory - Error creating directory : ' + nestedDirName));[m
                 }, failed.bind(this, done, 'root.getDirectory - Error creating directory : ' + parentDirName));[m
             });[m
[31m-            it("file.spec.132 Entry should be created succesfully when using relative paths if its parent directory exists", function (done) {[m
[32m+[m[32m            it('file.spec.132 Entry should be created succesfully when using relative paths if its parent directory exists', function (done) {[m
                 /* Directory entries have to be created successively.[m
                    For example, the call `fs.root.getDirectory('dir1/dir2', {create:true}, successCallback, errorCallback)`[m
                    will fail if dir1 did not exist. */[m
[36m@@ -3589,7 +3738,7 @@[m [mexports.defineAutoTests = function () {[m
                 var nestedName = 'nestedName132';[m
                 var path = parentName + '/' + nestedName;[m
 [m
[31m-                var win = function(directory){[m
[32m+[m[32m                var win = function (directory) {[m
                     expect(directory).toBeDefined();[m
                     expect(directory.isFile).toBe(false);[m
                     expect(directory.isDirectory).toBe(true);[m
[36m@@ -3599,18 +3748,18 @@[m [mexports.defineAutoTests = function () {[m
                     deleteEntry(parentName, done);[m
                 };[m
 [m
[31m-                createDirectory(parentName, function() {[m
[31m-                    root.getDirectory(parentName + '/' + nestedName, {create:true}, win,[m
[32m+[m[32m                createDirectory(parentName, function () {[m
[32m+[m[32m                    root.getDirectory(parentName + '/' + nestedName, {create: true}, win,[m
                         failed.bind(this, done, 'root.getDirectory - Error getting directory : ' + path));[m
                 }, failed.bind(this, done, 'root.getDirectory - Error getting directory : ' + parentName));[m
             });[m
[31m-            it("file.spec.133 A file being removed should not affect another file with name being a prefix of the removed file name.", function (done) {[m
[32m+[m[32m            it('file.spec.133 A file being removed should not affect another file with name being a prefix of the removed file name.', function (done) {[m
 [m
                 // Names include special symbols so that we check the IndexedDB range used[m
[31m-                var deletedFileName = 'deletedFile.0',[m
[31m-                secondFileName = 'deletedFile.0.1';[m
[32m+[m[32m                var deletedFileName = 'deletedFile.0';[m
[32m+[m[32m                var secondFileName = 'deletedFile.0.1';[m
 [m
[31m-                var win = function(fileEntry){[m
[32m+[m[32m                var win = function (fileEntry) {[m
                     expect(fileEntry).toBeDefined();[m
                     expect(fileEntry.isFile).toBe(true);[m
                     expect(fileEntry.isDirectory).toBe(false);[m
[36m@@ -3620,21 +3769,21 @@[m [mexports.defineAutoTests = function () {[m
 [m
                 createFile(deletedFileName, function (deletedFile) {[m
                     createFile(secondFileName, function () {[m
[31m-                        deletedFile.remove(function() {[m
[31m-                            root.getFile(deletedFileName, {create: false}, failed.bind(this, done, 'getFile - unexpected success callback getting deleted file : ' + deletedFileName), function(){[m
[32m+[m[32m                        deletedFile.remove(function () {[m
[32m+[m[32m                            root.getFile(deletedFileName, {create: false}, failed.bind(this, done, 'getFile - unexpected success callback getting deleted file : ' + deletedFileName), function () {[m
                                 root.getFile(secondFileName, {create: false}, win, failed.bind(this, done, 'getFile - Error getting file after deleting deletedFile : ' + secondFileName));[m
                             });[m
                         }, failed.bind(this, done, 'remove - Error removing file : ' + deletedFileName));[m
                     }, failed.bind(this, done, 'getFile - Error creating file : ' + secondFileName));[m
                 }, failed.bind(this, done, 'getFile - Error creating file : ' + deletedFileName));[m
             });[m
[31m-            it("file.spec.134 A directory being removed should not affect another directory with name being a prefix of the removed directory name.", function (done) {[m
[32m+[m[32m            it('file.spec.134 A directory being removed should not affect another directory with name being a prefix of the removed directory name.', function (done) {[m
 [m
                 // Names include special symbols so that we check the IndexedDB range used[m
[31m-                var deletedDirName = 'deletedDir.0',[m
[31m-                secondDirName = 'deletedDir.0.1';[m
[32m+[m[32m                var deletedDirName = 'deletedDir.0';[m
[32m+[m[32m                var secondDirName = 'deletedDir.0.1';[m
 [m
[31m-                var win = function(directory){[m
[32m+[m[32m                var win = function (directory) {[m
                     expect(directory).toBeDefined();[m
                     expect(directory.isFile).toBe(false);[m
                     expect(directory.isDirectory).toBe(true);[m
[36m@@ -3644,20 +3793,20 @@[m [mexports.defineAutoTests = function () {[m
 [m
                 createDirectory(deletedDirName, function (deletedDir) {[m
                     createDirectory(secondDirName, function () {[m
[31m-                        deletedDir.remove(function() {[m
[31m-                            root.getDirectory(deletedDirName, {create: false}, failed.bind(this, done, 'getDirectory - unexpected success callback getting deleted directory : ' + deletedDirName), function() {[m
[32m+[m[32m                        deletedDir.remove(function () {[m
[32m+[m[32m                            root.getDirectory(deletedDirName, {create: false}, failed.bind(this, done, 'getDirectory - unexpected success callback getting deleted directory : ' + deletedDirName), function () {[m
                                 root.getDirectory(secondDirName, {create: false}, win, failed.bind(this, done, 'getDirectory - Error getting directory after deleting deletedDirectory : ' + secondDirName));[m
                             });[m
                         }, failed.bind(this, done, 'remove - Error removing directory : ' + deletedDirName));[m
                     }, failed.bind(this, done, 'root.getDirectory - Error creating directory : ' + secondDirName));[m
                 }, failed.bind(this, done, 'root.getDirectory - Error creating directory : ' + deletedDirName));[m
             });[m
[31m-            it("file.spec.135 Deletion of a child directory should not affect the parent directory.", function (done) {[m
[32m+[m[32m            it('file.spec.135 Deletion of a child directory should not affect the parent directory.', function (done) {[m
 [m
                 var parentName = 'parentName135';[m
                 var childName = 'childName135';[m
 [m
[31m-                var win = function(directory){[m
[32m+[m[32m                var win = function (directory) {[m
                     expect(directory).toBeDefined();[m
                     expect(directory.isFile).toBe(false);[m
                     expect(directory.isDirectory).toBe(true);[m
[36m@@ -3665,20 +3814,20 @@[m [mexports.defineAutoTests = function () {[m
                     deleteEntry(directory.name, done);[m
                 };[m
 [m
[31m-                createDirectory(parentName, function(parent){[m
[31m-                    parent.getDirectory(childName, {create: true}, function(child){[m
[31m-                        child.removeRecursively(function(){[m
[32m+[m[32m                createDirectory(parentName, function (parent) {[m
[32m+[m[32m                    parent.getDirectory(childName, {create: true}, function (child) {[m
[32m+[m[32m                        child.removeRecursively(function () {[m
                             root.getDirectory(parentName, {create: false}, win, failed.bind(this, done, 'root.getDirectory - Error getting parent directory : ' + parentName));[m
                         },[m
                         failed.bind(this, done, 'getDirectory - Error removing directory : ' + childName));[m
                     }, failed.bind(this, done, 'getDirectory - Error creating directory : ' + childName));[m
                 }, failed.bind(this, done, 'root.getDirectory - Error creating directory : ' + parentName));[m
             });[m
[31m-            it("file.spec.136 Paths should support Unicode symbols.", function (done) {[m
[32m+[m[32m            it('file.spec.136 Paths should support Unicode symbols.', function (done) {[m
 [m
                 var dirName = '文件插件';[m
 [m
[31m-                var win = function(directory){[m
[32m+[m[32m                var win = function (directory) {[m
                     expect(directory).toBeDefined();[m
                     expect(directory.isFile).toBe(false);[m
                     expect(directory.isDirectory).toBe(true);[m
[36m@@ -3686,32 +3835,32 @@[m [mexports.defineAutoTests = function () {[m
                     deleteEntry(directory.name, done);[m
                 };[m
 [m
[31m-                createDirectory(dirName, function(){[m
[32m+[m[32m                createDirectory(dirName, function () {[m
                     root.getDirectory(dirName, {create: false}, win,[m
                         failed.bind(this, done, 'root.getDirectory - Error getting directory : ' + dirName));[m
                 }, failed.bind(this, done, 'root.getDirectory - Error creating directory : ' + dirName));[m
             });[m
         });[m
         // Content and Asset URLs[m
[31m-        if (cordova.platformId == 'android') {[m
[31m-            describe('content: URLs', function() {[m
[32m+[m[32m        if (cordova.platformId === 'android') { // eslint-disable-line no-undef[m
[32m+[m[32m            describe('content: URLs', function () {[m
                 // Warning: Default HelloWorld www directory structure is required for these tests (www/index.html at least)[m
[31m-                function testContentCopy(src, done) {[m
[31m-                    var file2 = "entry.copy.file2b",[m
[31m-                    fullPath = joinURL(temp_root.fullPath, file2),[m
[31m-                    validateFile = function (entry) {[m
[32m+[m[32m                function testContentCopy (src, done) {[m
[32m+[m[32m                    var file2 = 'entry.copy.file2b';[m
[32m+[m[32m                    var fullPath = joinURL(temp_root.fullPath, file2);[m
[32m+[m[32m                    var validateFile = function (entry) {[m
                         expect(entry.isFile).toBe(true);[m
                         expect(entry.isDirectory).toBe(false);[m
                         expect(entry.name).toCanonicallyMatch(file2);[m
                         expect(entry.fullPath).toCanonicallyMatch(fullPath);[m
[31m-                        expect(entry.filesystem.name).toEqual("temporary");[m
[32m+[m[32m                        expect(entry.filesystem.name).toEqual('temporary');[m
                         // cleanup[m
                         deleteEntry(entry.name, done);[m
[31m-                    },[m
[31m-                    transfer = function () {[m
[31m-                        resolveLocalFileSystemURL(src, function(entry) {[m
[32m+[m[32m                    };[m
[32m+[m[32m                    var transfer = function () {[m
[32m+[m[32m                        resolveLocalFileSystemURL(src, function (entry) { // eslint-disable-line no-undef[m
                             expect(entry).toBeDefined();[m
[31m-                            expect(entry.filesystem.name).toEqual("content");[m
[32m+[m[32m                            expect(entry.filesystem.name).toEqual('content');[m
                             entry.copyTo(temp_root, file2, validateFile, failed.bind(null, done, 'entry.copyTo - Error copying file: ' + entry.toURL() + ' to TEMPORAL root as: ' + file2));[m
                         }, failed.bind(null, done, 'resolveLocalFileSystemURL failed for content provider'));[m
                     };[m
[36m@@ -3720,14 +3869,14 @@[m [mexports.defineAutoTests = function () {[m
                         entry.remove(transfer, failed.bind(null, done, 'entry.remove - Error removing file: ' + file2));[m
                     }, transfer);[m
                 }[m
[31m-                it("file.spec.138 copyTo: content", function(done) {[m
[32m+[m[32m                it('file.spec.138 copyTo: content', function (done) {[m
                     testContentCopy('content://org.apache.cordova.file.testprovider/www/index.html', done);[m
                 });[m
[31m-                it("file.spec.139 copyTo: content /w space and query", function(done) {[m
[32m+[m[32m                it('file.spec.139 copyTo: content /w space and query', function (done) {[m
                     testContentCopy('content://org.apache.cordova.file.testprovider/?name=foo%20bar&realPath=%2Fwww%2Findex.html', done);[m
                 });[m
[31m-                it("file.spec.140 delete: content should fail", function(done) {[m
[31m-                    resolveLocalFileSystemURL('content://org.apache.cordova.file.testprovider/www/index.html', function(entry) {[m
[32m+[m[32m                it('file.spec.140 delete: content should fail', function (done) {[m
[32m+[m[32m                    resolveLocalFileSystemURL('content://org.apache.cordova.file.testprovider/www/index.html', function (entry) { // eslint-disable-line no-undef[m
                         entry.remove(failed.bind(null, done, 'expected delete to fail'), done);[m
                     }, failed.bind(null, done, 'resolveLocalFileSystemURL failed for content provider'));[m
                 });[m
[36m@@ -3736,12 +3885,12 @@[m [mexports.defineAutoTests = function () {[m
             // these tests ensure that you can read and copy from android_asset folder[m
             // for details see https://issues.apache.org/jira/browse/CB-6428[m
             // and https://mail-archives.apache.org/mod_mbox/cordova-dev/201508.mbox/%3C782154441.8406572.1440182722528.JavaMail.yahoo%40mail.yahoo.com%3E[m
[31m-            describe('asset: URLs', function() {[m
[31m-                it("file.spec.141 filePaths.applicationStorage", function() {[m
[31m-                    expect(cordova.file.applicationDirectory).toEqual('file:///android_asset/');[m
[32m+[m[32m            describe('asset: URLs', function () {[m
[32m+[m[32m                it('file.spec.141 filePaths.applicationStorage', function () {[m
[32m+[m[32m                    expect(cordova.file.applicationDirectory).toEqual('file:///android_asset/'); // eslint-disable-line no-undef[m
                 }, MEDIUM_TIMEOUT);[m
[31m-                it("file.spec.142 assets should be enumerable", function(done) {[m
[31m-                    resolveLocalFileSystemURL('file:///android_asset/www/fixtures/asset-test', function(entry) {[m
[32m+[m[32m                it('file.spec.142 assets should be enumerable', function (done) {[m
[32m+[m[32m                    resolveLocalFileSystemURL('file:///android_asset/www/fixtures/asset-test', function (entry) { // eslint-disable-line no-undef[m
                         var reader = entry.createReader();[m
                         reader.readEntries(function (entries) {[m
                             expect(entries.length).not.toBe(0);[m
[36m@@ -3749,8 +3898,8 @@[m [mexports.defineAutoTests = function () {[m
                         }, failed.bind(null, done, 'reader.readEntries - Error during reading of entries from assets directory'));[m
                     }, failed.bind(null, done, 'resolveLocalFileSystemURL failed for assets'));[m
                 }, MEDIUM_TIMEOUT);[m
[31m-                it("file.spec.145 asset subdirectories should be obtainable", function(done) {[m
[31m-                    resolveLocalFileSystemURL('file:///android_asset/www/fixtures', function(entry) {[m
[32m+[m[32m                it('file.spec.145 asset subdirectories should be obtainable', function (done) {[m
[32m+[m[32m                    resolveLocalFileSystemURL('file:///android_asset/www/fixtures', function (entry) { // eslint-disable-line no-undef[m
                         entry.getDirectory('asset-test', { create: false }, function (subDir) {[m
                             expect(subDir).toBeDefined();[m
                             expect(subDir.isFile).toBe(false);[m
[36m@@ -3760,12 +3909,12 @@[m [mexports.defineAutoTests = function () {[m
                         }, failed.bind(null, done, 'entry.getDirectory - Error getting asset subdirectory'));[m
                     }, failed.bind(null, done, 'resolveLocalFileSystemURL failed for assets'));[m
                 }, MEDIUM_TIMEOUT);[m
[31m-                it("file.spec.146 asset files should be readable", function(done) {[m
[31m-                    resolveLocalFileSystemURL('file:///android_asset/www/fixtures/asset-test/asset-test.txt', function(entry) {[m
[32m+[m[32m                it('file.spec.146 asset files should be readable', function (done) {[m
[32m+[m[32m                    resolveLocalFileSystemURL('file:///android_asset/www/fixtures/asset-test/asset-test.txt', function (entry) { // eslint-disable-line no-undef[m
                         expect(entry.isFile).toBe(true);[m
                         entry.file(function (file) {[m
                             expect(file).toBeDefined();[m
[31m-                            var reader = new FileReader();[m
[32m+[m[32m                            var reader = new FileReader(); // eslint-disable-line no-undef[m
                             reader.onerror = failed.bind(null, done, 'reader.readAsText - Error reading asset text file');[m
                             reader.onloadend = function () {[m
                                 expect(this.result).toBeDefined();[m
[36m@@ -3776,20 +3925,20 @@[m [mexports.defineAutoTests = function () {[m
                         }, failed.bind(null, done, 'entry.file - Error reading asset file'));[m
                     }, failed.bind(null, done, 'resolveLocalFileSystemURL failed for assets'));[m
                 }, MEDIUM_TIMEOUT);[m
[31m-                it("file.spec.143 copyTo: asset -> temporary", function(done) {[m
[31m-                    var file2 = "entry.copy.file2b",[m
[31m-                    fullPath = joinURL(temp_root.fullPath, file2),[m
[31m-                    validateFile = function (entry) {[m
[32m+[m[32m                it('file.spec.143 copyTo: asset -> temporary', function (done) {[m
[32m+[m[32m                    var file2 = 'entry.copy.file2b';[m
[32m+[m[32m                    var fullPath = joinURL(temp_root.fullPath, file2);[m
[32m+[m[32m                    var validateFile = function (entry) {[m
                         expect(entry.isFile).toBe(true);[m
                         expect(entry.isDirectory).toBe(false);[m
                         expect(entry.name).toCanonicallyMatch(file2);[m
                         expect(entry.fullPath).toCanonicallyMatch(fullPath);[m
[31m-                        expect(entry.filesystem.name).toEqual("temporary");[m
[32m+[m[32m                        expect(entry.filesystem.name).toEqual('temporary');[m
                         // cleanup[m
                         deleteEntry(entry.name, done);[m
[31m-                    },[m
[31m-                    transfer = function () {[m
[31m-                        resolveLocalFileSystemURL('file:///android_asset/www/index.html', function(entry) {[m
[32m+[m[32m                    };[m
[32m+[m[32m                    var transfer = function () {[m
[32m+[m[32m                        resolveLocalFileSystemURL('file:///android_asset/www/index.html', function (entry) { // eslint-disable-line no-undef[m
                             expect(entry.filesystem.name).toEqual('assets');[m
                             entry.copyTo(temp_root, file2, validateFile, failed.bind(null, done, 'entry.copyTo - Error copying file: ' + entry.toURL() + ' to TEMPORAL root as: ' + file2));[m
                         }, failed.bind(null, done, 'resolveLocalFileSystemURL failed for assets'));[m
[36m@@ -3800,13 +3949,13 @@[m [mexports.defineAutoTests = function () {[m
                     }, transfer);[m
                 }, MEDIUM_TIMEOUT);[m
             });[m
[31m-            it("file.spec.144 copyTo: asset directory", function (done) {[m
[32m+[m[32m            it('file.spec.144 copyTo: asset directory', function (done) {[m
                 var srcUrl = 'file:///android_asset/www/fixtures/asset-test';[m
[31m-                var dstDir = "entry.copy.dstDir";[m
[32m+[m[32m                var dstDir = 'entry.copy.dstDir';[m
                 var dstPath = joinURL(root.fullPath, dstDir);[m
                 // create a new directory entry to kick off it[m
                 deleteEntry(dstDir, function () {[m
[31m-                    resolveLocalFileSystemURL(srcUrl, function(directory) {[m
[32m+[m[32m                    resolveLocalFileSystemURL(srcUrl, function (directory) { // eslint-disable-line no-undef[m
                         directory.copyTo(root, dstDir, function (directory) {[m
                             expect(directory).toBeDefined();[m
                             expect(directory.isFile).toBe(false);[m
[36m@@ -3814,7 +3963,7 @@[m [mexports.defineAutoTests = function () {[m
                             expect(directory.fullPath).toCanonicallyMatch(dstPath);[m
                             expect(directory.name).toCanonicallyMatch(dstDir);[m
                             root.getDirectory(dstDir, {[m
[31m-                                create : false[m
[32m+[m[32m                                create: false[m
                             }, function (dirEntry) {[m
                                 expect(dirEntry).toBeDefined();[m
                                 expect(dirEntry.isFile).toBe(false);[m
[36m@@ -3822,7 +3971,7 @@[m [mexports.defineAutoTests = function () {[m
                                 expect(dirEntry.fullPath).toCanonicallyMatch(dstPath);[m
                                 expect(dirEntry.name).toCanonicallyMatch(dstDir);[m
                                 dirEntry.getFile('asset-test.txt', {[m
[31m-                                    create : false[m
[32m+[m[32m                                    create: false[m
                                 }, function (fileEntry) {[m
                                     expect(fileEntry).toBeDefined();[m
                                     expect(fileEntry.isFile).toBe(true);[m
[36m@@ -3838,88 +3987,89 @@[m [mexports.defineAutoTests = function () {[m
     });[m
 [m
 };[m
[31m-//******************************************************************************************[m
[31m-//***************************************Manual Tests***************************************[m
[31m-//******************************************************************************************[m
[32m+[m[32m//* *****************************************************************************************[m
[32m+[m[32m//* **************************************Manual Tests***************************************[m
[32m+[m[32m//* *****************************************************************************************[m
 [m
 exports.defineManualTests = function (contentEl, createActionButton) {[m
 [m
[31m-    function resolveFs(fsname) {[m
[31m-        var fsURL = "cdvfile://localhost/" + fsname + "/";[m
[31m-        logMessage("Resolving URL: " + fsURL);[m
[32m+[m[32m    function resolveFs (fsname) {[m
[32m+[m[32m        var fsURL = 'cdvfile://localhost/' + fsname + '/';[m
[32m+[m[32m        logMessage('Resolving URL: ' + fsURL);[m
[32m+[m[32m        /* eslint-disable no-undef */[m
         resolveLocalFileSystemURL(fsURL, function (entry) {[m
[31m-            logMessage("Success", 'green');[m
[32m+[m[32m            logMessage('Success', 'green');[m
             logMessage(entry.toURL(), 'blue');[m
             logMessage(entry.toInternalURL(), 'blue');[m
[31m-            logMessage("Resolving URL: " + entry.toURL());[m
[32m+[m[32m            logMessage('Resolving URL: ' + entry.toURL());[m
             resolveLocalFileSystemURL(entry.toURL(), function (entry2) {[m
[31m-                logMessage("Success", 'green');[m
[32m+[m[32m                logMessage('Success', 'green');[m
                 logMessage(entry2.toURL(), 'blue');[m
                 logMessage(entry2.toInternalURL(), 'blue');[m
[31m-            }, logError("resolveLocalFileSystemURL"));[m
[31m-        }, logError("resolveLocalFileSystemURL"));[m
[32m+[m[32m            }, logError('resolveLocalFileSystemURL'));[m
[32m+[m[32m        }, logError('resolveLocalFileSystemURL'));[m
     }[m
 [m
[31m-    function testPrivateURL() {[m
[32m+[m[32m    function testPrivateURL () {[m
         requestFileSystem(LocalFileSystem.TEMPORARY, 0, function (fileSystem) {[m
[31m-            logMessage("Temporary root is at " + fileSystem.root.toNativeURL());[m
[31m-            fileSystem.root.getFile("testfile", {[m
[31m-                create : true[m
[32m+[m[32m            logMessage('Temporary root is at ' + fileSystem.root.toNativeURL());[m
[32m+[m[32m            fileSystem.root.getFile('testfile', {[m
[32m+[m[32m                create: true[m
             }, function (entry) {[m
[31m-                logMessage("Temporary file is at " + entry.toNativeURL());[m
[31m-                if (entry.toNativeURL().substring(0, 12) == "file:///var/") {[m
[31m-                    logMessage("File starts with /var/, trying /private/var");[m
[31m-                    var newURL = "file://localhost/private/var/" + entry.toNativeURL().substring(12) + "?and=another_thing";[m
[31m-                    //var newURL = entry.toNativeURL();[m
[32m+[m[32m                logMessage('Temporary file is at ' + entry.toNativeURL());[m
[32m+[m[32m                if (entry.toNativeURL().substring(0, 12) === 'file:///var/') {[m
[32m+[m[32m                    logMessage('File starts with /var/, trying /private/var');[m
[32m+[m[32m                    var newURL = 'file://localhost/private/var/' + entry.toNativeURL().substring(12) + '?and=another_thing';[m
[32m+[m[32m                    // var newURL = entry.toNativeURL();[m
                     logMessage(newURL, 'blue');[m
                     resolveLocalFileSystemURL(newURL, function (newEntry) {[m
[31m-                        logMessage("Successfully resolved.", 'green');[m
[32m+[m[32m                        logMessage('Successfully resolved.', 'green');[m
                         logMessage(newEntry.toURL(), 'blue');[m
                         logMessage(newEntry.toNativeURL(), 'blue');[m
[31m-                    }, logError("resolveLocalFileSystemURL"));[m
[32m+[m[32m                    }, logError('resolveLocalFileSystemURL'));[m
                 }[m
[31m-            }, logError("getFile"));[m
[31m-        }, logError("requestFileSystem"));[m
[32m+[m[32m            }, logError('getFile'));[m
[32m+[m[32m        }, logError('requestFileSystem'));[m
     }[m
 [m
[31m-    function resolveFsContactImage() {[m
[31m-        navigator.contacts.pickContact(function(contact) {[m
[31m-            var logBox = document.getElementById("logContactBox");[m
[31m-            logBox.innerHTML = "";[m
[31m-            var resolveResult = document.createElement("p");[m
[32m+[m[32m    function resolveFsContactImage () {[m
[32m+[m[32m        navigator.contacts.pickContact(function (contact) {[m
[32m+[m[32m            var logBox = document.getElementById('logContactBox');[m
[32m+[m[32m            logBox.innerHTML = '';[m
[32m+[m[32m            var resolveResult = document.createElement('p');[m
             if (contact.photos) {[m
                 var photoURL = contact.photos[0].value;[m
[31m-                resolveLocalFileSystemURL(photoURL, function(entry) {[m
[31m-                    var contactImage = document.createElement("img");[m
[31m-                    var contactLabelImage = document.createElement("p");                       [m
[31m-                    contactLabelImage.innerHTML = "Result contact image";                   [m
[31m-                    contactImage.setAttribute("src", entry.toURL());[m
[31m-                    resolveResult.innerHTML = "Success resolve\n" + entry.toURL();[m
[32m+[m[32m                resolveLocalFileSystemURL(photoURL, function (entry) {[m
[32m+[m[32m                    /* eslint-enable no-undef */[m
[32m+[m[32m                    var contactImage = document.createElement('img');[m
[32m+[m[32m                    var contactLabelImage = document.createElement('p');[m
[32m+[m[32m                    contactLabelImage.innerHTML = 'Result contact image';[m
[32m+[m[32m                    contactImage.setAttribute('src', entry.toURL());[m
[32m+[m[32m                    resolveResult.innerHTML = 'Success resolve\n' + entry.toURL();[m
                     logBox.appendChild(contactLabelImage);[m
                     logBox.appendChild(contactImage);[m
                     logBox.appendChild(resolveResult);[m
[31m-                }, [m
[31m-                function(err) {[m
[31m-                    console.log("resolve error" + err);[m
[31m-                }); [m
[31m-            }[m
[31m-            else {[m
[31m-                resolveResult.innerHTML = "Contact has no photos";[m
[32m+[m[32m                },[m
[32m+[m[32m                function (err) {[m
[32m+[m[32m                    console.log('resolve error' + err);[m
[32m+[m[32m                });[m
[32m+[m[32m            } else {[m
[32m+[m[32m                resolveResult.innerHTML = 'Contact has no photos';[m
                 logBox.appendChild(resolveResult);[m
             }[m
[31m-        }, [m
[31m-        function(err) {[m
[31m-            console.log("contact pick error" + err);[m
[32m+[m[32m        },[m
[32m+[m[32m        function (err) {[m
[32m+[m[32m            console.log('contact pick error' + err);[m
         });[m
[31m-    }    [m
[32m+[m[32m    }[m
 [m
[31m-    function clearLog() {[m
[31m-        var log = document.getElementById("info");[m
[31m-        log.innerHTML = "";[m
[32m+[m[32m    function clearLog () {[m
[32m+[m[32m        var log = document.getElementById('info');[m
[32m+[m[32m        log.innerHTML = '';[m
     }[m
 [m
[31m-    function logMessage(message, color) {[m
[31m-        var log = document.getElementById("info");[m
[32m+[m[32m    function logMessage (message, color) {[m
[32m+[m[32m        var log = document.getElementById('info');[m
         var logLine = document.createElement('div');[m
         if (color) {[m
             logLine.style.color = color;[m
[36m@@ -3928,39 +4078,41 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         log.appendChild(logLine);[m
     }[m
 [m
[31m-    function logError(serviceName) {[m
[32m+[m[32m    function logError (serviceName) {[m
         return function (err) {[m
[31m-            logMessage("ERROR: " + serviceName + " " + JSON.stringify(err), "red");[m
[32m+[m[32m            logMessage('ERROR: ' + serviceName + ' ' + JSON.stringify(err), 'red');[m
         };[m
     }[m
 [m
     var fsRoots = {[m
[31m-        "ios" : "library,library-nosync,documents,documents-nosync,cache,bundle,root,private",[m
[31m-        "osx" : "library,library-nosync,documents,documents-nosync,cache,bundle,root,private",[m
[31m-        "android" : "files,files-external,documents,sdcard,cache,cache-external,assets,root",[m
[31m-        "amazon-fireos" : "files,files-external,documents,sdcard,cache,cache-external,root",[m
[31m-        "windows": "temporary,persistent"[m
[32m+[m[32m        'ios': 'library,library-nosync,documents,documents-nosync,cache,bundle,root,private',[m
[32m+[m[32m        'osx': 'library,library-nosync,documents,documents-nosync,cache,bundle,root,private',[m
[32m+[m[32m        'android': 'files,files-external,documents,sdcard,cache,cache-external,assets,root',[m
[32m+[m[32m        'amazon-fireos': 'files,files-external,documents,sdcard,cache,cache-external,root',[m
[32m+[m[32m        'windows': 'temporary,persistent'[m
     };[m
 [m
[31m-    //Add title and align to content[m
[32m+[m[32m    // Add title and align to content[m
     var div = document.createElement('h2');[m
     div.appendChild(document.createTextNode('File Systems'));[m
[31m-    div.setAttribute("align", "center");[m
[32m+[m[32m    div.setAttribute('align', 'center');[m
     contentEl.appendChild(div);[m
 [m
     div = document.createElement('h3');[m
     div.appendChild(document.createTextNode('Results are displayed in yellow status box below with expected results noted under that'));[m
[31m-    div.setAttribute("align", "center");[m
[32m+[m[32m    div.setAttribute('align', 'center');[m
     contentEl.appendChild(div);[m
 [m
     div = document.createElement('div');[m
[31m-    div.setAttribute("id", "button");[m
[31m-    div.setAttribute("align", "center");[m
[32m+[m[32m    div.setAttribute('id', 'button');[m
[32m+[m[32m    div.setAttribute('align', 'center');[m
     contentEl.appendChild(div);[m
[32m+[m[32m    /* eslint-disable no-undef */[m
     if (fsRoots.hasOwnProperty(cordova.platformId)) {[m
         (fsRoots[cordova.platformId].split(',')).forEach(function (fs) {[m
             if (cordova.platformId === 'ios' && fs === 'private') {[m
[31m-                createActionButton("Test private URL (iOS)", function () {[m
[32m+[m[32m                /* eslint-enable no-undef */[m
[32m+[m[32m                createActionButton('Test private URL (iOS)', function () {[m
                     clearLog();[m
                     testPrivateURL();[m
                 }, 'button');[m
[36m@@ -3973,10 +4125,9 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         });[m
     }[m
 [m
[31m-[m
     div = document.createElement('div');[m
[31m-    div.setAttribute("id", "info");[m
[31m-    div.setAttribute("align", "center");[m
[32m+[m[32m    div.setAttribute('id', 'info');[m
[32m+[m[32m    div.setAttribute('align', 'center');[m
     contentEl.appendChild(div);[m
 [m
     div = document.createElement('h3');[m
[36m@@ -3993,20 +4144,20 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
 [m
     div = document.createElement('h2');[m
     div.appendChild(document.createTextNode('Resolving content urls'));[m
[31m-    div.setAttribute("align", "center");[m
[32m+[m[32m    div.setAttribute('align', 'center');[m
     contentEl.appendChild(div);[m
 [m
     div = document.createElement('div');[m
[31m-    div.setAttribute("id", "contactButton");[m
[31m-    div.setAttribute("align", "center");[m
[32m+[m[32m    div.setAttribute('id', 'contactButton');[m
[32m+[m[32m    div.setAttribute('align', 'center');[m
     contentEl.appendChild(div);[m
 [m
     div = document.createElement('div');[m
[31m-    div.setAttribute("id", "logContactBox");[m
[31m-    div.setAttribute("align", "center");[m
[32m+[m[32m    div.setAttribute('id', 'logContactBox');[m
[32m+[m[32m    div.setAttribute('align', 'center');[m
     contentEl.appendChild(div);[m
 [m
     createActionButton('show-contact-image', function () {[m
         resolveFsContactImage();[m
[31m-    }, 'contactButton');    [m
[32m+[m[32m    }, 'contactButton');[m
 };[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/DirectoryEntry.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/DirectoryEntry.js[m
[1mindex 62f468a..d943f6d 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/DirectoryEntry.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/DirectoryEntry.js[m
[36m@@ -19,12 +19,12 @@[m
  *[m
 */[m
 [m
[31m-var argscheck = require('cordova/argscheck'),[m
[31m-    utils = require('cordova/utils'),[m
[31m-    exec = require('cordova/exec'),[m
[31m-    Entry = require('./Entry'),[m
[31m-    FileError = require('./FileError'),[m
[31m-    DirectoryReader = require('./DirectoryReader');[m
[32m+[m[32mvar argscheck = require('cordova/argscheck');[m
[32m+[m[32mvar utils = require('cordova/utils');[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar Entry = require('./Entry');[m
[32m+[m[32mvar FileError = require('./FileError');[m
[32m+[m[32mvar DirectoryReader = require('./DirectoryReader');[m
 [m
 /**[m
  * An interface representing a directory on the file system.[m
[36m@@ -35,15 +35,15 @@[m [mvar argscheck = require('cordova/argscheck'),[m
  * {DOMString} fullPath the absolute full path to the directory (readonly)[m
  * {FileSystem} filesystem on which the directory resides (readonly)[m
  */[m
[31m-var DirectoryEntry = function(name, fullPath, fileSystem, nativeURL) {[m
[32m+[m[32mvar DirectoryEntry = function (name, fullPath, fileSystem, nativeURL) {[m
 [m
     // add trailing slash if it is missing[m
     if ((fullPath) && !/\/$/.test(fullPath)) {[m
[31m-        fullPath += "/";[m
[32m+[m[32m        fullPath += '/';[m
     }[m
     // add trailing slash if it is missing[m
     if (nativeURL && !/\/$/.test(nativeURL)) {[m
[31m-        nativeURL += "/";[m
[32m+[m[32m        nativeURL += '/';[m
     }[m
     DirectoryEntry.__super__.constructor.call(this, false, true, name, fullPath, fileSystem, nativeURL);[m
 };[m
[36m@@ -53,7 +53,7 @@[m [mutils.extend(DirectoryEntry, Entry);[m
 /**[m
  * Creates a new DirectoryReader to read entries from this directory[m
  */[m
[31m-DirectoryEntry.prototype.createReader = function() {[m
[32m+[m[32mDirectoryEntry.prototype.createReader = function () {[m
     return new DirectoryReader(this.toInternalURL());[m
 };[m
 [m
[36m@@ -65,17 +65,17 @@[m [mDirectoryEntry.prototype.createReader = function() {[m
  * @param {Function} successCallback is called with the new entry[m
  * @param {Function} errorCallback is called with a FileError[m
  */[m
[31m-DirectoryEntry.prototype.getDirectory = function(path, options, successCallback, errorCallback) {[m
[32m+[m[32mDirectoryEntry.prototype.getDirectory = function (path, options, successCallback, errorCallback) {[m
     argscheck.checkArgs('sOFF', 'DirectoryEntry.getDirectory', arguments);[m
     var fs = this.filesystem;[m
[31m-    var win = successCallback && function(result) {[m
[32m+[m[32m    var win = successCallback && function (result) {[m
         var entry = new DirectoryEntry(result.name, result.fullPath, fs, result.nativeURL);[m
         successCallback(entry);[m
     };[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(win, fail, "File", "getDirectory", [this.toInternalURL(), path, options]);[m
[32m+[m[32m    exec(win, fail, 'File', 'getDirectory', [this.toInternalURL(), path, options]);[m
 };[m
 [m
 /**[m
[36m@@ -84,12 +84,12 @@[m [mDirectoryEntry.prototype.getDirectory = function(path, options, successCallback,[m
  * @param {Function} successCallback is called with no parameters[m
  * @param {Function} errorCallback is called with a FileError[m
  */[m
[31m-DirectoryEntry.prototype.removeRecursively = function(successCallback, errorCallback) {[m
[32m+[m[32mDirectoryEntry.prototype.removeRecursively = function (successCallback, errorCallback) {[m
     argscheck.checkArgs('FF', 'DirectoryEntry.removeRecursively', arguments);[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(successCallback, fail, "File", "removeRecursively", [this.toInternalURL()]);[m
[32m+[m[32m    exec(successCallback, fail, 'File', 'removeRecursively', [this.toInternalURL()]);[m
 };[m
 [m
 /**[m
[36m@@ -100,18 +100,18 @@[m [mDirectoryEntry.prototype.removeRecursively = function(successCallback, errorCall[m
  * @param {Function} successCallback is called with the new entry[m
  * @param {Function} errorCallback is called with a FileError[m
  */[m
[31m-DirectoryEntry.prototype.getFile = function(path, options, successCallback, errorCallback) {[m
[32m+[m[32mDirectoryEntry.prototype.getFile = function (path, options, successCallback, errorCallback) {[m
     argscheck.checkArgs('sOFF', 'DirectoryEntry.getFile', arguments);[m
     var fs = this.filesystem;[m
[31m-    var win = successCallback && function(result) {[m
[32m+[m[32m    var win = successCallback && function (result) {[m
         var FileEntry = require('./FileEntry');[m
         var entry = new FileEntry(result.name, result.fullPath, fs, result.nativeURL);[m
         successCallback(entry);[m
     };[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(win, fail, "File", "getFile", [this.toInternalURL(), path, options]);[m
[32m+[m[32m    exec(win, fail, 'File', 'getFile', [this.toInternalURL(), path, options]);[m
 };[m
 [m
 module.exports = DirectoryEntry;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/DirectoryReader.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/DirectoryReader.js[m
[1mindex 2894c9a..7366953 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/DirectoryReader.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/DirectoryReader.js[m
[36m@@ -19,13 +19,13 @@[m
  *[m
 */[m
 [m
[31m-var exec = require('cordova/exec'),[m
[31m-    FileError = require('./FileError') ;[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar FileError = require('./FileError');[m
 [m
 /**[m
  * An interface that lists the files and directories in a directory.[m
  */[m
[31m-function DirectoryReader(localURL) {[m
[32m+[m[32mfunction DirectoryReader (localURL) {[m
     this.localURL = localURL || null;[m
     this.hasReadEntries = false;[m
 }[m
[36m@@ -36,21 +36,20 @@[m [mfunction DirectoryReader(localURL) {[m
  * @param {Function} successCallback is called with a list of entries[m
  * @param {Function} errorCallback is called with a FileError[m
  */[m
[31m-DirectoryReader.prototype.readEntries = function(successCallback, errorCallback) {[m
[32m+[m[32mDirectoryReader.prototype.readEntries = function (successCallback, errorCallback) {[m
     // If we've already read and passed on this directory's entries, return an empty list.[m
     if (this.hasReadEntries) {[m
         successCallback([]);[m
         return;[m
     }[m
     var reader = this;[m
[31m-    var win = typeof successCallback !== 'function' ? null : function(result) {[m
[32m+[m[32m    var win = typeof successCallback !== 'function' ? null : function (result) {[m
         var retVal = [];[m
[31m-        for (var i=0; i<result.length; i++) {[m
[32m+[m[32m        for (var i = 0; i < result.length; i++) {[m
             var entry = null;[m
             if (result[i].isDirectory) {[m
                 entry = new (require('./DirectoryEntry'))();[m
[31m-            }[m
[31m-            else if (result[i].isFile) {[m
[32m+[m[32m            } else if (result[i].isFile) {[m
                 entry = new (require('./FileEntry'))();[m
             }[m
             entry.isDirectory = result[i].isDirectory;[m
[36m@@ -64,10 +63,10 @@[m [mDirectoryReader.prototype.readEntries = function(successCallback, errorCallback)[m
         reader.hasReadEntries = true;[m
         successCallback(retVal);[m
     };[m
[31m-    var fail = typeof errorCallback !== 'function' ? null : function(code) {[m
[32m+[m[32m    var fail = typeof errorCallback !== 'function' ? null : function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(win, fail, "File", "readEntries", [this.localURL]);[m
[32m+[m[32m    exec(win, fail, 'File', 'readEntries', [this.localURL]);[m
 };[m
 [m
 module.exports = DirectoryReader;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/Entry.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/Entry.js[m
[1mindex 00ee023..8f7a927 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/Entry.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/Entry.js[m
[36m@@ -19,10 +19,10 @@[m
  *[m
 */[m
 [m
[31m-var argscheck = require('cordova/argscheck'),[m
[31m-    exec = require('cordova/exec'),[m
[31m-    FileError = require('./FileError'),[m
[31m-    Metadata = require('./Metadata');[m
[32m+[m[32mvar argscheck = require('cordova/argscheck');[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar FileError = require('./FileError');[m
[32m+[m[32mvar Metadata = require('./Metadata');[m
 [m
 /**[m
  * Represents a file or directory on the local file system.[m
[36m@@ -45,7 +45,7 @@[m [mvar argscheck = require('cordova/argscheck'),[m
  *            webview controls, for example media players.[m
  *            (optional, readonly)[m
  */[m
[31m-function Entry(isFile, isDirectory, name, fullPath, fileSystem, nativeURL) {[m
[32m+[m[32mfunction Entry (isFile, isDirectory, name, fullPath, fileSystem, nativeURL) {[m
     this.isFile = !!isFile;[m
     this.isDirectory = !!isDirectory;[m
     this.name = name || '';[m
[36m@@ -62,19 +62,19 @@[m [mfunction Entry(isFile, isDirectory, name, fullPath, fileSystem, nativeURL) {[m
  * @param errorCallback[m
  *            {Function} is called with a FileError[m
  */[m
[31m-Entry.prototype.getMetadata = function(successCallback, errorCallback) {[m
[32m+[m[32mEntry.prototype.getMetadata = function (successCallback, errorCallback) {[m
     argscheck.checkArgs('FF', 'Entry.getMetadata', arguments);[m
[31m-    var success = successCallback && function(entryMetadata) {[m
[32m+[m[32m    var success = successCallback && function (entryMetadata) {[m
         var metadata = new Metadata({[m
             size: entryMetadata.size,[m
             modificationTime: entryMetadata.lastModifiedDate[m
         });[m
         successCallback(metadata);[m
     };[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(success, fail, "File", "getFileMetadata", [this.toInternalURL()]);[m
[32m+[m[32m    exec(success, fail, 'File', 'getFileMetadata', [this.toInternalURL()]);[m
 };[m
 [m
 /**[m
[36m@@ -87,9 +87,9 @@[m [mEntry.prototype.getMetadata = function(successCallback, errorCallback) {[m
  * @param metadataObject[m
  *            {Object} keys and values to set[m
  */[m
[31m-Entry.prototype.setMetadata = function(successCallback, errorCallback, metadataObject) {[m
[32m+[m[32mEntry.prototype.setMetadata = function (successCallback, errorCallback, metadataObject) {[m
     argscheck.checkArgs('FFO', 'Entry.setMetadata', arguments);[m
[31m-    exec(successCallback, errorCallback, "File", "setMetadata", [this.toInternalURL(), metadataObject]);[m
[32m+[m[32m    exec(successCallback, errorCallback, 'File', 'setMetadata', [this.toInternalURL(), metadataObject]);[m
 };[m
 [m
 /**[m
[36m@@ -104,34 +104,33 @@[m [mEntry.prototype.setMetadata = function(successCallback, errorCallback, metadataO[m
  * @param errorCallback[m
  *            {Function} called with a FileError[m
  */[m
[31m-Entry.prototype.moveTo = function(parent, newName, successCallback, errorCallback) {[m
[32m+[m[32mEntry.prototype.moveTo = function (parent, newName, successCallback, errorCallback) {[m
     argscheck.checkArgs('oSFF', 'Entry.moveTo', arguments);[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    var srcURL = this.toInternalURL(),[m
[31m-        // entry name[m
[31m-        name = newName || this.name,[m
[31m-        success = function(entry) {[m
[31m-            if (entry) {[m
[31m-                if (successCallback) {[m
[31m-                    // create appropriate Entry object[m
[31m-                    var newFSName = entry.filesystemName || (entry.filesystem && entry.filesystem.name);[m
[31m-                    var fs = newFSName ? new FileSystem(newFSName, { name: "", fullPath: "/" }) : new FileSystem(parent.filesystem.name, { name: "", fullPath: "/" });[m
[31m-                    var result = (entry.isDirectory) ? new (require('./DirectoryEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL) : new (require('cordova-plugin-file.FileEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL);[m
[31m-                    successCallback(result);[m
[31m-                }[m
[32m+[m[32m    var srcURL = this.toInternalURL();[m
[32m+[m[32m    // entry name[m
[32m+[m[32m    var name = newName || this.name;[m
[32m+[m[32m    var success = function (entry) {[m
[32m+[m[32m        if (entry) {[m
[32m+[m[32m            if (successCallback) {[m
[32m+[m[32m                // create appropriate Entry object[m
[32m+[m[32m                var newFSName = entry.filesystemName || (entry.filesystem && entry.filesystem.name);[m
[32m+[m[32m                var fs = newFSName ? new FileSystem(newFSName, { name: '', fullPath: '/' }) : new FileSystem(parent.filesystem.name, { name: '', fullPath: '/' }); // eslint-disable-line no-undef[m
[32m+[m[32m                var result = (entry.isDirectory) ? new (require('./DirectoryEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL) : new (require('cordova-plugin-file.FileEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL);[m
[32m+[m[32m                successCallback(result);[m
             }[m
[31m-            else {[m
[31m-                // no Entry object returned[m
[31m-                if (fail) {[m
[31m-                    fail(FileError.NOT_FOUND_ERR);[m
[31m-                }[m
[32m+[m[32m        } else {[m
[32m+[m[32m            // no Entry object returned[m
[32m+[m[32m            if (fail) {[m
[32m+[m[32m                fail(FileError.NOT_FOUND_ERR);[m
             }[m
[31m-        };[m
[32m+[m[32m        }[m
[32m+[m[32m    };[m
 [m
     // copy[m
[31m-    exec(success, fail, "File", "moveTo", [srcURL, parent.toInternalURL(), name]);[m
[32m+[m[32m    exec(success, fail, 'File', 'moveTo', [srcURL, parent.toInternalURL(), name]);[m
 };[m
 [m
 /**[m
[36m@@ -146,43 +145,42 @@[m [mEntry.prototype.moveTo = function(parent, newName, successCallback, errorCallbac[m
  * @param errorCallback[m
  *            {Function} called with a FileError[m
  */[m
[31m-Entry.prototype.copyTo = function(parent, newName, successCallback, errorCallback) {[m
[32m+[m[32mEntry.prototype.copyTo = function (parent, newName, successCallback, errorCallback) {[m
     argscheck.checkArgs('oSFF', 'Entry.copyTo', arguments);[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    var srcURL = this.toInternalURL(),[m
[32m+[m[32m    var srcURL = this.toInternalURL();[m
         // entry name[m
[31m-        name = newName || this.name,[m
[31m-        // success callback[m
[31m-        success = function(entry) {[m
[31m-            if (entry) {[m
[31m-                if (successCallback) {[m
[31m-                    // create appropriate Entry object[m
[31m-                    var newFSName = entry.filesystemName || (entry.filesystem && entry.filesystem.name);[m
[31m-                    var fs = newFSName ? new FileSystem(newFSName, { name: "", fullPath: "/" }) : new FileSystem(parent.filesystem.name, { name: "", fullPath: "/" });[m
[31m-                    var result = (entry.isDirectory) ? new (require('./DirectoryEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL) : new (require('cordova-plugin-file.FileEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL);[m
[31m-                    successCallback(result);[m
[31m-                }[m
[32m+[m[32m    var name = newName || this.name;[m
[32m+[m[32m    // success callback[m
[32m+[m[32m    var success = function (entry) {[m
[32m+[m[32m        if (entry) {[m
[32m+[m[32m            if (successCallback) {[m
[32m+[m[32m                // create appropriate Entry object[m
[32m+[m[32m                var newFSName = entry.filesystemName || (entry.filesystem && entry.filesystem.name);[m
[32m+[m[32m                var fs = newFSName ? new FileSystem(newFSName, { name: '', fullPath: '/' }) : new FileSystem(parent.filesystem.name, { name: '', fullPath: '/' }); // eslint-disable-line no-undef[m
[32m+[m[32m                var result = (entry.isDirectory) ? new (require('./DirectoryEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL) : new (require('cordova-plugin-file.FileEntry'))(entry.name, entry.fullPath, fs, entry.nativeURL);[m
[32m+[m[32m                successCallback(result);[m
             }[m
[31m-            else {[m
[31m-                // no Entry object returned[m
[31m-                if (fail) {[m
[31m-                    fail(FileError.NOT_FOUND_ERR);[m
[31m-                }[m
[32m+[m[32m        } else {[m
[32m+[m[32m            // no Entry object returned[m
[32m+[m[32m            if (fail) {[m
[32m+[m[32m                fail(FileError.NOT_FOUND_ERR);[m
             }[m
[31m-        };[m
[32m+[m[32m        }[m
[32m+[m[32m    };[m
 [m
     // copy[m
[31m-    exec(success, fail, "File", "copyTo", [srcURL, parent.toInternalURL(), name]);[m
[32m+[m[32m    exec(success, fail, 'File', 'copyTo', [srcURL, parent.toInternalURL(), name]);[m
 };[m
 [m
 /**[m
  * Return a URL that can be passed across the bridge to identify this entry.[m
  */[m
[31m-Entry.prototype.toInternalURL = function() {[m
[32m+[m[32mEntry.prototype.toInternalURL = function () {[m
     if (this.filesystem && this.filesystem.__format__) {[m
[31m-      return this.filesystem.__format__(this.fullPath, this.nativeURL);[m
[32m+[m[32m        return this.filesystem.__format__(this.fullPath, this.nativeURL);[m
     }[m
 };[m
 [m
[36m@@ -191,13 +189,13 @@[m [mEntry.prototype.toInternalURL = function() {[m
  * Use a URL that can be used to as the src attribute of a <video> or[m
  * <audio> tag. If that is not possible, construct a cdvfile:// URL.[m
  */[m
[31m-Entry.prototype.toURL = function() {[m
[32m+[m[32mEntry.prototype.toURL = function () {[m
     if (this.nativeURL) {[m
[31m-      return this.nativeURL;[m
[32m+[m[32m        return this.nativeURL;[m
     }[m
     // fullPath attribute may contain the full URL in the case that[m
     // toInternalURL fails.[m
[31m-    return this.toInternalURL() || "file://localhost" + this.fullPath;[m
[32m+[m[32m    return this.toInternalURL() || 'file://localhost' + this.fullPath;[m
 };[m
 [m
 /**[m
[36m@@ -207,7 +205,7 @@[m [mEntry.prototype.toURL = function() {[m
  * See CB-6051, CB-6106, CB-6117, CB-6152, CB-6199, CB-6201, CB-6243, CB-6249,[m
  * and CB-6300.[m
  */[m
[31m-Entry.prototype.toNativeURL = function() {[m
[32m+[m[32mEntry.prototype.toNativeURL = function () {[m
     console.log("DEPRECATED: Update your code to use 'toURL'");[m
     return this.toURL();[m
 };[m
[36m@@ -218,7 +216,7 @@[m [mEntry.prototype.toNativeURL = function() {[m
  * @param {DOMString} mimeType for a FileEntry, the mime type to be used to interpret the file, when loaded through this URI.[m
  * @return uri[m
  */[m
[31m-Entry.prototype.toURI = function(mimeType) {[m
[32m+[m[32mEntry.prototype.toURI = function (mimeType) {[m
     console.log("DEPRECATED: Update your code to use 'toURL'");[m
     return this.toURL();[m
 };[m
[36m@@ -231,12 +229,12 @@[m [mEntry.prototype.toURI = function(mimeType) {[m
  * @param successCallback {Function} called with no parameters[m
  * @param errorCallback {Function} called with a FileError[m
  */[m
[31m-Entry.prototype.remove = function(successCallback, errorCallback) {[m
[32m+[m[32mEntry.prototype.remove = function (successCallback, errorCallback) {[m
     argscheck.checkArgs('FF', 'Entry.remove', arguments);[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(successCallback, fail, "File", "remove", [this.toInternalURL()]);[m
[32m+[m[32m    exec(successCallback, fail, 'File', 'remove', [this.toInternalURL()]);[m
 };[m
 [m
 /**[m
[36m@@ -245,18 +243,18 @@[m [mEntry.prototype.remove = function(successCallback, errorCallback) {[m
  * @param successCallback {Function} called with the parent DirectoryEntry object[m
  * @param errorCallback {Function} called with a FileError[m
  */[m
[31m-Entry.prototype.getParent = function(successCallback, errorCallback) {[m
[32m+[m[32mEntry.prototype.getParent = function (successCallback, errorCallback) {[m
     argscheck.checkArgs('FF', 'Entry.getParent', arguments);[m
     var fs = this.filesystem;[m
[31m-    var win = successCallback && function(result) {[m
[32m+[m[32m    var win = successCallback && function (result) {[m
         var DirectoryEntry = require('./DirectoryEntry');[m
         var entry = new DirectoryEntry(result.name, result.fullPath, fs, result.nativeURL);[m
         successCallback(entry);[m
     };[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(win, fail, "File", "getParent", [this.toInternalURL()]);[m
[32m+[m[32m    exec(win, fail, 'File', 'getParent', [this.toInternalURL()]);[m
 };[m
 [m
 module.exports = Entry;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/File.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/File.js[m
[1mindex 82ff7a7..30c6202 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/File.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/File.js[m
[36m@@ -28,7 +28,7 @@[m
  * size {Number} size of the file in bytes[m
  */[m
 [m
[31m-var File = function(name, localURL, type, lastModifiedDate, size){[m
[32m+[m[32mvar File = function (name, localURL, type, lastModifiedDate, size) {[m
     this.name = name || '';[m
     this.localURL = localURL || null;[m
     this.type = type || null;[m
[36m@@ -49,7 +49,7 @@[m [mvar File = function(name, localURL, type, lastModifiedDate, size){[m
  * start {Number} The index at which to start the slice (inclusive).[m
  * end {Number} The index at which to end the slice (exclusive).[m
  */[m
[31m-File.prototype.slice = function(start, end) {[m
[32m+[m[32mFile.prototype.slice = function (start, end) {[m
     var size = this.end - this.start;[m
     var newStart = 0;[m
     var newEnd = size;[m
[36m@@ -75,5 +75,4 @@[m [mFile.prototype.slice = function(start, end) {[m
     return newFile;[m
 };[m
 [m
[31m-[m
 module.exports = File;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileEntry.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileEntry.js[m
[1mindex c0b7c64..8ed230c 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileEntry.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileEntry.js[m
[36m@@ -19,12 +19,12 @@[m
  *[m
 */[m
 [m
[31m-var utils = require('cordova/utils'),[m
[31m-    exec = require('cordova/exec'),[m
[31m-    Entry = require('./Entry'),[m
[31m-    FileWriter = require('./FileWriter'),[m
[31m-    File = require('./File'),[m
[31m-    FileError = require('./FileError');[m
[32m+[m[32mvar utils = require('cordova/utils');[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar Entry = require('./Entry');[m
[32m+[m[32mvar FileWriter = require('./FileWriter');[m
[32m+[m[32mvar File = require('./File');[m
[32m+[m[32mvar FileError = require('./FileError');[m
 [m
 /**[m
  * An interface representing a file on the file system.[m
[36m@@ -35,7 +35,7 @@[m [mvar utils = require('cordova/utils'),[m
  * {DOMString} fullPath the absolute full path to the file (readonly)[m
  * {FileSystem} filesystem on which the file resides (readonly)[m
  */[m
[31m-var FileEntry = function(name, fullPath, fileSystem, nativeURL) {[m
[32m+[m[32mvar FileEntry = function (name, fullPath, fileSystem, nativeURL) {[m
     // remove trailing slash if it is present[m
     if (fullPath && /\/$/.test(fullPath)) {[m
         fullPath = fullPath.substring(0, fullPath.length - 1);[m
[36m@@ -55,11 +55,11 @@[m [mutils.extend(FileEntry, Entry);[m
  * @param {Function} successCallback is called with the new FileWriter[m
  * @param {Function} errorCallback is called with a FileError[m
  */[m
[31m-FileEntry.prototype.createWriter = function(successCallback, errorCallback) {[m
[31m-    this.file(function(filePointer) {[m
[32m+[m[32mFileEntry.prototype.createWriter = function (successCallback, errorCallback) {[m
[32m+[m[32m    this.file(function (filePointer) {[m
         var writer = new FileWriter(filePointer);[m
 [m
[31m-        if (writer.localURL === null || writer.localURL === "") {[m
[32m+[m[32m        if (writer.localURL === null || writer.localURL === '') {[m
             if (errorCallback) {[m
                 errorCallback(new FileError(FileError.INVALID_STATE_ERR));[m
             }[m
[36m@@ -77,17 +77,16 @@[m [mFileEntry.prototype.createWriter = function(successCallback, errorCallback) {[m
  * @param {Function} successCallback is called with the new File object[m
  * @param {Function} errorCallback is called with a FileError[m
  */[m
[31m-FileEntry.prototype.file = function(successCallback, errorCallback) {[m
[32m+[m[32mFileEntry.prototype.file = function (successCallback, errorCallback) {[m
     var localURL = this.toInternalURL();[m
[31m-    var win = successCallback && function(f) {[m
[32m+[m[32m    var win = successCallback && function (f) {[m
         var file = new File(f.name, localURL, f.type, f.lastModifiedDate, f.size);[m
         successCallback(file);[m
     };[m
[31m-    var fail = errorCallback && function(code) {[m
[32m+[m[32m    var fail = errorCallback && function (code) {[m
         errorCallback(new FileError(code));[m
     };[m
[31m-    exec(win, fail, "File", "getFileMetadata", [localURL]);[m
[32m+[m[32m    exec(win, fail, 'File', 'getFileMetadata', [localURL]);[m
 };[m
 [m
[31m-[m
 module.exports = FileEntry;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileError.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileError.js[m
[1mindex 6507921..16bdf31 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileError.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileError.js[m
[36m@@ -22,8 +22,8 @@[m
 /**[m
  * FileError[m
  */[m
[31m-function FileError(error) {[m
[31m-  this.code = error || null;[m
[32m+[m[32mfunction FileError (error) {[m
[32m+[m[32m    this.code = error || null;[m
 }[m
 [m
 // File error codes[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileReader.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileReader.js[m
[1mindex 8d2f086..9115f5f 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileReader.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileReader.js[m
[36m@@ -19,12 +19,12 @@[m
  *[m
 */[m
 [m
[31m-var exec = require('cordova/exec'),[m
[31m-    modulemapper = require('cordova/modulemapper'),[m
[31m-    utils = require('cordova/utils'),[m
[31m-    FileError = require('./FileError'),[m
[31m-    ProgressEvent = require('./ProgressEvent'),[m
[31m-    origFileReader = modulemapper.getOriginalSymbol(window, 'FileReader');[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar modulemapper = require('cordova/modulemapper');[m
[32m+[m[32mvar utils = require('cordova/utils');[m
[32m+[m[32mvar FileError = require('./FileError');[m
[32m+[m[32mvar ProgressEvent = require('./ProgressEvent');[m
[32m+[m[32mvar origFileReader = modulemapper.getOriginalSymbol(window, 'FileReader');[m
 [m
 /**[m
  * This class reads the mobile device file system.[m
[36m@@ -34,13 +34,13 @@[m [mvar exec = require('cordova/exec'),[m
  *      To read from the SD card, the file name is "sdcard/my_file.txt"[m
  * @constructor[m
  */[m
[31m-var FileReader = function() {[m
[32m+[m[32mvar FileReader = function () {[m
     this._readyState = 0;[m
     this._error = null;[m
     this._result = null;[m
     this._progress = null;[m
     this._localURL = '';[m
[31m-    this._realReader = origFileReader ? new origFileReader() : {};[m
[32m+[m[32m    this._realReader = origFileReader ? new origFileReader() : {}; // eslint-disable-line new-cap[m
 };[m
 [m
 /**[m
[36m@@ -49,29 +49,29 @@[m [mvar FileReader = function() {[m
  * (Note attempts to allocate more than a few MB of contiguous memory on the native side are likely to cause[m
  * OOM exceptions, while the JS engine seems to have fewer problems managing large strings or ArrayBuffers.)[m
  */[m
[31m-FileReader.READ_CHUNK_SIZE = 256*1024;[m
[32m+[m[32mFileReader.READ_CHUNK_SIZE = 256 * 1024;[m
 [m
 // States[m
 FileReader.EMPTY = 0;[m
 FileReader.LOADING = 1;[m
 FileReader.DONE = 2;[m
 [m
[31m-utils.defineGetter(FileReader.prototype, 'readyState', function() {[m
[32m+[m[32mutils.defineGetter(FileReader.prototype, 'readyState', function () {[m
     return this._localURL ? this._readyState : this._realReader.readyState;[m
 });[m
 [m
[31m-utils.defineGetter(FileReader.prototype, 'error', function() {[m
[31m-    return this._localURL ? this._error: this._realReader.error;[m
[32m+[m[32mutils.defineGetter(FileReader.prototype, 'error', function () {[m
[32m+[m[32m    return this._localURL ? this._error : this._realReader.error;[m
 });[m
 [m
[31m-utils.defineGetter(FileReader.prototype, 'result', function() {[m
[31m-    return this._localURL ? this._result: this._realReader.result;[m
[32m+[m[32mutils.defineGetter(FileReader.prototype, 'result', function () {[m
[32m+[m[32m    return this._localURL ? this._result : this._realReader.result;[m
 });[m
 [m
[31m-function defineEvent(eventName) {[m
[31m-    utils.defineGetterSetter(FileReader.prototype, eventName, function() {[m
[32m+[m[32mfunction defineEvent (eventName) {[m
[32m+[m[32m    utils.defineGetterSetter(FileReader.prototype, eventName, function () {[m
         return this._realReader[eventName] || null;[m
[31m-    }, function(value) {[m
[32m+[m[32m    }, function (value) {[m
         this._realReader[eventName] = value;[m
     });[m
 }[m
[36m@@ -82,10 +82,10 @@[m [mdefineEvent('onerror');        // When the read has failed (see errors).[m
 defineEvent('onloadend');      // When the request has completed (either in success or failure).[m
 defineEvent('onabort');        // When the read has been aborted. For instance, by invoking the abort() method.[m
 [m
[31m-function initRead(reader, file) {[m
[32m+[m[32mfunction initRead (reader, file) {[m
     // Already loading something[m
[31m-    if (reader.readyState == FileReader.LOADING) {[m
[31m-      throw new FileError(FileError.INVALID_STATE_ERR);[m
[32m+[m[32m    if (reader.readyState === FileReader.LOADING) {[m
[32m+[m[32m        throw new FileError(FileError.INVALID_STATE_ERR);[m
     }[m
 [m
     reader._result = null;[m
[36m@@ -93,7 +93,7 @@[m [mfunction initRead(reader, file) {[m
     reader._progress = 0;[m
     reader._readyState = FileReader.LOADING;[m
 [m
[31m-    if (typeof file.localURL == 'string') {[m
[32m+[m[32m    if (typeof file.localURL === 'string') {[m
         reader._localURL = file.localURL;[m
     } else {[m
         reader._localURL = '';[m
[36m@@ -101,7 +101,7 @@[m [mfunction initRead(reader, file) {[m
     }[m
 [m
     if (reader.onloadstart) {[m
[31m-        reader.onloadstart(new ProgressEvent("loadstart", {target:reader}));[m
[32m+[m[32m        reader.onloadstart(new ProgressEvent('loadstart', {target: reader}));[m
     }[m
 }[m
 [m
[36m@@ -116,7 +116,7 @@[m [mfunction initRead(reader, file) {[m
  * @param accumulate A function that takes the callback result and accumulates it in this._result.[m
  * @param r Callback result returned by the last read exec() call, or null to begin reading.[m
  */[m
[31m-function readSuccessCallback(readType, encoding, offset, totalSize, accumulate, r) {[m
[32m+[m[32mfunction readSuccessCallback (readType, encoding, offset, totalSize, accumulate, r) {[m
     if (this._readyState === FileReader.DONE) {[m
         return;[m
     }[m
[36m@@ -125,22 +125,22 @@[m [mfunction readSuccessCallback(readType, encoding, offset, totalSize, accumulate,[m
     if (readType === 'readAsDataURL') {[m
         // Windows proxy does not support reading file slices as Data URLs[m
         // so read the whole file at once.[m
[31m-        CHUNK_SIZE = cordova.platformId === 'windows' ? totalSize :[m
[32m+[m[32m        CHUNK_SIZE = cordova.platformId === 'windows' ? totalSize : // eslint-disable-line no-undef[m
             // Calculate new chunk size for data URLs to be multiply of 3[m
             // Otherwise concatenated base64 chunks won't be valid base64 data[m
             FileReader.READ_CHUNK_SIZE - (FileReader.READ_CHUNK_SIZE % 3) + 3;[m
     }[m
 [m
[31m-    if (typeof r !== "undefined") {[m
[32m+[m[32m    if (typeof r !== 'undefined') {[m
         accumulate(r);[m
         this._progress = Math.min(this._progress + CHUNK_SIZE, totalSize);[m
 [m
[31m-        if (typeof this.onprogress === "function") {[m
[31m-            this.onprogress(new ProgressEvent("progress", {loaded:this._progress, total:totalSize}));[m
[32m+[m[32m        if (typeof this.onprogress === 'function') {[m
[32m+[m[32m            this.onprogress(new ProgressEvent('progress', {loaded: this._progress, total: totalSize}));[m
         }[m
     }[m
 [m
[31m-    if (typeof r === "undefined" || this._progress < totalSize) {[m
[32m+[m[32m    if (typeof r === 'undefined' || this._progress < totalSize) {[m
         var execArgs = [[m
             this._localURL,[m
             offset + this._progress,[m
[36m@@ -151,16 +151,16 @@[m [mfunction readSuccessCallback(readType, encoding, offset, totalSize, accumulate,[m
         exec([m
             readSuccessCallback.bind(this, readType, encoding, offset, totalSize, accumulate),[m
             readFailureCallback.bind(this),[m
[31m-            "File", readType, execArgs);[m
[32m+[m[32m            'File', readType, execArgs);[m
     } else {[m
         this._readyState = FileReader.DONE;[m
 [m
[31m-        if (typeof this.onload === "function") {[m
[31m-            this.onload(new ProgressEvent("load", {target:this}));[m
[32m+[m[32m        if (typeof this.onload === 'function') {[m
[32m+[m[32m            this.onload(new ProgressEvent('load', {target: this}));[m
         }[m
 [m
[31m-        if (typeof this.onloadend === "function") {[m
[31m-            this.onloadend(new ProgressEvent("loadend", {target:this}));[m
[32m+[m[32m        if (typeof this.onloadend === 'function') {[m
[32m+[m[32m            this.onloadend(new ProgressEvent('loadend', {target: this}));[m
         }[m
     }[m
 }[m
[36m@@ -169,7 +169,7 @@[m [mfunction readSuccessCallback(readType, encoding, offset, totalSize, accumulate,[m
  * Callback used by the following read* functions to handle errors.[m
  * Must be bound to the FileReader's this, e.g. readFailureCallback.bind(this)[m
  */[m
[31m-function readFailureCallback(e) {[m
[32m+[m[32mfunction readFailureCallback (e) {[m
     if (this._readyState === FileReader.DONE) {[m
         return;[m
     }[m
[36m@@ -178,37 +178,37 @@[m [mfunction readFailureCallback(e) {[m
     this._result = null;[m
     this._error = new FileError(e);[m
 [m
[31m-    if (typeof this.onerror === "function") {[m
[31m-        this.onerror(new ProgressEvent("error", {target:this}));[m
[32m+[m[32m    if (typeof this.onerror === 'function') {[m
[32m+[m[32m        this.onerror(new ProgressEvent('error', {target: this}));[m
     }[m
 [m
[31m-    if (typeof this.onloadend === "function") {[m
[31m-        this.onloadend(new ProgressEvent("loadend", {target:this}));[m
[32m+[m[32m    if (typeof this.onloadend === 'function') {[m
[32m+[m[32m        this.onloadend(new ProgressEvent('loadend', {target: this}));[m
     }[m
 }[m
 [m
 /**[m
  * Abort reading file.[m
  */[m
[31m-FileReader.prototype.abort = function() {[m
[32m+[m[32mFileReader.prototype.abort = function () {[m
     if (origFileReader && !this._localURL) {[m
         return this._realReader.abort();[m
     }[m
     this._result = null;[m
 [m
[31m-    if (this._readyState == FileReader.DONE || this._readyState == FileReader.EMPTY) {[m
[31m-      return;[m
[32m+[m[32m    if (this._readyState === FileReader.DONE || this._readyState === FileReader.EMPTY) {[m
[32m+[m[32m        return;[m
     }[m
 [m
     this._readyState = FileReader.DONE;[m
 [m
     // If abort callback[m
     if (typeof this.onabort === 'function') {[m
[31m-        this.onabort(new ProgressEvent('abort', {target:this}));[m
[32m+[m[32m        this.onabort(new ProgressEvent('abort', {target: this}));[m
     }[m
     // If load end callback[m
     if (typeof this.onloadend === 'function') {[m
[31m-        this.onloadend(new ProgressEvent('loadend', {target:this}));[m
[32m+[m[32m        this.onloadend(new ProgressEvent('loadend', {target: this}));[m
     }[m
 };[m
 [m
[36m@@ -218,24 +218,23 @@[m [mFileReader.prototype.abort = function() {[m
  * @param file          {File} File object containing file properties[m
  * @param encoding      [Optional] (see http://www.iana.org/assignments/character-sets)[m
  */[m
[31m-FileReader.prototype.readAsText = function(file, encoding) {[m
[32m+[m[32mFileReader.prototype.readAsText = function (file, encoding) {[m
     if (initRead(this, file)) {[m
         return this._realReader.readAsText(file, encoding);[m
     }[m
 [m
     // Default encoding is UTF-8[m
[31m-    var enc = encoding ? encoding : "UTF-8";[m
[32m+[m[32m    var enc = encoding || 'UTF-8';[m
 [m
     var totalSize = file.end - file.start;[m
[31m-    readSuccessCallback.bind(this)("readAsText", enc, file.start, totalSize, function(r) {[m
[32m+[m[32m    readSuccessCallback.bind(this)('readAsText', enc, file.start, totalSize, function (r) {[m
         if (this._progress === 0) {[m
[31m-            this._result = "";[m
[32m+[m[32m            this._result = '';[m
         }[m
         this._result += r;[m
     }.bind(this));[m
 };[m
 [m
[31m-[m
 /**[m
  * Read file and return data as a base64 encoded data url.[m
  * A data url is of the form:[m
[36m@@ -243,13 +242,13 @@[m [mFileReader.prototype.readAsText = function(file, encoding) {[m
  *[m
  * @param file          {File} File object containing file properties[m
  */[m
[31m-FileReader.prototype.readAsDataURL = function(file) {[m
[32m+[m[32mFileReader.prototype.readAsDataURL = function (file) {[m
     if (initRead(this, file)) {[m
         return this._realReader.readAsDataURL(file);[m
     }[m
 [m
     var totalSize = file.end - file.start;[m
[31m-    readSuccessCallback.bind(this)("readAsDataURL", null, file.start, totalSize, function(r) {[m
[32m+[m[32m    readSuccessCallback.bind(this)('readAsDataURL', null, file.start, totalSize, function (r) {[m
         var commaIndex = r.indexOf(',');[m
         if (this._progress === 0) {[m
             this._result = r;[m
[36m@@ -264,15 +263,15 @@[m [mFileReader.prototype.readAsDataURL = function(file) {[m
  *[m
  * @param file          {File} File object containing file properties[m
  */[m
[31m-FileReader.prototype.readAsBinaryString = function(file) {[m
[32m+[m[32mFileReader.prototype.readAsBinaryString = function (file) {[m
     if (initRead(this, file)) {[m
         return this._realReader.readAsBinaryString(file);[m
     }[m
 [m
     var totalSize = file.end - file.start;[m
[31m-    readSuccessCallback.bind(this)("readAsBinaryString", null, file.start, totalSize, function(r) {[m
[32m+[m[32m    readSuccessCallback.bind(this)('readAsBinaryString', null, file.start, totalSize, function (r) {[m
         if (this._progress === 0) {[m
[31m-            this._result = "";[m
[32m+[m[32m            this._result = '';[m
         }[m
         this._result += r;[m
     }.bind(this));[m
[36m@@ -283,13 +282,13 @@[m [mFileReader.prototype.readAsBinaryString = function(file) {[m
  *[m
  * @param file          {File} File object containing file properties[m
  */[m
[31m-FileReader.prototype.readAsArrayBuffer = function(file) {[m
[32m+[m[32mFileReader.prototype.readAsArrayBuffer = function (file) {[m
     if (initRead(this, file)) {[m
         return this._realReader.readAsArrayBuffer(file);[m
     }[m
 [m
     var totalSize = file.end - file.start;[m
[31m-    readSuccessCallback.bind(this)("readAsArrayBuffer", null, file.start, totalSize, function(r) {[m
[32m+[m[32m    readSuccessCallback.bind(this)('readAsArrayBuffer', null, file.start, totalSize, function (r) {[m
         var resultArray = (this._progress === 0 ? new Uint8Array(totalSize) : new Uint8Array(this._result));[m
         resultArray.set(new Uint8Array(r), this._progress);[m
         this._result = resultArray.buffer;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileSystem.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileSystem.js[m
[1mindex 82f9175..f90c458 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileSystem.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileSystem.js[m
[36m@@ -28,7 +28,7 @@[m [mvar DirectoryEntry = require('./DirectoryEntry');[m
  * {DOMString} name the unique name of the file system (readonly)[m
  * {DirectoryEntry} root directory of the file system (readonly)[m
  */[m
[31m-var FileSystem = function(name, root) {[m
[32m+[m[32mvar FileSystem = function (name, root) {[m
     this.name = name;[m
     if (root) {[m
         this.root = new DirectoryEntry(root.name, root.fullPath, this, root.nativeURL);[m
[36m@@ -37,16 +37,16 @@[m [mvar FileSystem = function(name, root) {[m
     }[m
 };[m
 [m
[31m-FileSystem.prototype.__format__ = function(fullPath, nativeUrl) {[m
[32m+[m[32mFileSystem.prototype.__format__ = function (fullPath, nativeUrl) {[m
     return fullPath;[m
 };[m
 [m
[31m-FileSystem.prototype.toJSON = function() {[m
[31m-    return "<FileSystem: " + this.name + ">";[m
[32m+[m[32mFileSystem.prototype.toJSON = function () {[m
[32m+[m[32m    return '<FileSystem: ' + this.name + '>';[m
 };[m
 [m
 // Use instead of encodeURI() when encoding just the path part of a URI rather than an entire URI.[m
[31m-FileSystem.encodeURIPath = function(path) {[m
[32m+[m[32mFileSystem.encodeURIPath = function (path) {[m
     // Because # is a valid filename character, it must be encoded to prevent part of the[m
     // path from being parsed as a URI fragment.[m
     return encodeURI(path).replace(/#/g, '%23');[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileUploadOptions.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileUploadOptions.js[m
[1mindex b2977de..b4aa7c7 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileUploadOptions.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileUploadOptions.js[m
[36m@@ -29,7 +29,7 @@[m
  * @param headers {Object}   Keys are header names, values are header values. Multiple[m
  *                           headers of the same name are not supported.[m
  */[m
[31m-var FileUploadOptions = function(fileKey, fileName, mimeType, params, headers, httpMethod) {[m
[32m+[m[32mvar FileUploadOptions = function (fileKey, fileName, mimeType, params, headers, httpMethod) {[m
     this.fileKey = fileKey || null;[m
     this.fileName = fileName || null;[m
     this.mimeType = mimeType || null;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileUploadResult.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileUploadResult.js[m
[1mindex 4f2e33e..6c7105c 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileUploadResult.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileUploadResult.js[m
[36m@@ -23,8 +23,8 @@[m
  * FileUploadResult[m
  * @constructor[m
  */[m
[31m-module.exports = function FileUploadResult(size, code, content) {[m
[31m-	this.bytesSent = size;[m
[31m-	this.responseCode = code;[m
[31m-	this.response = content;[m
[31m- };[m
\ No newline at end of file[m
[32m+[m[32mmodule.exports = function FileUploadResult (size, code, content) {[m
[32m+[m[32m    this.bytesSent = size;[m
[32m+[m[32m    this.responseCode = code;[m
[32m+[m[32m    this.response = content;[m
[32m+[m[32m};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileWriter.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileWriter.js[m
[1mindex a3c686f..c6de375 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileWriter.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/FileWriter.js[m
[36m@@ -1,4 +1,4 @@[m
[31m-﻿/*[m
[32m+[m[32m/*[m
  *[m
  * Licensed to the Apache Software Foundation (ASF) under one[m
  * or more contributor license agreements.  See the NOTICE file[m
[36m@@ -19,9 +19,9 @@[m
  *[m
 */[m
 [m
[31m-var exec = require('cordova/exec'),[m
[31m-    FileError = require('./FileError'),[m
[31m-    ProgressEvent = require('./ProgressEvent');[m
[32m+[m[32mvar exec = require('cordova/exec');[m
[32m+[m[32mvar FileError = require('./FileError');[m
[32m+[m[32mvar ProgressEvent = require('./ProgressEvent');[m
 [m
 /**[m
  * This class writes to the mobile device file system.[m
[36m@@ -34,8 +34,8 @@[m [mvar exec = require('cordova/exec'),[m
  * @param file {File} File object containing file properties[m
  * @param append if true write to the end of the file, otherwise overwrite the file[m
  */[m
[31m-var FileWriter = function(file) {[m
[31m-    this.fileName = "";[m
[32m+[m[32mvar FileWriter = function (file) {[m
[32m+[m[32m    this.fileName = '';[m
     this.length = 0;[m
     if (file) {[m
         this.localURL = file.localURL || file;[m
[36m@@ -68,7 +68,7 @@[m [mFileWriter.DONE = 2;[m
 /**[m
  * Abort writing file.[m
  */[m
[31m-FileWriter.prototype.abort = function() {[m
[32m+[m[32mFileWriter.prototype.abort = function () {[m
     // check for invalid state[m
     if (this.readyState === FileWriter.DONE || this.readyState === FileWriter.INIT) {[m
         throw new FileError(FileError.INVALID_STATE_ERR);[m
[36m@@ -80,13 +80,13 @@[m [mFileWriter.prototype.abort = function() {[m
     this.readyState = FileWriter.DONE;[m
 [m
     // If abort callback[m
[31m-    if (typeof this.onabort === "function") {[m
[31m-        this.onabort(new ProgressEvent("abort", {"target":this}));[m
[32m+[m[32m    if (typeof this.onabort === 'function') {[m
[32m+[m[32m        this.onabort(new ProgressEvent('abort', {'target': this}));[m
     }[m
 [m
     // If write end callback[m
[31m-    if (typeof this.onwriteend === "function") {[m
[31m-        this.onwriteend(new ProgressEvent("writeend", {"target":this}));[m
[32m+[m[32m    if (typeof this.onwriteend === 'function') {[m
[32m+[m[32m        this.onwriteend(new ProgressEvent('writeend', {'target': this}));[m
     }[m
 };[m
 [m
[36m@@ -96,17 +96,19 @@[m [mFileWriter.prototype.abort = function() {[m
  * @param data text or blob to be written[m
  * @param isPendingBlobReadResult {Boolean} true if the data is the pending blob read operation result[m
  */[m
[31m-FileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
[32m+[m[32mFileWriter.prototype.write = function (data, isPendingBlobReadResult) {[m
 [m
[31m-    var that=this;[m
[32m+[m[32m    var that = this;[m
     var supportsBinary = (typeof window.Blob !== 'undefined' && typeof window.ArrayBuffer !== 'undefined');[m
[31m-    var isProxySupportBlobNatively = (cordova.platformId === "windows8" || cordova.platformId === "windows");[m
[32m+[m[32m    /* eslint-disable no-undef */[m
[32m+[m[32m    var isProxySupportBlobNatively = (cordova.platformId === 'windows8' || cordova.platformId === 'windows');[m
     var isBinary;[m
 [m
     // Check to see if the incoming data is a blob[m
     if (data instanceof File || (!isProxySupportBlobNatively && supportsBinary && data instanceof Blob)) {[m
         var fileReader = new FileReader();[m
[31m-        fileReader.onload = function() {[m
[32m+[m[32m        /* eslint-enable no-undef */[m
[32m+[m[32m        fileReader.onload = function () {[m
             // Call this method again, with the arraybuffer as argument[m
             FileWriter.prototype.write.call(that, this.result, true /* isPendingBlobReadResult */);[m
         };[m
[36m@@ -118,13 +120,13 @@[m [mFileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
             that.error = this.error;[m
 [m
             // If onerror callback[m
[31m-            if (typeof that.onerror === "function") {[m
[31m-                that.onerror(new ProgressEvent("error", {"target":that}));[m
[32m+[m[32m            if (typeof that.onerror === 'function') {[m
[32m+[m[32m                that.onerror(new ProgressEvent('error', {'target': that}));[m
             }[m
 [m
             // If onwriteend callback[m
[31m-            if (typeof that.onwriteend === "function") {[m
[31m-                that.onwriteend(new ProgressEvent("writeend", {"target":that}));[m
[32m+[m[32m            if (typeof that.onwriteend === 'function') {[m
[32m+[m[32m                that.onwriteend(new ProgressEvent('writeend', {'target': that}));[m
             }[m
         };[m
 [m
[36m@@ -141,11 +143,11 @@[m [mFileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
 [m
     // Mark data type for safer transport over the binary bridge[m
     isBinary = supportsBinary && (data instanceof ArrayBuffer);[m
[31m-    if (isBinary && cordova.platformId === "windowsphone") {[m
[32m+[m[32m    if (isBinary && cordova.platformId === 'windowsphone') { // eslint-disable-line no-undef[m
         // create a plain array, using the keys from the Uint8Array view so that we can serialize it[m
         data = Array.apply(null, new Uint8Array(data));[m
     }[m
[31m-    [m
[32m+[m
     // Throw an exception if we are already writing a file[m
     if (this.readyState === FileWriter.WRITING && !isPendingBlobReadResult) {[m
         throw new FileError(FileError.INVALID_STATE_ERR);[m
[36m@@ -157,14 +159,14 @@[m [mFileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
     var me = this;[m
 [m
     // If onwritestart callback[m
[31m-    if (typeof me.onwritestart === "function") {[m
[31m-        me.onwritestart(new ProgressEvent("writestart", {"target":me}));[m
[32m+[m[32m    if (typeof me.onwritestart === 'function') {[m
[32m+[m[32m        me.onwritestart(new ProgressEvent('writestart', {'target': me}));[m
     }[m
 [m
     // Write file[m
     exec([m
         // Success callback[m
[31m-        function(r) {[m
[32m+[m[32m        function (r) {[m
             // If DONE (cancelled), then don't do anything[m
             if (me.readyState === FileWriter.DONE) {[m
                 return;[m
[36m@@ -180,17 +182,17 @@[m [mFileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
             me.readyState = FileWriter.DONE;[m
 [m
             // If onwrite callback[m
[31m-            if (typeof me.onwrite === "function") {[m
[31m-                me.onwrite(new ProgressEvent("write", {"target":me}));[m
[32m+[m[32m            if (typeof me.onwrite === 'function') {[m
[32m+[m[32m                me.onwrite(new ProgressEvent('write', {'target': me}));[m
             }[m
 [m
             // If onwriteend callback[m
[31m-            if (typeof me.onwriteend === "function") {[m
[31m-                me.onwriteend(new ProgressEvent("writeend", {"target":me}));[m
[32m+[m[32m            if (typeof me.onwriteend === 'function') {[m
[32m+[m[32m                me.onwriteend(new ProgressEvent('writeend', {'target': me}));[m
             }[m
         },[m
         // Error callback[m
[31m-        function(e) {[m
[32m+[m[32m        function (e) {[m
             // If DONE (cancelled), then don't do anything[m
             if (me.readyState === FileWriter.DONE) {[m
                 return;[m
[36m@@ -203,15 +205,15 @@[m [mFileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
             me.error = new FileError(e);[m
 [m
             // If onerror callback[m
[31m-            if (typeof me.onerror === "function") {[m
[31m-                me.onerror(new ProgressEvent("error", {"target":me}));[m
[32m+[m[32m            if (typeof me.onerror === 'function') {[m
[32m+[m[32m                me.onerror(new ProgressEvent('error', {'target': me}));[m
             }[m
 [m
             // If onwriteend callback[m
[31m-            if (typeof me.onwriteend === "function") {[m
[31m-                me.onwriteend(new ProgressEvent("writeend", {"target":me}));[m
[32m+[m[32m            if (typeof me.onwriteend === 'function') {[m
[32m+[m[32m                me.onwriteend(new ProgressEvent('writeend', {'target': me}));[m
             }[m
[31m-        }, "File", "write", [this.localURL, data, this.position, isBinary]);[m
[32m+[m[32m        }, 'File', 'write', [this.localURL, data, this.position, isBinary]);[m
 };[m
 [m
 /**[m
[36m@@ -223,7 +225,7 @@[m [mFileWriter.prototype.write = function(data, isPendingBlobReadResult) {[m
  *[m
  * @param offset is the location to move the file pointer to.[m
  */[m
[31m-FileWriter.prototype.seek = function(offset) {[m
[32m+[m[32mFileWriter.prototype.seek = function (offset) {[m
     // Throw an exception if we are already writing a file[m
     if (this.readyState === FileWriter.WRITING) {[m
         throw new FileError(FileError.INVALID_STATE_ERR);[m
[36m@@ -236,15 +238,13 @@[m [mFileWriter.prototype.seek = function(offset) {[m
     // See back from end of file.[m
     if (offset < 0) {[m
         this.position = Math.max(offset + this.length, 0);[m
[31m-    }[m
     // Offset is bigger than file size so set position[m
     // to the end of the file.[m
[31m-    else if (offset > this.length) {[m
[32m+[m[32m    } else if (offset > this.length) {[m
         this.position = this.length;[m
[31m-    }[m
     // Offset is between 0 and file size so set the position[m
     // to start writing.[m
[31m-    else {[m
[32m+[m[32m    } else {[m
         this.position = offset;[m
     }[m
 };[m
[36m@@ -254,7 +254,7 @@[m [mFileWriter.prototype.seek = function(offset) {[m
  *[m
  * @param size to chop the file at.[m
  */[m
[31m-FileWriter.prototype.truncate = function(size) {[m
[32m+[m[32mFileWriter.prototype.truncate = function (size) {[m
     // Throw an exception if we are already writing a file[m
     if (this.readyState === FileWriter.WRITING) {[m
         throw new FileError(FileError.INVALID_STATE_ERR);[m
[36m@@ -266,14 +266,14 @@[m [mFileWriter.prototype.truncate = function(size) {[m
     var me = this;[m
 [m
     // If onwritestart callback[m
[31m-    if (typeof me.onwritestart === "function") {[m
[31m-        me.onwritestart(new ProgressEvent("writestart", {"target":this}));[m
[32m+[m[32m    if (typeof me.onwritestart === 'function') {[m
[32m+[m[32m        me.onwritestart(new ProgressEvent('writestart', {'target': this}));[m
     }[m
 [m
     // Write file[m
     exec([m
         // Success callback[m
[31m-        function(r) {[m
[32m+[m[32m        function (r) {[m
             // If DONE (cancelled), then don't do anything[m
             if (me.readyState === FileWriter.DONE) {[m
                 return;[m
[36m@@ -287,17 +287,17 @@[m [mFileWriter.prototype.truncate = function(size) {[m
             me.position = Math.min(me.position, r);[m
 [m
             // If onwrite callback[m
[31m-            if (typeof me.onwrite === "function") {[m
[31m-                me.onwrite(new ProgressEvent("write", {"target":me}));[m
[32m+[m[32m            if (typeof me.onwrite === 'function') {[m
[32m+[m[32m                me.onwrite(new ProgressEvent('write', {'target': me}));[m
             }[m
 [m
             // If onwriteend callback[m
[31m-            if (typeof me.onwriteend === "function") {[m
[31m-                me.onwriteend(new ProgressEvent("writeend", {"target":me}));[m
[32m+[m[32m            if (typeof me.onwriteend === 'function') {[m
[32m+[m[32m                me.onwriteend(new ProgressEvent('writeend', {'target': me}));[m
             }[m
         },[m
         // Error callback[m
[31m-        function(e) {[m
[32m+[m[32m        function (e) {[m
             // If DONE (cancelled), then don't do anything[m
             if (me.readyState === FileWriter.DONE) {[m
                 return;[m
[36m@@ -310,15 +310,15 @@[m [mFileWriter.prototype.truncate = function(size) {[m
             me.error = new FileError(e);[m
 [m
             // If onerror callback[m
[31m-            if (typeof me.onerror === "function") {[m
[31m-                me.onerror(new ProgressEvent("error", {"target":me}));[m
[32m+[m[32m            if (typeof me.onerror === 'function') {[m
[32m+[m[32m                me.onerror(new ProgressEvent('error', {'target': me}));[m
             }[m
 [m
             // If onwriteend callback[m
[31m-            if (typeof me.onwriteend === "function") {[m
[31m-                me.onwriteend(new ProgressEvent("writeend", {"target":me}));[m
[32m+[m[32m            if (typeof me.onwriteend === 'function') {[m
[32m+[m[32m                me.onwriteend(new ProgressEvent('writeend', {'target': me}));[m
             }[m
[31m-        }, "File", "truncate", [this.localURL, size]);[m
[32m+[m[32m        }, 'File', 'truncate', [this.localURL, size]);[m
 };[m
 [m
 module.exports = FileWriter;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/Flags.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/Flags.js[m
[1mindex a9ae6da..2f15c88 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/Flags.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/Flags.js[m
[36m@@ -28,7 +28,7 @@[m
  *            {boolean} used with create; if true the command will fail if[m
  *            target path exists[m
  */[m
[31m-function Flags(create, exclusive) {[m
[32m+[m[32mfunction Flags (create, exclusive) {[m
     this.create = create || false;[m
     this.exclusive = exclusive || false;[m
 }[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/Metadata.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/Metadata.js[m
[1mindex f95c44c..713d7cb 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/Metadata.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/Metadata.js[m
[36m@@ -24,11 +24,11 @@[m
  *[m
  * {Date} modificationTime (readonly)[m
  */[m
[31m-var Metadata = function(metadata) {[m
[31m-    if (typeof metadata == "object") {[m
[32m+[m[32mvar Metadata = function (metadata) {[m
[32m+[m[32m    if (typeof metadata === 'object') {[m
         this.modificationTime = new Date(metadata.modificationTime);[m
         this.size = metadata.size || 0;[m
[31m-    } else if (typeof metadata == "undefined") {[m
[32m+[m[32m    } else if (typeof metadata === 'undefined') {[m
         this.modificationTime = null;[m
         this.size = 0;[m
     } else {[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/ProgressEvent.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/ProgressEvent.js[m
[1mindex f176f80..336a226 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/ProgressEvent.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/ProgressEvent.js[m
[36m@@ -25,7 +25,7 @@[m
 // otherwise fill-in with our own implementation.[m
 //[m
 // NOTE: right now we always fill in with our own. Down the road would be nice if we can use whatever is native in the webview.[m
[31m-var ProgressEvent = (function() {[m
[32m+[m[32mvar ProgressEvent = (function () {[m
     /*[m
     var createEvent = function(data) {[m
         var event = document.createEvent('Events');[m
[36m@@ -51,17 +51,17 @@[m [mvar ProgressEvent = (function() {[m
         };[m
     } catch(e){[m
     */[m
[31m-        return function ProgressEvent(type, dict) {[m
[31m-            this.type = type;[m
[31m-            this.bubbles = false;[m
[31m-            this.cancelBubble = false;[m
[31m-            this.cancelable = false;[m
[31m-            this.lengthComputable = false;[m
[31m-            this.loaded = dict && dict.loaded ? dict.loaded : 0;[m
[31m-            this.total = dict && dict.total ? dict.total : 0;[m
[31m-            this.target = dict && dict.target ? dict.target : null;[m
[31m-        };[m
[31m-    //}[m
[32m+[m[32m    return function ProgressEvent (type, dict) {[m
[32m+[m[32m        this.type = type;[m
[32m+[m[32m        this.bubbles = false;[m
[32m+[m[32m        this.cancelBubble = false;[m
[32m+[m[32m        this.cancelable = false;[m
[32m+[m[32m        this.lengthComputable = false;[m
[32m+[m[32m        this.loaded = dict && dict.loaded ? dict.loaded : 0;[m
[32m+[m[32m        this.total = dict && dict.total ? dict.total : 0;[m
[32m+[m[32m        this.target = dict && dict.target ? dict.target : null;[m
[32m+[m[32m    };[m
[32m+[m[32m    // }[m
 })();[m
 [m
 module.exports = ProgressEvent;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/android/FileSystem.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/android/FileSystem.js[m
[1mindex b16333b..438da00 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/android/FileSystem.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/android/FileSystem.js[m
[36m@@ -19,10 +19,10 @@[m
  *[m
 */[m
 [m
[31m-FILESYSTEM_PROTOCOL = "cdvfile";[m
[32m+[m[32mFILESYSTEM_PROTOCOL = 'cdvfile'; // eslint-disable-line no-undef[m
 [m
 module.exports = {[m
[31m-    __format__: function(fullPath, nativeUrl) {[m
[32m+[m[32m    __format__: function (fullPath, nativeUrl) {[m
         var path;[m
         var contentUrlMatch = /^content:\/\//.exec(nativeUrl);[m
         if (contentUrlMatch) {[m
[36m@@ -32,18 +32,17 @@[m [mmodule.exports = {[m
             // doesn't match the string for which permission was originally granted.[m
             path = nativeUrl.substring(contentUrlMatch[0].length - 1);[m
         } else {[m
[31m-            path = FileSystem.encodeURIPath(fullPath);[m
[32m+[m[32m            path = FileSystem.encodeURIPath(fullPath); // eslint-disable-line no-undef[m
             if (!/^\//.test(path)) {[m
                 path = '/' + path;[m
             }[m
[31m-            [m
[32m+[m
             var m = /\?.*/.exec(nativeUrl);[m
             if (m) {[m
                 path += m[0];[m
             }[m
         }[m
 [m
[31m-        return FILESYSTEM_PROTOCOL + '://localhost/' + this.name + path;[m
[32m+[m[32m        return FILESYSTEM_PROTOCOL + '://localhost/' + this.name + path; // eslint-disable-line no-undef[m
     }[m
 };[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/.jshintrc b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/.jshintrc[m
[1mdeleted file mode 100644[m
[1mindex 85ccb32..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/.jshintrc[m
[1m+++ /dev/null[m
[36m@@ -1,5 +0,0 @@[m
[31m-{[m
[31m-    "globals": {[m
[31m-        "requestAnimationFrame": true[m
[31m-    }[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/FileProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/FileProxy.js[m
[1mdeleted file mode 100644[m
[1mindex bd286cb..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/FileProxy.js[m
[1m+++ /dev/null[m
[36m@@ -1,51 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/*[m
[31m- * FileProxy[m
[31m- *[m
[31m- * Register all File exec calls to be handled by proxy[m
[31m- */[m
[31m-[m
[31m-module.exports = {[m
[31m-    copyTo: require('cordova-plugin-file.copyToProxy'),[m
[31m-    getDirectory: require('cordova-plugin-file.getDirectoryProxy'),[m
[31m-    getFile: require('cordova-plugin-file.getFileProxy'),[m
[31m-    getFileMetadata: require('cordova-plugin-file.getFileMetadataProxy'),[m
[31m-    getMetadata: require('cordova-plugin-file.getMetadataProxy'),[m
[31m-    getParent: require('cordova-plugin-file.getParentProxy'),[m
[31m-    moveTo: require('cordova-plugin-file.moveToProxy'),[m
[31m-    readAsArrayBuffer: require('cordova-plugin-file.readAsArrayBufferProxy'),[m
[31m-    readAsBinaryString: require('cordova-plugin-file.readAsBinaryStringProxy'),[m
[31m-    readAsDataURL: require('cordova-plugin-file.readAsDataURLProxy'),[m
[31m-    readAsText: require('cordova-plugin-file.readAsTextProxy'),[m
[31m-    readEntries: require('cordova-plugin-file.readEntriesProxy'),[m
[31m-    remove: require('cordova-plugin-file.removeProxy'),[m
[31m-    removeRecursively: require('cordova-plugin-file.removeRecursivelyProxy'),[m
[31m-    resolveLocalFileSystemURI: require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAllFileSystems: require('cordova-plugin-file.requestAllFileSystemsProxy'),[m
[31m-    requestFileSystem: require('cordova-plugin-file.requestFileSystemProxy'),[m
[31m-    setMetadata: require('cordova-plugin-file.setMetadataProxy'),[m
[31m-    truncate: require('cordova-plugin-file.truncateProxy'),[m
[31m-    write: require('cordova-plugin-file.writeProxy')[m
[31m-};[m
[31m-[m
[31m-require('cordova/exec/proxy').add('File', module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/FileSystem.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/FileSystem.js[m
[1mdeleted file mode 100644[m
[1mindex 255f904..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/FileSystem.js[m
[1m+++ /dev/null[m
[36m@@ -1,47 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/*[m
[31m- * FileSystem[m
[31m- * [m
[31m- * Translate temporary / persistent / root file paths[m
[31m- */[m
[31m-[m
[31m-var info = require("cordova-plugin-file.bb10FileSystemInfo");[m
[31m-[m
[31m-module.exports = {[m
[31m-    __format__: function(fullPath) {[m
[31m-        var path;[m
[31m-        switch (this.name) {[m
[31m-            case 'temporary':[m
[31m-                path = info.temporaryPath + FileSystem.encodeURIPath(fullPath);[m
[31m-                break;[m
[31m-            case 'persistent':[m
[31m-                path = info.persistentPath + FileSystem.encodeURIPath(fullPath);[m
[31m-                break;[m
[31m-            case 'root':[m
[31m-                path = 'file://' + FileSystem.encodeURIPath(fullPath);[m
[31m-                break;[m
[31m-        }[m
[31m-        return path;[m
[31m-    }[m
[31m-};[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/copyTo.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/copyTo.js[m
[1mdeleted file mode 100644[m
[1mindex 26f2708..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/copyTo.js[m
[1m+++ /dev/null[m
[36m@@ -1,143 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * copyTo[m
[31m- * [m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - URL of entry to copy[m
[31m- *   1 - URL of the directory into which to copy/move the entry[m
[31m- *   2 - the new name of the entry, defaults to the current name[m
[31m- *  move - if true, delete the entry which was copied[m
[31m- * OUT:[m
[31m- *  success - entry for the copied file or directory[m
[31m- *  fail - FileError[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame');[m
[31m-[m
[31m-module.exports = function (success, fail, args, move) {[m
[31m-    var uri = args[0],[m
[31m-        destination = args[1],[m
[31m-        fileName = args[2],[m
[31m-        copiedEntry;[m
[31m-[m
[31m-    function onSuccess() {[m
[31m-        resolve([m
[31m-            function (entry) {[m
[31m-                if (typeof(success) === 'function') {[m
[31m-                    success(entry);[m
[31m-                }[m
[31m-            },[m
[31m-            onFail,[m
[31m-            [destination + copiedEntry.name][m
[31m-        );[m
[31m-    }[m
[31m-    function onFail(error) {[m
[31m-        if (typeof(fail) === 'function') {[m
[31m-            if (error && error.code) {[m
[31m-                //set error codes expected by mobile spec[m
[31m-                if (uri === destination) {[m
[31m-                    fail(FileError.INVALID_MODIFICATION_ERR);[m
[31m-                } else if (error.code === FileError.SECURITY_ERR) {[m
[31m-                    fail(FileError.INVALID_MODIFICATION_ERR);[m
[31m-                } else {[m
[31m-                    fail(error.code);[m
[31m-                }[m
[31m-            } else {[m
[31m-                fail(error);[m
[31m-            }[m
[31m-        }[m
[31m-    }[m
[31m-    function writeFile(fileEntry, blob, entry) {[m
[31m-        copiedEntry = fileEntry;[m
[31m-        fileEntry.createWriter(function (fileWriter) {[m
[31m-            fileWriter.onwriteend = function () {[m
[31m-                if (move) {[m
[31m-                    entry.nativeEntry.remove(onSuccess, function () {[m
[31m-                        console.error("Move operation failed. Files may exist at both source and destination");[m
[31m-                    });[m
[31m-                } else {[m
[31m-                    onSuccess();[m
[31m-                }[m
[31m-            };[m
[31m-            fileWriter.onerror = onFail;[m
[31m-            fileWriter.write(blob);[m
[31m-        }, onFail);[m
[31m-    }[m
[31m-    function copyFile(entry) {[m
[31m-        if (entry.nativeEntry.file) {[m
[31m-            entry.nativeEntry.file(function (file) {[m
[31m-                var reader = new FileReader()._realReader;[m
[31m-                reader.onloadend = function (e) {[m
[31m-                    var contents = new Uint8Array(this.result),[m
[31m-                        blob = new Blob([contents]);[m
[31m-                    resolve(function (destEntry) {[m
[31m-                        requestAnimationFrame(function () {[m
[31m-                            destEntry.nativeEntry.getFile(fileName, {create: true}, function (fileEntry) {[m
[31m-                                writeFile(fileEntry, blob, entry);[m
[31m-                            }, onFail);[m
[31m-                        });[m
[31m-                    }, onFail, [destination]);   [m
[31m-                };[m
[31m-                reader.onerror = onFail;[m
[31m-                reader.readAsArrayBuffer(file);[m
[31m-            }, onFail);[m
[31m-        } else {[m
[31m-            onFail(FileError.INVALID_MODIFICATION_ERR);[m
[31m-        }[m
[31m-    }[m
[31m-    function copyDirectory(entry) {[m
[31m-        resolve(function (destEntry) {[m
[31m-            if (entry.filesystemName !== destEntry.filesystemName) {[m
[31m-                console.error("Copying directories between filesystems is not supported on BB10");[m
[31m-                onFail(FileError.INVALID_MODIFICATION_ERR);[m
[31m-            } else {[m
[31m-                entry.nativeEntry.copyTo(destEntry.nativeEntry, fileName, function () {[m
[31m-                    resolve(function (copiedDir) {[m
[31m-                        copiedEntry = copiedDir;[m
[31m-                        if (move) {[m
[31m-                            entry.nativeEntry.removeRecursively(onSuccess, onFail);[m
[31m-                        } else {[m
[31m-                            onSuccess();[m
[31m-                        }[m
[31m-                    }, onFail, [destination + fileName]);[m
[31m-                }, onFail);[m
[31m-            }[m
[31m-        }, onFail, [destination]); [m
[31m-    }[m
[31m-[m
[31m-    if (destination + fileName === uri) {[m
[31m-        onFail(FileError.INVALID_MODIFICATION_ERR);[m
[31m-    } else if (fileName.indexOf(':') > -1) {[m
[31m-        onFail(FileError.ENCODING_ERR);[m
[31m-    } else {[m
[31m-        resolve(function (entry) {[m
[31m-            if (entry.isDirectory) {[m
[31m-                copyDirectory(entry);[m
[31m-            } else {[m
[31m-                copyFile(entry);[m
[31m-            }[m
[31m-        }, onFail, [uri]);[m
[31m-    }[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/createEntryFromNative.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/createEntryFromNative.js[m
[1mdeleted file mode 100644[m
[1mindex 7202e3a..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/createEntryFromNative.js[m
[1m+++ /dev/null[m
[36m@@ -1,75 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/*[m
[31m- * createEntryFromNative[m
[31m- * [m
[31m- * IN[m
[31m- *  native - webkit Entry[m
[31m- * OUT[m
[31m- *  returns Cordova entry[m
[31m- */[m
[31m-[m
[31m-var info = require('cordova-plugin-file.bb10FileSystemInfo'),[m
[31m-    fileSystems = require('cordova-plugin-file.fileSystems');[m
[31m-[m
[31m-module.exports = function (native) {[m
[31m-    var entry = {[m
[31m-            nativeEntry: native,[m
[31m-            isDirectory: !!native.isDirectory,[m
[31m-            isFile: !!native.isFile,[m
[31m-            name: native.name,[m
[31m-            fullPath: native.fullPath,[m
[31m-            filesystemName: native.filesystem.name,[m
[31m-            nativeURL: native.toURL()[m
[31m-        },[m
[31m-        persistentPath = info.persistentPath.substring(7),[m
[31m-        temporaryPath = info.temporaryPath.substring(7);[m
[31m-    //fix bb10 webkit incorrect nativeURL[m
[31m-    if (native.filesystem.name === 'root') {[m
[31m-        entry.nativeURL = 'file:///' + FileSystem.encodeURIPath(native.fullPath);[m
[31m-    } else if (entry.nativeURL.indexOf('filesystem:local:///persistent/') === 0) {[m
[31m-        entry.nativeURL = info.persistentPath + FileSystem.encodeURIPath(native.fullPath);[m
[31m-    } else if (entry.nativeURL.indexOf('filesystem:local:///temporary') === 0) {[m
[31m-        entry.nativeURL = info.temporaryPath + FileSystem.encodeURIPath(native.fullPath);[m
[31m-    }[m
[31m-    //translate file system name from bb10 webkit[m
[31m-    if (entry.filesystemName === 'local__0:Persistent' || entry.fullPath.indexOf(persistentPath) !== -1) {[m
[31m-        entry.filesystemName = 'persistent';[m
[31m-    } else if (entry.filesystemName === 'local__0:Temporary' || entry.fullPath.indexOf(temporaryPath) !== -1) {[m
[31m-        entry.filesystemName = 'temporary';[m
[31m-    }[m
[31m-    //add file system property (will be called sync)[m
[31m-    fileSystems.getFs(entry.filesystemName, function (fs) {[m
[31m-        entry.filesystem = fs;[m
[31m-    });[m
[31m-    //set root on fullPath for persistent / temporary locations[m
[31m-    entry.fullPath = entry.fullPath.replace(persistentPath, "");[m
[31m-    entry.fullPath = entry.fullPath.replace(temporaryPath, "");[m
[31m-    //set trailing slash on directory[m
[31m-    if (entry.isDirectory && entry.fullPath.substring(entry.fullPath.length - 1) !== '/') {[m
[31m-        entry.fullPath += '/';[m
[31m-    }[m
[31m-    if (entry.isDirectory && entry.nativeURL.substring(entry.nativeURL.length - 1) !== '/') {[m
[31m-        entry.nativeURL += '/';[m
[31m-    }[m
[31m-    return entry;[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getDirectory.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getDirectory.js[m
[1mdeleted file mode 100644[m
[1mindex 265818c..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getDirectory.js[m
[1m+++ /dev/null[m
[36m@@ -1,72 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * getDirectory[m
[31m- * [m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - local filesytem URI for the base directory to search[m
[31m- *   1 - directory to be created/returned; may be absolute path or relative path[m
[31m- *   2 - options object[m
[31m- * OUT:[m
[31m- *  success - DirectoryEntry[m
[31m- *  fail - FileError code[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0] === "/" ? "" : args[0],[m
[31m-        dir = args[1],[m
[31m-        options = args[2],[m
[31m-        onSuccess = function (entry) {[m
[31m-            if (typeof(success) === 'function') {[m
[31m-                success(entry);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof(fail) === 'function') {[m
[31m-                if (error && error.code) {[m
[31m-                    //set error codes expected by mobile-spec tests[m
[31m-                    if (error.code === FileError.INVALID_MODIFICATION_ERR  && options.exclusive) {[m
[31m-                        fail(FileError.PATH_EXISTS_ERR);[m
[31m-                    } else if ( error.code === FileError.NOT_FOUND_ERR && dir.indexOf(':') > 0) {[m
[31m-                        fail(FileError.ENCODING_ERR);[m
[31m-                    } else {[m
[31m-                        fail(error.code);[m
[31m-                    }[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (entry) {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            entry.nativeEntry.getDirectory(dir, options, function (nativeEntry) {[m
[31m-                resolve(function (entry) {[m
[31m-                    onSuccess(entry);[m
[31m-                }, onFail, [uri + "/" + dir]);[m
[31m-            }, onFail);[m
[31m-        });[m
[31m-    }, onFail, [uri]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getFile.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getFile.js[m
[1mdeleted file mode 100644[m
[1mindex faf130d..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getFile.js[m
[1m+++ /dev/null[m
[36m@@ -1,57 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * getFile[m
[31m- *[m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - local filesytem URI for the base directory to search[m
[31m- *   1 - file to be created/returned; may be absolute path or relative path[m
[31m- *   2 - options object[m
[31m- * OUT:[m
[31m- *  success - FileEntry[m
[31m- *  fail - FileError code[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0] === "/" ? "" : args[0] + "/" + args[1],[m
[31m-        options = args[2],[m
[31m-        onSuccess = function (entry) {[m
[31m-            if (typeof(success) === 'function') {[m
[31m-                success(entry);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (code) {[m
[31m-            if (typeof(fail) === 'function') {[m
[31m-                fail(code);[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (entry) {[m
[31m-        if (!entry.isFile) {[m
[31m-            onFail(FileError.TYPE_MISMATCH_ERR);[m
[31m-        } else {[m
[31m-            onSuccess(entry);[m
[31m-        }[m
[31m-    }, onFail, [uri, options]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getFileMetadata.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getFileMetadata.js[m
[1mdeleted file mode 100644[m
[1mindex 558a665..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getFileMetadata.js[m
[1m+++ /dev/null[m
[36m@@ -1,65 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * getFileMetadata[m
[31m- *[m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - local filesytem URI[m
[31m- * OUT:[m
[31m- *  success - file[m
[31m- *   - name[m
[31m- *   - type[m
[31m- *   - lastModifiedDate[m
[31m- *   - size[m
[31m- *  fail - FileError code[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0],[m
[31m-        onSuccess = function (entry) {[m
[31m-            if (typeof(success) === 'function') {[m
[31m-                success(entry);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof(fail) === 'function') {[m
[31m-                if (error.code) {[m
[31m-                    fail(error.code);[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (entry) {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            if (entry.nativeEntry.file) {[m
[31m-                entry.nativeEntry.file(onSuccess, onFail);[m
[31m-            } else {[m
[31m-                entry.nativeEntry.getMetadata(onSuccess, onFail);[m
[31m-            }[m
[31m-        });[m
[31m-    }, onFail, [uri]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getMetadata.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getMetadata.js[m
[1mdeleted file mode 100644[m
[1mindex 649f384..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getMetadata.js[m
[1m+++ /dev/null[m
[36m@@ -1,54 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * getMetadata[m
[31m- *[m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - local filesytem URI[m
[31m- * OUT:[m
[31m- *  success - metadata[m
[31m- *  fail - FileError code[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0],[m
[31m-        onSuccess = function (entry) {[m
[31m-            if (typeof(success) === 'function') {[m
[31m-                success(entry);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof(fail) === 'function') {[m
[31m-                if (error.code) {[m
[31m-                    fail(error.code);[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (entry) {[m
[31m-        entry.nativeEntry.getMetadata(onSuccess, onFail);[m
[31m-    }, onFail, [uri]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getParent.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getParent.js[m
[1mdeleted file mode 100644[m
[1mindex 1eba0a0..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/getParent.js[m
[1m+++ /dev/null[m
[36m@@ -1,57 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * getParent[m
[31m- *[m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - local filesytem URI[m
[31m- * OUT:[m
[31m- *  success - DirectoryEntry of parent[m
[31m- *  fail - FileError code[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0],[m
[31m-        onSuccess = function (entry) {[m
[31m-            if (typeof(success) === 'function') {[m
[31m-                success(entry);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof(fail) === 'function') {[m
[31m-                if (error && error.code) {[m
[31m-                    fail(error.code);[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (entry) {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            entry.nativeEntry.getParent(onSuccess, onFail);[m
[31m-        });[m
[31m-    }, onFail, [uri]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/info.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/info.js[m
[1mdeleted file mode 100644[m
[1mindex 63f9504..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/info.js[m
[1m+++ /dev/null[m
[36m@@ -1,52 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * info[m
[31m- *[m
[31m- * persistentPath - full path to app sandboxed persistent storage[m
[31m- * temporaryPath - full path to app sandboxed temporary storage[m
[31m- * localPath - full path to app source (www dir)[m
[31m- * MAX_SIZE - maximum size for filesystem request[m
[31m- */[m
[31m-[m
[31m-var info = {[m
[31m-    persistentPath: "", [m
[31m-    temporaryPath: "", [m
[31m-    localPath: "",[m
[31m-    MAX_SIZE: 64 * 1024 * 1024 * 1024[m
[31m-};[m
[31m-[m
[31m-cordova.exec([m
[31m-    function (path) {[m
[31m-        info.persistentPath = 'file://' + path + '/webviews/webfs/persistent/local__0';[m
[31m-        info.temporaryPath = 'file://' + path + '/webviews/webfs/temporary/local__0';[m
[31m-        info.localPath = path.replace('/data', '/app/native');[m
[31m-    },[m
[31m-    function () {[m
[31m-        console.error('Unable to determine local storage file path');[m
[31m-    },[m
[31m-    'File',[m
[31m-    'getHomePath',[m
[31m-    false[m
[31m-);[m
[31m-[m
[31m-module.exports = info;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/moveTo.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/moveTo.js[m
[1mdeleted file mode 100644[m
[1mindex 0ae6810..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/moveTo.js[m
[1m+++ /dev/null[m
[36m@@ -1,39 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * moveTo[m
[31m- * [m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - URL of entry to move[m
[31m- *   1 - URL of the directory into which to move the entry[m
[31m- *   2 - the new name of the entry, defaults to the current name[m
[31m- * OUT:[m
[31m- *  success - entry for the copied file or directory[m
[31m- *  fail - FileError[m
[31m- */[m
[31m-[m
[31m-var copy = cordova.require('cordova-plugin-file.copyToProxy');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    copy(success, fail, args, true);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readAsArrayBuffer.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readAsArrayBuffer.js[m
[1mdeleted file mode 100644[m
[1mindex 0e21624..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readAsArrayBuffer.js[m
[1m+++ /dev/null[m
[36m@@ -1,68 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * readAsArrayBuffer[m
[31m- * [m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - URL of file to read[m
[31m- *   1 - start position[m
[31m- *   2 - end position[m
[31m- * OUT:[m
[31m- *  success - ArrayBuffer of file[m
[31m- *  fail - FileError[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0],[m
[31m-        start = args[1],[m
[31m-        end = args[2],[m
[31m-        onSuccess = function (data) {[m
[31m-            if (typeof success === 'function') {[m
[31m-                success(data);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof fail === 'function') {[m
[31m-                if (error && error.code) {[m
[31m-                    fail(error.code);[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (fs) {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            fs.nativeEntry.file(function (file) {[m
[31m-                var reader = new FileReader()._realReader;[m
[31m-                reader.onloadend = function () {[m
[31m-                    onSuccess(this.result.slice(start, end));[m
[31m-                };[m
[31m-                reader.onerror = onFail;[m
[31m-                reader.readAsArrayBuffer(file); [m
[31m-            }, onFail);[m
[31m-        });[m
[31m-    }, fail, [uri]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readAsBinaryString.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readAsBinaryString.js[m
[1mdeleted file mode 100644[m
[1mindex 8e40e3f..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readAsBinaryString.js[m
[1m+++ /dev/null[m
[36m@@ -1,68 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * readAsBinaryString[m
[31m- * [m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - URL of file to read[m
[31m- *   1 - start position[m
[31m- *   2 - end position[m
[31m- * OUT:[m
[31m- *  success - BinaryString contents of file[m
[31m- *  fail - FileError[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0],[m
[31m-        start = args[1],[m
[31m-        end = args[2],[m
[31m-        onSuccess = function (data) {[m
[31m-            if (typeof success === 'function') {[m
[31m-                success(data);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof fail === 'function') {[m
[31m-                if (error && error.code) {[m
[31m-                    fail(error.code);[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (fs) {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            fs.nativeEntry.file(function (file) {[m
[31m-                var reader = new FileReader()._realReader;[m
[31m-                reader.onloadend = function () {[m
[31m-                    onSuccess(this.result.substring(start, end));[m
[31m-                };[m
[31m-                reader.onerror = onFail;[m
[31m-                reader.readAsBinaryString(file); [m
[31m-            }, onFail);[m
[31m-        });[m
[31m-    }, fail, [uri]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readAsDataURL.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readAsDataURL.js[m
[1mdeleted file mode 100644[m
[1mindex 786fb63..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readAsDataURL.js[m
[1m+++ /dev/null[m
[36m@@ -1,65 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * readAsDataURL[m
[31m- * [m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - URL of file to read[m
[31m- * OUT:[m
[31m- *  success - DataURL representation of file contents[m
[31m- *  fail - FileError[m
[31m- */[m
[31m-[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0],[m
[31m-        onSuccess = function (data) {[m
[31m-            if (typeof success === 'function') {[m
[31m-                success(data);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof fail === 'function') {[m
[31m-                if (error && error.code) {[m
[31m-                    fail(error.code);[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (fs) {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            fs.nativeEntry.file(function (file) {[m
[31m-                var reader = new FileReader()._realReader;[m
[31m-                reader.onloadend = function () {[m
[31m-                    onSuccess(this.result);[m
[31m-                };[m
[31m-                reader.onerror = onFail;[m
[31m-                reader.readAsDataURL(file); [m
[31m-            }, onFail);[m
[31m-        });[m
[31m-    }, fail, [uri]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readAsText.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readAsText.js[m
[1mdeleted file mode 100644[m
[1mindex 74fa420..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readAsText.js[m
[1m+++ /dev/null[m
[36m@@ -1,77 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * readAsText[m
[31m- * [m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - URL of file to read[m
[31m- *   1 - encoding[m
[31m- *   2 - start position[m
[31m- *   3 - end position[m
[31m- * OUT:[m
[31m- *  success - text contents of file[m
[31m- *  fail - FileError[m
[31m- */[m
[31m-[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0],[m
[31m-        start = args[2],[m
[31m-        end = args[3],[m
[31m-        onSuccess = function (data) {[m
[31m-            if (typeof success === 'function') {[m
[31m-                success(data);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof fail === 'function') {[m
[31m-                if (error && error.code) {[m
[31m-                    fail(error.code);[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (fs) {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            fs.nativeEntry.file(function (file) {[m
[31m-                var reader = new FileReader()._realReader;[m
[31m-                reader.onloadend = function () {[m
[31m-                    var contents = new Uint8Array(this.result).subarray(start, end),[m
[31m-                        blob = new Blob([contents]),[m
[31m-                        textReader = new FileReader()._realReader;[m
[31m-                    textReader.onloadend = function () {[m
[31m-                        onSuccess(this.result);[m
[31m-                    };[m
[31m-                    textReader.onerror = onFail;[m
[31m-                    textReader.readAsText(blob);[m
[31m-                };[m
[31m-                reader.onerror = onFail;[m
[31m-                reader.readAsArrayBuffer(file);[m
[31m-            }, onFail);[m
[31m-        });[m
[31m-    }, fail, [uri]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readEntries.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readEntries.js[m
[1mdeleted file mode 100644[m
[1mindex 6dcb6da..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/readEntries.js[m
[1m+++ /dev/null[m
[36m@@ -1,70 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * readEntries[m
[31m- * [m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - URL of directory to list[m
[31m- * OUT:[m
[31m- *  success - Array of Entry objects[m
[31m- *  fail - FileError[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame'),[m
[31m-    createEntryFromNative = cordova.require('cordova-plugin-file.bb10CreateEntryFromNative');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0],[m
[31m-        onSuccess = function (data) {[m
[31m-            if (typeof success === 'function') {[m
[31m-                success(data);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof fail === 'function') {[m
[31m-                if (error.code) {[m
[31m-                    fail(error.code);[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (fs) {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            var reader = fs.nativeEntry.createReader(),[m
[31m-                entries = [],[m
[31m-                readEntries = function() {[m
[31m-                    reader.readEntries(function (results) {[m
[31m-                        if (!results.length) {[m
[31m-                            onSuccess(entries.sort().map(createEntryFromNative));[m
[31m-                        } else {[m
[31m-                            entries = entries.concat(Array.prototype.slice.call(results || [], 0));[m
[31m-                            readEntries();[m
[31m-                        }[m
[31m-                    }, onFail);[m
[31m-                };[m
[31m-            readEntries();[m
[31m-        });[m
[31m-    }, fail, [uri]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/remove.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/remove.js[m
[1mdeleted file mode 100644[m
[1mindex 7932da6..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/remove.js[m
[1m+++ /dev/null[m
[36m@@ -1,61 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * remove[m
[31m- * [m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - URL of Entry to remove[m
[31m- * OUT:[m
[31m- *  success - (no args)[m
[31m- *  fail - FileError[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0],[m
[31m-        onSuccess = function (data) {[m
[31m-            if (typeof success === 'function') {[m
[31m-                success(data);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof fail === 'function') {[m
[31m-                if (error && error.code) {[m
[31m-                    fail(error.code);[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (fs) {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            if (fs.fullPath === '/') {[m
[31m-                onFail(FileError.NO_MODIFICATION_ALLOWED_ERR);[m
[31m-            } else {[m
[31m-                fs.nativeEntry.remove(onSuccess, onFail);[m
[31m-            }[m
[31m-        });[m
[31m-    }, fail, [uri]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/removeRecursively.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/removeRecursively.js[m
[1mdeleted file mode 100644[m
[1mindex fe01a67..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/removeRecursively.js[m
[1m+++ /dev/null[m
[36m@@ -1,62 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * removeRecursively[m
[31m- * [m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - URL of DirectoryEntry to remove recursively[m
[31m- * OUT:[m
[31m- *  success - (no args)[m
[31m- *  fail - FileError[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0],[m
[31m-        onSuccess = function (data) {[m
[31m-            if (typeof success === 'function') {[m
[31m-                success(data);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof fail === 'function') {[m
[31m-                if (error.code) {[m
[31m-                    if (error.code === FileError.INVALID_MODIFICATION_ERR) {[m
[31m-                        //mobile-spec expects this error code[m
[31m-                        fail(FileError.NO_MODIFICATION_ALLOWED_ERR);[m
[31m-                    } else {[m
[31m-                        fail(error.code);[m
[31m-                    }[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (fs) {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            fs.nativeEntry.removeRecursively(onSuccess, onFail);[m
[31m-        }); [m
[31m-    }, fail, [uri]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/requestAllFileSystems.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/requestAllFileSystems.js[m
[1mdeleted file mode 100644[m
[1mindex d023beb..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/requestAllFileSystems.js[m
[1m+++ /dev/null[m
[36m@@ -1,42 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * requestAllFileSystems[m
[31m- * [m
[31m- * IN - no arguments[m
[31m- * OUT[m
[31m- *  success - Array of FileSystems[m
[31m- *   - filesystemName[m
[31m- *   - fullPath[m
[31m- *   - name[m
[31m- *   - nativeURL[m
[31m- */[m
[31m-[m
[31m-var info = require('cordova-plugin-file.bb10FileSystemInfo');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    success([[m
[31m-        { filesystemName: 'persistent', name: 'persistent', fullPath: '/', nativeURL: info.persistentPath + '/' },[m
[31m-        { filesystemName: 'temporary', name: 'temporary', fullPath: '/', nativeURL: info.temporaryPath + '/' },[m
[31m-        { filesystemName: 'root', name: 'root', fullPath: '/', nativeURL: 'file:///' }[m
[31m-    ]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/requestAnimationFrame.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/requestAnimationFrame.js[m
[1mdeleted file mode 100644[m
[1mindex aac0a4a..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/requestAnimationFrame.js[m
[1m+++ /dev/null[m
[36m@@ -1,38 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/*[m
[31m- * requestAnimationFrame[m
[31m- * [m
[31m- * This is used throughout the BB10 File implementation to wrap[m
[31m- * native webkit calls. There is a bug in the webkit implementation[m
[31m- * which causes callbacks to never return when multiple file system[m
[31m- * APIs are called in sequence. This should also make the UI more[m
[31m- * responsive during file operations.[m
[31m- * [m
[31m- * Supported on BB10 OS > 10.1[m
[31m- */[m
[31m-[m
[31m-var requestAnimationFrame = window.requestAnimationFrame;[m
[31m-if (typeof(requestAnimationFrame) !== 'function') {[m
[31m-    requestAnimationFrame = function (cb) { cb(); };[m
[31m-}[m
[31m-module.exports = requestAnimationFrame;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/requestFileSystem.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/requestFileSystem.js[m
[1mdeleted file mode 100644[m
[1mindex 489e510..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/requestFileSystem.js[m
[1m+++ /dev/null[m
[36m@@ -1,53 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * requestFileSystem[m
[31m- *[m
[31m- * IN:[m
[31m- *  args [m
[31m- *   0 - type (TEMPORARY = 0, PERSISTENT = 1)[m
[31m- *   1 - size[m
[31m- * OUT:[m
[31m- *  success - FileSystem object[m
[31m- *   - name - the human readable directory name[m
[31m- *   - root - DirectoryEntry object[m
[31m- *      - isDirectory[m
[31m- *      - isFile[m
[31m- *      - name[m
[31m- *      - fullPath[m
[31m- *  fail - FileError code[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var fsType = args[0] === 0 ? 'temporary' : 'persistent',[m
[31m-        size = args[1],[m
[31m-        onSuccess = function (fs) {[m
[31m-            var directory = {[m
[31m-                name: fsType,[m
[31m-                root: fs[m
[31m-            };[m
[31m-            success(directory);[m
[31m-        };[m
[31m-    resolve(onSuccess, fail, ['cdvfile://localhost/' + fsType + '/', undefined, size]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/resolveLocalFileSystemURI.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/resolveLocalFileSystemURI.js[m
[1mdeleted file mode 100644[m
[1mindex 5e82b5b..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/resolveLocalFileSystemURI.js[m
[1m+++ /dev/null[m
[36m@@ -1,172 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/*[m
[31m- * resolveLocalFileSystemURI[m
[31m- *[m
[31m- * IN[m
[31m- *  args[m
[31m- *   0 - escaped local filesystem URI[m
[31m- *   1 - options (standard HTML5 file system options)[m
[31m- *   2 - size[m
[31m- * OUT[m
[31m- *  success - Entry object[m
[31m- *   - isDirectory[m
[31m- *   - isFile[m
[31m- *   - name[m
[31m- *   - fullPath[m
[31m- *   - nativeURL[m
[31m- *   - fileSystemName[m
[31m- *  fail - FileError code[m
[31m- */[m
[31m-[m
[31m-var info = require('cordova-plugin-file.bb10FileSystemInfo'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame'),[m
[31m-    createEntryFromNative = require('cordova-plugin-file.bb10CreateEntryFromNative'),[m
[31m-    SANDBOXED = true,[m
[31m-    UNSANDBOXED = false;[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var request = args[0],[m
[31m-        options = args[1],[m
[31m-        size = args[2];[m
[31m-    if (request) {[m
[31m-        request = decodeURIComponent(request);[m
[31m-        if (request.indexOf('?') > -1) {[m
[31m-            //bb10 does not support params; strip them off[m
[31m-            request = request.substring(0, request.indexOf('?'));[m
[31m-        }[m
[31m-        if (request.indexOf('file://localhost/') === 0) {[m
[31m-            //remove localhost prefix[m
[31m-            request = request.replace('file://localhost/', 'file:///');[m
[31m-        }[m
[31m-        //requests to sandboxed locations should use cdvfile[m
[31m-        request = request.replace(info.persistentPath, 'cdvfile://localhost/persistent');[m
[31m-        request = request.replace(info.temporaryPath, 'cdvfile://localhost/temporary');[m
[31m-        //pick appropriate handler[m
[31m-        if (request.indexOf('file:///') === 0) {[m
[31m-            resolveFile(success, fail, request, options);[m
[31m-        } else if (request.indexOf('cdvfile://localhost/') === 0) {[m
[31m-            resolveCdvFile(success, fail, request, options, size);[m
[31m-        } else if (request.indexOf('local:///') === 0) {[m
[31m-            resolveLocal(success, fail, request, options);[m
[31m-        } else {[m
[31m-            fail(FileError.ENCODING_ERR);[m
[31m-        }[m
[31m-    } else {[m
[31m-        fail(FileError.NOT_FOUND_ERR);[m
[31m-    }[m
[31m-};[m
[31m-[m
[31m-//resolve file:///[m
[31m-function resolveFile(success, fail, request, options) {[m
[31m-    var path = request.substring(7);[m
[31m-    resolve(success, fail, path, window.PERSISTENT, UNSANDBOXED, options);[m
[31m-}[m
[31m-[m
[31m-//resolve cdvfile://localhost/filesystemname/[m
[31m-function resolveCdvFile(success, fail, request, options, size) {[m
[31m-    var components = /cdvfile:\/\/localhost\/([^\/]+)\/(.*)/.exec(request),[m
[31m-        fsType = components[1],[m
[31m-        path = components[2];[m
[31m-    if (fsType === 'persistent') {[m
[31m-        resolve(success, fail, path, window.PERSISTENT, SANDBOXED, options, size);[m
[31m-    }[m
[31m-    else if (fsType === 'temporary') {[m
[31m-        resolve(success, fail, path, window.TEMPORARY, SANDBOXED, options, size);[m
[31m-    }[m
[31m-    else if (fsType === 'root') {[m
[31m-        resolve(success, fail, path, window.PERSISTENT, UNSANDBOXED, options);[m
[31m-    }[m
[31m-    else {[m
[31m-        fail(FileError.NOT_FOUND_ERR);[m
[31m-    }[m
[31m-}[m
[31m-[m
[31m-//resolve local:///[m
[31m-function resolveLocal(success, fail, request, options) {[m
[31m-    var path = localPath + request.substring(8);[m
[31m-    resolve(success, fail, path, window.PERSISTENT, UNSANDBOXED, options);[m
[31m-}[m
[31m-[m
[31m-//validate parameters and set sandbox[m
[31m-function resolve(success, fail, path, fsType, sandbox, options, size) {[m
[31m-    options = options || { create: false };[m
[31m-    size = size || info.MAX_SIZE;[m
[31m-    if (size > info.MAX_SIZE) {[m
[31m-        //bb10 does not respect quota; fail at unreasonably large size[m
[31m-        fail(FileError.QUOTA_EXCEEDED_ERR);[m
[31m-    } else if (path.indexOf(':') > -1) {[m
[31m-        //files with : character are not valid in Cordova apps [m
[31m-        fail(FileError.ENCODING_ERR);[m
[31m-    } else {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            cordova.exec(function () {[m
[31m-                requestAnimationFrame(function () {[m
[31m-                    resolveNative(success, fail, path, fsType, options, size);[m
[31m-                });[m
[31m-            }, fail, 'File', 'setSandbox', [sandbox], false);[m
[31m-        });[m
[31m-    }[m
[31m-}[m
[31m-[m
[31m-//find path using webkit file system[m
[31m-function resolveNative(success, fail, path, fsType, options, size) {[m
[31m-    window.webkitRequestFileSystem([m
[31m-        fsType,[m
[31m-        size,[m
[31m-        function (fs) {[m
[31m-            if (path === '') {[m
[31m-                //no path provided, call success with root file system[m
[31m-                success(createEntryFromNative(fs.root));[m
[31m-            } else {[m
[31m-                //otherwise attempt to resolve as file[m
[31m-                fs.root.getFile([m
[31m-                    path,[m
[31m-                    options,[m
[31m-                    function (entry) {[m
[31m-                        success(createEntryFromNative(entry));[m
[31m-                    },[m
[31m-                    function (fileError) {[m
[31m-                        //file not found, attempt to resolve as directory[m
[31m-                        fs.root.getDirectory([m
[31m-                            path,[m
[31m-                            options,[m
[31m-                            function (entry) {[m
[31m-                                success(createEntryFromNative(entry));[m
[31m-                            },[m
[31m-                            function (dirError) {[m
[31m-                                //path cannot be resolved[m
[31m-                                if (fileError.code === FileError.INVALID_MODIFICATION_ERR && [m
[31m-                                    options.exclusive) {[m
[31m-                                    //mobile-spec expects this error code[m
[31m-                                    fail(FileError.PATH_EXISTS_ERR);[m
[31m-                                } else {[m
[31m-                                    fail(FileError.NOT_FOUND_ERR);[m
[31m-                                }[m
[31m-                            }[m
[31m-                        );[m
[31m-                    }[m
[31m-                );[m
[31m-            }[m
[31m-        }[m
[31m-    );[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/setMetadata.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/setMetadata.js[m
[1mdeleted file mode 100644[m
[1mindex 0f2dc79..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/setMetadata.js[m
[1m+++ /dev/null[m
[36m@@ -1,33 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * setMetadata[m
[31m- * [m
[31m- * BB10 OS does not support setting file metadata via HTML5 File System [m
[31m- */[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    console.error("setMetadata not supported on BB10", arguments);[m
[31m-    if (typeof(fail) === 'function') {[m
[31m-        fail();[m
[31m-    }[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/truncate.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/truncate.js[m
[1mdeleted file mode 100644[m
[1mindex fe43b7e..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/truncate.js[m
[1m+++ /dev/null[m
[36m@@ -1,74 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * truncate[m
[31m- * [m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - URL of file to truncate[m
[31m- *   1 - start position[m
[31m- * OUT:[m
[31m- *  success - new length of file[m
[31m- *  fail - FileError[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0],[m
[31m-        length = args[1],[m
[31m-        onSuccess = function (data) {[m
[31m-            if (typeof success === 'function') {[m
[31m-                success(data.loaded);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof fail === 'function') {[m
[31m-                if (error && error.code) {[m
[31m-                    fail(error.code);[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (fs) {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            fs.nativeEntry.file(function (file) {[m
[31m-                var reader = new FileReader()._realReader;[m
[31m-                reader.onloadend = function () {[m
[31m-                    var contents = new Uint8Array(this.result).subarray(0, length),[m
[31m-                        blob = new Blob([contents]);[m
[31m-                    window.requestAnimationFrame(function () {[m
[31m-                        fs.nativeEntry.createWriter(function (fileWriter) {[m
[31m-                            fileWriter.onwriteend = onSuccess;[m
[31m-                            fileWriter.onerror = onFail;[m
[31m-                            fileWriter.write(blob);[m
[31m-                        }, onFail);[m
[31m-                    });[m
[31m-                };[m
[31m-                reader.onerror = onFail;[m
[31m-                reader.readAsArrayBuffer(file);[m
[31m-            }, onFail);[m
[31m-        });[m
[31m-    }, onFail, [uri]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/write.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/write.js[m
[1mdeleted file mode 100644[m
[1mindex b2ed261..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/blackberry10/write.js[m
[1m+++ /dev/null[m
[36m@@ -1,73 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* [m
[31m- * write[m
[31m- * [m
[31m- * IN:[m
[31m- *  args[m
[31m- *   0 - URL of file to write[m
[31m- *   1 - data to write[m
[31m- *   2 - offset[m
[31m- *   3 - isBinary[m
[31m- * OUT:[m
[31m- *  success - bytes written[m
[31m- *  fail - FileError[m
[31m- */[m
[31m-[m
[31m-var resolve = cordova.require('cordova-plugin-file.resolveLocalFileSystemURIProxy'),[m
[31m-    requestAnimationFrame = cordova.require('cordova-plugin-file.bb10RequestAnimationFrame');[m
[31m-[m
[31m-module.exports = function (success, fail, args) {[m
[31m-    var uri = args[0],[m
[31m-        data = args[1],[m
[31m-        offset = args[2],[m
[31m-        //isBinary = args[3],[m
[31m-        onSuccess = function (data) {[m
[31m-            if (typeof success === 'function') {[m
[31m-                success(data.loaded);[m
[31m-            }[m
[31m-        },[m
[31m-        onFail = function (error) {[m
[31m-            if (typeof fail === 'function') {[m
[31m-                if (error && error.code) {[m
[31m-                    fail(error.code);[m
[31m-                } else if (error && error.target && error.target.code) {[m
[31m-                    fail(error.target.code);[m
[31m-                } else {[m
[31m-                    fail(error);[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-    resolve(function (fs) {[m
[31m-        requestAnimationFrame(function () {[m
[31m-            fs.nativeEntry.createWriter(function (writer) {[m
[31m-                var blob = new Blob([data]);[m
[31m-                if (offset) {[m
[31m-                    writer.seek(offset);[m
[31m-                }[m
[31m-                writer.onwriteend = onSuccess;[m
[31m-                writer.onerror = onFail;[m
[31m-                writer.write(blob);[m
[31m-            }, onFail);[m
[31m-        });[m
[31m-    }, fail, [uri, { create: true }]);[m
[31m-};[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/browser/FileSystem.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/browser/FileSystem.js[m
[1mindex c0996cb..a7c1d6c 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/browser/FileSystem.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/browser/FileSystem.js[m
[36m@@ -19,13 +19,12 @@[m
  *[m
 */[m
 [m
[31m-/*global FILESYSTEM_PREFIX: true, module*/[m
[32m+[m[32m/* global FILESYSTEM_PREFIX: true, module */[m
 [m
[31m-FILESYSTEM_PREFIX = "file:///";[m
[32m+[m[32mFILESYSTEM_PREFIX = 'file:///';[m
 [m
 module.exports = {[m
[31m-    __format__: function(fullPath) {[m
[31m-        return (FILESYSTEM_PREFIX + this.name + (fullPath[0] === '/' ? '' : '/') + FileSystem.encodeURIPath(fullPath));[m
[32m+[m[32m    __format__: function (fullPath) {[m
[32m+[m[32m        return (FILESYSTEM_PREFIX + this.name + (fullPath[0] === '/' ? '' : '/') + FileSystem.encodeURIPath(fullPath)); // eslint-disable-line no-undef[m
     }[m
 };[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/browser/Preparing.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/browser/Preparing.js[m
[1mindex 7845f9e..b826a65 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/browser/Preparing.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/browser/Preparing.js[m
[36m@@ -20,9 +20,9 @@[m
 */[m
 [m
 (function () {[m
[31m-    /*global require*/[m
[32m+[m[32m    /* global require */[m
 [m
[31m-    //Only Chrome uses this file.[m
[32m+[m[32m    // Only Chrome uses this file.[m
     if (!require('./isChrome')()) {[m
         return;[m
     }[m
[36m@@ -30,26 +30,26 @@[m
     var channel = require('cordova/channel');[m
     var FileError = require('./FileError');[m
     var PERSISTENT_FS_QUOTA = 5 * 1024 * 1024;[m
[31m-    var filePluginIsReadyEvent = new Event('filePluginIsReady');[m
[32m+[m[32m    var filePluginIsReadyEvent = new Event('filePluginIsReady'); // eslint-disable-line no-undef[m
 [m
     var entryFunctionsCreated = false;[m
     var quotaWasRequested = false;[m
     var eventWasThrown = false;[m
 [m
     if (!window.requestFileSystem) {[m
[31m-        window.requestFileSystem = function(type, size, win, fail) {[m
[32m+[m[32m        window.requestFileSystem = function (type, size, win, fail) {[m
             if (fail) {[m
[31m-                fail("Not supported");[m
[32m+[m[32m                fail('Not supported');[m
             }[m
         };[m
     } else {[m
[31m-        window.requestFileSystem(window.TEMPORARY, 1, createFileEntryFunctions, function() {});[m
[32m+[m[32m        window.requestFileSystem(window.TEMPORARY, 1, createFileEntryFunctions, function () {});[m
     }[m
 [m
     if (!window.resolveLocalFileSystemURL) {[m
[31m-        window.resolveLocalFileSystemURL = function(url, win, fail) {[m
[31m-            if(fail) {[m
[31m-                fail("Not supported");[m
[32m+[m[32m        window.resolveLocalFileSystemURL = function (url, win, fail) {[m
[32m+[m[32m            if (fail) {[m
[32m+[m[32m                fail('Not supported');[m
             }[m
         };[m
     }[m
[36m@@ -58,14 +58,14 @@[m
     // Cordova-specific (cdvfile://) universal way.[m
     // Aligns with specification: http://www.w3.org/TR/2011/WD-file-system-api-20110419/#widl-LocalFileSystem-resolveLocalFileSystemURL[m
     var nativeResolveLocalFileSystemURL = window.resolveLocalFileSystemURL || window.webkitResolveLocalFileSystemURL;[m
[31m-    window.resolveLocalFileSystemURL = function(url, win, fail) {[m
[32m+[m[32m    window.resolveLocalFileSystemURL = function (url, win, fail) {[m
         /* If url starts with `cdvfile` then we need convert it to Chrome real url first:[m
           cdvfile://localhost/persistent/path/to/file -> filesystem:file://persistent/path/to/file */[m
[31m-        if (url.trim().substr(0,7) === "cdvfile") {[m
[32m+[m[32m        if (url.trim().substr(0, 7) === 'cdvfile') {[m
             /* Quirk:[m
             Plugin supports cdvfile://localhost (local resources) only.[m
             I.e. external resources are not supported via cdvfile. */[m
[31m-            if (url.indexOf("cdvfile://localhost") !== -1) {[m
[32m+[m[32m            if (url.indexOf('cdvfile://localhost') !== -1) {[m
                 // Browser supports temporary and persistent only[m
                 var indexPersistent = url.indexOf('persistent');[m
                 var indexTemporary = url.indexOf('temporary');[m
[36m@@ -75,15 +75,15 @@[m
                    For example, filesystem:file:///persistent/somefile.txt,[m
                    filesystem:http://localhost:8080/persistent/somefile.txt. */[m
                 var prefix = 'filesystem:file:///';[m
[31m-                if (location.protocol !== 'file:') {[m
[31m-                    prefix = 'filesystem:' + location.origin + '/';[m
[32m+[m[32m                if (location.protocol !== 'file:') { // eslint-disable-line no-undef[m
[32m+[m[32m                    prefix = 'filesystem:' + location.origin + '/'; // eslint-disable-line no-undef[m
                 }[m
 [m
                 var result;[m
                 if (indexPersistent !== -1) {[m
                     // cdvfile://localhost/persistent/path/to/file -> filesystem:file://persistent/path/to/file[m
                     // or filesystem:http://localhost:8080/persistent/path/to/file[m
[31m-                    result =  prefix + 'persistent' + url.substr(indexPersistent + 10);[m
[32m+[m[32m                    result = prefix + 'persistent' + url.substr(indexPersistent + 10);[m
                     nativeResolveLocalFileSystemURL(result, win, fail);[m
                     return;[m
                 }[m
[36m@@ -106,8 +106,8 @@[m
         }[m
     };[m
 [m
[31m-    function createFileEntryFunctions(fs) {[m
[31m-        fs.root.getFile('todelete_658674_833_4_cdv', {create: true}, function(fileEntry) {[m
[32m+[m[32m    function createFileEntryFunctions (fs) {[m
[32m+[m[32m        fs.root.getFile('todelete_658674_833_4_cdv', {create: true}, function (fileEntry) {[m
             var fileEntryType = Object.getPrototypeOf(fileEntry);[m
             var entryType = Object.getPrototypeOf(fileEntryType);[m
 [m
[36m@@ -126,59 +126,59 @@[m
                 return this.toURL();[m
             };[m
 [m
[31m-            entryType.toInternalURL = function() {[m
[31m-                if (this.toURL().indexOf("persistent") > -1) {[m
[31m-                    return "cdvfile://localhost/persistent" + this.fullPath;[m
[32m+[m[32m            entryType.toInternalURL = function () {[m
[32m+[m[32m                if (this.toURL().indexOf('persistent') > -1) {[m
[32m+[m[32m                    return 'cdvfile://localhost/persistent' + this.fullPath;[m
                 }[m
 [m
[31m-                if (this.toURL().indexOf("temporary") > -1) {[m
[31m-                    return "cdvfile://localhost/temporary" + this.fullPath;[m
[32m+[m[32m                if (this.toURL().indexOf('temporary') > -1) {[m
[32m+[m[32m                    return 'cdvfile://localhost/temporary' + this.fullPath;[m
                 }[m
             };[m
 [m
[31m-            entryType.setMetadata = function(win, fail /*, metadata*/) {[m
[32m+[m[32m            entryType.setMetadata = function (win, fail /*, metadata */) {[m
                 if (fail) {[m
[31m-                    fail("Not supported");[m
[32m+[m[32m                    fail('Not supported');[m
                 }[m
             };[m
 [m
[31m-            fileEntry.createWriter(function(writer) {[m
[32m+[m[32m            fileEntry.createWriter(function (writer) {[m
                 var originalWrite = writer.write;[m
                 var writerProto = Object.getPrototypeOf(writer);[m
[31m-                writerProto.write = function(blob) {[m
[31m-                    if(blob instanceof Blob) {[m
[32m+[m[32m                writerProto.write = function (blob) {[m
[32m+[m[32m                    if (blob instanceof Blob) { // eslint-disable-line no-undef[m
                         originalWrite.apply(this, [blob]);[m
                     } else {[m
[31m-                        var realBlob = new Blob([blob]);[m
[32m+[m[32m                        var realBlob = new Blob([blob]); // eslint-disable-line no-undef[m
                         originalWrite.apply(this, [realBlob]);[m
[31m-                   }[m
[32m+[m[32m                    }[m
                 };[m
 [m
[31m-                fileEntry.remove(function(){ entryFunctionsCreated = true; }, function(){ /* empty callback */ });[m
[31m-          });[m
[32m+[m[32m                fileEntry.remove(function () { entryFunctionsCreated = true; }, function () { /* empty callback */ });[m
[32m+[m[32m            });[m
         });[m
     }[m
 [m
[31m-    window.initPersistentFileSystem = function(size, win, fail) {[m
[32m+[m[32m    window.initPersistentFileSystem = function (size, win, fail) {[m
         if (navigator.webkitPersistentStorage) {[m
             navigator.webkitPersistentStorage.requestQuota(size, win, fail);[m
             return;[m
         }[m
 [m
[31m-        fail("This browser does not support this function");[m
[32m+[m[32m        fail('This browser does not support this function');[m
     };[m
 [m
     window.isFilePluginReadyRaised = function () { return eventWasThrown; };[m
 [m
[31m-    window.initPersistentFileSystem(PERSISTENT_FS_QUOTA, function() {[m
[32m+[m[32m    window.initPersistentFileSystem(PERSISTENT_FS_QUOTA, function () {[m
         console.log('Persistent fs quota granted');[m
         quotaWasRequested = true;[m
[31m-    }, function(e){[m
[32m+[m[32m    }, function (e) {[m
         console.log('Error occured while trying to request Persistent fs quota: ' + JSON.stringify(e));[m
     });[m
 [m
     channel.onCordovaReady.subscribe(function () {[m
[31m-        function dispatchEventIfReady() {[m
[32m+[m[32m        function dispatchEventIfReady () {[m
             if (entryFunctionsCreated && quotaWasRequested) {[m
                 window.dispatchEvent(filePluginIsReadyEvent);[m
                 eventWasThrown = true;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/fileSystemPaths.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/fileSystemPaths.js[m
[1mindex 640b9d6..f79794b 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/fileSystemPaths.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/fileSystemPaths.js[m
[36m@@ -51,8 +51,8 @@[m [mexports.file = {[m
 };[m
 [m
 channel.waitForInitialization('onFileSystemPathsReady');[m
[31m-channel.onCordovaReady.subscribe(function() {[m
[31m-    function after(paths) {[m
[32m+[m[32mchannel.onCordovaReady.subscribe(function () {[m
[32m+[m[32m    function after (paths) {[m
         for (var k in paths) {[m
             exports.file[k] = paths[k];[m
         }[m
[36m@@ -60,4 +60,3 @@[m [mchannel.onCordovaReady.subscribe(function() {[m
     }[m
     exec(after, null, 'File', 'requestAllPaths', []);[m
 });[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/fileSystems-roots.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/fileSystems-roots.js[m
[1mindex 107a9b8..9a3fc7a 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/fileSystems-roots.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/fileSystems-roots.js[m
[36m@@ -25,8 +25,8 @@[m [mvar FileSystem = require('./FileSystem');[m
 var exec = require('cordova/exec');[m
 [m
 // Overridden by Android, BlackBerry 10 and iOS to populate fsMap.[m
[31m-require('./fileSystems').getFs = function(name, callback) {[m
[31m-    function success(response) {[m
[32m+[m[32mrequire('./fileSystems').getFs = function (name, callback) {[m
[32m+[m[32m    function success (response) {[m
         fsMap = {};[m
         for (var i = 0; i < response.length; ++i) {[m
             var fsRoot = response[i];[m
[36m@@ -39,7 +39,6 @@[m [mrequire('./fileSystems').getFs = function(name, callback) {[m
     if (fsMap) {[m
         callback(fsMap[name]);[m
     } else {[m
[31m-        exec(success, null, "File", "requestAllFileSystems", []);[m
[32m+[m[32m        exec(success, null, 'File', 'requestAllFileSystems', []);[m
     }[m
 };[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/fileSystems.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/fileSystems.js[m
[1mindex 8ecdec3..40e5574 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/fileSystems.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/fileSystems.js[m
[36m@@ -20,6 +20,6 @@[m
 */[m
 [m
 // Overridden by Android, BlackBerry 10 and iOS to populate fsMap.[m
[31m-module.exports.getFs = function(name, callback) {[m
[32m+[m[32mmodule.exports.getFs = function (name, callback) {[m
     callback(null);[m
 };[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/firefoxos/FileSystem.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/firefoxos/FileSystem.js[m
[1mdeleted file mode 100644[m
[1mindex edc003b..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/firefoxos/FileSystem.js[m
[1m+++ /dev/null[m
[36m@@ -1,29 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-FILESYSTEM_PREFIX = "file:///";[m
[31m-[m
[31m-module.exports = {[m
[31m-    __format__: function(fullPath) {[m
[31m-        return (FILESYSTEM_PREFIX + this.name + (fullPath[0] === '/' ? '' : '/') + FileSystem.encodeURIPath(fullPath));[m
[31m-    }[m
[31m-};[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/ios/FileSystem.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/ios/FileSystem.js[m
[1mindex 114ebb0..cb14c78 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/ios/FileSystem.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/ios/FileSystem.js[m
[36m@@ -18,13 +18,12 @@[m
  * under the License.[m
  *[m
 */[m
[31m-[m
[31m-FILESYSTEM_PROTOCOL = "cdvfile";[m
[32m+[m[32m/* eslint no-undef : 0 */[m
[32m+[m[32mFILESYSTEM_PROTOCOL = 'cdvfile';[m
 [m
 module.exports = {[m
[31m-    __format__: function(fullPath) {[m
[31m-        var path = ('/'+this.name+(fullPath[0]==='/'?'':'/')+FileSystem.encodeURIPath(fullPath)).replace('//','/');[m
[32m+[m[32m    __format__: function (fullPath) {[m
[32m+[m[32m        var path = ('/' + this.name + (fullPath[0] === '/' ? '' : '/') + FileSystem.encodeURIPath(fullPath)).replace('//', '/');[m
         return FILESYSTEM_PROTOCOL + '://localhost' + path;[m
     }[m
 };[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/osx/FileSystem.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/osx/FileSystem.js[m
[1mindex 114ebb0..cb14c78 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/osx/FileSystem.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/osx/FileSystem.js[m
[36m@@ -18,13 +18,12 @@[m
  * under the License.[m
  *[m
 */[m
[31m-[m
[31m-FILESYSTEM_PROTOCOL = "cdvfile";[m
[32m+[m[32m/* eslint no-undef : 0 */[m
[32m+[m[32mFILESYSTEM_PROTOCOL = 'cdvfile';[m
 [m
 module.exports = {[m
[31m-    __format__: function(fullPath) {[m
[31m-        var path = ('/'+this.name+(fullPath[0]==='/'?'':'/')+FileSystem.encodeURIPath(fullPath)).replace('//','/');[m
[32m+[m[32m    __format__: function (fullPath) {[m
[32m+[m[32m        var path = ('/' + this.name + (fullPath[0] === '/' ? '' : '/') + FileSystem.encodeURIPath(fullPath)).replace('//', '/');[m
         return FILESYSTEM_PROTOCOL + '://localhost' + path;[m
     }[m
 };[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/requestFileSystem.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/requestFileSystem.js[m
[1mindex 300937e..d9110cd 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/requestFileSystem.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/requestFileSystem.js[m
[36m@@ -19,10 +19,10 @@[m
  *[m
 */[m
 [m
[31m-(function() {[m
[31m-    //For browser platform: not all browsers use this file.[m
[31m-    function checkBrowser() {[m
[31m-        if (cordova.platformId === "browser" && require('./isChrome')()) {[m
[32m+[m[32m(function () {[m
[32m+[m[32m    // For browser platform: not all browsers use this file.[m
[32m+[m[32m    function checkBrowser () {[m
[32m+[m[32m        if (cordova.platformId === 'browser' && require('./isChrome')()) { // eslint-disable-line no-undef[m
             module.exports = window.requestFileSystem || window.webkitRequestFileSystem;[m
             return true;[m
         }[m
[36m@@ -32,10 +32,10 @@[m
         return;[m
     }[m
 [m
[31m-    var argscheck = require('cordova/argscheck'),[m
[31m-        FileError = require('./FileError'),[m
[31m-        FileSystem = require('./FileSystem'),[m
[31m-        exec = require('cordova/exec');[m
[32m+[m[32m    var argscheck = require('cordova/argscheck');[m
[32m+[m[32m    var FileError = require('./FileError');[m
[32m+[m[32m    var FileSystem = require('./FileSystem');[m
[32m+[m[32m    var exec = require('cordova/exec');[m
     var fileSystems = require('./fileSystems');[m
 [m
     /**[m
[36m@@ -45,9 +45,9 @@[m
      * @param successCallback  invoked with a FileSystem object[m
      * @param errorCallback  invoked if error occurs retrieving file system[m
      */[m
[31m-    var requestFileSystem = function(type, size, successCallback, errorCallback) {[m
[32m+[m[32m    var requestFileSystem = function (type, size, successCallback, errorCallback) {[m
         argscheck.checkArgs('nnFF', 'requestFileSystem', arguments);[m
[31m-        var fail = function(code) {[m
[32m+[m[32m        var fail = function (code) {[m
             if (errorCallback) {[m
                 errorCallback(new FileError(code));[m
             }[m
[36m@@ -57,10 +57,10 @@[m
             fail(FileError.SYNTAX_ERR);[m
         } else {[m
             // if successful, return a FileSystem object[m
[31m-            var success = function(file_system) {[m
[32m+[m[32m            var success = function (file_system) {[m
                 if (file_system) {[m
                     if (successCallback) {[m
[31m-                        fileSystems.getFs(file_system.name, function(fs) {[m
[32m+[m[32m                        fileSystems.getFs(file_system.name, function (fs) {[m
                             // This should happen only on platforms that haven't implemented requestAllFileSystems (windows)[m
                             if (!fs) {[m
                                 fs = new FileSystem(file_system.name, file_system.root);[m
[36m@@ -68,13 +68,12 @@[m
                             successCallback(fs);[m
                         });[m
                     }[m
[31m-                }[m
[31m-                else {[m
[32m+[m[32m                } else {[m
                     // no FileSystem object returned[m
                     fail(FileError.NOT_FOUND_ERR);[m
                 }[m
             };[m
[31m-            exec(success, fail, "File", "requestFileSystem", [type, size]);[m
[32m+[m[32m            exec(success, fail, 'File', 'requestFileSystem', [type, size]);[m
         }[m
     };[m
 [m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/resolveLocalFileSystemURI.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/resolveLocalFileSystemURI.js[m
[1mindex bfa3b07..764662c 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/resolveLocalFileSystemURI.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-file/www/resolveLocalFileSystemURI.js[m
[36m@@ -18,10 +18,10 @@[m
  * under the License.[m
  *[m
 */[m
[31m-(function() {[m
[31m-    //For browser platform: not all browsers use overrided `resolveLocalFileSystemURL`.[m
[31m-    function checkBrowser() {[m
[31m-        if (cordova.platformId === "browser" && require('./isChrome')()) {[m
[32m+[m[32m(function () {[m
[32m+[m[32m    // For browser platform: not all browsers use overrided `resolveLocalFileSystemURL`.[m
[32m+[m[32m    function checkBrowser () {[m
[32m+[m[32m        if (cordova.platformId === 'browser' && require('./isChrome')()) { // eslint-disable-line no-undef[m
             module.exports.resolveLocalFileSystemURL = window.resolveLocalFileSystemURL || window.webkitResolveLocalFileSystemURL;[m
             return true;[m
         }[m
[36m@@ -31,11 +31,11 @@[m
         return;[m
     }[m
 [m
[31m-    var argscheck = require('cordova/argscheck'),[m
[31m-        DirectoryEntry = require('./DirectoryEntry'),[m
[31m-        FileEntry = require('./FileEntry'),[m
[31m-        FileError = require('./FileError'),[m
[31m-        exec = require('cordova/exec');[m
[32m+[m[32m    var argscheck = require('cordova/argscheck');[m
[32m+[m[32m    var DirectoryEntry = require('./DirectoryEntry');[m
[32m+[m[32m    var FileEntry = require('./FileEntry');[m
[32m+[m[32m    var FileError = require('./FileError');[m
[32m+[m[32m    var exec = require('cordova/exec');[m
     var fileSystems = require('./fileSystems');[m
 [m
     /**[m
[36m@@ -44,49 +44,48 @@[m
      * @param successCallback  invoked with Entry object corresponding to URI[m
      * @param errorCallback    invoked if error occurs retrieving file system entry[m
      */[m
[31m-    module.exports.resolveLocalFileSystemURL = module.exports.resolveLocalFileSystemURL || function(uri, successCallback, errorCallback) {[m
[32m+[m[32m    module.exports.resolveLocalFileSystemURL = module.exports.resolveLocalFileSystemURL || function (uri, successCallback, errorCallback) {[m
         argscheck.checkArgs('sFF', 'resolveLocalFileSystemURI', arguments);[m
         // error callback[m
[31m-        var fail = function(error) {[m
[32m+[m[32m        var fail = function (error) {[m
             if (errorCallback) {[m
                 errorCallback(new FileError(error));[m
             }[m
         };[m
         // sanity check for 'not:valid:filename' or '/not:valid:filename'[m
         // file.spec.12 window.resolveLocalFileSystemURI should error (ENCODING_ERR) when resolving invalid URI with leading /.[m
[31m-        if(!uri || uri.split(":").length > 2) {[m
[31m-            setTimeout( function() {[m
[32m+[m[32m        if (!uri || uri.split(':').length > 2) {[m
[32m+[m[32m            setTimeout(function () {[m
                 fail(FileError.ENCODING_ERR);[m
[31m-            },0);[m
[32m+[m[32m            }, 0);[m
             return;[m
         }[m
         // if successful, return either a file or directory entry[m
[31m-        var success = function(entry) {[m
[32m+[m[32m        var success = function (entry) {[m
             if (entry) {[m
                 if (successCallback) {[m
                     // create appropriate Entry object[m
[31m-                    var fsName = entry.filesystemName || (entry.filesystem && entry.filesystem.name) || (entry.filesystem == window.PERSISTENT ? 'persistent' : 'temporary');[m
[31m-                    fileSystems.getFs(fsName, function(fs) {[m
[32m+[m[32m                    var fsName = entry.filesystemName || (entry.filesystem && entry.filesystem.name) || (entry.filesystem === window.PERSISTENT ? 'persistent' : 'temporary'); // eslint-disable-line no-undef[m
[32m+[m[32m                    fileSystems.getFs(fsName, function (fs) {[m
                         // This should happen only on platforms that haven't implemented requestAllFileSystems (windows)[m
                         if (!fs) {[m
[31m-                            fs = new FileSystem(fsName, {name:"", fullPath:"/"});[m
[32m+[m[32m                            fs = new FileSystem(fsName, {name: '', fullPath: '/'}); // eslint-disable-line no-undef[m
                         }[m
                         var result = (entry.isDirectory) ? new DirectoryEntry(entry.name, entry.fullPath, fs, entry.nativeURL) : new FileEntry(entry.name, entry.fullPath, fs, entry.nativeURL);[m
                         successCallback(result);[m
                     });[m
                 }[m
[31m-            }[m
[31m-            else {[m
[32m+[m[32m            } else {[m
                 // no Entry object returned[m
                 fail(FileError.NOT_FOUND_ERR);[m
             }[m
         };[m
 [m
[31m-        exec(success, fail, "File", "resolveLocalFileSystemURI", [uri]);[m
[32m+[m[32m        exec(success, fail, 'File', 'resolveLocalFileSystemURI', [uri]);[m
     };[m
 [m
[31m-    module.exports.resolveLocalFileSystemURI = function() {[m
[31m-        console.log("resolveLocalFileSystemURI is deprecated. Please call resolveLocalFileSystemURL instead.");[m
[32m+[m[32m    module.exports.resolveLocalFileSystemURI = function () {[m
[32m+[m[32m        console.log('resolveLocalFileSystemURI is deprecated. Please call resolveLocalFileSystemURL instead.');[m
         module.exports.resolveLocalFileSystemURL.apply(this, arguments);[m
     };[m
 })();[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/ubuntu/FileSystem.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/ubuntu/FileSystem.js[m
[1mdeleted file mode 100644[m
[1mindex 3594565..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/ubuntu/FileSystem.js[m
[1m+++ /dev/null[m
[36m@@ -1,34 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-FILESYSTEM_PROTOCOL = "cdvfile";[m
[31m-[m
[31m-module.exports = {[m
[31m-    __format__: function(fullPath) {[m
[31m-        if (this.name === 'content') {[m
[31m-            return 'content:/' + fullPath;[m
[31m-        }[m
[31m-        var path = ('/' + this.name + (fullPath[0] === '/' ? '' : '/') + FileSystem.encodeURIPath(fullPath)).replace('//','/');[m
[31m-[m
[31m-        return FILESYSTEM_PROTOCOL + '://localhost' + path;[m
[31m-    }[m
[31m-};[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/ubuntu/FileWriter.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/ubuntu/FileWriter.js[m
[1mdeleted file mode 100644[m
[1mindex 5428cb2..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/ubuntu/FileWriter.js[m
[1m+++ /dev/null[m
[36m@@ -1,135 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-var exec = require('cordova/exec'),[m
[31m-    FileError = require('./FileError'),[m
[31m-    ProgressEvent = require('./ProgressEvent');[m
[31m-[m
[31m-function write(data) {[m
[31m-    var that=this;[m
[31m-    var supportsBinary = (typeof window.Blob !== 'undefined' && typeof window.ArrayBuffer !== 'undefined');[m
[31m-    var isBinary;[m
[31m-[m
[31m-    // Check to see if the incoming data is a blob[m
[31m-    if (data instanceof File || (supportsBinary && data instanceof Blob)) {[m
[31m-        var fileReader = new FileReader();[m
[31m-        fileReader.onload = function() {[m
[31m-            // Call this method again, with the arraybuffer as argument[m
[31m-            FileWriter.prototype.write.call(that, this.result);[m
[31m-        };[m
[31m-        if (supportsBinary) {[m
[31m-            fileReader.readAsArrayBuffer(data);[m
[31m-        } else {[m
[31m-            fileReader.readAsText(data);[m
[31m-        }[m
[31m-        return;[m
[31m-    }[m
[31m-[m
[31m-    // Mark data type for safer transport over the binary bridge[m
[31m-    isBinary = supportsBinary && (data instanceof ArrayBuffer);[m
[31m-[m
[31m-    // Throw an exception if we are already writing a file[m
[31m-    if (this.readyState === FileWriter.WRITING) {[m
[31m-        throw new FileError(FileError.INVALID_STATE_ERR);[m
[31m-    }[m
[31m-[m
[31m-    // WRITING state[m
[31m-    this.readyState = FileWriter.WRITING;[m
[31m-[m
[31m-    var me = this;[m
[31m-[m
[31m-    // If onwritestart callback[m
[31m-    if (typeof me.onwritestart === "function") {[m
[31m-        me.onwritestart(new ProgressEvent("writestart", {"target":me}));[m
[31m-    }[m
[31m-[m
[31m-    if (data instanceof ArrayBuffer || data.buffer instanceof ArrayBuffer) {[m
[31m-        data = new Uint8Array(data);[m
[31m-    var binary = "";[m
[31m-    for (var i = 0; i < data.byteLength; i++) {[m
[31m-            binary += String.fromCharCode(data[i]);[m
[31m-    }[m
[31m-        data = binary;[m
[31m-    }[m
[31m-[m
[31m-    var prefix = "file://localhost";[m
[31m-    var path = this.localURL;[m
[31m-    if (path.substr(0, prefix.length) == prefix) {[m
[31m-        path = path.substr(prefix.length);[m
[31m-    }[m
[31m-    // Write file[m
[31m-    exec([m
[31m-        // Success callback[m
[31m-        function(r) {[m
[31m-            // If DONE (cancelled), then don't do anything[m
[31m-            if (me.readyState === FileWriter.DONE) {[m
[31m-                return;[m
[31m-            }[m
[31m-[m
[31m-            // position always increases by bytes written because file would be extended[m
[31m-            me.position += r;[m
[31m-            // The length of the file is now where we are done writing.[m
[31m-[m
[31m-            me.length = me.position;[m
[31m-[m
[31m-            // DONE state[m
[31m-            me.readyState = FileWriter.DONE;[m
[31m-[m
[31m-            // If onwrite callback[m
[31m-            if (typeof me.onwrite === "function") {[m
[31m-                me.onwrite(new ProgressEvent("write", {"target":me}));[m
[31m-            }[m
[31m-[m
[31m-            // If onwriteend callback[m
[31m-            if (typeof me.onwriteend === "function") {[m
[31m-                me.onwriteend(new ProgressEvent("writeend", {"target":me}));[m
[31m-            }[m
[31m-        },[m
[31m-        // Error callback[m
[31m-        function(e) {[m
[31m-            // If DONE (cancelled), then don't do anything[m
[31m-            if (me.readyState === FileWriter.DONE) {[m
[31m-                return;[m
[31m-            }[m
[31m-[m
[31m-            // DONE state[m
[31m-            me.readyState = FileWriter.DONE;[m
[31m-[m
[31m-            // Save error[m
[31m-            me.error = new FileError(e);[m
[31m-[m
[31m-            // If onerror callback[m
[31m-            if (typeof me.onerror === "function") {[m
[31m-                me.onerror(new ProgressEvent("error", {"target":me}));[m
[31m-            }[m
[31m-[m
[31m-            // If onwriteend callback[m
[31m-            if (typeof me.onwriteend === "function") {[m
[31m-                me.onwriteend(new ProgressEvent("writeend", {"target":me}));[m
[31m-            }[m
[31m-        }, "File", "write", [path, data, this.position, isBinary]);[m
[31m-}[m
[31m-[m
[31m-module.exports = {[m
[31m-    write: write[m
[31m-};[m
[31m-[m
[31m-require("cordova/exec/proxy").add("FileWriter", module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/ubuntu/fileSystems-roots.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/ubuntu/fileSystems-roots.js[m
[1mdeleted file mode 100644[m
[1mindex d2c6857..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/ubuntu/fileSystems-roots.js[m
[1m+++ /dev/null[m
[36m@@ -1,53 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-var fsMap = null;[m
[31m-var FileSystem = require('./FileSystem');[m
[31m-var LocalFileSystem = require('./LocalFileSystem');[m
[31m-var exec = require('cordova/exec');[m
[31m-[m
[31m-var requestFileSystem = function(type, size, successCallback) {[m
[31m-    var success = function(file_system) {[m
[31m-        if (file_system) {[m
[31m-            if (successCallback) {[m
[31m-                var fs = new FileSystem(file_system.name, file_system.root);[m
[31m-                successCallback(fs);[m
[31m-            }[m
[31m-        }[m
[31m-    };[m
[31m-    exec(success, null, "File", "requestFileSystem", [type, size]);[m
[31m-};[m
[31m-[m
[31m-require('./fileSystems').getFs = function(name, callback) {[m
[31m-    if (fsMap) {[m
[31m-        callback(fsMap[name]);[m
[31m-    } else {[m
[31m-        requestFileSystem(LocalFileSystem.PERSISTENT, 1, function(fs) {[m
[31m-            requestFileSystem(LocalFileSystem.TEMPORARY, 1, function(tmp) {[m
[31m-                fsMap = {};[m
[31m-                fsMap[tmp.name] = tmp;[m
[31m-                fsMap[fs.name] = fs;[m
[31m-                callback(fsMap[name]);[m
[31m-            });[m
[31m-        });[m
[31m-    }[m
[31m-};[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-file/www/wp/FileUploadOptions.js b/cordova_exchange_dist/plugins/cordova-plugin-file/www/wp/FileUploadOptions.js[m
[1mdeleted file mode 100644[m
[1mindex 696573a..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-file/www/wp/FileUploadOptions.js[m
[1m+++ /dev/null[m
[36m@@ -1,49 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/**[m
[31m- * Options to customize the HTTP request used to upload files.[m
[31m- * @constructor[m
[31m- * @param fileKey {String}   Name of file request parameter.[m
[31m- * @param fileName {String}  Filename to be used by the server. Defaults to image.jpg.[m
[31m- * @param mimeType {String}  Mimetype of the uploaded file. Defaults to image/jpeg.[m
[31m- * @param params {Object}    Object with key: value params to send to the server.[m
[31m- */[m
[31m-var FileUploadOptions = function(fileKey, fileName, mimeType, params, headers, httpMethod) {[m
[31m-    this.fileKey = fileKey || null;[m
[31m-    this.fileName = fileName || null;[m
[31m-    this.mimeType = mimeType || null;[m
[31m-    this.headers = headers || null;[m
[31m-    this.httpMethod = httpMethod || null;[m
[31m-[m
[31m-    if(params && typeof params != typeof "") {[m
[31m-        var arrParams = [];[m
[31m-        for(var v in params) {[m
[31m-            arrParams.push(v + "=" + params[v]);[m
[31m-        }[m
[31m-        this.params = encodeURIComponent(arrParams.join("&"));[m
[31m-    }[m
[31m-    else {[m
[31m-        this.params = params || null;[m
[31m-    }[m
[31m-};[m
[31m-[m
[31m-module.exports = FileUploadOptions;[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/README.md b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/README.md[m
[1mindex c89d8ed..26ed518 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/README.md[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/README.md[m
[36m@@ -21,9 +21,9 @@[m [mdescription: Open an in-app browser window.[m
 #         under the License.[m
 -->[m
 [m
[31m-|Android 4.4|Android 5.1|iOS|Windows 10 Store|Travis CI|[m
[31m-|:-:|:-:|:-:|:-:|:-:|[m
[31m-|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=android-4.4,PLUGIN=cordova-plugin-inappbrowser)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=android-4.4,PLUGIN=cordova-plugin-inappbrowser/)|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=android-5.1,PLUGIN=cordova-plugin-inappbrowser)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=android-5.1,PLUGIN=cordova-plugin-inappbrowser/)|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=ios,PLUGIN=cordova-plugin-inappbrowser)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=ios,PLUGIN=cordova-plugin-inappbrowser/)|[![Build Status](http://cordova-ci.cloudapp.net:8080/buildStatus/icon?job=cordova-periodic-build/PLATFORM=windows-10-store,PLUGIN=cordova-plugin-inappbrowser)](http://cordova-ci.cloudapp.net:8080/job/cordova-periodic-build/PLATFORM=windows-10-store,PLUGIN=cordova-plugin-inappbrowser/)|[![Build Status](https://travis-ci.org/apache/cordova-plugin-inappbrowser.svg?branch=master)](https://travis-ci.org/apache/cordova-plugin-inappbrowser)|[m
[32m+[m[32m|AppVeyor|Travis CI|[m
[32m+[m[32m|:-:|:-:|[m
[32m+[m[32m|[![Build status](https://ci.appveyor.com/api/projects/status/github/apache/cordova-plugin-inappbrowser?branch=master)](https://ci.appveyor.com/project/ApacheSoftwareFoundation/cordova-plugin-inappbrowser)|[![Build Status](https://travis-ci.org/apache/cordova-plugin-inappbrowser.svg?branch=master)](https://travis-ci.org/apache/cordova-plugin-inappbrowser)|[m
 [m
 # cordova-plugin-inappbrowser[m
 [m
[36m@@ -57,7 +57,7 @@[m [mplugin).  The hook of `window.open` will be removed in a future major release.[m
 Until the hook is removed from the plugin, apps can manually restore the default[m
 behaviour:[m
 [m
[31m-    delete window.open // Reverts the call back to it's prototype's default[m
[32m+[m[32m    delete window.open // Reverts the call back to its prototype's default[m
 [m
 Although `window.open` is in the global scope, InAppBrowser is not available until after the `deviceready` event.[m
 [m
[36m@@ -66,7 +66,7 @@[m [mAlthough `window.open` is in the global scope, InAppBrowser is not available unt[m
         console.log("window.open works well");[m
     }[m
 [m
[31m-Report issues with this plugin on the [Apache Cordova issue tracker](https://issues.apache.org/jira/issues/?jql=project%20%3D%20CB%20AND%20status%20in%20%28Open%2C%20%22In%20Progress%22%2C%20Reopened%29%20AND%20resolution%20%3D%20Unresolved%20AND%20component%20%3D%20%22Plugin%20InAppBrowser%22%20ORDER%20BY%20priority%20DESC%2C%20summary%20ASC%2C%20updatedDate%20DESC)[m
[32m+[m[32mReport issues with this plugin on the [Apache Cordova issue tracker](https://issues.apache.org/jira/issues/?jql=project%20%3D%20CB%20AND%20status%20in%20%28Open%2C%20%22In%20Progress%22%2C%20Reopened%29%20AND%20resolution%20%3D%20Unresolved%20AND%20component%20%3D%20%22cordova-plugin-inappbrowser%22%20ORDER%20BY%20priority%20DESC%2C%20summary%20ASC%2C%20updatedDate%20DESC)[m
 [m
 [m
 ## <a id="reference">Reference</a>[m
[36m@@ -101,29 +101,47 @@[m [minstance, or the system browser.[m
 [m
 - __options__: Options for the `InAppBrowser`. Optional, defaulting to: `location=yes`. _(String)_[m
 [m
[31m-    The `options` string must not contain any blank space, and each feature's name/value pairs must be separated by a comma. Feature names are case insensitive. All platforms support the value below:[m
[32m+[m[32m    The `options` string must not contain any blank space, and each feature's name/value pairs must be separated by a comma. Feature names are case insensitive.[m
[32m+[m
[32m+[m[32m    All platforms support:[m
 [m
     - __location__: Set to `yes` or `no` to turn the `InAppBrowser`'s location bar on or off.[m
 [m
[31m-    Android only:[m
[32m+[m[32m    Android supports these additional options:[m
 [m
     - __hidden__: set to `yes` to create the browser and load the page, but not show it. The loadstop event fires when loading is complete. Omit or set to `no` (default) to have the browser open and load normally.[m
     - __clearcache__: set to `yes` to have the browser's cookie cache cleared before the new window is opened[m
     - __clearsessioncache__: set to `yes` to have the session cookie cache cleared before the new window is opened[m
[31m-    - __zoom__: set to `yes` to show Android browser's zoom controls, set to `no` to hide them.  Default value is `yes`.[m
[32m+[m[32m    - __closebuttoncaption__: set to a string to use as the close button's caption instead of a X. Note that you need to localize this value yourself.[m
[32m+[m[32m    - __closebuttoncolor__: set to a valid hex color string, for example: `#00ff00`, and it will change the[m
[32m+[m[32m    close button color from default, regardless of being a text or default X. Only has effect if user has location set to `yes`.[m
[32m+[m[32m    - __footer__: set to `yes` to show a close button in the footer similar to the iOS __Done__ button.[m[41m [m
[32m+[m[32m    The close button will appear the same as for the header hence use __closebuttoncaption__ and __closebuttoncolor__ to set its properties.[m
[32m+[m[32m    - __footercolor__: set to a valid hex color string, for example `#00ff00` or `#CC00ff00` (`#aarrggbb`) , and it will change the footer color from default.[m
[32m+[m[32m    Only has effect if user has __footer__ set to `yes`.[m
     - __hardwareback__: set to `yes` to use the hardware back button to navigate backwards through the `InAppBrowser`'s history. If there is no previous page, the `InAppBrowser` will close.  The default value is `yes`, so you must set it to `no` if you want the back button to simply close the InAppBrowser.[m
[32m+[m[32m    - __hidenavigationbuttons__: set to `yes` to hide the navigation buttons on the location toolbar, only has effect if user has location set to `yes`. The default value is `no`.[m
[32m+[m[32m    - __hideurlbar__: set to `yes` to hide the url bar on the location toolbar, only has effect if user has location set to `yes`. The default value is `no`.[m
[32m+[m[32m    - __navigationbuttoncolor__: set to a valid hex color string, for example: `#00ff00`, and it will change the color of both navigation buttons from default. Only has effect if user has location set to `yes` and not hidenavigationbuttons set to `yes`.[m
[32m+[m[32m    - __toolbarcolor__: set to a valid hex color string, for example: `#00ff00`, and it will change the color the toolbar from default. Only has effect if user has location set to `yes`.[m
[32m+[m[32m    - __zoom__: set to `yes` to show Android browser's zoom controls, set to `no` to hide them.  Default value is `yes`.[m
     - __mediaPlaybackRequiresUserAction__: Set to `yes` to prevent HTML5 audio or video from autoplaying (defaults to `no`).[m
     - __shouldPauseOnSuspend__: Set to `yes` to make InAppBrowser WebView to pause/resume with the app to stop background audio (this may be required to avoid Google Play issues like described in [CB-11013](https://issues.apache.org/jira/browse/CB-11013)).[m
     - __useWideViewPort__: Sets whether the WebView should enable support for the "viewport" HTML meta tag or should use a wide viewport. When the value of the setting is `no`, the layout width is always set to the width of the WebView control in device-independent (CSS) pixels. When the value is `yes` and the page contains the viewport meta tag, the value of the width specified in the tag is used. If the page does not contain the tag or does not provide a width, then a wide viewport will be used. (defaults to `yes`).[m
 [m
[31m-    iOS only:[m
[32m+[m[32m    iOS supports these additional options:[m
 [m
[31m-    - __closebuttoncaption__: set to a string to use as the __Done__ button's caption. Note that you need to localize this value yourself.[m
[31m-    - __disallowoverscroll__: Set to `yes` or `no` (default is `no`). Turns on/off the UIWebViewBounce property.[m
     - __hidden__: set to `yes` to create the browser and load the page, but not show it. The loadstop event fires when loading is complete. Omit or set to `no` (default) to have the browser open and load normally.[m
     - __clearcache__: set to `yes` to have the browser's cookie cache cleared before the new window is opened[m
[31m-    - __clearsessioncache__: set to `yes` to have the session cookie cache cleared before the new window is opened[m
[32m+[m[32m    - __clearsessioncache__: set to `yes` to have the session cookie cache cleared before the new window is opened[m[41m    [m
[32m+[m[32m    - __closebuttoncolor__: set as a valid hex color string, for example: `#00ff00`, to change from the default __Done__ button's color. Only applicable if toolbar is not disabled.[m
[32m+[m[32m    - __closebuttoncaption__: set to a string to use as the __Done__ button's caption. Note that you need to localize this value yourself.[m
[32m+[m[32m    - __disallowoverscroll__: Set to `yes` or `no` (default is `no`). Turns on/off the UIWebViewBounce property.[m
[32m+[m[32m    - __hidenavigationbuttons__:  set to `yes` or `no` to turn the toolbar navigation buttons on or off (defaults to `no`). Only applicable if toolbar is not disabled.[m
[32m+[m[32m    - __navigationbuttoncolor__:  set as a valid hex color string, for example: `#00ff00`, to change from the default color. Only applicable if navigation buttons are visible.[m
     - __toolbar__:  set to `yes` or `no` to turn the toolbar on or off for the InAppBrowser (defaults to `yes`)[m
[32m+[m[32m    - __toolbarcolor__: set as a valid hex color string, for example: `#00ff00`, to change from the default color of the toolbar. Only applicable if toolbar is not disabled.[m
[32m+[m[32m    - __toolbartranslucent__:  set to `yes` or `no` to make the toolbar translucent(semi-transparent)  (defaults to `yes`). Only applicable if toolbar is not disabled.[m
     - __enableViewportScale__:  Set to `yes` or `no` to prevent viewport scaling through a meta tag (defaults to `no`).[m
     - __mediaPlaybackRequiresUserAction__: Set to `yes` to prevent HTML5 audio or video from autoplaying (defaults to `no`).[m
     - __allowInlineMediaPlayback__: Set to `yes` or `no` to allow in-line HTML5 media playback, displaying within the browser window rather than a device-specific playback interface. The HTML's `video` element must also include the `webkit-playsinline` attribute (defaults to `no`)[m
[36m@@ -132,75 +150,34 @@[m [minstance, or the system browser.[m
     - __presentationstyle__:  Set to `pagesheet`, `formsheet` or `fullscreen` to set the [presentation style](http://developer.apple.com/library/ios/documentation/UIKit/Reference/UIViewController_Class/Reference/Reference.html#//apple_ref/occ/instp/UIViewController/modalPresentationStyle) (defaults to `fullscreen`).[m
     - __transitionstyle__: Set to `fliphorizontal`, `crossdissolve` or `coververtical` to set the [transition style](http://developer.apple.com/library/ios/#documentation/UIKit/Reference/UIViewController_Class/Reference/Reference.html#//apple_ref/occ/instp/UIViewController/modalTransitionStyle) (defaults to `coververtical`).[m
     - __toolbarposition__: Set to `top` or `bottom` (default is `bottom`). Causes the toolbar to be at the top or bottom of the window.[m
[32m+[m[32m    - __hidespinner__: Set to `yes` or `no` to change the visibility of the loading indicator (defaults to `no`).[m
 [m
[31m-    Windows only:[m
[32m+[m[32m    Windows supports these additional options:[m
 [m
     - __hidden__: set to `yes` to create the browser and load the page, but not show it. The loadstop event fires when loading is complete. Omit or set to `no` (default) to have the browser open and load normally.[m
[31m-    - __fullscreen__: set to `yes` to create the browser control without a border around it. Please note that if __location=no__ is also specified, there will be no control presented to user to close IAB window.[m
     - __hardwareback__: works the same way as on Android platform.[m
[32m+[m[32m    - __fullscreen__: set to `yes` to create the browser control without a border around it. Please note that if __location=no__ is also specified, there will be no control presented to user to close IAB window.[m
[32m+[m
 [m
 ### Supported Platforms[m
 [m
[31m-- Amazon Fire OS[m
 - Android[m
[31m-- BlackBerry 10[m
[31m-- Firefox OS[m
[32m+[m[32m- Browser[m
 - iOS[m
 - OSX[m
[31m-- Windows 8 and 8.1[m
[31m-- Windows Phone 7 and 8[m
[31m-- Browser[m
[32m+[m[32m- Windows[m
 [m
 ### Example[m
 [m
     var ref = cordova.InAppBrowser.open('http://apache.org', '_blank', 'location=yes');[m
     var ref2 = cordova.InAppBrowser.open(encodeURI('http://ja.m.wikipedia.org/wiki/ハングル'), '_blank', 'location=yes');[m
 [m
[31m-### Firefox OS Quirks[m
[31m-[m
[31m-As plugin doesn't enforce any design there is a need to add some CSS rules if[m
[31m-opened with `target='_blank'`. The rules might look like these[m
[31m-[m
[31m-``` css[m
[31m-.inAppBrowserWrap {[m
[31m-  background-color: rgba(0,0,0,0.75);[m
[31m-  color: rgba(235,235,235,1.0);[m
[31m-}[m
[31m-.inAppBrowserWrap menu {[m
[31m-  overflow: auto;[m
[31m-  list-style-type: none;[m
[31m-  padding-left: 0;[m
[31m-}[m
[31m-.inAppBrowserWrap menu li {[m
[31m-  font-size: 25px;[m
[31m-  height: 25px;[m
[31m-  float: left;[m
[31m-  margin: 0 10px;[m
[31m-  padding: 3px 10px;[m
[31m-  text-decoration: none;[m
[31m-  color: #ccc;[m
[31m-  display: block;[m
[31m-  background: rgba(30,30,30,0.50);[m
[31m-}[m
[31m-.inAppBrowserWrap menu li.disabled {[m
[31m-	color: #777;[m
[31m-}[m
[31m-```[m
[31m-[m
 ### OSX Quirks[m
 [m
 At the moment the only supported target in OSX is `_system`.[m
 [m
 `_blank` and `_self` targets are not yet implemented and are ignored silently. Pull requests and patches to get these to work are greatly appreciated.[m
 [m
[31m-### Windows Quirks[m
[31m-[m
[31m-Windows 8.0, 8.1 and Windows Phone 8.1 don't support remote urls to be opened in the Cordova WebView so remote urls are always showed in the system's web browser if opened with `target='_self'`.[m
[31m-[m
[31m-On Windows 10 if the URL is NOT in the white list and is opened with `target='_self'` it will be showed in the system's web browser instead of InAppBrowser popup.[m
[31m-[m
[31m-Similar to Firefox OS IAB window visual behaviour can be overridden via `inAppBrowserWrap`/`inAppBrowserWrapFullscreen` CSS classes[m
[31m-[m
 ### Browser Quirks[m
 [m
 - Plugin is implemented via iframe,[m
[36m@@ -321,12 +298,11 @@[m [mfunction executeScriptCallBack(params) {[m
 [m
 ### Supported Platforms[m
 [m
[31m-- Amazon Fire OS[m
 - Android[m
[31m-- iOS[m
[31m-- Windows 8 and 8.1[m
[31m-- Windows Phone 7 and 8[m
 - Browser[m
[32m+[m[32m- iOS[m
[32m+[m[32m- Windows[m
[32m+[m[32m- OSX[m
 [m
 ### Browser Quirks[m
 [m
[36m@@ -357,12 +333,10 @@[m [mThe function is passed an `InAppBrowserEvent` object.[m
 [m
 ### Supported Platforms[m
 [m
[31m-- Amazon Fire OS[m
 - Android[m
[31m-- iOS[m
[31m-- Windows 8 and 8.1[m
[31m-- Windows Phone 7 and 8[m
 - Browser[m
[32m+[m[32m- iOS[m
[32m+[m[32m- Windows[m
 [m
 ### Quick Example[m
 [m
[36m@@ -381,13 +355,10 @@[m [mThe function is passed an `InAppBrowserEvent` object.[m
 [m
 ### Supported Platforms[m
 [m
[31m-- Amazon Fire OS[m
 - Android[m
[31m-- Firefox OS[m
[31m-- iOS[m
[31m-- Windows 8 and 8.1[m
[31m-- Windows Phone 7 and 8[m
 - Browser[m
[32m+[m[32m- iOS[m
[32m+[m[32m- Windows[m
 [m
 ### Quick Example[m
 [m
[36m@@ -404,11 +375,10 @@[m [mThe function is passed an `InAppBrowserEvent` object.[m
 [m
 ### Supported Platforms[m
 [m
[31m-- Amazon Fire OS[m
 - Android[m
[31m-- iOS[m
[31m-- Windows 8 and 8.1[m
 - Browser[m
[32m+[m[32m- iOS[m
[32m+[m[32m- Windows[m
 [m
 ### Quick Example[m
 [m
[36m@@ -426,10 +396,9 @@[m [mThe function is passed an `InAppBrowserEvent` object.[m
 [m
 ### Supported Platforms[m
 [m
[31m-- Amazon Fire OS[m
 - Android[m
 - iOS[m
[31m-- Windows 8 and 8.1[m
[32m+[m[32m- Windows[m
 [m
 ### Quick Example[m
 [m
[36m@@ -458,11 +427,10 @@[m [mThe function is passed an `InAppBrowserEvent` object.[m
 [m
 ### Supported Platforms[m
 [m
[31m-- Amazon Fire OS[m
 - Android[m
[31m-- iOS[m
[31m-- Windows 8 and 8.1[m
 - Browser[m
[32m+[m[32m- iOS[m
[32m+[m[32m- Windows[m
 [m
 ### Quick Example[m
 [m
[36m@@ -495,7 +463,6 @@[m [mDue to [MSDN docs](https://msdn.microsoft.com/en-us/library/windows.ui.xaml.cont[m
 [m
 ### Supported Platforms[m
 [m
[31m-- Amazon Fire OS[m
 - Android[m
 - iOS[m
 - Windows[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/RELEASENOTES.md b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/RELEASENOTES.md[m
[1mindex 4d86be2..6a06956 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/RELEASENOTES.md[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/RELEASENOTES.md[m
[36m@@ -20,6 +20,56 @@[m
 -->[m
 # Release Notes[m
 [m
[32m+[m[32m### 3.0.0 (Apr 12, 2018)[m
[32m+[m[32m* [CB-13659](https://issues.apache.org/jira/browse/CB-13659) **iOS** Add hidespinner option[m
[32m+[m[32m* In file `AppBrowser.java`: New code within `shouldOverrideUrlLoading()` to check for whitelisting custom schemes via a new `AllowedSchemes` preference configuration item.  Allows custom schemes like `mycoolapp://` or `wevotetwitterscheme://`[m
[32m+[m[32m* `InAppBrowser.java`: New method `isURLWhileListed` to check for whitelisting of `AllowedSchemes` in a new preference configuration item. There is a new check in `shouldOverrideUrlLoading`, to allow whitelisted custom schemes like "mycoolapp://"[m
[32m+[m[32m* Add customisation of the navigation buttons for **iOS**[m
[32m+[m[32m* Fix navigation buttons on **iOS**[m
[32m+[m
[32m+[m[32m### 2.0.2 (Jan 24, 2018)[m
[32m+[m[32m* [CB-13791](https://issues.apache.org/jira/browse/CB-13791) Add **Android** support for a footer close button[m
[32m+[m[32m* [CB-13409](https://issues.apache.org/jira/browse/CB-13409) restore gitignore to default[m
[32m+[m[32m* [CB-13409](https://issues.apache.org/jira/browse/CB-13409) restore gitignore to default[m
[32m+[m[32m* [CB-13409](https://issues.apache.org/jira/browse/CB-13409) restore gitignore to default[m
[32m+[m[32m* [CB-13409](https://issues.apache.org/jira/browse/CB-13409) restore gitignore to default[m
[32m+[m[32m* [CB-13409](https://issues.apache.org/jira/browse/CB-13409) ignore idea folder[m
[32m+[m[32m* [CB-13409](https://issues.apache.org/jira/browse/CB-13409) change hidetoolbarnavigationbuttons to hidenavigationbuttons in iso[m
[32m+[m[32m* [CB-13409](https://issues.apache.org/jira/browse/CB-13409) **Android** works well now, all changes are now documented[m
[32m+[m[32m* [CB-13409](https://issues.apache.org/jira/browse/CB-13409) Lets user adjust color of toolbar, hide navigation buttons and set custom text on close button[m
[32m+[m[32m* [CB-13746](https://issues.apache.org/jira/browse/CB-13746) Add build-tools-26.0.2 to travis[m
[32m+[m
[32m+[m[32m### 2.0.1 (Dec 27, 2017)[m
[32m+[m[32m* [CB-13699](https://issues.apache.org/jira/browse/CB-13699) Fix to allow 2.0.0 version install[m
[32m+[m
[32m+[m[32m### 2.0.0 (Dec 15, 2017)[m
[32m+[m[32m* [CB-13662](https://issues.apache.org/jira/browse/CB-13662) remove deprecated platforms[m
[32m+[m
[32m+[m[32m### 1.7.2 (Nov 06, 2017)[m
[32m+[m[32m* [CB-13473](https://issues.apache.org/jira/browse/CB-13473) (CI) Removed **Browser** builds from AppVeyor[m
[32m+[m[32m* [CB-13472](https://issues.apache.org/jira/browse/CB-13472) (CI) Fixed Travis **Android** builds again[m
[32m+[m[32m* [CB-13347](https://issues.apache.org/jira/browse/CB-13347) Enable thirdparty cookies on `>=Android 5.0` device[m
[32m+[m[32m* [CB-12895](https://issues.apache.org/jira/browse/CB-12895) added `eslint` and removed `jshint`[m
[32m+[m[32m* [CB-12975](https://issues.apache.org/jira/browse/CB-12975) (docs) Resort and reword `cordova.InAppBrowser.open` `options` lists[m
[32m+[m[32m* [CB-12586](https://issues.apache.org/jira/browse/CB-12586) (iOS) fix method `hide` doesn't work[m
[32m+[m[32m* [CB-12847](https://issues.apache.org/jira/browse/CB-12847) added `bugs` entry to `package.json`.[m
[32m+[m
[32m+[m[32m### 1.7.1 (Apr 27, 2017)[m
[32m+[m[32m* [CB-12622](https://issues.apache.org/jira/browse/CB-12622) Added **Android 6.0** build badges to `README`[m
[32m+[m[32m* [CB-12266](https://issues.apache.org/jira/browse/CB-12266) (browser platform) loadstop event.url is now a string instead of an object, aligning it with the other platforms.[m
[32m+[m[32m* [CB-12685](https://issues.apache.org/jira/browse/CB-12685) added `package.json` to tests folder[m
[32m+[m[32m* [CB-11248](https://issues.apache.org/jira/browse/CB-11248) `InAppBrowser` no focus on input text fields[m
[32m+[m
[32m+[m[32m### 1.7.0 (Feb 28, 2017)[m
[32m+[m[32m* [CB-12366](https://issues.apache.org/jira/browse/CB-12366) **iOS:** Reduce `tmpWindow` level to prevent overlapping statusbar[m
[32m+[m[32m* [CB-12364](https://issues.apache.org/jira/browse/CB-12364) **Windows:** `Inappbrowser` inject file manual tests are not working[m
[32m+[m[32m* [CB-12353](https://issues.apache.org/jira/browse/CB-12353) Corrected merges usage in `plugin.xml`[m
[32m+[m[32m* [CB-12369](https://issues.apache.org/jira/browse/CB-12369) Add plugin typings from `DefinitelyTyped`[m
[32m+[m[32m* [CB-12363](https://issues.apache.org/jira/browse/CB-12363) Added build badges for **iOS 9.3** and **iOS 10.0**[m[41m [m
[32m+[m[32m* [CB-9148](https://issues.apache.org/jira/browse/CB-9148) **Android:** Add Support for `input[type=file]` File Chooser[m
[32m+[m[32m* [CB-11136](https://issues.apache.org/jira/browse/CB-11136) (ios) Fix `InAppBrowser` when closing with `WKWebView`[m
[32m+[m[32m* [CB-10799](https://issues.apache.org/jira/browse/CB-10799) **iOS:** fix toolbar is shown in incorrect position when in-call status bar[m
[32m+[m
 ### 1.6.1 (Dec 14, 2016)[m
 * [CB-12237](https://issues.apache.org/jira/browse/CB-12237) - Update version in package.json to correct 1.6.1-dev[m
 * [CB-12236](https://issues.apache.org/jira/browse/CB-12236) - Fixed RELEASENOTES for cordova-plugin-inappbrowser[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/package.json b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/package.json[m
[1mindex 72e2d22..838468a 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/package.json[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/package.json[m
[36m@@ -1,26 +1,98 @@[m
 {[m
[31m-  "name": "cordova-plugin-inappbrowser",[m
[31m-  "version": "1.6.1",[m
[31m-  "description": "Cordova InAppBrowser Plugin",[m
[32m+[m[32m  "_args": [[m
[32m+[m[32m    [[m
[32m+[m[32m      {[m
[32m+[m[32m        "raw": "cordova-plugin-inappbrowser@3.0.0",[m
[32m+[m[32m        "scope": null,[m
[32m+[m[32m        "escapedName": "cordova-plugin-inappbrowser",[m
[32m+[m[32m        "name": "cordova-plugin-inappbrowser",[m
[32m+[m[32m        "rawSpec": "3.0.0",[m
[32m+[m[32m        "spec": "3.0.0",[m
[32m+[m[32m        "type": "version"[m
[32m+[m[32m      },[m
[32m+[m[32m      "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test"[m
[32m+[m[32m    ][m
[32m+[m[32m  ],[m
[32m+[m[32m  "_from": "cordova-plugin-inappbrowser@3.0.0",[m
[32m+[m[32m  "_hasShrinkwrap": false,[m
[32m+[m[32m  "_id": "cordova-plugin-inappbrowser@3.0.0",[m
[32m+[m[32m  "_inCache": true,[m
[32m+[m[32m  "_location": "/cordova-plugin-inappbrowser",[m
[32m+[m[32m  "_nodeVersion": "6.6.0",[m
[32m+[m[32m  "_npmOperationalInternal": {[m
[32m+[m[32m    "host": "s3://npm-registry-packages",[m
[32m+[m[32m    "tmp": "tmp/cordova-plugin-inappbrowser_3.0.0_1523945138829_0.06720054647621332"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmUser": {[m
[32m+[m[32m    "name": "stevegill",[m
[32m+[m[32m    "email": "stevengill97@gmail.com"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmVersion": "3.10.10",[m
[32m+[m[32m  "_phantomChildren": {},[m
[32m+[m[32m  "_requested": {[m
[32m+[m[32m    "raw": "cordova-plugin-inappbrowser@3.0.0",[m
[32m+[m[32m    "scope": null,[m
[32m+[m[32m    "escapedName": "cordova-plugin-inappbrowser",[m
[32m+[m[32m    "name": "cordova-plugin-inappbrowser",[m
[32m+[m[32m    "rawSpec": "3.0.0",[m
[32m+[m[32m    "spec": "3.0.0",[m
[32m+[m[32m    "type": "version"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_requiredBy": [[m
[32m+[m[32m    "#USER",[m
[32m+[m[32m    "/"[m
[32m+[m[32m  ],[m
[32m+[m[32m  "_resolved": "https://registry.npmjs.org/cordova-plugin-inappbrowser/-/cordova-plugin-inappbrowser-3.0.0.tgz",[m
[32m+[m[32m  "_shasum": "d4ae00d36676210751057ad258ae4ad4a9161ada",[m
[32m+[m[32m  "_shrinkwrap": null,[m
[32m+[m[32m  "_spec": "cordova-plugin-inappbrowser@3.0.0",[m
[32m+[m[32m  "_where": "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test",[m
[32m+[m[32m  "author": {[m
[32m+[m[32m    "name": "Apache Software Foundation"[m
[32m+[m[32m  },[m
[32m+[m[32m  "bugs": {[m
[32m+[m[32m    "url": "https://issues.apache.org/jira/browse/CB"[m
[32m+[m[32m  },[m
   "cordova": {[m
     "id": "cordova-plugin-inappbrowser",[m
     "platforms": [[m
       "android",[m
[31m-      "amazon-fireos",[m
[31m-      "ubuntu",[m
[32m+[m[32m      "browser",[m
       "ios",[m
       "osx",[m
[31m-      "wp7",[m
[31m-      "wp8",[m
[31m-      "windows8",[m
[31m-      "windows",[m
[31m-      "firefoxos"[m
[32m+[m[32m      "windows"[m
     ][m
   },[m
[31m-  "repository": {[m
[31m-    "type": "git",[m
[31m-    "url": "https://github.com/apache/cordova-plugin-inappbrowser"[m
[32m+[m[32m  "dependencies": {},[m
[32m+[m[32m  "description": "Cordova InAppBrowser Plugin",[m
[32m+[m[32m  "devDependencies": {[m
[32m+[m[32m    "eslint": "^4.0.0",[m
[32m+[m[32m    "eslint-config-semistandard": "^11.0.0",[m
[32m+[m[32m    "eslint-config-standard": "^10.2.1",[m
[32m+[m[32m    "eslint-plugin-import": "^2.3.0",[m
[32m+[m[32m    "eslint-plugin-node": "^5.0.0",[m
[32m+[m[32m    "eslint-plugin-promise": "^3.5.0",[m
[32m+[m[32m    "eslint-plugin-standard": "^3.0.1"[m
[32m+[m[32m  },[m
[32m+[m[32m  "directories": {},[m
[32m+[m[32m  "dist": {[m
[32m+[m[32m    "shasum": "d4ae00d36676210751057ad258ae4ad4a9161ada",[m
[32m+[m[32m    "tarball": "https://registry.npmjs.org/cordova-plugin-inappbrowser/-/cordova-plugin-inappbrowser-3.0.0.tgz",[m
[32m+[m[32m    "fileCount": 63,[m
[32m+[m[32m    "unpackedSize": 603146,[m
[32m+[m[32m    "npm-signature": "-----BEGIN PGP SIGNATURE-----\r\nVersion: OpenPGP.js v3.0.4\r\nComment: https://openpgpjs.org\r\n\r\nwsFcBAEBCAAQBQJa1Y60CRA9TVsSAnZWagAAL4cP/Rl1DVpYXrPtyXC+JRvb\ntyJ9aDPd2dAf04yNUya7SuvgHplV81EOu5CWJvxtinFq5uFWwABcnPr7pmeW\n16R0dxZ0U+WCzN1tEJzWJhZRJi78u8HnflwxvqoAYxeDgtwLLZvcy6SuBgqK\nhayYJYNvkgok95x/sSud3La7IJw5s+CTe6T48J8d18NxqQwBCcRLw7m8+044\na07/2fU9rReNmHwkyYNIbqCCFbU1w324UJP3D+UGSv/cORPJRFTi3YIyGgcY\nET8k4YNqw2GDZEx/oDCvphimrOz7MkhOU7HagEym2vIn2x9d/AnBDBmxO3J9\nKgXyJKLJX8d8lw5WxZuD01G8IbSKqPhRgEU2kp6ogA4j3slex155kG8LCD4N\nBv4NjqEJ8Fs4F3LIu7pkMuKVnaCKYPxE5ZClI8zVyAX9WZxd34Ulm+uhyTRL\nxJN2ORbFQdnvH4esyFosFJiBFYFq07s2CKwAj+ep5SEWXWnwxDjiDK4xm2vY\nDk4mFWYeBz/T1/W8ckLIEP8dr+vnAK/O6sYgNj5LCFl2IF9qfuLmOrKQybtw\no0TTU71OUtT6phJ0HllGcYPqZIWiM+KhEQaZD4izmRIsCPcHgPQisX0AkeBy\nXk+/d4DFq/U9phG5ORMv/GAAeSTaTH9oUcOVfzgUmli8N2wML6ZQXYcbf1Re\nzSEe\r\n=ilrR\r\n-----END PGP SIGNATURE-----\r\n"[m
   },[m
[32m+[m[32m  "engines": {[m
[32m+[m[32m    "cordovaDependencies": {[m
[32m+[m[32m      "0.2.3": {[m
[32m+[m[32m        "cordova": ">=3.1.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "4.0.0": {[m
[32m+[m[32m        "cordova": ">100"[m
[32m+[m[32m      }[m
[32m+[m[32m    }[m
[32m+[m[32m  },[m
[32m+[m[32m  "homepage": "https://github.com/apache/cordova-plugin-inappbrowser#readme",[m
   "keywords": [[m
     "cordova",[m
     "in",[m
[36m@@ -29,33 +101,69 @@[m
     "inappbrowser",[m
     "ecosystem:cordova",[m
     "cordova-android",[m
[31m-    "cordova-amazon-fireos",[m
[31m-    "cordova-ubuntu",[m
[32m+[m[32m    "cordova-browser",[m
     "cordova-ios",[m
     "cordova-osx",[m
[31m-    "cordova-wp7",[m
[31m-    "cordova-wp8",[m
[31m-    "cordova-windows8",[m
[31m-    "cordova-windows",[m
[31m-    "cordova-firefoxos"[m
[32m+[m[32m    "cordova-windows"[m
   ],[m
[31m-  "scripts": {[m
[31m-    "test": "npm run jshint",[m
[31m-    "jshint": "node node_modules/jshint/bin/jshint www && node node_modules/jshint/bin/jshint src && node node_modules/jshint/bin/jshint tests"[m
[31m-  },[m
[31m-  "engines": {[m
[31m-    "cordovaDependencies": {[m
[31m-      "0.2.3": {[m
[31m-        "cordova": ">=3.1.0"[m
[31m-      },[m
[31m-      "2.0.0": {[m
[31m-        "cordova": ">100"[m
[31m-      }[m
[32m+[m[32m  "license": "Apache-2.0",[m
[32m+[m[32m  "maintainers": [[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "bowserj",[m
[32m+[m[32m      "email": "bowserj@apache.org"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "csantanapr",[m
[32m+[m[32m      "email": "csantana23@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "filmaj",[m
[32m+[m[32m      "email": "maj.fil@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "jcesarmobile",[m
[32m+[m[32m      "email": "jcesarmobile@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "kotikov.vladimir",[m
[32m+[m[32m      "email": "kotikov.vladimir@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "macdonst",[m
[32m+[m[32m      "email": "simon.macdonald@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "purplecabbage",[m
[32m+[m[32m      "email": "purplecabbage@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "sgrebnov",[m
[32m+[m[32m      "email": "sergei.grebnov@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "shazron",[m
[32m+[m[32m      "email": "shazron@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "stevegill",[m
[32m+[m[32m      "email": "stevengill97@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "surajpindoria",[m
[32m+[m[32m      "email": "suraj.pindoria@yahoo.com"[m
     }[m
[32m+[m[32m  ],[m
[32m+[m[32m  "name": "cordova-plugin-inappbrowser",[m
[32m+[m[32m  "optionalDependencies": {},[m
[32m+[m[32m  "readme": "ERROR: No README data found!",[m
[32m+[m[32m  "repository": {[m
[32m+[m[32m    "type": "git",[m
[32m+[m[32m    "url": "git+https://github.com/apache/cordova-plugin-inappbrowser.git"[m
   },[m
[31m-  "author": "Apache Software Foundation",[m
[31m-  "license": "Apache-2.0",[m
[31m-  "devDependencies": {[m
[31m-    "jshint": "^2.6.0"[m
[31m-  }[m
[32m+[m[32m  "scripts": {[m
[32m+[m[32m    "eslint": "node node_modules/eslint/bin/eslint www && node node_modules/eslint/bin/eslint src && node node_modules/eslint/bin/eslint tests",[m
[32m+[m[32m    "test": "npm run eslint"[m
[32m+[m[32m  },[m
[32m+[m[32m  "types": "./types/index.d.ts",[m
[32m+[m[32m  "version": "3.0.0"[m
 }[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/plugin.xml b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/plugin.xml[m
[1mindex c4006ce..6d57d9c 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/plugin.xml[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/plugin.xml[m
[36m@@ -20,7 +20,7 @@[m
 [m
 <plugin xmlns="http://apache.org/cordova/ns/plugins/1.0"[m
            id="cordova-plugin-inappbrowser"[m
[31m-      version="1.6.1">[m
[32m+[m[32m      version="3.0.0">[m
 [m
     <name>InAppBrowser</name>[m
     <description>Cordova InAppBrowser Plugin</description>[m
[36m@@ -40,7 +40,7 @@[m
             <clobbers target="window.open" />[m
         </js-module>[m
         <config-file target="res/xml/config.xml" parent="/*">[m
[31m-            <feature name="InAppBrowser"> [m
[32m+[m[32m            <feature name="InAppBrowser">[m
                 <param name="android-package" value="org.apache.cordova.inappbrowser.InAppBrowser"/>[m
             </feature>[m
         </config-file>[m
[36m@@ -67,67 +67,21 @@[m
 [m
     </platform>[m
 [m
[31m-    <!-- amazon-fireos -->[m
[31m-    <platform name="amazon-fireos">[m
[31m-        <js-module src="www/inappbrowser.js" name="inappbrowser">[m
[31m-            <clobbers target="cordova.InAppBrowser.open" />[m
[31m-            <clobbers target="window.open" />[m
[31m-        </js-module>[m
[31m-        <config-file target="res/xml/config.xml" parent="/*">[m
[31m-            <feature name="InAppBrowser"> [m
[31m-                <param name="android-package" value="org.apache.cordova.inappbrowser.InAppBrowser"/>[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <source-file src="src/amazon/InAppBrowser.java" target-dir="src/org/apache/cordova/inappbrowser" />[m
[31m-        <source-file src="src/android/InAppBrowserDialog.java" target-dir="src/org/apache/cordova/inappbrowser" />[m
[31m-        <source-file src="src/amazon/InAppChromeClient.java" target-dir="src/org/apache/cordova/inappbrowser" />[m
[31m-        [m
[31m-        <!--  drawable src/android/resources -->[m
[31m-        <resource-file src="src/android/res/drawable-hdpi/ic_action_next_item.png" target="res/drawable-hdpi/ic_action_next_item.png" />[m
[31m-        <resource-file src="src/android/res/drawable-mdpi/ic_action_next_item.png" target="res/drawable-mdpi/ic_action_next_item.png" />[m
[31m-        <resource-file src="src/android/res/drawable-xhdpi/ic_action_next_item.png" target="res/drawable-xhdpi/ic_action_next_item.png" />[m
[31m-        <resource-file src="src/android/res/drawable-xxhdpi/ic_action_next_item.png" target="res/drawable-xxhdpi/ic_action_next_item.png" />[m
[31m-        [m
[31m-        <resource-file src="src/android/res/drawable-hdpi/ic_action_previous_item.png" target="res/drawable-hdpi/ic_action_previous_item.png" />[m
[31m-        <resource-file src="src/android/res/drawable-mdpi/ic_action_previous_item.png" target="res/drawable-mdpi/ic_action_previous_item.png" />[m
[31m-        <resource-file src="src/android/res/drawable-xhdpi/ic_action_previous_item.png" target="res/drawable-xhdpi/ic_action_previous_item.png" />[m
[31m-        <resource-file src="src/android/res/drawable-xxhdpi/ic_action_previous_item.png" target="res/drawable-xxhdpi/ic_action_previous_item.png" />[m
[31m-        [m
[31m-        <resource-file src="src/android/res/drawable-hdpi/ic_action_remove.png" target="res/drawable-hdpi/ic_action_remove.png" />[m
[31m-        <resource-file src="src/android/res/drawable-mdpi/ic_action_remove.png" target="res/drawable-mdpi/ic_action_remove.png" />[m
[31m-        <resource-file src="src/android/res/drawable-xhdpi/ic_action_remove.png" target="res/drawable-xhdpi/ic_action_remove.png" />[m
[31m-        <resource-file src="src/android/res/drawable-xxhdpi/ic_action_remove.png" target="res/drawable-xxhdpi/ic_action_remove.png" />[m
[31m-    </platform>[m
[31m-    [m
[31m-    <!-- ubuntu -->[m
[31m-    <platform name="ubuntu">[m
[31m-        <js-module src="www/inappbrowser.js" name="inappbrowser">[m
[31m-            <clobbers target="cordova.InAppBrowser.open" />[m
[31m-            <clobbers target="window.open" />[m
[31m-        </js-module>[m
[31m-        <header-file src="src/ubuntu/inappbrowser.h" />[m
[31m-        <source-file src="src/ubuntu/inappbrowser.cpp" />[m
[31m-        <resource-file src="src/ubuntu/InAppBrowser.qml" />[m
[31m-        <resource-file src="src/ubuntu/InAppBrowser_escapeScript.js" />[m
[31m-        <resource-file src="src/ubuntu/close.png" />[m
[31m-    </platform>[m
[31m-[m
     <!-- ios -->[m
     <platform name="ios">[m
         <js-module src="www/inappbrowser.js" name="inappbrowser">[m
             <clobbers target="cordova.InAppBrowser.open" />[m
             <clobbers target="window.open" />[m
[31m-        </js-module>  [m
[32m+[m[32m        </js-module>[m
         <config-file target="config.xml" parent="/*">[m
             <feature name="InAppBrowser">[m
[31m-                <param name="ios-package" value="CDVInAppBrowser" /> [m
[32m+[m[32m                <param name="ios-package" value="CDVInAppBrowser" />[m
             </feature>[m
         </config-file>[m
 [m
         <header-file src="src/ios/CDVInAppBrowser.h" />[m
 	    <source-file src="src/ios/CDVInAppBrowser.m" />[m
[31m-	    [m
[32m+[m
 	    <framework src="CoreGraphics.framework" />[m
     </platform>[m
 [m
[36m@@ -147,63 +101,6 @@[m
         <source-file src="src/osx/CDVInAppBrowser.m" />[m
     </platform>[m
 [m
[31m-    <!-- wp7 -->[m
[31m-    <platform name="wp7">[m
[31m-        <config-file target="Properties/WMAppManifest.xml" parent="/Deployment/App/Capabilities">[m
[31m-            <Capability Name="ID_CAP_NETWORKING"/>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <js-module src="www/inappbrowser.js" name="inappbrowser">[m
[31m-            <clobbers target="cordova.InAppBrowser.open" />[m
[31m-            <clobbers target="window.open" />[m
[31m-        </js-module>[m
[31m-        <config-file target="config.xml" parent="/*">[m
[31m-            <feature name="InAppBrowser">[m
[31m-                <param name="wp-package" value="InAppBrowser"/>[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <config-file target="Properties/WMAppManifest.xml" parent="/Deployment/App/Capabilities">[m
[31m-            <Capability Name="ID_CAP_NETWORKING" />[m
[31m-        </config-file>[m
[31m-[m
[31m-        <source-file src="src/wp/InAppBrowser.cs" />[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- wp8 -->[m
[31m-    <platform name="wp8">[m
[31m-        <config-file target="Properties/WMAppManifest.xml" parent="/Deployment/App/Capabilities">[m
[31m-            <Capability Name="ID_CAP_NETWORKING"/>[m
[31m-        </config-file>[m
[31m-                [m
[31m-        <js-module src="www/inappbrowser.js" name="inappbrowser">[m
[31m-            <clobbers target="cordova.InAppBrowser.open" />[m
[31m-            <clobbers target="window.open" />[m
[31m-        </js-module>[m
[31m-        <config-file target="config.xml" parent="/*">[m
[31m-            <feature name="InAppBrowser">[m
[31m-                <param name="wp-package" value="InAppBrowser"/>[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <config-file target="Properties/WMAppManifest.xml" parent="/Deployment/App/Capabilities">[m
[31m-            <Capability Name="ID_CAP_NETWORKING" />[m
[31m-        </config-file>[m
[31m-[m
[31m-        <source-file src="src/wp/InAppBrowser.cs" />[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- windows8 -->[m
[31m-    <platform name="windows8">[m
[31m-        <js-module src="www/inappbrowser.js" name="inappbrowser">[m
[31m-            <clobbers target="cordova.InAppBrowser.open" />[m
[31m-            <clobbers target="window.open" />[m
[31m-        </js-module>[m
[31m-        <js-module src="www/windows8/InAppBrowserProxy.js" name="InAppBrowserProxy">[m
[31m-            <merges target="" />[m
[31m-        </js-module>[m
[31m-    </platform>[m
[31m-[m
     <!-- windows universal apps (Windows 8.1, Windows Phone 8.1, Windows 8.0) -->[m
     <platform name="windows">[m
         <js-module src="www/inappbrowser.js" name="inappbrowser">[m
[36m@@ -211,24 +108,10 @@[m
             <clobbers target="window.open" />[m
         </js-module>[m
         <js-module src="src/windows/InAppBrowserProxy.js" name="InAppBrowserProxy">[m
[31m-            <merges target="" />[m
[32m+[m[32m            <runs />[m
         </js-module>[m
         <asset src="www/inappbrowser.css" target="css/inappbrowser.css" />[m
     </platform>[m
[31m-  [m
[31m-    <!-- firefoxos -->[m
[31m-    <platform name="firefoxos">[m
[31m-        <config-file target="config.xml" parent="/*">[m
[31m-            <permission name="browser" description="Enables the app to implement a browser in an iframe." privileged="true"/>[m
[31m-        </config-file>[m
[31m-        <js-module src="www/inappbrowser.js" name="inappbrowser">[m
[31m-            <clobbers target="cordova.InAppBrowser.open" />[m
[31m-            <clobbers target="window.open" />[m
[31m-        </js-module>[m
[31m-        <js-module src="src/firefoxos/InAppBrowserProxy.js" name="InAppBrowserProxy">[m
[31m-            <merges target="" />[m
[31m-        </js-module>[m
[31m-    </platform>[m
 [m
     <!-- browser -->[m
     <platform name="browser">[m
[36m@@ -237,7 +120,7 @@[m
             <clobbers target="window.open" />[m
         </js-module>[m
         <js-module src="src/browser/InAppBrowserProxy.js" name="InAppBrowserProxy">[m
[31m-            <merges target="" />[m
[32m+[m[32m            <runs />[m
         </js-module>[m
     </platform>[m
 </plugin>[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/amazon/InAppBrowser.java b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/amazon/InAppBrowser.java[m
[1mdeleted file mode 100644[m
[1mindex c5d6f66..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/amazon/InAppBrowser.java[m
[1m+++ /dev/null[m
[36m@@ -1,879 +0,0 @@[m
[31m-/*[m
[31m-       Licensed to the Apache Software Foundation (ASF) under one[m
[31m-       or more contributor license agreements.  See the NOTICE file[m
[31m-       distributed with this work for additional information[m
[31m-       regarding copyright ownership.  The ASF licenses this file[m
[31m-       to you under the Apache License, Version 2.0 (the[m
[31m-       "License"); you may not use this file except in compliance[m
[31m-       with the License.  You may obtain a copy of the License at[m
[31m-[m
[31m-         http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-       Unless required by applicable law or agreed to in writing,[m
[31m-       software distributed under the License is distributed on an[m
[31m-       "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-       KIND, either express or implied.  See the License for the[m
[31m-       specific language governing permissions and limitations[m
[31m-       under the License.[m
[31m-*/[m
[31m-package org.apache.cordova.inappbrowser;[m
[31m-[m
[31m-import android.annotation.SuppressLint;[m
[31m-import org.apache.cordova.inappbrowser.InAppBrowserDialog;[m
[31m-import android.content.Context;[m
[31m-import android.content.DialogInterface;[m
[31m-import android.content.Intent;[m
[31m-import android.content.res.Resources;[m
[31m-import android.graphics.Bitmap;[m
[31m-import android.graphics.drawable.Drawable;[m
[31m-import android.net.Uri;[m
[31m-import android.os.Build;[m
[31m-import android.os.Bundle;[m
[31m-import android.text.InputType;[m
[31m-import android.util.Log;[m
[31m-import android.util.TypedValue;[m
[31m-import android.view.Gravity;[m
[31m-import android.view.KeyEvent;[m
[31m-import android.view.View;[m
[31m-import android.view.Window;[m
[31m-import android.view.WindowManager;[m
[31m-import android.view.WindowManager.LayoutParams;[m
[31m-import android.view.inputmethod.EditorInfo;[m
[31m-import android.view.inputmethod.InputMethodManager;[m
[31m-import com.amazon.android.webkit.AmazonWebChromeClient;[m
[31m-import com.amazon.android.webkit.AmazonGeolocationPermissions.Callback;[m
[31m-import com.amazon.android.webkit.AmazonJsPromptResult;[m
[31m-import com.amazon.android.webkit.AmazonWebSettings;[m
[31m-import com.amazon.android.webkit.AmazonWebStorage;[m
[31m-import com.amazon.android.webkit.AmazonWebView;[m
[31m-import com.amazon.android.webkit.AmazonWebViewClient;[m
[31m-import com.amazon.android.webkit.AmazonCookieManager;[m
[31m-import android.widget.Button;[m
[31m-import android.widget.EditText;[m
[31m-import android.widget.LinearLayout;[m
[31m-import android.widget.RelativeLayout;[m
[31m-[m
[31m-import org.apache.cordova.CallbackContext;[m
[31m-import org.apache.cordova.Config;[m
[31m-import org.apache.cordova.CordovaArgs;[m
[31m-import org.apache.cordova.CordovaPlugin;[m
[31m-import org.apache.cordova.CordovaWebView;[m
[31m-import org.apache.cordova.LOG;[m
[31m-import org.apache.cordova.PluginResult;[m
[31m-import org.apache.cordova.CordovaActivity;[m
[31m-import org.json.JSONException;[m
[31m-import org.json.JSONObject;[m
[31m-[m
[31m-import java.util.HashMap;[m
[31m-import java.util.StringTokenizer;[m
[31m-[m
[31m-@SuppressLint("SetJavaScriptEnabled")[m
[31m-public class InAppBrowser extends CordovaPlugin {[m
[31m-[m
[31m-    private static final String NULL = "null";[m
[31m-    protected static final String LOG_TAG = "InAppBrowser";[m
[31m-    private static final String SELF = "_self";[m
[31m-    private static final String SYSTEM = "_system";[m
[31m-    // private static final String BLANK = "_blank";[m
[31m-    private static final String EXIT_EVENT = "exit";[m
[31m-    private static final String LOCATION = "location";[m
[31m-    private static final String HIDDEN = "hidden";[m
[31m-    private static final String ZOOM = "zoom";[m
[31m-    private static final String LOAD_START_EVENT = "loadstart";[m
[31m-    private static final String LOAD_STOP_EVENT = "loadstop";[m
[31m-    private static final String LOAD_ERROR_EVENT = "loaderror";[m
[31m-    private static final String CLEAR_ALL_CACHE = "clearcache";[m
[31m-    private static final String CLEAR_SESSION_CACHE = "clearsessioncache";[m
[31m-    private static final String HARDWARE_BACK_BUTTON = "hardwareback";[m
[31m-[m
[31m-    private InAppBrowserDialog dialog;[m
[31m-    private AmazonWebView inAppWebView;[m
[31m-    private EditText edittext;[m
[31m-    private CallbackContext callbackContext;[m
[31m-    private boolean showLocationBar = true;[m
[31m-    private boolean showZoomControls = true;[m
[31m-    private boolean openWindowHidden = false;[m
[31m-    private boolean clearAllCache= false;[m
[31m-    private boolean clearSessionCache=false;[m
[31m-    private boolean hadwareBackButton=true;[m
[31m-[m
[31m-    /**[m
[31m-     * Executes the request and returns PluginResult.[m
[31m-     *[m
[31m-     * @param action        The action to execute.[m
[31m-     * @param args          JSONArry of arguments for the plugin.[m
[31m-     * @param callbackId    The callback id used when calling back into JavaScript.[m
[31m-     * @return              A PluginResult object with a status and message.[m
[31m-     */[m
[31m-    public boolean execute(String action, CordovaArgs args, final CallbackContext callbackContext) throws JSONException {[m
[31m-        if (action.equals("open")) {[m
[31m-            this.callbackContext = callbackContext;[m
[31m-            final String url = args.getString(0);[m
[31m-            String t = args.optString(1);[m
[31m-            if (t == null || t.equals("") || t.equals(NULL)) {[m
[31m-                t = SELF;[m
[31m-            }[m
[31m-            final String target = t;[m
[31m-            final HashMap<String, Boolean> features = parseFeature(args.optString(2));[m
[31m-            [m
[31m-            Log.d(LOG_TAG, "target = " + target);[m
[31m-            [m
[31m-            this.cordova.getActivity().runOnUiThread(new Runnable() {[m
[31m-                @Override[m
[31m-                public void run() {[m
[31m-                    String result = "";[m
[31m-                    // SELF[m
[31m-                    if (SELF.equals(target)) {[m
[31m-                        Log.d(LOG_TAG, "in self");[m
[31m-                        // load in webview[m
[31m-                        if (url.startsWith("file://") || url.startsWith("javascript:") [m
[31m-                                || Config.isUrlWhiteListed(url)) {[m
[31m-                            Log.d(LOG_TAG, "loading in webview");[m
[31m-                            webView.loadUrl(url);[m
[31m-                        }[m
[31m-                        //Load the dialer[m
[31m-                        else if (url.startsWith(AmazonWebView.SCHEME_TEL))[m
[31m-                        {[m
[31m-                            try {[m
[31m-                                Log.d(LOG_TAG, "loading in dialer");[m
[31m-                                Intent intent = new Intent(Intent.ACTION_DIAL);[m
[31m-                                intent.setData(Uri.parse(url));[m
[31m-                                cordova.getActivity().startActivity(intent);[m
[31m-                            } catch (android.content.ActivityNotFoundException e) {[m
[31m-                                LOG.e(LOG_TAG, "Error dialing " + url + ": " + e.toString());[m
[31m-                            }[m
[31m-                        }[m
[31m-                        // load in InAppBrowser[m
[31m-                        else {[m
[31m-                            Log.d(LOG_TAG, "loading in InAppBrowser");[m
[31m-                            result = showWebPage(url, features);[m
[31m-                        }[m
[31m-                    }[m
[31m-                    // SYSTEM[m
[31m-                    else if (SYSTEM.equals(target)) {[m
[31m-                        Log.d(LOG_TAG, "in system");[m
[31m-                        result = openExternal(url);[m
[31m-                    }[m
[31m-                    // BLANK - or anything else[m
[31m-                    else {[m
[31m-                        Log.d(LOG_TAG, "in blank");[m
[31m-                        result = showWebPage(url, features);[m
[31m-                    }[m
[31m-    [m
[31m-                    PluginResult pluginResult = new PluginResult(PluginResult.Status.OK, result);[m
[31m-                    pluginResult.setKeepCallback(true);[m
[31m-                    callbackContext.sendPluginResult(pluginResult);[m
[31m-                }[m
[31m-            });[m
[31m-        }[m
[31m-        else if (action.equals("close")) {[m
[31m-            closeDialog();[m
[31m-        }[m
[31m-        else if (action.equals("injectScriptCode")) {[m
[31m-            String jsWrapper = null;[m
[31m-            if (args.getBoolean(1)) {[m
[31m-                jsWrapper = String.format("prompt(JSON.stringify([eval(%%s)]), 'gap-iab://%s')", callbackContext.getCallbackId());[m
[31m-            }[m
[31m-            injectDeferredObject(args.getString(0), jsWrapper);[m
[31m-        }[m
[31m-        else if (action.equals("injectScriptFile")) {[m
[31m-            String jsWrapper;[m
[31m-            if (args.getBoolean(1)) {[m
[31m-                jsWrapper = String.format("(function(d) { var c = d.createElement('script'); c.src = %%s; c.onload = function() { prompt('', 'gap-iab://%s'); }; d.body.appendChild(c); })(document)", callbackContext.getCallbackId());[m
[31m-            } else {[m
[31m-                jsWrapper = "(function(d) { var c = d.createElement('script'); c.src = %s; d.body.appendChild(c); })(document)";[m
[31m-            }[m
[31m-            injectDeferredObject(args.getString(0), jsWrapper);[m
[31m-        }[m
[31m-        else if (action.equals("injectStyleCode")) {[m
[31m-            String jsWrapper;[m
[31m-            if (args.getBoolean(1)) {[m
[31m-                jsWrapper = String.format("(function(d) { var c = d.createElement('style'); c.innerHTML = %%s; d.body.appendChild(c); prompt('', 'gap-iab://%s');})(document)", callbackContext.getCallbackId());[m
[31m-            } else {[m
[31m-                jsWrapper = "(function(d) { var c = d.createElement('style'); c.innerHTML = %s; d.body.appendChild(c); })(document)";[m
[31m-            }[m
[31m-            injectDeferredObject(args.getString(0), jsWrapper);[m
[31m-        }[m
[31m-        else if (action.equals("injectStyleFile")) {[m
[31m-            String jsWrapper;[m
[31m-            if (args.getBoolean(1)) {[m
[31m-                jsWrapper = String.format("(function(d) { var c = d.createElement('link'); c.rel='stylesheet'; c.type='text/css'; c.href = %%s; d.head.appendChild(c); prompt('', 'gap-iab://%s');})(document)", callbackContext.getCallbackId());[m
[31m-            } else {[m
[31m-                jsWrapper = "(function(d) { var c = d.createElement('link'); c.rel='stylesheet'; c.type='text/css'; c.href = %s; d.head.appendChild(c); })(document)";[m
[31m-            }[m
[31m-            injectDeferredObject(args.getString(0), jsWrapper);[m
[31m-        }[m
[31m-        else if (action.equals("show")) {[m
[31m-            this.cordova.getActivity().runOnUiThread(new Runnable() {[m
[31m-                @Override[m
[31m-                public void run() {[m
[31m-                    dialog.show();[m
[31m-                }[m
[31m-            });[m
[31m-            PluginResult pluginResult = new PluginResult(PluginResult.Status.OK);[m
[31m-            pluginResult.setKeepCallback(true);[m
[31m-            this.callbackContext.sendPluginResult(pluginResult);[m
[31m-        }[m
[31m-        else if (action.equals("hide")) {[m
[31m-            this.cordova.getActivity().runOnUiThread(new Runnable() {[m
[31m-                @Override[m
[31m-                public void run() {[m
[31m-                    dialog.hide();[m
[31m-                }[m
[31m-            });[m
[31m-            PluginResult pluginResult = new PluginResult(PluginResult.Status.OK);[m
[31m-            pluginResult.setKeepCallback(true);[m
[31m-            this.callbackContext.sendPluginResult(pluginResult);[m
[31m-        }[m
[31m-        else {[m
[31m-            return false;[m
[31m-        }[m
[31m-        return true;[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Called when the view navigates.[m
[31m-     */[m
[31m-    @Override[m
[31m-    public void onReset() {[m
[31m-        closeDialog();        [m
[31m-    }[m
[31m-    [m
[31m-    /**[m
[31m-     * Called by AccelBroker when listener is to be shut down.[m
[31m-     * Stop listener.[m
[31m-     */[m
[31m-    public void onDestroy() {[m
[31m-        closeDialog();[m
[31m-    }[m
[31m-    [m
[31m-    /**[m
[31m-     * Inject an object (script or style) into the InAppBrowser AmazonWebView.[m
[31m-     *[m
[31m-     * This is a helper method for the inject{Script|Style}{Code|File} API calls, which[m
[31m-     * provides a consistent method for injecting JavaScript code into the document.[m
[31m-     *[m
[31m-     * If a wrapper string is supplied, then the source string will be JSON-encoded (adding[m
[31m-     * quotes) and wrapped using string formatting. (The wrapper string should have a single[m
[31m-     * '%s' marker)[m
[31m-     *[m
[31m-     * @param source      The source object (filename or script/style text) to inject into[m
[31m-     *                    the document.[m
[31m-     * @param jsWrapper   A JavaScript string to wrap the source string in, so that the object[m
[31m-     *                    is properly injected, or null if the source string is JavaScript text[m
[31m-     *                    which should be executed directly.[m
[31m-     */[m
[31m-    private void injectDeferredObject(String source, String jsWrapper) {[m
[31m-        final String scriptToInject;[m
[31m-        if (jsWrapper != null) {[m
[31m-            org.json.JSONArray jsonEsc = new org.json.JSONArray();[m
[31m-            jsonEsc.put(source);[m
[31m-            String jsonRepr = jsonEsc.toString();[m
[31m-            String jsonSourceString = jsonRepr.substring(1, jsonRepr.length()-1);[m
[31m-            scriptToInject = String.format(jsWrapper, jsonSourceString);[m
[31m-        } else {[m
[31m-            scriptToInject = source;[m
[31m-        }[m
[31m-        final String finalScriptToInject = scriptToInject;[m
[31m-        this.cordova.getActivity().runOnUiThread(new Runnable() {[m
[31m-            @SuppressLint("NewApi")[m
[31m-            @Override[m
[31m-            public void run() {[m
[31m-                if (Build.VERSION.SDK_INT < Build.VERSION_CODES.KITKAT) {[m
[31m-                    // This action will have the side-effect of blurring the currently focused element[m
[31m-                    inAppWebView.loadUrl("javascript:" + finalScriptToInject);[m
[31m-                } /*else {[m
[31m-                    inAppWebView.evaluateJavascript(finalScriptToInject, null);[m
[31m-                }*/[m
[31m-            }[m
[31m-        });[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Put the list of features into a hash map[m
[31m-     * [m
[31m-     * @param optString[m
[31m-     * @return[m
[31m-     */[m
[31m-    private HashMap<String, Boolean> parseFeature(String optString) {[m
[31m-        if (optString.equals(NULL)) {[m
[31m-            return null;[m
[31m-        } else {[m
[31m-            HashMap<String, Boolean> map = new HashMap<String, Boolean>();[m
[31m-            StringTokenizer features = new StringTokenizer(optString, ",");[m
[31m-            StringTokenizer option;[m
[31m-            while(features.hasMoreElements()) {[m
[31m-                option = new StringTokenizer(features.nextToken(), "=");[m
[31m-                if (option.hasMoreElements()) {[m
[31m-                    String key = option.nextToken();[m
[31m-                    Boolean value = option.nextToken().equals("no") ? Boolean.FALSE : Boolean.TRUE;[m
[31m-                    map.put(key, value);[m
[31m-                }[m
[31m-            }[m
[31m-            return map;[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Display a new browser with the specified URL.[m
[31m-     *[m
[31m-     * @param url           The url to load.[m
[31m-     * @param usePhoneGap   Load url in PhoneGap webview[m
[31m-     * @return              "" if ok, or error message.[m
[31m-     */[m
[31m-    public String openExternal(String url) {[m
[31m-        try {[m
[31m-            Intent intent = null;[m
[31m-            intent = new Intent(Intent.ACTION_VIEW);[m
[31m-            // Omitting the MIME type for file: URLs causes "No Activity found to handle Intent".[m
[31m-            // Adding the MIME type to http: URLs causes them to not be handled by the downloader.[m
[31m-            Uri uri = Uri.parse(url);[m
[31m-            if ("file".equals(uri.getScheme())) {[m
[31m-                intent.setDataAndType(uri, webView.getResourceApi().getMimeType(uri));[m
[31m-            } else {[m
[31m-                intent.setData(uri);[m
[31m-            }[m
[31m-            this.cordova.getActivity().startActivity(intent);[m
[31m-            return "";[m
[31m-        } catch (android.content.ActivityNotFoundException e) {[m
[31m-            Log.d(LOG_TAG, "InAppBrowser: Error loading url "+url+":"+ e.toString());[m
[31m-            return e.toString();[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Closes the dialog[m
[31m-     */[m
[31m-    public void closeDialog() {[m
[31m-        final AmazonWebView childView = this.inAppWebView;[m
[31m-        // The JS protects against multiple calls, so this should happen only when[m
[31m-        // closeDialog() is called by other native code.[m
[31m-        if (childView == null) {[m
[31m-            return;[m
[31m-        }[m
[31m-        this.cordova.getActivity().runOnUiThread(new Runnable() {[m
[31m-            @Override[m
[31m-            public void run() {[m
[31m-                childView.setWebViewClient(new AmazonWebViewClient() {[m
[31m-                    // NB: wait for about:blank before dismissing[m
[31m-                    public void onPageFinished(AmazonWebView view, String url) {[m
[31m-                        if (dialog != null) {[m
[31m-                            dialog.dismiss();[m
[31m-                        }[m
[31m-                    }[m
[31m-                });[m
[31m-                // NB: From SDK 19: "If you call methods on WebView from any thread[m
[31m-                // other than your app's UI thread, it can cause unexpected results."[m
[31m-                // http://developer.android.com/guide/webapps/migrating.html#Threads[m
[31m-                childView.loadUrl("about:blank");[m
[31m-            }[m
[31m-        });[m
[31m-        [m
[31m-        try {[m
[31m-            JSONObject obj = new JSONObject();[m
[31m-            obj.put("type", EXIT_EVENT);[m
[31m-            sendUpdate(obj, false);[m
[31m-        } catch (JSONException ex) {[m
[31m-            Log.d(LOG_TAG, "Should never happen");[m
[31m-        }[m
[31m-    }[m
[31m-    /**[m
[31m-     * Checks to see if it is possible to go back one page in history, then does so.[m
[31m-     */[m
[31m-    public void goBack() {[m
[31m-        this.cordova.getActivity().runOnUiThread(new Runnable() {[m
[31m-            public void run() {[m
[31m-                if (InAppBrowser.this.inAppWebView.canGoBack()) {[m
[31m-                    InAppBrowser.this.inAppWebView.goBack();[m
[31m-                }[m
[31m-            }[m
[31m-        });[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Can the web browser go back?[m
[31m-     * @return boolean[m
[31m-     */[m
[31m-    public boolean canGoBack() {[m
[31m-        return this.inAppWebView.canGoBack();[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Has the user set the hardware back button to go back[m
[31m-     * @return boolean[m
[31m-     */[m
[31m-    public boolean hardwareBack() {[m
[31m-        return hadwareBackButton;[m
[31m-    } [m
[31m-[m
[31m-    /**[m
[31m-     * Checks to see if it is possible to go forward one page in history, then does so.[m
[31m-     */[m
[31m-    private void goForward() {[m
[31m-        this.cordova.getActivity().runOnUiThread(new Runnable() {[m
[31m-            public void run() {[m
[31m-                if (InAppBrowser.this.inAppWebView.canGoForward()) {[m
[31m-                    InAppBrowser.this.inAppWebView.goForward();[m
[31m-                }[m
[31m-            }[m
[31m-        });[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Navigate to the new page[m
[31m-     *[m
[31m-     * @param url to load[m
[31m-     */[m
[31m-    private void navigate(final String url) {[m
[31m-        InputMethodManager imm = (InputMethodManager)this.cordova.getActivity().getSystemService(Context.INPUT_METHOD_SERVICE);[m
[31m-        imm.hideSoftInputFromWindow(edittext.getWindowToken(), 0);[m
[31m-[m
[31m-        this.cordova.getActivity().runOnUiThread(new Runnable() {[m
[31m-            public void run() {[m
[31m-                if (!url.startsWith("http") && !url.startsWith("file:")) {[m
[31m-                    InAppBrowser.this.inAppWebView.loadUrl("http://" + url);[m
[31m-                } else {[m
[31m-                    InAppBrowser.this.inAppWebView.loadUrl(url);[m
[31m-                }[m
[31m-                InAppBrowser.this.inAppWebView.requestFocus();[m
[31m-            }[m
[31m-        });[m
[31m-    }[m
[31m-[m
[31m-[m
[31m-    /**[m
[31m-     * Should we show the location bar?[m
[31m-     *[m
[31m-     * @return boolean[m
[31m-     */[m
[31m-    private boolean getShowLocationBar() {[m
[31m-        return this.showLocationBar;[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Should we show the zoom controls?[m
[31m-     *[m
[31m-     * @return boolean[m
[31m-     */[m
[31m-    private boolean getShowZoomControls() {[m
[31m-        return this.showZoomControls;[m
[31m-    }[m
[31m-[m
[31m-    private InAppBrowser getInAppBrowser(){[m
[31m-        return this;[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Display a new browser with the specified URL.[m
[31m-     *[m
[31m-     * @param url           The url to load.[m
[31m-     * @param jsonObject[m
[31m-     */[m
[31m-    public String showWebPage(final String url, HashMap<String, Boolean> features) {[m
[31m-        // Determine if we should hide the location bar.[m
[31m-        showLocationBar = true;[m
[31m-        showZoomControls = true;[m
[31m-        openWindowHidden = false;[m
[31m-        if (features != null) {[m
[31m-            Boolean show = features.get(LOCATION);[m
[31m-            if (show != null) {[m
[31m-                showLocationBar = show.booleanValue();[m
[31m-            }[m
[31m-            Boolean zoom = features.get(ZOOM);[m
[31m-            if (zoom != null) {[m
[31m-                showZoomControls = zoom.booleanValue();[m
[31m-            }[m
[31m-            Boolean hidden = features.get(HIDDEN);[m
[31m-            if (hidden != null) {[m
[31m-                openWindowHidden = hidden.booleanValue();[m
[31m-            }[m
[31m-            Boolean hardwareBack = features.get(HARDWARE_BACK_BUTTON);[m
[31m-            if (hardwareBack != null) {[m
[31m-                hadwareBackButton = hardwareBack.booleanValue();[m
[31m-            }[m
[31m-            Boolean cache = features.get(CLEAR_ALL_CACHE);[m
[31m-            if (cache != null) {[m
[31m-                clearAllCache = cache.booleanValue();[m
[31m-            } else {[m
[31m-                cache = features.get(CLEAR_SESSION_CACHE);[m
[31m-                if (cache != null) {[m
[31m-                    clearSessionCache = cache.booleanValue();[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-        [m
[31m-        final CordovaWebView thatWebView = this.webView;[m
[31m-[m
[31m-        // Create dialog in new thread[m
[31m-        Runnable runnable = new Runnable() {[m
[31m-            /**[m
[31m-             * Convert our DIP units to Pixels[m
[31m-             *[m
[31m-             * @return int[m
[31m-             */[m
[31m-            private int dpToPixels(int dipValue) {[m
[31m-                int value = (int) TypedValue.applyDimension( TypedValue.COMPLEX_UNIT_DIP,[m
[31m-                                                            (float) dipValue,[m
[31m-                                                            cordova.getActivity().getResources().getDisplayMetrics()[m
[31m-                );[m
[31m-[m
[31m-                return value;[m
[31m-            }[m
[31m-[m
[31m-            @SuppressLint("NewApi")[m
[31m-            public void run() {[m
[31m-                // Let's create the main dialog[m
[31m-                dialog = new InAppBrowserDialog(cordova.getActivity(), android.R.style.Theme_NoTitleBar);[m
[31m-                dialog.getWindow().getAttributes().windowAnimations = android.R.style.Animation_Dialog;[m
[31m-                dialog.requestWindowFeature(Window.FEATURE_NO_TITLE);[m
[31m-                dialog.setCancelable(true);[m
[31m-                dialog.setInAppBroswer(getInAppBrowser());[m
[31m-[m
[31m-                // Main container layout[m
[31m-                LinearLayout main = new LinearLayout(cordova.getActivity());[m
[31m-                main.setOrientation(LinearLayout.VERTICAL);[m
[31m-[m
[31m-                // Toolbar layout[m
[31m-                RelativeLayout toolbar = new RelativeLayout(cordova.getActivity());[m
[31m-                //Please, no more black! [m
[31m-                toolbar.setBackgroundColor(android.graphics.Color.LTGRAY);[m
[31m-                toolbar.setLayoutParams(new RelativeLayout.LayoutParams(LayoutParams.MATCH_PARENT, this.dpToPixels(44)));[m
[31m-                toolbar.setPadding(this.dpToPixels(2), this.dpToPixels(2), this.dpToPixels(2), this.dpToPixels(2));[m
[31m-                toolbar.setHorizontalGravity(Gravity.LEFT);[m
[31m-                toolbar.setVerticalGravity(Gravity.TOP);[m
[31m-[m
[31m-                // Action Button Container layout[m
[31m-                RelativeLayout actionButtonContainer = new RelativeLayout(cordova.getActivity());[m
[31m-                actionButtonContainer.setLayoutParams(new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.WRAP_CONTENT));[m
[31m-                actionButtonContainer.setHorizontalGravity(Gravity.LEFT);[m
[31m-                actionButtonContainer.setVerticalGravity(Gravity.CENTER_VERTICAL);[m
[31m-                actionButtonContainer.setId(1);[m
[31m-[m
[31m-                // Back button[m
[31m-                Button back = new Button(cordova.getActivity());[m
[31m-                RelativeLayout.LayoutParams backLayoutParams = new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.MATCH_PARENT);[m
[31m-                backLayoutParams.addRule(RelativeLayout.ALIGN_LEFT);[m
[31m-                back.setLayoutParams(backLayoutParams);[m
[31m-                back.setContentDescription("Back Button");[m
[31m-                back.setId(2);[m
[31m-                Resources activityRes = cordova.getActivity().getResources();[m
[31m-                int backResId = activityRes.getIdentifier("ic_action_previous_item", "drawable", cordova.getActivity().getPackageName());[m
[31m-                Drawable backIcon = activityRes.getDrawable(backResId);[m
[31m-                if(android.os.Build.VERSION.SDK_INT < android.os.Build.VERSION_CODES.JELLY_BEAN)[m
[31m-                {[m
[31m-                    back.setBackgroundDrawable(backIcon);[m
[31m-                }[m
[31m-                else[m
[31m-                {[m
[31m-                    back.setBackground(backIcon);[m
[31m-                }[m
[31m-[m
[31m-                back.setOnClickListener(new View.OnClickListener() {[m
[31m-                    public void onClick(View v) {[m
[31m-                        goBack();[m
[31m-                    }[m
[31m-                });[m
[31m-[m
[31m-                // Forward button[m
[31m-                Button forward = new Button(cordova.getActivity());[m
[31m-                RelativeLayout.LayoutParams forwardLayoutParams = new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.MATCH_PARENT);[m
[31m-                forwardLayoutParams.addRule(RelativeLayout.RIGHT_OF, 2);[m
[31m-                forward.setLayoutParams(forwardLayoutParams);[m
[31m-                forward.setContentDescription("Forward Button");[m
[31m-                forward.setId(3);[m
[31m-                int fwdResId = activityRes.getIdentifier("ic_action_next_item", "drawable", cordova.getActivity().getPackageName());[m
[31m-                Drawable fwdIcon = activityRes.getDrawable(fwdResId);[m
[31m-                if(android.os.Build.VERSION.SDK_INT < android.os.Build.VERSION_CODES.JELLY_BEAN)[m
[31m-                {[m
[31m-                    forward.setBackgroundDrawable(fwdIcon);[m
[31m-                }[m
[31m-                else[m
[31m-                {[m
[31m-                    forward.setBackground(fwdIcon);[m
[31m-                }[m
[31m-                forward.setOnClickListener(new View.OnClickListener() {[m
[31m-                    public void onClick(View v) {[m
[31m-                        goForward();[m
[31m-                    }[m
[31m-                });[m
[31m-[m
[31m-                // Edit Text Box[m
[31m-                edittext = new EditText(cordova.getActivity());[m
[31m-                RelativeLayout.LayoutParams textLayoutParams = new RelativeLayout.LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT);[m
[31m-                textLayoutParams.addRule(RelativeLayout.RIGHT_OF, 1);[m
[31m-                textLayoutParams.addRule(RelativeLayout.LEFT_OF, 5);[m
[31m-                edittext.setLayoutParams(textLayoutParams);[m
[31m-                edittext.setId(4);[m
[31m-                edittext.setSingleLine(true);[m
[31m-                edittext.setText(url);[m
[31m-                edittext.setInputType(InputType.TYPE_TEXT_VARIATION_URI);[m
[31m-                edittext.setImeOptions(EditorInfo.IME_ACTION_GO);[m
[31m-                edittext.setInputType(InputType.TYPE_NULL); // Will not except input... Makes the text NON-EDITABLE[m
[31m-                edittext.setOnKeyListener(new View.OnKeyListener() {[m
[31m-                    public boolean onKey(View v, int keyCode, KeyEvent event) {[m
[31m-                        // If the event is a key-down event on the "enter" button[m
[31m-                        if ((event.getAction() == KeyEvent.ACTION_DOWN) && (keyCode == KeyEvent.KEYCODE_ENTER)) {[m
[31m-                          navigate(edittext.getText().toString());[m
[31m-                          return true;[m
[31m-                        }[m
[31m-                        return false;[m
[31m-                    }[m
[31m-                });[m
[31m-[m
[31m-                // Close/Done button[m
[31m-                Button close = new Button(cordova.getActivity());[m
[31m-                RelativeLayout.LayoutParams closeLayoutParams = new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.MATCH_PARENT);[m
[31m-                closeLayoutParams.addRule(RelativeLayout.ALIGN_PARENT_RIGHT);[m
[31m-                close.setLayoutParams(closeLayoutParams);[m
[31m-                forward.setContentDescription("Close Button");[m
[31m-                close.setId(5);[m
[31m-                int closeResId = activityRes.getIdentifier("ic_action_remove", "drawable", cordova.getActivity().getPackageName());[m
[31m-                Drawable closeIcon = activityRes.getDrawable(closeResId);[m
[31m-                if(android.os.Build.VERSION.SDK_INT < android.os.Build.VERSION_CODES.JELLY_BEAN)[m
[31m-                {[m
[31m-                    close.setBackgroundDrawable(closeIcon);[m
[31m-                }[m
[31m-                else[m
[31m-                {[m
[31m-                    close.setBackground(closeIcon);[m
[31m-                }[m
[31m-                close.setOnClickListener(new View.OnClickListener() {[m
[31m-                    public void onClick(View v) {[m
[31m-                        closeDialog();[m
[31m-                    }[m
[31m-                });[m
[31m-[m
[31m-                // WebView[m
[31m-                inAppWebView = new AmazonWebView(cordova.getActivity());[m
[31m-                [m
[31m-                CordovaActivity app = (CordovaActivity) cordova.getActivity();[m
[31m-                cordova.getFactory().initializeWebView(inAppWebView, 0x00FF00, false, null);[m
[31m-                [m
[31m-                inAppWebView.setLayoutParams(new LinearLayout.LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT));[m
[31m-                inAppWebView.setWebChromeClient(new InAppChromeClient(thatWebView));[m
[31m-                AmazonWebViewClient client = new InAppBrowserClient(thatWebView, edittext);[m
[31m-                inAppWebView.setWebViewClient(client);[m
[31m-                AmazonWebSettings settings = inAppWebView.getSettings();[m
[31m-                settings.setJavaScriptEnabled(true);[m
[31m-                settings.setJavaScriptCanOpenWindowsAutomatically(true);[m
[31m-                settings.setBuiltInZoomControls(getShowZoomControls());[m
[31m-                settings.setPluginState(com.amazon.android.webkit.AmazonWebSettings.PluginState.ON);[m
[31m-[m
[31m-                //Toggle whether this is enabled or not![m
[31m-                Bundle appSettings = cordova.getActivity().getIntent().getExtras();[m
[31m-                boolean enableDatabase = appSettings == null ? true : appSettings.getBoolean("InAppBrowserStorageEnabled", true);[m
[31m-                if (enableDatabase) {[m
[31m-                    String databasePath = cordova.getActivity().getApplicationContext().getDir("inAppBrowserDB", Context.MODE_PRIVATE).getPath();[m
[31m-                    settings.setDatabasePath(databasePath);[m
[31m-                    settings.setDatabaseEnabled(true);[m
[31m-                }[m
[31m-                settings.setDomStorageEnabled(true);[m
[31m-[m
[31m-                if (clearAllCache) {[m
[31m-                    AmazonCookieManager.getInstance().removeAllCookie();[m
[31m-                } else if (clearSessionCache) {[m
[31m-                    AmazonCookieManager.getInstance().removeSessionCookie();[m
[31m-                }[m
[31m-[m
[31m-                inAppWebView.loadUrl(url);[m
[31m-                inAppWebView.setId(6);[m
[31m-                inAppWebView.getSettings().setLoadWithOverviewMode(true);[m
[31m-                inAppWebView.getSettings().setUseWideViewPort(true);[m
[31m-                inAppWebView.requestFocus();[m
[31m-                inAppWebView.requestFocusFromTouch();[m
[31m-[m
[31m-                // Add the back and forward buttons to our action button container layout[m
[31m-                actionButtonContainer.addView(back);[m
[31m-                actionButtonContainer.addView(forward);[m
[31m-[m
[31m-                // Add the views to our toolbar[m
[31m-                toolbar.addView(actionButtonContainer);[m
[31m-                toolbar.addView(edittext);[m
[31m-                toolbar.addView(close);[m
[31m-[m
[31m-                // Don't add the toolbar if its been disabled[m
[31m-                if (getShowLocationBar()) {[m
[31m-                    // Add our toolbar to our main view/layout[m
[31m-                    main.addView(toolbar);[m
[31m-                }[m
[31m-[m
[31m-                // Add our webview to our main view/layout[m
[31m-                main.addView(inAppWebView);[m
[31m-[m
[31m-                WindowManager.LayoutParams lp = new WindowManager.LayoutParams();[m
[31m-                lp.copyFrom(dialog.getWindow().getAttributes());[m
[31m-                lp.width = WindowManager.LayoutParams.MATCH_PARENT;[m
[31m-                lp.height = WindowManager.LayoutParams.MATCH_PARENT;[m
[31m-[m
[31m-                dialog.setContentView(main);[m
[31m-                dialog.show();[m
[31m-                dialog.getWindow().setAttributes(lp);[m
[31m-                // the goal of openhidden is to load the url and not display it[m
[31m-                // Show() needs to be called to cause the URL to be loaded[m
[31m-                if(openWindowHidden) {[m
[31m-                    dialog.hide();[m
[31m-                }[m
[31m-            }[m
[31m-        };[m
[31m-        this.cordova.getActivity().runOnUiThread(runnable);[m
[31m-        return "";[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Create a new plugin success result and send it back to JavaScript[m
[31m-     *[m
[31m-     * @param obj a JSONObject contain event payload information[m
[31m-     */[m
[31m-    private void sendUpdate(JSONObject obj, boolean keepCallback) {[m
[31m-        sendUpdate(obj, keepCallback, PluginResult.Status.OK);[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Create a new plugin result and send it back to JavaScript[m
[31m-     *[m
[31m-     * @param obj a JSONObject contain event payload information[m
[31m-     * @param status the status code to return to the JavaScript environment[m
[31m-     */    [m
[31m-    private void sendUpdate(JSONObject obj, boolean keepCallback, PluginResult.Status status) {[m
[31m-        if (callbackContext != null) {[m
[31m-            PluginResult result = new PluginResult(status, obj);[m
[31m-            result.setKeepCallback(keepCallback);[m
[31m-            callbackContext.sendPluginResult(result);[m
[31m-            if (!keepCallback) {[m
[31m-                callbackContext = null;[m
[31m-            }[m
[31m-        }[m
[31m-    }[m
[31m-    [m
[31m-    /**[m
[31m-     * The webview client receives notifications about appView[m
[31m-     */[m
[31m-    public class InAppBrowserClient extends AmazonWebViewClient {[m
[31m-        EditText edittext;[m
[31m-        CordovaWebView webView;[m
[31m-[m
[31m-        /**[m
[31m-         * Constructor.[m
[31m-         *[m
[31m-         * @param mContext[m
[31m-         * @param edittext[m
[31m-         */[m
[31m-        public InAppBrowserClient(CordovaWebView webView, EditText mEditText) {[m
[31m-            this.webView = webView;[m
[31m-            this.edittext = mEditText;[m
[31m-        }[m
[31m-[m
[31m-        /**[m
[31m-         * Notify the host application that a page has started loading.[m
[31m-         *[m
[31m-         * @param view          The webview initiating the callback.[m
[31m-         * @param url           The url of the page.[m
[31m-         */[m
[31m-        @Override[m
[31m-        public void onPageStarted(AmazonWebView view, String url,  Bitmap favicon) {[m
[31m-            super.onPageStarted(view, url, favicon);[m
[31m-            String newloc = "";[m
[31m-            if (url.startsWith("http:") || url.startsWith("https:") || url.startsWith("file:")) {[m
[31m-                newloc = url;[m
[31m-            } [m
[31m-            // If dialing phone (tel:5551212)[m
[31m-            else if (url.startsWith(AmazonWebView.SCHEME_TEL)) {[m
[31m-                try {[m
[31m-                    Intent intent = new Intent(Intent.ACTION_DIAL);[m
[31m-                    intent.setData(Uri.parse(url));[m
[31m-                    cordova.getActivity().startActivity(intent);[m
[31m-                } catch (android.content.ActivityNotFoundException e) {[m
[31m-                    LOG.e(LOG_TAG, "Error dialing " + url + ": " + e.toString());[m
[31m-                }[m
[31m-            }[m
[31m-[m
[31m-            else if (url.startsWith("geo:") || url.startsWith(AmazonWebView.SCHEME_MAILTO) || url.startsWith("market:")) {[m
[31m-                try {[m
[31m-                    Intent intent = new Intent(Intent.ACTION_VIEW);[m
[31m-                    intent.setData(Uri.parse(url));[m
[31m-                    cordova.getActivity().startActivity(intent);[m
[31m-                } catch (android.content.ActivityNotFoundException e) {[m
[31m-                    LOG.e(LOG_TAG, "Error with " + url + ": " + e.toString());[m
[31m-                }[m
[31m-            }[m
[31m-            // If sms:5551212?body=This is the message[m
[31m-            else if (url.startsWith("sms:")) {[m
[31m-                try {[m
[31m-                    Intent intent = new Intent(Intent.ACTION_VIEW);[m
[31m-[m
[31m-                    // Get address[m
[31m-                    String address = null;[m
[31m-                    int parmIndex = url.indexOf('?');[m
[31m-                    if (parmIndex == -1) {[m
[31m-                        address = url.substring(4);[m
[31m-                    }[m
[31m-                    else {[m
[31m-                        address = url.substring(4, parmIndex);[m
[31m-[m
[31m-                        // If body, then set sms body[m
[31m-                        Uri uri = Uri.parse(url);[m
[31m-                        String query = uri.getQuery();[m
[31m-                        if (query != null) {[m
[31m-                            if (query.startsWith("body=")) {[m
[31m-                                intent.putExtra("sms_body", query.substring(5));[m
[31m-                            }[m
[31m-                        }[m
[31m-                    }[m
[31m-                    intent.setData(Uri.parse("sms:" + address));[m
[31m-                    intent.putExtra("address", address);[m
[31m-                    intent.setType("vnd.android-dir/mms-sms");[m
[31m-                    cordova.getActivity().startActivity(intent);[m
[31m-                } catch (android.content.ActivityNotFoundException e) {[m
[31m-                    LOG.e(LOG_TAG, "Error sending sms " + url + ":" + e.toString());[m
[31m-                }[m
[31m-            }[m
[31m-            else {[m
[31m-                newloc = "http://" + url;[m
[31m-            }[m
[31m-[m
[31m-            if (!newloc.equals(edittext.getText().toString())) {[m
[31m-                edittext.setText(newloc);[m
[31m-            }[m
[31m-[m
[31m-            try {[m
[31m-                JSONObject obj = new JSONObject();[m
[31m-                obj.put("type", LOAD_START_EVENT);[m
[31m-                obj.put("url", newloc);[m
[31m-    [m
[31m-                sendUpdate(obj, true);[m
[31m-            } catch (JSONException ex) {[m
[31m-                Log.d(LOG_TAG, "Should never happen");[m
[31m-            }[m
[31m-        }[m
[31m-        [m
[31m-        public void onPageFinished(AmazonWebView view, String url) {[m
[31m-            super.onPageFinished(view, url);[m
[31m-            [m
[31m-            try {[m
[31m-                JSONObject obj = new JSONObject();[m
[31m-                obj.put("type", LOAD_STOP_EVENT);[m
[31m-                obj.put("url", url);[m
[31m-    [m
[31m-                sendUpdate(obj, true);[m
[31m-            } catch (JSONException ex) {[m
[31m-                Log.d(LOG_TAG, "Should never happen");[m
[31m-            }[m
[31m-        }[m
[31m-        [m
[31m-        public void onReceivedError(AmazonWebView view, int errorCode, String description, String failingUrl) {[m
[31m-            super.onReceivedError(view, errorCode, description, failingUrl);[m
[31m-            [m
[31m-            try {[m
[31m-                JSONObject obj = new JSONObject();[m
[31m-                obj.put("type", LOAD_ERROR_EVENT);[m
[31m-                obj.put("url", failingUrl);[m
[31m-                obj.put("code", errorCode);[m
[31m-                obj.put("message", description);[m
[31m-    [m
[31m-                sendUpdate(obj, true, PluginResult.Status.ERROR);[m
[31m-            } catch (JSONException ex) {[m
[31m-                Log.d(LOG_TAG, "Should never happen");[m
[31m-            }[m
[31m-        }[m
[31m-    }[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/amazon/InAppChromeClient.java b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/amazon/InAppChromeClient.java[m
[1mdeleted file mode 100644[m
[1mindex 37cf101..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/amazon/InAppChromeClient.java[m
[1m+++ /dev/null[m
[36m@@ -1,146 +0,0 @@[m
[31m-/*[m
[31m-       Licensed to the Apache Software Foundation (ASF) under one[m
[31m-       or more contributor license agreements.  See the NOTICE file[m
[31m-       distributed with this work for additional information[m
[31m-       regarding copyright ownership.  The ASF licenses this file[m
[31m-       to you under the Apache License, Version 2.0 (the[m
[31m-       "License"); you may not use this file except in compliance[m
[31m-       with the License.  You may obtain a copy of the License at[m
[31m-[m
[31m-         http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-       Unless required by applicable law or agreed to in writing,[m
[31m-       software distributed under the License is distributed on an[m
[31m-       "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-       KIND, either express or implied.  See the License for the[m
[31m-       specific language governing permissions and limitations[m
[31m-       under the License.[m
[31m-*/[m
[31m-package org.apache.cordova.inappbrowser;[m
[31m-[m
[31m-import org.apache.cordova.CordovaWebView;[m
[31m-import org.apache.cordova.LOG;[m
[31m-import org.apache.cordova.PluginResult;[m
[31m-import org.json.JSONArray;[m
[31m-import org.json.JSONException;[m
[31m-[m
[31m-import com.amazon.android.webkit.AmazonWebChromeClient;[m
[31m-import com.amazon.android.webkit.AmazonGeolocationPermissions.Callback;[m
[31m-import com.amazon.android.webkit.AmazonJsPromptResult;[m
[31m-import com.amazon.android.webkit.AmazonWebStorage;[m
[31m-import com.amazon.android.webkit.AmazonWebView;[m
[31m-import com.amazon.android.webkit.AmazonWebViewClient;[m
[31m-[m
[31m-public class InAppChromeClient extends AmazonWebChromeClient {[m
[31m-[m
[31m-    private CordovaWebView webView;[m
[31m-    private String LOG_TAG = "InAppChromeClient";[m
[31m-    private long MAX_QUOTA = 100 * 1024 * 1024;[m
[31m-[m
[31m-    public InAppChromeClient(CordovaWebView webView) {[m
[31m-        super();[m
[31m-        this.webView = webView;[m
[31m-    }[m
[31m-    /**[m
[31m-     * Handle database quota exceeded notification.[m
[31m-     *[m
[31m-     * @param url[m
[31m-     * @param databaseIdentifier[m
[31m-     * @param currentQuota[m
[31m-     * @param estimatedSize[m
[31m-     * @param totalUsedQuota[m
[31m-     * @param quotaUpdater[m
[31m-     */[m
[31m-    @Override[m
[31m-    public void onExceededDatabaseQuota(String url, String databaseIdentifier, long currentQuota, long estimatedSize,[m
[31m-            long totalUsedQuota, AmazonWebStorage.QuotaUpdater quotaUpdater)[m
[31m-    {[m
[31m-        LOG.d(LOG_TAG, "onExceededDatabaseQuota estimatedSize: %d  currentQuota: %d  totalUsedQuota: %d", estimatedSize, currentQuota, totalUsedQuota);[m
[31m-[m
[31m-        if (estimatedSize < MAX_QUOTA)[m
[31m-        {[m
[31m-            //increase for 1Mb[m
[31m-            long newQuota = estimatedSize;[m
[31m-            LOG.d(LOG_TAG, "calling quotaUpdater.updateQuota newQuota: %d", newQuota);[m
[31m-            quotaUpdater.updateQuota(newQuota);[m
[31m-        }[m
[31m-        else[m
[31m-        {[m
[31m-            // Set the quota to whatever it is and force an error[m
[31m-            // TODO: get docs on how to handle this properly[m
[31m-            quotaUpdater.updateQuota(currentQuota);[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Instructs the client to show a prompt to ask the user to set the Geolocation permission state for the specified origin.[m
[31m-     *[m
[31m-     * @param origin[m
[31m-     * @param callback[m
[31m-     */[m
[31m-    @Override[m
[31m-    public void onGeolocationPermissionsShowPrompt(String origin, Callback callback) {[m
[31m-        super.onGeolocationPermissionsShowPrompt(origin, callback);[m
[31m-        callback.invoke(origin, true, false);[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Tell the client to display a prompt dialog to the user.[m
[31m-     * If the client returns true, WebView will assume that the client will[m
[31m-     * handle the prompt dialog and call the appropriate JsPromptResult method.[m
[31m-     *[m
[31m-     * The prompt bridge provided for the InAppBrowser is capable of executing any[m
[31m-     * oustanding callback belonging to the InAppBrowser plugin. Care has been[m
[31m-     * taken that other callbacks cannot be triggered, and that no other code[m
[31m-     * execution is possible.[m
[31m-     *[m
[31m-     * To trigger the bridge, the prompt default value should be of the form:[m
[31m-     *[m
[31m-     * gap-iab://<callbackId>[m
[31m-     *[m
[31m-     * where <callbackId> is the string id of the callback to trigger (something[m
[31m-     * like "InAppBrowser0123456789")[m
[31m-     *[m
[31m-     * If present, the prompt message is expected to be a JSON-encoded value to[m
[31m-     * pass to the callback. A JSON_EXCEPTION is returned if the JSON is invalid.[m
[31m-     *[m
[31m-     * @param view[m
[31m-     * @param url[m
[31m-     * @param message[m
[31m-     * @param defaultValue[m
[31m-     * @param result[m
[31m-     */[m
[31m-    @Override[m
[31m-    public boolean onJsPrompt(AmazonWebView view, String url, String message, String defaultValue, AmazonJsPromptResult result) {[m
[31m-        // See if the prompt string uses the 'gap-iab' protocol. If so, the remainder should be the id of a callback to execute.[m
[31m-        if (defaultValue != null && defaultValue.startsWith("gap")) {[m
[31m-            if(defaultValue.startsWith("gap-iab://")) {[m
[31m-                PluginResult scriptResult;[m
[31m-                String scriptCallbackId = defaultValue.substring(10);[m
[31m-                if (scriptCallbackId.startsWith("InAppBrowser")) {[m
[31m-                    if(message == null || message.length() == 0) {[m
[31m-                        scriptResult = new PluginResult(PluginResult.Status.OK, new JSONArray());[m
[31m-                    } else {[m
[31m-                        try {[m
[31m-                            scriptResult = new PluginResult(PluginResult.Status.OK, new JSONArray(message));[m
[31m-                        } catch(JSONException e) {[m
[31m-                            scriptResult = new PluginResult(PluginResult.Status.JSON_EXCEPTION, e.getMessage());[m
[31m-                        }[m
[31m-                    }[m
[31m-                    this.webView.sendPluginResult(scriptResult, scriptCallbackId);[m
[31m-                    result.confirm("");[m
[31m-                    return true;[m
[31m-                }[m
[31m-            }[m
[31m-            else[m
[31m-            {[m
[31m-                // Anything else with a gap: prefix should get this message[m
[31m-                LOG.w(LOG_TAG, "InAppBrowser does not support Cordova API calls: " + url + " " + defaultValue); [m
[31m-                result.cancel();[m
[31m-                return true;[m
[31m-            }[m
[31m-        }[m
[31m-        return false;[m
[31m-    }[m
[31m-[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/android/InAppBrowser.java b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/android/InAppBrowser.java[m
[1mindex 24a8efa..9b3388c 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/android/InAppBrowser.java[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/android/InAppBrowser.java[m
[36m@@ -25,6 +25,9 @@[m [mimport android.provider.Browser;[m
 import android.content.res.Resources;[m
 import android.graphics.Bitmap;[m
 import android.graphics.drawable.Drawable;[m
[32m+[m[32mimport android.graphics.PorterDuff;[m
[32m+[m[32mimport android.graphics.PorterDuffColorFilter;[m
[32m+[m[32mimport android.graphics.Color;[m
 import android.net.Uri;[m
 import android.os.Build;[m
 import android.os.Bundle;[m
[36m@@ -41,6 +44,8 @@[m [mimport android.view.inputmethod.InputMethodManager;[m
 import android.webkit.CookieManager;[m
 import android.webkit.CookieSyncManager;[m
 import android.webkit.HttpAuthHandler;[m
[32m+[m[32mimport android.webkit.ValueCallback;[m
[32m+[m[32mimport android.webkit.WebChromeClient;[m
 import android.webkit.WebSettings;[m
 import android.webkit.WebView;[m
 import android.webkit.WebViewClient;[m
[36m@@ -49,6 +54,7 @@[m [mimport android.widget.ImageButton;[m
 import android.widget.ImageView;[m
 import android.widget.LinearLayout;[m
 import android.widget.RelativeLayout;[m
[32m+[m[32mimport android.widget.TextView;[m
 [m
 import org.apache.cordova.CallbackContext;[m
 import org.apache.cordova.Config;[m
[36m@@ -65,6 +71,8 @@[m [mimport org.json.JSONObject;[m
 import java.lang.reflect.InvocationTargetException;[m
 import java.lang.reflect.Field;[m
 import java.lang.reflect.Method;[m
[32m+[m[32mimport java.util.Arrays;[m
[32m+[m[32mimport java.util.List;[m
 import java.util.HashMap;[m
 import java.util.StringTokenizer;[m
 [m
[36m@@ -89,6 +97,16 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
     private static final String SHOULD_PAUSE = "shouldPauseOnSuspend";[m
     private static final Boolean DEFAULT_HARDWARE_BACK = true;[m
     private static final String USER_WIDE_VIEW_PORT = "useWideViewPort";[m
[32m+[m[32m    private static final String TOOLBAR_COLOR = "toolbarcolor";[m
[32m+[m[32m    private static final String CLOSE_BUTTON_CAPTION = "closebuttoncaption";[m
[32m+[m[32m    private static final String CLOSE_BUTTON_COLOR = "closebuttoncolor";[m
[32m+[m[32m    private static final String HIDE_NAVIGATION = "hidenavigationbuttons";[m
[32m+[m[32m    private static final String NAVIGATION_COLOR = "navigationbuttoncolor";[m
[32m+[m[32m    private static final String HIDE_URL = "hideurlbar";[m
[32m+[m[32m    private static final String FOOTER = "footer";[m
[32m+[m[32m    private static final String FOOTER_COLOR = "footercolor";[m
[32m+[m
[32m+[m[32m    private static final List customizableOptions = Arrays.asList(CLOSE_BUTTON_CAPTION, TOOLBAR_COLOR, NAVIGATION_COLOR, CLOSE_BUTTON_COLOR, FOOTER_COLOR);[m
 [m
     private InAppBrowserDialog dialog;[m
     private WebView inAppWebView;[m
[36m@@ -103,6 +121,19 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
     private boolean mediaPlaybackRequiresUserGesture = false;[m
     private boolean shouldPauseInAppBrowser = false;[m
     private boolean useWideViewPort = true;[m
[32m+[m[32m    private ValueCallback<Uri> mUploadCallback;[m
[32m+[m[32m    private ValueCallback<Uri[]> mUploadCallbackLollipop;[m
[32m+[m[32m    private final static int FILECHOOSER_REQUESTCODE = 1;[m
[32m+[m[32m    private final static int FILECHOOSER_REQUESTCODE_LOLLIPOP = 2;[m
[32m+[m[32m    private String closeButtonCaption = "";[m
[32m+[m[32m    private String closeButtonColor = "";[m
[32m+[m[32m    private int toolbarColor = android.graphics.Color.LTGRAY;[m
[32m+[m[32m    private boolean hideNavigationButtons = false;[m
[32m+[m[32m    private String navigationButtonColor = "";[m
[32m+[m[32m    private boolean hideUrlBar = false;[m
[32m+[m[32m    private boolean showFooter = false;[m
[32m+[m[32m    private String footerColor = "";[m
[32m+[m[32m    private String[] allowedSchemes;[m
 [m
     /**[m
      * Executes the request and returns PluginResult.[m
[36m@@ -121,7 +152,7 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
                 t = SELF;[m
             }[m
             final String target = t;[m
[31m-            final HashMap<String, Boolean> features = parseFeature(args.optString(2));[m
[32m+[m[32m            final HashMap<String, String> features = parseFeature(args.optString(2));[m
 [m
             LOG.d(LOG_TAG, "target = " + target);[m
 [m
[36m@@ -360,18 +391,21 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
      * @param optString[m
      * @return[m
      */[m
[31m-    private HashMap<String, Boolean> parseFeature(String optString) {[m
[32m+[m[32m    private HashMap<String, String> parseFeature(String optString) {[m
         if (optString.equals(NULL)) {[m
             return null;[m
         } else {[m
[31m-            HashMap<String, Boolean> map = new HashMap<String, Boolean>();[m
[32m+[m[32m            HashMap<String, String> map = new HashMap<String, String>();[m
             StringTokenizer features = new StringTokenizer(optString, ",");[m
             StringTokenizer option;[m
             while(features.hasMoreElements()) {[m
                 option = new StringTokenizer(features.nextToken(), "=");[m
                 if (option.hasMoreElements()) {[m
                     String key = option.nextToken();[m
[31m-                    Boolean value = option.nextToken().equals("no") ? Boolean.FALSE : Boolean.TRUE;[m
[32m+[m[32m                    String value = option.nextToken();[m
[32m+[m[32m                    if (!customizableOptions.contains(key)){[m
[32m+[m[32m                        value = value.equals("yes") || value.equals("no") ? value : "yes";[m
[32m+[m[32m                    }[m
                     map.put(key, value);[m
                 }[m
             }[m
[36m@@ -400,7 +434,7 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
             intent.putExtra(Browser.EXTRA_APPLICATION_ID, cordova.getActivity().getPackageName());[m
             this.cordova.getActivity().startActivity(intent);[m
             return "";[m
[31m-        // not catching FileUriExposedException explicitly because buildtools<24 doesn't know about it[m
[32m+[m[32m            // not catching FileUriExposedException explicitly because buildtools<24 doesn't know about it[m
         } catch (java.lang.RuntimeException e) {[m
             LOG.d(LOG_TAG, "InAppBrowser: Error loading url "+url+":"+ e.toString());[m
             return e.toString();[m
[36m@@ -517,7 +551,7 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
      * @param url the url to load.[m
      * @param features jsonObject[m
      */[m
[31m-    public String showWebPage(final String url, HashMap<String, Boolean> features) {[m
[32m+[m[32m    public String showWebPage(final String url, HashMap<String, String> features) {[m
         // Determine if we should hide the location bar.[m
         showLocationBar = true;[m
         showZoomControls = true;[m
[36m@@ -525,44 +559,74 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
         mediaPlaybackRequiresUserGesture = false;[m
 [m
         if (features != null) {[m
[31m-            Boolean show = features.get(LOCATION);[m
[32m+[m[32m            String show = features.get(LOCATION);[m
             if (show != null) {[m
[31m-                showLocationBar = show.booleanValue();[m
[32m+[m[32m                showLocationBar = show.equals("yes") ? true : false;[m
[32m+[m[32m            }[m
[32m+[m[32m            if(showLocationBar) {[m
[32m+[m[32m                String hideNavigation = features.get(HIDE_NAVIGATION);[m
[32m+[m[32m                String hideUrl = features.get(HIDE_URL);[m
[32m+[m[32m                if(hideNavigation != null) hideNavigationButtons = hideNavigation.equals("yes") ? true : false;[m
[32m+[m[32m                if(hideUrl != null) hideUrlBar = hideUrl.equals("yes") ? true : false;[m
             }[m
[31m-            Boolean zoom = features.get(ZOOM);[m
[32m+[m[32m            String zoom = features.get(ZOOM);[m
             if (zoom != null) {[m
[31m-                showZoomControls = zoom.booleanValue();[m
[32m+[m[32m                showZoomControls = zoom.equals("yes") ? true : false;[m
             }[m
[31m-            Boolean hidden = features.get(HIDDEN);[m
[32m+[m[32m            String hidden = features.get(HIDDEN);[m
             if (hidden != null) {[m
[31m-                openWindowHidden = hidden.booleanValue();[m
[32m+[m[32m                openWindowHidden = hidden.equals("yes") ? true : false;[m
             }[m
[31m-            Boolean hardwareBack = features.get(HARDWARE_BACK_BUTTON);[m
[32m+[m[32m            String hardwareBack = features.get(HARDWARE_BACK_BUTTON);[m
             if (hardwareBack != null) {[m
[31m-                hadwareBackButton = hardwareBack.booleanValue();[m
[32m+[m[32m                hadwareBackButton = hardwareBack.equals("yes") ? true : false;[m
             } else {[m
                 hadwareBackButton = DEFAULT_HARDWARE_BACK;[m
             }[m
[31m-            Boolean mediaPlayback = features.get(MEDIA_PLAYBACK_REQUIRES_USER_ACTION);[m
[32m+[m[32m            String mediaPlayback = features.get(MEDIA_PLAYBACK_REQUIRES_USER_ACTION);[m
             if (mediaPlayback != null) {[m
[31m-                mediaPlaybackRequiresUserGesture = mediaPlayback.booleanValue();[m
[32m+[m[32m                mediaPlaybackRequiresUserGesture = mediaPlayback.equals("yes") ? true : false;[m
             }[m
[31m-            Boolean cache = features.get(CLEAR_ALL_CACHE);[m
[32m+[m[32m            String cache = features.get(CLEAR_ALL_CACHE);[m
             if (cache != null) {[m
[31m-                clearAllCache = cache.booleanValue();[m
[32m+[m[32m                clearAllCache = cache.equals("yes") ? true : false;[m
             } else {[m
                 cache = features.get(CLEAR_SESSION_CACHE);[m
                 if (cache != null) {[m
[31m-                    clearSessionCache = cache.booleanValue();[m
[32m+[m[32m                    clearSessionCache = cache.equals("yes") ? true : false;[m
                 }[m
             }[m
[31m-            Boolean shouldPause = features.get(SHOULD_PAUSE);[m
[32m+[m[32m            String shouldPause = features.get(SHOULD_PAUSE);[m
             if (shouldPause != null) {[m
[31m-                shouldPauseInAppBrowser = shouldPause.booleanValue();[m
[32m+[m[32m                shouldPauseInAppBrowser = shouldPause.equals("yes") ? true : false;[m
             }[m
[31m-            Boolean wideViewPort = features.get(USER_WIDE_VIEW_PORT);[m
[32m+[m[32m            String wideViewPort = features.get(USER_WIDE_VIEW_PORT);[m
             if (wideViewPort != null ) {[m
[31m-		            useWideViewPort = wideViewPort.booleanValue();[m
[32m+[m[32m                useWideViewPort = wideViewPort.equals("yes") ? true : false;[m
[32m+[m[32m            }[m
[32m+[m[32m            String closeButtonCaptionSet = features.get(CLOSE_BUTTON_CAPTION);[m
[32m+[m[32m            if (closeButtonCaptionSet != null) {[m
[32m+[m[32m                closeButtonCaption = closeButtonCaptionSet;[m
[32m+[m[32m            }[m
[32m+[m[32m            String closeButtonColorSet = features.get(CLOSE_BUTTON_COLOR);[m
[32m+[m[32m            if (closeButtonColorSet != null) {[m
[32m+[m[32m                closeButtonColor = closeButtonColorSet;[m
[32m+[m[32m            }[m
[32m+[m[32m            String toolbarColorSet = features.get(TOOLBAR_COLOR);[m
[32m+[m[32m            if (toolbarColorSet != null) {[m
[32m+[m[32m                toolbarColor = android.graphics.Color.parseColor(toolbarColorSet);[m
[32m+[m[32m            }[m
[32m+[m[32m            String navigationButtonColorSet = features.get(NAVIGATION_COLOR);[m
[32m+[m[32m            if (navigationButtonColorSet != null) {[m
[32m+[m[32m                navigationButtonColor = navigationButtonColorSet;[m
[32m+[m[32m            }[m
[32m+[m[32m            String showFooterSet = features.get(FOOTER);[m
[32m+[m[32m            if (showFooterSet != null) {[m
[32m+[m[32m                showFooter = showFooterSet.equals("yes") ? true : false;[m
[32m+[m[32m            }[m
[32m+[m[32m            String footerColorSet = features.get(FOOTER_COLOR);[m
[32m+[m[32m            if (footerColorSet != null) {[m
[32m+[m[32m                footerColor = footerColorSet;[m
             }[m
         }[m
 [m
[36m@@ -577,13 +641,60 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
              */[m
             private int dpToPixels(int dipValue) {[m
                 int value = (int) TypedValue.applyDimension( TypedValue.COMPLEX_UNIT_DIP,[m
[31m-                                                            (float) dipValue,[m
[31m-                                                            cordova.getActivity().getResources().getDisplayMetrics()[m
[32m+[m[32m                        (float) dipValue,[m
[32m+[m[32m                        cordova.getActivity().getResources().getDisplayMetrics()[m
                 );[m
 [m
                 return value;[m
             }[m
 [m
[32m+[m[32m            private View createCloseButton(int id){[m
[32m+[m[32m                View _close;[m
[32m+[m[32m                Resources activityRes = cordova.getActivity().getResources();[m
[32m+[m
[32m+[m[32m                if (closeButtonCaption != "") {[m
[32m+[m[32m                    // Use TextView for text[m
[32m+[m[32m                    TextView close = new TextView(cordova.getActivity());[m
[32m+[m[32m                    close.setText(closeButtonCaption);[m
[32m+[m[32m                    close.setTextSize(20);[m
[32m+[m[32m                    if (closeButtonColor != "") close.setTextColor(android.graphics.Color.parseColor(closeButtonColor));[m
[32m+[m[32m                    close.setGravity(android.view.Gravity.CENTER_VERTICAL);[m
[32m+[m[32m                    close.setPadding(this.dpToPixels(10), 0, this.dpToPixels(10), 0);[m
[32m+[m[32m                    _close = close;[m
[32m+[m[32m                }[m
[32m+[m[32m                else {[m
[32m+[m[32m                    ImageButton close = new ImageButton(cordova.getActivity());[m
[32m+[m[32m                    int closeResId = activityRes.getIdentifier("ic_action_remove", "drawable", cordova.getActivity().getPackageName());[m
[32m+[m[32m                    Drawable closeIcon = activityRes.getDrawable(closeResId);[m
[32m+[m[32m                    if (closeButtonColor != "") close.setColorFilter(android.graphics.Color.parseColor(closeButtonColor));[m
[32m+[m[32m                    close.setImageDrawable(closeIcon);[m
[32m+[m[32m                    close.setScaleType(ImageView.ScaleType.FIT_CENTER);[m
[32m+[m[32m                    if (Build.VERSION.SDK_INT >= 16)[m
[32m+[m[32m                        close.getAdjustViewBounds();[m
[32m+[m
[32m+[m[32m                    _close = close;[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                RelativeLayout.LayoutParams closeLayoutParams = new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.MATCH_PARENT);[m
[32m+[m[32m                closeLayoutParams.addRule(RelativeLayout.ALIGN_PARENT_RIGHT);[m
[32m+[m[32m                _close.setLayoutParams(closeLayoutParams);[m
[32m+[m
[32m+[m[32m                if (Build.VERSION.SDK_INT >= 16)[m
[32m+[m[32m                    _close.setBackground(null);[m
[32m+[m[32m                else[m
[32m+[m[32m                    _close.setBackgroundDrawable(null);[m
[32m+[m
[32m+[m[32m                _close.setContentDescription("Close Button");[m
[32m+[m[32m                _close.setId(Integer.valueOf(id));[m
[32m+[m[32m                _close.setOnClickListener(new View.OnClickListener() {[m
[32m+[m[32m                    public void onClick(View v) {[m
[32m+[m[32m                        closeDialog();[m
[32m+[m[32m                    }[m
[32m+[m[32m                });[m
[32m+[m
[32m+[m[32m                return _close;[m
[32m+[m[32m            }[m
[32m+[m
             @SuppressLint("NewApi")[m
             public void run() {[m
 [m
[36m@@ -606,7 +717,7 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
                 // Toolbar layout[m
                 RelativeLayout toolbar = new RelativeLayout(cordova.getActivity());[m
                 //Please, no more black![m
[31m-                toolbar.setBackgroundColor(android.graphics.Color.LTGRAY);[m
[32m+[m[32m                toolbar.setBackgroundColor(toolbarColor);[m
                 toolbar.setLayoutParams(new RelativeLayout.LayoutParams(LayoutParams.MATCH_PARENT, this.dpToPixels(44)));[m
                 toolbar.setPadding(this.dpToPixels(2), this.dpToPixels(2), this.dpToPixels(2), this.dpToPixels(2));[m
                 toolbar.setHorizontalGravity(Gravity.LEFT);[m
[36m@@ -629,6 +740,7 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
                 Resources activityRes = cordova.getActivity().getResources();[m
                 int backResId = activityRes.getIdentifier("ic_action_previous_item", "drawable", cordova.getActivity().getPackageName());[m
                 Drawable backIcon = activityRes.getDrawable(backResId);[m
[32m+[m[32m                if (navigationButtonColor != "") back.setColorFilter(android.graphics.Color.parseColor(navigationButtonColor));[m
                 if (Build.VERSION.SDK_INT >= 16)[m
                     back.setBackground(null);[m
                 else[m
[36m@@ -654,6 +766,7 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
                 forward.setId(Integer.valueOf(3));[m
                 int fwdResId = activityRes.getIdentifier("ic_action_next_item", "drawable", cordova.getActivity().getPackageName());[m
                 Drawable fwdIcon = activityRes.getDrawable(fwdResId);[m
[32m+[m[32m                if (navigationButtonColor != "") forward.setColorFilter(android.graphics.Color.parseColor(navigationButtonColor));[m
                 if (Build.VERSION.SDK_INT >= 16)[m
                     forward.setBackground(null);[m
                 else[m
[36m@@ -686,43 +799,85 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
                     public boolean onKey(View v, int keyCode, KeyEvent event) {[m
                         // If the event is a key-down event on the "enter" button[m
                         if ((event.getAction() == KeyEvent.ACTION_DOWN) && (keyCode == KeyEvent.KEYCODE_ENTER)) {[m
[31m-                          navigate(edittext.getText().toString());[m
[31m-                          return true;[m
[32m+[m[32m                            navigate(edittext.getText().toString());[m
[32m+[m[32m                            return true;[m
                         }[m
                         return false;[m
                     }[m
                 });[m
 [m
[31m-                // Close/Done button[m
[31m-                ImageButton close = new ImageButton(cordova.getActivity());[m
[31m-                RelativeLayout.LayoutParams closeLayoutParams = new RelativeLayout.LayoutParams(LayoutParams.WRAP_CONTENT, LayoutParams.MATCH_PARENT);[m
[31m-                closeLayoutParams.addRule(RelativeLayout.ALIGN_PARENT_RIGHT);[m
[31m-                close.setLayoutParams(closeLayoutParams);[m
[31m-                close.setContentDescription("Close Button");[m
[31m-                close.setId(Integer.valueOf(5));[m
[31m-                int closeResId = activityRes.getIdentifier("ic_action_remove", "drawable", cordova.getActivity().getPackageName());[m
[31m-                Drawable closeIcon = activityRes.getDrawable(closeResId);[m
[31m-                if (Build.VERSION.SDK_INT >= 16)[m
[31m-                    close.setBackground(null);[m
[31m-                else[m
[31m-                    close.setBackgroundDrawable(null);[m
[31m-                close.setImageDrawable(closeIcon);[m
[31m-                close.setScaleType(ImageView.ScaleType.FIT_CENTER);[m
[31m-                back.setPadding(0, this.dpToPixels(10), 0, this.dpToPixels(10));[m
[31m-                if (Build.VERSION.SDK_INT >= 16)[m
[31m-                    close.getAdjustViewBounds();[m
 [m
[31m-                close.setOnClickListener(new View.OnClickListener() {[m
[31m-                    public void onClick(View v) {[m
[31m-                        closeDialog();[m
[31m-                    }[m
[31m-                });[m
[32m+[m[32m                // Header Close/Done button[m
[32m+[m[32m                View close = createCloseButton(5);[m
[32m+[m[32m                toolbar.addView(close);[m
[32m+[m
[32m+[m[32m                // Footer[m
[32m+[m[32m                RelativeLayout footer = new RelativeLayout(cordova.getActivity());[m
[32m+[m[32m                int _footerColor;[m
[32m+[m[32m                if(footerColor != ""){[m
[32m+[m[32m                    _footerColor = Color.parseColor(footerColor);[m
[32m+[m[32m                }else{[m
[32m+[m[32m                    _footerColor = android.graphics.Color.LTGRAY;[m
[32m+[m[32m                }[m
[32m+[m[32m                footer.setBackgroundColor(_footerColor);[m
[32m+[m[32m                RelativeLayout.LayoutParams footerLayout = new RelativeLayout.LayoutParams(LayoutParams.MATCH_PARENT, this.dpToPixels(44));[m
[32m+[m[32m                footerLayout.addRule(RelativeLayout.ALIGN_PARENT_BOTTOM, RelativeLayout.TRUE);[m
[32m+[m[32m                footer.setLayoutParams(footerLayout);[m
[32m+[m[32m                if (closeButtonCaption != "") footer.setPadding(this.dpToPixels(8), this.dpToPixels(8), this.dpToPixels(8), this.dpToPixels(8));[m
[32m+[m[32m                footer.setHorizontalGravity(Gravity.LEFT);[m
[32m+[m[32m                footer.setVerticalGravity(Gravity.BOTTOM);[m
[32m+[m
[32m+[m[32m                View footerClose = createCloseButton(7);[m
[32m+[m[32m                footer.addView(footerClose);[m
[32m+[m
 [m
                 // WebView[m
                 inAppWebView = new WebView(cordova.getActivity());[m
                 inAppWebView.setLayoutParams(new LinearLayout.LayoutParams(LayoutParams.MATCH_PARENT, LayoutParams.MATCH_PARENT));[m
                 inAppWebView.setId(Integer.valueOf(6));[m
[31m-                inAppWebView.setWebChromeClient(new InAppChromeClient(thatWebView));[m
[32m+[m[32m                // File Chooser Implemented ChromeClient[m
[32m+[m[32m                inAppWebView.setWebChromeClient(new InAppChromeClient(thatWebView) {[m
[32m+[m[32m                    // For Android 5.0+[m
[32m+[m[32m                    public boolean onShowFileChooser (WebView webView, ValueCallback<Uri[]> filePathCallback, WebChromeClient.FileChooserParams fileChooserParams)[m
[32m+[m[32m                    {[m
[32m+[m[32m                        LOG.d(LOG_TAG, "File Chooser 5.0+");[m
[32m+[m[32m                        // If callback exists, finish it.[m
[32m+[m[32m                        if(mUploadCallbackLollipop != null) {[m
[32m+[m[32m                            mUploadCallbackLollipop.onReceiveValue(null);[m
[32m+[m[32m                        }[m
[32m+[m[32m                        mUploadCallbackLollipop = filePathCallback;[m
[32m+[m
[32m+[m[32m                        // Create File Chooser Intent[m
[32m+[m[32m                        Intent content = new Intent(Intent.ACTION_GET_CONTENT);[m
[32m+[m[32m                        content.addCategory(Intent.CATEGORY_OPENABLE);[m
[32m+[m[32m                        content.setType("*/*");[m
[32m+[m
[32m+[m[32m                        // Run cordova startActivityForResult[m
[32m+[m[32m                        cordova.startActivityForResult(InAppBrowser.this, Intent.createChooser(content, "Select File"), FILECHOOSER_REQUESTCODE_LOLLIPOP);[m
[32m+[m[32m                        return true;[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    // For Android 4.1+[m
[32m+[m[32m                    public void openFileChooser(ValueCallback<Uri> uploadMsg, String acceptType, String capture)[m
[32m+[m[32m                    {[m
[32m+[m[32m                        LOG.d(LOG_TAG, "File Chooser 4.1+");[m
[32m+[m[32m                        // Call file chooser for Android 3.0+[m
[32m+[m[32m                        openFileChooser(uploadMsg, acceptType);[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    // For Android 3.0+[m
[32m+[m[32m                    public void openFileChooser(ValueCallback<Uri> uploadMsg, String acceptType)[m
[32m+[m[32m                    {[m
[32m+[m[32m                        LOG.d(LOG_TAG, "File Chooser 3.0+");[m
[32m+[m[32m                        mUploadCallback = uploadMsg;[m
[32m+[m[32m                        Intent content = new Intent(Intent.ACTION_GET_CONTENT);[m
[32m+[m[32m                        content.addCategory(Intent.CATEGORY_OPENABLE);[m
[32m+[m
[32m+[m[32m                        // run startActivityForResult[m
[32m+[m[32m                        cordova.startActivityForResult(InAppBrowser.this, Intent.createChooser(content, "Select File"), FILECHOOSER_REQUESTCODE);[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                });[m
                 WebViewClient client = new InAppBrowserClient(thatWebView, edittext);[m
                 inAppWebView.setWebViewClient(client);[m
                 WebSettings settings = inAppWebView.getSettings();[m
[36m@@ -761,6 +916,11 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
                     CookieManager.getInstance().removeSessionCookie();[m
                 }[m
 [m
[32m+[m[32m                // Enable Thirdparty Cookies on >=Android 5.0 device[m
[32m+[m[32m                if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.LOLLIPOP) {[m
[32m+[m[32m                    CookieManager.getInstance().setAcceptThirdPartyCookies(inAppWebView,true);[m
[32m+[m[32m                }[m
[32m+[m
                 inAppWebView.loadUrl(url);[m
                 inAppWebView.setId(Integer.valueOf(6));[m
                 inAppWebView.getSettings().setLoadWithOverviewMode(true);[m
[36m@@ -772,10 +932,9 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
                 actionButtonContainer.addView(back);[m
                 actionButtonContainer.addView(forward);[m
 [m
[31m-                // Add the views to our toolbar[m
[31m-                toolbar.addView(actionButtonContainer);[m
[31m-                toolbar.addView(edittext);[m
[31m-                toolbar.addView(close);[m
[32m+[m[32m                // Add the views to our toolbar if they haven't been disabled[m
[32m+[m[32m                if (!hideNavigationButtons) toolbar.addView(actionButtonContainer);[m
[32m+[m[32m                if (!hideUrlBar) toolbar.addView(edittext);[m
 [m
                 // Don't add the toolbar if its been disabled[m
                 if (getShowLocationBar()) {[m
[36m@@ -784,7 +943,14 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
                 }[m
 [m
                 // Add our webview to our main view/layout[m
[31m-                main.addView(inAppWebView);[m
[32m+[m[32m                RelativeLayout webViewLayout = new RelativeLayout(cordova.getActivity());[m
[32m+[m[32m                webViewLayout.addView(inAppWebView);[m
[32m+[m[32m                main.addView(webViewLayout);[m
[32m+[m
[32m+[m[32m                // Don't add the footer unless it's been enabled[m
[32m+[m[32m                if (showFooter) {[m
[32m+[m[32m                    webViewLayout.addView(footer);[m
[32m+[m[32m                }[m
 [m
                 WindowManager.LayoutParams lp = new WindowManager.LayoutParams();[m
                 lp.copyFrom(dialog.getWindow().getAttributes());[m
[36m@@ -831,6 +997,42 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
         }[m
     }[m
 [m
[32m+[m[32m    /**[m
[32m+[m[32m     * Receive File Data from File Chooser[m
[32m+[m[32m     *[m
[32m+[m[32m     * @param requestCode the requested code from chromeclient[m
[32m+[m[32m     * @param resultCode the result code returned from android system[m
[32m+[m[32m     * @param intent the data from android file chooser[m
[32m+[m[32m     */[m
[32m+[m[32m    public void onActivityResult(int requestCode, int resultCode, Intent intent) {[m
[32m+[m[32m        // For Android >= 5.0[m
[32m+[m[32m        if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {[m
[32m+[m[32m            LOG.d(LOG_TAG, "onActivityResult (For Android >= 5.0)");[m
[32m+[m[32m            // If RequestCode or Callback is Invalid[m
[32m+[m[32m            if(requestCode != FILECHOOSER_REQUESTCODE_LOLLIPOP || mUploadCallbackLollipop == null) {[m
[32m+[m[32m                super.onActivityResult(requestCode, resultCode, intent);[m
[32m+[m[32m                return;[m
[32m+[m[32m            }[m
[32m+[m[32m            mUploadCallbackLollipop.onReceiveValue(WebChromeClient.FileChooserParams.parseResult(resultCode, intent));[m
[32m+[m[32m            mUploadCallbackLollipop = null;[m
[32m+[m[32m        }[m
[32m+[m[32m        // For Android < 5.0[m
[32m+[m[32m        else {[m
[32m+[m[32m            LOG.d(LOG_TAG, "onActivityResult (For Android < 5.0)");[m
[32m+[m[32m            // If RequestCode or Callback is Invalid[m
[32m+[m[32m            if(requestCode != FILECHOOSER_REQUESTCODE || mUploadCallback == null) {[m
[32m+[m[32m                super.onActivityResult(requestCode, resultCode, intent);[m
[32m+[m[32m                return;[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            if (null == mUploadCallback) return;[m
[32m+[m[32m            Uri result = intent == null || resultCode != cordova.getActivity().RESULT_OK ? null : intent.getData();[m
[32m+[m
[32m+[m[32m            mUploadCallback.onReceiveValue(result);[m
[32m+[m[32m            mUploadCallback = null;[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
     /**[m
      * The webview client receives notifications about appView[m
      */[m
[36m@@ -909,6 +1111,29 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
                     LOG.e(LOG_TAG, "Error sending sms " + url + ":" + e.toString());[m
                 }[m
             }[m
[32m+[m[32m            // Test for whitelisted custom scheme names like mycoolapp:// or twitteroauthresponse:// (Twitter Oauth Response)[m
[32m+[m[32m            else if (!url.startsWith("http:") && !url.startsWith("https:") && url.matches("^[a-z]*://.*?$")) {[m
[32m+[m[32m                if (allowedSchemes == null) {[m
[32m+[m[32m                    String allowed = preferences.getString("AllowedSchemes", "");[m
[32m+[m[32m                    allowedSchemes = allowed.split(",");[m
[32m+[m[32m                }[m
[32m+[m[32m                if (allowedSchemes != null) {[m
[32m+[m[32m                    for (String scheme : allowedSchemes) {[m
[32m+[m[32m                        if (url.startsWith(scheme)) {[m
[32m+[m[32m                            try {[m
[32m+[m[32m                                JSONObject obj = new JSONObject();[m
[32m+[m[32m                                obj.put("type", "customscheme");[m
[32m+[m[32m                                obj.put("url", url);[m
[32m+[m[32m                                sendUpdate(obj, true);[m
[32m+[m[32m                                return true;[m
[32m+[m[32m                            } catch (JSONException ex) {[m
[32m+[m[32m                                LOG.e(LOG_TAG, "Custom Scheme URI passed in has caused a JSON error.");[m
[32m+[m[32m                            }[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
             return false;[m
         }[m
 [m
[36m@@ -938,7 +1163,7 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
             // Update the UI if we haven't already[m
             if (!newloc.equals(edittext.getText().toString())) {[m
                 edittext.setText(newloc);[m
[31m-             }[m
[32m+[m[32m            }[m
 [m
             try {[m
                 JSONObject obj = new JSONObject();[m
[36m@@ -962,6 +1187,10 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
                 CookieSyncManager.getInstance().sync();[m
             }[m
 [m
[32m+[m[32m            // https://issues.apache.org/jira/browse/CB-11248[m
[32m+[m[32m            view.clearFocus();[m
[32m+[m[32m            view.requestFocus();[m
[32m+[m
             try {[m
                 JSONObject obj = new JSONObject();[m
                 obj.put("type", LOAD_STOP_EVENT);[m
[36m@@ -1027,4 +1256,4 @@[m [mpublic class InAppBrowser extends CordovaPlugin {[m
             super.onReceivedHttpAuthRequest(view, handler, host, realm);[m
         }[m
     }[m
[31m-}[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/README.md b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/README.md[m
[1mdeleted file mode 100644[m
[1mindex f0fa860..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/README.md[m
[1m+++ /dev/null[m
[36m@@ -1,43 +0,0 @@[m
[31m-<!---[m
[31m- license: Licensed to the Apache Software Foundation (ASF) under one[m
[31m-         or more contributor license agreements.  See the NOTICE file[m
[31m-         distributed with this work for additional information[m
[31m-         regarding copyright ownership.  The ASF licenses this file[m
[31m-         to you under the Apache License, Version 2.0 (the[m
[31m-         "License"); you may not use this file except in compliance[m
[31m-         with the License.  You may obtain a copy of the License at[m
[31m-[m
[31m-           http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-         Unless required by applicable law or agreed to in writing,[m
[31m-         software distributed under the License is distributed on an[m
[31m-         "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-         KIND, either express or implied.  See the License for the[m
[31m-         specific language governing permissions and limitations[m
[31m-         under the License.[m
[31m--->[m
[31m-# BlackBerry 10 In-App-Browser Plugin[m
[31m-[m
[31m-The in app browser functionality is entirely contained within common js. There is no native implementation required.[m
[31m-To install this plugin, follow the [Command-line Interface Guide](http://cordova.apache.org/docs/en/edge/guide_cli_index.md.html#The%20Command-line%20Interface).[m
[31m-[m
[31m-If you are not using the Cordova Command-line Interface, follow [Using Plugman to Manage Plugins](http://cordova.apache.org/docs/en/edge/guide_plugin_ref_plugman.md.html).[m
[31m-./cordova-plugin-battery-status/README.md[m
[31m-./cordova-plugin-camera/README.md[m
[31m-./cordova-plugin-console/README.md[m
[31m-./cordova-plugin-contacts/README.md[m
[31m-./cordova-plugin-device/README.md[m
[31m-./cordova-plugin-device-motion/README.md[m
[31m-./cordova-plugin-device-orientation/README.md[m
[31m-./cordova-plugin-device-orientation/src/blackberry10/README.md[m
[31m-./cordova-plugin-file/README.md[m
[31m-./cordova-plugin-file-transfer/README.md[m
[31m-./cordova-plugin-geolocation/README.md[m
[31m-./cordova-plugin-globalization/README.md[m
[31m-./cordova-plugin-inappbrowser/README.md[m
[31m-./cordova-plugin-inappbrowser/src/blackberry10/README.md[m
[31m-./cordova-plugin-media/README.md[m
[31m-./cordova-plugin-media-capture/README.md[m
[31m-./cordova-plugin-network-information/README.md[m
[31m-./cordova-plugin-splashscreen/README.md[m
[31m-./cordova-plugin-vibration/README.md[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/de/README.md b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/de/README.md[m
[1mdeleted file mode 100644[m
[1mindex e394487..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/de/README.md[m
[1m+++ /dev/null[m
[36m@@ -1,24 +0,0 @@[m
[31m-<!---[m
[31m- license: Licensed to the Apache Software Foundation (ASF) under one[m
[31m-         or more contributor license agreements.  See the NOTICE file[m
[31m-         distributed with this work for additional information[m
[31m-         regarding copyright ownership.  The ASF licenses this file[m
[31m-         to you under the Apache License, Version 2.0 (the[m
[31m-         "License"); you may not use this file except in compliance[m
[31m-         with the License.  You may obtain a copy of the License at[m
[31m-[m
[31m-           http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-         Unless required by applicable law or agreed to in writing,[m
[31m-         software distributed under the License is distributed on an[m
[31m-         "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-         KIND, either express or implied.  See the License for the[m
[31m-         specific language governing permissions and limitations[m
[31m-         under the License.[m
[31m--->[m
[31m-[m
[31m-# BlackBerry 10-In-App-Browser-Plugin[m
[31m-[m
[31m-Die Funktionalität ist im app-Browser vollständig in gemeinsamen Js enthalten. Es gibt keine native Implementierung benötigt. Um dieses Plugin zu installieren, folgen Sie dem [Command-Line Interface Guide](http://cordova.apache.org/docs/en/edge/guide_cli_index.md.html#The%20Command-line%20Interface).[m
[31m-[m
[31m-Wenn Sie nicht die Cordova-Befehlszeilenschnittstelle verwenden, folgen Sie [Verwenden Plugman zu Plugins verwalten](http://cordova.apache.org/docs/en/edge/guide_plugin_ref_plugman.md.html). ./cordova-plugin-battery-status/README.md ./cordova-plugin-camera/README.md ./cordova-plugin-console/README.md ./cordova-plugin-contacts/README.md ./cordova-plugin-device/README.md ./cordova-plugin-device-motion/README.md ./cordova-plugin-device-orientation/README.md ./cordova-plugin-device-orientation/src/blackberry10/README.md ./cordova-plugin-file/README.md ./cordova-plugin-file-transfer/README.md ./cordova-plugin-geolocation/README.md ./cordova-plugin-globalization/README.md ./cordova-plugin-inappbrowser/README.md ./cordova-plugin-inappbrowser/src/blackberry10/README.md ./cordova-plugin-media/README.md ./cordova-plugin-media-capture/README.md ./cordova-plugin-network-information/README.md ./cordova-plugin-splashscreen/README.md ./cordova-plugin-vibration/README.md[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/es/README.md b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/es/README.md[m
[1mdeleted file mode 100644[m
[1mindex 7530336..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/es/README.md[m
[1m+++ /dev/null[m
[36m@@ -1,24 +0,0 @@[m
[31m-<!---[m
[31m- license: Licensed to the Apache Software Foundation (ASF) under one[m
[31m-         or more contributor license agreements.  See the NOTICE file[m
[31m-         distributed with this work for additional information[m
[31m-         regarding copyright ownership.  The ASF licenses this file[m
[31m-         to you under the Apache License, Version 2.0 (the[m
[31m-         "License"); you may not use this file except in compliance[m
[31m-         with the License.  You may obtain a copy of the License at[m
[31m-[m
[31m-           http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-         Unless required by applicable law or agreed to in writing,[m
[31m-         software distributed under the License is distributed on an[m
[31m-         "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-         KIND, either express or implied.  See the License for the[m
[31m-         specific language governing permissions and limitations[m
[31m-         under the License.[m
[31m--->[m
[31m-[m
[31m-# BlackBerry 10 In-App-Browser Plugin[m
[31m-[m
[31m-El en el navegador de aplicación funcionalidad está enteramente dentro de js común. No hay ninguna aplicación nativa necesaria. Para instalar este plugin, siga la [Guía de la interfaz de línea de comandos](http://cordova.apache.org/docs/en/edge/guide_cli_index.md.html#The%20Command-line%20Interface).[m
[31m-[m
[31m-Si no utiliza la interfaz de línea de comandos de Cordova, siga [Usando Plugman para gestionar Plugins](http://cordova.apache.org/docs/en/edge/guide_plugin_ref_plugman.md.html). ./cordova-plugin-battery-status/README.md ./cordova-plugin-camera/README.md ./cordova-plugin-console/README.md ./cordova-plugin-contacts/README.md ./cordova-plugin-device/README.md ./cordova-plugin-device-motion/README.md ./cordova-plugin-device-orientation/README.md ./cordova-plugin-device-orientation/src/blackberry10/README.md ./cordova-plugin-file/README.md ./cordova-plugin-file-transfer/README.md ./cordova-plugin-geolocation/README.md ./cordova-plugin-globalization/README.md ./cordova-plugin-inappbrowser/README.md ./cordova-plugin-inappbrowser/src/blackberry10/README.md ./cordova-plugin-media/README.md ./cordova-plugin-media-capture/README.md ./cordova-plugin-network-information/README.md ./cordova-plugin-splashscreen/README.md ./cordova-plugin-vibration/README.md[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/fr/README.md b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/fr/README.md[m
[1mdeleted file mode 100644[m
[1mindex 179bd48..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/fr/README.md[m
[1m+++ /dev/null[m
[36m@@ -1,24 +0,0 @@[m
[31m-<!---[m
[31m- license: Licensed to the Apache Software Foundation (ASF) under one[m
[31m-         or more contributor license agreements.  See the NOTICE file[m
[31m-         distributed with this work for additional information[m
[31m-         regarding copyright ownership.  The ASF licenses this file[m
[31m-         to you under the Apache License, Version 2.0 (the[m
[31m-         "License"); you may not use this file except in compliance[m
[31m-         with the License.  You may obtain a copy of the License at[m
[31m-[m
[31m-           http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-         Unless required by applicable law or agreed to in writing,[m
[31m-         software distributed under the License is distributed on an[m
[31m-         "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-         KIND, either express or implied.  See the License for the[m
[31m-         specific language governing permissions and limitations[m
[31m-         under the License.[m
[31m--->[m
[31m-[m
[31m-# BlackBerry 10 In-App-Browser Plugin[m
[31m-[m
[31m-Le dans le navigateur de l'application, la fonctionnalité est entièrement contenue dans js commun. Il n'y a aucune implémentation native requise. Pour installer ce plugin, suivez le [Guide de l'Interface de ligne de commande](http://cordova.apache.org/docs/en/edge/guide_cli_index.md.html#The%20Command-line%20Interface).[m
[31m-[m
[31m-Si vous n'utilisez pas l'Interface de ligne de commande de Cordova, suivez [Les Plugman à l'aide à gérer les Plugins](http://cordova.apache.org/docs/en/edge/guide_plugin_ref_plugman.md.html). ./cordova-plugin-battery-status/README.md ./cordova-plugin-camera/README.md ./cordova-plugin-console/README.md ./cordova-plugin-contacts/README.md ./cordova-plugin-device/README.md ./cordova-plugin-device-motion/README.md ./cordova-plugin-device-orientation/README.md ./cordova-plugin-device-orientation/src/blackberry10/README.md ./cordova-plugin-file/README.md ./cordova-plugin-file-transfer/README.md ./cordova-plugin-geolocation/README.md ./cordova-plugin-globalization/README.md ./cordova-plugin-inappbrowser/README.md ./cordova-plugin-inappbrowser/src/blackberry10/README.md ./cordova-plugin-media/README.md ./cordova-plugin-media-capture/README.md ./cordova-plugin-network-information/README.md ./cordova-plugin-splashscreen/README.md ./cordova-plugin-vibration/README.md[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/it/README.md b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/it/README.md[m
[1mdeleted file mode 100644[m
[1mindex 8f0623d..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/it/README.md[m
[1m+++ /dev/null[m
[36m@@ -1,24 +0,0 @@[m
[31m-<!---[m
[31m- license: Licensed to the Apache Software Foundation (ASF) under one[m
[31m-         or more contributor license agreements.  See the NOTICE file[m
[31m-         distributed with this work for additional information[m
[31m-         regarding copyright ownership.  The ASF licenses this file[m
[31m-         to you under the Apache License, Version 2.0 (the[m
[31m-         "License"); you may not use this file except in compliance[m
[31m-         with the License.  You may obtain a copy of the License at[m
[31m-[m
[31m-           http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-         Unless required by applicable law or agreed to in writing,[m
[31m-         software distributed under the License is distributed on an[m
[31m-         "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-         KIND, either express or implied.  See the License for the[m
[31m-         specific language governing permissions and limitations[m
[31m-         under the License.[m
[31m--->[m
[31m-[m
[31m-# BlackBerry 10 In-App-Browser Plugin[m
[31m-[m
[31m-Il browser app funzionalità è interamente contenuta nel comune js. Non esiste alcuna implementazione nativa richiesto. Per installare questo plugin, seguire la [Guida per l'interfaccia della riga di comando](http://cordova.apache.org/docs/en/edge/guide_cli_index.md.html#The%20Command-line%20Interface).[m
[31m-[m
[31m-Se non si utilizza l'interfaccia della riga di comando di Cordova, seguire [Utilizzando Plugman per gestire i plugin](http://cordova.apache.org/docs/en/edge/guide_plugin_ref_plugman.md.html). ./cordova-plugin-battery-status/README.md ./cordova-plugin-camera/README.md ./cordova-plugin-console/README.md ./cordova-plugin-contacts/README.md ./cordova-plugin-device/README.md ./cordova-plugin-device-motion/README.md ./cordova-plugin-device-orientation/README.md ./cordova-plugin-device-orientation/src/blackberry10/README.md ./cordova-plugin-file/README.md ./cordova-plugin-file-transfer/README.md ./cordova-plugin-geolocation/README.md ./cordova-plugin-globalization/README.md ./cordova-plugin-inappbrowser/README.md ./cordova-plugin-inappbrowser/src/blackberry10/README.md ./cordova-plugin-media/README.md ./cordova-plugin-media-capture/README.md ./cordova-plugin-network-information/README.md ./cordova-plugin-splashscreen/README.md ./cordova-plugin-vibration/README.md[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/ja/README.md b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/ja/README.md[m
[1mdeleted file mode 100644[m
[1mindex b9e4b7b..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/ja/README.md[m
[1m+++ /dev/null[m
[36m@@ -1,24 +0,0 @@[m
[31m-<!---[m
[31m- license: Licensed to the Apache Software Foundation (ASF) under one[m
[31m-         or more contributor license agreements.  See the NOTICE file[m
[31m-         distributed with this work for additional information[m
[31m-         regarding copyright ownership.  The ASF licenses this file[m
[31m-         to you under the Apache License, Version 2.0 (the[m
[31m-         "License"); you may not use this file except in compliance[m
[31m-         with the License.  You may obtain a copy of the License at[m
[31m-[m
[31m-           http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-         Unless required by applicable law or agreed to in writing,[m
[31m-         software distributed under the License is distributed on an[m
[31m-         "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-         KIND, either express or implied.  See the License for the[m
[31m-         specific language governing permissions and limitations[m
[31m-         under the License.[m
[31m--->[m
[31m-[m
[31m-# BlackBerry 10 In-App-Browser Plugin[m
[31m-[m
[31m-アプリケーション ブラウザーの機能は全く一般的な js に含まれています。 ネイティブ実装する必要はありません。 このプラグインをインストールするには[コマンド ライン インターフェイス ガイド](http://cordova.apache.org/docs/en/edge/guide_cli_index.md.html#The%20Command-line%20Interface).[m
[31m-[m
[31m-コルドバのコマンド ライン インターフェイスを使用していない場合は場合、[管理のプラグインを使用して Plugman](http://cordova.apache.org/docs/en/edge/guide_plugin_ref_plugman.md.html)に従ってください。 ./cordova-plugin-battery-status/README.md ./cordova-plugin-camera/README.md ./cordova-plugin-console/README.md ./cordova-plugin-contacts/README.md ./cordova-plugin-device/README.md ./cordova-plugin-device-motion/README.md ./cordova-plugin-device-orientation/README.md ./cordova-plugin-device-orientation/src/blackberry10/README.md ./cordova-plugin-file/README.md ./cordova-plugin-file-transfer/README.md ./cordova-plugin-geolocation/README.md ./cordova-plugin-globalization/README.md ./cordova-plugin-inappbrowser/README.md ./cordova-plugin-inappbrowser/src/blackberry10/README.md ./cordova-plugin-media/README.md ./cordova-plugin-media-capture/README.md ./cordova-plugin-network-information/README.md ./cordova-plugin-splashscreen/README.md ./cordova-plugin-vibration/README.md[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/ko/README.md b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/ko/README.md[m
[1mdeleted file mode 100644[m
[1mindex 67fb8de..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/ko/README.md[m
[1m+++ /dev/null[m
[36m@@ -1,24 +0,0 @@[m
[31m-<!---[m
[31m- license: Licensed to the Apache Software Foundation (ASF) under one[m
[31m-         or more contributor license agreements.  See the NOTICE file[m
[31m-         distributed with this work for additional information[m
[31m-         regarding copyright ownership.  The ASF licenses this file[m
[31m-         to you under the Apache License, Version 2.0 (the[m
[31m-         "License"); you may not use this file except in compliance[m
[31m-         with the License.  You may obtain a copy of the License at[m
[31m-[m
[31m-           http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-         Unless required by applicable law or agreed to in writing,[m
[31m-         software distributed under the License is distributed on an[m
[31m-         "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-         KIND, either express or implied.  See the License for the[m
[31m-         specific language governing permissions and limitations[m
[31m-         under the License.[m
[31m--->[m
[31m-[m
[31m-# 블랙베리 10 애플 리 케이 션-브라우저 플러그인[m
[31m-[m
[31m-응용 프로그램 브라우저에서 기능은 완전히 포함 된 일반적인 js. 필요 없는 기본 구현이입니다. 이 플러그인을 설치 하려면 [명령줄 인터페이스 가이드](http://cordova.apache.org/docs/en/edge/guide_cli_index.md.html#The%20Command-line%20Interface) 를 따라합니다.[m
[31m-[m
[31m-코르도바 명령줄 인터페이스를 사용 하지 않는 경우 [관리 플러그인을 사용 하 여 Plugman](http://cordova.apache.org/docs/en/edge/guide_plugin_ref_plugman.md.html)를 따르십시오. ./cordova-plugin-battery-status/README.md ./cordova-plugin-camera/README.md ./cordova-plugin-console/README.md ./cordova-plugin-contacts/README.md ./cordova-plugin-device/README.md ./cordova-plugin-device-motion/README.md ./cordova-plugin-device-orientation/README.md ./cordova-plugin-device-orientation/src/blackberry10/README.md ./cordova-plugin-file/README.md ./cordova-plugin-file-transfer/README.md ./cordova-plugin-geolocation/README.md ./cordova-plugin-globalization/README.md ./cordova-plugin-inappbrowser/README.md ./cordova-plugin-inappbrowser/src/blackberry10/README.md ./cordova-plugin-media/README.md ./cordova-plugin-media-capture/README.md ./cordova-plugin-network-information/README.md ./cordova-plugin-splashscreen/README.md ./cordova-plugin-vibration/README.md[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/pl/README.md b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/pl/README.md[m
[1mdeleted file mode 100644[m
[1mindex ef199ee..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/pl/README.md[m
[1m+++ /dev/null[m
[36m@@ -1,24 +0,0 @@[m
[31m-<!---[m
[31m- license: Licensed to the Apache Software Foundation (ASF) under one[m
[31m-         or more contributor license agreements.  See the NOTICE file[m
[31m-         distributed with this work for additional information[m
[31m-         regarding copyright ownership.  The ASF licenses this file[m
[31m-         to you under the Apache License, Version 2.0 (the[m
[31m-         "License"); you may not use this file except in compliance[m
[31m-         with the License.  You may obtain a copy of the License at[m
[31m-[m
[31m-           http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-         Unless required by applicable law or agreed to in writing,[m
[31m-         software distributed under the License is distributed on an[m
[31m-         "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-         KIND, either express or implied.  See the License for the[m
[31m-         specific language governing permissions and limitations[m
[31m-         under the License.[m
[31m--->[m
[31m-[m
[31m-# BlackBerry 10 In-App-Browser Plugin[m
[31m-[m
[31m-W aplikacji Przeglądarka funkcjonalność jest całkowicie zawarty w wspólnej js. Tam jest nie native wdrażania wymagane. Aby zainstalować ten plugin, następować po ten [Przewodnik interfejsu wiersza polecenia](http://cordova.apache.org/docs/en/edge/guide_cli_index.md.html#The%20Command-line%20Interface).[m
[31m-[m
[31m-Jeśli nie używasz interfejsu wiersza polecenia Cordova, następować po [Przy użyciu Plugman do zarządzania wtyczki](http://cordova.apache.org/docs/en/edge/guide_plugin_ref_plugman.md.html). ./cordova-plugin-battery-status/README.md ./cordova-plugin-camera/README.md ./cordova-plugin-console/README.md ./cordova-plugin-contacts/README.md ./cordova-plugin-device/README.md ./cordova-plugin-device-motion/README.md ./cordova-plugin-device-orientation/README.md ./cordova-plugin-device-orientation/src/blackberry10/README.md ./cordova-plugin-file/README.md ./cordova-plugin-file-transfer/README.md ./cordova-plugin-geolocation/README.md ./cordova-plugin-globalization/README.md ./cordova-plugin-inappbrowser/README.md ./cordova-plugin-inappbrowser/src/blackberry10/README.md ./cordova-plugin-media/README.md ./cordova-plugin-media-capture/README.md ./cordova-plugin-network-information/README.md ./cordova-plugin-splashscreen/README.md ./cordova-plugin-vibration/README.md[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/zh/README.md b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/zh/README.md[m
[1mdeleted file mode 100644[m
[1mindex 241fb55..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/blackberry10/doc/zh/README.md[m
[1m+++ /dev/null[m
[36m@@ -1,24 +0,0 @@[m
[31m-<!---[m
[31m- license: Licensed to the Apache Software Foundation (ASF) under one[m
[31m-         or more contributor license agreements.  See the NOTICE file[m
[31m-         distributed with this work for additional information[m
[31m-         regarding copyright ownership.  The ASF licenses this file[m
[31m-         to you under the Apache License, Version 2.0 (the[m
[31m-         "License"); you may not use this file except in compliance[m
[31m-         with the License.  You may obtain a copy of the License at[m
[31m-[m
[31m-           http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-         Unless required by applicable law or agreed to in writing,[m
[31m-         software distributed under the License is distributed on an[m
[31m-         "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-         KIND, either express or implied.  See the License for the[m
[31m-         specific language governing permissions and limitations[m
[31m-         under the License.[m
[31m--->[m
[31m-[m
[31m-# 黑莓 10 的應用程式瀏覽器外掛程式[m
[31m-[m
[31m-在應用程式瀏覽器功能完全包含在常見的 js。 還有沒有本機的實施所需。 若要安裝此外掛程式，請按照[命令列介面指南](http://cordova.apache.org/docs/en/edge/guide_cli_index.md.html#The%20Command-line%20Interface).[m
[31m-[m
[31m-如果你不使用的科爾多瓦命令列介面，請按照[使用 Plugman 管理外掛程式](http://cordova.apache.org/docs/en/edge/guide_plugin_ref_plugman.md.html)。 ./cordova-plugin-battery-status/README.md ./cordova-plugin-camera/README.md ./cordova-plugin-console/README.md ./cordova-plugin-contacts/README.md ./cordova-plugin-device/README.md ./cordova-plugin-device-motion/README.md ./cordova-plugin-device-orientation/README.md ./cordova-plugin-device-orientation/src/blackberry10/README.md ./cordova-plugin-file/README.md ./cordova-plugin-file-transfer/README.md ./cordova-plugin-geolocation/README.md ./cordova-plugin-globalization/README.md ./cordova-plugin-inappbrowser/README.md ./cordova-plugin-inappbrowser/src/blackberry10/README.md ./cordova-plugin-media/README.md ./cordova-plugin-media-capture/README.md ./cordova-plugin-network-information/README.md ./cordova-plugin-splashscreen/README.md ./cordova-plugin-vibration/README.md[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/browser/InAppBrowserProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/browser/InAppBrowserProxy.js[m
[1mindex da7dacd..1c62574 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/browser/InAppBrowserProxy.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/browser/InAppBrowserProxy.js[m
[36m@@ -29,27 +29,43 @@[m [mvar browserWrap,[m
     forwardButton,[m
     closeButton;[m
 [m
[31m-function attachNavigationEvents(element, callback) {[m
[32m+[m[32mfunction attachNavigationEvents (element, callback) {[m
     var onError = function () {[m
[31m-        callback({ type: "loaderror", url: this.contentWindow.location}, {keepCallback: true});[m
[32m+[m[32m        try {[m
[32m+[m[32m            callback({ type: 'loaderror', url: this.contentWindow.location.href }, {keepCallback: true}); // eslint-disable-line standard/no-callback-literal[m
[32m+[m[32m        } catch (err) {[m
[32m+[m[32m            // blocked by CORS :\[m
[32m+[m[32m            callback({ type: 'loaderror', url: null }, {keepCallback: true}); // eslint-disable-line standard/no-callback-literal[m
[32m+[m[32m        }[m
     };[m
 [m
[31m-    element.addEventListener("pageshow", function () {[m
[31m-        callback({ type: "loadstart", url: this.contentWindow.location}, {keepCallback: true});[m
[32m+[m[32m    element.addEventListener('pageshow', function () {[m
[32m+[m[32m        try {[m
[32m+[m[32m            callback({ type: 'loadstart', url: this.contentWindow.location.href }, {keepCallback: true}); // eslint-disable-line standard/no-callback-literal[m
[32m+[m[32m        } catch (err) {[m
[32m+[m[32m            // blocked by CORS :\[m
[32m+[m[32m            callback({ type: 'loadstart', url: null }, {keepCallback: true}); // eslint-disable-line standard/no-callback-literal[m
[32m+[m[32m        }[m
     });[m
 [m
[31m-    element.addEventListener("load", function () {[m
[31m-        callback({ type: "loadstop", url: this.contentWindow.location}, {keepCallback: true});[m
[32m+[m[32m    element.addEventListener('load', function () {[m
[32m+[m[32m        try {[m
[32m+[m[32m            callback({ type: 'loadstop', url: this.contentWindow.location.href }, {keepCallback: true}); // eslint-disable-line standard/no-callback-literal[m
[32m+[m[32m        } catch (err) {[m
[32m+[m[32m            // blocked by CORS :\[m
[32m+[m[32m            callback({ type: 'loadstop', url: null }, {keepCallback: true}); // eslint-disable-line standard/no-callback-literal[m
[32m+[m[32m        }[m
     });[m
 [m
[31m-    element.addEventListener("error", onError);[m
[31m-    element.addEventListener("abort", onError);[m
[32m+[m[32m    element.addEventListener('error', onError);[m
[32m+[m[32m    element.addEventListener('abort', onError);[m
 }[m
 [m
 var IAB = {[m
     close: function (win, lose) {[m
         if (browserWrap) {[m
[31m-            if (win) win({ type: "exit" });[m
[32m+[m[32m            // use the "open" function callback so that the exit event is fired properly[m
[32m+[m[32m            if (IAB._win) IAB._win({ type: 'exit' });[m
 [m
             browserWrap.parentNode.removeChild(browserWrap);[m
             browserWrap = null;[m
[36m@@ -59,109 +75,108 @@[m [mvar IAB = {[m
 [m
     show: function (win, lose) {[m
         if (browserWrap) {[m
[31m-            browserWrap.style.display = "block";[m
[32m+[m[32m            browserWrap.style.display = 'block';[m
         }[m
     },[m
 [m
     open: function (win, lose, args) {[m
[31m-        var strUrl = args[0],[m
[31m-            target = args[1],[m
[31m-            features = args[2];[m
[32m+[m[32m        var strUrl = args[0];[m
[32m+[m[32m        var target = args[1];[m
[32m+[m[32m        var features = args[2];[m
 [m
[31m-        if (target === "_self" || !target) {[m
[32m+[m[32m        IAB._win = win;[m
[32m+[m
[32m+[m[32m        if (target === '_self' || !target) {[m
             window.location = strUrl;[m
[31m-        } else if (target === "_system") {[m
[31m-            modulemapper.getOriginalSymbol(window, 'window.open').call(window, strUrl, "_blank");[m
[32m+[m[32m        } else if (target === '_system') {[m
[32m+[m[32m            modulemapper.getOriginalSymbol(window, 'window.open').call(window, strUrl, '_blank');[m
         } else {[m
             // "_blank" or anything else[m
             if (!browserWrap) {[m
[31m-                browserWrap = document.createElement("div");[m
[31m-                browserWrap.style.position = "absolute";[m
[31m-                browserWrap.style.top = "0";[m
[31m-                browserWrap.style.left = "0";[m
[31m-                browserWrap.style.boxSizing = "border-box";[m
[31m-                browserWrap.style.borderWidth = "40px";[m
[31m-                browserWrap.style.width = "100vw";[m
[31m-                browserWrap.style.height = "100vh";[m
[31m-                browserWrap.style.borderStyle = "solid";[m
[31m-                browserWrap.style.borderColor = "rgba(0,0,0,0.25)";[m
[32m+[m[32m                browserWrap = document.createElement('div');[m
[32m+[m[32m                browserWrap.style.position = 'absolute';[m
[32m+[m[32m                browserWrap.style.top = '0';[m
[32m+[m[32m                browserWrap.style.left = '0';[m
[32m+[m[32m                browserWrap.style.boxSizing = 'border-box';[m
[32m+[m[32m                browserWrap.style.borderWidth = '40px';[m
[32m+[m[32m                browserWrap.style.width = '100vw';[m
[32m+[m[32m                browserWrap.style.height = '100vh';[m
[32m+[m[32m                browserWrap.style.borderStyle = 'solid';[m
[32m+[m[32m                browserWrap.style.borderColor = 'rgba(0,0,0,0.25)';[m
 [m
                 browserWrap.onclick = function () {[m
                     setTimeout(function () {[m
[31m-                        IAB.close(win);[m
[32m+[m[32m                        IAB.close();[m
                     }, 0);[m
                 };[m
 [m
                 document.body.appendChild(browserWrap);[m
             }[m
 [m
[31m-            if (features.indexOf("hidden=yes") !== -1) {[m
[31m-                browserWrap.style.display = "none";[m
[32m+[m[32m            if (features.indexOf('hidden=yes') !== -1) {[m
[32m+[m[32m                browserWrap.style.display = 'none';[m
             }[m
 [m
[31m-            popup = document.createElement("iframe");[m
[31m-            popup.style.borderWidth = "0px";[m
[31m-            popup.style.width = "100%";[m
[32m+[m[32m            popup = document.createElement('iframe');[m
[32m+[m[32m            popup.style.borderWidth = '0px';[m
[32m+[m[32m            popup.style.width = '100%';[m
 [m
             browserWrap.appendChild(popup);[m
 [m
[31m-            if (features.indexOf("location=yes") !== -1 || features.indexOf("location") === -1) {[m
[31m-                popup.style.height = "calc(100% - 60px)";[m
[31m-                popup.style.marginBottom = "-4px";[m
[32m+[m[32m            if (features.indexOf('location=yes') !== -1 || features.indexOf('location') === -1) {[m
[32m+[m[32m                popup.style.height = 'calc(100% - 60px)';[m
[32m+[m[32m                popup.style.marginBottom = '-4px';[m
 [m
[31m-                navigationButtonsDiv = document.createElement("div");[m
[31m-                navigationButtonsDiv.style.height = "60px";[m
[31m-                navigationButtonsDiv.style.backgroundColor = "#404040";[m
[31m-                navigationButtonsDiv.style.zIndex = "999";[m
[32m+[m[32m                navigationButtonsDiv = document.createElement('div');[m
[32m+[m[32m                navigationButtonsDiv.style.height = '60px';[m
[32m+[m[32m                navigationButtonsDiv.style.backgroundColor = '#404040';[m
[32m+[m[32m                navigationButtonsDiv.style.zIndex = '999';[m
                 navigationButtonsDiv.onclick = function (e) {[m
                     e.cancelBubble = true;[m
                 };[m
 [m
[31m-                navigationButtonsDivInner = document.createElement("div");[m
[31m-                navigationButtonsDivInner.style.paddingTop = "10px";[m
[31m-                navigationButtonsDivInner.style.height = "50px";[m
[31m-                navigationButtonsDivInner.style.width = "160px";[m
[31m-                navigationButtonsDivInner.style.margin = "0 auto";[m
[31m-                navigationButtonsDivInner.style.backgroundColor = "#404040";[m
[31m-                navigationButtonsDivInner.style.zIndex = "999";[m
[32m+[m[32m                navigationButtonsDivInner = document.createElement('div');[m
[32m+[m[32m                navigationButtonsDivInner.style.paddingTop = '10px';[m
[32m+[m[32m                navigationButtonsDivInner.style.height = '50px';[m
[32m+[m[32m                navigationButtonsDivInner.style.width = '160px';[m
[32m+[m[32m                navigationButtonsDivInner.style.margin = '0 auto';[m
[32m+[m[32m                navigationButtonsDivInner.style.backgroundColor = '#404040';[m
[32m+[m[32m                navigationButtonsDivInner.style.zIndex = '999';[m
                 navigationButtonsDivInner.onclick = function (e) {[m
                     e.cancelBubble = true;[m
                 };[m
 [m
[32m+[m[32m                backButton = document.createElement('button');[m
[32m+[m[32m                backButton.style.width = '40px';[m
[32m+[m[32m                backButton.style.height = '40px';[m
[32m+[m[32m                backButton.style.borderRadius = '40px';[m
 [m
[31m-                backButton = document.createElement("button");[m
[31m-                backButton.style.width = "40px";[m
[31m-                backButton.style.height = "40px";[m
[31m-                backButton.style.borderRadius = "40px";[m
[31m-[m
[31m-                backButton.innerHTML = "←";[m
[31m-                backButton.addEventListener("click", function (e) {[m
[31m-                    if (popup.canGoBack)[m
[31m-                        popup.goBack();[m
[32m+[m[32m                backButton.innerHTML = '←';[m
[32m+[m[32m                backButton.addEventListener('click', function (e) {[m
[32m+[m[32m                    if (popup.canGoBack) { popup.goBack(); }[m
                 });[m
 [m
[31m-                forwardButton = document.createElement("button");[m
[31m-                forwardButton.style.marginLeft = "20px";[m
[31m-                forwardButton.style.width = "40px";[m
[31m-                forwardButton.style.height = "40px";[m
[31m-                forwardButton.style.borderRadius = "40px";[m
[32m+[m[32m                forwardButton = document.createElement('button');[m
[32m+[m[32m                forwardButton.style.marginLeft = '20px';[m
[32m+[m[32m                forwardButton.style.width = '40px';[m
[32m+[m[32m                forwardButton.style.height = '40px';[m
[32m+[m[32m                forwardButton.style.borderRadius = '40px';[m
 [m
[31m-                forwardButton.innerHTML = "→";[m
[31m-                forwardButton.addEventListener("click", function (e) {[m
[31m-                    if (popup.canGoForward)[m
[31m-                        popup.goForward();[m
[32m+[m[32m                forwardButton.innerHTML = '→';[m
[32m+[m[32m                forwardButton.addEventListener('click', function (e) {[m
[32m+[m[32m                    if (popup.canGoForward) { popup.goForward(); }[m
                 });[m
 [m
[31m-                closeButton = document.createElement("button");[m
[31m-                closeButton.style.marginLeft = "20px";[m
[31m-                closeButton.style.width = "40px";[m
[31m-                closeButton.style.height = "40px";[m
[31m-                closeButton.style.borderRadius = "40px";[m
[32m+[m[32m                closeButton = document.createElement('button');[m
[32m+[m[32m                closeButton.style.marginLeft = '20px';[m
[32m+[m[32m                closeButton.style.width = '40px';[m
[32m+[m[32m                closeButton.style.height = '40px';[m
[32m+[m[32m                closeButton.style.borderRadius = '40px';[m
 [m
[31m-                closeButton.innerHTML = "✖";[m
[31m-                closeButton.addEventListener("click", function (e) {[m
[32m+[m[32m                closeButton.innerHTML = '✖';[m
[32m+[m[32m                closeButton.addEventListener('click', function (e) {[m
                     setTimeout(function () {[m
[31m-                        IAB.close(win);[m
[32m+[m[32m                        IAB.close();[m
                     }, 0);[m
                 });[m
 [m
[36m@@ -176,7 +191,7 @@[m [mvar IAB = {[m
 [m
                 browserWrap.appendChild(navigationButtonsDiv);[m
             } else {[m
[31m-                popup.style.height = "100%";[m
[32m+[m[32m                popup.style.height = '100%';[m
             }[m
 [m
             // start listening for navigation events[m
[36m@@ -187,8 +202,8 @@[m [mvar IAB = {[m
     },[m
 [m
     injectScriptCode: function (win, fail, args) {[m
[31m-        var code = args[0],[m
[31m-            hasCallback = args[1];[m
[32m+[m[32m        var code = args[0];[m
[32m+[m[32m        var hasCallback = args[1];[m
 [m
         if (browserWrap && popup) {[m
             try {[m
[36m@@ -196,7 +211,7 @@[m [mvar IAB = {[m
                 if (hasCallback) {[m
                     win([]);[m
                 }[m
[31m-            } catch(e) {[m
[32m+[m[32m            } catch (e) {[m
                 console.error('Error occured while trying to injectScriptCode: ' + JSON.stringify(e));[m
             }[m
         }[m
[36m@@ -208,7 +223,7 @@[m [mvar IAB = {[m
         if (fail) {[m
             fail(msg);[m
         }[m
[31m-    }, [m
[32m+[m[32m    },[m
 [m
     injectStyleCode: function (win, fail, args) {[m
         var msg = 'Browser cordova-plugin-inappbrowser injectStyleCode is not yet implemented';[m
[36m@@ -229,4 +244,4 @@[m [mvar IAB = {[m
 [m
 module.exports = IAB;[m
 [m
[31m-require("cordova/exec/proxy").add("InAppBrowser", module.exports);[m
[32m+[m[32mrequire('cordova/exec/proxy').add('InAppBrowser', module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/firefoxos/InAppBrowserProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/firefoxos/InAppBrowserProxy.js[m
[1mdeleted file mode 100644[m
[1mindex 33db1b9..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/firefoxos/InAppBrowserProxy.js[m
[1m+++ /dev/null[m
[36m@@ -1,191 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-// https://developer.mozilla.org/en-US/docs/WebAPI/Browser[m
[31m-[m
[31m-var modulemapper = require('cordova/modulemapper');[m
[31m-[m
[31m-var origOpenFunc = modulemapper.getOriginalSymbol(window, 'window.open');[m
[31m-var browserWrap;[m
[31m-[m
[31m-var IABExecs = {[m
[31m-[m
[31m-    close: function (win, lose) {[m
[31m-        if (browserWrap) {[m
[31m-            browserWrap.parentNode.removeChild(browserWrap);[m
[31m-            browserWrap = null;[m
[31m-            if (typeof(win) == "function") win({type:'exit'});[m
[31m-        }[m
[31m-    },[m
[31m-[m
[31m-    /*[m
[31m-     * Reveal browser if opened hidden[m
[31m-     */[m
[31m-    show: function (win, lose) {[m
[31m-        console.error('[FirefoxOS] show not implemented');[m
[31m-    },[m
[31m-[m
[31m-    hide: function (win, lose) {[m
[31m-        console.error('[FirefoxOS] hide not implemented');[m
[31m-    },[m
[31m-[m
[31m-    open: function (win, lose, args) {[m
[31m-        var strUrl = args[0],[m
[31m-            target = args[1],[m
[31m-            features_string = args[2] || "location=yes", //location=yes is default[m
[31m-            features = {};[m
[31m-[m
[31m-        var features_list = features_string.split(',');[m
[31m-        features_list.forEach(function(feature) {[m
[31m-            var tup = feature.split('=');[m
[31m-            if (tup[1] == 'yes') {[m
[31m-                tup[1] = true;[m
[31m-            } else if (tup[1] == 'no') {[m
[31m-                tup[1] = false;[m
[31m-            } else {[m
[31m-                var number = parseInt(tup[1]);[m
[31m-                if (!isNaN(number)) {[m
[31m-                    tup[1] = number;[m
[31m-                }[m
[31m-            }[m
[31m-            features[tup[0]] = tup[1];[m
[31m-        });[m
[31m-[m
[31m-        function updateIframeSizeNoLocation() {[m
[31m-            browserWrap.style.width = window.innerWidth + 'px';[m
[31m-            browserWrap.style.height = window.innerHeight + 'px';[m
[31m-            browserWrap.style.zIndex = '999999999';[m
[31m-            browserWrap.browser.style.height = (window.innerHeight - 60) + 'px';[m
[31m-            browserWrap.browser.style.width = browserWrap.style.width;[m
[31m-        }[m
[31m-[m
[31m-        if (target === '_system') {[m
[31m-            origOpenFunc.apply(window, [strUrl, '_blank']);[m
[31m-        } else if (target === '_blank') {[m
[31m-            var browserElem = document.createElement('iframe');[m
[31m-            browserElem.setAttribute('mozbrowser', true);[m
[31m-            // make this loaded in its own child process[m
[31m-            browserElem.setAttribute('remote', true);[m
[31m-            browserElem.setAttribute('src', strUrl);[m
[31m-            if (browserWrap) {[m
[31m-                document.body.removeChild(browserWrap);[m
[31m-            }[m
[31m-            browserWrap = document.createElement('div');[m
[31m-            // assign browser element to browserWrap for future reference[m
[31m-            browserWrap.browser = browserElem;[m
[31m-[m
[31m-            browserWrap.classList.add('inAppBrowserWrap');[m
[31m-            // position fixed so that it works even when page is scrolled[m
[31m-            browserWrap.style.position = 'fixed';[m
[31m-            browserElem.style.position = 'absolute';[m
[31m-            browserElem.style.border = 0;[m
[31m-            browserElem.style.top = '60px';[m
[31m-            browserElem.style.left = '0px';[m
[31m-            updateIframeSizeNoLocation();[m
[31m-[m
[31m-            var menu = document.createElement('menu');[m
[31m-            menu.setAttribute('type', 'toolbar');[m
[31m-            var close = document.createElement('li');[m
[31m-            var back = document.createElement('li');[m
[31m-            var forward = document.createElement('li');[m
[31m-[m
[31m-            close.appendChild(document.createTextNode('×'));[m
[31m-            back.appendChild(document.createTextNode('<'));[m
[31m-            forward.appendChild(document.createTextNode('>'));[m
[31m-[m
[31m-            close.classList.add('inAppBrowserClose');[m
[31m-            back.classList.add('inAppBrowserBack');[m
[31m-            forward.classList.add('inAppBrowserForward');[m
[31m-[m
[31m-            var checkForwardBackward = function () {[m
[31m-                var backReq = browserElem.getCanGoBack();[m
[31m-                backReq.onsuccess = function() {[m
[31m-                    if (this.result) {[m
[31m-                        back.classList.remove('disabled');[m
[31m-                    } else {[m
[31m-                        back.classList.add('disabled');[m
[31m-                    }[m
[31m-                };[m
[31m-                var forwardReq = browserElem.getCanGoForward();[m
[31m-                forwardReq.onsuccess = function() {[m
[31m-                    if (this.result) {[m
[31m-                        forward.classList.remove('disabled');[m
[31m-                    } else {[m
[31m-                        forward.classList.add('disabled');[m
[31m-                    }[m
[31m-                };[m
[31m-            };[m
[31m-[m
[31m-            browserElem.addEventListener('mozbrowserloadend', checkForwardBackward);[m
[31m-[m
[31m-            close.addEventListener('click', function () {[m
[31m-                setTimeout(function () {[m
[31m-                    IABExecs.close(win, lose);[m
[31m-                }, 0);[m
[31m-            }, false);[m
[31m-[m
[31m-            back.addEventListener('click', function () {[m
[31m-                browserElem.goBack();[m
[31m-            }, false);[m
[31m-[m
[31m-            forward.addEventListener('click', function () {[m
[31m-                browserElem.goForward();[m
[31m-            }, false);[m
[31m-[m
[31m-            menu.appendChild(back);[m
[31m-            menu.appendChild(forward);[m
[31m-            menu.appendChild(close);[m
[31m-[m
[31m-            browserWrap.appendChild(menu);[m
[31m-            browserWrap.appendChild(browserElem);[m
[31m-            document.body.appendChild(browserWrap);[m
[31m-[m
[31m-            //we use mozbrowserlocationchange instead of mozbrowserloadstart to get the url[m
[31m-            browserElem.addEventListener('mozbrowserlocationchange', function(e){[m
[31m-                win({[m
[31m-                    type:'loadstart',[m
[31m-                    url : e.detail[m
[31m-                });[m
[31m-            }, false);[m
[31m-            browserElem.addEventListener('mozbrowserloadend', function(e){[m
[31m-                win({type:'loadstop'});[m
[31m-            }, false);[m
[31m-            browserElem.addEventListener('mozbrowsererror', function(e){[m
[31m-                win({type:'loaderror'});[m
[31m-            }, false);[m
[31m-            browserElem.addEventListener('mozbrowserclose', function(e){[m
[31m-                win({type:'exit'});[m
[31m-            }, false);[m
[31m-        } else {[m
[31m-            window.location = strUrl;[m
[31m-        }[m
[31m-    },[m
[31m-    injectScriptCode: function (code, bCB) {[m
[31m-        console.error('[FirefoxOS] injectScriptCode not implemented');[m
[31m-    },[m
[31m-    injectScriptFile: function (file, bCB) {[m
[31m-        console.error('[FirefoxOS] injectScriptFile not implemented');[m
[31m-    }[m
[31m-};[m
[31m-[m
[31m-module.exports = IABExecs;[m
[31m-[m
[31m-require('cordova/exec/proxy').add('InAppBrowser', module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ios/CDVInAppBrowser.h b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ios/CDVInAppBrowser.h[m
[1mindex d258eb0..25fae3f 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ios/CDVInAppBrowser.h[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ios/CDVInAppBrowser.h[m
[36m@@ -49,9 +49,15 @@[m
 @property (nonatomic, assign) BOOL location;[m
 @property (nonatomic, assign) BOOL toolbar;[m
 @property (nonatomic, copy) NSString* closebuttoncaption;[m
[32m+[m[32m@property (nonatomic, copy) NSString* closebuttoncolor;[m
 @property (nonatomic, copy) NSString* toolbarposition;[m
[32m+[m[32m@property (nonatomic, copy) NSString* toolbarcolor;[m
[32m+[m[32m@property (nonatomic, assign) BOOL toolbartranslucent;[m
[32m+[m[32m@property (nonatomic, assign) BOOL hidenavigationbuttons;[m
[32m+[m[32m@property (nonatomic, copy) NSString* navigationbuttoncolor;[m
 @property (nonatomic, assign) BOOL clearcache;[m
 @property (nonatomic, assign) BOOL clearsessioncache;[m
[32m+[m[32m@property (nonatomic, assign) BOOL hidespinner;[m
 [m
 @property (nonatomic, copy) NSString* presentationstyle;[m
 @property (nonatomic, copy) NSString* transitionstyle;[m
[36m@@ -74,13 +80,13 @@[m
     NSString* _prevUserAgent;[m
     NSInteger _userAgentLockToken;[m
     CDVInAppBrowserOptions *_browserOptions;[m
[31m-    [m
[32m+[m
 #ifdef __CORDOVA_4_0_0[m
     CDVUIWebViewDelegate* _webViewDelegate;[m
 #else[m
     CDVWebViewDelegate* _webViewDelegate;[m
 #endif[m
[31m-    [m
[32m+[m
 }[m
 [m
 @property (nonatomic, strong) IBOutlet UIWebView* webView;[m
[36m@@ -99,7 +105,7 @@[m
 - (void)navigateTo:(NSURL*)url;[m
 - (void)showLocationBar:(BOOL)show;[m
 - (void)showToolBar:(BOOL)show : (NSString *) toolbarPosition;[m
[31m-- (void)setCloseButtonTitle:(NSString*)title;[m
[32m+[m[32m- (void)setCloseButtonTitle:(NSString*)title : (NSString*) colorString;[m
 [m
 - (id)initWithUserAgent:(NSString*)userAgent prevUserAgent:(NSString*)prevUserAgent browserOptions: (CDVInAppBrowserOptions*) browserOptions;[m
 [m
[36m@@ -110,4 +116,3 @@[m
 @property (nonatomic, weak) id <CDVScreenOrientationDelegate> orientationDelegate;[m
 [m
 @end[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ios/CDVInAppBrowser.m b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ios/CDVInAppBrowser.m[m
[1mindex 4646972..c65e3e1 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ios/CDVInAppBrowser.m[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ios/CDVInAppBrowser.m[m
[36m@@ -29,6 +29,7 @@[m
 #define    kInAppBrowserToolbarBarPositionTop @"top"[m
 [m
 #define    TOOLBAR_HEIGHT 44.0[m
[32m+[m[32m#define    STATUSBAR_HEIGHT 20.0[m
 #define    LOCATIONBAR_HEIGHT 21.0[m
 #define    FOOTER_HEIGHT ((TOOLBAR_HEIGHT) + (LOCATIONBAR_HEIGHT))[m
 [m
[36m@@ -161,8 +162,8 @@[m
 [m
     [self.inAppBrowserViewController showLocationBar:browserOptions.location];[m
     [self.inAppBrowserViewController showToolBar:browserOptions.toolbar :browserOptions.toolbarposition];[m
[31m-    if (browserOptions.closebuttoncaption != nil) {[m
[31m-        [self.inAppBrowserViewController setCloseButtonTitle:browserOptions.closebuttoncaption];[m
[32m+[m[32m    if (browserOptions.closebuttoncaption != nil || browserOptions.closebuttoncolor != nil) {[m
[32m+[m[32m        [self.inAppBrowserViewController setCloseButtonTitle:browserOptions.closebuttoncaption :browserOptions.closebuttoncolor];[m
     }[m
     // Set Presentation Style[m
     UIModalPresentationStyle presentationStyle = UIModalPresentationFullScreen; // default[m
[36m@@ -238,7 +239,14 @@[m
     // Run later to avoid the "took a long time" log message.[m
     dispatch_async(dispatch_get_main_queue(), ^{[m
         if (weakSelf.inAppBrowserViewController != nil) {[m
[31m-            [weakSelf.viewController presentViewController:nav animated:YES completion:nil];[m
[32m+[m[32m            CGRect frame = [[UIScreen mainScreen] bounds];[m
[32m+[m[32m            UIWindow *tmpWindow = [[UIWindow alloc] initWithFrame:frame];[m
[32m+[m[32m            UIViewController *tmpController = [[UIViewController alloc] init];[m
[32m+[m[32m            [tmpWindow setRootViewController:tmpController];[m
[32m+[m[32m            [tmpWindow setWindowLevel:UIWindowLevelNormal];[m
[32m+[m
[32m+[m[32m            [tmpWindow makeKeyAndVisible];[m
[32m+[m[32m            [tmpController presentViewController:nav animated:YES completion:nil];[m
         }[m
     });[m
 }[m
[36m@@ -262,7 +270,7 @@[m
     dispatch_async(dispatch_get_main_queue(), ^{[m
         if (self.inAppBrowserViewController != nil) {[m
             _previousStatusBarStyle = -1;[m
[31m-            [self.viewController dismissViewControllerAnimated:YES completion:nil];[m
[32m+[m[32m            [self.inAppBrowserViewController.presentingViewController dismissViewControllerAnimated:YES completion:nil];[m
         }[m
     });[m
 }[m
[36m@@ -425,7 +433,7 @@[m
             [self.commandDelegate sendPluginResult:pluginResult callbackId:scriptCallbackId];[m
             return NO;[m
         }[m
[31m-    } [m
[32m+[m[32m    }[m
     //if is an app store link, let the system handle it, otherwise it fails to load it[m
     else if ([[ url scheme] isEqualToString:@"itms-appss"] || [[ url scheme] isEqualToString:@"itms-apps"]) {[m
         [theWebView stopLoading];[m
[36m@@ -516,7 +524,7 @@[m
 #else[m
         _webViewDelegate = [[CDVWebViewDelegate alloc] initWithDelegate:self];[m
 #endif[m
[31m-        [m
[32m+[m
         [self createViews];[m
     }[m
 [m
[36m@@ -591,6 +599,12 @@[m
     self.toolbar.multipleTouchEnabled = NO;[m
     self.toolbar.opaque = NO;[m
     self.toolbar.userInteractionEnabled = YES;[m
[32m+[m[32m    if (_browserOptions.toolbarcolor != nil) { // Set toolbar color if user sets it in options[m
[32m+[m[32m      self.toolbar.barTintColor = [self colorFromHexString:_browserOptions.toolbarcolor];[m
[32m+[m[32m    }[m
[32m+[m[32m    if (!_browserOptions.toolbartranslucent) { // Set toolbar translucent to no if user sets it in options[m
[32m+[m[32m      self.toolbar.translucent = NO;[m
[32m+[m[32m    }[m
 [m
     CGFloat labelInset = 5.0;[m
     float locationBarY = toolbarIsAtBottom ? self.view.bounds.size.height - FOOTER_HEIGHT : self.view.bounds.size.height - LOCATIONBAR_HEIGHT;[m
[36m@@ -628,13 +642,24 @@[m
     self.forwardButton = [[UIBarButtonItem alloc] initWithTitle:frontArrowString style:UIBarButtonItemStylePlain target:self action:@selector(goForward:)];[m
     self.forwardButton.enabled = YES;[m
     self.forwardButton.imageInsets = UIEdgeInsetsZero;[m
[32m+[m[32m    if (_browserOptions.navigationbuttoncolor != nil) { // Set button color if user sets it in options[m
[32m+[m[32m      self.forwardButton.tintColor = [self colorFromHexString:_browserOptions.navigationbuttoncolor];[m
[32m+[m[32m    }[m
 [m
     NSString* backArrowString = NSLocalizedString(@"◄", nil); // create arrow from Unicode char[m
     self.backButton = [[UIBarButtonItem alloc] initWithTitle:backArrowString style:UIBarButtonItemStylePlain target:self action:@selector(goBack:)];[m
     self.backButton.enabled = YES;[m
     self.backButton.imageInsets = UIEdgeInsetsZero;[m
[32m+[m[32m    if (_browserOptions.navigationbuttoncolor != nil) { // Set button color if user sets it in options[m
[32m+[m[32m      self.backButton.tintColor = [self colorFromHexString:_browserOptions.navigationbuttoncolor];[m
[32m+[m[32m    }[m
 [m
[31m-    [self.toolbar setItems:@[self.closeButton, flexibleSpaceButton, self.backButton, fixedSpaceButton, self.forwardButton]];[m
[32m+[m[32m    // Filter out Navigation Buttons if user requests so[m
[32m+[m[32m    if (_browserOptions.hidenavigationbuttons) {[m
[32m+[m[32m      [self.toolbar setItems:@[self.closeButton, flexibleSpaceButton]];[m
[32m+[m[32m    } else {[m
[32m+[m[32m      [self.toolbar setItems:@[self.closeButton, flexibleSpaceButton, self.backButton, fixedSpaceButton, self.forwardButton]];[m
[32m+[m[32m    }[m
 [m
     self.view.backgroundColor = [UIColor grayColor];[m
     [self.view addSubview:self.toolbar];[m
[36m@@ -647,14 +672,16 @@[m
     [self.webView setFrame:frame];[m
 }[m
 [m
[31m-- (void)setCloseButtonTitle:(NSString*)title[m
[32m+[m[32m- (void)setCloseButtonTitle:(NSString*)title : (NSString*) colorString[m
 {[m
     // the advantage of using UIBarButtonSystemItemDone is the system will localize it for you automatically[m
     // but, if you want to set this yourself, knock yourself out (we can't set the title for a system Done button, so we have to create a new one)[m
     self.closeButton = nil;[m
[31m-    self.closeButton = [[UIBarButtonItem alloc] initWithTitle:title style:UIBarButtonItemStyleBordered target:self action:@selector(close)];[m
[32m+[m[32m    // Initialize with title if title is set, otherwise the title will be 'Done' localized[m
[32m+[m[32m    self.closeButton = title != nil ? [[UIBarButtonItem alloc] initWithTitle:title style:UIBarButtonItemStyleBordered target:self action:@selector(close)] : [[UIBarButtonItem alloc] initWithBarButtonSystemItem:UIBarButtonSystemItemDone target:self action:@selector(close)];[m
     self.closeButton.enabled = YES;[m
[31m-    self.closeButton.tintColor = [UIColor colorWithRed:60.0 / 255.0 green:136.0 / 255.0 blue:230.0 / 255.0 alpha:1];[m
[32m+[m[32m    // If color on closebutton is requested then initialize with that that color, otherwise use initialize with default[m
[32m+[m[32m    self.closeButton.tintColor = colorString != nil ? [self colorFromHexString:colorString] : [UIColor colorWithRed:60.0 / 255.0 green:136.0 / 255.0 blue:230.0 / 255.0 alpha:1];[m
 [m
     NSMutableArray* items = [self.toolbar.items mutableCopy];[m
     [items replaceObjectAtIndex:0 withObject:self.closeButton];[m
[36m@@ -869,6 +896,17 @@[m
     }[m
 }[m
 [m
[32m+[m[32m// Helper function to convert hex color string to UIColor[m
[32m+[m[32m// Assumes input like "#00FF00" (#RRGGBB).[m
[32m+[m[32m// Taken from https://stackoverflow.com/questions/1560081/how-can-i-create-a-uicolor-from-a-hex-string[m
[32m+[m[32m- (UIColor *)colorFromHexString:(NSString *)hexString {[m
[32m+[m[32m    unsigned rgbValue = 0;[m
[32m+[m[32m    NSScanner *scanner = [NSScanner scannerWithString:hexString];[m
[32m+[m[32m    [scanner setScanLocation:1]; // bypass '#' character[m
[32m+[m[32m    [scanner scanHexInt:&rgbValue];[m
[32m+[m[32m    return [UIColor colorWithRed:((rgbValue & 0xFF0000) >> 16)/255.0 green:((rgbValue & 0xFF00) >> 8)/255.0 blue:(rgbValue & 0xFF)/255.0 alpha:1.0];[m
[32m+[m[32m}[m
[32m+[m
 #pragma mark UIWebViewDelegate[m
 [m
 - (void)webViewDidStartLoad:(UIWebView*)theWebView[m
[36m@@ -879,7 +917,10 @@[m
     self.backButton.enabled = theWebView.canGoBack;[m
     self.forwardButton.enabled = theWebView.canGoForward;[m
 [m
[31m-    [self.spinner startAnimating];[m
[32m+[m[32m    NSLog(_browserOptions.hidespinner ? @"Yes" : @"No");[m
[32m+[m[32m    if(!_browserOptions.hidespinner) {[m
[32m+[m[32m        [self.spinner startAnimating];[m
[32m+[m[32m    }[m
 [m
     return [self.navigationDelegate webViewDidStartLoad:theWebView];[m
 }[m
[36m@@ -979,6 +1020,7 @@[m
         self.toolbarposition = kInAppBrowserToolbarBarPositionBottom;[m
         self.clearcache = NO;[m
         self.clearsessioncache = NO;[m
[32m+[m[32m        self.hidespinner = NO;[m
 [m
         self.enableviewportscale = NO;[m
         self.mediaplaybackrequiresuseraction = NO;[m
[36m@@ -987,6 +1029,10 @@[m
         self.suppressesincrementalrendering = NO;[m
         self.hidden = NO;[m
         self.disallowoverscroll = NO;[m
[32m+[m[32m        self.hidenavigationbuttons = NO;[m
[32m+[m[32m        self.closebuttoncolor = nil;[m
[32m+[m[32m        self.toolbarcolor = nil;[m
[32m+[m[32m        self.toolbartranslucent = YES;[m
     }[m
 [m
     return self;[m
[36m@@ -1041,11 +1087,11 @@[m
 [m
 - (void) viewDidLoad {[m
 [m
[31m-    CGRect frame = [UIApplication sharedApplication].statusBarFrame;[m
[31m-[m
[32m+[m[32m    CGRect statusBarFrame = [self invertFrameIfNeeded:[UIApplication sharedApplication].statusBarFrame];[m
[32m+[m[32m    statusBarFrame.size.height = STATUSBAR_HEIGHT;[m
     // simplified from: http://stackoverflow.com/a/25669695/219684[m
 [m
[31m-    UIToolbar* bgToolbar = [[UIToolbar alloc] initWithFrame:[self invertFrameIfNeeded:frame]];[m
[32m+[m[32m    UIToolbar* bgToolbar = [[UIToolbar alloc] initWithFrame:statusBarFrame];[m
     bgToolbar.barStyle = UIBarStyleDefault;[m
     [bgToolbar setAutoresizingMask:UIViewAutoresizingFlexibleWidth];[m
     [self.view addSubview:bgToolbar];[m
[36m@@ -1096,4 +1142,3 @@[m
 [m
 [m
 @end[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/InAppBrowser.qml b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/InAppBrowser.qml[m
[1mdeleted file mode 100644[m
[1mindex 781e8a6..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/InAppBrowser.qml[m
[1m+++ /dev/null[m
[36m@@ -1,92 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Copyright 2013 Canonical Ltd.[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-import QtQuick 2.0[m
[31m-import Ubuntu.Components.Popups 0.1[m
[31m-import Ubuntu.Components 0.1[m
[31m-import com.canonical.Oxide 1.0[m
[31m-[m
[31m-Rectangle {[m
[31m-    anchors.fill: parent[m
[31m-    id: inappbrowser[m
[31m-    property string url1[m
[31m-    Rectangle {[m
[31m-        border.color: "black"[m
[31m-        width: parent.width[m
[31m-        height: urlEntry.height[m
[31m-        color: "gray"[m
[31m-        TextInput {[m
[31m-            id: urlEntry[m
[31m-            width: parent.width - closeButton.width[m
[31m-            text: url1[m
[31m-            activeFocusOnPress: false[m
[31m-        }[m
[31m-        Image {[m
[31m-            id: closeButton[m
[31m-            width: height[m
[31m-            x: parent.width - width[m
[31m-            height: parent.height[m
[31m-            source: "close.png"[m
[31m-            MouseArea {[m
[31m-                anchors.fill: parent[m
[31m-                onClicked: {[m
[31m-                    root.exec("InAppBrowser", "close", [0, 0])[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    property string usContext: "oxide://main-world/2"[m
[31m-[m
[31m-    function executeJS(scId, code) {[m
[31m-        var req = _view.rootFrame.sendMessage(usContext, "EXECUTE", {code: code});[m
[31m-[m
[31m-        req.onreply = function(response) {[m
[31m-            var code = 'cordova.callback(' + scId + ', JSON.parse(\'' + JSON.stringify(response.result) + '\'))';[m
[31m-            console.warn(code);[m
[31m-            cordova.javaScriptExecNeeded(code);[m
[31m-        console.warn("RESP:" + JSON.stringify(response));[m
[31m-        };[m
[31m-    }[m
[31m-[m
[31m-    WebView {[m
[31m-        width: parent.width[m
[31m-        y: urlEntry.height[m
[31m-        height: parent.height - y[m
[31m-        url: url1[m
[31m-        id: _view[m
[31m-        onLoadingStateChanged: {[m
[31m-            root.exec("InAppBrowser", "loadFinished", [_view.loading])[m
[31m-        }[m
[31m-        context: WebContext {[m
[31m-            id: webcontext[m
[31m-[m
[31m-            userScripts: [[m
[31m-                UserScript {[m
[31m-                    context: usContext[m
[31m-                    emulateGreasemonkey: true[m
[31m-                    url: "InAppBrowser_escapeScript.js"[m
[31m-                }[m
[31m-            ][m
[31m-        }[m
[31m-    }[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/InAppBrowser_escapeScript.js b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/InAppBrowser_escapeScript.js[m
[1mdeleted file mode 100644[m
[1mindex b01daeb..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/InAppBrowser_escapeScript.js[m
[1m+++ /dev/null[m
[36m@@ -1,32 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-/* jshint -W061 */[m
[31m-/* global oxide */[m
[31m-[m
[31m-oxide.addMessageHandler("EXECUTE", function(msg) {[m
[31m-    var code = msg.args.code;[m
[31m-    try {[m
[31m-        msg.reply({result: eval(code)});[m
[31m-    } catch(e) {[m
[31m-        msg.error("Code threw exception: \"" + e + "\"");[m
[31m-    }[m
[31m-});[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/close.png b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/close.png[m
[1mdeleted file mode 100644[m
[1mindex 56373d1..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/close.png and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/inappbrowser.cpp b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/inappbrowser.cpp[m
[1mdeleted file mode 100644[m
[1mindex a928eff..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/inappbrowser.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,109 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Copyright 2013 Canonical Ltd.[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-[m
[31m-#include <QQuickView>[m
[31m-#include <QQuickItem>[m
[31m-[m
[31m-#include "inappbrowser.h"[m
[31m-#include <cordova.h>[m
[31m-[m
[31m-Inappbrowser::Inappbrowser(Cordova *cordova): CPlugin(cordova), _eventCb(0) {[m
[31m-}[m
[31m-[m
[31m-const char code[] = "\[m
[31m-var component;                                                          \[m
[31m-function createObject() {                                               \[m
[31m-    component = Qt.createComponent(%1);                                 \[m
[31m-    if (component.status == Component.Ready)                            \[m
[31m-        finishCreation();                                               \[m
[31m-    else                                                                \[m
[31m-        component.statusChanged.connect(finishCreation);                \[m
[31m-}                                                                       \[m
[31m-function finishCreation() {                                             \[m
[31m-    CordovaWrapper.global.inappbrowser = component.createObject(root,   \[m
[31m-        {root: root, cordova: cordova, url1: %2});                      \[m
[31m-}                                                                       \[m
[31m-createObject()";[m
[31m-[m
[31m-const char EXIT_EVENT[] = "{type: 'exit'}";[m
[31m-const char LOADSTART_EVENT[] = "{type: 'loadstart'}";[m
[31m-const char LOADSTOP_EVENT[] = "{type: 'loadstop'}";[m
[31m-const char LOADERROR_EVENT[] = "{type: 'loaderror'}";[m
[31m-[m
[31m-void Inappbrowser::open(int cb, int, const QString &url, const QString &, const QString &) {[m
[31m-    assert(_eventCb == 0);[m
[31m-[m
[31m-    _eventCb = cb;[m
[31m-[m
[31m-    QString path = m_cordova->get_app_dir() + "/../qml/InAppBrowser.qml";[m
[31m-    QString qml = QString(code)[m
[31m-      .arg(CordovaInternal::format(path)).arg(CordovaInternal::format(url));[m
[31m-    m_cordova->execQML(qml);[m
[31m-}[m
[31m-[m
[31m-void Inappbrowser::show(int, int) {[m
[31m-    m_cordova->execQML("CordovaWrapper.global.inappbrowser.visible = true");[m
[31m-}[m
[31m-[m
[31m-void Inappbrowser::hide(int, int) {[m
[31m-    m_cordova->execQML("CordovaWrapper.global.inappbrowser.visible = false");[m
[31m-}[m
[31m-[m
[31m-void Inappbrowser::close(int, int) {[m
[31m-    m_cordova->execQML("CordovaWrapper.global.inappbrowser.destroy()");[m
[31m-    this->callbackWithoutRemove(_eventCb, EXIT_EVENT);[m
[31m-    _eventCb = 0;[m
[31m-}[m
[31m-[m
[31m-void Inappbrowser::injectStyleFile(int scId, int ecId, const QString& src, bool b) {[m
[31m-    QString code("(function(d) { var c = d.createElement('link'); c.rel='stylesheet'; c.type='text/css'; c.href = %1; d.head.appendChild(c);})(document)");[m
[31m-    code = code.arg(CordovaInternal::format(src));[m
[31m-[m
[31m-    injectScriptCode(scId, ecId, code, b);[m
[31m-}[m
[31m-[m
[31m-void Inappbrowser::injectStyleCode(int scId, int ecId, const QString& src, bool b) {[m
[31m-    QString code("(function(d) { var c = d.createElement('style'); c.innerHTML = %1; d.body.appendChild(c); })(document)");[m
[31m-    code = code.arg(CordovaInternal::format(src));[m
[31m-[m
[31m-    injectScriptCode(scId, ecId, code, b);[m
[31m-}[m
[31m-[m
[31m-void Inappbrowser::injectScriptFile(int scId, int ecId, const QString& src, bool b) {[m
[31m-    QString code("(function(d) { var c = d.createElement('script'); c.src = %1; d.body.appendChild(c);})(document)");[m
[31m-    code = code.arg(CordovaInternal::format(src));[m
[31m-[m
[31m-    injectScriptCode(scId, ecId, code, b);[m
[31m-}[m
[31m-[m
[31m-void Inappbrowser::injectScriptCode(int scId, int, const QString& code, bool) {[m
[31m-    m_cordova->execQML(QString("CordovaWrapper.global.inappbrowser.executeJS(%2, %1)").arg(CordovaInternal::format(code)).arg(scId));[m
[31m-}[m
[31m-[m
[31m-void Inappbrowser::loadFinished(bool status) {[m
[31m-    if (!status) {[m
[31m-        this->callbackWithoutRemove(_eventCb, LOADSTOP_EVENT);[m
[31m-    } else {[m
[31m-        this->callbackWithoutRemove(_eventCb, LOADSTART_EVENT);[m
[31m-    }[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/inappbrowser.h b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/inappbrowser.h[m
[1mdeleted file mode 100644[m
[1mindex 9ad61ec..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/ubuntu/inappbrowser.h[m
[1m+++ /dev/null[m
[36m@@ -1,62 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Copyright 2013 Canonical Ltd.[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-#ifndef INAPPBROWSER_H[m
[31m-#define INAPPBROWSER_H[m
[31m-[m
[31m-#include <QtCore>[m
[31m-#include <cplugin.h>[m
[31m-[m
[31m-class Inappbrowser: public CPlugin {[m
[31m-    Q_OBJECT[m
[31m-public:[m
[31m-    Inappbrowser(Cordova *cordova);[m
[31m-[m
[31m-    virtual const QString fullName() override {[m
[31m-        return Inappbrowser::fullID();[m
[31m-    }[m
[31m-[m
[31m-    virtual const QString shortName() override {[m
[31m-        return "InAppBrowser";[m
[31m-    }[m
[31m-[m
[31m-    static const QString fullID() {[m
[31m-        return "InAppBrowser";[m
[31m-    }[m
[31m-[m
[31m-public slots:[m
[31m-    void open(int cb, int, const QString &url, const QString &windowName, const QString &windowFeatures);[m
[31m-    void show(int, int);[m
[31m-    void hide(int, int);[m
[31m-    void close(int, int);[m
[31m-    void injectStyleFile(int cb, int, const QString&, bool);[m
[31m-    void injectStyleCode(int cb, int, const QString&, bool);[m
[31m-    void injectScriptFile(int cb, int, const QString&, bool);[m
[31m-    void injectScriptCode(int cb, int, const QString&, bool);[m
[31m-[m
[31m-    void loadFinished(bool status);[m
[31m-[m
[31m-private:[m
[31m-    int _eventCb;[m
[31m-};[m
[31m-[m
[31m-#endif[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/windows/InAppBrowserProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/windows/InAppBrowserProxy.js[m
[1mindex 2ce8819..9e544c5 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/windows/InAppBrowserProxy.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/windows/InAppBrowserProxy.js[m
[36m@@ -1,4 +1,4 @@[m
[31m-﻿/*[m
[32m+[m[32m/*[m
  *[m
  * Licensed to the Apache Software Foundation (ASF) under one[m
  * or more contributor license agreements.  See the NOTICE file[m
[36m@@ -21,9 +21,10 @@[m
 [m
 /* jslint sloppy:true */[m
 /* global Windows:true, setImmediate */[m
[32m+[m[32m/* eslint standard/no-callback-literal : 0 */[m
 [m
[31m-var cordova = require('cordova'),[m
[31m-    urlutil = require('cordova/urlutil');[m
[32m+[m[32mvar cordova = require('cordova');[m
[32m+[m[32mvar urlutil = require('cordova/urlutil');[m
 [m
 var browserWrap,[m
     popup,[m
[36m@@ -40,56 +41,56 @@[m [mvar browserWrap,[m
 // http://msdn.microsoft.com/en-us/library/windows/apps/dn301831.aspx[m
 var isWebViewAvailable = cordova.platformId === 'windows';[m
 [m
[31m-function attachNavigationEvents(element, callback) {[m
[32m+[m[32mfunction attachNavigationEvents (element, callback) {[m
     if (isWebViewAvailable) {[m
[31m-        element.addEventListener("MSWebViewNavigationStarting", function (e) {[m
[31m-            callback({ type: "loadstart", url: e.uri}, {keepCallback: true} );[m
[32m+[m[32m        element.addEventListener('MSWebViewNavigationStarting', function (e) {[m
[32m+[m[32m            callback({ type: 'loadstart', url: e.uri }, {keepCallback: true});[m
         });[m
 [m
[31m-        element.addEventListener("MSWebViewNavigationCompleted", function (e) {[m
[32m+[m[32m        element.addEventListener('MSWebViewNavigationCompleted', function (e) {[m
             if (e.isSuccess) {[m
[31m-                callback({ type: "loadstop", url: e.uri }, { keepCallback: true });[m
[32m+[m[32m                callback({ type: 'loadstop', url: e.uri }, { keepCallback: true });[m
             } else {[m
[31m-                callback({ type: "loaderror", url: e.uri, code: e.webErrorStatus, message: "Navigation failed with error code " + e.webErrorStatus}, { keepCallback: true });[m
[32m+[m[32m                callback({ type: 'loaderror', url: e.uri, code: e.webErrorStatus, message: 'Navigation failed with error code ' + e.webErrorStatus }, { keepCallback: true });[m
             }[m
         });[m
 [m
[31m-        element.addEventListener("MSWebViewUnviewableContentIdentified", function (e) {[m
[32m+[m[32m        element.addEventListener('MSWebViewUnviewableContentIdentified', function (e) {[m
             // WebView found the content to be not HTML.[m
             // http://msdn.microsoft.com/en-us/library/windows/apps/dn609716.aspx[m
[31m-            callback({ type: "loaderror", url: e.uri, code: e.webErrorStatus, message: "Navigation failed with error code " + e.webErrorStatus}, { keepCallback: true });[m
[32m+[m[32m            callback({ type: 'loaderror', url: e.uri, code: e.webErrorStatus, message: 'Navigation failed with error code ' + e.webErrorStatus }, { keepCallback: true });[m
         });[m
 [m
[31m-        element.addEventListener("MSWebViewContentLoading", function (e) {[m
[32m+[m[32m        element.addEventListener('MSWebViewContentLoading', function (e) {[m
             if (navigationButtonsDiv && popup) {[m
                 if (popup.canGoBack) {[m
[31m-                    backButton.removeAttribute("disabled");[m
[32m+[m[32m                    backButton.removeAttribute('disabled');[m
                 } else {[m
[31m-                    backButton.setAttribute("disabled", "true");[m
[32m+[m[32m                    backButton.setAttribute('disabled', 'true');[m
                 }[m
 [m
                 if (popup.canGoForward) {[m
[31m-                    forwardButton.removeAttribute("disabled");[m
[32m+[m[32m                    forwardButton.removeAttribute('disabled');[m
                 } else {[m
[31m-                    forwardButton.setAttribute("disabled", "true");[m
[32m+[m[32m                    forwardButton.setAttribute('disabled', 'true');[m
                 }[m
             }[m
         });[m
     } else {[m
         var onError = function () {[m
[31m-            callback({ type: "loaderror", url: this.contentWindow.location}, {keepCallback: true});[m
[32m+[m[32m            callback({ type: 'loaderror', url: this.contentWindow.location }, {keepCallback: true});[m
         };[m
 [m
[31m-        element.addEventListener("unload", function () {[m
[31m-            callback({ type: "loadstart", url: this.contentWindow.location}, {keepCallback: true});[m
[32m+[m[32m        element.addEventListener('unload', function () {[m
[32m+[m[32m            callback({ type: 'loadstart', url: this.contentWindow.location }, {keepCallback: true});[m
         });[m
 [m
[31m-        element.addEventListener("load", function () {[m
[31m-            callback({ type: "loadstop", url: this.contentWindow.location}, {keepCallback: true});[m
[32m+[m[32m        element.addEventListener('load', function () {[m
[32m+[m[32m            callback({ type: 'loadstop', url: this.contentWindow.location }, {keepCallback: true});[m
         });[m
 [m
[31m-        element.addEventListener("error", onError);[m
[31m-        element.addEventListener("abort", onError);[m
[32m+[m[32m        element.addEventListener('error', onError);[m
[32m+[m[32m        element.addEventListener('abort', onError);[m
     }[m
 }[m
 [m
[36m@@ -98,7 +99,7 @@[m [mvar IAB = {[m
         setImmediate(function () {[m
             if (browserWrap) {[m
                 if (navigationEventsCallback) {[m
[31m-                    navigationEventsCallback({ type: "exit" });[m
[32m+[m[32m                    navigationEventsCallback({ type: 'exit' });[m
                 }[m
 [m
                 browserWrap.parentNode.removeChild(browserWrap);[m
[36m@@ -107,52 +108,52 @@[m [mvar IAB = {[m
                 browserWrap = null;[m
                 popup = null;[m
 [m
[31m-                document.removeEventListener("backbutton", hardwareBackCallback, false);[m
[32m+[m[32m                document.removeEventListener('backbutton', hardwareBackCallback, false);[m
             }[m
         });[m
     },[m
     show: function (win, lose) {[m
         setImmediate(function () {[m
             if (browserWrap) {[m
[31m-                browserWrap.style.display = "block";[m
[32m+[m[32m                browserWrap.style.display = 'block';[m
             }[m
         });[m
     },[m
     hide: function (win, lose) {[m
         if (browserWrap) {[m
[31m-            browserWrap.style.display = "none";[m
[32m+[m[32m            browserWrap.style.display = 'none';[m
         }[m
     },[m
     open: function (win, lose, args) {[m
         // make function async so that we can add navigation events handlers before view is loaded and navigation occured[m
         setImmediate(function () {[m
[31m-            var strUrl = args[0],[m
[31m-                target = args[1],[m
[31m-                features = args[2],[m
[31m-                url;[m
[32m+[m[32m            var strUrl = args[0];[m
[32m+[m[32m            var target = args[1];[m
[32m+[m[32m            var features = args[2];[m
[32m+[m[32m            var url;[m
 [m
             navigationEventsCallback = win;[m
 [m
[31m-            if (target === "_system") {[m
[32m+[m[32m            if (target === '_system') {[m
                 url = new Windows.Foundation.Uri(strUrl);[m
                 Windows.System.Launcher.launchUriAsync(url);[m
[31m-            } else if (target === "_self" || !target) {[m
[32m+[m[32m            } else if (target === '_self' || !target) {[m
                 window.location = strUrl;[m
             } else {[m
                 // "_blank" or anything else[m
                 if (!browserWrap) {[m
                     var browserWrapStyle = document.createElement('link');[m
[31m-                    browserWrapStyle.rel = "stylesheet";[m
[31m-                    browserWrapStyle.type = "text/css";[m
[31m-                    browserWrapStyle.href = urlutil.makeAbsolute("/www/css/inappbrowser.css");[m
[32m+[m[32m                    browserWrapStyle.rel = 'stylesheet';[m
[32m+[m[32m                    browserWrapStyle.type = 'text/css';[m
[32m+[m[32m                    browserWrapStyle.href = urlutil.makeAbsolute('/www/css/inappbrowser.css');[m
 [m
                     document.head.appendChild(browserWrapStyle);[m
 [m
[31m-                    browserWrap = document.createElement("div");[m
[31m-                    browserWrap.className = "inAppBrowserWrap";[m
[32m+[m[32m                    browserWrap = document.createElement('div');[m
[32m+[m[32m                    browserWrap.className = 'inAppBrowserWrap';[m
 [m
[31m-                    if (features.indexOf("fullscreen=yes") > -1) {[m
[31m-                        browserWrap.classList.add("inAppBrowserWrapFullscreen");[m
[32m+[m[32m                    if (features.indexOf('fullscreen=yes') > -1) {[m
[32m+[m[32m                        browserWrap.classList.add('inAppBrowserWrapFullscreen');[m
                     }[m
 [m
                     // Save body overflow style to be able to reset it back later[m
[36m@@ -166,22 +167,22 @@[m [mvar IAB = {[m
 [m
                     document.body.appendChild(browserWrap);[m
                     // Hide scrollbars for the whole body while inappbrowser's window is open[m
[31m-                    document.body.style.msOverflowStyle = "none";[m
[32m+[m[32m                    document.body.style.msOverflowStyle = 'none';[m
                 }[m
 [m
[31m-                if (features.indexOf("hidden=yes") !== -1) {[m
[31m-                    browserWrap.style.display = "none";[m
[32m+[m[32m                if (features.indexOf('hidden=yes') !== -1) {[m
[32m+[m[32m                    browserWrap.style.display = 'none';[m
                 }[m
 [m
[31m-                popup = document.createElement(isWebViewAvailable ? "x-ms-webview" : "iframe");[m
[31m-                if (popup instanceof HTMLIFrameElement) {[m
[32m+[m[32m                popup = document.createElement(isWebViewAvailable ? 'x-ms-webview' : 'iframe');[m
[32m+[m[32m                if (popup instanceof HTMLIFrameElement) { // eslint-disable-line no-undef[m
                     // For iframe we need to override bacground color of parent element here[m
                     // otherwise pages without background color set will have transparent background[m
[31m-                    popup.style.backgroundColor = "white";[m
[32m+[m[32m                    popup.style.backgroundColor = 'white';[m
                 }[m
[31m-                popup.style.borderWidth = "0px";[m
[31m-                popup.style.width = "100%";[m
[31m-                popup.style.marginBottom = "-5px";[m
[32m+[m[32m                popup.style.borderWidth = '0px';[m
[32m+[m[32m                popup.style.width = '100%';[m
[32m+[m[32m                popup.style.marginBottom = '-5px';[m
 [m
                 browserWrap.appendChild(popup);[m
 [m
[36m@@ -191,14 +192,14 @@[m [mvar IAB = {[m
                     }, 0);[m
                 };[m
 [m
[31m-                if (features.indexOf("hardwareback=yes") > -1 || features.indexOf("hardwareback") === -1) {[m
[32m+[m[32m                if (features.indexOf('hardwareback=yes') > -1 || features.indexOf('hardwareback') === -1) {[m
                     hardwareBackCallback = function () {[m
                         if (browserWrap.style.display === 'none') {[m
                             // NOTE: backbutton handlers have to throw an exception in order to prevent[m
                             // returning 'true' inside cordova-js, which would mean that the event is handled by user.[m
                             // Throwing an exception means that the default/system navigation behavior will take place,[m
                             // which is to exit the app if the navigation stack is empty.[m
[31m-                            throw 'Exit the app';[m
[32m+[m[32m                            throw 'Exit the app'; // eslint-disable-line no-throw-literal[m
                         }[m
 [m
                         if (popup.canGoBack) {[m
[36m@@ -207,59 +208,57 @@[m [mvar IAB = {[m
                             closeHandler();[m
                         }[m
                     };[m
[31m-                } else if (features.indexOf("hardwareback=no") > -1) {[m
[32m+[m[32m                } else if (features.indexOf('hardwareback=no') > -1) {[m
                     hardwareBackCallback = function () {[m
                         if (browserWrap.style.display === 'none') {[m
                             // See comment above[m
[31m-                            throw 'Exit the app';[m
[32m+[m[32m                            throw 'Exit the app'; // eslint-disable-line no-throw-literal[m
                         }[m
 [m
                         closeHandler();[m
                     };[m
                 }[m
 [m
[31m-                document.addEventListener("backbutton", hardwareBackCallback, false);[m
[32m+[m[32m                document.addEventListener('backbutton', hardwareBackCallback, false);[m
 [m
[31m-                if (features.indexOf("location=yes") !== -1 || features.indexOf("location") === -1) {[m
[31m-                    popup.style.height = "calc(100% - 70px)";[m
[32m+[m[32m                if (features.indexOf('location=yes') !== -1 || features.indexOf('location') === -1) {[m
[32m+[m[32m                    popup.style.height = 'calc(100% - 70px)';[m
 [m
[31m-                    navigationButtonsDiv = document.createElement("div");[m
[31m-                    navigationButtonsDiv.className = "inappbrowser-app-bar";[m
[32m+[m[32m                    navigationButtonsDiv = document.createElement('div');[m
[32m+[m[32m                    navigationButtonsDiv.className = 'inappbrowser-app-bar';[m
                     navigationButtonsDiv.onclick = function (e) {[m
                         e.cancelBubble = true;[m
                     };[m
 [m
[31m-                    navigationButtonsDivInner = document.createElement("div");[m
[31m-                    navigationButtonsDivInner.className = "inappbrowser-app-bar-inner";[m
[32m+[m[32m                    navigationButtonsDivInner = document.createElement('div');[m
[32m+[m[32m                    navigationButtonsDivInner.className = 'inappbrowser-app-bar-inner';[m
                     navigationButtonsDivInner.onclick = function (e) {[m
                         e.cancelBubble = true;[m
                     };[m
 [m
[31m-                    backButton = document.createElement("div");[m
[31m-                    backButton.innerText = "back";[m
[31m-                    backButton.className = "app-bar-action action-back";[m
[31m-                    backButton.addEventListener("click", function (e) {[m
[31m-                        if (popup.canGoBack)[m
[31m-                            popup.goBack();[m
[32m+[m[32m                    backButton = document.createElement('div');[m
[32m+[m[32m                    backButton.innerText = 'back';[m
[32m+[m[32m                    backButton.className = 'app-bar-action action-back';[m
[32m+[m[32m                    backButton.addEventListener('click', function (e) {[m
[32m+[m[32m                        if (popup.canGoBack) { popup.goBack(); }[m
                     });[m
 [m
[31m-                    forwardButton = document.createElement("div");[m
[31m-                    forwardButton.innerText = "forward";[m
[31m-                    forwardButton.className = "app-bar-action action-forward";[m
[31m-                    forwardButton.addEventListener("click", function (e) {[m
[31m-                        if (popup.canGoForward)[m
[31m-                            popup.goForward();[m
[32m+[m[32m                    forwardButton = document.createElement('div');[m
[32m+[m[32m                    forwardButton.innerText = 'forward';[m
[32m+[m[32m                    forwardButton.className = 'app-bar-action action-forward';[m
[32m+[m[32m                    forwardButton.addEventListener('click', function (e) {[m
[32m+[m[32m                        if (popup.canGoForward) { popup.goForward(); }[m
                     });[m
 [m
[31m-                    closeButton = document.createElement("div");[m
[31m-                    closeButton.innerText = "close";[m
[31m-                    closeButton.className = "app-bar-action action-close";[m
[31m-                    closeButton.addEventListener("click", closeHandler);[m
[32m+[m[32m                    closeButton = document.createElement('div');[m
[32m+[m[32m                    closeButton.innerText = 'close';[m
[32m+[m[32m                    closeButton.className = 'app-bar-action action-close';[m
[32m+[m[32m                    closeButton.addEventListener('click', closeHandler);[m
 [m
                     if (!isWebViewAvailable) {[m
                         // iframe navigation is not yet supported[m
[31m-                        backButton.setAttribute("disabled", "true");[m
[31m-                        forwardButton.setAttribute("disabled", "true");[m
[32m+[m[32m                        backButton.setAttribute('disabled', 'true');[m
[32m+[m[32m                        forwardButton.setAttribute('disabled', 'true');[m
                     }[m
 [m
                     navigationButtonsDivInner.appendChild(backButton);[m
[36m@@ -269,14 +268,14 @@[m [mvar IAB = {[m
 [m
                     browserWrap.appendChild(navigationButtonsDiv);[m
                 } else {[m
[31m-                    popup.style.height = "100%";[m
[32m+[m[32m                    popup.style.height = '100%';[m
                 }[m
 [m
                 // start listening for navigation events[m
                 attachNavigationEvents(popup, navigationEventsCallback);[m
 [m
                 if (isWebViewAvailable) {[m
[31m-                    strUrl = strUrl.replace("ms-appx://", "ms-appx-web://");[m
[32m+[m[32m                    strUrl = strUrl.replace('ms-appx://', 'ms-appx-web://');[m
                 }[m
                 popup.src = strUrl;[m
             }[m
[36m@@ -285,11 +284,11 @@[m [mvar IAB = {[m
 [m
     injectScriptCode: function (win, fail, args) {[m
         setImmediate(function () {[m
[31m-            var code = args[0],[m
[31m-                hasCallback = args[1];[m
[32m+[m[32m            var code = args[0];[m
[32m+[m[32m            var hasCallback = args[1];[m
 [m
             if (isWebViewAvailable && browserWrap && popup) {[m
[31m-                var op = popup.invokeScriptAsync("eval", code);[m
[32m+[m[32m                var op = popup.invokeScriptAsync('eval', code);[m
                 op.oncomplete = function (e) {[m
                     if (hasCallback) {[m
                         // return null if event target is unavailable by some reason[m
[36m@@ -305,19 +304,20 @@[m [mvar IAB = {[m
 [m
     injectScriptFile: function (win, fail, args) {[m
         setImmediate(function () {[m
[31m-            var filePath = args[0],[m
[31m-                hasCallback = args[1];[m
[32m+[m[32m            var filePath = args[0];[m
[32m+[m[32m            var hasCallback = args[1];[m
 [m
[31m-            if (!!filePath) {[m
[32m+[m[32m            if (filePath) {[m
                 filePath = urlutil.makeAbsolute(filePath);[m
             }[m
 [m
             if (isWebViewAvailable && browserWrap && popup) {[m
[31m-                var uri = new Windows.Foundation.Uri(filePath);[m
[32m+[m[32m                // CB-12364 getFileFromApplicationUriAsync does not support ms-appx-web[m
[32m+[m[32m                var uri = new Windows.Foundation.Uri(filePath.replace('ms-appx-web:', 'ms-appx:'));[m
                 Windows.Storage.StorageFile.getFileFromApplicationUriAsync(uri).done(function (file) {[m
                     Windows.Storage.FileIO.readTextAsync(file).done(function (code) {[m
[31m-                        var op = popup.invokeScriptAsync("eval", code);[m
[31m-                        op.oncomplete = function(e) {[m
[32m+[m[32m                        var op = popup.invokeScriptAsync('eval', code);[m
[32m+[m[32m                        op.oncomplete = function (e) {[m
                             if (hasCallback) {[m
                                 var result = [e.target.result];[m
                                 win(result);[m
[36m@@ -333,8 +333,8 @@[m [mvar IAB = {[m
 [m
     injectStyleCode: function (win, fail, args) {[m
         setImmediate(function () {[m
[31m-            var code = args[0],[m
[31m-                hasCallback = args[1];[m
[32m+[m[32m            var code = args[0];[m
[32m+[m[32m            var hasCallback = args[1];[m
 [m
             if (isWebViewAvailable && browserWrap && popup) {[m
                 injectCSS(popup, code, hasCallback && win);[m
[36m@@ -344,13 +344,14 @@[m [mvar IAB = {[m
 [m
     injectStyleFile: function (win, fail, args) {[m
         setImmediate(function () {[m
[31m-            var filePath = args[0],[m
[31m-                hasCallback = args[1];[m
[32m+[m[32m            var filePath = args[0];[m
[32m+[m[32m            var hasCallback = args[1];[m
 [m
             filePath = filePath && urlutil.makeAbsolute(filePath);[m
 [m
             if (isWebViewAvailable && browserWrap && popup) {[m
[31m-                var uri = new Windows.Foundation.Uri(filePath);[m
[32m+[m[32m                // CB-12364 getFileFromApplicationUriAsync does not support ms-appx-web[m
[32m+[m[32m                var uri = new Windows.Foundation.Uri(filePath.replace('ms-appx-web:', 'ms-appx:'));[m
                 Windows.Storage.StorageFile.getFileFromApplicationUriAsync(uri).then(function (file) {[m
                     return Windows.Storage.FileIO.readTextAsync(file);[m
                 }).done(function (code) {[m
[36m@@ -366,11 +367,11 @@[m [mvar IAB = {[m
 function injectCSS (webView, cssCode, callback) {[m
     // This will automatically escape all thing that we need (quotes, slashes, etc.)[m
     var escapedCode = JSON.stringify(cssCode);[m
[31m-    var evalWrapper = "(function(d){var c=d.createElement('style');c.innerHTML=%s;d.head.appendChild(c);})(document)"[m
[32m+[m[32m    var evalWrapper = '(function(d){var c=d.createElement(\'style\');c.innerHTML=%s;d.head.appendChild(c);})(document)'[m
         .replace('%s', escapedCode);[m
 [m
[31m-    var op = webView.invokeScriptAsync("eval", evalWrapper);[m
[31m-    op.oncomplete = function() {[m
[32m+[m[32m    var op = webView.invokeScriptAsync('eval', evalWrapper);[m
[32m+[m[32m    op.oncomplete = function () {[m
         if (callback) {[m
             callback([]);[m
         }[m
[36m@@ -381,4 +382,4 @@[m [mfunction injectCSS (webView, cssCode, callback) {[m
 [m
 module.exports = IAB;[m
 [m
[31m-require("cordova/exec/proxy").add("InAppBrowser", module.exports);[m
[32m+[m[32mrequire('cordova/exec/proxy').add('InAppBrowser', module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/wp/InAppBrowser.cs b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/wp/InAppBrowser.cs[m
[1mdeleted file mode 100644[m
[1mindex fa6fbe4..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/src/wp/InAppBrowser.cs[m
[1m+++ /dev/null[m
[36m@@ -1,530 +0,0 @@[m
[31m-﻿/*[m
[31m-	Licensed under the Apache License, Version 2.0 (the "License");[m
[31m-	you may not use this file except in compliance with the License.[m
[31m-	You may obtain a copy of the License at[m
[31m-[m
[31m-	http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-	Unless required by applicable law or agreed to in writing, software[m
[31m-	distributed under the License is distributed on an "AS IS" BASIS,[m
[31m-	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m-	See the License for the specific language governing permissions and[m
[31m-	limitations under the License.[m
[31m-*/[m
[31m-[m
[31m-using System;[m
[31m-using System.Diagnostics;[m
[31m-using System.IO;[m
[31m-using System.Runtime.Serialization;[m
[31m-using System.Windows;[m
[31m-using System.Windows.Controls;[m
[31m-using System.Windows.Media;[m
[31m-using Microsoft.Phone.Controls;[m
[31m-using Microsoft.Phone.Shell;[m
[31m-[m
[31m-#if WP8[m
[31m-using System.Threading.Tasks;[m
[31m-using Windows.ApplicationModel;[m
[31m-using Windows.Storage;[m
[31m-using Windows.System;[m
[31m-[m
[31m-//Use alias in case Cordova File Plugin is enabled. Then the File class will be declared in both and error will occur.[m
[31m-using IOFile = System.IO.File;[m
[31m-#else[m
[31m-using Microsoft.Phone.Tasks;[m
[31m-#endif[m
[31m-[m
[31m-namespace WPCordovaClassLib.Cordova.Commands[m
[31m-{[m
[31m-    [DataContract][m
[31m-    public class BrowserOptions[m
[31m-    {[m
[31m-        [DataMember][m
[31m-        public string url;[m
[31m-[m
[31m-        [DataMember][m
[31m-        public bool isGeolocationEnabled;[m
[31m-    }[m
[31m-[m
[31m-    public class InAppBrowser : BaseCommand[m
[31m-    {[m
[31m-[m
[31m-        private static WebBrowser browser;[m
[31m-        private static ApplicationBarIconButton backButton;[m
[31m-        private static ApplicationBarIconButton fwdButton;[m
[31m-[m
[31m-        protected ApplicationBar AppBar;[m
[31m-[m
[31m-        protected bool ShowLocation {get;set;}[m
[31m-        protected bool StartHidden  {get;set;}[m
[31m-[m
[31m-        protected string NavigationCallbackId { get; set; }[m
[31m-[m
[31m-        public void open(string options)[m
[31m-        {[m
[31m-            // reset defaults on ShowLocation + StartHidden features [m
[31m-            ShowLocation = true;[m
[31m-            StartHidden = false;[m
[31m-[m
[31m-            string[] args = JSON.JsonHelper.Deserialize<string[]>(options);[m
[31m-            //BrowserOptions opts = JSON.JsonHelper.Deserialize<BrowserOptions>(options);[m
[31m-            string urlLoc = args[0];[m
[31m-            string target = args[1];[m
[31m-            string featString = args[2];[m
[31m-            this.NavigationCallbackId = args[3];[m
[31m-[m
[31m-            if (!string.IsNullOrEmpty(featString))[m
[31m-            {[m
[31m-                string[] features = featString.Split(',');[m
[31m-                foreach (string str in features)[m
[31m-                {[m
[31m-                    try[m
[31m-                    {[m
[31m-                        string[] split = str.Split('=');[m
[31m-                        switch (split[0])[m
[31m-                        {[m
[31m-                            case "location":[m
[31m-                                ShowLocation = split[1].StartsWith("yes", StringComparison.OrdinalIgnoreCase);[m
[31m-                                break;[m
[31m-                            case "hidden":[m
[31m-                                StartHidden = split[1].StartsWith("yes", StringComparison.OrdinalIgnoreCase);[m
[31m-                                break;[m
[31m-                        }[m
[31m-                    }[m
[31m-                    catch (Exception)[m
[31m-                    {[m
[31m-                        // some sort of invalid param was passed, moving on ...[m
[31m-                    }[m
[31m-                }[m
[31m-            }[m
[31m-            /*[m
[31m-                _self - opens in the Cordova WebView if url is in the white-list, else it opens in the InAppBrowser [m
[31m-                _blank - always open in the InAppBrowser [m
[31m-                _system - always open in the system web browser [m
[31m-            */[m
[31m-            switch (target)[m
[31m-            {[m
[31m-                case "_blank":[m
[31m-                    ShowInAppBrowser(urlLoc);[m
[31m-                    break;[m
[31m-                case "_self":[m
[31m-                    ShowCordovaBrowser(urlLoc);[m
[31m-                    break;[m
[31m-                case "_system":[m
[31m-                    ShowSystemBrowser(urlLoc);[m
[31m-                    break;[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void show(string options)[m
[31m-        {[m
[31m-            string[] args = JSON.JsonHelper.Deserialize<string[]>(options);[m
[31m-[m
[31m-[m
[31m-            if (browser != null)[m
[31m-            {[m
[31m-                Deployment.Current.Dispatcher.BeginInvoke(() =>[m
[31m-                {[m
[31m-                    browser.Visibility = Visibility.Visible;[m
[31m-                    AppBar.IsVisible = true;[m
[31m-                });[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void hide(string options)[m
[31m-        {[m
[31m-            string[] args = JSON.JsonHelper.Deserialize<string[]>(options);[m
[31m-[m
[31m-[m
[31m-            if (browser != null)[m
[31m-            {[m
[31m-                Deployment.Current.Dispatcher.BeginInvoke(() =>[m
[31m-                {[m
[31m-                    browser.Visibility = Visibility.Collapsed;[m
[31m-                    AppBar.IsVisible = false;[m
[31m-                });[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void injectScriptCode(string options)[m
[31m-        {[m
[31m-            string[] args = JSON.JsonHelper.Deserialize<string[]>(options);[m
[31m-[m
[31m-            bool bCallback = false;[m
[31m-            if (bool.TryParse(args[1], out bCallback)) { };[m
[31m-[m
[31m-            string callbackId = args[2];[m
[31m-[m
[31m-            if (browser != null)[m
[31m-            {[m
[31m-                Deployment.Current.Dispatcher.BeginInvoke(() =>[m
[31m-                {[m
[31m-                    var res = browser.InvokeScript("eval", new string[] { args[0] });[m
[31m-[m
[31m-                    if (bCallback)[m
[31m-                    {[m
[31m-                        PluginResult result = new PluginResult(PluginResult.Status.OK, res.ToString());[m
[31m-                        result.KeepCallback = false;[m
[31m-                        this.DispatchCommandResult(result);[m
[31m-                    }[m
[31m-[m
[31m-                });[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        public void injectScriptFile(string options)[m
[31m-        {[m
[31m-            Debug.WriteLine("Error : Windows Phone cordova-plugin-inappbrowser does not currently support executeScript");[m
[31m-            string[] args = JSON.JsonHelper.Deserialize<string[]>(options);[m
[31m-            // throw new NotImplementedException("Windows Phone does not currently support 'executeScript'");[m
[31m-        }[m
[31m-[m
[31m-        public void injectStyleCode(string options)[m
[31m-        {[m
[31m-            Debug.WriteLine("Error : Windows Phone cordova-plugin-inappbrowser does not currently support insertCSS");[m
[31m-            return;[m
[31m-[m
[31m-            //string[] args = JSON.JsonHelper.Deserialize<string[]>(options);[m
[31m-            //bool bCallback = false;[m
[31m-            //if (bool.TryParse(args[1], out bCallback)) { };[m
[31m-[m
[31m-            //string callbackId = args[2];[m
[31m-[m
[31m-            //if (browser != null)[m
[31m-            //{[m
[31m-                //Deployment.Current.Dispatcher.BeginInvoke(() =>[m
[31m-                //{[m
[31m-                //    if (bCallback)[m
[31m-                //    {[m
[31m-                //        string cssInsertString = "try{(function(doc){var c = '<style>body{background-color:#ffff00;}</style>'; doc.head.innerHTML += c;})(document);}catch(ex){alert('oops : ' + ex.message);}";[m
[31m-                //        //cssInsertString = cssInsertString.Replace("_VALUE_", args[0]);[m
[31m-                //        Debug.WriteLine("cssInsertString = " + cssInsertString);[m
[31m-                //        var res = browser.InvokeScript("eval", new string[] { cssInsertString });[m
[31m-                //        if (bCallback)[m
[31m-                //        {[m
[31m-                //            PluginResult result = new PluginResult(PluginResult.Status.OK, res.ToString());[m
[31m-                //            result.KeepCallback = false;[m
[31m-                //            this.DispatchCommandResult(result);[m
[31m-                //        }[m
[31m-                //    }[m
[31m-[m
[31m-                //});[m
[31m-            //}[m
[31m-        }[m
[31m-[m
[31m-        public void injectStyleFile(string options)[m
[31m-        {[m
[31m-            Debug.WriteLine("Error : Windows Phone cordova-plugin-inappbrowser does not currently support insertCSS");[m
[31m-            return;[m
[31m-[m
[31m-            //string[] args = JSON.JsonHelper.Deserialize<string[]>(options);[m
[31m-            //throw new NotImplementedException("Windows Phone does not currently support 'insertCSS'");[m
[31m-        }[m
[31m-[m
[31m-        private void ShowCordovaBrowser(string url)[m
[31m-        {[m
[31m-            Uri loc = new Uri(url, UriKind.RelativeOrAbsolute);[m
[31m-            Deployment.Current.Dispatcher.BeginInvoke(() =>[m
[31m-            {[m
[31m-                PhoneApplicationFrame frame = Application.Current.RootVisual as PhoneApplicationFrame;[m
[31m-                if (frame != null)[m
[31m-                {[m
[31m-                    PhoneApplicationPage page = frame.Content as PhoneApplicationPage;[m
[31m-                    if (page != null)[m
[31m-                    {[m
[31m-                        CordovaView cView = page.FindName("CordovaView") as CordovaView;[m
[31m-                        if (cView != null)[m
[31m-                        {[m
[31m-                            WebBrowser br = cView.Browser;[m
[31m-                            br.Navigate2(loc);[m
[31m-                        }[m
[31m-                    }[m
[31m-[m
[31m-                }[m
[31m-            });[m
[31m-        }[m
[31m-[m
[31m-#if WP8[m
[31m-        private async void ShowSystemBrowser(string url)[m
[31m-        {[m
[31m-            var pathUri = new Uri(url, UriKind.Absolute);[m
[31m-            if (pathUri.Scheme == Uri.UriSchemeHttp || pathUri.Scheme == Uri.UriSchemeHttps)[m
[31m-            {[m
[31m-                await Launcher.LaunchUriAsync(pathUri);[m
[31m-                return;[m
[31m-            }[m
[31m-[m
[31m-            var file = await GetFile(pathUri.AbsolutePath.Replace('/', Path.DirectorySeparatorChar));[m
[31m-            if (file != null)[m
[31m-            {[m
[31m-                await Launcher.LaunchFileAsync(file);[m
[31m-            }[m
[31m-            else[m
[31m-            {[m
[31m-                Debug.WriteLine("File not found.");[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        private async Task<StorageFile> GetFile(string fileName)[m
[31m-        {[m
[31m-            //first try to get the file from the isolated storage[m
[31m-            var localFolder = ApplicationData.Current.LocalFolder;[m
[31m-            if (IOFile.Exists(Path.Combine(localFolder.Path, fileName)))[m
[31m-            {[m
[31m-                return await localFolder.GetFileAsync(fileName);[m
[31m-            }[m
[31m-[m
[31m-            //if file is not found try to get it from the xap[m
[31m-            var filePath = Path.Combine(Package.Current.InstalledLocation.Path, fileName);[m
[31m-            if (IOFile.Exists(filePath))[m
[31m-            {[m
[31m-                return await StorageFile.GetFileFromPathAsync(filePath);[m
[31m-            }[m
[31m-[m
[31m-            return null;[m
[31m-        }[m
[31m-#else[m
[31m-        private void ShowSystemBrowser(string url)[m
[31m-        {[m
[31m-            WebBrowserTask webBrowserTask = new WebBrowserTask();[m
[31m-            webBrowserTask.Uri = new Uri(url, UriKind.Absolute);[m
[31m-            webBrowserTask.Show();[m
[31m-        }[m
[31m-#endif[m
[31m-[m
[31m-        private void ShowInAppBrowser(string url)[m
[31m-        {[m
[31m-            Uri loc = new Uri(url, UriKind.RelativeOrAbsolute);[m
[31m-[m
[31m-            Deployment.Current.Dispatcher.BeginInvoke(() =>[m
[31m-            {[m
[31m-                if (browser != null)[m
[31m-                {[m
[31m-                    //browser.IsGeolocationEnabled = opts.isGeolocationEnabled;[m
[31m-                    browser.Navigate2(loc);[m
[31m-                }[m
[31m-                else[m
[31m-                {[m
[31m-                    PhoneApplicationFrame frame = Application.Current.RootVisual as PhoneApplicationFrame;[m
[31m-                    if (frame != null)[m
[31m-                    {[m
[31m-                        PhoneApplicationPage page = frame.Content as PhoneApplicationPage;[m
[31m-[m
[31m-                        string baseImageUrl = "Images/";[m
[31m-[m
[31m-                        if (page != null)[m
[31m-                        {[m
[31m-                            Grid grid = page.FindName("LayoutRoot") as Grid;[m
[31m-                            if (grid != null)[m
[31m-                            {[m
[31m-                                browser = new WebBrowser();[m
[31m-                                browser.IsScriptEnabled = true;[m
[31m-                                browser.LoadCompleted += new System.Windows.Navigation.LoadCompletedEventHandler(browser_LoadCompleted);[m
[31m-[m
[31m-                                browser.Navigating += new EventHandler<NavigatingEventArgs>(browser_Navigating);[m
[31m-                                browser.NavigationFailed += new System.Windows.Navigation.NavigationFailedEventHandler(browser_NavigationFailed);[m
[31m-                                browser.Navigated += new EventHandler<System.Windows.Navigation.NavigationEventArgs>(browser_Navigated);[m
[31m-                                browser.Navigate2(loc);[m
[31m-[m
[31m-                                if (StartHidden)[m
[31m-                                {[m
[31m-                                    browser.Visibility = Visibility.Collapsed;[m
[31m-                                }[m
[31m-[m
[31m-                                //browser.IsGeolocationEnabled = opts.isGeolocationEnabled;[m
[31m-                                grid.Children.Add(browser);[m
[31m-                            }[m
[31m-[m
[31m-                            ApplicationBar bar = new ApplicationBar();[m
[31m-                            bar.BackgroundColor = Colors.Gray;[m
[31m-                            bar.IsMenuEnabled = false;[m
[31m-[m
[31m-                            backButton = new ApplicationBarIconButton();[m
[31m-                            backButton.Text = "Back";[m
[31m-[m
[31m-                            backButton.IconUri = new Uri(baseImageUrl + "appbar.back.rest.png", UriKind.Relative);[m
[31m-                            backButton.Click += new EventHandler(backButton_Click);[m
[31m-                            bar.Buttons.Add(backButton);[m
[31m-[m
[31m-[m
[31m-                            fwdButton = new ApplicationBarIconButton();[m
[31m-                            fwdButton.Text = "Forward";[m
[31m-                            fwdButton.IconUri = new Uri(baseImageUrl + "appbar.next.rest.png", UriKind.Relative);[m
[31m-                            fwdButton.Click += new EventHandler(fwdButton_Click);[m
[31m-                            bar.Buttons.Add(fwdButton);[m
[31m-[m
[31m-                            ApplicationBarIconButton closeBtn = new ApplicationBarIconButton();[m
[31m-                            closeBtn.Text = "Close";[m
[31m-                            closeBtn.IconUri = new Uri(baseImageUrl + "appbar.close.rest.png", UriKind.Relative);[m
[31m-                            closeBtn.Click += new EventHandler(closeBtn_Click);[m
[31m-                            bar.Buttons.Add(closeBtn);[m
[31m-[m
[31m-                            page.ApplicationBar = bar;[m
[31m-                            bar.IsVisible = !StartHidden;[m
[31m-                            AppBar = bar;[m
[31m-[m
[31m-                            page.BackKeyPress += page_BackKeyPress;[m
[31m-[m
[31m-                        }[m
[31m-[m
[31m-                    }[m
[31m-                }[m
[31m-            });[m
[31m-        }[m
[31m-[m
[31m-        void page_BackKeyPress(object sender, System.ComponentModel.CancelEventArgs e)[m
[31m-        {[m
[31m-#if WP8[m
[31m-            if (browser.CanGoBack)[m
[31m-            {[m
[31m-                browser.GoBack();[m
[31m-            }[m
[31m-            else[m
[31m-            {[m
[31m-                close();[m
[31m-            }[m
[31m-            e.Cancel = true;[m
[31m-#else[m
[31m-                    browser.InvokeScript("execScript", "history.back();");[m
[31m-#endif[m
[31m-        }[m
[31m-[m
[31m-        void browser_LoadCompleted(object sender, System.Windows.Navigation.NavigationEventArgs e)[m
[31m-        {[m
[31m-[m
[31m-        }[m
[31m-[m
[31m-        void fwdButton_Click(object sender, EventArgs e)[m
[31m-        {[m
[31m-            if (browser != null)[m
[31m-            {[m
[31m-                try[m
[31m-                {[m
[31m-#if WP8[m
[31m-                    browser.GoForward();[m
[31m-#else[m
[31m-                    browser.InvokeScript("execScript", "history.forward();");[m
[31m-#endif[m
[31m-                }[m
[31m-                catch (Exception)[m
[31m-                {[m
[31m-[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        void backButton_Click(object sender, EventArgs e)[m
[31m-        {[m
[31m-            if (browser != null)[m
[31m-            {[m
[31m-                try[m
[31m-                {[m
[31m-#if WP8[m
[31m-                    browser.GoBack();[m
[31m-#else[m
[31m-                    browser.InvokeScript("execScript", "history.back();");[m
[31m-#endif[m
[31m-                }[m
[31m-                catch (Exception)[m
[31m-                {[m
[31m-[m
[31m-                }[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        void closeBtn_Click(object sender, EventArgs e)[m
[31m-        {[m
[31m-            this.close();[m
[31m-        }[m
[31m-[m
[31m-[m
[31m-        public void close(string options = "")[m
[31m-        {[m
[31m-            if (browser != null)[m
[31m-            {[m
[31m-                Deployment.Current.Dispatcher.BeginInvoke(() =>[m
[31m-                {[m
[31m-                    PhoneApplicationFrame frame = Application.Current.RootVisual as PhoneApplicationFrame;[m
[31m-                    if (frame != null)[m
[31m-                    {[m
[31m-                        PhoneApplicationPage page = frame.Content as PhoneApplicationPage;[m
[31m-                        if (page != null)[m
[31m-                        {[m
[31m-                            Grid grid = page.FindName("LayoutRoot") as Grid;[m
[31m-                            if (grid != null)[m
[31m-                            {[m
[31m-                                grid.Children.Remove(browser);[m
[31m-                            }[m
[31m-                            page.ApplicationBar = null;[m
[31m-                            page.BackKeyPress -= page_BackKeyPress;[m
[31m-                        }[m
[31m-                    }[m
[31m-                   [m
[31m-                    browser = null;[m
[31m-                    string message = "{\"type\":\"exit\"}";[m
[31m-                    PluginResult result = new PluginResult(PluginResult.Status.OK, message);[m
[31m-                    result.KeepCallback = false;[m
[31m-                    this.DispatchCommandResult(result, NavigationCallbackId);[m
[31m-                });[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        void browser_Navigated(object sender, System.Windows.Navigation.NavigationEventArgs e)[m
[31m-        {[m
[31m-#if WP8[m
[31m-            if (browser != null)[m
[31m-            {[m
[31m-                backButton.IsEnabled = browser.CanGoBack;[m
[31m-                fwdButton.IsEnabled = browser.CanGoForward;[m
[31m-[m
[31m-            }[m
[31m-#endif[m
[31m-            string message = "{\"type\":\"loadstop\", \"url\":\"" + e.Uri.OriginalString + "\"}";[m
[31m-            PluginResult result = new PluginResult(PluginResult.Status.OK, message);[m
[31m-            result.KeepCallback = true;[m
[31m-            this.DispatchCommandResult(result, NavigationCallbackId);[m
[31m-        }[m
[31m-[m
[31m-        void browser_NavigationFailed(object sender, System.Windows.Navigation.NavigationFailedEventArgs e)[m
[31m-        {[m
[31m-            string message = "{\"type\":\"error\",\"url\":\"" + e.Uri.OriginalString + "\"}";[m
[31m-            PluginResult result = new PluginResult(PluginResult.Status.ERROR, message);[m
[31m-            result.KeepCallback = true;[m
[31m-            this.DispatchCommandResult(result, NavigationCallbackId);[m
[31m-        }[m
[31m-[m
[31m-        void browser_Navigating(object sender, NavigatingEventArgs e)[m
[31m-        {[m
[31m-            string message = "{\"type\":\"loadstart\",\"url\":\"" + e.Uri.OriginalString + "\"}";[m
[31m-            PluginResult result = new PluginResult(PluginResult.Status.OK, message);[m
[31m-            result.KeepCallback = true;[m
[31m-            this.DispatchCommandResult(result, NavigationCallbackId);[m
[31m-        }[m
[31m-[m
[31m-    }[m
[31m-[m
[31m-    internal static class WebBrowserExtensions[m
[31m-    {[m
[31m-        /// <summary>[m
[31m-        /// Improved method to initiate request to the provided URI. Supports 'data:text/html' urls. [m
[31m-        /// </summary>[m
[31m-        /// <param name="browser">The browser instance</param>[m
[31m-        /// <param name="uri">The requested uri</param>[m
[31m-        internal static void Navigate2(this WebBrowser browser, Uri uri)[m
[31m-        {[m
[31m-            // IE10 does not support data uri so we use NavigateToString method instead[m
[31m-            if (uri.Scheme == "data")[m
[31m-            {[m
[31m-                // we should remove the scheme identifier and unescape the uri[m
[31m-                string uriString = Uri.UnescapeDataString(uri.AbsoluteUri);[m
[31m-                // format is 'data:text/html, ...'[m
[31m-                string html = new System.Text.RegularExpressions.Regex("^data:text/html,").Replace(uriString, "");[m
[31m-                browser.NavigateToString(html);[m
[31m-            }[m
[31m-            else [m
[31m-            {[m
[31m-                browser.Navigate(uri);[m
[31m-            }[m
[31m-        }[m
[31m-    }[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/tests/plugin.xml b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/tests/plugin.xml[m
[1mindex 3394bec..13f255f 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/tests/plugin.xml[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/tests/plugin.xml[m
[36m@@ -20,7 +20,7 @@[m
 [m
 <plugin xmlns="http://apache.org/cordova/ns/plugins/1.0"[m
     id="cordova-plugin-inappbrowser-tests"[m
[31m-    version="1.6.1">[m
[32m+[m[32m    version="3.0.0">[m
     <name>Cordova InAppBrowser Plugin Tests</name>[m
     <license>Apache 2.0</license>[m
 [m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/tests/resources/inject.js b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/tests/resources/inject.js[m
[1mindex a89a421..d704ab3 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/tests/resources/inject.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/tests/resources/inject.js[m
[36m@@ -16,5 +16,5 @@[m
  * specific language governing permissions and limitations[m
  * under the License.[m
 */[m
[31m-var d = document.getElementById("header");[m
[31m-d.innerHTML = "Script file successfully injected";[m
[32m+[m[32mvar d = document.getElementById('header');[m
[32m+[m[32md.innerHTML = 'Script file successfully injected';[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/tests/tests.js b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/tests/tests.js[m
[1mindex de0c090..abb2a6d 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/tests/tests.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/tests/tests.js[m
[36m@@ -19,23 +19,27 @@[m
  *[m
 */[m
 [m
[31m-/* jshint jasmine: true */[m
 /* global MSApp */[m
 [m
 var cordova = require('cordova');[m
[31m-var isWindows = cordova.platformId == 'windows';[m
[32m+[m[32mvar isWindows = cordova.platformId === 'windows';[m
[32m+[m[32mvar isBrowser = cordova.platformId === 'browser';[m
 [m
 window.alert = window.alert || navigator.notification.alert;[m
[32m+[m[32mif (isWindows && navigator && navigator.notification && navigator.notification.alert) {[m
[32m+[m[32m    // window.alert is defined but not functional on UWP[m
[32m+[m[32m    window.alert = navigator.notification.alert;[m
[32m+[m[32m}[m
 [m
 exports.defineAutoTests = function () {[m
 [m
     describe('cordova.InAppBrowser', function () {[m
 [m
[31m-        it("inappbrowser.spec.1 should exist", function () {[m
[32m+[m[32m        it('inappbrowser.spec.1 should exist', function () {[m
             expect(cordova.InAppBrowser).toBeDefined();[m
         });[m
 [m
[31m-        it("inappbrowser.spec.2 should contain open function", function () {[m
[32m+[m[32m        it('inappbrowser.spec.2 should contain open function', function () {[m
             expect(cordova.InAppBrowser.open).toBeDefined();[m
             expect(cordova.InAppBrowser.open).toEqual(jasmine.any(Function));[m
         });[m
[36m@@ -43,7 +47,7 @@[m [mexports.defineAutoTests = function () {[m
 [m
     describe('open method', function () {[m
 [m
[31m-        if (cordova.platformId == 'osx') {[m
[32m+[m[32m        if (cordova.platformId === 'osx') {[m
             pending('Open method not fully supported on OSX.');[m
             return;[m
         }[m
[36m@@ -73,15 +77,16 @@[m [mexports.defineAutoTests = function () {[m
             setTimeout(done, 2000);[m
         });[m
 [m
[31m-        function verifyEvent(evt, type) {[m
[32m+[m[32m        function verifyEvent (evt, type) {[m
             expect(evt).toBeDefined();[m
             expect(evt.type).toEqual(type);[m
[31m-            if (type !== 'exit') { // `exit` event does not have url field[m
[32m+[m[32m            // `exit` event does not have url field, browser returns null url for CORS requests[m
[32m+[m[32m            if (type !== 'exit' && !isBrowser) {[m
                 expect(evt.url).toEqual(url);[m
             }[m
         }[m
 [m
[31m-        function verifyLoadErrorEvent(evt) {[m
[32m+[m[32m        function verifyLoadErrorEvent (evt) {[m
             expect(evt).toBeDefined();[m
             expect(evt.type).toEqual('loaderror');[m
             expect(evt.url).toEqual(badUrl);[m
[36m@@ -89,7 +94,7 @@[m [mexports.defineAutoTests = function () {[m
             expect(evt.message).toEqual(jasmine.any(String));[m
         }[m
 [m
[31m-        it("inappbrowser.spec.3 should retun InAppBrowser instance with required methods", function () {[m
[32m+[m[32m        it('inappbrowser.spec.3 should return InAppBrowser instance with required methods', function () {[m
             iabInstance = cordova.InAppBrowser.open(url, '_blank');[m
 [m
             expect(iabInstance).toBeDefined();[m
[36m@@ -103,7 +108,7 @@[m [mexports.defineAutoTests = function () {[m
             expect(iabInstance.insertCSS).toEqual(jasmine.any(Function));[m
         });[m
 [m
[31m-        it("inappbrowser.spec.4 should support loadstart and loadstop events", function (done) {[m
[32m+[m[32m        it('inappbrowser.spec.4 should support loadstart and loadstop events', function (done) {[m
             var onLoadStart = jasmine.createSpy('loadstart event callback').and.callFake(function (evt) {[m
                 verifyEvent(evt, 'loadstart');[m
             });[m
[36m@@ -112,12 +117,16 @@[m [mexports.defineAutoTests = function () {[m
             iabInstance.addEventListener('loadstart', onLoadStart);[m
             iabInstance.addEventListener('loadstop', function (evt) {[m
                 verifyEvent(evt, 'loadstop');[m
[31m-                expect(onLoadStart).toHaveBeenCalled();[m
[32m+[m[32m                if (!isBrowser) {[m
[32m+[m[32m                    // according to documentation, "loadstart" event is not supported on browser[m
[32m+[m[32m                    // https://github.com/apache/cordova-plugin-inappbrowser#browser-quirks-1[m
[32m+[m[32m                    expect(onLoadStart).toHaveBeenCalled();[m
[32m+[m[32m                }[m
                 done();[m
             });[m
         });[m
 [m
[31m-        it("inappbrowser.spec.5 should support exit event", function (done) {[m
[32m+[m[32m        it('inappbrowser.spec.5 should support exit event', function (done) {[m
             iabInstance = cordova.InAppBrowser.open(url, '_blank');[m
             iabInstance.addEventListener('exit', function (evt) {[m
                 verifyEvent(evt, 'exit');[m
[36m@@ -127,7 +136,12 @@[m [mexports.defineAutoTests = function () {[m
             iabInstance = null;[m
         });[m
 [m
[31m-        it("inappbrowser.spec.6 should support loaderror event", function (done) {[m
[32m+[m[32m        it('inappbrowser.spec.6 should support loaderror event', function (done) {[m
[32m+[m[32m            if (isBrowser) {[m
[32m+[m[32m                // according to documentation, "loaderror" event is not supported on browser[m
[32m+[m[32m                // https://github.com/apache/cordova-plugin-inappbrowser#browser-quirks-1[m
[32m+[m[32m                pending('Browser platform doesn\'t support loaderror event');[m
[32m+[m[32m            }[m
             iabInstance = cordova.InAppBrowser.open(badUrl, '_blank');[m
             iabInstance.addEventListener('loaderror', function (evt) {[m
                 verifyLoadErrorEvent(evt);[m
[36m@@ -139,15 +153,15 @@[m [mexports.defineAutoTests = function () {[m
 [m
 exports.defineManualTests = function (contentEl, createActionButton) {[m
 [m
[31m-    function doOpen(url, target, params, numExpectedRedirects, useWindowOpen) {[m
[32m+[m[32m    function doOpen (url, target, params, numExpectedRedirects, useWindowOpen) {[m
         numExpectedRedirects = numExpectedRedirects || 0;[m
         useWindowOpen = useWindowOpen || false;[m
[31m-        console.log("Opening " + url);[m
[32m+[m[32m        console.log('Opening ' + url);[m
 [m
         var counts;[m
         var lastLoadStartURL;[m
         var wasReset = false;[m
[31m-        function reset() {[m
[32m+[m[32m        function reset () {[m
             counts = {[m
                 'loaderror': 0,[m
                 'loadstart': 0,[m
[36m@@ -168,49 +182,48 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         if (useWindowOpen) {[m
             console.log('Use window.open() for url');[m
             iab = window.open(url, target, params, callbacks);[m
[31m-        }[m
[31m-        else {[m
[32m+[m[32m        } else {[m
             iab = cordova.InAppBrowser.open(url, target, params, callbacks);[m
         }[m
         if (!iab) {[m
[31m-            alert('open returned ' + iab);[m
[32m+[m[32m            alert('open returned ' + iab); // eslint-disable-line no-undef[m
             return;[m
         }[m
 [m
[31m-        function logEvent(e) {[m
[32m+[m[32m        function logEvent (e) {[m
             console.log('IAB event=' + JSON.stringify(e));[m
             counts[e.type]++;[m
             // Verify that event.url gets updated on redirects.[m
[31m-            if (e.type == 'loadstart') {[m
[31m-                if (e.url == lastLoadStartURL) {[m
[31m-                    alert('Unexpected: loadstart fired multiple times for the same URL.');[m
[32m+[m[32m            if (e.type === 'loadstart') {[m
[32m+[m[32m                if (e.url === lastLoadStartURL) {[m
[32m+[m[32m                    alert('Unexpected: loadstart fired multiple times for the same URL.'); // eslint-disable-line no-undef[m
                 }[m
                 lastLoadStartURL = e.url;[m
             }[m
             // Verify the right number of loadstart events were fired.[m
[31m-            if (e.type == 'loadstop' || e.type == 'loaderror') {[m
[31m-                if (e.url != lastLoadStartURL) {[m
[31m-                    alert('Unexpected: ' + e.type + ' event.url != loadstart\'s event.url');[m
[32m+[m[32m            if (e.type === 'loadstop' || e.type === 'loaderror') {[m
[32m+[m[32m                if (e.url !== lastLoadStartURL) {[m
[32m+[m[32m                    alert('Unexpected: ' + e.type + ' event.url != loadstart\'s event.url'); // eslint-disable-line no-undef[m
                 }[m
                 if (numExpectedRedirects === 0 && counts.loadstart !== 1) {[m
                     // Do allow a loaderror without a loadstart (e.g. in the case of an invalid URL).[m
[31m-                    if (!(e.type == 'loaderror' && counts.loadstart === 0)) {[m
[31m-                        alert('Unexpected: got multiple loadstart events. (' + counts.loadstart + ')');[m
[32m+[m[32m                    if (!(e.type === 'loaderror' && counts.loadstart === 0)) {[m
[32m+[m[32m                        alert('Unexpected: got multiple loadstart events. (' + counts.loadstart + ')'); // eslint-disable-line no-undef[m
                     }[m
                 } else if (numExpectedRedirects > 0 && counts.loadstart < (numExpectedRedirects + 1)) {[m
[31m-                    alert('Unexpected: should have got at least ' + (numExpectedRedirects + 1) + ' loadstart events, but got ' + counts.loadstart);[m
[32m+[m[32m                    alert('Unexpected: should have got at least ' + (numExpectedRedirects + 1) + ' loadstart events, but got ' + counts.loadstart); // eslint-disable-line no-undef[m
                 }[m
                 wasReset = true;[m
                 numExpectedRedirects = 0;[m
                 reset();[m
             }[m
             // Verify that loadend / loaderror was called.[m
[31m-            if (e.type == 'exit') {[m
[32m+[m[32m            if (e.type === 'exit') {[m
                 var numStopEvents = counts.loadstop + counts.loaderror;[m
                 if (numStopEvents === 0 && !wasReset) {[m
[31m-                    alert('Unexpected: browser closed without a loadstop or loaderror.');[m
[32m+[m[32m                    alert('Unexpected: browser closed without a loadstop or loaderror.'); // eslint-disable-line no-undef[m
                 } else if (numStopEvents > 1) {[m
[31m-                    alert('Unexpected: got multiple loadstop/loaderror events.');[m
[32m+[m[32m                    alert('Unexpected: got multiple loadstop/loaderror events.'); // eslint-disable-line no-undef[m
                 }[m
             }[m
         }[m
[36m@@ -218,33 +231,31 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         return iab;[m
     }[m
 [m
[31m-    function doHookOpen(url, target, params, numExpectedRedirects) {[m
[32m+[m[32m    function doHookOpen (url, target, params, numExpectedRedirects) {[m
         var originalFunc = window.open;[m
         var wasClobbered = window.hasOwnProperty('open');[m
         window.open = cordova.InAppBrowser.open;[m
 [m
         try {[m
             doOpen(url, target, params, numExpectedRedirects, true);[m
[31m-        }[m
[31m-        finally {[m
[32m+[m[32m        } finally {[m
             if (wasClobbered) {[m
                 window.open = originalFunc;[m
[31m-            }[m
[31m-            else {[m
[31m-              console.log('just delete, to restore open from prototype');[m
[32m+[m[32m            } else {[m
[32m+[m[32m                console.log('just delete, to restore open from prototype');[m
                 delete window.open;[m
             }[m
         }[m
     }[m
 [m
[31m-    function openWithStyle(url, cssUrl, useCallback) {[m
[32m+[m[32m    function openWithStyle (url, cssUrl, useCallback) {[m
         var iab = doOpen(url, '_blank', 'location=yes');[m
         var callback = function (results) {[m
             if (results && results.length === 0) {[m
[31m-                alert('Results verified');[m
[32m+[m[32m                alert('Results verified'); // eslint-disable-line no-undef[m
             } else {[m
                 console.log(results);[m
[31m-                alert('Got: ' + typeof (results) + '\n' + JSON.stringify(results));[m
[32m+[m[32m                alert('Got: ' + typeof (results) + '\n' + JSON.stringify(results)); // eslint-disable-line no-undef[m
             }[m
         };[m
         if (cssUrl) {[m
[36m@@ -254,21 +265,21 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         } else {[m
             iab.addEventListener('loadstop', function (event) {[m
                 iab.insertCSS({ code: '#style-update-literal { \ndisplay: block !important; \n}' },[m
[31m-                              useCallback && callback);[m
[32m+[m[32m                    useCallback && callback);[m
             });[m
         }[m
     }[m
 [m
[31m-    function openWithScript(url, jsUrl, useCallback) {[m
[32m+[m[32m    function openWithScript (url, jsUrl, useCallback) {[m
         var iab = doOpen(url, '_blank', 'location=yes');[m
         if (jsUrl) {[m
             iab.addEventListener('loadstop', function (event) {[m
                 iab.executeScript({ file: jsUrl }, useCallback && function (results) {[m
                     if (results && results.length === 0) {[m
[31m-                        alert('Results verified');[m
[32m+[m[32m                        alert('Results verified'); // eslint-disable-line no-undef[m
                     } else {[m
                         console.log(results);[m
[31m-                        alert('Got: ' + typeof (results) + '\n' + JSON.stringify(results));[m
[32m+[m[32m                        alert('Got: ' + typeof (results) + '\n' + JSON.stringify(results)); // eslint-disable-line no-undef[m
                     }[m
                 });[m
             });[m
[36m@@ -281,33 +292,33 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
                   '})()';[m
                 iab.executeScript({ code: code }, useCallback && function (results) {[m
                     if (results && results.length === 1 && results[0] === 'abc') {[m
[31m-                        alert('Results verified');[m
[32m+[m[32m                        alert('Results verified'); // eslint-disable-line no-undef[m
                     } else {[m
                         console.log(results);[m
[31m-                        alert('Got: ' + typeof (results) + '\n' + JSON.stringify(results));[m
[32m+[m[32m                        alert('Got: ' + typeof (results) + '\n' + JSON.stringify(results)); // eslint-disable-line no-undef[m
                     }[m
                 });[m
             });[m
         }[m
     }[m
     var hiddenwnd = null;[m
[31m-    var loadlistener = function (event) { alert('background window loaded '); };[m
[31m-    function openHidden(url, startHidden) {[m
[32m+[m[32m    var loadlistener = function (event) { alert('background window loaded '); }; // eslint-disable-line no-undef[m
[32m+[m[32m    function openHidden (url, startHidden) {[m
         var shopt = (startHidden) ? 'hidden=yes' : '';[m
         hiddenwnd = cordova.InAppBrowser.open(url, 'random_string', shopt);[m
         if (!hiddenwnd) {[m
[31m-            alert('cordova.InAppBrowser.open returned ' + hiddenwnd);[m
[32m+[m[32m            alert('cordova.InAppBrowser.open returned ' + hiddenwnd); // eslint-disable-line no-undef[m
             return;[m
         }[m
         if (startHidden) hiddenwnd.addEventListener('loadstop', loadlistener);[m
     }[m
[31m-    function showHidden() {[m
[31m-        if (!!hiddenwnd) {[m
[32m+[m[32m    function showHidden () {[m
[32m+[m[32m        if (hiddenwnd) {[m
             hiddenwnd.show();[m
         }[m
     }[m
[31m-    function closeHidden() {[m
[31m-        if (!!hiddenwnd) {[m
[32m+[m[32m    function closeHidden () {[m
[32m+[m[32m        if (hiddenwnd) {[m
             hiddenwnd.removeEventListener('loadstop', loadlistener);[m
             hiddenwnd.close();[m
             hiddenwnd = null;[m
[36m@@ -452,14 +463,14 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         '<p/> <div id="openHardwareBackYes"></div>' +[m
         'Expected result: hardwareback=yes pressing back button should navigate backwards in history then close InAppBrowser' +[m
         '<p/> <div id="openHardwareBackNo"></div>' +[m
[31m-        'Expected result: hardwareback=no pressing back button should close InAppBrowser regardless history' + [m
[32m+[m[32m        'Expected result: hardwareback=no pressing back button should close InAppBrowser regardless history' +[m
         '<p/> <div id="openHardwareBackDefaultAfterNo"></div>' +[m
         'Expected result: consistently open browsers with with the appropriate option: hardwareback=defaults to yes then hardwareback=no then hardwareback=defaults to yes. By default hardwareback is yes so pressing back button should navigate backwards in history then close InAppBrowser';[m
 [m
     // CB-7490 We need to wrap this code due to Windows security restrictions[m
     // see http://msdn.microsoft.com/en-us/library/windows/apps/hh465380.aspx#differences for details[m
     if (window.MSApp && window.MSApp.execUnsafeLocalFunction) {[m
[31m-        MSApp.execUnsafeLocalFunction(function() {[m
[32m+[m[32m        MSApp.execUnsafeLocalFunction(function () {[m
             contentEl.innerHTML = info_div + local_tests + white_listed_tests + non_white_listed_tests + page_with_redirects_tests + pdf_url_tests + invalid_url_tests +[m
                 css_js_injection_tests + open_hidden_tests + clearing_cache_tests + video_tag_tests + local_with_anchor_tag_tests + hardwareback_tests;[m
         });[m
[36m@@ -468,18 +479,18 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
             css_js_injection_tests + open_hidden_tests + clearing_cache_tests + video_tag_tests + local_with_anchor_tag_tests + hardwareback_tests;[m
     }[m
 [m
[31m-    document.getElementById("user-agent").textContent = navigator.userAgent;[m
[32m+[m[32m    document.getElementById('user-agent').textContent = navigator.userAgent;[m
 [m
     // we are already in cdvtests directory[m
     var basePath = 'iab-resources/';[m
[31m-    var localhtml = basePath + 'local.html',[m
[31m-        localpdf = basePath + 'local.pdf',[m
[31m-        injecthtml = basePath + 'inject.html',[m
[31m-        injectjs = isWindows ? basePath + 'inject.js' : 'inject.js',[m
[31m-        injectcss = isWindows ? basePath + 'inject.css' : 'inject.css',[m
[31m-        videohtml = basePath + 'video.html';[m
[31m-[m
[31m-    //Local[m
[32m+[m[32m    var localhtml = basePath + 'local.html';[m
[32m+[m[32m    var localpdf = basePath + 'local.pdf';[m
[32m+[m[32m    var injecthtml = basePath + 'inject.html';[m
[32m+[m[32m    var injectjs = isWindows ? basePath + 'inject.js' : 'inject.js';[m
[32m+[m[32m    var injectcss = isWindows ? basePath + 'inject.css' : 'inject.css';[m
[32m+[m[32m    var videohtml = basePath + 'video.html';[m
[32m+[m
[32m+[m[32m    // Local[m
     createActionButton('target=Default', function () {[m
         doOpen(localhtml);[m
     }, 'openLocal');[m
[36m@@ -508,7 +519,7 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         doOpen(localhtml, 'random_string', 'toolbarposition=top,location=no');[m
     }, 'openLocalRandomToolBarTopNoLocation');[m
 [m
[31m-    //White Listed[m
[32m+[m[32m    // White Listed[m
     createActionButton('* target=Default', function () {[m
         doOpen('http://cordova.apache.org');[m
     }, 'openWhiteListed');[m
[36m@@ -531,7 +542,7 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         doOpen('http://cordova.apache.org', 'random_string', 'location=no');[m
     }, 'openWhiteListedRandomNoLocation');[m
 [m
[31m-    //Non White Listed[m
[32m+[m[32m    // Non White Listed[m
     createActionButton('target=Default', function () {[m
         doOpen('http://www.apple.com');[m
     }, 'openNonWhiteListed');[m
[36m@@ -554,7 +565,7 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         doOpen('http://www.apple.com', 'random_string', 'location=no');[m
     }, 'openNonWhiteListedRandomNoLocation');[m
 [m
[31m-    //Page with redirect[m
[32m+[m[32m    // Page with redirect[m
     createActionButton('http://google.co.uk', function () {[m
         doOpen('http://google.co.uk', 'random_string', '', 1);[m
     }, 'openRedirect301');[m
[36m@@ -562,7 +573,7 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         doOpen('http://goo.gl/pUFqg', 'random_string', '', 2);[m
     }, 'openRedirect302');[m
 [m
[31m-    //PDF URL[m
[32m+[m[32m    // PDF URL[m
     createActionButton('Remote URL', function () {[m
         doOpen('http://www.stluciadance.com/prospectus_file/sample.pdf');[m
     }, 'openPDF');[m
[36m@@ -570,7 +581,7 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         doOpen(localpdf, '_blank');[m
     }, 'openPDFBlank');[m
 [m
[31m-    //Invalid URL[m
[32m+[m[32m    // Invalid URL[m
     createActionButton('Invalid Scheme', function () {[m
         doOpen('x-ttp://www.invalid.com/', '_blank');[m
     }, 'openInvalidScheme');[m
[36m@@ -581,7 +592,7 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         doOpen('nonexistent.html', '_blank');[m
     }, 'openInvalidMissing');[m
 [m
[31m-    //CSS / JS injection[m
[32m+[m[32m    // CSS / JS injection[m
     createActionButton('Original Document', function () {[m
         doOpen(injecthtml, '_blank');[m
     }, 'openOriginalDocument');[m
[36m@@ -610,7 +621,7 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         openWithScript(injecthtml, null, true);[m
     }, 'openScriptLiteralInjectionCallback');[m
 [m
[31m-    //Open hidden[m
[32m+[m[32m    // Open hidden[m
     createActionButton('Create Hidden', function () {[m
         openHidden('https://www.google.co.uk', true);[m
     }, 'openHidden');[m
[36m@@ -630,7 +641,7 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         }, 2000);[m
     }, 'openVisibleAndHide');[m
 [m
[31m-    //Clearing cache[m
[32m+[m[32m    // Clearing cache[m
     createActionButton('Clear Browser Cache', function () {[m
         doOpen('https://www.google.co.uk', '_blank', 'clearcache=yes');[m
     }, 'openClearCache');[m
[36m@@ -638,7 +649,7 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         doOpen('https://www.google.co.uk', '_blank', 'clearsessioncache=yes');[m
     }, 'openClearSessionCache');[m
 [m
[31m-    //Video tag[m
[32m+[m[32m    // Video tag[m
     createActionButton('Remote Video', function () {[m
         doOpen(videohtml, '_blank');[m
     }, 'openRemoteVideo');[m
[36m@@ -649,7 +660,7 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
         doOpen(videohtml, '_blank', 'mediaPlaybackRequiresUserAction=yes');[m
     }, 'openRemoteNeedUserYesVideo');[m
 [m
[31m-    //Local With Anchor Tag[m
[32m+[m[32m    // Local With Anchor Tag[m
     createActionButton('Anchor1', function () {[m
         doOpen(localhtml + '#bogusanchor', '_blank');[m
     }, 'openAnchor1');[m
[36m@@ -667,17 +678,17 @@[m [mexports.defineManualTests = function (contentEl, createActionButton) {[m
     createActionButton('hardwareback=no', function () {[m
         doOpen('http://cordova.apache.org', '_blank', 'hardwareback=no');[m
     }, 'openHardwareBackNo');[m
[31m-    createActionButton('no hardwareback -> hardwareback=no -> no hardwareback', function() {[m
[32m+[m[32m    createActionButton('no hardwareback -> hardwareback=no -> no hardwareback', function () {[m
         var ref = cordova.InAppBrowser.open('https://google.com', '_blank', 'location=yes');[m
[31m-        ref.addEventListener('loadstop', function() {[m
[32m+[m[32m        ref.addEventListener('loadstop', function () {[m
             ref.close();[m
         });[m
[31m-        ref.addEventListener('exit', function() {[m
[32m+[m[32m        ref.addEventListener('exit', function () {[m
             var ref2 = cordova.InAppBrowser.open('https://google.com', '_blank', 'location=yes,hardwareback=no');[m
[31m-            ref2.addEventListener('loadstop', function() {[m
[32m+[m[32m            ref2.addEventListener('loadstop', function () {[m
                 ref2.close();[m
             });[m
[31m-            ref2.addEventListener('exit', function() {[m
[32m+[m[32m            ref2.addEventListener('exit', function () {[m
                 cordova.InAppBrowser.open('https://google.com', '_blank', 'location=yes');[m
             });[m
         });[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/www/inappbrowser.js b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/www/inappbrowser.js[m
[1mindex 983dbba..3619f17 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/www/inappbrowser.js[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/www/inappbrowser.js[m
[36m@@ -19,7 +19,7 @@[m
  *[m
 */[m
 [m
[31m-(function() {[m
[32m+[m[32m(function () {[m
     // special patch to correctly work on Ripple emulator (CB-9760)[m
     if (window.parent && !!window.parent.ripple) { // https://gist.github.com/triceam/4658021[m
         module.exports = window.open.bind(window); // fallback to default window.open behaviour[m
[36m@@ -31,13 +31,14 @@[m
     var modulemapper = require('cordova/modulemapper');[m
     var urlutil = require('cordova/urlutil');[m
 [m
[31m-    function InAppBrowser() {[m
[31m-       this.channels = {[m
[32m+[m[32m    function InAppBrowser () {[m
[32m+[m[32m        this.channels = {[m
             'loadstart': channel.create('loadstart'),[m
[31m-            'loadstop' : channel.create('loadstop'),[m
[31m-            'loaderror' : channel.create('loaderror'),[m
[31m-            'exit' : channel.create('exit')[m
[31m-       };[m
[32m+[m[32m            'loadstop': channel.create('loadstop'),[m
[32m+[m[32m            'loaderror': channel.create('loaderror'),[m
[32m+[m[32m            'exit': channel.create('exit'),[m
[32m+[m[32m            'customscheme': channel.create('customscheme')[m
[32m+[m[32m        };[m
     }[m
 [m
     InAppBrowser.prototype = {[m
[36m@@ -47,47 +48,47 @@[m
             }[m
         },[m
         close: function (eventname) {[m
[31m-            exec(null, null, "InAppBrowser", "close", []);[m
[32m+[m[32m            exec(null, null, 'InAppBrowser', 'close', []);[m
         },[m
         show: function (eventname) {[m
[31m-            exec(null, null, "InAppBrowser", "show", []);[m
[32m+[m[32m            exec(null, null, 'InAppBrowser', 'show', []);[m
         },[m
         hide: function (eventname) {[m
[31m-            exec(null, null, "InAppBrowser", "hide", []);[m
[32m+[m[32m            exec(null, null, 'InAppBrowser', 'hide', []);[m
         },[m
[31m-        addEventListener: function (eventname,f) {[m
[32m+[m[32m        addEventListener: function (eventname, f) {[m
             if (eventname in this.channels) {[m
                 this.channels[eventname].subscribe(f);[m
             }[m
         },[m
[31m-        removeEventListener: function(eventname, f) {[m
[32m+[m[32m        removeEventListener: function (eventname, f) {[m
             if (eventname in this.channels) {[m
                 this.channels[eventname].unsubscribe(f);[m
             }[m
         },[m
 [m
[31m-        executeScript: function(injectDetails, cb) {[m
[32m+[m[32m        executeScript: function (injectDetails, cb) {[m
             if (injectDetails.code) {[m
[31m-                exec(cb, null, "InAppBrowser", "injectScriptCode", [injectDetails.code, !!cb]);[m
[32m+[m[32m                exec(cb, null, 'InAppBrowser', 'injectScriptCode', [injectDetails.code, !!cb]);[m
             } else if (injectDetails.file) {[m
[31m-                exec(cb, null, "InAppBrowser", "injectScriptFile", [injectDetails.file, !!cb]);[m
[32m+[m[32m                exec(cb, null, 'InAppBrowser', 'injectScriptFile', [injectDetails.file, !!cb]);[m
             } else {[m
                 throw new Error('executeScript requires exactly one of code or file to be specified');[m
             }[m
         },[m
 [m
[31m-        insertCSS: function(injectDetails, cb) {[m
[32m+[m[32m        insertCSS: function (injectDetails, cb) {[m
             if (injectDetails.code) {[m
[31m-                exec(cb, null, "InAppBrowser", "injectStyleCode", [injectDetails.code, !!cb]);[m
[32m+[m[32m                exec(cb, null, 'InAppBrowser', 'injectStyleCode', [injectDetails.code, !!cb]);[m
             } else if (injectDetails.file) {[m
[31m-                exec(cb, null, "InAppBrowser", "injectStyleFile", [injectDetails.file, !!cb]);[m
[32m+[m[32m                exec(cb, null, 'InAppBrowser', 'injectStyleFile', [injectDetails.file, !!cb]);[m
             } else {[m
                 throw new Error('insertCSS requires exactly one of code or file to be specified');[m
             }[m
         }[m
     };[m
 [m
[31m-    module.exports = function(strUrl, strWindowName, strWindowFeatures, callbacks) {[m
[32m+[m[32m    module.exports = function (strUrl, strWindowName, strWindowFeatures, callbacks) {[m
         // Don't catch calls that write to existing frames (e.g. named iframes).[m
         if (window.frames && window.frames[strWindowName]) {[m
             var origOpenFunc = modulemapper.getOriginalSymbol(window, 'open');[m
[36m@@ -102,13 +103,13 @@[m
             iab.addEventListener(callbackName, callbacks[callbackName]);[m
         }[m
 [m
[31m-        var cb = function(eventname) {[m
[31m-           iab._eventHandler(eventname);[m
[32m+[m[32m        var cb = function (eventname) {[m
[32m+[m[32m            iab._eventHandler(eventname);[m
         };[m
 [m
[31m-        strWindowFeatures = strWindowFeatures || "";[m
[32m+[m[32m        strWindowFeatures = strWindowFeatures || '';[m
 [m
[31m-        exec(cb, cb, "InAppBrowser", "open", [strUrl, strWindowName, strWindowFeatures]);[m
[32m+[m[32m        exec(cb, cb, 'InAppBrowser', 'open', [strUrl, strWindowName, strWindowFeatures]);[m
         return iab;[m
     };[m
 })();[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/www/windows8/InAppBrowserProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/www/windows8/InAppBrowserProxy.js[m
[1mdeleted file mode 100644[m
[1mindex d780fcd..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-inappbrowser/www/windows8/InAppBrowserProxy.js[m
[1m+++ /dev/null[m
[36m@@ -1,130 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m- */[m
[31m-[m
[31m-/*jslint sloppy:true */[m
[31m-/*global Windows:true, require, document, setTimeout, window, module */[m
[31m-[m
[31m-var browserWrap;[m
[31m-[m
[31m-var IAB = {[m
[31m-[m
[31m-    close: function (win, lose) {[m
[31m-        if (browserWrap) {[m
[31m-            browserWrap.parentNode.removeChild(browserWrap);[m
[31m-            browserWrap = null;[m
[31m-        }[m
[31m-    },[m
[31m-    show: function (win, lose) {[m
[31m-        /* empty block, ran out of bacon?[m
[31m-         if (browserWrap) {[m
[31m-[m
[31m-         }*/[m
[31m-    },[m
[31m-    hide: function (win, lose) {[m
[31m-        /* empty block, ran out of bacon?[m
[31m-        if (browserWrap) {[m
[31m-[m
[31m-        }*/[m
[31m-    },[m
[31m-    open: function (win, lose, args) {[m
[31m-        var strUrl = args[0],[m
[31m-            target = args[1],[m
[31m-            url,[m
[31m-            elem;[m
[31m-[m
[31m-        if (target === "_system") {[m
[31m-            url = new Windows.Foundation.Uri(strUrl);[m
[31m-            Windows.System.Launcher.launchUriAsync(url);[m
[31m-        } else if (target === "_blank") {[m
[31m-            if (!browserWrap) {[m
[31m-                browserWrap = document.createElement("div");[m
[31m-                browserWrap.style.position = "absolute";[m
[31m-                browserWrap.style.width = (window.innerWidth - 80) + "px";[m
[31m-                browserWrap.style.height = (window.innerHeight - 80) + "px";[m
[31m-                browserWrap.style.borderWidth = "40px";[m
[31m-                browserWrap.style.borderStyle = "solid";[m
[31m-                browserWrap.style.borderColor = "rgba(0,0,0,0.25)";[m
[31m-                browserWrap.style.zIndex = "9999999";[m
[31m-[m
[31m-                browserWrap.onclick = function () {[m
[31m-                    setTimeout(function () {[m
[31m-                        IAB.close();[m
[31m-                    }, 0);[m
[31m-                };[m
[31m-[m
[31m-                document.body.appendChild(browserWrap);[m
[31m-            }[m
[31m-            var localFile = (strUrl.indexOf('ms-appdata:///') > -1);[m
[31m-            if (localFile) {[m
[31m-                elem = document.createElement("x-ms-webview");[m
[31m-                elem.style.width = (window.innerWidth - 80) + "px";[m
[31m-                elem.style.height = (window.innerHeight - 80) + "px";[m
[31m-                elem.style.borderWidth = "0px";[m
[31m-                elem.name = "targetFrame";[m
[31m-                elem.src = strUrl;[m
[31m-[m
[31m-                window.addEventListener("resize", function () {[m
[31m-                    if (browserWrap && elem) {[m
[31m-                        elem.style.width = (window.innerWidth - 80) + "px";[m
[31m-                        elem.style.height = (window.innerHeight - 80) + "px";[m
[31m-                    }[m
[31m-                });[m
[31m-[m
[31m-            } else {[m
[31m-                elem = document.createElement("iframe");[m
[31m-                elem.style.width = (window.innerWidth - 80) + "px";[m
[31m-                elem.style.height = (window.innerHeight - 80) + "px";[m
[31m-                elem.style.borderWidth = "0px";[m
[31m-                elem.name = "targetFrame";[m
[31m-                elem.src = strUrl;[m
[31m-[m
[31m-[m
[31m-                window.addEventListener("resize", function () {[m
[31m-                    if (browserWrap && elem) {[m
[31m-                        elem.style.width = (window.innerWidth - 80) + "px";[m
[31m-                        elem.style.height = (window.innerHeight - 80) + "px";[m
[31m-                    }[m
[31m-                });[m
[31m-            }[m
[31m-[m
[31m-            browserWrap.appendChild(elem);[m
[31m-        } else {[m
[31m-            window.location = strUrl;[m
[31m-        }[m
[31m-[m
[31m-        //var object = new WinJS.UI.HtmlControl(elem, { uri: strUrl });[m
[31m-[m
[31m-    },[m
[31m-[m
[31m-    injectScriptCode: function (code, bCB) {[m
[31m-[m
[31m-        // "(function(d) { var c = d.createElement('script'); c.src = %@; d.body.appendChild(c); })(document)"[m
[31m-    },[m
[31m-[m
[31m-    injectScriptFile: function (file, bCB) {[m
[31m-[m
[31m-    }[m
[31m-};[m
[31m-[m
[31m-module.exports = IAB;[m
[31m-[m
[31m-[m
[31m-require("cordova/exec/proxy").add("InAppBrowser", module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/LICENSE b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/LICENSE[m
[1mindex d6f545b..623c70a 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/LICENSE[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/LICENSE[m
[36m@@ -1,202 +1,23 @@[m
[31m-[m
[31m-                                 Apache License[m
[31m-                           Version 2.0, January 2004[m
[31m-                        http://www.apache.org/licenses/[m
[31m-[m
[31m-   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION[m
[31m-[m
[31m-   1. Definitions.[m
[31m-[m
[31m-      "License" shall mean the terms and conditions for use, reproduction,[m
[31m-      and distribution as defined by Sections 1 through 9 of this document.[m
[31m-[m
[31m-      "Licensor" shall mean the copyright owner or entity authorized by[m
[31m-      the copyright owner that is granting the License.[m
[31m-[m
[31m-      "Legal Entity" shall mean the union of the acting entity and all[m
[31m-      other entities that control, are controlled by, or are under common[m
[31m-      control with that entity. For the purposes of this definition,[m
[31m-      "control" means (i) the power, direct or indirect, to cause the[m
[31m-      direction or management of such entity, whether by contract or[m
[31m-      otherwise, or (ii) ownership of fifty percent (50%) or more of the[m
[31m-      outstanding shares, or (iii) beneficial ownership of such entity.[m
[31m-[m
[31m-      "You" (or "Your") shall mean an individual or Legal Entity[m
[31m-      exercising permissions granted by this License.[m
[31m-[m
[31m-      "Source" form shall mean the preferred form for making modifications,[m
[31m-      including but not limited to software source code, documentation[m
[31m-      source, and configuration files.[m
[31m-[m
[31m-      "Object" form shall mean any form resulting from mechanical[m
[31m-      transformation or translation of a Source form, including but[m
[31m-      not limited to compiled object code, generated documentation,[m
[31m-      and conversions to other media types.[m
[31m-[m
[31m-      "Work" shall mean the work of authorship, whether in Source or[m
[31m-      Object form, made available under the License, as indicated by a[m
[31m-      copyright notice that is included in or attached to the work[m
[31m-      (an example is provided in the Appendix below).[m
[31m-[m
[31m-      "Derivative Works" shall mean any work, whether in Source or Object[m
[31m-      form, that is based on (or derived from) the Work and for which the[m
[31m-      editorial revisions, annotations, elaborations, or other modifications[m
[31m-      represent, as a whole, an original work of authorship. For the purposes[m
[31m-      of this License, Derivative Works shall not include works that remain[m
[31m-      separable from, or merely link (or bind by name) to the interfaces of,[m
[31m-      the Work and Derivative Works thereof.[m
[31m-[m
[31m-      "Contribution" shall mean any work of authorship, including[m
[31m-      the original version of the Work and any modifications or additions[m
[31m-      to that Work or Derivative Works thereof, that is intentionally[m
[31m-      submitted to Licensor for inclusion in the Work by the copyright owner[m
[31m-      or by an individual or Legal Entity authorized to submit on behalf of[m
[31m-      the copyright owner. For the purposes of this definition, "submitted"[m
[31m-      means any form of electronic, verbal, or written communication sent[m
[31m-      to the Licensor or its representatives, including but not limited to[m
[31m-      communication on electronic mailing lists, source code control systems,[m
[31m-      and issue tracking systems that are managed by, or on behalf of, the[m
[31m-      Licensor for the purpose of discussing and improving the Work, but[m
[31m-      excluding communication that is conspicuously marked or otherwise[m
[31m-      designated in writing by the copyright owner as "Not a Contribution."[m
[31m-[m
[31m-      "Contributor" shall mean Licensor and any individual or Legal Entity[m
[31m-      on behalf of whom a Contribution has been received by Licensor and[m
[31m-      subsequently incorporated within the Work.[m
[31m-[m
[31m-   2. Grant of Copyright License. Subject to the terms and conditions of[m
[31m-      this License, each Contributor hereby grants to You a perpetual,[m
[31m-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable[m
[31m-      copyright license to reproduce, prepare Derivative Works of,[m
[31m-      publicly display, publicly perform, sublicense, and distribute the[m
[31m-      Work and such Derivative Works in Source or Object form.[m
[31m-[m
[31m-   3. Grant of Patent License. Subject to the terms and conditions of[m
[31m-      this License, each Contributor hereby grants to You a perpetual,[m
[31m-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable[m
[31m-      (except as stated in this section) patent license to make, have made,[m
[31m-      use, offer to sell, sell, import, and otherwise transfer the Work,[m
[31m-      where such license applies only to those patent claims licensable[m
[31m-      by such Contributor that are necessarily infringed by their[m
[31m-      Contribution(s) alone or by combination of their Contribution(s)[m
[31m-      with the Work to which such Contribution(s) was submitted. If You[m
[31m-      institute patent litigation against any entity (including a[m
[31m-      cross-claim or counterclaim in a lawsuit) alleging that the Work[m
[31m-      or a Contribution incorporated within the Work constitutes direct[m
[31m-      or contributory patent infringement, then any patent licenses[m
[31m-      granted to You under this License for that Work shall terminate[m
[31m-      as of the date such litigation is filed.[m
[31m-[m
[31m-   4. Redistribution. You may reproduce and distribute copies of the[m
[31m-      Work or Derivative Works thereof in any medium, with or without[m
[31m-      modifications, and in Source or Object form, provided that You[m
[31m-      meet the following conditions:[m
[31m-[m
[31m-      (a) You must give any other recipients of the Work or[m
[31m-          Derivative Works a copy of this License; and[m
[31m-[m
[31m-      (b) You must cause any modified files to carry prominent notices[m
[31m-          stating that You changed the files; and[m
[31m-[m
[31m-      (c) You must retain, in the Source form of any Derivative Works[m
[31m-          that You distribute, all copyright, patent, trademark, and[m
[31m-          attribution notices from the Source form of the Work,[m
[31m-          excluding those notices that do not pertain to any part of[m
[31m-          the Derivative Works; and[m
[31m-[m
[31m-      (d) If the Work includes a "NOTICE" text file as part of its[m
[31m-          distribution, then any Derivative Works that You distribute must[m
[31m-          include a readable copy of the attribution notices contained[m
[31m-          within such NOTICE file, excluding those notices that do not[m
[31m-          pertain to any part of the Derivative Works, in at least one[m
[31m-          of the following places: within a NOTICE text file distributed[m
[31m-          as part of the Derivative Works; within the Source form or[m
[31m-          documentation, if provided along with the Derivative Works; or,[m
[31m-          within a display generated by the Derivative Works, if and[m
[31m-          wherever such third-party notices normally appear. The contents[m
[31m-          of the NOTICE file are for informational purposes only and[m
[31m-          do not modify the License. You may add Your own attribution[m
[31m-          notices within Derivative Works that You distribute, alongside[m
[31m-          or as an addendum to the NOTICE text from the Work, provided[m
[31m-          that such additional attribution notices cannot be construed[m
[31m-          as modifying the License.[m
[31m-[m
[31m-      You may add Your own copyright statement to Your modifications and[m
[31m-      may provide additional or different license terms and conditions[m
[31m-      for use, reproduction, or distribution of Your modifications, or[m
[31m-      for any such Derivative Works as a whole, provided Your use,[m
[31m-      reproduction, and distribution of the Work otherwise complies with[m
[31m-      the conditions stated in this License.[m
[31m-[m
[31m-   5. Submission of Contributions. Unless You explicitly state otherwise,[m
[31m-      any Contribution intentionally submitted for inclusion in the Work[m
[31m-      by You to the Licensor shall be under the terms and conditions of[m
[31m-      this License, without any additional terms or conditions.[m
[31m-      Notwithstanding the above, nothing herein shall supersede or modify[m
[31m-      the terms of any separate license agreement you may have executed[m
[31m-      with Licensor regarding such Contributions.[m
[31m-[m
[31m-   6. Trademarks. This License does not grant permission to use the trade[m
[31m-      names, trademarks, service marks, or product names of the Licensor,[m
[31m-      except as required for reasonable and customary use in describing the[m
[31m-      origin of the Work and reproducing the content of the NOTICE file.[m
[31m-[m
[31m-   7. Disclaimer of Warranty. Unless required by applicable law or[m
[31m-      agreed to in writing, Licensor provides the Work (and each[m
[31m-      Contributor provides its Contributions) on an "AS IS" BASIS,[m
[31m-      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or[m
[31m-      implied, including, without limitation, any warranties or conditions[m
[31m-      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A[m
[31m-      PARTICULAR PURPOSE. You are solely responsible for determining the[m
[31m-      appropriateness of using or redistributing the Work and assume any[m
[31m-      risks associated with Your exercise of permissions under this License.[m
[31m-[m
[31m-   8. Limitation of Liability. In no event and under no legal theory,[m
[31m-      whether in tort (including negligence), contract, or otherwise,[m
[31m-      unless required by applicable law (such as deliberate and grossly[m
[31m-      negligent acts) or agreed to in writing, shall any Contributor be[m
[31m-      liable to You for damages, including any direct, indirect, special,[m
[31m-      incidental, or consequential damages of any character arising as a[m
[31m-      result of this License or out of the use or inability to use the[m
[31m-      Work (including but not limited to damages for loss of goodwill,[m
[31m-      work stoppage, computer failure or malfunction, or any and all[m
[31m-      other commercial damages or losses), even if such Contributor[m
[31m-      has been advised of the possibility of such damages.[m
[31m-[m
[31m-   9. Accepting Warranty or Additional Liability. While redistributing[m
[31m-      the Work or Derivative Works thereof, You may choose to offer,[m
[31m-      and charge a fee for, acceptance of support, warranty, indemnity,[m
[31m-      or other liability obligations and/or rights consistent with this[m
[31m-      License. However, in accepting such obligations, You may act only[m
[31m-      on Your own behalf and on Your sole responsibility, not on behalf[m
[31m-      of any other Contributor, and only if You agree to indemnify,[m
[31m-      defend, and hold each Contributor harmless for any liability[m
[31m-      incurred by, or claims asserted against, such Contributor by reason[m
[31m-      of your accepting any such warranty or additional liability.[m
[31m-[m
[31m-   END OF TERMS AND CONDITIONS[m
[31m-[m
[31m-   APPENDIX: How to apply the Apache License to your work.[m
[31m-[m
[31m-      To apply the Apache License to your work, attach the following[m
[31m-      boilerplate notice, with the fields enclosed by brackets "[]"[m
[31m-      replaced with your own identifying information. (Don't include[m
[31m-      the brackets!)  The text should be enclosed in the appropriate[m
[31m-      comment syntax for the file format. We also recommend that a[m
[31m-      file or class name and description of purpose be included on the[m
[31m-      same "printed page" as the copyright notice for easier[m
[31m-      identification within third-party archives.[m
[31m-[m
[31m-   Copyright 2014 Drifty Co.[m
[31m-[m
[31m-   Licensed under the Apache License, Version 2.0 (the "License");[m
[31m-   you may not use this file except in compliance with the License.[m
[31m-   You may obtain a copy of the License at[m
[31m-[m
[31m-       http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-   Unless required by applicable law or agreed to in writing, software[m
[31m-   distributed under the License is distributed on an "AS IS" BASIS,[m
[31m-   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m-   See the License for the specific language governing permissions and[m
[31m-   limitations under the License.[m
[32m+[m[32mCopyright 2015-present Drifty Co.[m
[32m+[m[32mhttp://drifty.com/[m
[32m+[m
[32m+[m[32mMIT License[m
[32m+[m
[32m+[m[32mPermission is hereby granted, free of charge, to any person obtaining[m
[32m+[m[32ma copy of this software and associated documentation files (the[m
[32m+[m[32m"Software"), to deal in the Software without restriction, including[m
[32m+[m[32mwithout limitation the rights to use, copy, modify, merge, publish,[m
[32m+[m[32mdistribute, sublicense, and/or sell copies of the Software, and to[m
[32m+[m[32mpermit persons to whom the Software is furnished to do so, subject to[m
[32m+[m[32mthe following conditions:[m
[32m+[m
[32m+[m[32mThe above copyright notice and this permission notice shall be[m
[32m+[m[32mincluded in all copies or substantial portions of the Software.[m
[32m+[m
[32m+[m[32mTHE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,[m
[32m+[m[32mEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF[m
[32m+[m[32mMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND[m
[32m+[m[32mNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE[m
[32m+[m[32mLIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION[m
[32m+[m[32mOF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION[m
[32m+[m[32mWITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/README.md b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/README.md[m
[1mindex fd6c877..0c33973 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/README.md[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/README.md[m
[36m@@ -1,123 +1,148 @@[m
[31m-Keyboard[m
[31m-======[m
[32m+[m[32m# cordova-plugin-ionic-keyboard[m
 [m
[31m-The `cordova.plugins.Keyboard` object provides functions to make interacting with the keyboard easier, and fires events to indicate that the keyboard will hide/show.[m
[32m+[m[32mThis plugin has been designed to work seamlessly with `cordova-plugin-ionic-webview`, so make sure you have it installed first:[m
 [m
[31m-    cordova plugin add cordova-plugin-ionic-keyboard[m
[32m+[m[32m - https://github.com/ionic-team/cordova-plugin-ionic-webview[m
[32m+[m[32m - https://ionicframework.com/docs/wkwebview/[m
 [m
[31m-Methods[m
[31m--------[m
[32m+[m[32m## Installation[m
 [m
[31m-- cordova.plugins.Keyboard.hideKeyboardAccessoryBar[m
[31m-- cordova.plugins.Keyboard.close[m
[31m-- cordova.plugins.Keyboard.disableScroll[m
[31m-- cordova.plugins.Keyboard.show[m
[32m+[m[32m```[m
[32m+[m[32mcordova plugin add cordova-plugin-ionic-keyboard --save[m
[32m+[m[32m```[m
 [m
[31m-Properties[m
[31m---------[m
[32m+[m[32m## Preferences[m
 [m
[31m-- cordova.plugins.Keyboard.isVisible[m
[32m+[m[32m### KeyboardResize[m
 [m
[31m-Events[m
[31m---------[m
[32m+[m[32m> Boolean (true by default)[m
 [m
[31m-These events are fired on the window.[m
[32m+[m[32m#### Possible values[m
[32m+[m[32m- `true`: Showing/hiding the keyboard will trigger some kind of resizing of the app (see KeyboardResizeMode)[m
[32m+[m[32m- `false`: Web will not be resized when the keyboard shows up.[m
 [m
[31m-- native.keyboardshow[m
[31m-  * A number `keyboardHeight` is given on the event object, which is the pixel height of the keyboard.[m
[31m-- native.keyboardhide[m
[32m+[m[32m```xml[m
[32m+[m[32m<preference name="KeyboardResize" value="true" />[m
[32m+[m[32m```[m
 [m
[31m-Keyboard.hideKeyboardAccessoryBar[m
[31m-=================[m
[32m+[m[32m### KeyboardResizeMode[m
 [m
[31m-Hide the keyboard accessory bar with the next, previous and done buttons.[m
[32m+[m[32m> String ('native' by default)[m
 [m
[31m-    cordova.plugins.Keyboard.hideKeyboardAccessoryBar(true);[m
[31m-    cordova.plugins.Keyboard.hideKeyboardAccessoryBar(false);[m
[32m+[m[32m#### Possible values[m
 [m
[31m-Supported Platforms[m
[31m--------------------[m
[32m+[m[32m- `native`: The whole native webview will be resized when the keyboard shows/hides, it will affect the `vh` relative unit.[m
[32m+[m[32m- `body`: Only the html `<body>` element will be resized. Relative units are not affected, because the viewport does not change.[m
[32m+[m[32m- `ionic`: Only the html `ion-app` element will be resized. Only for ionic apps.[m
 [m
[31m-- iOS[m
[32m+[m[32m```xml[m
[32m+[m[32m<preference name="KeyboardResizeMode" value="native" />[m
[32m+[m[32m```[m
 [m
 [m
[31m-Keyboard.close[m
[31m-=================[m
[32m+[m[32m## Methods[m
 [m
[31m-Close the keyboard if it is open.[m
[32m+[m[32m### Keyboard.hideFormAccessoryBar[m
 [m
[31m-    cordova.plugins.Keyboard.close();[m
[32m+[m[32m> Hide the keyboard toolbar.[m
 [m
[31m-Supported Platforms[m
[31m--------------------[m
[32m+[m[32mSet to true to hide the additional toolbar that is on top of the keyboard. This toolbar features the Prev, Next, and Done buttons.[m
 [m
[31m-- iOS, Android, Blackberry 10, Windows [m
[32m+[m[32m```js[m
[32m+[m[32mKeyboard.hideFormAccessoryBar(value, successCallback);[m
[32m+[m[32m```[m
 [m
[32m+[m[32m##### Quick Example[m
 [m
[31m-Keyboard.disableScroll[m
[31m-=================[m
[32m+[m[32m```js[m
[32m+[m[32mKeyboard.hideFormAccessoryBar(true);[m
[32m+[m[32mKeyboard.hideFormAccessoryBar(false);[m
[32m+[m[32mKeyboard.hideFormAccessoryBar(null, (currentValue) => { console.log(currentValue); });[m
[32m+[m[32m```[m
 [m
[31m-Disable native scrolling, useful if you are using JavaScript to scroll[m
[32m+[m[32m### Keyboard.hide[m
 [m
[31m-    cordova.plugins.Keyboard.disableScroll(true);[m
[31m-    cordova.plugins.Keyboard.disableScroll(false);[m
[32m+[m[32m> Hide the keyboard[m
 [m
[31m-Supported Platforms[m
[31m--------------------[m
[32m+[m[32mCall this method to hide the keyboard[m
 [m
[31m-- iOS, Windows[m
[32m+[m[32m```js[m
[32m+[m[32mKeyboard.hide();[m
[32m+[m[32m```[m
 [m
[31m-Keyboard.show[m
[31m-=================[m
 [m
[31m-Force keyboard to be shown. This typically helps if autofocus on a text element does not pop up the keyboard automatically[m
[32m+[m[32m### Keyboard.show[m
 [m
[31m-    cordova.plugins.Keyboard.show();[m
[32m+[m[32m> Show the keyboard[m
 [m
[31m-Supported Platforms[m
[32m+[m[32mCall this method to show the keyboard.[m
 [m
[31m-- Android, Blackberry 10, Windows [m
[32m+[m[32m```js[m
[32m+[m[32mKeyboard.show();[m
[32m+[m[32m```[m
 [m
[31m-native.keyboardshow[m
[31m-=================[m
[32m+[m[32m## Properties[m
 [m
[31m-This event fires when the keyboard will be shown[m
[32m+[m[32m### Keyboard.isVisible[m
 [m
[31m-    window.addEventListener('native.keyboardshow', keyboardShowHandler);[m
[32m+[m[32m> Determine if the keyboard is visible.[m
 [m
[31m-    function keyboardShowHandler(e){[m
[31m-        alert('Keyboard height is: ' + e.keyboardHeight);[m
[31m-    }[m
[32m+[m[32mRead this property to determine if the keyboard is visible.[m
 [m
[31m-Properties[m
[31m------------[m
[32m+[m[32m```js[m
[32m+[m[32mif (Keyboard.isVisible) {[m
[32m+[m[32m    // do something[m
[32m+[m[32m}[m
[32m+[m[32m```[m
 [m
[31m-keyboardHeight: the height of the keyboard in pixels[m
[32m+[m[32m## Events[m
 [m
[32m+[m[32m### keyboardDidHide[m
 [m
[31m-Supported Platforms[m
[31m--------------------[m
[32m+[m[32m> This event is fired when the keyboard is fully closed.[m
 [m
[31m-- iOS, Android, Blackberry 10, Windows[m
[32m+[m[32mAttach handler to this event to be able to receive notification when keyboard is closed.[m
 [m
[32m+[m[32m```js[m
[32m+[m[32mwindow.addEventListener('keyboardDidHide', () => {[m
[32m+[m[32m    // Describe your logic which will be run each time keyboard is closed.[m
[32m+[m[32m});[m
[32m+[m[32m```[m
 [m
[31m-native.keyboardhide[m
[31m-=================[m
[32m+[m[32m### keyboardDidShow[m
 [m
[31m-This event fires when the keyboard will hide[m
[32m+[m[32m> This event is fired when the keyboard is fully open.[m
 [m
[31m-    window.addEventListener('native.keyboardhide', keyboardHideHandler);[m
[32m+[m[32mAttach handler to this event to be able to receive notification when keyboard is opened.[m
 [m
[31m-    function keyboardHideHandler(e){[m
[31m-        alert('Goodnight, sweet prince');[m
[31m-    }[m
[32m+[m[32m```js[m
[32m+[m[32mwindow.addEventListener('keyboardDidShow', (event) => {[m
[32m+[m[32m    // Describe your logic which will be run each time when keyboard is about to be shown.[m
[32m+[m[32m    console.log(event.keyboardHeight);[m
[32m+[m[32m});[m
[32m+[m[32m```[m
 [m
[31m-Properties[m
[31m------------[m
[32m+[m[32m### keyboardWillShow[m
 [m
[31m-None[m
[32m+[m[32m> This event fires before keyboard will be shown.[m
 [m
[31m-Supported Platforms[m
[31m--------------------[m
[32m+[m[32mAttach handler to this event to be able to receive notification when keyboard is about to be shown on the screen.[m
 [m
[31m-- iOS, Android, Blackberry 10, Windows[m
[32m+[m[32m```js[m
[32m+[m[32mwindow.addEventListener('keyboardWillShow', (event) => {[m
[32m+[m[32m    // Describe your logic which will be run each time when keyboard is about to be shown.[m
[32m+[m[32m    console.log(event.keyboardHeight);[m
[32m+[m[32m});[m
[32m+[m[32m```[m
[32m+[m
[32m+[m[32m### keyboardWillHide[m
[32m+[m
[32m+[m[32m> This event is fired when the keyboard is fully closed.[m
[32m+[m
[32m+[m[32mAttach handler to this event to be able to receive notification when keyboard is about to be closed.[m
[32m+[m
[32m+[m[32m```js[m
[32m+[m[32mwindow.addEventListener('keyboardWillHide', () => {[m
[32m+[m[32m    // Describe your logic which will be run each time when keyboard is about to be closed.[m
[32m+[m[32m});[m
[32m+[m[32m```[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/package.json b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/package.json[m
[1mindex bef28b6..972d15c 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/package.json[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/package.json[m
[36m@@ -1,29 +1,104 @@[m
 {[m
[31m-  "name": "cordova-plugin-ionic-keyboard",[m
[31m-  "version": "1.0.5",[m
[31m-  "cordova": {[m
[31m-    "id": "cordova-plugin-ionic-keyboard",[m
[31m-    "platforms": [[m
[31m-      "android",[m
[31m-      "ios",[m
[31m-      "blackberry10",[m
[31m-      "wp8",[m
[31m-      "windows"[m
[32m+[m[32m  "_args": [[m
[32m+[m[32m    [[m
[32m+[m[32m      {[m
[32m+[m[32m        "raw": "cordova-plugin-ionic-keyboard",[m
[32m+[m[32m        "scope": null,[m
[32m+[m[32m        "escapedName": "cordova-plugin-ionic-keyboard",[m
[32m+[m[32m        "name": "cordova-plugin-ionic-keyboard",[m
[32m+[m[32m        "rawSpec": "",[m
[32m+[m[32m        "spec": "latest",[m
[32m+[m[32m        "type": "tag"[m
[32m+[m[32m      },[m
[32m+[m[32m      "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test"[m
     ][m
[32m+[m[32m  ],[m
[32m+[m[32m  "_from": "cordova-plugin-ionic-keyboard@latest",[m
[32m+[m[32m  "_hasShrinkwrap": false,[m
[32m+[m[32m  "_id": "cordova-plugin-ionic-keyboard@2.1.3",[m
[32m+[m[32m  "_inCache": true,[m
[32m+[m[32m  "_location": "/cordova-plugin-ionic-keyboard",[m
[32m+[m[32m  "_nodeVersion": "8.11.4",[m
[32m+[m[32m  "_npmOperationalInternal": {[m
[32m+[m[32m    "host": "s3://npm-registry-packages",[m
[32m+[m[32m    "tmp": "tmp/cordova-plugin-ionic-keyboard_2.1.3_1537887089194_0.29263991431241676"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmUser": {[m
[32m+[m[32m    "name": "maxlynch",[m
[32m+[m[32m    "email": "max@ionic.io"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmVersion": "6.4.1",[m
[32m+[m[32m  "_phantomChildren": {},[m
[32m+[m[32m  "_requested": {[m
[32m+[m[32m    "raw": "cordova-plugin-ionic-keyboard",[m
[32m+[m[32m    "scope": null,[m
[32m+[m[32m    "escapedName": "cordova-plugin-ionic-keyboard",[m
[32m+[m[32m    "name": "cordova-plugin-ionic-keyboard",[m
[32m+[m[32m    "rawSpec": "",[m
[32m+[m[32m    "spec": "latest",[m
[32m+[m[32m    "type": "tag"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_requiredBy": [[m
[32m+[m[32m    "#USER",[m
[32m+[m[32m    "/"[m
[32m+[m[32m  ],[m
[32m+[m[32m  "_resolved": "https://registry.npmjs.org/cordova-plugin-ionic-keyboard/-/cordova-plugin-ionic-keyboard-2.1.3.tgz",[m
[32m+[m[32m  "_shasum": "6b050d5b7cb4393d5758b55f45a46372f25178fe",[m
[32m+[m[32m  "_shrinkwrap": null,[m
[32m+[m[32m  "_spec": "cordova-plugin-ionic-keyboard",[m
[32m+[m[32m  "_where": "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test",[m
[32m+[m[32m  "author": {[m
[32m+[m[32m    "name": "Apache Software Foundation"[m
[32m+[m[32m  },[m
[32m+[m[32m  "bugs": {[m
[32m+[m[32m    "url": "https://github.com/ionic-team/cordova-plugin-ionic-keyboard/issues"[m
   },[m
[31m-  "description": "Cordova Keyboard Plugin",[m
[31m-  "repository": "https://github.com/lottefriends/cordova-plugin-ionic-keyboard.git",[m
[31m-  "issue": "https://github.com/lotterfriends/cordova-plugin-ionic-keyboard/issues",[m
[32m+[m[32m  "dependencies": {},[m
[32m+[m[32m  "description": "Ionic Keyboard Plugin",[m
[32m+[m[32m  "devDependencies": {[m
[32m+[m[32m    "np": "^2.16.0",[m
[32m+[m[32m    "sync-cordova-xml": "^0.4.0"[m
[32m+[m[32m  },[m
[32m+[m[32m  "directories": {},[m
[32m+[m[32m  "dist": {[m
[32m+[m[32m    "integrity": "sha512-6ucQ6FdlLdBm8kJfFnzozmBTjru/0xekHP/dAhjoCZggkGRlgs8TsUJFkxa/bV+qi7Dlo50JjmpE4UMWAO+aOQ==",[m
[32m+[m[32m    "shasum": "6b050d5b7cb4393d5758b55f45a46372f25178fe",[m
[32m+[m[32m    "tarball": "https://registry.npmjs.org/cordova-plugin-ionic-keyboard/-/cordova-plugin-ionic-keyboard-2.1.3.tgz",[m
[32m+[m[32m    "fileCount": 9,[m
[32m+[m[32m    "unpackedSize": 30160,[m
[32m+[m[32m    "npm-signature": "-----BEGIN PGP SIGNATURE-----\r\nVersion: OpenPGP.js v3.0.4\r\nComment: https://openpgpjs.org\r\n\r\nwsFcBAEBCAAQBQJbqktzCRA9TVsSAnZWagAAn+0P/iYE4lHqV2Ri4SAnseDK\nMyaWH3OAIXG4NAYcB8PG7J1wC7f/DWE/MSzNc+/a7e7RHRSvMmr5CBCqIb3D\nWUYAu5E08TDX0/hY6siveofU1fcIrzlzD5qeo19W6o86w6PLjom1ivNtuY1L\nhlH7Q/PrBoew3o3YFE6w/xwfD6sEwOLZFOOyw6q8bniLkMFbI3DngdaJyVvv\n+pas5RVkvh7s0nfDHS9GgC9IRhpyNXmQXxMxHeEcurW7FQLnHiXG4XVuPWGG\n25c5ezkeustld8G53uZOWwR/xA3hgTJMR4i88zrFfQCVRkM7LdDPwnt0+YWq\nVbZMt66XC0R7CUDPslXbFD4XIoCSzNuThIQAX9bEW0MwHZnY0LiciarNeRgV\nQWbc4uMntxFLnMAX+rzyUxOzXjxcOJ9VF5P1lUzP7XXCnhfTaz3+YfqHCieF\nIhxNwAkwZWFHnPHmwwggsc1cK8wr7Mq0Jjk4lSTcxIAICgje95VOhe36M1jE\ns99yb5JRCdSEwh4KenxwDJtc8ATO6fRn2jPUJ6AVFdoObl+uxOUDKqaK1NgM\nNS843q374R1/71HD8d4EuX3No+x90gbLlKHD6I1U0rIXl4xdxmweK+17bKrC\nyNKHOMyjNQMl3tq3eS3s2+NBW96gjSrJ29ttszet0p0/tpYuYcCR7obewx93\nFiHX\r\n=/znJ\r\n-----END PGP SIGNATURE-----\r\n"[m
[32m+[m[32m  },[m
[32m+[m[32m  "gitHead": "0691ad09f5b03861d73ca7c228e4efd2d691d5a3",[m
[32m+[m[32m  "homepage": "https://github.com/ionic-team/cordova-plugin-ionic-keyboard#readme",[m
   "keywords": [[m
     "cordova",[m
     "keyboard",[m
     "ecosystem:cordova",[m
[31m-    "cordova-android",[m
     "cordova-ios",[m
[31m-    "cordova-blackberry10",[m
[31m-    "cordova-wp8",[m
[31m-    "cordova-windows"[m
[32m+[m[32m    "cordova-android"[m
[32m+[m[32m  ],[m
[32m+[m[32m  "license": "Apache 2.0",[m
[32m+[m[32m  "maintainers": [[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "manucorporat",[m
[32m+[m[32m      "email": "manu.mtza@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "mhartington",[m
[32m+[m[32m      "email": "mikehartington@gmail.com"[m
[32m+[m[32m    }[m
   ],[m
[31m-  "author": "Ionic",[m
[31m-  "license": "Apache 2.0"[m
[32m+[m[32m  "name": "cordova-plugin-ionic-keyboard",[m
[32m+[m[32m  "optionalDependencies": {},[m
[32m+[m[32m  "readme": "ERROR: No README data found!",[m
[32m+[m[32m  "repository": {[m
[32m+[m[32m    "type": "git",[m
[32m+[m[32m    "url": "git+https://github.com/ionic-team/cordova-plugin-ionic-keyboard.git"[m
[32m+[m[32m  },[m
[32m+[m[32m  "scripts": {[m
[32m+[m[32m    "deploy": "np --yolo",[m
[32m+[m[32m    "sync_plugin_xml": "sync-cordova-xml package.json plugin.xml --output=plugin.xml",[m
[32m+[m[32m    "version": "npm run sync_plugin_xml && git add plugin.xml"[m
[32m+[m[32m  },[m
[32m+[m[32m  "version": "2.1.3"[m
 }[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/plugin.xml b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/plugin.xml[m
[1mindex 08991d2..5dd2fc1 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/plugin.xml[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/plugin.xml[m
[36m@@ -1,62 +1,47 @@[m
 <?xml version="1.0" encoding="UTF-8"?>[m
 [m
[31m-<plugin xmlns="http://apache.org/cordova/ns/plugins/1.0"[m
[31m-    id="cordova-plugin-ionic-keyboard"[m
[31m-    version="1.0.5">[m
[31m-    <name>Keyboard</name>[m
[31m-    <description>Cordova Keyboard Plugin</description>[m
[32m+[m[32m<plugin xmlns="http://apache.org/cordova/ns/plugins/1.0" xmlns:rim="http://www.blackberry.com/ns/widgets" xmlns:android="http://schemas.android.com/apk/res/android" id="cordova-plugin-ionic-keyboard" version="2.1.3">[m
[32m+[m[32m    <name>cordova-plugin-ionic-keyboard</name>[m
[32m+[m[32m    <description>Ionic Keyboard Plugin</description>[m
     <license>Apache 2.0</license>[m
[31m-    <keywords>cordova, ionic, keyboard</keywords>[m
[31m-    <repo>https://github.com/lotterfriends/cordova-plugin-ionic-keyboard.git</repo>[m
[31m-    <issue>https://github.com/lotterfriends/cordova-plugin-ionic-keyboard/issues</issue>[m
[32m+[m[32m    <keywords>cordova,keyboard,ecosystem:cordova,cordova-ios,cordova-android</keywords>[m
[32m+[m[32m    <repo>https://github.com/ionic-team/cordova-plugin-ionic-keyboard.git</repo>[m
[32m+[m[32m    <issue>https://github.com/ionic-team/cordova-plugin-ionic-keyboard/issues</issue>[m
[32m+[m[32m    <author>Apache Software Foundation</author>[m
 [m
[31m-  <js-module src="www/keyboard.js" name="keyboard">[m
[31m-    <clobbers target="cordova.plugins.Keyboard" />[m
[31m-  </js-module>[m
[31m-[m
[31m-  <!-- android -->[m
[31m-  <platform name="android">[m
[31m-[m
[31m-    <config-file target="res/xml/config.xml" parent="/*">[m
[31m-      <feature name="Keyboard">[m
[31m-        <param name="android-package" value="com.ionic.keyboard.IonicKeyboard" />[m
[31m-        <param name="onload" value="true" />[m
[31m-      </feature>[m
[31m-    </config-file>[m
[31m-[m
[31m-    <source-file src="src/android/IonicKeyboard.java" target-dir="src/com/ionic/keyboard" />[m
[31m-  </platform>[m
[32m+[m[32m    <engines>[m
[32m+[m	[32m    <engine name="cordova" version=">=3.2.0"/>[m
[32m+[m[32m    </engines>[m
 [m
     <!-- ios -->[m
     <platform name="ios">[m
[32m+[m
[32m+[m[32m        <js-module src="www/ios/keyboard.js" name="keyboard">[m
[32m+[m[41m    [m	[32m    <clobbers target="window.Keyboard"/>[m
[32m+[m[32m        </js-module>[m
[32m+[m
         <config-file target="config.xml" parent="/*">[m
             <feature name="Keyboard">[m
[31m-                <param name="ios-package" value="IonicKeyboard" onload="true" />[m
[32m+[m[32m                <param name="ios-package" value="CDVIonicKeyboard" onload="true"/>[m
             </feature>[m
         </config-file>[m
 [m
[31m-        <header-file src="src/ios/IonicKeyboard.h" />[m
[31m-        <source-file src="src/ios/IonicKeyboard.m" />[m
[31m-        <header-file src="src/ios/UIWebViewExtension.h" />[m
[31m-        <source-file src="src/ios/UIWebViewExtension.m" />[m
[32m+[m[32m        <header-file src="src/ios/CDVIonicKeyboard.h"/>[m
[32m+[m[32m        <source-file src="src/ios/CDVIonicKeyboard.m"/>[m
     </platform>[m
 [m
[31m-    <!-- blackberry10 -->[m
[31m-    <platform name="blackberry10">[m
[31m-        <source-file src="src/blackberry10/index.js" target-dir='Keyboard' />[m
[31m-        <lib-file src="src/blackberry10/native/device/libKeyboard.so" arch="device"/>[m
[31m-        <lib-file src="src/blackberry10/native/simulator/libKeyboard.so" arch="simulator"/>[m
[31m-        <config-file target="www/config.xml" parent="/widget">[m
[31m-               <feature name="Keyboard" value="com.ionic.keyboard"/>[m
[31m-            [m
[32m+[m[32m    <!-- android -->[m
[32m+[m[32m    <platform name="android">[m
[32m+[m[32m        <js-module src="www/android/keyboard.js" name="keyboard">[m
[32m+[m[32m            <clobbers target="window.Keyboard"/>[m
[32m+[m[32m        </js-module>[m
[32m+[m[32m        <config-file target="config.xml" parent="/*">[m
[32m+[m[32m            <feature name="Keyboard">[m
[32m+[m[32m                <param name="android-package" value="io.ionic.keyboard.IonicKeyboard" onload="true"/>[m
[32m+[m[32m            </feature>[m
         </config-file>[m
[31m-    </platform>[m
 [m
[31m-    <!-- windows -->[m
[31m-    <platform name="windows">[m
[31m-        <js-module src="src/windows/KeyboardProxy.js" name="KeyboardProxy">[m
[31m-            <runs />[m
[31m-        </js-module>[m
[32m+[m[32m        <source-file src="src/android/IonicKeyboard.java" target-dir="src/io/ionic/keyboard"/>[m
     </platform>[m
 [m
 </plugin>[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/android/IonicKeyboard.java b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/android/IonicKeyboard.java[m
[1mindex 7dcea3d..3abd5f8 100644[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/android/IonicKeyboard.java[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/android/IonicKeyboard.java[m
[36m@@ -1,9 +1,10 @@[m
[31m-package com.ionic.keyboard;[m
[32m+[m[32mpackage io.ionic.keyboard;[m
 [m
 import org.apache.cordova.CallbackContext;[m
 import org.apache.cordova.CordovaInterface;[m
 import org.apache.cordova.CordovaPlugin;[m
 import org.apache.cordova.CordovaWebView;[m
[32m+[m[32mimport org.apache.cordova.PluginResult;[m
 import org.apache.cordova.PluginResult.Status;[m
 import org.json.JSONArray;[m
 import org.json.JSONException;[m
[36m@@ -15,54 +16,21 @@[m [mimport android.view.View;[m
 import android.view.ViewTreeObserver.OnGlobalLayoutListener;[m
 import android.view.inputmethod.InputMethodManager;[m
 [m
[31m-public class IonicKeyboard extends CordovaPlugin{[m
[32m+[m[32m// import additionally required classes for calculating screen height[m
[32m+[m[32mimport android.view.Display;[m
[32m+[m[32mimport android.graphics.Point;[m
[32m+[m[32mimport android.os.Build;[m
[32m+[m
[32m+[m[32mpublic class IonicKeyboard extends CordovaPlugin {[m
[32m+[m[32m    private OnGlobalLayoutListener list;[m
[32m+[m[32m    private View rootView;[m
 [m
     public void initialize(CordovaInterface cordova, CordovaWebView webView) {[m
         super.initialize(cordova, webView);[m
[31m-[m
[31m-        //calculate density-independent pixels (dp)[m
[31m-        //http://developer.android.com/guide/practices/screens_support.html[m
[31m-        DisplayMetrics dm = new DisplayMetrics();[m
[31m-        cordova.getActivity().getWindowManager().getDefaultDisplay().getMetrics(dm);[m
[31m-        final float density = dm.density;[m
[31m-[m
[31m-        final CordovaWebView appView = webView;[m
[31m-[m
[31m-        //http://stackoverflow.com/a/4737265/1091751 detect if keyboard is showing[m
[31m-        final View rootView = cordova.getActivity().getWindow().getDecorView().findViewById(android.R.id.content).getRootView();[m
[31m-        OnGlobalLayoutListener list = new OnGlobalLayoutListener() {[m
[31m-            int previousHeightDiff = 0;[m
[31m-            @Override[m
[31m-            public void onGlobalLayout() {[m
[31m-                Rect r = new Rect();[m
[31m-                //r will be populated with the coordinates of your view that area still visible.[m
[31m-                rootView.getWindowVisibleDisplayFrame(r);[m
[31m-[m
[31m-                int heightDiff = rootView.getRootView().getHeight() - (r.bottom);[m
[31m-                int pixelHeightDiff = (int)(heightDiff / density);[m
[31m-                if (pixelHeightDiff > 100 && pixelHeightDiff != previousHeightDiff) { // if more than 100 pixels, its probably a keyboard...[m
[31m-                    appView.sendJavascript("cordova.plugins.Keyboard.isVisible = true");[m
[31m-                    appView.sendJavascript("cordova.fireWindowEvent('native.keyboardshow', { 'keyboardHeight':" + Integer.toString(pixelHeightDiff)+"});");[m
[31m-[m
[31m-                    //deprecated[m
[31m-                    appView.sendJavascript("cordova.fireWindowEvent('native.showkeyboard', { 'keyboardHeight':" + Integer.toString(pixelHeightDiff)+"});");[m
[31m-                }[m
[31m-                else if ( pixelHeightDiff != previousHeightDiff && ( previousHeightDiff - pixelHeightDiff ) > 100 ){[m
[31m-                    appView.sendJavascript("cordova.plugins.Keyboard.isVisible = false");[m
[31m-                    appView.sendJavascript("cordova.fireWindowEvent('native.keyboardhide')");[m
[31m-[m
[31m-                    //deprecated[m
[31m-                    appView.sendJavascript("cordova.fireWindowEvent('native.hidekeyboard')");[m
[31m-                }[m
[31m-                previousHeightDiff = pixelHeightDiff;[m
[31m-             }[m
[31m-        };[m
[31m-[m
[31m-        rootView.getViewTreeObserver().addOnGlobalLayoutListener(list);[m
     }[m
 [m
     public boolean execute(String action, JSONArray args, final CallbackContext callbackContext) throws JSONException {[m
[31m-        if ("close".equals(action)) {[m
[32m+[m[32m        if ("hide".equals(action)) {[m
             cordova.getThreadPool().execute(new Runnable() {[m
                 public void run() {[m
                     //http://stackoverflow.com/a/7696791/1091751[m
[36m@@ -88,9 +56,79 @@[m [mpublic class IonicKeyboard extends CordovaPlugin{[m
             });[m
             return true;[m
         }[m
[32m+[m[32m        if ("init".equals(action)) {[m
[32m+[m[32m            cordova.getThreadPool().execute(new Runnable() {[m
[32m+[m[32m                public void run() {[m
[32m+[m[41m                [m	[32m//calculate density-independent pixels (dp)[m
[32m+[m[32m                    //http://developer.android.com/guide/practices/screens_support.html[m
[32m+[m[32m                    DisplayMetrics dm = new DisplayMetrics();[m
[32m+[m[32m                    cordova.getActivity().getWindowManager().getDefaultDisplay().getMetrics(dm);[m
[32m+[m[32m                    final float density = dm.density;[m
[32m+[m
[32m+[m[32m                    //http://stackoverflow.com/a/4737265/1091751 detect if keyboard is showing[m
[32m+[m[32m                    rootView = cordova.getActivity().getWindow().getDecorView().findViewById(android.R.id.content).getRootView();[m
[32m+[m[32m                    list = new OnGlobalLayoutListener() {[m
[32m+[m[32m                        int previousHeightDiff = 0;[m
[32m+[m[32m                        @Override[m
[32m+[m[32m                        public void onGlobalLayout() {[m
[32m+[m[32m                            Rect r = new Rect();[m
[32m+[m[32m                            //r will be populated with the coordinates of your view that area still visible.[m
[32m+[m[32m                            rootView.getWindowVisibleDisplayFrame(r);[m
[32m+[m
[32m+[m[32m                            PluginResult result;[m
[32m+[m
[32m+[m[32m                            // cache properties for later use[m
[32m+[m[32m                            int rootViewHeight = rootView.getRootView().getHeight();[m
[32m+[m[32m                            int resultBottom = r.bottom;[m
[32m+[m
[32m+[m[32m                            // calculate screen height differently for android versions >= 21: Lollipop 5.x, Marshmallow 6.x[m
[32m+[m[32m                            //http://stackoverflow.com/a/29257533/3642890 beware of nexus 5[m
[32m+[m[32m                            int screenHeight;[m
[32m+[m
[32m+[m[32m                            if (Build.VERSION.SDK_INT >= 21) {[m
[32m+[m[32m                                Display display = cordova.getActivity().getWindowManager().getDefaultDisplay();[m
[32m+[m[32m                                Point size = new Point();[m
[32m+[m[32m                                display.getSize(size);[m
[32m+[m[32m                                screenHeight = size.y;[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                screenHeight = rootViewHeight;[m
[32m+[m[32m                            }[m
[32m+[m
[32m+[m[32m                            int heightDiff = screenHeight - resultBottom;[m
[32m+[m
[32m+[m[32m                            int pixelHeightDiff = (int)(heightDiff / density);[m
[32m+[m[32m                            if (pixelHeightDiff > 100 && pixelHeightDiff != previousHeightDiff) { // if more than 100 pixels, its probably a keyboard...[m
[32m+[m[32m                                String msg = "S" + Integer.toString(pixelHeightDiff);[m
[32m+[m[32m                                result = new PluginResult(PluginResult.Status.OK, msg);[m
[32m+[m[32m                                result.setKeepCallback(true);[m
[32m+[m[32m                                callbackContext.sendPluginResult(result);[m
[32m+[m[32m                            }[m
[32m+[m[32m                            else if ( pixelHeightDiff != previousHeightDiff && ( previousHeightDiff - pixelHeightDiff ) > 100 ){[m
[32m+[m[41m                            [m	[32mString msg = "H";[m
[32m+[m[32m                                result = new PluginResult(PluginResult.Status.OK, msg);[m
[32m+[m[32m                                result.setKeepCallback(true);[m
[32m+[m[32m                                callbackContext.sendPluginResult(result);[m
[32m+[m[32m                            }[m
[32m+[m[32m                            previousHeightDiff = pixelHeightDiff;[m
[32m+[m[32m                         }[m
[32m+[m[32m                    };[m
[32m+[m
[32m+[m[32m                    rootView.getViewTreeObserver().addOnGlobalLayoutListener(list);[m
[32m+[m
[32m+[m
[32m+[m[32m                    PluginResult dataResult = new PluginResult(PluginResult.Status.OK);[m
[32m+[m[32m                    dataResult.setKeepCallback(true);[m
[32m+[m[32m                    callbackContext.sendPluginResult(dataResult);[m
[32m+[m[32m                }[m
[32m+[m[32m            });[m
[32m+[m[32m            return true;[m
[32m+[m[32m        }[m
         return false;  // Returning false results in a "MethodNotFound" error.[m
     }[m
 [m
[32m+[m[32m    @Override[m
[32m+[m[32m    public void onDestroy() {[m
[32m+[m[32m        rootView.getViewTreeObserver().removeOnGlobalLayoutListener(list);[m
[32m+[m[32m    }[m
 [m
 }[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/index.js b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/index.js[m
[1mdeleted file mode 100644[m
[1mindex a91b94a..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/index.js[m
[1m+++ /dev/null[m
[36m@@ -1,125 +0,0 @@[m
[31m-var keyboard,[m
[31m-	resultObjs = {},[m
[31m-	threadCallback = null,[m
[31m-	_utils = require("../../lib/utils");[m
[31m-	_event = require("../../lib/event");[m
[31m-	_webview = require("../../lib/webview");[m
[31m-[m
[31m-module.exports = {[m
[31m-[m
[31m-	// Code can be declared and used outside the module.exports object,[m
[31m-	// but any functions to be called by client.js need to be declared[m
[31m-	// here in this object.[m
[31m-[m
[31m-	// These methods call into JNEXT.Keyboard which handles the[m
[31m-	// communication through the JNEXT plugin to keyboard_js.cpp[m
[31m-	startService: function (success, fail, args, env) {[m
[31m-	var result = new PluginResult(args, env);[m
[31m-[m
[31m-	result.ok(keyboard.getInstance().startService(), false);[m
[31m-	},[m
[31m-	show: function (success, fail, args, env) {[m
[31m-		var result = new PluginResult(args, env);[m
[31m-[m
[31m-		result.ok(keyboard.getInstance().showKeyboard(), false);[m
[31m-	},[m
[31m-	close: function (success, fail, args, env) {[m
[31m-	var result = new PluginResult(args, env);[m
[31m-[m
[31m-	result.ok(keyboard.getInstance().closeKeyboard(), false);[m
[31m-	}[m
[31m-};[m
[31m-[m
[31m-keyboardShow = function(a){[m
[31m-	_webview.executeJavascript("cordova.plugins.Keyboard.isVisible = true");[m
[31m-	_webview.executeJavascript("cordova.fireDocumentEvent('native.keyboardshow',"+a+")");[m
[31m-};[m
[31m-keyboardHide = function(){[m
[31m-	_webview.executeJavascript("cordova.plugins.Keyboard.isVisible = false");[m
[31m-	_webview.executeJavascript("cordova.fireDocumentEvent('native.keyboardhide','')");[m
[31m-};[m
[31m-onStart = function() {[m
[31m-	_webview.executeJavascript("cordova.exec("+null+", "+null+", 'Keyboard', 'startService', '')");[m
[31m-};[m
[31m-[m
[31m-setTimeout(onStart,2000);[m
[31m-[m
[31m-///////////////////////////////////////////////////////////////////[m
[31m-// JavaScript wrapper for JNEXT plugin for connection[m
[31m-///////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-JNEXT.Keyboard = function () {[m
[31m-	var self = this,[m
[31m-		hasInstance = false;[m
[31m-[m
[31m-	self.getId = function () {[m
[31m-		return self.m_id;[m
[31m-	};[m
[31m-[m
[31m-	self.init = function () {[m
[31m-		if (!JNEXT.require("libKeyboard")) {[m
[31m-			return false;[m
[31m-		}[m
[31m-[m
[31m-		self.m_id = JNEXT.createObject("libKeyboard.Keyboard_JS");[m
[31m-[m
[31m-		if (self.m_id === "") {[m
[31m-			return false;[m
[31m-		}[m
[31m-[m
[31m-		JNEXT.registerEvents(self);[m
[31m-	};[m
[31m-[m
[31m-	// ************************[m
[31m-	// Enter your methods here[m
[31m-	// ************************[m
[31m-[m
[31m-	// calls into InvokeMethod(string command) in keyboard_js.cpp[m
[31m-	self.startService = function () {[m
[31m-		return JNEXT.invoke(self.m_id, "startService");[m
[31m-	};[m
[31m-	self.showKeyboard = function () {[m
[31m-		return JNEXT.invoke(self.m_id, "showKeyboard");[m
[31m-	};[m
[31m-	self.closeKeyboard = function () {[m
[31m-		return JNEXT.invoke(self.m_id, "closeKeyboard");[m
[31m-	};[m
[31m-[m
[31m-	self.onEvent = function (strData) { // Fired by the Event framework (used by asynchronous callbacks)[m
[31m-		var arData = strData.split(" "),[m
[31m-		strEventDesc = arData[0],[m
[31m-		jsonData;[m
[31m-[m
[31m-		if (strEventDesc === "native.keyboardshow") {[m
[31m-			jsonData = arData.slice(1, arData.length).join(" ");[m
[31m-			keyboardShow(jsonData);[m
[31m-		}[m
[31m-		else if (strEventDesc === "native.keyboardhide") {[m
[31m-			keyboardHide();[m
[31m-		}[m
[31m-	};[m
[31m-[m
[31m-	// Thread methods[m
[31m-	self.keyboardStartThread = function (callbackId) {[m
[31m-		return JNEXT.invoke(self.m_id, "keyboardStartThread " + callbackId);[m
[31m-	};[m
[31m-	self.keyboardStopThread = function () {[m
[31m-		return JNEXT.invoke(self.m_id, "keyboardStopThread");[m
[31m-	};[m
[31m-[m
[31m-	// ************************[m
[31m-	// End of methods to edit[m
[31m-	// ************************[m
[31m-	self.m_id = "";[m
[31m-[m
[31m-	self.getInstance = function () {[m
[31m-		if (!hasInstance) {[m
[31m-			hasInstance = true;[m
[31m-			self.init();[m
[31m-		}[m
[31m-		return self;[m
[31m-	};[m
[31m-[m
[31m-};[m
[31m-[m
[31m-keyboard = new JNEXT.Keyboard();[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/.cproject b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/.cproject[m
[1mdeleted file mode 100644[m
[1mindex 7b118ee..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/.cproject[m
[1m+++ /dev/null[m
[36m@@ -1,222 +0,0 @@[m
[31m-<?xml version="1.0" encoding="UTF-8" standalone="no"?>[m
[31m-<?fileVersion 4.0.0?><cproject storage_type_id="org.eclipse.cdt.core.XmlProjectDescriptionStorage">[m
[31m-	<storageModule moduleId="org.eclipse.cdt.core.settings">[m
[31m-		<cconfiguration id="com.qnx.qcc.configuration.sharedLib.release.608922875.1009704567">[m
[31m-			<storageModule buildSystemId="org.eclipse.cdt.managedbuilder.core.configurationDataProvider" id="com.qnx.qcc.configuration.sharedLib.release.608922875.1009704567" moduleId="org.eclipse.cdt.core.settings" name="device">[m
[31m-				<externalSettings>[m
[31m-					<externalSetting>[m
[31m-						<entry flags="VALUE_WORKSPACE_PATH" kind="includePath" name="/Cordova-Keyboard"/>[m
[31m-						<entry flags="VALUE_WORKSPACE_PATH" kind="libraryPath" name="/Cordova-Keyboard/device"/>[m
[31m-						<entry flags="RESOLVED" kind="libraryFile" name="Cordova-Keyboard" srcPrefixMapping="" srcRootPath=""/>[m
[31m-					</externalSetting>[m
[31m-				</externalSettings>[m
[31m-				<extensions>[m
[31m-					<extension id="com.qnx.tools.ide.qde.core.QDELinkerErrorParser" point="org.eclipse.cdt.core.ErrorParser"/>[m
[31m-					<extension id="org.eclipse.cdt.core.GCCErrorParser" point="org.eclipse.cdt.core.ErrorParser"/>[m
[31m-					<extension id="org.eclipse.cdt.core.GLDErrorParser" point="org.eclipse.cdt.core.ErrorParser"/>[m
[31m-					<extension id="com.qnx.tools.ide.qde.core.QDEBynaryParser" point="org.eclipse.cdt.core.BinaryParser"/>[m
[31m-				</extensions>[m
[31m-			</storageModule>[m
[31m-			<storageModule moduleId="cdtBuildSystem" version="4.0.0">[m
[31m-				<configuration artifactExtension="so" artifactName="${ProjName}" buildArtefactType="org.eclipse.cdt.build.core.buildArtefactType.sharedLib" buildProperties="org.eclipse.cdt.build.core.buildType=org.eclipse.cdt.build.core.buildType.release,org.eclipse.cdt.build.core.buildArtefactType=org.eclipse.cdt.build.core.buildArtefactType.sharedLib" description="" id="com.qnx.qcc.configuration.sharedLib.release.608922875.1009704567" name="device" parent="com.qnx.qcc.configuration.sharedLib.release">[m
[31m-					<folderInfo id="com.qnx.qcc.configuration.sharedLib.release.608922875.1009704567." name="/" resourcePath="">[m
[31m-						<toolChain id="com.qnx.qcc.toolChain.2215983" name="QNX QCC" superClass="com.qnx.qcc.toolChain">[m
[31m-							<option id="com.qnx.qcc.option.cpu.315540759" name="Target CPU:" superClass="com.qnx.qcc.option.cpu" value="com.qnx.qcc.option.gen.cpu.armle-v7" valueType="enumerated"/>[m
[31m-							<targetPlatform archList="all" binaryParser="com.qnx.tools.ide.qde.core.QDEBynaryParser" id="com.qnx.qcc.targetPlatform.1359109141" osList="all" superClass="com.qnx.qcc.targetPlatform"/>[m
[31m-							<builder buildPath="${workspace_loc:/Keyboard/Device-Release}" id="com.qnx.nto.938326560" keepEnvironmentInBuildfile="false" name="CDT Internal Builder" superClass="com.qnx.nto"/>[m
[31m-							<tool id="com.qnx.qcc.tool.compiler.242697771" name="QCC Compiler" superClass="com.qnx.qcc.tool.compiler">[m
[31m-								<option id="com.qnx.qcc.option.compiler.shared.553244928" name="Shared (-shared)" superClass="com.qnx.qcc.option.compiler.shared" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.compiler.optlevel.2070537906" name="Optimization Level" superClass="com.qnx.qcc.option.compiler.optlevel" value="com.qnx.qcc.option.compiler.optlevel.2" valueType="enumerated"/>[m
[31m-								<option id="com.qnx.qcc.option.compiler.includePath.1483355415" name="Include Directories (-I)" superClass="com.qnx.qcc.option.compiler.includePath" valueType="includePath">[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/usr/include/bb"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/usr/include/qt4/QtCore"/>[m
[31m-									<listOptionValue builtIn="false" value="${workspace_loc:/${ProjName}/public}"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/usr/include/qt4"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/usr/include/freetype2"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/../target-override/usr/include"/>[m
[31m-								</option>[m
[31m-								<option id="com.qnx.qcc.option.compiler.security.9625963" name="Enhanced Security (-fstack-protector-strong)" superClass="com.qnx.qcc.option.compiler.security" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.compiler.defines.872099896" name="Defines (-D)" superClass="com.qnx.qcc.option.compiler.defines" valueType="definedSymbols">[m
[31m-									<listOptionValue builtIn="false" value="_FORTIFY_SOURCE=2"/>[m
[31m-								</option>[m
[31m-								<option id="com.qnx.qcc.option.compiler.qccoptions.1015003128" name="QCC Options" superClass="com.qnx.qcc.option.compiler.qccoptions" valueType="stringList">[m
[31m-									<listOptionValue builtIn="false" value="-frecord-gcc-switches"/>[m
[31m-								</option>[m
[31m-								<inputType id="com.qnx.qcc.inputType.compiler.1443568066" superClass="com.qnx.qcc.inputType.compiler"/>[m
[31m-							</tool>[m
[31m-							<tool id="com.qnx.qcc.tool.assembler.1996828008" name="QCC Assembler" superClass="com.qnx.qcc.tool.assembler">[m
[31m-								<inputType id="com.qnx.qcc.inputType.assembler.116798417" superClass="com.qnx.qcc.inputType.assembler"/>[m
[31m-							</tool>[m
[31m-							<tool id="com.qnx.qcc.tool.linker.871546588" name="QCC Linker" superClass="com.qnx.qcc.tool.linker">[m
[31m-								<option id="com.qnx.qcc.option.linker.shared.915102752" name="Shared (-shared)" superClass="com.qnx.qcc.option.linker.shared" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.linker.libraryPaths.1049529253" name="Library Paths (-L)" superClass="com.qnx.qcc.option.linker.libraryPaths" valueType="libPaths">[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/../target-override/${CPUVARDIR}/lib"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/${CPUVARDIR}/usr/lib"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/${CPUVARDIR}/usr/lib/qt4/lib"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/../target-override/${CPUVARDIR}/usr/lib"/>[m
[31m-								</option>[m
[31m-								<option id="com.qnx.qcc.option.linker.security.1157664997" name="Enhanced Security (-Wl,-z,relro -Wl,-z,now)" superClass="com.qnx.qcc.option.linker.security" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.linker.libraries.1316432206" name="Libraries (-l)" superClass="com.qnx.qcc.option.linker.libraries" valueType="libs">[m
[31m-									<listOptionValue builtIn="false" value="slog2"/>[m
[31m-									<listOptionValue builtIn="false" value="QtCore"/>[m
[31m-									<listOptionValue builtIn="false" value="bb"/>[m
[31m-									<listOptionValue builtIn="false" value="bps"/>[m
[31m-								</option>[m
[31m-								<inputType id="com.qnx.qcc.inputType.linker.1028572887" superClass="com.qnx.qcc.inputType.linker">[m
[31m-									<additionalInput kind="additionalinputdependency" paths="$(USER_OBJS)"/>[m
[31m-									<additionalInput kind="additionalinput" paths="$(LIBS)"/>[m
[31m-								</inputType>[m
[31m-							</tool>[m
[31m-							<tool id="com.qnx.qcc.tool.archiver.1781914947" name="QCC Archiver" superClass="com.qnx.qcc.tool.archiver"/>[m
[31m-						</toolChain>[m
[31m-					</folderInfo>[m
[31m-					<sourceEntries>[m
[31m-						<entry flags="VALUE_WORKSPACE_PATH|RESOLVED" kind="sourcePath" name="src"/>[m
[31m-						<entry flags="VALUE_WORKSPACE_PATH|RESOLVED" kind="sourcePath" name="public"/>[m
[31m-					</sourceEntries>[m
[31m-				</configuration>[m
[31m-			</storageModule>[m
[31m-			<storageModule moduleId="org.eclipse.cdt.core.externalSettings"/>[m
[31m-		</cconfiguration>[m
[31m-		<cconfiguration id="com.qnx.qcc.configuration.sharedLib.debug.193597202.362186091">[m
[31m-			<storageModule buildSystemId="org.eclipse.cdt.managedbuilder.core.configurationDataProvider" id="com.qnx.qcc.configuration.sharedLib.debug.193597202.362186091" moduleId="org.eclipse.cdt.core.settings" name="simulator">[m
[31m-				<externalSettings>[m
[31m-					<externalSetting>[m
[31m-						<entry flags="VALUE_WORKSPACE_PATH" kind="includePath" name="/Cordova-Keyboard"/>[m
[31m-						<entry flags="VALUE_WORKSPACE_PATH" kind="libraryPath" name="/Cordova-Keyboard/simulator"/>[m
[31m-						<entry flags="RESOLVED" kind="libraryFile" name="Cordova-Keyboard" srcPrefixMapping="" srcRootPath=""/>[m
[31m-					</externalSetting>[m
[31m-				</externalSettings>[m
[31m-				<extensions>[m
[31m-					<extension id="com.qnx.tools.ide.qde.core.QDELinkerErrorParser" point="org.eclipse.cdt.core.ErrorParser"/>[m
[31m-					<extension id="org.eclipse.cdt.core.GCCErrorParser" point="org.eclipse.cdt.core.ErrorParser"/>[m
[31m-					<extension id="org.eclipse.cdt.core.GLDErrorParser" point="org.eclipse.cdt.core.ErrorParser"/>[m
[31m-					<extension id="com.qnx.tools.ide.qde.core.QDEBynaryParser" point="org.eclipse.cdt.core.BinaryParser"/>[m
[31m-				</extensions>[m
[31m-			</storageModule>[m
[31m-			<storageModule moduleId="cdtBuildSystem" version="4.0.0">[m
[31m-				<configuration artifactExtension="so" artifactName="${ProjName}" buildArtefactType="org.eclipse.cdt.build.core.buildArtefactType.sharedLib" buildProperties="org.eclipse.cdt.build.core.buildType=org.eclipse.cdt.build.core.buildType.debug,org.eclipse.cdt.build.core.buildArtefactType=org.eclipse.cdt.build.core.buildArtefactType.sharedLib" description="" id="com.qnx.qcc.configuration.sharedLib.debug.193597202.362186091" name="simulator" parent="com.qnx.qcc.configuration.sharedLib.debug">[m
[31m-					<folderInfo id="com.qnx.qcc.configuration.sharedLib.debug.193597202.362186091." name="/" resourcePath="">[m
[31m-						<toolChain id="com.qnx.qcc.toolChain.688026907" name="QNX QCC" superClass="com.qnx.qcc.toolChain">[m
[31m-							<targetPlatform archList="all" binaryParser="com.qnx.tools.ide.qde.core.QDEBynaryParser" id="com.qnx.qcc.targetPlatform.469207190" osList="all" superClass="com.qnx.qcc.targetPlatform"/>[m
[31m-							<builder buildPath="${workspace_loc:/Keyboard/Simulator-Debug}" id="com.qnx.nto.2029800497" keepEnvironmentInBuildfile="false" name="CDT Internal Builder" superClass="com.qnx.nto"/>[m
[31m-							<tool id="com.qnx.qcc.tool.compiler.1028279123" name="QCC Compiler" superClass="com.qnx.qcc.tool.compiler">[m
[31m-								<option id="com.qnx.qcc.option.compiler.shared.235893159" name="Shared (-shared)" superClass="com.qnx.qcc.option.compiler.shared" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.compiler.optlevel.1164238904" name="Optimization Level" superClass="com.qnx.qcc.option.compiler.optlevel" value="com.qnx.qcc.option.compiler.optlevel.0" valueType="enumerated"/>[m
[31m-								<option id="com.qnx.qcc.option.compile.debug.3716470" name="Debug (-g)" superClass="com.qnx.qcc.option.compile.debug" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.compiler.includePath.306305432" name="Include Directories (-I)" superClass="com.qnx.qcc.option.compiler.includePath" valueType="includePath">[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/usr/include/bb"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/usr/include/qt4/QtCore"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/usr/include/qt4"/>[m
[31m-									<listOptionValue builtIn="false" value="${workspace_loc:/${ProjName}/public}"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/usr/include/freetype2"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/../target-override/usr/include"/>[m
[31m-								</option>[m
[31m-								<option id="com.qnx.qcc.option.compiler.security.1730007887" name="Enhanced Security (-fstack-protector-strong)" superClass="com.qnx.qcc.option.compiler.security" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.compiler.defines.1526896965" name="Defines (-D)" superClass="com.qnx.qcc.option.compiler.defines" valueType="definedSymbols">[m
[31m-									<listOptionValue builtIn="false" value="_FORTIFY_SOURCE=2"/>[m
[31m-								</option>[m
[31m-								<inputType id="com.qnx.qcc.inputType.compiler.1881183122" superClass="com.qnx.qcc.inputType.compiler"/>[m
[31m-							</tool>[m
[31m-							<tool id="com.qnx.qcc.tool.assembler.312168125" name="QCC Assembler" superClass="com.qnx.qcc.tool.assembler">[m
[31m-								<option id="com.qnx.qcc.option.assembler.debug.416544277" name="Debug (-g)" superClass="com.qnx.qcc.option.assembler.debug" value="true" valueType="boolean"/>[m
[31m-								<inputType id="com.qnx.qcc.inputType.assembler.1722778407" superClass="com.qnx.qcc.inputType.assembler"/>[m
[31m-							</tool>[m
[31m-							<tool id="com.qnx.qcc.tool.linker.2130364088" name="QCC Linker" superClass="com.qnx.qcc.tool.linker">[m
[31m-								<option id="com.qnx.qcc.option.linker.debug.1332880614" name="Debug (-g)" superClass="com.qnx.qcc.option.linker.debug" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.linker.shared.1633267255" name="Shared (-shared)" superClass="com.qnx.qcc.option.linker.shared" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.linker.libraryPaths.565794953" name="Library Paths (-L)" superClass="com.qnx.qcc.option.linker.libraryPaths" valueType="libPaths">[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/../target-override/${CPUVARDIR}/lib"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/${CPUVARDIR}/usr/lib"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/${CPUVARDIR}/usr/lib/qt4/lib"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/../target-override/${CPUVARDIR}/usr/lib"/>[m
[31m-								</option>[m
[31m-								<option id="com.qnx.qcc.option.linker.security.9141791" name="Enhanced Security (-Wl,-z,relro -Wl,-z,now)" superClass="com.qnx.qcc.option.linker.security" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.linker.libraries.220836649" name="Libraries (-l)" superClass="com.qnx.qcc.option.linker.libraries" valueType="libs">[m
[31m-									<listOptionValue builtIn="false" value="slog2"/>[m
[31m-									<listOptionValue builtIn="false" value="QtCore"/>[m
[31m-									<listOptionValue builtIn="false" value="bb"/>[m
[31m-									<listOptionValue builtIn="false" value="bps"/>[m
[31m-								</option>[m
[31m-								<inputType id="com.qnx.qcc.inputType.linker.167117375" superClass="com.qnx.qcc.inputType.linker">[m
[31m-									<additionalInput kind="additionalinputdependency" paths="$(USER_OBJS)"/>[m
[31m-									<additionalInput kind="additionalinput" paths="$(LIBS)"/>[m
[31m-								</inputType>[m
[31m-							</tool>[m
[31m-							<tool id="com.qnx.qcc.tool.archiver.489682882" name="QCC Archiver" superClass="com.qnx.qcc.tool.archiver"/>[m
[31m-						</toolChain>[m
[31m-					</folderInfo>[m
[31m-					<sourceEntries>[m
[31m-						<entry flags="VALUE_WORKSPACE_PATH|RESOLVED" kind="sourcePath" name="src"/>[m
[31m-						<entry flags="VALUE_WORKSPACE_PATH|RESOLVED" kind="sourcePath" name="public"/>[m
[31m-					</sourceEntries>[m
[31m-				</configuration>[m
[31m-			</storageModule>[m
[31m-			<storageModule moduleId="org.eclipse.cdt.core.externalSettings"/>[m
[31m-		</cconfiguration>[m
[31m-	</storageModule>[m
[31m-	<storageModule moduleId="cdtBuildSystem" version="4.0.0">[m
[31m-		<project id="Keyboard.null.138005006" name="Keyboard"/>[m
[31m-	</storageModule>[m
[31m-	<storageModule moduleId="refreshScope" versionNumber="2">[m
[31m-		<configuration configurationName="Simulator-Profile">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/Keyboard"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="simulator">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/Keyboard"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="Simulator-Coverage">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/Keyboard"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="Device-Profile">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/Keyboard"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="Device-Debug">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/Keyboard"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="Simulator-Debug">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/Keyboard"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="device">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/Keyboard"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="Device-Release">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/Keyboard"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="Device-Coverage">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/Keyboard"/>[m
[31m-		</configuration>[m
[31m-	</storageModule>[m
[31m-	<storageModule moduleId="org.eclipse.cdt.internal.ui.text.commentOwnerProjectMappings"/>[m
[31m-	<storageModule moduleId="org.eclipse.cdt.core.LanguageSettingsProviders"/>[m
[31m-	<storageModule moduleId="scannerConfiguration">[m
[31m-		<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.profile.941124085">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.coverage.1806890017">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.release.608922875">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.profile.27502649">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.debug.193597202">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.coverage.537092296">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.debug.193597202.362186091">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.release.608922875.1009704567">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.debug.1877214659">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-	</storageModule>[m
[31m-</cproject>[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/.project b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/.project[m
[1mdeleted file mode 100644[m
[1mindex 8a39f22..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/.project[m
[1m+++ /dev/null[m
[36m@@ -1,76 +0,0 @@[m
[31m-<?xml version="1.0" encoding="UTF-8"?>[m
[31m-<projectDescription>[m
[31m-	<name>Keyboard</name>[m
[31m-	<comment></comment>[m
[31m-	<projects>[m
[31m-	</projects>[m
[31m-	<buildSpec>[m
[31m-		<buildCommand>[m
[31m-			<name>org.eclipse.cdt.managedbuilder.core.genmakebuilder</name>[m
[31m-			<triggers>clean,full,incremental,</triggers>[m
[31m-			<arguments>[m
[31m-				<dictionary>[m
[31m-					<key>?name?</key>[m
[31m-					<value></value>[m
[31m-				</dictionary>[m
[31m-				<dictionary>[m
[31m-					<key>org.eclipse.cdt.make.core.append_environment</key>[m
[31m-					<value>true</value>[m
[31m-				</dictionary>[m
[31m-				<dictionary>[m
[31m-					<key>org.eclipse.cdt.make.core.buildArguments</key>[m
[31m-					<value></value>[m
[31m-				</dictionary>[m
[31m-				<dictionary>[m
[31m-					<key>org.eclipse.cdt.make.core.buildCommand</key>[m
[31m-					<value>make</value>[m
[31m-				</dictionary>[m
[31m-				<dictionary>[m
[31m-					<key>org.eclipse.cdt.make.core.buildLocation</key>[m
[31m-					<value>${workspace_loc:/Keyboard/Device-Release}</value>[m
[31m-				</dictionary>[m
[31m-				<dictionary>[m
[31m-					<key>org.eclipse.cdt.make.core.contents</key>[m
[31m-					<value>org.eclipse.cdt.make.core.activeConfigSettings</value>[m
[31m-				</dictionary>[m
[31m-				<dictionary>[m
[31m-					<key>org.eclipse.cdt.make.core.enableAutoBuild</key>[m
[31m-					<value>false</value>[m
[31m-				</dictionary>[m
[31m-				<dictionary>[m
[31m-					<key>org.eclipse.cdt.make.core.enableCleanBuild</key>[m
[31m-					<value>true</value>[m
[31m-				</dictionary>[m
[31m-				<dictionary>[m
[31m-					<key>org.eclipse.cdt.make.core.enableFullBuild</key>[m
[31m-					<value>true</value>[m
[31m-				</dictionary>[m
[31m-				<dictionary>[m
[31m-					<key>org.eclipse.cdt.make.core.stopOnError</key>[m
[31m-					<value>true</value>[m
[31m-				</dictionary>[m
[31m-				<dictionary>[m
[31m-					<key>org.eclipse.cdt.make.core.useDefaultBuildCmd</key>[m
[31m-					<value>true</value>[m
[31m-				</dictionary>[m
[31m-			</arguments>[m
[31m-		</buildCommand>[m
[31m-		<buildCommand>[m
[31m-			<name>org.eclipse.cdt.managedbuilder.core.ScannerConfigBuilder</name>[m
[31m-			<triggers>full,incremental,</triggers>[m
[31m-			<arguments>[m
[31m-			</arguments>[m
[31m-		</buildCommand>[m
[31m-		<buildCommand>[m
[31m-			<name>com.qnx.tools.bbt.xml.core.bbtXMLValidationBuilder</name>[m
[31m-			<arguments>[m
[31m-			</arguments>[m
[31m-		</buildCommand>[m
[31m-	</buildSpec>[m
[31m-	<natures>[m
[31m-		<nature>org.eclipse.cdt.core.cnature</nature>[m
[31m-		<nature>org.eclipse.cdt.managedbuilder.core.managedBuildNature</nature>[m
[31m-		<nature>org.eclipse.cdt.managedbuilder.core.ScannerConfigNature</nature>[m
[31m-		<nature>com.qnx.tools.ide.bbt.core.bbtnature</nature>[m
[31m-	</natures>[m
[31m-</projectDescription>[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/libKeyboard.so b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/libKeyboard.so[m
[1mdeleted file mode 100755[m
[1mindex 5234589..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/libKeyboard.so and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/json_reader.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/json_reader.o[m
[1mdeleted file mode 100644[m
[1mindex 6f78251..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/json_reader.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/json_value.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/json_value.o[m
[1mdeleted file mode 100644[m
[1mindex 310adeb..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/json_value.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/json_writer.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/json_writer.o[m
[1mdeleted file mode 100644[m
[1mindex b81c56b..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/json_writer.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/plugin.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/plugin.o[m
[1mdeleted file mode 100644[m
[1mindex 90f1590..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/plugin.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/tokenizer.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/tokenizer.o[m
[1mdeleted file mode 100644[m
[1mindex 4062f5f..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/public/tokenizer.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/src/CallKeyboard.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/src/CallKeyboard.o[m
[1mdeleted file mode 100644[m
[1mindex 3bb136b..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/src/CallKeyboard.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/src/Logger.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/src/Logger.o[m
[1mdeleted file mode 100644[m
[1mindex f677dc8..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/src/Logger.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/src/keyboard_js.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/src/keyboard_js.o[m
[1mdeleted file mode 100644[m
[1mindex 6bcd769..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/src/keyboard_js.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/src/keyboard_ndk.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/src/keyboard_ndk.o[m
[1mdeleted file mode 100644[m
[1mindex c5bc3b8..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/device/src/keyboard_ndk.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/autolink.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/autolink.h[m
[1mdeleted file mode 100644[m
[1mindex 37c9258..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/autolink.h[m
[1m+++ /dev/null[m
[36m@@ -1,19 +0,0 @@[m
[31m-#ifndef JSON_AUTOLINK_H_INCLUDED[m
[31m-# define JSON_AUTOLINK_H_INCLUDED[m
[31m-[m
[31m-# include "config.h"[m
[31m-[m
[31m-# ifdef JSON_IN_CPPTL[m
[31m-#  include <cpptl/cpptl_autolink.h>[m
[31m-# endif[m
[31m-[m
[31m-# if !defined(JSON_NO_AUTOLINK)  &&  !defined(JSON_DLL_BUILD)  &&  !defined(JSON_IN_CPPTL)[m
[31m-#  define CPPTL_AUTOLINK_NAME "json"[m
[31m-#  undef CPPTL_AUTOLINK_DLL[m
[31m-#  ifdef JSON_DLL[m
[31m-#   define CPPTL_AUTOLINK_DLL[m
[31m-#  endif[m
[31m-#  include "autolink.h"[m
[31m-# endif[m
[31m-[m
[31m-#endif // JSON_AUTOLINK_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/config.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/config.h[m
[1mdeleted file mode 100644[m
[1mindex 5d334cb..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/config.h[m
[1m+++ /dev/null[m
[36m@@ -1,43 +0,0 @@[m
[31m-#ifndef JSON_CONFIG_H_INCLUDED[m
[31m-# define JSON_CONFIG_H_INCLUDED[m
[31m-[m
[31m-/// If defined, indicates that json library is embedded in CppTL library.[m
[31m-//# define JSON_IN_CPPTL 1[m
[31m-[m
[31m-/// If defined, indicates that json may leverage CppTL library[m
[31m-//#  define JSON_USE_CPPTL 1[m
[31m-/// If defined, indicates that cpptl vector based map should be used instead of std::map[m
[31m-/// as Value container.[m
[31m-//#  define JSON_USE_CPPTL_SMALLMAP 1[m
[31m-/// If defined, indicates that Json specific container should be used[m
[31m-/// (hash table & simple deque container with customizable allocator).[m
[31m-/// THIS FEATURE IS STILL EXPERIMENTAL![m
[31m-//#  define JSON_VALUE_USE_INTERNAL_MAP 1[m
[31m-/// Force usage of standard new/malloc based allocator instead of memory pool based allocator.[m
[31m-/// The memory pools allocator used optimization (initializing Value and ValueInternalLink[m
[31m-/// as if it was a POD) that may cause some validation tool to report errors.[m
[31m-/// Only has effects if JSON_VALUE_USE_INTERNAL_MAP is defined.[m
[31m-//#  define JSON_USE_SIMPLE_INTERNAL_ALLOCATOR 1[m
[31m-[m
[31m-/// If defined, indicates that Json use exception to report invalid type manipulation[m
[31m-/// instead of C assert macro.[m
[31m-# define JSON_USE_EXCEPTION 1[m
[31m-[m
[31m-# ifdef JSON_IN_CPPTL[m
[31m-#  include <cpptl/config.h>[m
[31m-#  ifndef JSON_USE_CPPTL[m
[31m-#   define JSON_USE_CPPTL 1[m
[31m-#  endif[m
[31m-# endif[m
[31m-[m
[31m-# ifdef JSON_IN_CPPTL[m
[31m-#  define JSON_API CPPTL_API[m
[31m-# elif defined(JSON_DLL_BUILD)[m
[31m-#  define JSON_API __declspec(dllexport)[m
[31m-# elif defined(JSON_DLL)[m
[31m-#  define JSON_API __declspec(dllimport)[m
[31m-# else[m
[31m-#  define JSON_API[m
[31m-# endif[m
[31m-[m
[31m-#endif // JSON_CONFIG_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/features.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/features.h[m
[1mdeleted file mode 100644[m
[1mindex 5a9adec..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/features.h[m
[1m+++ /dev/null[m
[36m@@ -1,42 +0,0 @@[m
[31m-#ifndef CPPTL_JSON_FEATURES_H_INCLUDED[m
[31m-# define CPPTL_JSON_FEATURES_H_INCLUDED[m
[31m-[m
[31m-# include "forwards.h"[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-   /** \brief Configuration passed to reader and writer.[m
[31m-    * This configuration object can be used to force the Reader or Writer[m
[31m-    * to behave in a standard conforming way.[m
[31m-    */[m
[31m-   class JSON_API Features[m
[31m-   {[m
[31m-   public:[m
[31m-      /** \brief A configuration that allows all features and assumes all strings are UTF-8.[m
[31m-       * - C & C++ comments are allowed[m
[31m-       * - Root object can be any JSON value[m
[31m-       * - Assumes Value strings are encoded in UTF-8[m
[31m-       */[m
[31m-      static Features all();[m
[31m-[m
[31m-      /** \brief A configuration that is strictly compatible with the JSON specification.[m
[31m-       * - Comments are forbidden.[m
[31m-       * - Root object must be either an array or an object value.[m
[31m-       * - Assumes Value strings are encoded in UTF-8[m
[31m-       */[m
[31m-      static Features strictMode();[m
[31m-[m
[31m-      /** \brief Initialize the configuration like JsonConfig::allFeatures;[m
[31m-       */[m
[31m-      Features();[m
[31m-[m
[31m-      /// \c true if comments are allowed. Default: \c true.[m
[31m-      bool allowComments_;[m
[31m-[m
[31m-      /// \c true if root must be either an array or an object value. Default: \c false.[m
[31m-      bool strictRoot_;[m
[31m-   };[m
[31m-[m
[31m-} // namespace Json[m
[31m-[m
[31m-#endif // CPPTL_JSON_FEATURES_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/forwards.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/forwards.h[m
[1mdeleted file mode 100644[m
[1mindex d0ce830..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/forwards.h[m
[1m+++ /dev/null[m
[36m@@ -1,39 +0,0 @@[m
[31m-#ifndef JSON_FORWARDS_H_INCLUDED[m
[31m-# define JSON_FORWARDS_H_INCLUDED[m
[31m-[m
[31m-# include "config.h"[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-   // writer.h[m
[31m-   class FastWriter;[m
[31m-   class StyledWriter;[m
[31m-[m
[31m-   // reader.h[m
[31m-   class Reader;[m
[31m-[m
[31m-   // features.h[m
[31m-   class Features;[m
[31m-[m
[31m-   // value.h[m
[31m-   typedef int Int;[m
[31m-   typedef unsigned int UInt;[m
[31m-   class StaticString;[m
[31m-   class Path;[m
[31m-   class PathArgument;[m
[31m-   class Value;[m
[31m-   class ValueIteratorBase;[m
[31m-   class ValueIterator;[m
[31m-   class ValueConstIterator;[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   class ValueAllocator;[m
[31m-   class ValueMapAllocator;[m
[31m-   class ValueInternalLink;[m
[31m-   class ValueInternalArray;[m
[31m-   class ValueInternalMap;[m
[31m-#endif // #ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-[m
[31m-} // namespace Json[m
[31m-[m
[31m-[m
[31m-#endif // JSON_FORWARDS_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/json.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/json.h[m
[1mdeleted file mode 100644[m
[1mindex c71ed65..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/json.h[m
[1m+++ /dev/null[m
[36m@@ -1,10 +0,0 @@[m
[31m-#ifndef JSON_JSON_H_INCLUDED[m
[31m-# define JSON_JSON_H_INCLUDED[m
[31m-[m
[31m-# include "autolink.h"[m
[31m-# include "value.h"[m
[31m-# include "reader.h"[m
[31m-# include "writer.h"[m
[31m-# include "features.h"[m
[31m-[m
[31m-#endif // JSON_JSON_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/reader.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/reader.h[m
[1mdeleted file mode 100644[m
[1mindex ee1d6a2..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/reader.h[m
[1m+++ /dev/null[m
[36m@@ -1,196 +0,0 @@[m
[31m-#ifndef CPPTL_JSON_READER_H_INCLUDED[m
[31m-# define CPPTL_JSON_READER_H_INCLUDED[m
[31m-[m
[31m-# include "features.h"[m
[31m-# include "value.h"[m
[31m-# include <deque>[m
[31m-# include <stack>[m
[31m-# include <string>[m
[31m-# include <iostream>[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-   /** \brief Unserialize a <a HREF="http://www.json.org">JSON</a> document into a Value.[m
[31m-    *[m
[31m-    */[m
[31m-   class JSON_API Reader[m
[31m-   {[m
[31m-   public:[m
[31m-      typedef char Char;[m
[31m-      typedef const Char *Location;[m
[31m-[m
[31m-      /** \brief Constructs a Reader allowing all features[m
[31m-       * for parsing.[m
[31m-       */[m
[31m-      Reader();[m
[31m-[m
[31m-      /** \brief Constructs a Reader allowing the specified feature set[m
[31m-       * for parsing.[m
[31m-       */[m
[31m-      Reader( const Features &features );[m
[31m-[m
[31m-      /** \brief Read a Value from a <a HREF="http://www.json.org">JSON</a> document.[m
[31m-       * \param document UTF-8 encoded string containing the document to read.[m
[31m-       * \param root [out] Contains the root value of the document if it was[m
[31m-       *             successfully parsed.[m
[31m-       * \param collectComments \c true to collect comment and allow writing them back during[m
[31m-       *                        serialization, \c false to discard comments.[m
[31m-       *                        This parameter is ignored if Features::allowComments_[m
[31m-       *                        is \c false.[m
[31m-       * \return \c true if the document was successfully parsed, \c false if an error occurred.[m
[31m-       */[m
[31m-      bool parse( const std::string &document, [m
[31m-                  Value &root,[m
[31m-                  bool collectComments = true );[m
[31m-[m
[31m-      /** \brief Read a Value from a <a HREF="http://www.json.org">JSON</a> document.[m
[31m-       * \param document UTF-8 encoded string containing the document to read.[m
[31m-       * \param root [out] Contains the root value of the document if it was[m
[31m-       *             successfully parsed.[m
[31m-       * \param collectComments \c true to collect comment and allow writing them back during[m
[31m-       *                        serialization, \c false to discard comments.[m
[31m-       *                        This parameter is ignored if Features::allowComments_[m
[31m-       *                        is \c false.[m
[31m-       * \return \c true if the document was successfully parsed, \c false if an error occurred.[m
[31m-       */[m
[31m-      bool parse( const char *beginDoc, const char *endDoc, [m
[31m-                  Value &root,[m
[31m-                  bool collectComments = true );[m
[31m-[m
[31m-      /// \brief Parse from input stream.[m
[31m-      /// \see Json::operator>>(std::istream&, Json::Value&).[m
[31m-      bool parse( std::istream &is,[m
[31m-                  Value &root,[m
[31m-                  bool collectComments = true );[m
[31m-[m
[31m-      /** \brief Returns a user friendly string that list errors in the parsed document.[m
[31m-       * \return Formatted error message with the list of errors with their location in [m
[31m-       *         the parsed document. An empty string is returned if no error occurred[m
[31m-       *         during parsing.[m
[31m-       */[m
[31m-      std::string getFormatedErrorMessages() const;[m
[31m-[m
[31m-   private:[m
[31m-      enum TokenType[m
[31m-      {[m
[31m-         tokenEndOfStream = 0,[m
[31m-         tokenObjectBegin,[m
[31m-         tokenObjectEnd,[m
[31m-         tokenArrayBegin,[m
[31m-         tokenArrayEnd,[m
[31m-         tokenString,[m
[31m-         tokenNumber,[m
[31m-         tokenTrue,[m
[31m-         tokenFalse,[m
[31m-         tokenNull,[m
[31m-         tokenArraySeparator,[m
[31m-         tokenMemberSeparator,[m
[31m-         tokenComment,[m
[31m-         tokenError[m
[31m-      };[m
[31m-[m
[31m-      class Token[m
[31m-      {[m
[31m-      public:[m
[31m-         TokenType type_;[m
[31m-         Location start_;[m
[31m-         Location end_;[m
[31m-      };[m
[31m-[m
[31m-      class ErrorInfo[m
[31m-      {[m
[31m-      public:[m
[31m-         Token token_;[m
[31m-         std::string message_;[m
[31m-         Location extra_;[m
[31m-      };[m
[31m-[m
[31m-      typedef std::deque<ErrorInfo> Errors;[m
[31m-[m
[31m-      bool expectToken( TokenType type, Token &token, const char *message );[m
[31m-      bool readToken( Token &token );[m
[31m-      void skipSpaces();[m
[31m-      bool match( Location pattern, [m
[31m-                  int patternLength );[m
[31m-      bool readComment();[m
[31m-      bool readCStyleComment();[m
[31m-      bool readCppStyleComment();[m
[31m-      bool readString();[m
[31m-      void readNumber();[m
[31m-      bool readValue();[m
[31m-      bool readObject( Token &token );[m
[31m-      bool readArray( Token &token );[m
[31m-      bool decodeNumber( Token &token );[m
[31m-      bool decodeString( Token &token );[m
[31m-      bool decodeString( Token &token, std::string &decoded );[m
[31m-      bool decodeDouble( Token &token );[m
[31m-      bool decodeUnicodeCodePoint( Token &token, [m
[31m-                                   Location &current, [m
[31m-                                   Location end, [m
[31m-                                   unsigned int &unicode );[m
[31m-      bool decodeUnicodeEscapeSequence( Token &token, [m
[31m-                                        Location &current, [m
[31m-                                        Location end, [m
[31m-                                        unsigned int &unicode );[m
[31m-      bool addError( const std::string &message, [m
[31m-                     Token &token,[m
[31m-                     Location extra = 0 );[m
[31m-      bool recoverFromError( TokenType skipUntilToken );[m
[31m-      bool addErrorAndRecover( const std::string &message, [m
[31m-                               Token &token,[m
[31m-                               TokenType skipUntilToken );[m
[31m-      void skipUntilSpace();[m
[31m-      Value &currentValue();[m
[31m-      Char getNextChar();[m
[31m-      void getLocationLineAndColumn( Location location,[m
[31m-                                     int &line,[m
[31m-                                     int &column ) const;[m
[31m-      std::string getLocationLineAndColumn( Location location ) const;[m
[31m-      void addComment( Location begin, [m
[31m-                       Location end, [m
[31m-                       CommentPlacement placement );[m
[31m-      void skipCommentTokens( Token &token );[m
[31m-   [m
[31m-      typedef std::stack<Value *> Nodes;[m
[31m-      Nodes nodes_;[m
[31m-      Errors errors_;[m
[31m-      std::string document_;[m
[31m-      Location begin_;[m
[31m-      Location end_;[m
[31m-      Location current_;[m
[31m-      Location lastValueEnd_;[m
[31m-      Value *lastValue_;[m
[31m-      std::string commentsBefore_;[m
[31m-      Features features_;[m
[31m-      bool collectComments_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Read from 'sin' into 'root'.[m
[31m-[m
[31m-    Always keep comments from the input JSON.[m
[31m-[m
[31m-    This can be used to read a file into a particular sub-object.[m
[31m-    For example:[m
[31m-    \code[m
[31m-    Json::Value root;[m
[31m-    cin >> root["dir"]["file"];[m
[31m-    cout << root;[m
[31m-    \endcode[m
[31m-    Result:[m
[31m-    \verbatim[m
[31m-    {[m
[31m-	"dir": {[m
[31m-	    "file": {[m
[31m-		// The input stream JSON would be nested here.[m
[31m-	    }[m
[31m-	}[m
[31m-    }[m
[31m-    \endverbatim[m
[31m-    \throw std::exception on parse error.[m
[31m-    \see Json::operator<<()[m
[31m-   */[m
[31m-   std::istream& operator>>( std::istream&, Value& );[m
[31m-[m
[31m-} // namespace Json[m
[31m-[m
[31m-#endif // CPPTL_JSON_READER_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/value.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/value.h[m
[1mdeleted file mode 100644[m
[1mindex 58bfd88..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/value.h[m
[1m+++ /dev/null[m
[36m@@ -1,1069 +0,0 @@[m
[31m-#ifndef CPPTL_JSON_H_INCLUDED[m
[31m-# define CPPTL_JSON_H_INCLUDED[m
[31m-[m
[31m-# include "forwards.h"[m
[31m-# include <string>[m
[31m-# include <vector>[m
[31m-[m
[31m-# ifndef JSON_USE_CPPTL_SMALLMAP[m
[31m-#  include <map>[m
[31m-# else[m
[31m-#  include <cpptl/smallmap.h>[m
[31m-# endif[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-#  include <cpptl/forwards.h>[m
[31m-# endif[m
[31m-[m
[31m-/** \brief JSON (JavaScript Object Notation).[m
[31m- */[m
[31m-namespace Json {[m
[31m-[m
[31m-   /** \brief Type of the value held by a Value object.[m
[31m-    */[m
[31m-   enum ValueType[m
[31m-   {[m
[31m-      nullValue = 0, ///< 'null' value[m
[31m-      intValue,      ///< signed integer value[m
[31m-      uintValue,     ///< unsigned integer value[m
[31m-      realValue,     ///< double value[m
[31m-      stringValue,   ///< UTF-8 string value[m
[31m-      booleanValue,  ///< bool value[m
[31m-      arrayValue,    ///< array value (ordered list)[m
[31m-      objectValue    ///< object value (collection of name/value pairs).[m
[31m-   };[m
[31m-[m
[31m-   enum CommentPlacement[m
[31m-   {[m
[31m-      commentBefore = 0,        ///< a comment placed on the line before a value[m
[31m-      commentAfterOnSameLine,   ///< a comment just after a value on the same line[m
[31m-      commentAfter,             ///< a comment on the line after a value (only make sense for root value)[m
[31m-      numberOfCommentPlacement[m
[31m-   };[m
[31m-[m
[31m-//# ifdef JSON_USE_CPPTL[m
[31m-//   typedef CppTL::AnyEnumerator<const char *> EnumMemberNames;[m
[31m-//   typedef CppTL::AnyEnumerator<const Value &> EnumValues;[m
[31m-//# endif[m
[31m-[m
[31m-   /** \brief Lightweight wrapper to tag static string.[m
[31m-    *[m
[31m-    * Value constructor and objectValue member assignement takes advantage of the[m
[31m-    * StaticString and avoid the cost of string duplication when storing the[m
[31m-    * string or the member name.[m
[31m-    *[m
[31m-    * Example of usage:[m
[31m-    * \code[m
[31m-    * Json::Value aValue( StaticString("some text") );[m
[31m-    * Json::Value object;[m
[31m-    * static const StaticString code("code");[m
[31m-    * object[code] = 1234;[m
[31m-    * \endcode[m
[31m-    */[m
[31m-   class JSON_API StaticString[m
[31m-   {[m
[31m-   public:[m
[31m-      explicit StaticString( const char *czstring )[m
[31m-         : str_( czstring )[m
[31m-      {[m
[31m-      }[m
[31m-[m
[31m-      operator const char *() const[m
[31m-      {[m
[31m-         return str_;[m
[31m-      }[m
[31m-[m
[31m-      const char *c_str() const[m
[31m-      {[m
[31m-         return str_;[m
[31m-      }[m
[31m-[m
[31m-   private:[m
[31m-      const char *str_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Represents a <a HREF="http://www.json.org">JSON</a> value.[m
[31m-    *[m
[31m-    * This class is a discriminated union wrapper that can represents a:[m
[31m-    * - signed integer [range: Value::minInt - Value::maxInt][m
[31m-    * - unsigned integer (range: 0 - Value::maxUInt)[m
[31m-    * - double[m
[31m-    * - UTF-8 string[m
[31m-    * - boolean[m
[31m-    * - 'null'[m
[31m-    * - an ordered list of Value[m
[31m-    * - collection of name/value pairs (javascript object)[m
[31m-    *[m
[31m-    * The type of the held value is represented by a #ValueType and [m
[31m-    * can be obtained using type().[m
[31m-    *[m
[31m-    * values of an #objectValue or #arrayValue can be accessed using operator[]() methods. [m
[31m-    * Non const methods will automatically create the a #nullValue element [m
[31m-    * if it does not exist. [m
[31m-    * The sequence of an #arrayValue will be automatically resize and initialized [m
[31m-    * with #nullValue. resize() can be used to enlarge or truncate an #arrayValue.[m
[31m-    *[m
[31m-    * The get() methods can be used to obtanis default value in the case the required element[m
[31m-    * does not exist.[m
[31m-    *[m
[31m-    * It is possible to iterate over the list of a #objectValue values using [m
[31m-    * the getMemberNames() method.[m
[31m-    */[m
[31m-   class JSON_API Value [m
[31m-   {[m
[31m-      friend class ValueIteratorBase;[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      friend class ValueInternalLink;[m
[31m-      friend class ValueInternalMap;[m
[31m-# endif[m
[31m-   public:[m
[31m-      typedef std::vector<std::string> Members;[m
[31m-      typedef ValueIterator iterator;[m
[31m-      typedef ValueConstIterator const_iterator;[m
[31m-      typedef Json::UInt UInt;[m
[31m-      typedef Json::Int Int;[m
[31m-      typedef UInt ArrayIndex;[m
[31m-[m
[31m-      static const Value null;[m
[31m-      static const Int minInt;[m
[31m-      static const Int maxInt;[m
[31m-      static const UInt maxUInt;[m
[31m-[m
[31m-   private:[m
[31m-#ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-# ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      class CZString [m
[31m-      {[m
[31m-      public:[m
[31m-         enum DuplicationPolicy [m
[31m-         {[m
[31m-            noDuplication = 0,[m
[31m-            duplicate,[m
[31m-            duplicateOnCopy[m
[31m-         };[m
[31m-         CZString( int index );[m
[31m-         CZString( const char *cstr, DuplicationPolicy allocate );[m
[31m-         CZString( const CZString &other );[m
[31m-         ~CZString();[m
[31m-         CZString &operator =( const CZString &other );[m
[31m-         bool operator<( const CZString &other ) const;[m
[31m-         bool operator==( const CZString &other ) const;[m
[31m-         int index() const;[m
[31m-         const char *c_str() const;[m
[31m-         bool isStaticString() const;[m
[31m-      private:[m
[31m-         void swap( CZString &other );[m
[31m-         const char *cstr_;[m
[31m-         int index_;[m
[31m-      };[m
[31m-[m
[31m-   public:[m
[31m-#  ifndef JSON_USE_CPPTL_SMALLMAP[m
[31m-      typedef std::map<CZString, Value> ObjectValues;[m
[31m-#  else[m
[31m-      typedef CppTL::SmallMap<CZString, Value> ObjectValues;[m
[31m-#  endif // ifndef JSON_USE_CPPTL_SMALLMAP[m
[31m-# endif // ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-#endif // ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-[m
[31m-   public:[m
[31m-      /** \brief Create a default Value of the given type.[m
[31m-[m
[31m-        This is a very useful constructor.[m
[31m-        To create an empty array, pass arrayValue.[m
[31m-        To create an empty object, pass objectValue.[m
[31m-        Another Value can then be set to this one by assignment.[m
[31m-	This is useful since clear() and resize() will not alter types.[m
[31m-[m
[31m-        Examples:[m
[31m-	\code[m
[31m-	Json::Value null_value; // null[m
[31m-	Json::Value arr_value(Json::arrayValue); // [][m
[31m-	Json::Value obj_value(Json::objectValue); // {}[m
[31m-	\endcode[m
[31m-      */[m
[31m-      Value( ValueType type = nullValue );[m
[31m-      Value( Int value );[m
[31m-      Value( UInt value );[m
[31m-      Value( double value );[m
[31m-      Value( const char *value );[m
[31m-      Value( const char *beginValue, const char *endValue );[m
[31m-      /** \brief Constructs a value from a static string.[m
[31m-[m
[31m-       * Like other value string constructor but do not duplicate the string for[m
[31m-       * internal storage. The given string must remain alive after the call to this[m
[31m-       * constructor.[m
[31m-       * Example of usage:[m
[31m-       * \code[m
[31m-       * Json::Value aValue( StaticString("some text") );[m
[31m-       * \endcode[m
[31m-       */[m
[31m-      Value( const StaticString &value );[m
[31m-      Value( const std::string &value );[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-      Value( const CppTL::ConstString &value );[m
[31m-# endif[m
[31m-      Value( bool value );[m
[31m-      Value( const Value &other );[m
[31m-      ~Value();[m
[31m-[m
[31m-      Value &operator=( const Value &other );[m
[31m-      /// Swap values.[m
[31m-      /// \note Currently, comments are intentionally not swapped, for[m
[31m-      /// both logic and efficiency.[m
[31m-      void swap( Value &other );[m
[31m-[m
[31m-      ValueType type() const;[m
[31m-[m
[31m-      bool operator <( const Value &other ) const;[m
[31m-      bool operator <=( const Value &other ) const;[m
[31m-      bool operator >=( const Value &other ) const;[m
[31m-      bool operator >( const Value &other ) const;[m
[31m-[m
[31m-      bool operator ==( const Value &other ) const;[m
[31m-      bool operator !=( const Value &other ) const;[m
[31m-[m
[31m-      int compare( const Value &other );[m
[31m-[m
[31m-      const char *asCString() const;[m
[31m-      std::string asString() const;[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-      CppTL::ConstString asConstString() const;[m
[31m-# endif[m
[31m-      Int asInt() const;[m
[31m-      UInt asUInt() const;[m
[31m-      double asDouble() const;[m
[31m-      bool asBool() const;[m
[31m-[m
[31m-      bool isNull() const;[m
[31m-      bool isBool() const;[m
[31m-      bool isInt() const;[m
[31m-      bool isUInt() const;[m
[31m-      bool isIntegral() const;[m
[31m-      bool isDouble() const;[m
[31m-      bool isNumeric() const;[m
[31m-      bool isString() const;[m
[31m-      bool isArray() const;[m
[31m-      bool isObject() const;[m
[31m-[m
[31m-      bool isConvertibleTo( ValueType other ) const;[m
[31m-[m
[31m-      /// Number of values in array or object[m
[31m-      UInt size() const;[m
[31m-[m
[31m-      /// \brief Return true if empty array, empty object, or null;[m
[31m-      /// otherwise, false.[m
[31m-      bool empty() const;[m
[31m-[m
[31m-      /// Return isNull()[m
[31m-      bool operator!() const;[m
[31m-[m
[31m-      /// Remove all object members and array elements.[m
[31m-      /// \pre type() is arrayValue, objectValue, or nullValue[m
[31m-      /// \post type() is unchanged[m
[31m-      void clear();[m
[31m-[m
[31m-      /// Resize the array to size elements. [m
[31m-      /// New elements are initialized to null.[m
[31m-      /// May only be called on nullValue or arrayValue.[m
[31m-      /// \pre type() is arrayValue or nullValue[m
[31m-      /// \post type() is arrayValue[m
[31m-      void resize( UInt size );[m
[31m-[m
[31m-      /// Access an array element (zero based index ).[m
[31m-      /// If the array contains less than index element, then null value are inserted[m
[31m-      /// in the array so that its size is index+1.[m
[31m-      /// (You may need to say 'value[0u]' to get your compiler to distinguish[m
[31m-      ///  this from the operator[] which takes a string.)[m
[31m-      Value &operator[]( UInt index );[m
[31m-      /// Access an array element (zero based index )[m
[31m-      /// (You may need to say 'value[0u]' to get your compiler to distinguish[m
[31m-      ///  this from the operator[] which takes a string.)[m
[31m-      const Value &operator[]( UInt index ) const;[m
[31m-      /// If the array contains at least index+1 elements, returns the element value, [m
[31m-      /// otherwise returns defaultValue.[m
[31m-      Value get( UInt index, [m
[31m-                 const Value &defaultValue ) const;[m
[31m-      /// Return true if index < size().[m
[31m-      bool isValidIndex( UInt index ) const;[m
[31m-      /// \brief Append value to array at the end.[m
[31m-      ///[m
[31m-      /// Equivalent to jsonvalue[jsonvalue.size()] = value;[m
[31m-      Value &append( const Value &value );[m
[31m-[m
[31m-      /// Access an object value by name, create a null member if it does not exist.[m
[31m-      Value &operator[]( const char *key );[m
[31m-      /// Access an object value by name, returns null if there is no member with that name.[m
[31m-      const Value &operator[]( const char *key ) const;[m
[31m-      /// Access an object value by name, create a null member if it does not exist.[m
[31m-      Value &operator[]( const std::string &key );[m
[31m-      /// Access an object value by name, returns null if there is no member with that name.[m
[31m-      const Value &operator[]( const std::string &key ) const;[m
[31m-      /** \brief Access an object value by name, create a null member if it does not exist.[m
[31m-[m
[31m-       * If the object as no entry for that name, then the member name used to store[m
[31m-       * the new entry is not duplicated.[m
[31m-       * Example of use:[m
[31m-       * \code[m
[31m-       * Json::Value object;[m
[31m-       * static const StaticString code("code");[m
[31m-       * object[code] = 1234;[m
[31m-       * \endcode[m
[31m-       */[m
[31m-      Value &operator[]( const StaticString &key );[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-      /// Access an object value by name, create a null member if it does not exist.[m
[31m-      Value &operator[]( const CppTL::ConstString &key );[m
[31m-      /// Access an object value by name, returns null if there is no member with that name.[m
[31m-      const Value &operator[]( const CppTL::ConstString &key ) const;[m
[31m-# endif[m
[31m-      /// Return the member named key if it exist, defaultValue otherwise.[m
[31m-      Value get( const char *key, [m
[31m-                 const Value &defaultValue ) const;[m
[31m-      /// Return the member named key if it exist, defaultValue otherwise.[m
[31m-      Value get( const std::string &key,[m
[31m-                 const Value &defaultValue ) const;[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-      /// Return the member named key if it exist, defaultValue otherwise.[m
[31m-      Value get( const CppTL::ConstString &key,[m
[31m-                 const Value &defaultValue ) const;[m
[31m-# endif[m
[31m-      /// \brief Remove and return the named member.  [m
[31m-      ///[m
[31m-      /// Do nothing if it did not exist.[m
[31m-      /// \return the removed Value, or null.[m
[31m-      /// \pre type() is objectValue or nullValue[m
[31m-      /// \post type() is unchanged[m
[31m-      Value removeMember( const char* key );[m
[31m-      /// Same as removeMember(const char*)[m
[31m-      Value removeMember( const std::string &key );[m
[31m-[m
[31m-      /// Return true if the object has a member named key.[m
[31m-      bool isMember( const char *key ) const;[m
[31m-      /// Return true if the object has a member named key.[m
[31m-      bool isMember( const std::string &key ) const;[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-      /// Return true if the object has a member named key.[m
[31m-      bool isMember( const CppTL::ConstString &key ) const;[m
[31m-# endif[m
[31m-[m
[31m-      /// \brief Return a list of the member names.[m
[31m-      ///[m
[31m-      /// If null, return an empty list.[m
[31m-      /// \pre type() is objectValue or nullValue[m
[31m-      /// \post if type() was nullValue, it remains nullValue[m
[31m-      Members getMemberNames() const;[m
[31m-[m
[31m-//# ifdef JSON_USE_CPPTL[m
[31m-//      EnumMemberNames enumMemberNames() const;[m
[31m-//      EnumValues enumValues() const;[m
[31m-//# endif[m
[31m-[m
[31m-      /// Comments must be //... or /* ... */[m
[31m-      void setComment( const char *comment,[m
[31m-                       CommentPlacement placement );[m
[31m-      /// Comments must be //... or /* ... */[m
[31m-      void setComment( const std::string &comment,[m
[31m-                       CommentPlacement placement );[m
[31m-      bool hasComment( CommentPlacement placement ) const;[m
[31m-      /// Include delimiters and embedded newlines.[m
[31m-      std::string getComment( CommentPlacement placement ) const;[m
[31m-[m
[31m-      std::string toStyledString() const;[m
[31m-[m
[31m-      const_iterator begin() const;[m
[31m-      const_iterator end() const;[m
[31m-[m
[31m-      iterator begin();[m
[31m-      iterator end();[m
[31m-[m
[31m-   private:[m
[31m-      Value &resolveReference( const char *key, [m
[31m-                               bool isStatic );[m
[31m-[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      inline bool isItemAvailable() const[m
[31m-      {[m
[31m-         return itemIsUsed_ == 0;[m
[31m-      }[m
[31m-[m
[31m-      inline void setItemUsed( bool isUsed = true )[m
[31m-      {[m
[31m-         itemIsUsed_ = isUsed ? 1 : 0;[m
[31m-      }[m
[31m-[m
[31m-      inline bool isMemberNameStatic() const[m
[31m-      {[m
[31m-         return memberNameIsStatic_ == 0;[m
[31m-      }[m
[31m-[m
[31m-      inline void setMemberNameIsStatic( bool isStatic )[m
[31m-      {[m
[31m-         memberNameIsStatic_ = isStatic ? 1 : 0;[m
[31m-      }[m
[31m-# endif // # ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-[m
[31m-   private:[m
[31m-      struct CommentInfo[m
[31m-      {[m
[31m-         CommentInfo();[m
[31m-         ~CommentInfo();[m
[31m-[m
[31m-         void setComment( const char *text );[m
[31m-[m
[31m-         char *comment_;[m
[31m-      };[m
[31m-[m
[31m-      //struct MemberNamesTransform[m
[31m-      //{[m
[31m-      //   typedef const char *result_type;[m
[31m-      //   const char *operator()( const CZString &name ) const[m
[31m-      //   {[m
[31m-      //      return name.c_str();[m
[31m-      //   }[m
[31m-      //};[m
[31m-[m
[31m-      union ValueHolder[m
[31m-      {[m
[31m-         Int int_;[m
[31m-         UInt uint_;[m
[31m-         double real_;[m
[31m-         bool bool_;[m
[31m-         char *string_;[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-         ValueInternalArray *array_;[m
[31m-         ValueInternalMap *map_;[m
[31m-#else[m
[31m-         ObjectValues *map_;[m
[31m-# endif[m
[31m-      } value_;[m
[31m-      ValueType type_ : 8;[m
[31m-      int allocated_ : 1;     // Notes: if declared as bool, bitfield is useless.[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      unsigned int itemIsUsed_ : 1;      // used by the ValueInternalMap container.[m
[31m-      int memberNameIsStatic_ : 1;       // used by the ValueInternalMap container.[m
[31m-# endif[m
[31m-      CommentInfo *comments_;[m
[31m-   };[m
[31m-[m
[31m-[m
[31m-   /** \brief Experimental and untested: represents an element of the "path" to access a node.[m
[31m-    */[m
[31m-   class PathArgument[m
[31m-   {[m
[31m-   public:[m
[31m-      friend class Path;[m
[31m-[m
[31m-      PathArgument();[m
[31m-      PathArgument( UInt index );[m
[31m-      PathArgument( const char *key );[m
[31m-      PathArgument( const std::string &key );[m
[31m-[m
[31m-   private:[m
[31m-      enum Kind[m
[31m-      {[m
[31m-         kindNone = 0,[m
[31m-         kindIndex,[m
[31m-         kindKey[m
[31m-      };[m
[31m-      std::string key_;[m
[31m-      UInt index_;[m
[31m-      Kind kind_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Experimental and untested: represents a "path" to access a node.[m
[31m-    *[m
[31m-    * Syntax:[m
[31m-    * - "." => root node[m
[31m-    * - ".[n]" => elements at index 'n' of root node (an array value)[m
[31m-    * - ".name" => member named 'name' of root node (an object value)[m
[31m-    * - ".name1.name2.name3"[m
[31m-    * - ".[0][1][2].name1[3]"[m
[31m-    * - ".%" => member name is provided as parameter[m
[31m-    * - ".[%]" => index is provied as parameter[m
[31m-    */[m
[31m-   class Path[m
[31m-   {[m
[31m-   public:[m
[31m-      Path( const std::string &path,[m
[31m-            const PathArgument &a1 = PathArgument(),[m
[31m-            const PathArgument &a2 = PathArgument(),[m
[31m-            const PathArgument &a3 = PathArgument(),[m
[31m-            const PathArgument &a4 = PathArgument(),[m
[31m-            const PathArgument &a5 = PathArgument() );[m
[31m-[m
[31m-      const Value &resolve( const Value &root ) const;[m
[31m-      Value resolve( const Value &root, [m
[31m-                     const Value &defaultValue ) const;[m
[31m-      /// Creates the "path" to access the specified node and returns a reference on the node.[m
[31m-      Value &make( Value &root ) const;[m
[31m-[m
[31m-   private:[m
[31m-      typedef std::vector<const PathArgument *> InArgs;[m
[31m-      typedef std::vector<PathArgument> Args;[m
[31m-[m
[31m-      void makePath( const std::string &path,[m
[31m-                     const InArgs &in );[m
[31m-      void addPathInArg( const std::string &path, [m
[31m-                         const InArgs &in, [m
[31m-                         InArgs::const_iterator &itInArg, [m
[31m-                         PathArgument::Kind kind );[m
[31m-      void invalidPath( const std::string &path, [m
[31m-                        int location );[m
[31m-[m
[31m-      Args args_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Experimental do not use: Allocator to customize member name and string value memory management done by Value.[m
[31m-    *[m
[31m-    * - makeMemberName() and releaseMemberName() are called to respectively duplicate and[m
[31m-    *   free an Json::objectValue member name.[m
[31m-    * - duplicateStringValue() and releaseStringValue() are called similarly to[m
[31m-    *   duplicate and free a Json::stringValue value.[m
[31m-    */[m
[31m-   class ValueAllocator[m
[31m-   {[m
[31m-   public:[m
[31m-      enum { unknown = (unsigned)-1 };[m
[31m-[m
[31m-      virtual ~ValueAllocator();[m
[31m-[m
[31m-      virtual char *makeMemberName( const char *memberName ) = 0;[m
[31m-      virtual void releaseMemberName( char *memberName ) = 0;[m
[31m-      virtual char *duplicateStringValue( const char *value, [m
[31m-                                          unsigned int length = unknown ) = 0;[m
[31m-      virtual void releaseStringValue( char *value ) = 0;[m
[31m-   };[m
[31m-[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   /** \brief Allocator to customize Value internal map.[m
[31m-    * Below is an example of a simple implementation (default implementation actually[m
[31m-    * use memory pool for speed).[m
[31m-    * \code[m
[31m-      class DefaultValueMapAllocator : public ValueMapAllocator[m
[31m-      {[m
[31m-      public: // overridden from ValueMapAllocator[m
[31m-         virtual ValueInternalMap *newMap()[m
[31m-         {[m
[31m-            return new ValueInternalMap();[m
[31m-         }[m
[31m-[m
[31m-         virtual ValueInternalMap *newMapCopy( const ValueInternalMap &other )[m
[31m-         {[m
[31m-            return new ValueInternalMap( other );[m
[31m-         }[m
[31m-[m
[31m-         virtual void destructMap( ValueInternalMap *map )[m
[31m-         {[m
[31m-            delete map;[m
[31m-         }[m
[31m-[m
[31m-         virtual ValueInternalLink *allocateMapBuckets( unsigned int size )[m
[31m-         {[m
[31m-            return new ValueInternalLink[size];[m
[31m-         }[m
[31m-[m
[31m-         virtual void releaseMapBuckets( ValueInternalLink *links )[m
[31m-         {[m
[31m-            delete [] links;[m
[31m-         }[m
[31m-[m
[31m-         virtual ValueInternalLink *allocateMapLink()[m
[31m-         {[m
[31m-            return new ValueInternalLink();[m
[31m-         }[m
[31m-[m
[31m-         virtual void releaseMapLink( ValueInternalLink *link )[m
[31m-         {[m
[31m-            delete link;[m
[31m-         }[m
[31m-      };[m
[31m-    * \endcode[m
[31m-    */ [m
[31m-   class JSON_API ValueMapAllocator[m
[31m-   {[m
[31m-   public:[m
[31m-      virtual ~ValueMapAllocator();[m
[31m-      virtual ValueInternalMap *newMap() = 0;[m
[31m-      virtual ValueInternalMap *newMapCopy( const ValueInternalMap &other ) = 0;[m
[31m-      virtual void destructMap( ValueInternalMap *map ) = 0;[m
[31m-      virtual ValueInternalLink *allocateMapBuckets( unsigned int size ) = 0;[m
[31m-      virtual void releaseMapBuckets( ValueInternalLink *links ) = 0;[m
[31m-      virtual ValueInternalLink *allocateMapLink() = 0;[m
[31m-      virtual void releaseMapLink( ValueInternalLink *link ) = 0;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief ValueInternalMap hash-map bucket chain link (for internal use only).[m
[31m-    * \internal previous_ & next_ allows for bidirectional traversal.[m
[31m-    */[m
[31m-   class JSON_API ValueInternalLink[m
[31m-   {[m
[31m-   public:[m
[31m-      enum { itemPerLink = 6 };  // sizeof(ValueInternalLink) = 128 on 32 bits architecture.[m
[31m-      enum InternalFlags { [m
[31m-         flagAvailable = 0,[m
[31m-         flagUsed = 1[m
[31m-      };[m
[31m-[m
[31m-      ValueInternalLink();[m
[31m-[m
[31m-      ~ValueInternalLink();[m
[31m-[m
[31m-      Value items_[itemPerLink];[m
[31m-      char *keys_[itemPerLink];[m
[31m-      ValueInternalLink *previous_;[m
[31m-      ValueInternalLink *next_;[m
[31m-   };[m
[31m-[m
[31m-[m
[31m-   /** \brief A linked page based hash-table implementation used internally by Value.[m
[31m-    * \internal ValueInternalMap is a tradional bucket based hash-table, with a linked[m
[31m-    * list in each bucket to handle collision. There is an addional twist in that[m
[31m-    * each node of the collision linked list is a page containing a fixed amount of[m
[31m-    * value. This provides a better compromise between memory usage and speed.[m
[31m-    * [m
[31m-    * Each bucket is made up of a chained list of ValueInternalLink. The last[m
[31m-    * link of a given bucket can be found in the 'previous_' field of the following bucket.[m
[31m-    * The last link of the last bucket is stored in tailLink_ as it has no following bucket.[m
[31m-    * Only the last link of a bucket may contains 'available' item. The last link always[m
[31m-    * contains at least one element unless is it the bucket one very first link.[m
[31m-    */[m
[31m-   class JSON_API ValueInternalMap[m
[31m-   {[m
[31m-      friend class ValueIteratorBase;[m
[31m-      friend class Value;[m
[31m-   public:[m
[31m-      typedef unsigned int HashKey;[m
[31m-      typedef unsigned int BucketIndex;[m
[31m-[m
[31m-# ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-      struct IteratorState[m
[31m-      {[m
[31m-         IteratorState() [m
[31m-            : map_(0)[m
[31m-            , link_(0)[m
[31m-            , itemIndex_(0)[m
[31m-            , bucketIndex_(0) [m
[31m-         {[m
[31m-         }[m
[31m-         ValueInternalMap *map_;[m
[31m-         ValueInternalLink *link_;[m
[31m-         BucketIndex itemIndex_;[m
[31m-         BucketIndex bucketIndex_;[m
[31m-      };[m
[31m-# endif // ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-[m
[31m-      ValueInternalMap();[m
[31m-      ValueInternalMap( const ValueInternalMap &other );[m
[31m-      ValueInternalMap &operator =( const ValueInternalMap &other );[m
[31m-      ~ValueInternalMap();[m
[31m-[m
[31m-      void swap( ValueInternalMap &other );[m
[31m-[m
[31m-      BucketIndex size() const;[m
[31m-[m
[31m-      void clear();[m
[31m-[m
[31m-      bool reserveDelta( BucketIndex growth );[m
[31m-[m
[31m-      bool reserve( BucketIndex newItemCount );[m
[31m-[m
[31m-      const Value *find( const char *key ) const;[m
[31m-[m
[31m-      Value *find( const char *key );[m
[31m-[m
[31m-      Value &resolveReference( const char *key, [m
[31m-                               bool isStatic );[m
[31m-[m
[31m-      void remove( const char *key );[m
[31m-[m
[31m-      void doActualRemove( ValueInternalLink *link, [m
[31m-                           BucketIndex index,[m
[31m-                           BucketIndex bucketIndex );[m
[31m-[m
[31m-      ValueInternalLink *&getLastLinkInBucket( BucketIndex bucketIndex );[m
[31m-[m
[31m-      Value &setNewItem( const char *key, [m
[31m-                         bool isStatic, [m
[31m-                         ValueInternalLink *link, [m
[31m-                         BucketIndex index );[m
[31m-[m
[31m-      Value &unsafeAdd( const char *key, [m
[31m-                        bool isStatic, [m
[31m-                        HashKey hashedKey );[m
[31m-[m
[31m-      HashKey hash( const char *key ) const;[m
[31m-[m
[31m-      int compare( const ValueInternalMap &other ) const;[m
[31m-[m
[31m-   private:[m
[31m-      void makeBeginIterator( IteratorState &it ) const;[m
[31m-      void makeEndIterator( IteratorState &it ) const;[m
[31m-      static bool equals( const IteratorState &x, const IteratorState &other );[m
[31m-      static void increment( IteratorState &iterator );[m
[31m-      static void incrementBucket( IteratorState &iterator );[m
[31m-      static void decrement( IteratorState &iterator );[m
[31m-      static const char *key( const IteratorState &iterator );[m
[31m-      static const char *key( const IteratorState &iterator, bool &isStatic );[m
[31m-      static Value &value( const IteratorState &iterator );[m
[31m-      static int distance( const IteratorState &x, const IteratorState &y );[m
[31m-[m
[31m-   private:[m
[31m-      ValueInternalLink *buckets_;[m
[31m-      ValueInternalLink *tailLink_;[m
[31m-      BucketIndex bucketsSize_;[m
[31m-      BucketIndex itemCount_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief A simplified deque implementation used internally by Value.[m
[31m-   * \internal[m
[31m-   * It is based on a list of fixed "page", each page contains a fixed number of items.[m
[31m-   * Instead of using a linked-list, a array of pointer is used for fast item look-up.[m
[31m-   * Look-up for an element is as follow:[m
[31m-   * - compute page index: pageIndex = itemIndex / itemsPerPage[m
[31m-   * - look-up item in page: pages_[pageIndex][itemIndex % itemsPerPage][m
[31m-   *[m
[31m-   * Insertion is amortized constant time (only the array containing the index of pointers[m
[31m-   * need to be reallocated when items are appended).[m
[31m-   */[m
[31m-   class JSON_API ValueInternalArray[m
[31m-   {[m
[31m-      friend class Value;[m
[31m-      friend class ValueIteratorBase;[m
[31m-   public:[m
[31m-      enum { itemsPerPage = 8 };    // should be a power of 2 for fast divide and modulo.[m
[31m-      typedef Value::ArrayIndex ArrayIndex;[m
[31m-      typedef unsigned int PageIndex;[m
[31m-[m
[31m-# ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-      struct IteratorState // Must be a POD[m
[31m-      {[m
[31m-         IteratorState() [m
[31m-            : array_(0)[m
[31m-            , currentPageIndex_(0)[m
[31m-            , currentItemIndex_(0) [m
[31m-         {[m
[31m-         }[m
[31m-         ValueInternalArray *array_;[m
[31m-         Value **currentPageIndex_;[m
[31m-         unsigned int currentItemIndex_;[m
[31m-      };[m
[31m-# endif // ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-[m
[31m-      ValueInternalArray();[m
[31m-      ValueInternalArray( const ValueInternalArray &other );[m
[31m-      ValueInternalArray &operator =( const ValueInternalArray &other );[m
[31m-      ~ValueInternalArray();[m
[31m-      void swap( ValueInternalArray &other );[m
[31m-[m
[31m-      void clear();[m
[31m-      void resize( ArrayIndex newSize );[m
[31m-[m
[31m-      Value &resolveReference( ArrayIndex index );[m
[31m-[m
[31m-      Value *find( ArrayIndex index ) const;[m
[31m-[m
[31m-      ArrayIndex size() const;[m
[31m-[m
[31m-      int compare( const ValueInternalArray &other ) const;[m
[31m-[m
[31m-   private:[m
[31m-      static bool equals( const IteratorState &x, const IteratorState &other );[m
[31m-      static void increment( IteratorState &iterator );[m
[31m-      static void decrement( IteratorState &iterator );[m
[31m-      static Value &dereference( const IteratorState &iterator );[m
[31m-      static Value &unsafeDereference( const IteratorState &iterator );[m
[31m-      static int distance( const IteratorState &x, const IteratorState &y );[m
[31m-      static ArrayIndex indexOf( const IteratorState &iterator );[m
[31m-      void makeBeginIterator( IteratorState &it ) const;[m
[31m-      void makeEndIterator( IteratorState &it ) const;[m
[31m-      void makeIterator( IteratorState &it, ArrayIndex index ) const;[m
[31m-[m
[31m-      void makeIndexValid( ArrayIndex index );[m
[31m-[m
[31m-      Value **pages_;[m
[31m-      ArrayIndex size_;[m
[31m-      PageIndex pageCount_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Experimental: do not use. Allocator to customize Value internal array.[m
[31m-    * Below is an example of a simple implementation (actual implementation use[m
[31m-    * memory pool).[m
[31m-      \code[m
[31m-class DefaultValueArrayAllocator : public ValueArrayAllocator[m
[31m-{[m
[31m-public: // overridden from ValueArrayAllocator[m
[31m-   virtual ~DefaultValueArrayAllocator()[m
[31m-   {[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalArray *newArray()[m
[31m-   {[m
[31m-      return new ValueInternalArray();[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalArray *newArrayCopy( const ValueInternalArray &other )[m
[31m-   {[m
[31m-      return new ValueInternalArray( other );[m
[31m-   }[m
[31m-[m
[31m-   virtual void destruct( ValueInternalArray *array )[m
[31m-   {[m
[31m-      delete array;[m
[31m-   }[m
[31m-[m
[31m-   virtual void reallocateArrayPageIndex( Value **&indexes, [m
[31m-                                          ValueInternalArray::PageIndex &indexCount,[m
[31m-                                          ValueInternalArray::PageIndex minNewIndexCount )[m
[31m-   {[m
[31m-      ValueInternalArray::PageIndex newIndexCount = (indexCount*3)/2 + 1;[m
[31m-      if ( minNewIndexCount > newIndexCount )[m
[31m-         newIndexCount = minNewIndexCount;[m
[31m-      void *newIndexes = realloc( indexes, sizeof(Value*) * newIndexCount );[m
[31m-      if ( !newIndexes )[m
[31m-         throw std::bad_alloc();[m
[31m-      indexCount = newIndexCount;[m
[31m-      indexes = static_cast<Value **>( newIndexes );[m
[31m-   }[m
[31m-   virtual void releaseArrayPageIndex( Value **indexes, [m
[31m-                                       ValueInternalArray::PageIndex indexCount )[m
[31m-   {[m
[31m-      if ( indexes )[m
[31m-         free( indexes );[m
[31m-   }[m
[31m-[m
[31m-   virtual Value *allocateArrayPage()[m
[31m-   {[m
[31m-      return static_cast<Value *>( malloc( sizeof(Value) * ValueInternalArray::itemsPerPage ) );[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseArrayPage( Value *value )[m
[31m-   {[m
[31m-      if ( value )[m
[31m-         free( value );[m
[31m-   }[m
[31m-};[m
[31m-      \endcode[m
[31m-    */ [m
[31m-   class JSON_API ValueArrayAllocator[m
[31m-   {[m
[31m-   public:[m
[31m-      virtual ~ValueArrayAllocator();[m
[31m-      virtual ValueInternalArray *newArray() = 0;[m
[31m-      virtual ValueInternalArray *newArrayCopy( const ValueInternalArray &other ) = 0;[m
[31m-      virtual void destructArray( ValueInternalArray *array ) = 0;[m
[31m-      /** \brief Reallocate array page index.[m
[31m-       * Reallocates an array of pointer on each page.[m
[31m-       * \param indexes [input] pointer on the current index. May be \c NULL.[m
[31m-       *                [output] pointer on the new index of at least [m
[31m-       *                         \a minNewIndexCount pages. [m
[31m-       * \param indexCount [input] current number of pages in the index.[m
[31m-       *                   [output] number of page the reallocated index can handle.[m
[31m-       *                            \b MUST be >= \a minNewIndexCount.[m
[31m-       * \param minNewIndexCount Minimum number of page the new index must be able to[m
[31m-       *                         handle.[m
[31m-       */[m
[31m-      virtual void reallocateArrayPageIndex( Value **&indexes, [m
[31m-                                             ValueInternalArray::PageIndex &indexCount,[m
[31m-                                             ValueInternalArray::PageIndex minNewIndexCount ) = 0;[m
[31m-      virtual void releaseArrayPageIndex( Value **indexes, [m
[31m-                                          ValueInternalArray::PageIndex indexCount ) = 0;[m
[31m-      virtual Value *allocateArrayPage() = 0;[m
[31m-      virtual void releaseArrayPage( Value *value ) = 0;[m
[31m-   };[m
[31m-#endif // #ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-[m
[31m-[m
[31m-   /** \brief base class for Value iterators.[m
[31m-    *[m
[31m-    */[m
[31m-   class ValueIteratorBase[m
[31m-   {[m
[31m-   public:[m
[31m-      typedef unsigned int size_t;[m
[31m-      typedef int difference_type;[m
[31m-      typedef ValueIteratorBase SelfType;[m
[31m-[m
[31m-      ValueIteratorBase();[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      explicit ValueIteratorBase( const Value::ObjectValues::iterator &current );[m
[31m-#else[m
[31m-      ValueIteratorBase( const ValueInternalArray::IteratorState &state );[m
[31m-      ValueIteratorBase( const ValueInternalMap::IteratorState &state );[m
[31m-#endif[m
[31m-[m
[31m-      bool operator ==( const SelfType &other ) const[m
[31m-      {[m
[31m-         return isEqual( other );[m
[31m-      }[m
[31m-[m
[31m-      bool operator !=( const SelfType &other ) const[m
[31m-      {[m
[31m-         return !isEqual( other );[m
[31m-      }[m
[31m-[m
[31m-      difference_type operator -( const SelfType &other ) const[m
[31m-      {[m
[31m-         return computeDistance( other );[m
[31m-      }[m
[31m-[m
[31m-      /// Return either the index or the member name of the referenced value as a Value.[m
[31m-      Value key() const;[m
[31m-[m
[31m-      /// Return the index of the referenced Value. -1 if it is not an arrayValue.[m
[31m-      UInt index() const;[m
[31m-[m
[31m-      /// Return the member name of the referenced Value. "" if it is not an objectValue.[m
[31m-      const char *memberName() const;[m
[31m-[m
[31m-   protected:[m
[31m-      Value &deref() const;[m
[31m-[m
[31m-      void increment();[m
[31m-[m
[31m-      void decrement();[m
[31m-[m
[31m-      difference_type computeDistance( const SelfType &other ) const;[m
[31m-[m
[31m-      bool isEqual( const SelfType &other ) const;[m
[31m-[m
[31m-      void copy( const SelfType &other );[m
[31m-[m
[31m-   private:[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      Value::ObjectValues::iterator current_;[m
[31m-      // Indicates that iterator is for a null value.[m
[31m-      bool isNull_;[m
[31m-#else[m
[31m-      union[m
[31m-      {[m
[31m-         ValueInternalArray::IteratorState array_;[m
[31m-         ValueInternalMap::IteratorState map_;[m
[31m-      } iterator_;[m
[31m-      bool isArray_;[m
[31m-#endif[m
[31m-   };[m
[31m-[m
[31m-   /** \brief const iterator for object and array value.[m
[31m-    *[m
[31m-    */[m
[31m-   class ValueConstIterator : public ValueIteratorBase[m
[31m-   {[m
[31m-      friend class Value;[m
[31m-   public:[m
[31m-      typedef unsigned int size_t;[m
[31m-      typedef int difference_type;[m
[31m-      typedef const Value &reference;[m
[31m-      typedef const Value *pointer;[m
[31m-      typedef ValueConstIterator SelfType;[m
[31m-[m
[31m-      ValueConstIterator();[m
[31m-   private:[m
[31m-      /*! \internal Use by Value to create an iterator.[m
[31m-       */[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      explicit ValueConstIterator( const Value::ObjectValues::iterator &current );[m
[31m-#else[m
[31m-      ValueConstIterator( const ValueInternalArray::IteratorState &state );[m
[31m-      ValueConstIterator( const ValueInternalMap::IteratorState &state );[m
[31m-#endif[m
[31m-   public:[m
[31m-      SelfType &operator =( const ValueIteratorBase &other );[m
[31m-[m
[31m-      SelfType operator++( int )[m
[31m-      {[m
[31m-         SelfType temp( *this );[m
[31m-         ++*this;[m
[31m-         return temp;[m
[31m-      }[m
[31m-[m
[31m-      SelfType operator--( int )[m
[31m-      {[m
[31m-         SelfType temp( *this );[m
[31m-         --*this;[m
[31m-         return temp;[m
[31m-      }[m
[31m-[m
[31m-      SelfType &operator--()[m
[31m-      {[m
[31m-         decrement();[m
[31m-         return *this;[m
[31m-      }[m
[31m-[m
[31m-      SelfType &operator++()[m
[31m-      {[m
[31m-         increment();[m
[31m-         return *this;[m
[31m-      }[m
[31m-[m
[31m-      reference operator *() const[m
[31m-      {[m
[31m-         return deref();[m
[31m-      }[m
[31m-   };[m
[31m-[m
[31m-[m
[31m-   /** \brief Iterator for object and array value.[m
[31m-    */[m
[31m-   class ValueIterator : public ValueIteratorBase[m
[31m-   {[m
[31m-      friend class Value;[m
[31m-   public:[m
[31m-      typedef unsigned int size_t;[m
[31m-      typedef int difference_type;[m
[31m-      typedef Value &reference;[m
[31m-      typedef Value *pointer;[m
[31m-      typedef ValueIterator SelfType;[m
[31m-[m
[31m-      ValueIterator();[m
[31m-      ValueIterator( const ValueConstIterator &other );[m
[31m-      ValueIterator( const ValueIterator &other );[m
[31m-   private:[m
[31m-      /*! \internal Use by Value to create an iterator.[m
[31m-       */[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      explicit ValueIterator( const Value::ObjectValues::iterator &current );[m
[31m-#else[m
[31m-      ValueIterator( const ValueInternalArray::IteratorState &state );[m
[31m-      ValueIterator( const ValueInternalMap::IteratorState &state );[m
[31m-#endif[m
[31m-   public:[m
[31m-[m
[31m-      SelfType &operator =( const SelfType &other );[m
[31m-[m
[31m-      SelfType operator++( int )[m
[31m-      {[m
[31m-         SelfType temp( *this );[m
[31m-         ++*this;[m
[31m-         return temp;[m
[31m-      }[m
[31m-[m
[31m-      SelfType operator--( int )[m
[31m-      {[m
[31m-         SelfType temp( *this );[m
[31m-         --*this;[m
[31m-         return temp;[m
[31m-      }[m
[31m-[m
[31m-      SelfType &operator--()[m
[31m-      {[m
[31m-         decrement();[m
[31m-         return *this;[m
[31m-      }[m
[31m-[m
[31m-      SelfType &operator++()[m
[31m-      {[m
[31m-         increment();[m
[31m-         return *this;[m
[31m-      }[m
[31m-[m
[31m-      reference operator *() const[m
[31m-      {[m
[31m-         return deref();[m
[31m-      }[m
[31m-   };[m
[31m-[m
[31m-[m
[31m-} // namespace Json[m
[31m-[m
[31m-[m
[31m-#endif // CPPTL_JSON_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/writer.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/writer.h[m
[1mdeleted file mode 100644[m
[1mindex 5f4b83b..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json/writer.h[m
[1m+++ /dev/null[m
[36m@@ -1,174 +0,0 @@[m
[31m-#ifndef JSON_WRITER_H_INCLUDED[m
[31m-# define JSON_WRITER_H_INCLUDED[m
[31m-[m
[31m-# include "value.h"[m
[31m-# include <vector>[m
[31m-# include <string>[m
[31m-# include <iostream>[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-   class Value;[m
[31m-[m
[31m-   /** \brief Abstract class for writers.[m
[31m-    */[m
[31m-   class JSON_API Writer[m
[31m-   {[m
[31m-   public:[m
[31m-      virtual ~Writer();[m
[31m-[m
[31m-      virtual std::string write( const Value &root ) = 0;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Outputs a Value in <a HREF="http://www.json.org">JSON</a> format without formatting (not human friendly).[m
[31m-    *[m
[31m-    * The JSON document is written in a single line. It is not intended for 'human' consumption,[m
[31m-    * but may be usefull to support feature such as RPC where bandwith is limited.[m
[31m-    * \sa Reader, Value[m
[31m-    */[m
[31m-   class JSON_API FastWriter : public Writer[m
[31m-   {[m
[31m-   public:[m
[31m-      FastWriter();[m
[31m-      virtual ~FastWriter(){}[m
[31m-[m
[31m-      void enableYAMLCompatibility();[m
[31m-[m
[31m-   public: // overridden from Writer[m
[31m-      virtual std::string write( const Value &root );[m
[31m-[m
[31m-   private:[m
[31m-      void writeValue( const Value &value );[m
[31m-[m
[31m-      std::string document_;[m
[31m-      bool yamlCompatiblityEnabled_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Writes a Value in <a HREF="http://www.json.org">JSON</a> format in a human friendly way.[m
[31m-    *[m
[31m-    * The rules for line break and indent are as follow:[m
[31m-    * - Object value:[m
[31m-    *     - if empty then print {} without indent and line break[m
[31m-    *     - if not empty the print '{', line break & indent, print one value per line[m
[31m-    *       and then unindent and line break and print '}'.[m
[31m-    * - Array value:[m
[31m-    *     - if empty then print [] without indent and line break[m
[31m-    *     - if the array contains no object value, empty array or some other value types,[m
[31m-    *       and all the values fit on one lines, then print the array on a single line.[m
[31m-    *     - otherwise, it the values do not fit on one line, or the array contains[m
[31m-    *       object or non empty array, then print one value per line.[m
[31m-    *[m
[31m-    * If the Value have comments then they are outputed according to their #CommentPlacement.[m
[31m-    *[m
[31m-    * \sa Reader, Value, Value::setComment()[m
[31m-    */[m
[31m-   class JSON_API StyledWriter: public Writer[m
[31m-   {[m
[31m-   public:[m
[31m-      StyledWriter();[m
[31m-      virtual ~StyledWriter(){}[m
[31m-[m
[31m-   public: // overridden from Writer[m
[31m-      /** \brief Serialize a Value in <a HREF="http://www.json.org">JSON</a> format.[m
[31m-       * \param root Value to serialize.[m
[31m-       * \return String containing the JSON document that represents the root value.[m
[31m-       */[m
[31m-      virtual std::string write( const Value &root );[m
[31m-[m
[31m-   private:[m
[31m-      void writeValue( const Value &value );[m
[31m-      void writeArrayValue( const Value &value );[m
[31m-      bool isMultineArray( const Value &value );[m
[31m-      void pushValue( const std::string &value );[m
[31m-      void writeIndent();[m
[31m-      void writeWithIndent( const std::string &value );[m
[31m-      void indent();[m
[31m-      void unindent();[m
[31m-      void writeCommentBeforeValue( const Value &root );[m
[31m-      void writeCommentAfterValueOnSameLine( const Value &root );[m
[31m-      bool hasCommentForValue( const Value &value );[m
[31m-      static std::string normalizeEOL( const std::string &text );[m
[31m-[m
[31m-      typedef std::vector<std::string> ChildValues;[m
[31m-[m
[31m-      ChildValues childValues_;[m
[31m-      std::string document_;[m
[31m-      std::string indentString_;[m
[31m-      int rightMargin_;[m
[31m-      int indentSize_;[m
[31m-      bool addChildValues_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Writes a Value in <a HREF="http://www.json.org">JSON</a> format in a human friendly way,[m
[31m-        to a stream rather than to a string.[m
[31m-    *[m
[31m-    * The rules for line break and indent are as follow:[m
[31m-    * - Object value:[m
[31m-    *     - if empty then print {} without indent and line break[m
[31m-    *     - if not empty the print '{', line break & indent, print one value per line[m
[31m-    *       and then unindent and line break and print '}'.[m
[31m-    * - Array value:[m
[31m-    *     - if empty then print [] without indent and line break[m
[31m-    *     - if the array contains no object value, empty array or some other value types,[m
[31m-    *       and all the values fit on one lines, then print the array on a single line.[m
[31m-    *     - otherwise, it the values do not fit on one line, or the array contains[m
[31m-    *       object or non empty array, then print one value per line.[m
[31m-    *[m
[31m-    * If the Value have comments then they are outputed according to their #CommentPlacement.[m
[31m-    *[m
[31m-    * \param indentation Each level will be indented by this amount extra.[m
[31m-    * \sa Reader, Value, Value::setComment()[m
[31m-    */[m
[31m-   class JSON_API StyledStreamWriter[m
[31m-   {[m
[31m-   public:[m
[31m-      StyledStreamWriter( std::string indentation="\t" );[m
[31m-      ~StyledStreamWriter(){}[m
[31m-[m
[31m-   public:[m
[31m-      /** \brief Serialize a Value in <a HREF="http://www.json.org">JSON</a> format.[m
[31m-       * \param out Stream to write to. (Can be ostringstream, e.g.)[m
[31m-       * \param root Value to serialize.[m
[31m-       * \note There is no point in deriving from Writer, since write() should not return a value.[m
[31m-       */[m
[31m-      void write( std::ostream &out, const Value &root );[m
[31m-[m
[31m-   private:[m
[31m-      void writeValue( const Value &value );[m
[31m-      void writeArrayValue( const Value &value );[m
[31m-      bool isMultineArray( const Value &value );[m
[31m-      void pushValue( const std::string &value );[m
[31m-      void writeIndent();[m
[31m-      void writeWithIndent( const std::string &value );[m
[31m-      void indent();[m
[31m-      void unindent();[m
[31m-      void writeCommentBeforeValue( const Value &root );[m
[31m-      void writeCommentAfterValueOnSameLine( const Value &root );[m
[31m-      bool hasCommentForValue( const Value &value );[m
[31m-      static std::string normalizeEOL( const std::string &text );[m
[31m-[m
[31m-      typedef std::vector<std::string> ChildValues;[m
[31m-[m
[31m-      ChildValues childValues_;[m
[31m-      std::ostream* document_;[m
[31m-      std::string indentString_;[m
[31m-      int rightMargin_;[m
[31m-      std::string indentation_;[m
[31m-      bool addChildValues_;[m
[31m-   };[m
[31m-[m
[31m-   std::string JSON_API valueToString( Int value );[m
[31m-   std::string JSON_API valueToString( UInt value );[m
[31m-   std::string JSON_API valueToString( double value );[m
[31m-   std::string JSON_API valueToString( bool value );[m
[31m-   std::string JSON_API valueToQuotedString( const char *value );[m
[31m-[m
[31m-   /// \brief Output using the StyledStreamWriter.[m
[31m-   /// \see Json::operator>>()[m
[31m-   std::ostream& operator<<( std::ostream&, const Value &root );[m
[31m-[m
[31m-} // namespace Json[m
[31m-[m
[31m-[m
[31m-[m
[31m-#endif // JSON_WRITER_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_batchallocator.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_batchallocator.h[m
[1mdeleted file mode 100644[m
[1mindex 87ea5ed..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_batchallocator.h[m
[1m+++ /dev/null[m
[36m@@ -1,125 +0,0 @@[m
[31m-#ifndef JSONCPP_BATCHALLOCATOR_H_INCLUDED[m
[31m-# define JSONCPP_BATCHALLOCATOR_H_INCLUDED[m
[31m-[m
[31m-# include <stdlib.h>[m
[31m-# include <assert.h>[m
[31m-[m
[31m-# ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-/* Fast memory allocator.[m
[31m- *[m
[31m- * This memory allocator allocates memory for a batch of object (specified by[m
[31m- * the page size, the number of object in each page).[m
[31m- *[m
[31m- * It does not allow the destruction of a single object. All the allocated objects[m
[31m- * can be destroyed at once. The memory can be either released or reused for future[m
[31m- * allocation.[m
[31m- * [m
[31m- * The in-place new operator must be used to construct the object using the pointer[m
[31m- * returned by allocate.[m
[31m- */[m
[31m-template<typename AllocatedType[m
[31m-        ,const unsigned int objectPerAllocation>[m
[31m-class BatchAllocator[m
[31m-{[m
[31m-public:[m
[31m-   typedef AllocatedType Type;[m
[31m-[m
[31m-   BatchAllocator( unsigned int objectsPerPage = 255 )[m
[31m-      : freeHead_( 0 )[m
[31m-      , objectsPerPage_( objectsPerPage )[m
[31m-   {[m
[31m-//      printf( "Size: %d => %s\n", sizeof(AllocatedType), typeid(AllocatedType).name() );[m
[31m-      assert( sizeof(AllocatedType) * objectPerAllocation >= sizeof(AllocatedType *) ); // We must be able to store a slist in the object free space.[m
[31m-      assert( objectsPerPage >= 16 );[m
[31m-      batches_ = allocateBatch( 0 );   // allocated a dummy page[m
[31m-      currentBatch_ = batches_;[m
[31m-   }[m
[31m-[m
[31m-   ~BatchAllocator()[m
[31m-   {[m
[31m-      for ( BatchInfo *batch = batches_; batch;  )[m
[31m-      {[m
[31m-         BatchInfo *nextBatch = batch->next_;[m
[31m-         free( batch );[m
[31m-         batch = nextBatch;[m
[31m-      }[m
[31m-   }[m
[31m-[m
[31m-   /// allocate space for an array of objectPerAllocation object.[m
[31m-   /// @warning it is the responsability of the caller to call objects constructors.[m
[31m-   AllocatedType *allocate()[m
[31m-   {[m
[31m-      if ( freeHead_ ) // returns node from free list.[m
[31m-      {[m
[31m-         AllocatedType *object = freeHead_;[m
[31m-         freeHead_ = *(AllocatedType **)object;[m
[31m-         return object;[m
[31m-      }[m
[31m-      if ( currentBatch_->used_ == currentBatch_->end_ )[m
[31m-      {[m
[31m-         currentBatch_ = currentBatch_->next_;[m
[31m-         while ( currentBatch_  &&  currentBatch_->used_ == currentBatch_->end_ )[m
[31m-            currentBatch_ = currentBatch_->next_;[m
[31m-[m
[31m-         if ( !currentBatch_  ) // no free batch found, allocate a new one[m
[31m-         { [m
[31m-            currentBatch_ = allocateBatch( objectsPerPage_ );[m
[31m-            currentBatch_->next_ = batches_; // insert at the head of the list[m
[31m-            batches_ = currentBatch_;[m
[31m-         }[m
[31m-      }[m
[31m-      AllocatedType *allocated = currentBatch_->used_;[m
[31m-      currentBatch_->used_ += objectPerAllocation;[m
[31m-      return allocated;[m
[31m-   }[m
[31m-[m
[31m-   /// Release the object.[m
[31m-   /// @warning it is the responsability of the caller to actually destruct the object.[m
[31m-   void release( AllocatedType *object )[m
[31m-   {[m
[31m-      assert( object != 0 );[m
[31m-      *(AllocatedType **)object = freeHead_;[m
[31m-      freeHead_ = object;[m
[31m-   }[m
[31m-[m
[31m-private:[m
[31m-   struct BatchInfo[m
[31m-   {[m
[31m-      BatchInfo *next_;[m
[31m-      AllocatedType *used_;[m
[31m-      AllocatedType *end_;[m
[31m-      AllocatedType buffer_[objectPerAllocation];[m
[31m-   };[m
[31m-[m
[31m-   // disabled copy constructor and assignement operator.[m
[31m-   BatchAllocator( const BatchAllocator & );[m
[31m-   void operator =( const BatchAllocator &);[m
[31m-[m
[31m-   static BatchInfo *allocateBatch( unsigned int objectsPerPage )[m
[31m-   {[m
[31m-      const unsigned int mallocSize = sizeof(BatchInfo) - sizeof(AllocatedType)* objectPerAllocation[m
[31m-                                + sizeof(AllocatedType) * objectPerAllocation * objectsPerPage;[m
[31m-      BatchInfo *batch = static_cast<BatchInfo*>( malloc( mallocSize ) );[m
[31m-      batch->next_ = 0;[m
[31m-      batch->used_ = batch->buffer_;[m
[31m-      batch->end_ = batch->buffer_ + objectsPerPage;[m
[31m-      return batch;[m
[31m-   }[m
[31m-[m
[31m-   BatchInfo *batches_;[m
[31m-   BatchInfo *currentBatch_;[m
[31m-   /// Head of a single linked list within the allocated space of freeed object[m
[31m-   AllocatedType *freeHead_;[m
[31m-   unsigned int objectsPerPage_;[m
[31m-};[m
[31m-[m
[31m-[m
[31m-} // namespace Json[m
[31m-[m
[31m-# endif // ifndef JSONCPP_DOC_INCLUDE_IMPLEMENTATION[m
[31m-[m
[31m-#endif // JSONCPP_BATCHALLOCATOR_H_INCLUDED[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_internalarray.inl b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_internalarray.inl[m
[1mdeleted file mode 100644[m
[1mindex 9b985d2..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_internalarray.inl[m
[1m+++ /dev/null[m
[36m@@ -1,448 +0,0 @@[m
[31m-// included by json_value.cpp[m
[31m-// everything is within Json namespace[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class ValueInternalArray[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-ValueArrayAllocator::~ValueArrayAllocator()[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class DefaultValueArrayAllocator[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-#ifdef JSON_USE_SIMPLE_INTERNAL_ALLOCATOR[m
[31m-class DefaultValueArrayAllocator : public ValueArrayAllocator[m
[31m-{[m
[31m-public: // overridden from ValueArrayAllocator[m
[31m-   virtual ~DefaultValueArrayAllocator()[m
[31m-   {[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalArray *newArray()[m
[31m-   {[m
[31m-      return new ValueInternalArray();[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalArray *newArrayCopy( const ValueInternalArray &other )[m
[31m-   {[m
[31m-      return new ValueInternalArray( other );[m
[31m-   }[m
[31m-[m
[31m-   virtual void destructArray( ValueInternalArray *array )[m
[31m-   {[m
[31m-      delete array;[m
[31m-   }[m
[31m-[m
[31m-   virtual void reallocateArrayPageIndex( Value **&indexes, [m
[31m-                                          ValueInternalArray::PageIndex &indexCount,[m
[31m-                                          ValueInternalArray::PageIndex minNewIndexCount )[m
[31m-   {[m
[31m-      ValueInternalArray::PageIndex newIndexCount = (indexCount*3)/2 + 1;[m
[31m-      if ( minNewIndexCount > newIndexCount )[m
[31m-         newIndexCount = minNewIndexCount;[m
[31m-      void *newIndexes = realloc( indexes, sizeof(Value*) * newIndexCount );[m
[31m-      if ( !newIndexes )[m
[31m-         throw std::bad_alloc();[m
[31m-      indexCount = newIndexCount;[m
[31m-      indexes = static_cast<Value **>( newIndexes );[m
[31m-   }[m
[31m-   virtual void releaseArrayPageIndex( Value **indexes, [m
[31m-                                       ValueInternalArray::PageIndex indexCount )[m
[31m-   {[m
[31m-      if ( indexes )[m
[31m-         free( indexes );[m
[31m-   }[m
[31m-[m
[31m-   virtual Value *allocateArrayPage()[m
[31m-   {[m
[31m-      return static_cast<Value *>( malloc( sizeof(Value) * ValueInternalArray::itemsPerPage ) );[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseArrayPage( Value *value )[m
[31m-   {[m
[31m-      if ( value )[m
[31m-         free( value );[m
[31m-   }[m
[31m-};[m
[31m-[m
[31m-#else // #ifdef JSON_USE_SIMPLE_INTERNAL_ALLOCATOR[m
[31m-/// @todo make this thread-safe (lock when accessign batch allocator)[m
[31m-class DefaultValueArrayAllocator : public ValueArrayAllocator[m
[31m-{[m
[31m-public: // overridden from ValueArrayAllocator[m
[31m-   virtual ~DefaultValueArrayAllocator()[m
[31m-   {[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalArray *newArray()[m
[31m-   {[m
[31m-      ValueInternalArray *array = arraysAllocator_.allocate();[m
[31m-      new (array) ValueInternalArray(); // placement new[m
[31m-      return array;[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalArray *newArrayCopy( const ValueInternalArray &other )[m
[31m-   {[m
[31m-      ValueInternalArray *array = arraysAllocator_.allocate();[m
[31m-      new (array) ValueInternalArray( other ); // placement new[m
[31m-      return array;[m
[31m-   }[m
[31m-[m
[31m-   virtual void destructArray( ValueInternalArray *array )[m
[31m-   {[m
[31m-      if ( array )[m
[31m-      {[m
[31m-         array->~ValueInternalArray();[m
[31m-         arraysAllocator_.release( array );[m
[31m-      }[m
[31m-   }[m
[31m-[m
[31m-   virtual void reallocateArrayPageIndex( Value **&indexes, [m
[31m-                                          ValueInternalArray::PageIndex &indexCount,[m
[31m-                                          ValueInternalArray::PageIndex minNewIndexCount )[m
[31m-   {[m
[31m-      ValueInternalArray::PageIndex newIndexCount = (indexCount*3)/2 + 1;[m
[31m-      if ( minNewIndexCount > newIndexCount )[m
[31m-         newIndexCount = minNewIndexCount;[m
[31m-      void *newIndexes = realloc( indexes, sizeof(Value*) * newIndexCount );[m
[31m-      if ( !newIndexes )[m
[31m-         throw std::bad_alloc();[m
[31m-      indexCount = newIndexCount;[m
[31m-      indexes = static_cast<Value **>( newIndexes );[m
[31m-   }[m
[31m-   virtual void releaseArrayPageIndex( Value **indexes, [m
[31m-                                       ValueInternalArray::PageIndex indexCount )[m
[31m-   {[m
[31m-      if ( indexes )[m
[31m-         free( indexes );[m
[31m-   }[m
[31m-[m
[31m-   virtual Value *allocateArrayPage()[m
[31m-   {[m
[31m-      return static_cast<Value *>( pagesAllocator_.allocate() );[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseArrayPage( Value *value )[m
[31m-   {[m
[31m-      if ( value )[m
[31m-         pagesAllocator_.release( value );[m
[31m-   }[m
[31m-private:[m
[31m-   BatchAllocator<ValueInternalArray,1> arraysAllocator_;[m
[31m-   BatchAllocator<Value,ValueInternalArray::itemsPerPage> pagesAllocator_;[m
[31m-};[m
[31m-#endif // #ifdef JSON_USE_SIMPLE_INTERNAL_ALLOCATOR[m
[31m-[m
[31m-static ValueArrayAllocator *&arrayAllocator()[m
[31m-{[m
[31m-   static DefaultValueArrayAllocator defaultAllocator;[m
[31m-   static ValueArrayAllocator *arrayAllocator = &defaultAllocator;[m
[31m-   return arrayAllocator;[m
[31m-}[m
[31m-[m
[31m-static struct DummyArrayAllocatorInitializer {[m
[31m-   DummyArrayAllocatorInitializer() [m
[31m-   {[m
[31m-      arrayAllocator();      // ensure arrayAllocator() statics are initialized before main().[m
[31m-   }[m
[31m-} dummyArrayAllocatorInitializer;[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class ValueInternalArray[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-bool [m
[31m-ValueInternalArray::equals( const IteratorState &x, [m
[31m-                            const IteratorState &other )[m
[31m-{[m
[31m-   return x.array_ == other.array_  [m
[31m-          &&  x.currentItemIndex_ == other.currentItemIndex_  [m
[31m-          &&  x.currentPageIndex_ == other.currentPageIndex_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::increment( IteratorState &it )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( it.array_  &&[m
[31m-      (it.currentPageIndex_ - it.array_->pages_)*itemsPerPage + it.currentItemIndex_[m
[31m-      != it.array_->size_,[m
[31m-      "ValueInternalArray::increment(): moving iterator beyond end" );[m
[31m-   ++(it.currentItemIndex_);[m
[31m-   if ( it.currentItemIndex_ == itemsPerPage )[m
[31m-   {[m
[31m-      it.currentItemIndex_ = 0;[m
[31m-      ++(it.currentPageIndex_);[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::decrement( IteratorState &it )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( it.array_  &&  it.currentPageIndex_ == it.array_->pages_ [m
[31m-                        &&  it.currentItemIndex_ == 0,[m
[31m-      "ValueInternalArray::decrement(): moving iterator beyond end" );[m
[31m-   if ( it.currentItemIndex_ == 0 )[m
[31m-   {[m
[31m-      it.currentItemIndex_ = itemsPerPage-1;[m
[31m-      --(it.currentPageIndex_);[m
[31m-   }[m
[31m-   else[m
[31m-   {[m
[31m-      --(it.currentItemIndex_);[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalArray::unsafeDereference( const IteratorState &it )[m
[31m-{[m
[31m-   return (*(it.currentPageIndex_))[it.currentItemIndex_];[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalArray::dereference( const IteratorState &it )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( it.array_  &&[m
[31m-      (it.currentPageIndex_ - it.array_->pages_)*itemsPerPage + it.currentItemIndex_[m
[31m-      < it.array_->size_,[m
[31m-      "ValueInternalArray::dereference(): dereferencing invalid iterator" );[m
[31m-   return unsafeDereference( it );[m
[31m-}[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::makeBeginIterator( IteratorState &it ) const[m
[31m-{[m
[31m-   it.array_ = const_cast<ValueInternalArray *>( this );[m
[31m-   it.currentItemIndex_ = 0;[m
[31m-   it.currentPageIndex_ = pages_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::makeIterator( IteratorState &it, ArrayIndex index ) const[m
[31m-{[m
[31m-   it.array_ = const_cast<ValueInternalArray *>( this );[m
[31m-   it.currentItemIndex_ = index % itemsPerPage;[m
[31m-   it.currentPageIndex_ = pages_ + index / itemsPerPage;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::makeEndIterator( IteratorState &it ) const[m
[31m-{[m
[31m-   makeIterator( it, size_ );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalArray::ValueInternalArray()[m
[31m-   : pages_( 0 )[m
[31m-   , size_( 0 )[m
[31m-   , pageCount_( 0 )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalArray::ValueInternalArray( const ValueInternalArray &other )[m
[31m-   : pages_( 0 )[m
[31m-   , pageCount_( 0 )[m
[31m-   , size_( other.size_ )[m
[31m-{[m
[31m-   PageIndex minNewPages = other.size_ / itemsPerPage;[m
[31m-   arrayAllocator()->reallocateArrayPageIndex( pages_, pageCount_, minNewPages );[m
[31m-   JSON_ASSERT_MESSAGE( pageCount_ >= minNewPages, [m
[31m-                        "ValueInternalArray::reserve(): bad reallocation" );[m
[31m-   IteratorState itOther;[m
[31m-   other.makeBeginIterator( itOther );[m
[31m-   Value *value;[m
[31m-   for ( ArrayIndex index = 0; index < size_; ++index, increment(itOther) )[m
[31m-   {[m
[31m-      if ( index % itemsPerPage == 0 )[m
[31m-      {[m
[31m-         PageIndex pageIndex = index / itemsPerPage;[m
[31m-         value = arrayAllocator()->allocateArrayPage();[m
[31m-         pages_[pageIndex] = value;[m
[31m-      }[m
[31m-      new (value) Value( dereference( itOther ) );[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalArray &[m
[31m-ValueInternalArray::operator =( const ValueInternalArray &other )[m
[31m-{[m
[31m-   ValueInternalArray temp( other );[m
[31m-   swap( temp );[m
[31m-   return *this;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalArray::~ValueInternalArray()[m
[31m-{[m
[31m-   // destroy all constructed items[m
[31m-   IteratorState it;[m
[31m-   IteratorState itEnd;[m
[31m-   makeBeginIterator( it);[m
[31m-   makeEndIterator( itEnd );[m
[31m-   for ( ; !equals(it,itEnd); increment(it) )[m
[31m-   {[m
[31m-      Value *value = &dereference(it);[m
[31m-      value->~Value();[m
[31m-   }[m
[31m-   // release all pages[m
[31m-   PageIndex lastPageIndex = size_ / itemsPerPage;[m
[31m-   for ( PageIndex pageIndex = 0; pageIndex < lastPageIndex; ++pageIndex )[m
[31m-      arrayAllocator()->releaseArrayPage( pages_[pageIndex] );[m
[31m-   // release pages index[m
[31m-   arrayAllocator()->releaseArrayPageIndex( pages_, pageCount_ );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::swap( ValueInternalArray &other )[m
[31m-{[m
[31m-   Value **tempPages = pages_;[m
[31m-   pages_ = other.pages_;[m
[31m-   other.pages_ = tempPages;[m
[31m-   ArrayIndex tempSize = size_;[m
[31m-   size_ = other.size_;[m
[31m-   other.size_ = tempSize;[m
[31m-   PageIndex tempPageCount = pageCount_;[m
[31m-   pageCount_ = other.pageCount_;[m
[31m-   other.pageCount_ = tempPageCount;[m
[31m-}[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::clear()[m
[31m-{[m
[31m-   ValueInternalArray dummy;[m
[31m-   swap( dummy );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::resize( ArrayIndex newSize )[m
[31m-{[m
[31m-   if ( newSize == 0 )[m
[31m-      clear();[m
[31m-   else if ( newSize < size_ )[m
[31m-   {[m
[31m-      IteratorState it;[m
[31m-      IteratorState itEnd;[m
[31m-      makeIterator( it, newSize );[m
[31m-      makeIterator( itEnd, size_ );[m
[31m-      for ( ; !equals(it,itEnd); increment(it) )[m
[31m-      {[m
[31m-         Value *value = &dereference(it);[m
[31m-         value->~Value();[m
[31m-      }[m
[31m-      PageIndex pageIndex = (newSize + itemsPerPage - 1) / itemsPerPage;[m
[31m-      PageIndex lastPageIndex = size_ / itemsPerPage;[m
[31m-      for ( ; pageIndex < lastPageIndex; ++pageIndex )[m
[31m-         arrayAllocator()->releaseArrayPage( pages_[pageIndex] );[m
[31m-      size_ = newSize;[m
[31m-   }[m
[31m-   else if ( newSize > size_ )[m
[31m-      resolveReference( newSize );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::makeIndexValid( ArrayIndex index )[m
[31m-{[m
[31m-   // Need to enlarge page index ?[m
[31m-   if ( index >= pageCount_ * itemsPerPage )[m
[31m-   {[m
[31m-      PageIndex minNewPages = (index + 1) / itemsPerPage;[m
[31m-      arrayAllocator()->reallocateArrayPageIndex( pages_, pageCount_, minNewPages );[m
[31m-      JSON_ASSERT_MESSAGE( pageCount_ >= minNewPages, "ValueInternalArray::reserve(): bad reallocation" );[m
[31m-   }[m
[31m-[m
[31m-   // Need to allocate new pages ?[m
[31m-   ArrayIndex nextPageIndex = [m
[31m-      (size_ % itemsPerPage) != 0 ? size_ - (size_%itemsPerPage) + itemsPerPage[m
[31m-                                  : size_;[m
[31m-   if ( nextPageIndex <= index )[m
[31m-   {[m
[31m-      PageIndex pageIndex = nextPageIndex / itemsPerPage;[m
[31m-      PageIndex pageToAllocate = (index - nextPageIndex) / itemsPerPage + 1;[m
[31m-      for ( ; pageToAllocate-- > 0; ++pageIndex )[m
[31m-         pages_[pageIndex] = arrayAllocator()->allocateArrayPage();[m
[31m-   }[m
[31m-[m
[31m-   // Initialize all new entries[m
[31m-   IteratorState it;[m
[31m-   IteratorState itEnd;[m
[31m-   makeIterator( it, size_ );[m
[31m-   size_ = index + 1;[m
[31m-   makeIterator( itEnd, size_ );[m
[31m-   for ( ; !equals(it,itEnd); increment(it) )[m
[31m-   {[m
[31m-      Value *value = &dereference(it);[m
[31m-      new (value) Value(); // Construct a default value using placement new[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalArray::resolveReference( ArrayIndex index )[m
[31m-{[m
[31m-   if ( index >= size_ )[m
[31m-      makeIndexValid( index );[m
[31m-   return pages_[index/itemsPerPage][index%itemsPerPage];[m
[31m-}[m
[31m-[m
[31m-Value *[m
[31m-ValueInternalArray::find( ArrayIndex index ) const[m
[31m-{[m
[31m-   if ( index >= size_ )[m
[31m-      return 0;[m
[31m-   return &(pages_[index/itemsPerPage][index%itemsPerPage]);[m
[31m-}[m
[31m-[m
[31m-ValueInternalArray::ArrayIndex [m
[31m-ValueInternalArray::size() const[m
[31m-{[m
[31m-   return size_;[m
[31m-}[m
[31m-[m
[31m-int [m
[31m-ValueInternalArray::distance( const IteratorState &x, const IteratorState &y )[m
[31m-{[m
[31m-   return indexOf(y) - indexOf(x);[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalArray::ArrayIndex [m
[31m-ValueInternalArray::indexOf( const IteratorState &iterator )[m
[31m-{[m
[31m-   if ( !iterator.array_ )[m
[31m-      return ArrayIndex(-1);[m
[31m-   return ArrayIndex([m
[31m-      (iterator.currentPageIndex_ - iterator.array_->pages_) * itemsPerPage [m
[31m-      + iterator.currentItemIndex_ );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-int [m
[31m-ValueInternalArray::compare( const ValueInternalArray &other ) const[m
[31m-{[m
[31m-   int sizeDiff( size_ - other.size_ );[m
[31m-   if ( sizeDiff != 0 )[m
[31m-      return sizeDiff;[m
[31m-   [m
[31m-   for ( ArrayIndex index =0; index < size_; ++index )[m
[31m-   {[m
[31m-      int diff = pages_[index/itemsPerPage][index%itemsPerPage].compare( [m
[31m-         other.pages_[index/itemsPerPage][index%itemsPerPage] );[m
[31m-      if ( diff != 0 )[m
[31m-         return diff;[m
[31m-   }[m
[31m-   return 0;[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_internalmap.inl b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_internalmap.inl[m
[1mdeleted file mode 100644[m
[1mindex 1977148..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_internalmap.inl[m
[1m+++ /dev/null[m
[36m@@ -1,607 +0,0 @@[m
[31m-// included by json_value.cpp[m
[31m-// everything is within Json namespace[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class ValueInternalMap[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-/** \internal MUST be safely initialized using memset( this, 0, sizeof(ValueInternalLink) );[m
[31m-   * This optimization is used by the fast allocator.[m
[31m-   */[m
[31m-ValueInternalLink::ValueInternalLink()[m
[31m-   : previous_( 0 )[m
[31m-   , next_( 0 )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-ValueInternalLink::~ValueInternalLink()[m
[31m-{ [m
[31m-   for ( int index =0; index < itemPerLink; ++index )[m
[31m-   {[m
[31m-      if ( !items_[index].isItemAvailable() )[m
[31m-      {[m
[31m-         if ( !items_[index].isMemberNameStatic() )[m
[31m-            free( keys_[index] );[m
[31m-      }[m
[31m-      else[m
[31m-         break;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-[m
[31m-ValueMapAllocator::~ValueMapAllocator()[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-#ifdef JSON_USE_SIMPLE_INTERNAL_ALLOCATOR[m
[31m-class DefaultValueMapAllocator : public ValueMapAllocator[m
[31m-{[m
[31m-public: // overridden from ValueMapAllocator[m
[31m-   virtual ValueInternalMap *newMap()[m
[31m-   {[m
[31m-      return new ValueInternalMap();[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalMap *newMapCopy( const ValueInternalMap &other )[m
[31m-   {[m
[31m-      return new ValueInternalMap( other );[m
[31m-   }[m
[31m-[m
[31m-   virtual void destructMap( ValueInternalMap *map )[m
[31m-   {[m
[31m-      delete map;[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalLink *allocateMapBuckets( unsigned int size )[m
[31m-   {[m
[31m-      return new ValueInternalLink[size];[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseMapBuckets( ValueInternalLink *links )[m
[31m-   {[m
[31m-      delete [] links;[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalLink *allocateMapLink()[m
[31m-   {[m
[31m-      return new ValueInternalLink();[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseMapLink( ValueInternalLink *link )[m
[31m-   {[m
[31m-      delete link;[m
[31m-   }[m
[31m-};[m
[31m-#else[m
[31m-/// @todo make this thread-safe (lock when accessign batch allocator)[m
[31m-class DefaultValueMapAllocator : public ValueMapAllocator[m
[31m-{[m
[31m-public: // overridden from ValueMapAllocator[m
[31m-   virtual ValueInternalMap *newMap()[m
[31m-   {[m
[31m-      ValueInternalMap *map = mapsAllocator_.allocate();[m
[31m-      new (map) ValueInternalMap(); // placement new[m
[31m-      return map;[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalMap *newMapCopy( const ValueInternalMap &other )[m
[31m-   {[m
[31m-      ValueInternalMap *map = mapsAllocator_.allocate();[m
[31m-      new (map) ValueInternalMap( other ); // placement new[m
[31m-      return map;[m
[31m-   }[m
[31m-[m
[31m-   virtual void destructMap( ValueInternalMap *map )[m
[31m-   {[m
[31m-      if ( map )[m
[31m-      {[m
[31m-         map->~ValueInternalMap();[m
[31m-         mapsAllocator_.release( map );[m
[31m-      }[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalLink *allocateMapBuckets( unsigned int size )[m
[31m-   {[m
[31m-      return new ValueInternalLink[size];[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseMapBuckets( ValueInternalLink *links )[m
[31m-   {[m
[31m-      delete [] links;[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalLink *allocateMapLink()[m
[31m-   {[m
[31m-      ValueInternalLink *link = linksAllocator_.allocate();[m
[31m-      memset( link, 0, sizeof(ValueInternalLink) );[m
[31m-      return link;[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseMapLink( ValueInternalLink *link )[m
[31m-   {[m
[31m-      link->~ValueInternalLink();[m
[31m-      linksAllocator_.release( link );[m
[31m-   }[m
[31m-private:[m
[31m-   BatchAllocator<ValueInternalMap,1> mapsAllocator_;[m
[31m-   BatchAllocator<ValueInternalLink,1> linksAllocator_;[m
[31m-};[m
[31m-#endif[m
[31m-[m
[31m-static ValueMapAllocator *&mapAllocator()[m
[31m-{[m
[31m-   static DefaultValueMapAllocator defaultAllocator;[m
[31m-   static ValueMapAllocator *mapAllocator = &defaultAllocator;[m
[31m-   return mapAllocator;[m
[31m-}[m
[31m-[m
[31m-static struct DummyMapAllocatorInitializer {[m
[31m-   DummyMapAllocatorInitializer() [m
[31m-   {[m
[31m-      mapAllocator();      // ensure mapAllocator() statics are initialized before main().[m
[31m-   }[m
[31m-} dummyMapAllocatorInitializer;[m
[31m-[m
[31m-[m
[31m-[m
[31m-// h(K) = value * K >> w ; with w = 32 & K prime w.r.t. 2^32.[m
[31m-[m
[31m-/*[m
[31m-use linked list hash map. [m
[31m-buckets array is a container.[m
[31m-linked list element contains 6 key/values. (memory = (16+4) * 6 + 4 = 124)[m
[31m-value have extra state: valid, available, deleted[m
[31m-*/[m
[31m-[m
[31m-[m
[31m-ValueInternalMap::ValueInternalMap()[m
[31m-   : buckets_( 0 )[m
[31m-   , tailLink_( 0 )[m
[31m-   , bucketsSize_( 0 )[m
[31m-   , itemCount_( 0 )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalMap::ValueInternalMap( const ValueInternalMap &other )[m
[31m-   : buckets_( 0 )[m
[31m-   , tailLink_( 0 )[m
[31m-   , bucketsSize_( 0 )[m
[31m-   , itemCount_( 0 )[m
[31m-{[m
[31m-   reserve( other.itemCount_ );[m
[31m-   IteratorState it;[m
[31m-   IteratorState itEnd;[m
[31m-   other.makeBeginIterator( it );[m
[31m-   other.makeEndIterator( itEnd );[m
[31m-   for ( ; !equals(it,itEnd); increment(it) )[m
[31m-   {[m
[31m-      bool isStatic;[m
[31m-      const char *memberName = key( it, isStatic );[m
[31m-      const Value &aValue = value( it );[m
[31m-      resolveReference(memberName, isStatic) = aValue;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalMap &[m
[31m-ValueInternalMap::operator =( const ValueInternalMap &other )[m
[31m-{[m
[31m-   ValueInternalMap dummy( other );[m
[31m-   swap( dummy );[m
[31m-   return *this;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalMap::~ValueInternalMap()[m
[31m-{[m
[31m-   if ( buckets_ )[m
[31m-   {[m
[31m-      for ( BucketIndex bucketIndex =0; bucketIndex < bucketsSize_; ++bucketIndex )[m
[31m-      {[m
[31m-         ValueInternalLink *link = buckets_[bucketIndex].next_;[m
[31m-         while ( link )[m
[31m-         {[m
[31m-            ValueInternalLink *linkToRelease = link;[m
[31m-            link = link->next_;[m
[31m-            mapAllocator()->releaseMapLink( linkToRelease );[m
[31m-         }[m
[31m-      }[m
[31m-      mapAllocator()->releaseMapBuckets( buckets_ );[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::swap( ValueInternalMap &other )[m
[31m-{[m
[31m-   ValueInternalLink *tempBuckets = buckets_;[m
[31m-   buckets_ = other.buckets_;[m
[31m-   other.buckets_ = tempBuckets;[m
[31m-   ValueInternalLink *tempTailLink = tailLink_;[m
[31m-   tailLink_ = other.tailLink_;[m
[31m-   other.tailLink_ = tempTailLink;[m
[31m-   BucketIndex tempBucketsSize = bucketsSize_;[m
[31m-   bucketsSize_ = other.bucketsSize_;[m
[31m-   other.bucketsSize_ = tempBucketsSize;[m
[31m-   BucketIndex tempItemCount = itemCount_;[m
[31m-   itemCount_ = other.itemCount_;[m
[31m-   other.itemCount_ = tempItemCount;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::clear()[m
[31m-{[m
[31m-   ValueInternalMap dummy;[m
[31m-   swap( dummy );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalMap::BucketIndex [m
[31m-ValueInternalMap::size() const[m
[31m-{[m
[31m-   return itemCount_;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-ValueInternalMap::reserveDelta( BucketIndex growth )[m
[31m-{[m
[31m-   return reserve( itemCount_ + growth );[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-ValueInternalMap::reserve( BucketIndex newItemCount )[m
[31m-{[m
[31m-   if ( !buckets_  &&  newItemCount > 0 )[m
[31m-   {[m
[31m-      buckets_ = mapAllocator()->allocateMapBuckets( 1 );[m
[31m-      bucketsSize_ = 1;[m
[31m-      tailLink_ = &buckets_[0];[m
[31m-   }[m
[31m-//   BucketIndex idealBucketCount = (newItemCount + ValueInternalLink::itemPerLink) / ValueInternalLink::itemPerLink;[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const Value *[m
[31m-ValueInternalMap::find( const char *key ) const[m
[31m-{[m
[31m-   if ( !bucketsSize_ )[m
[31m-      return 0;[m
[31m-   HashKey hashedKey = hash( key );[m
[31m-   BucketIndex bucketIndex = hashedKey % bucketsSize_;[m
[31m-   for ( const ValueInternalLink *current = &buckets_[bucketIndex]; [m
[31m-         current != 0; [m
[31m-         current = current->next_ )[m
[31m-   {[m
[31m-      for ( BucketIndex index=0; index < ValueInternalLink::itemPerLink; ++index )[m
[31m-      {[m
[31m-         if ( current->items_[index].isItemAvailable() )[m
[31m-            return 0;[m
[31m-         if ( strcmp( key, current->keys_[index] ) == 0 )[m
[31m-            return &current->items_[index];[m
[31m-      }[m
[31m-   }[m
[31m-   return 0;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value *[m
[31m-ValueInternalMap::find( const char *key )[m
[31m-{[m
[31m-   const ValueInternalMap *constThis = this;[m
[31m-   return const_cast<Value *>( constThis->find( key ) );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalMap::resolveReference( const char *key,[m
[31m-                                    bool isStatic )[m
[31m-{[m
[31m-   HashKey hashedKey = hash( key );[m
[31m-   if ( bucketsSize_ )[m
[31m-   {[m
[31m-      BucketIndex bucketIndex = hashedKey % bucketsSize_;[m
[31m-      ValueInternalLink **previous = 0;[m
[31m-      BucketIndex index;[m
[31m-      for ( ValueInternalLink *current = &buckets_[bucketIndex]; [m
[31m-            current != 0; [m
[31m-            previous = &current->next_, current = current->next_ )[m
[31m-      {[m
[31m-         for ( index=0; index < ValueInternalLink::itemPerLink; ++index )[m
[31m-         {[m
[31m-            if ( current->items_[index].isItemAvailable() )[m
[31m-               return setNewItem( key, isStatic, current, index );[m
[31m-            if ( strcmp( key, current->keys_[index] ) == 0 )[m
[31m-               return current->items_[index];[m
[31m-         }[m
[31m-      }[m
[31m-   }[m
[31m-[m
[31m-   reserveDelta( 1 );[m
[31m-   return unsafeAdd( key, isStatic, hashedKey );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::remove( const char *key )[m
[31m-{[m
[31m-   HashKey hashedKey = hash( key );[m
[31m-   if ( !bucketsSize_ )[m
[31m-      return;[m
[31m-   BucketIndex bucketIndex = hashedKey % bucketsSize_;[m
[31m-   for ( ValueInternalLink *link = &buckets_[bucketIndex]; [m
[31m-         link != 0; [m
[31m-         link = link->next_ )[m
[31m-   {[m
[31m-      BucketIndex index;[m
[31m-      for ( index =0; index < ValueInternalLink::itemPerLink; ++index )[m
[31m-      {[m
[31m-         if ( link->items_[index].isItemAvailable() )[m
[31m-            return;[m
[31m-         if ( strcmp( key, link->keys_[index] ) == 0 )[m
[31m-         {[m
[31m-            doActualRemove( link, index, bucketIndex );[m
[31m-            return;[m
[31m-         }[m
[31m-      }[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::doActualRemove( ValueInternalLink *link, [m
[31m-                                  BucketIndex index,[m
[31m-                                  BucketIndex bucketIndex )[m
[31m-{[m
[31m-   // find last item of the bucket and swap it with the 'removed' one.[m
[31m-   // set removed items flags to 'available'.[m
[31m-   // if last page only contains 'available' items, then desallocate it (it's empty)[m
[31m-   ValueInternalLink *&lastLink = getLastLinkInBucket( index );[m
[31m-   BucketIndex lastItemIndex = 1; // a link can never be empty, so start at 1[m
[31m-   for ( ;   [m
[31m-         lastItemIndex < ValueInternalLink::itemPerLink; [m
[31m-         ++lastItemIndex ) // may be optimized with dicotomic search[m
[31m-   {[m
[31m-      if ( lastLink->items_[lastItemIndex].isItemAvailable() )[m
[31m-         break;[m
[31m-   }[m
[31m-   [m
[31m-   BucketIndex lastUsedIndex = lastItemIndex - 1;[m
[31m-   Value *valueToDelete = &link->items_[index];[m
[31m-   Value *valueToPreserve = &lastLink->items_[lastUsedIndex];[m
[31m-   if ( valueToDelete != valueToPreserve )[m
[31m-      valueToDelete->swap( *valueToPreserve );[m
[31m-   if ( lastUsedIndex == 0 )  // page is now empty[m
[31m-   {  // remove it from bucket linked list and delete it.[m
[31m-      ValueInternalLink *linkPreviousToLast = lastLink->previous_;[m
[31m-      if ( linkPreviousToLast != 0 )   // can not deleted bucket link.[m
[31m-      {[m
[31m-         mapAllocator()->releaseMapLink( lastLink );[m
[31m-         linkPreviousToLast->next_ = 0;[m
[31m-         lastLink = linkPreviousToLast;[m
[31m-      }[m
[31m-   }[m
[31m-   else[m
[31m-   {[m
[31m-      Value dummy;[m
[31m-      valueToPreserve->swap( dummy ); // restore deleted to default Value.[m
[31m-      valueToPreserve->setItemUsed( false );[m
[31m-   }[m
[31m-   --itemCount_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalLink *&[m
[31m-ValueInternalMap::getLastLinkInBucket( BucketIndex bucketIndex )[m
[31m-{[m
[31m-   if ( bucketIndex == bucketsSize_ - 1 )[m
[31m-      return tailLink_;[m
[31m-   ValueInternalLink *&previous = buckets_[bucketIndex+1].previous_;[m
[31m-   if ( !previous )[m
[31m-      previous = &buckets_[bucketIndex];[m
[31m-   return previous;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalMap::setNewItem( const char *key, [m
[31m-                              bool isStatic,[m
[31m-                              ValueInternalLink *link, [m
[31m-                              BucketIndex index )[m
[31m-{[m
[31m-   char *duplicatedKey = valueAllocator()->makeMemberName( key );[m
[31m-   ++itemCount_;[m
[31m-   link->keys_[index] = duplicatedKey;[m
[31m-   link->items_[index].setItemUsed();[m
[31m-   link->items_[index].setMemberNameIsStatic( isStatic );[m
[31m-   return link->items_[index]; // items already default constructed.[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalMap::unsafeAdd( const char *key, [m
[31m-                             bool isStatic, [m
[31m-                             HashKey hashedKey )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( bucketsSize_ > 0, "ValueInternalMap::unsafeAdd(): internal logic error." );[m
[31m-   BucketIndex bucketIndex = hashedKey % bucketsSize_;[m
[31m-   ValueInternalLink *&previousLink = getLastLinkInBucket( bucketIndex );[m
[31m-   ValueInternalLink *link = previousLink;[m
[31m-   BucketIndex index;[m
[31m-   for ( index =0; index < ValueInternalLink::itemPerLink; ++index )[m
[31m-   {[m
[31m-      if ( link->items_[index].isItemAvailable() )[m
[31m-         break;[m
[31m-   }[m
[31m-   if ( index == ValueInternalLink::itemPerLink ) // need to add a new page[m
[31m-   {[m
[31m-      ValueInternalLink *newLink = mapAllocator()->allocateMapLink();[m
[31m-      index = 0;[m
[31m-      link->next_ = newLink;[m
[31m-      previousLink = newLink;[m
[31m-      link = newLink;[m
[31m-   }[m
[31m-   return setNewItem( key, isStatic, link, index );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalMap::HashKey [m
[31m-ValueInternalMap::hash( const char *key ) const[m
[31m-{[m
[31m-   HashKey hash = 0;[m
[31m-   while ( *key )[m
[31m-      hash += *key++ * 37;[m
[31m-   return hash;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-int [m
[31m-ValueInternalMap::compare( const ValueInternalMap &other ) const[m
[31m-{[m
[31m-   int sizeDiff( itemCount_ - other.itemCount_ );[m
[31m-   if ( sizeDiff != 0 )[m
[31m-      return sizeDiff;[m
[31m-   // Strict order guaranty is required. Compare all keys FIRST, then compare values.[m
[31m-   IteratorState it;[m
[31m-   IteratorState itEnd;[m
[31m-   makeBeginIterator( it );[m
[31m-   makeEndIterator( itEnd );[m
[31m-   for ( ; !equals(it,itEnd); increment(it) )[m
[31m-   {[m
[31m-      if ( !other.find( key( it ) ) )[m
[31m-         return 1;[m
[31m-   }[m
[31m-[m
[31m-   // All keys are equals, let's compare values[m
[31m-   makeBeginIterator( it );[m
[31m-   for ( ; !equals(it,itEnd); increment(it) )[m
[31m-   {[m
[31m-      const Value *otherValue = other.find( key( it ) );[m
[31m-      int valueDiff = value(it).compare( *otherValue );[m
[31m-      if ( valueDiff != 0 )[m
[31m-         return valueDiff;[m
[31m-   }[m
[31m-   return 0;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::makeBeginIterator( IteratorState &it ) const[m
[31m-{[m
[31m-   it.map_ = const_cast<ValueInternalMap *>( this );[m
[31m-   it.bucketIndex_ = 0;[m
[31m-   it.itemIndex_ = 0;[m
[31m-   it.link_ = buckets_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::makeEndIterator( IteratorState &it ) const[m
[31m-{[m
[31m-   it.map_ = const_cast<ValueInternalMap *>( this );[m
[31m-   it.bucketIndex_ = bucketsSize_;[m
[31m-   it.itemIndex_ = 0;[m
[31m-   it.link_ = 0;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-ValueInternalMap::equals( const IteratorState &x, const IteratorState &other )[m
[31m-{[m
[31m-   return x.map_ == other.map_  [m
[31m-          &&  x.bucketIndex_ == other.bucketIndex_  [m
[31m-          &&  x.link_ == other.link_[m
[31m-          &&  x.itemIndex_ == other.itemIndex_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::incrementBucket( IteratorState &iterator )[m
[31m-{[m
[31m-   ++iterator.bucketIndex_;[m
[31m-   JSON_ASSERT_MESSAGE( iterator.bucketIndex_ <= iterator.map_->bucketsSize_,[m
[31m-      "ValueInternalMap::increment(): attempting to iterate beyond end." );[m
[31m-   if ( iterator.bucketIndex_ == iterator.map_->bucketsSize_ )[m
[31m-      iterator.link_ = 0;[m
[31m-   else[m
[31m-      iterator.link_ = &(iterator.map_->buckets_[iterator.bucketIndex_]);[m
[31m-   iterator.itemIndex_ = 0;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::increment( IteratorState &iterator )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( iterator.map_, "Attempting to iterator using invalid iterator." );[m
[31m-   ++iterator.itemIndex_;[m
[31m-   if ( iterator.itemIndex_ == ValueInternalLink::itemPerLink )[m
[31m-   {[m
[31m-      JSON_ASSERT_MESSAGE( iterator.link_ != 0,[m
[31m-         "ValueInternalMap::increment(): attempting to iterate beyond end." );[m
[31m-      iterator.link_ = iterator.link_->next_;[m
[31m-      if ( iterator.link_ == 0 )[m
[31m-         incrementBucket( iterator );[m
[31m-   }[m
[31m-   else if ( iterator.link_->items_[iterator.itemIndex_].isItemAvailable() )[m
[31m-   {[m
[31m-      incrementBucket( iterator );[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::decrement( IteratorState &iterator )[m
[31m-{[m
[31m-   if ( iterator.itemIndex_ == 0 )[m
[31m-   {[m
[31m-      JSON_ASSERT_MESSAGE( iterator.map_, "Attempting to iterate using invalid iterator." );[m
[31m-      if ( iterator.link_ == &iterator.map_->buckets_[iterator.bucketIndex_] )[m
[31m-      {[m
[31m-         JSON_ASSERT_MESSAGE( iterator.bucketIndex_ > 0, "Attempting to iterate beyond beginning." );[m
[31m-         --(iterator.bucketIndex_);[m
[31m-      }[m
[31m-      iterator.link_ = iterator.link_->previous_;[m
[31m-      iterator.itemIndex_ = ValueInternalLink::itemPerLink - 1;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const char *[m
[31m-ValueInternalMap::key( const IteratorState &iterator )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( iterator.link_, "Attempting to iterate using invalid iterator." );[m
[31m-   return iterator.link_->keys_[iterator.itemIndex_];[m
[31m-}[m
[31m-[m
[31m-const char *[m
[31m-ValueInternalMap::key( const IteratorState &iterator, bool &isStatic )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( iterator.link_, "Attempting to iterate using invalid iterator." );[m
[31m-   isStatic = iterator.link_->items_[iterator.itemIndex_].isMemberNameStatic();[m
[31m-   return iterator.link_->keys_[iterator.itemIndex_];[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalMap::value( const IteratorState &iterator )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( iterator.link_, "Attempting to iterate using invalid iterator." );[m
[31m-   return iterator.link_->items_[iterator.itemIndex_];[m
[31m-}[m
[31m-[m
[31m-[m
[31m-int [m
[31m-ValueInternalMap::distance( const IteratorState &x, const IteratorState &y )[m
[31m-{[m
[31m-   int offset = 0;[m
[31m-   IteratorState it = x;[m
[31m-   while ( !equals( it, y ) )[m
[31m-      increment( it );[m
[31m-   return offset;[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_reader.cpp b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_reader.cpp[m
[1mdeleted file mode 100644[m
[1mindex 5af16c8..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_reader.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,892 +0,0 @@[m
[31m-#include <json/reader.h>[m
[31m-#include <json/value.h>[m
[31m-#include <utility>[m
[31m-#include <cstdio>[m
[31m-#include <cassert>[m
[31m-#include <cstring>[m
[31m-#include <iostream>[m
[31m-#include <stdexcept>[m
[31m-[m
[31m-#if _MSC_VER >= 1400 // VC++ 8.0[m
[31m-#pragma warning( disable : 4996 )   // disable warning about strdup being deprecated.[m
[31m-#endif[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-// QNX is strict about declaring C symbols in the std namespace.[m
[31m-#ifdef __QNXNTO__[m
[31m-using std::memcpy;[m
[31m-using std::sprintf;[m
[31m-using std::sscanf;[m
[31m-#endif[m
[31m-[m
[31m-// Implementation of class Features[m
[31m-// ////////////////////////////////[m
[31m-[m
[31m-Features::Features()[m
[31m-   : allowComments_( true )[m
[31m-   , strictRoot_( false )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Features [m
[31m-Features::all()[m
[31m-{[m
[31m-   return Features();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Features [m
[31m-Features::strictMode()[m
[31m-{[m
[31m-   Features features;[m
[31m-   features.allowComments_ = false;[m
[31m-   features.strictRoot_ = true;[m
[31m-   return features;[m
[31m-}[m
[31m-[m
[31m-// Implementation of class Reader[m
[31m-// ////////////////////////////////[m
[31m-[m
[31m-[m
[31m-static inline bool [m
[31m-in( Reader::Char c, Reader::Char c1, Reader::Char c2, Reader::Char c3, Reader::Char c4 )[m
[31m-{[m
[31m-   return c == c1  ||  c == c2  ||  c == c3  ||  c == c4;[m
[31m-}[m
[31m-[m
[31m-static inline bool [m
[31m-in( Reader::Char c, Reader::Char c1, Reader::Char c2, Reader::Char c3, Reader::Char c4, Reader::Char c5 )[m
[31m-{[m
[31m-   return c == c1  ||  c == c2  ||  c == c3  ||  c == c4  ||  c == c5;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-static bool [m
[31m-containsNewLine( Reader::Location begin, [m
[31m-                 Reader::Location end )[m
[31m-{[m
[31m-   for ( ;begin < end; ++begin )[m
[31m-      if ( *begin == '\n'  ||  *begin == '\r' )[m
[31m-         return true;[m
[31m-   return false;[m
[31m-}[m
[31m-[m
[31m-static std::string codePointToUTF8(unsigned int cp)[m
[31m-{[m
[31m-   std::string result;[m
[31m-   [m
[31m-   // based on description from http://en.wikipedia.org/wiki/UTF-8[m
[31m-[m
[31m-   if (cp <= 0x7f) [m
[31m-   {[m
[31m-      result.resize(1);[m
[31m-      result[0] = static_cast<char>(cp);[m
[31m-   } [m
[31m-   else if (cp <= 0x7FF) [m
[31m-   {[m
[31m-      result.resize(2);[m
[31m-      result[1] = static_cast<char>(0x80 | (0x3f & cp));[m
[31m-      result[0] = static_cast<char>(0xC0 | (0x1f & (cp >> 6)));[m
[31m-   } [m
[31m-   else if (cp <= 0xFFFF) [m
[31m-   {[m
[31m-      result.resize(3);[m
[31m-      result[2] = static_cast<char>(0x80 | (0x3f & cp));[m
[31m-      result[1] = 0x80 | static_cast<char>((0x3f & (cp >> 6)));[m
[31m-      result[0] = 0xE0 | static_cast<char>((0xf & (cp >> 12)));[m
[31m-   }[m
[31m-   else if (cp <= 0x10FFFF) [m
[31m-   {[m
[31m-      result.resize(4);[m
[31m-      result[3] = static_cast<char>(0x80 | (0x3f & cp));[m
[31m-      result[2] = static_cast<char>(0x80 | (0x3f & (cp >> 6)));[m
[31m-      result[1] = static_cast<char>(0x80 | (0x3f & (cp >> 12)));[m
[31m-      result[0] = static_cast<char>(0xF0 | (0x7 & (cp >> 18)));[m
[31m-   }[m
[31m-[m
[31m-   return result;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// Class Reader[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-Reader::Reader()[m
[31m-   : features_( Features::all() )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Reader::Reader( const Features &features )[m
[31m-   : features_( features )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool[m
[31m-Reader::parse( const std::string &document, [m
[31m-               Value &root,[m
[31m-               bool collectComments )[m
[31m-{[m
[31m-   document_ = document;[m
[31m-   const char *begin = document_.c_str();[m
[31m-   const char *end = begin + document_.length();[m
[31m-   return parse( begin, end, root, collectComments );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool[m
[31m-Reader::parse( std::istream& sin,[m
[31m-               Value &root,[m
[31m-               bool collectComments )[m
[31m-{[m
[31m-   //std::istream_iterator<char> begin(sin);[m
[31m-   //std::istream_iterator<char> end;[m
[31m-   // Those would allow streamed input from a file, if parse() were a[m
[31m-   // template function.[m
[31m-[m
[31m-   // Since std::string is reference-counted, this at least does not[m
[31m-   // create an extra copy.[m
[31m-   std::string doc;[m
[31m-   std::getline(sin, doc, (char)EOF);[m
[31m-   return parse( doc, root, collectComments );[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Reader::parse( const char *beginDoc, const char *endDoc, [m
[31m-               Value &root,[m
[31m-               bool collectComments )[m
[31m-{[m
[31m-   if ( !features_.allowComments_ )[m
[31m-   {[m
[31m-      collectComments = false;[m
[31m-   }[m
[31m-[m
[31m-   begin_ = beginDoc;[m
[31m-   end_ = endDoc;[m
[31m-   collectComments_ = collectComments;[m
[31m-   current_ = begin_;[m
[31m-   lastValueEnd_ = 0;[m
[31m-   lastValue_ = 0;[m
[31m-   commentsBefore_ = "";[m
[31m-   errors_.clear();[m
[31m-   while ( !nodes_.empty() )[m
[31m-      nodes_.pop();[m
[31m-   nodes_.push( &root );[m
[31m-   [m
[31m-   bool successful = readValue();[m
[31m-   Token token;[m
[31m-   skipCommentTokens( token );[m
[31m-   if ( collectComments_  &&  !commentsBefore_.empty() )[m
[31m-      root.setComment( commentsBefore_, commentAfter );[m
[31m-   if ( features_.strictRoot_ )[m
[31m-   {[m
[31m-      if ( !root.isArray()  &&  !root.isObject() )[m
[31m-      {[m
[31m-         // Set error location to start of doc, ideally should be first token found in doc[m
[31m-         token.type_ = tokenError;[m
[31m-         token.start_ = beginDoc;[m
[31m-         token.end_ = endDoc;[m
[31m-         addError( "A valid JSON document must be either an array or an object value.",[m
[31m-                   token );[m
[31m-         return false;[m
[31m-      }[m
[31m-   }[m
[31m-   return successful;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool[m
[31m-Reader::readValue()[m
[31m-{[m
[31m-   Token token;[m
[31m-   skipCommentTokens( token );[m
[31m-   bool successful = true;[m
[31m-[m
[31m-   if ( collectComments_  &&  !commentsBefore_.empty() )[m
[31m-   {[m
[31m-      currentValue().setComment( commentsBefore_, commentBefore );[m
[31m-      commentsBefore_ = "";[m
[31m-   }[m
[31m-[m
[31m-[m
[31m-   switch ( token.type_ )[m
[31m-   {[m
[31m-   case tokenObjectBegin:[m
[31m-      successful = readObject( token );[m
[31m-      break;[m
[31m-   case tokenArrayBegin:[m
[31m-      successful = readArray( token );[m
[31m-      break;[m
[31m-   case tokenNumber:[m
[31m-      successful = decodeNumber( token );[m
[31m-      break;[m
[31m-   case tokenString:[m
[31m-      successful = decodeString( token );[m
[31m-      break;[m
[31m-   case tokenTrue:[m
[31m-      currentValue() = true;[m
[31m-      break;[m
[31m-   case tokenFalse:[m
[31m-      currentValue() = false;[m
[31m-      break;[m
[31m-   case tokenNull:[m
[31m-      currentValue() = Value();[m
[31m-      break;[m
[31m-   default:[m
[31m-      return addError( "Syntax error: value, object or array expected.", token );[m
[31m-   }[m
[31m-[m
[31m-   if ( collectComments_ )[m
[31m-   {[m
[31m-      lastValueEnd_ = current_;[m
[31m-      lastValue_ = &currentValue();[m
[31m-   }[m
[31m-[m
[31m-   return successful;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Reader::skipCommentTokens( Token &token )[m
[31m-{[m
[31m-   if ( features_.allowComments_ )[m
[31m-   {[m
[31m-      do[m
[31m-      {[m
[31m-         readToken( token );[m
[31m-      }[m
[31m-      while ( token.type_ == tokenComment );[m
[31m-   }[m
[31m-   else[m
[31m-   {[m
[31m-      readToken( token );[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::expectToken( TokenType type, Token &token, const char *message )[m
[31m-{[m
[31m-   readToken( token );[m
[31m-   if ( token.type_ != type )[m
[31m-      return addError( message, token );[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::readToken( Token &token )[m
[31m-{[m
[31m-   skipSpaces();[m
[31m-   token.start_ = current_;[m
[31m-   Char c = getNextChar();[m
[31m-   bool ok = true;[m
[31m-   switch ( c )[m
[31m-   {[m
[31m-   case '{':[m
[31m-      token.type_ = tokenObjectBegin;[m
[31m-      break;[m
[31m-   case '}':[m
[31m-      token.type_ = tokenObjectEnd;[m
[31m-      break;[m
[31m-   case '[':[m
[31m-      token.type_ = tokenArrayBegin;[m
[31m-      break;[m
[31m-   case ']':[m
[31m-      token.type_ = tokenArrayEnd;[m
[31m-      break;[m
[31m-   case '"':[m
[31m-      token.type_ = tokenString;[m
[31m-      ok = readString();[m
[31m-      break;[m
[31m-   case '/':[m
[31m-      token.type_ = tokenComment;[m
[31m-      ok = readComment();[m
[31m-      break;[m
[31m-   case '0':[m
[31m-   case '1':[m
[31m-   case '2':[m
[31m-   case '3':[m
[31m-   case '4':[m
[31m-   case '5':[m
[31m-   case '6':[m
[31m-   case '7':[m
[31m-   case '8':[m
[31m-   case '9':[m
[31m-   case '-':[m
[31m-      token.type_ = tokenNumber;[m
[31m-      readNumber();[m
[31m-      break;[m
[31m-   case 't':[m
[31m-      token.type_ = tokenTrue;[m
[31m-      ok = match( "rue", 3 );[m
[31m-      break;[m
[31m-   case 'f':[m
[31m-      token.type_ = tokenFalse;[m
[31m-      ok = match( "alse", 4 );[m
[31m-      break;[m
[31m-   case 'n':[m
[31m-      token.type_ = tokenNull;[m
[31m-      ok = match( "ull", 3 );[m
[31m-      break;[m
[31m-   case ',':[m
[31m-      token.type_ = tokenArraySeparator;[m
[31m-      break;[m
[31m-   case ':':[m
[31m-      token.type_ = tokenMemberSeparator;[m
[31m-      break;[m
[31m-   case 0:[m
[31m-      token.type_ = tokenEndOfStream;[m
[31m-      break;[m
[31m-   default:[m
[31m-      ok = false;[m
[31m-      break;[m
[31m-   }[m
[31m-   if ( !ok )[m
[31m-      token.type_ = tokenError;[m
[31m-   token.end_ = current_;[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Reader::skipSpaces()[m
[31m-{[m
[31m-   while ( current_ != end_ )[m
[31m-   {[m
[31m-      Char c = *current_;[m
[31m-      if ( c == ' '  ||  c == '\t'  ||  c == '\r'  ||  c == '\n' )[m
[31m-         ++current_;[m
[31m-      else[m
[31m-         break;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::match( Location pattern, [m
[31m-               int patternLength )[m
[31m-{[m
[31m-   if ( end_ - current_ < patternLength )[m
[31m-      return false;[m
[31m-   int index = patternLength;[m
[31m-   while ( index-- )[m
[31m-      if ( current_[index] != pattern[index] )[m
[31m-         return false;[m
[31m-   current_ += patternLength;[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool[m
[31m-Reader::readComment()[m
[31m-{[m
[31m-   Location commentBegin = current_ - 1;[m
[31m-   Char c = getNextChar();[m
[31m-   bool successful = false;[m
[31m-   if ( c == '*' )[m
[31m-      successful = readCStyleComment();[m
[31m-   else if ( c == '/' )[m
[31m-      successful = readCppStyleComment();[m
[31m-   if ( !successful )[m
[31m-      return false;[m
[31m-[m
[31m-   if ( collectComments_ )[m
[31m-   {[m
[31m-      CommentPlacement placement = commentBefore;[m
[31m-      if ( lastValueEnd_  &&  !containsNewLine( lastValueEnd_, commentBegin ) )[m
[31m-      {[m
[31m-         if ( c != '*'  ||  !containsNewLine( commentBegin, current_ ) )[m
[31m-            placement = commentAfterOnSameLine;[m
[31m-      }[m
[31m-[m
[31m-      addComment( commentBegin, current_, placement );[m
[31m-   }[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Reader::addComment( Location begin, [m
[31m-                    Location end, [m
[31m-                    CommentPlacement placement )[m
[31m-{[m
[31m-   assert( collectComments_ );[m
[31m-   if ( placement == commentAfterOnSameLine )[m
[31m-   {[m
[31m-      assert( lastValue_ != 0 );[m
[31m-      lastValue_->setComment( std::string( begin, end ), placement );[m
[31m-   }[m
[31m-   else[m
[31m-   {[m
[31m-      if ( !commentsBefore_.empty() )[m
[31m-         commentsBefore_ += "\n";[m
[31m-      commentsBefore_ += std::string( begin, end );[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::readCStyleComment()[m
[31m-{[m
[31m-   while ( current_ != end_ )[m
[31m-   {[m
[31m-      Char c = getNextChar();[m
[31m-      if ( c == '*'  &&  *current_ == '/' )[m
[31m-         break;[m
[31m-   }[m
[31m-   return getNextChar() == '/';[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::readCppStyleComment()[m
[31m-{[m
[31m-   while ( current_ != end_ )[m
[31m-   {[m
[31m-      Char c = getNextChar();[m
[31m-      if (  c == '\r'  ||  c == '\n' )[m
[31m-         break;[m
[31m-   }[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Reader::readNumber()[m
[31m-{[m
[31m-   while ( current_ != end_ )[m
[31m-   {[m
[31m-      if ( !(*current_ >= '0'  &&  *current_ <= '9')  &&[m
[31m-           !in( *current_, '.', 'e', 'E', '+', '-' ) )[m
[31m-         break;[m
[31m-      ++current_;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-bool[m
[31m-Reader::readString()[m
[31m-{[m
[31m-   Char c = 0;[m
[31m-   while ( current_ != end_ )[m
[31m-   {[m
[31m-      c = getNextChar();[m
[31m-      if ( c == '\\' )[m
[31m-         getNextChar();[m
[31m-      else if ( c == '"' )[m
[31m-         break;[m
[31m-   }[m
[31m-   return c == '"';[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::readObject( Token &tokenStart )[m
[31m-{[m
[31m-   Token tokenName;[m
[31m-   std::string name;[m
[31m-   currentValue() = Value( objectValue );[m
[31m-   while ( readToken( tokenName ) )[m
[31m-   {[m
[31m-      bool initialTokenOk = true;[m
[31m-      while ( tokenName.type_ == tokenComment  &&  initialTokenOk )[m
[31m-         initialTokenOk = readToken( tokenName );[m
[31m-      if  ( !initialTokenOk )[m
[31m-         break;[m
[31m-      if ( tokenName.type_ == tokenObjectEnd  &&  name.empty() )  // empty object[m
[31m-         return true;[m
[31m-      if ( tokenName.type_ != tokenString )[m
[31m-         break;[m
[31m-      [m
[31m-      name = "";[m
[31m-      if ( !decodeString( tokenName, name ) )[m
[31m-         return recoverFromError( tokenObjectEnd );[m
[31m-[m
[31m-      Token colon;[m
[31m-      if ( !readToken( colon ) ||  colon.type_ != tokenMemberSeparator )[m
[31m-      {[m
[31m-         return addErrorAndRecover( "Missing ':' after object member name", [m
[31m-                                    colon, [m
[31m-                                    tokenObjectEnd );[m
[31m-      }[m
[31m-      Value &value = currentValue()[ name ];[m
[31m-      nodes_.push( &value );[m
[31m-      bool ok = readValue();[m
[31m-      nodes_.pop();[m
[31m-      if ( !ok ) // error already set[m
[31m-         return recoverFromError( tokenObjectEnd );[m
[31m-[m
[31m-      Token comma;[m
[31m-      if ( !readToken( comma )[m
[31m-            ||  ( comma.type_ != tokenObjectEnd  &&  [m
[31m-                  comma.type_ != tokenArraySeparator &&[m
[31m-		  comma.type_ != tokenComment ) )[m
[31m-      {[m
[31m-         return addErrorAndRecover( "Missing ',' or '}' in object declaration", [m
[31m-                                    comma, [m
[31m-                                    tokenObjectEnd );[m
[31m-      }[m
[31m-      bool finalizeTokenOk = true;[m
[31m-      while ( comma.type_ == tokenComment &&[m
[31m-              finalizeTokenOk )[m
[31m-         finalizeTokenOk = readToken( comma );[m
[31m-      if ( comma.type_ == tokenObjectEnd )[m
[31m-         return true;[m
[31m-   }[m
[31m-   return addErrorAndRecover( "Missing '}' or object member name", [m
[31m-                              tokenName, [m
[31m-                              tokenObjectEnd );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::readArray( Token &tokenStart )[m
[31m-{[m
[31m-   currentValue() = Value( arrayValue );[m
[31m-   skipSpaces();[m
[31m-   if ( *current_ == ']' ) // empty array[m
[31m-   {[m
[31m-      Token endArray;[m
[31m-      readToken( endArray );[m
[31m-      return true;[m
[31m-   }[m
[31m-   int index = 0;[m
[31m-   while ( true )[m
[31m-   {[m
[31m-      Value &value = currentValue()[ index++ ];[m
[31m-      nodes_.push( &value );[m
[31m-      bool ok = readValue();[m
[31m-      nodes_.pop();[m
[31m-      if ( !ok ) // error already set[m
[31m-         return recoverFromError( tokenArrayEnd );[m
[31m-[m
[31m-      Token token;[m
[31m-      // Accept Comment after last item in the array.[m
[31m-      ok = readToken( token );[m
[31m-      while ( token.type_ == tokenComment  &&  ok )[m
[31m-      {[m
[31m-         ok = readToken( token );[m
[31m-      }[m
[31m-      bool badTokenType = ( token.type_ == tokenArraySeparator  &&  [m
[31m-                            token.type_ == tokenArrayEnd );[m
[31m-      if ( !ok  ||  badTokenType )[m
[31m-      {[m
[31m-         return addErrorAndRecover( "Missing ',' or ']' in array declaration", [m
[31m-                                    token, [m
[31m-                                    tokenArrayEnd );[m
[31m-      }[m
[31m-      if ( token.type_ == tokenArrayEnd )[m
[31m-         break;[m
[31m-   }[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::decodeNumber( Token &token )[m
[31m-{[m
[31m-   bool isDouble = false;[m
[31m-   for ( Location inspect = token.start_; inspect != token.end_; ++inspect )[m
[31m-   {[m
[31m-      isDouble = isDouble  [m
[31m-                 ||  in( *inspect, '.', 'e', 'E', '+' )  [m
[31m-                 ||  ( *inspect == '-'  &&  inspect != token.start_ );[m
[31m-   }[m
[31m-   if ( isDouble )[m
[31m-      return decodeDouble( token );[m
[31m-   Location current = token.start_;[m
[31m-   bool isNegative = *current == '-';[m
[31m-   if ( isNegative )[m
[31m-      ++current;[m
[31m-   Value::UInt threshold = (isNegative ? Value::UInt(-Value::minInt) [m
[31m-                                       : Value::maxUInt) / 10;[m
[31m-   Value::UInt value = 0;[m
[31m-   while ( current < token.end_ )[m
[31m-   {[m
[31m-      Char c = *current++;[m
[31m-      if ( c < '0'  ||  c > '9' )[m
[31m-         return addError( "'" + std::string( token.start_, token.end_ ) + "' is not a number.", token );[m
[31m-      if ( value >= threshold )[m
[31m-         return decodeDouble( token );[m
[31m-      value = value * 10 + Value::UInt(c - '0');[m
[31m-   }[m
[31m-   if ( isNegative )[m
[31m-      currentValue() = -Value::Int( value );[m
[31m-   else if ( value <= Value::UInt(Value::maxInt) )[m
[31m-      currentValue() = Value::Int( value );[m
[31m-   else[m
[31m-      currentValue() = value;[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::decodeDouble( Token &token )[m
[31m-{[m
[31m-   double value = 0;[m
[31m-   const int bufferSize = 32;[m
[31m-   int count;[m
[31m-   int length = int(token.end_ - token.start_);[m
[31m-   if ( length <= bufferSize )[m
[31m-   {[m
[31m-      Char buffer[bufferSize];[m
[31m-      memcpy( buffer, token.start_, length );[m
[31m-      buffer[length] = 0;[m
[31m-      count = sscanf( buffer, "%lf", &value );[m
[31m-   }[m
[31m-   else[m
[31m-   {[m
[31m-      std::string buffer( token.start_, token.end_ );[m
[31m-      count = sscanf( buffer.c_str(), "%lf", &value );[m
[31m-   }[m
[31m-[m
[31m-   if ( count != 1 )[m
[31m-      return addError( "'" + std::string( token.start_, token.end_ ) + "' is not a number.", token );[m
[31m-   currentValue() = value;[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::decodeString( Token &token )[m
[31m-{[m
[31m-   std::string decoded;[m
[31m-   if ( !decodeString( token, decoded ) )[m
[31m-      return false;[m
[31m-   currentValue() = decoded;[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::decodeString( Token &token, std::string &decoded )[m
[31m-{[m
[31m-   decoded.reserve( token.end_ - token.start_ - 2 );[m
[31m-   Location current = token.start_ + 1; // skip '"'[m
[31m-   Location end = token.end_ - 1;      // do not include '"'[m
[31m-   while ( current != end )[m
[31m-   {[m
[31m-      Char c = *current++;[m
[31m-      if ( c == '"' )[m
[31m-         break;[m
[31m-      else if ( c == '\\' )[m
[31m-      {[m
[31m-         if ( current == end )[m
[31m-            return addError( "Empty escape sequence in string", token, current );[m
[31m-         Char escape = *current++;[m
[31m-         switch ( escape )[m
[31m-         {[m
[31m-         case '"': decoded += '"'; break;[m
[31m-         case '/': decoded += '/'; break;[m
[31m-         case '\\': decoded += '\\'; break;[m
[31m-         case 'b': decoded += '\b'; break;[m
[31m-         case 'f': decoded += '\f'; break;[m
[31m-         case 'n': decoded += '\n'; break;[m
[31m-         case 'r': decoded += '\r'; break;[m
[31m-         case 't': decoded += '\t'; break;[m
[31m-         case 'u':[m
[31m-            {[m
[31m-               unsigned int unicode;[m
[31m-               if ( !decodeUnicodeCodePoint( token, current, end, unicode ) )[m
[31m-                  return false;[m
[31m-               decoded += codePointToUTF8(unicode);[m
[31m-            }[m
[31m-            break;[m
[31m-         default:[m
[31m-            return addError( "Bad escape sequence in string", token, current );[m
[31m-         }[m
[31m-      }[m
[31m-      else[m
[31m-      {[m
[31m-         decoded += c;[m
[31m-      }[m
[31m-   }[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-bool[m
[31m-Reader::decodeUnicodeCodePoint( Token &token, [m
[31m-                                     Location &current, [m
[31m-                                     Location end, [m
[31m-                                     unsigned int &unicode )[m
[31m-{[m
[31m-[m
[31m-   if ( !decodeUnicodeEscapeSequence( token, current, end, unicode ) )[m
[31m-      return false;[m
[31m-   if (unicode >= 0xD800 && unicode <= 0xDBFF)[m
[31m-   {[m
[31m-      // surrogate pairs[m
[31m-      if (end - current < 6)[m
[31m-         return addError( "additional six characters expected to parse unicode surrogate pair.", token, current );[m
[31m-      unsigned int surrogatePair;[m
[31m-      if (*(current++) == '\\' && *(current++)== 'u')[m
[31m-      {[m
[31m-         if (decodeUnicodeEscapeSequence( token, current, end, surrogatePair ))[m
[31m-         {[m
[31m-            unicode = 0x10000 + ((unicode & 0x3FF) << 10) + (surrogatePair & 0x3FF);[m
[31m-         } [m
[31m-         else[m
[31m-            return false;[m
[31m-      } [m
[31m-      else[m
[31m-         return addError( "expecting another \\u token to begin the second half of a unicode surrogate pair", token, current );[m
[31m-   }[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Reader::decodeUnicodeEscapeSequence( Token &token, [m
[31m-                                     Location &current, [m
[31m-                                     Location end, [m
[31m-                                     unsigned int &unicode )[m
[31m-{[m
[31m-   if ( end - current < 4 )[m
[31m-      return addError( "Bad unicode escape sequence in string: four digits expected.", token, current );[m
[31m-   unicode = 0;[m
[31m-   for ( int index =0; index < 4; ++index )[m
[31m-   {[m
[31m-      Char c = *current++;[m
[31m-      unicode *= 16;[m
[31m-      if ( c >= '0'  &&  c <= '9' )[m
[31m-         unicode += c - '0';[m
[31m-      else if ( c >= 'a'  &&  c <= 'f' )[m
[31m-         unicode += c - 'a' + 10;[m
[31m-      else if ( c >= 'A'  &&  c <= 'F' )[m
[31m-         unicode += c - 'A' + 10;[m
[31m-      else[m
[31m-         return addError( "Bad unicode escape sequence in string: hexadecimal digit expected.", token, current );[m
[31m-   }[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::addError( const std::string &message, [m
[31m-                  Token &token,[m
[31m-                  Location extra )[m
[31m-{[m
[31m-   ErrorInfo info;[m
[31m-   info.token_ = token;[m
[31m-   info.message_ = message;[m
[31m-   info.extra_ = extra;[m
[31m-   errors_.push_back( info );[m
[31m-   return false;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::recoverFromError( TokenType skipUntilToken )[m
[31m-{[m
[31m-   int errorCount = int(errors_.size());[m
[31m-   Token skip;[m
[31m-   while ( true )[m
[31m-   {[m
[31m-      if ( !readToken(skip) )[m
[31m-         errors_.resize( errorCount ); // discard errors caused by recovery[m
[31m-      if ( skip.type_ == skipUntilToken  ||  skip.type_ == tokenEndOfStream )[m
[31m-         break;[m
[31m-   }[m
[31m-   errors_.resize( errorCount );[m
[31m-   return false;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::addErrorAndRecover( const std::string &message, [m
[31m-                            Token &token,[m
[31m-                            TokenType skipUntilToken )[m
[31m-{[m
[31m-   addError( message, token );[m
[31m-   return recoverFromError( skipUntilToken );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Reader::currentValue()[m
[31m-{[m
[31m-   return *(nodes_.top());[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Reader::Char [m
[31m-Reader::getNextChar()[m
[31m-{[m
[31m-   if ( current_ == end_ )[m
[31m-      return 0;[m
[31m-   return *current_++;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Reader::getLocationLineAndColumn( Location location,[m
[31m-                                  int &line,[m
[31m-                                  int &column ) const[m
[31m-{[m
[31m-   Location current = begin_;[m
[31m-   Location lastLineStart = current;[m
[31m-   line = 0;[m
[31m-   while ( current < location  &&  current != end_ )[m
[31m-   {[m
[31m-      Char c = *current++;[m
[31m-      if ( c == '\r' )[m
[31m-      {[m
[31m-         if ( *current == '\n' )[m
[31m-            ++current;[m
[31m-         lastLineStart = current;[m
[31m-         ++line;[m
[31m-      }[m
[31m-      else if ( c == '\n' )[m
[31m-      {[m
[31m-         lastLineStart = current;[m
[31m-         ++line;[m
[31m-      }[m
[31m-   }[m
[31m-   // column & line start at 1[m
[31m-   column = int(location - lastLineStart) + 1;[m
[31m-   ++line;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string[m
[31m-Reader::getLocationLineAndColumn( Location location ) const[m
[31m-{[m
[31m-   int line, column;[m
[31m-   getLocationLineAndColumn( location, line, column );[m
[31m-   char buffer[18+16+16+1];[m
[31m-   sprintf( buffer, "Line %d, Column %d", line, column );[m
[31m-   return buffer;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-Reader::getFormatedErrorMessages() const[m
[31m-{[m
[31m-   std::string formattedMessage;[m
[31m-   for ( Errors::const_iterator itError = errors_.begin();[m
[31m-         itError != errors_.end();[m
[31m-         ++itError )[m
[31m-   {[m
[31m-      const ErrorInfo &error = *itError;[m
[31m-      formattedMessage += "* " + getLocationLineAndColumn( error.token_.start_ ) + "\n";[m
[31m-      formattedMessage += "  " + error.message_ + "\n";[m
[31m-      if ( error.extra_ )[m
[31m-         formattedMessage += "See " + getLocationLineAndColumn( error.extra_ ) + " for detail.\n";[m
[31m-   }[m
[31m-   return formattedMessage;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::istream& operator>>( std::istream &sin, Value &root )[m
[31m-{[m
[31m-    Json::Reader reader;[m
[31m-    bool ok = reader.parse(sin, root, true);[m
[31m-    //JSON_ASSERT( ok );[m
[31m-    if (!ok) throw std::runtime_error(reader.getFormatedErrorMessages());[m
[31m-    return sin;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-} // namespace Json[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_value.cpp b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_value.cpp[m
[1mdeleted file mode 100644[m
[1mindex 6e5dcd3..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_value.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,1726 +0,0 @@[m
[31m-#include <iostream>[m
[31m-#include <json/value.h>[m
[31m-#include <json/writer.h>[m
[31m-#include <utility>[m
[31m-#include <stdexcept>[m
[31m-#include <cstring>[m
[31m-#include <cassert>[m
[31m-#ifdef JSON_USE_CPPTL[m
[31m-# include <cpptl/conststring.h>[m
[31m-#endif[m
[31m-#include <cstddef>    // size_t[m
[31m-#ifndef JSON_USE_SIMPLE_INTERNAL_ALLOCATOR[m
[31m-# include "json_batchallocator.h"[m
[31m-#endif // #ifndef JSON_USE_SIMPLE_INTERNAL_ALLOCATOR[m
[31m-[m
[31m-#define JSON_ASSERT_UNREACHABLE assert( false )[m
[31m-#define JSON_ASSERT( condition ) assert( condition );  // @todo <= change this into an exception throw[m
[31m-#define JSON_ASSERT_MESSAGE( condition, message ) if (!( condition )) throw std::runtime_error( message );[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-// QNX is strict about declaring C symbols in the std namespace.[m
[31m-#ifdef __QNXNTO__[m
[31m-using std::memcpy;[m
[31m-using std::strchr;[m
[31m-using std::strcmp;[m
[31m-using std::strlen;[m
[31m-#endif[m
[31m-[m
[31m-const Value Value::null;[m
[31m-const Int Value::minInt = Int( ~(UInt(-1)/2) );[m
[31m-const Int Value::maxInt = Int( UInt(-1)/2 );[m
[31m-const UInt Value::maxUInt = UInt(-1);[m
[31m-[m
[31m-// A "safe" implementation of strdup. Allow null pointer to be passed. [m
[31m-// Also avoid warning on msvc80.[m
[31m-//[m
[31m-//inline char *safeStringDup( const char *czstring )[m
[31m-//{[m
[31m-//   if ( czstring )[m
[31m-//   {[m
[31m-//      const size_t length = (unsigned int)( strlen(czstring) + 1 );[m
[31m-//      char *newString = static_cast<char *>( malloc( length ) );[m
[31m-//      memcpy( newString, czstring, length );[m
[31m-//      return newString;[m
[31m-//   }[m
[31m-//   return 0;[m
[31m-//}[m
[31m-//[m
[31m-//inline char *safeStringDup( const std::string &str )[m
[31m-//{[m
[31m-//   if ( !str.empty() )[m
[31m-//   {[m
[31m-//      const size_t length = str.length();[m
[31m-//      char *newString = static_cast<char *>( malloc( length + 1 ) );[m
[31m-//      memcpy( newString, str.c_str(), length );[m
[31m-//      newString[length] = 0;[m
[31m-//      return newString;[m
[31m-//   }[m
[31m-//   return 0;[m
[31m-//}[m
[31m-[m
[31m-ValueAllocator::~ValueAllocator()[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-class DefaultValueAllocator : public ValueAllocator[m
[31m-{[m
[31m-public:[m
[31m-   virtual ~DefaultValueAllocator()[m
[31m-   {[m
[31m-   }[m
[31m-[m
[31m-   virtual char *makeMemberName( const char *memberName )[m
[31m-   {[m
[31m-      return duplicateStringValue( memberName );[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseMemberName( char *memberName )[m
[31m-   {[m
[31m-      releaseStringValue( memberName );[m
[31m-   }[m
[31m-[m
[31m-   virtual char *duplicateStringValue( const char *value, [m
[31m-                                       unsigned int length = unknown )[m
[31m-   {[m
[31m-      //@todo invesgate this old optimization[m
[31m-      //if ( !value  ||  value[0] == 0 )[m
[31m-      //   return 0;[m
[31m-[m
[31m-      if ( length == unknown )[m
[31m-         length = (unsigned int)strlen(value);[m
[31m-      char *newString = static_cast<char *>( malloc( length + 1 ) );[m
[31m-      memcpy( newString, value, length );[m
[31m-      newString[length] = 0;[m
[31m-      return newString;[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseStringValue( char *value )[m
[31m-   {[m
[31m-      if ( value )[m
[31m-         free( value );[m
[31m-   }[m
[31m-};[m
[31m-[m
[31m-static ValueAllocator *&valueAllocator()[m
[31m-{[m
[31m-   static DefaultValueAllocator defaultAllocator;[m
[31m-   static ValueAllocator *valueAllocator = &defaultAllocator;[m
[31m-   return valueAllocator;[m
[31m-}[m
[31m-[m
[31m-static struct DummyValueAllocatorInitializer {[m
[31m-   DummyValueAllocatorInitializer() [m
[31m-   {[m
[31m-      valueAllocator();      // ensure valueAllocator() statics are initialized before main().[m
[31m-   }[m
[31m-} dummyValueAllocatorInitializer;[m
[31m-[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// ValueInternals...[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-# include "json_internalarray.inl"[m
[31m-# include "json_internalmap.inl"[m
[31m-#endif // JSON_VALUE_USE_INTERNAL_MAP[m
[31m-[m
[31m-# include "json_valueiterator.inl"[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class Value::CommentInfo[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-[m
[31m-Value::CommentInfo::CommentInfo()[m
[31m-   : comment_( 0 )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-Value::CommentInfo::~CommentInfo()[m
[31m-{[m
[31m-   if ( comment_ )[m
[31m-      valueAllocator()->releaseStringValue( comment_ );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Value::CommentInfo::setComment( const char *text )[m
[31m-{[m
[31m-   if ( comment_ )[m
[31m-      valueAllocator()->releaseStringValue( comment_ );[m
[31m-   JSON_ASSERT( text );[m
[31m-   JSON_ASSERT_MESSAGE( text[0]=='\0' || text[0]=='/', "Comments must start with /");[m
[31m-   // It seems that /**/ style comments are acceptable as well.[m
[31m-   comment_ = valueAllocator()->duplicateStringValue( text );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class Value::CZString[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-# ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-[m
[31m-// Notes: index_ indicates if the string was allocated when[m
[31m-// a string is stored.[m
[31m-[m
[31m-Value::CZString::CZString( int index )[m
[31m-   : cstr_( 0 )[m
[31m-   , index_( index )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-Value::CZString::CZString( const char *cstr, DuplicationPolicy allocate )[m
[31m-   : cstr_( allocate == duplicate ? valueAllocator()->makeMemberName(cstr) [m
[31m-                                  : cstr )[m
[31m-   , index_( allocate )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-Value::CZString::CZString( const CZString &other )[m
[31m-: cstr_( other.index_ != noDuplication &&  other.cstr_ != 0[m
[31m-                ?  valueAllocator()->makeMemberName( other.cstr_ )[m
[31m-                : other.cstr_ )[m
[31m-   , index_( other.cstr_ ? (other.index_ == noDuplication ? noDuplication : duplicate)[m
[31m-                         : other.index_ )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-Value::CZString::~CZString()[m
[31m-{[m
[31m-   if ( cstr_  &&  index_ == duplicate )[m
[31m-      valueAllocator()->releaseMemberName( const_cast<char *>( cstr_ ) );[m
[31m-}[m
[31m-[m
[31m-void [m
[31m-Value::CZString::swap( CZString &other )[m
[31m-{[m
[31m-   std::swap( cstr_, other.cstr_ );[m
[31m-   std::swap( index_, other.index_ );[m
[31m-}[m
[31m-[m
[31m-Value::CZString &[m
[31m-Value::CZString::operator =( const CZString &other )[m
[31m-{[m
[31m-   CZString temp( other );[m
[31m-   swap( temp );[m
[31m-   return *this;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::CZString::operator<( const CZString &other ) const [m
[31m-{[m
[31m-   if ( cstr_ )[m
[31m-      return strcmp( cstr_, other.cstr_ ) < 0;[m
[31m-   return index_ < other.index_;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::CZString::operator==( const CZString &other ) const [m
[31m-{[m
[31m-   if ( cstr_ )[m
[31m-      return strcmp( cstr_, other.cstr_ ) == 0;[m
[31m-   return index_ == other.index_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-int [m
[31m-Value::CZString::index() const[m
[31m-{[m
[31m-   return index_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const char *[m
[31m-Value::CZString::c_str() const[m
[31m-{[m
[31m-   return cstr_;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::CZString::isStaticString() const[m
[31m-{[m
[31m-   return index_ == noDuplication;[m
[31m-}[m
[31m-[m
[31m-#endif // ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class Value::Value[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-/*! \internal Default constructor initialization must be equivalent to:[m
[31m- * memset( this, 0, sizeof(Value) )[m
[31m- * This optimization is used in ValueInternalMap fast allocator.[m
[31m- */[m
[31m-Value::Value( ValueType type )[m
[31m-   : type_( type )[m
[31m-   , allocated_( 0 )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   switch ( type )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      break;[m
[31m-   case intValue:[m
[31m-   case uintValue:[m
[31m-      value_.int_ = 0;[m
[31m-      break;[m
[31m-   case realValue:[m
[31m-      value_.real_ = 0.0;[m
[31m-      break;[m
[31m-   case stringValue:[m
[31m-      value_.string_ = 0;[m
[31m-      break;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      value_.map_ = new ObjectValues();[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      value_.array_ = arrayAllocator()->newArray();[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      value_.map_ = mapAllocator()->newMap();[m
[31m-      break;[m
[31m-#endif[m
[31m-   case booleanValue:[m
[31m-      value_.bool_ = false;[m
[31m-      break;[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::Value( Int value )[m
[31m-   : type_( intValue )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.int_ = value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::Value( UInt value )[m
[31m-   : type_( uintValue )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.uint_ = value;[m
[31m-}[m
[31m-[m
[31m-Value::Value( double value )[m
[31m-   : type_( realValue )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.real_ = value;[m
[31m-}[m
[31m-[m
[31m-Value::Value( const char *value )[m
[31m-   : type_( stringValue )[m
[31m-   , allocated_( true )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.string_ = valueAllocator()->duplicateStringValue( value );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::Value( const char *beginValue, [m
[31m-              const char *endValue )[m
[31m-   : type_( stringValue )[m
[31m-   , allocated_( true )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.string_ = valueAllocator()->duplicateStringValue( beginValue, [m
[31m-                                                            UInt(endValue - beginValue) );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::Value( const std::string &value )[m
[31m-   : type_( stringValue )[m
[31m-   , allocated_( true )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.string_ = valueAllocator()->duplicateStringValue( value.c_str(), [m
[31m-                                                            (unsigned int)value.length() );[m
[31m-[m
[31m-}[m
[31m-[m
[31m-Value::Value( const StaticString &value )[m
[31m-   : type_( stringValue )[m
[31m-   , allocated_( false )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.string_ = const_cast<char *>( value.c_str() );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-Value::Value( const CppTL::ConstString &value )[m
[31m-   : type_( stringValue )[m
[31m-   , allocated_( true )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.string_ = valueAllocator()->duplicateStringValue( value, value.length() );[m
[31m-}[m
[31m-# endif[m
[31m-[m
[31m-Value::Value( bool value )[m
[31m-   : type_( booleanValue )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.bool_ = value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::Value( const Value &other )[m
[31m-   : type_( other.type_ )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-   case intValue:[m
[31m-   case uintValue:[m
[31m-   case realValue:[m
[31m-   case booleanValue:[m
[31m-      value_ = other.value_;[m
[31m-      break;[m
[31m-   case stringValue:[m
[31m-      if ( other.value_.string_ )[m
[31m-      {[m
[31m-         value_.string_ = valueAllocator()->duplicateStringValue( other.value_.string_ );[m
[31m-         allocated_ = true;[m
[31m-      }[m
[31m-      else[m
[31m-         value_.string_ = 0;[m
[31m-      break;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      value_.map_ = new ObjectValues( *other.value_.map_ );[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      value_.array_ = arrayAllocator()->newArrayCopy( *other.value_.array_ );[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      value_.map_ = mapAllocator()->newMapCopy( *other.value_.map_ );[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   if ( other.comments_ )[m
[31m-   {[m
[31m-      comments_ = new CommentInfo[numberOfCommentPlacement];[m
[31m-      for ( int comment =0; comment < numberOfCommentPlacement; ++comment )[m
[31m-      {[m
[31m-         const CommentInfo &otherComment = other.comments_[comment];[m
[31m-         if ( otherComment.comment_ )[m
[31m-            comments_[comment].setComment( otherComment.comment_ );[m
[31m-      }[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::~Value()[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-   case intValue:[m
[31m-   case uintValue:[m
[31m-   case realValue:[m
[31m-   case booleanValue:[m
[31m-      break;[m
[31m-   case stringValue:[m
[31m-      if ( allocated_ )[m
[31m-         valueAllocator()->releaseStringValue( value_.string_ );[m
[31m-      break;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      delete value_.map_;[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      arrayAllocator()->destructArray( value_.array_ );[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      mapAllocator()->destructMap( value_.map_ );[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-[m
[31m-   if ( comments_ )[m
[31m-      delete[] comments_;[m
[31m-}[m
[31m-[m
[31m-Value &[m
[31m-Value::operator=( const Value &other )[m
[31m-{[m
[31m-   Value temp( other );[m
[31m-   swap( temp );[m
[31m-   return *this;[m
[31m-}[m
[31m-[m
[31m-void [m
[31m-Value::swap( Value &other )[m
[31m-{[m
[31m-   ValueType temp = type_;[m
[31m-   type_ = other.type_;[m
[31m-   other.type_ = temp;[m
[31m-   std::swap( value_, other.value_ );[m
[31m-   int temp2 = allocated_;[m
[31m-   allocated_ = other.allocated_;[m
[31m-   other.allocated_ = temp2;[m
[31m-}[m
[31m-[m
[31m-ValueType [m
[31m-Value::type() const[m
[31m-{[m
[31m-   return type_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-int [m
[31m-Value::compare( const Value &other )[m
[31m-{[m
[31m-   /*[m
[31m-   int typeDelta = other.type_ - type_;[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-[m
[31m-      return other.type_ == type_;[m
[31m-   case intValue:[m
[31m-      if ( other.type_.isNumeric()[m
[31m-   case uintValue:[m
[31m-   case realValue:[m
[31m-   case booleanValue:[m
[31m-      break;[m
[31m-   case stringValue,[m
[31m-      break;[m
[31m-   case arrayValue:[m
[31m-      delete value_.array_;[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      delete value_.map_;[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   */[m
[31m-   return 0;  // unreachable[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::operator <( const Value &other ) const[m
[31m-{[m
[31m-   int typeDelta = type_ - other.type_;[m
[31m-   if ( typeDelta )[m
[31m-      return typeDelta < 0 ? true : false;[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return false;[m
[31m-   case intValue:[m
[31m-      return value_.int_ < other.value_.int_;[m
[31m-   case uintValue:[m
[31m-      return value_.uint_ < other.value_.uint_;[m
[31m-   case realValue:[m
[31m-      return value_.real_ < other.value_.real_;[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_ < other.value_.bool_;[m
[31m-   case stringValue:[m
[31m-      return ( value_.string_ == 0  &&  other.value_.string_ )[m
[31m-             || ( other.value_.string_  [m
[31m-                  &&  value_.string_  [m
[31m-                  && strcmp( value_.string_, other.value_.string_ ) < 0 );[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      {[m
[31m-         int delta = int( value_.map_->size() - other.value_.map_->size() );[m
[31m-         if ( delta )[m
[31m-            return delta < 0;[m
[31m-         return (*value_.map_) < (*other.value_.map_);[m
[31m-      }[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      return value_.array_->compare( *(other.value_.array_) ) < 0;[m
[31m-   case objectValue:[m
[31m-      return value_.map_->compare( *(other.value_.map_) ) < 0;[m
[31m-#endif[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return 0;  // unreachable[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::operator <=( const Value &other ) const[m
[31m-{[m
[31m-   return !(other > *this);[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::operator >=( const Value &other ) const[m
[31m-{[m
[31m-   return !(*this < other);[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::operator >( const Value &other ) const[m
[31m-{[m
[31m-   return other < *this;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::operator ==( const Value &other ) const[m
[31m-{[m
[31m-   //if ( type_ != other.type_ )[m
[31m-   // GCC 2.95.3 says:[m
[31m-   // attempt to take address of bit-field structure member `Json::Value::type_'[m
[31m-   // Beats me, but a temp solves the problem.[m
[31m-   int temp = other.type_;[m
[31m-   if ( type_ != temp )[m
[31m-      return false;[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return true;[m
[31m-   case intValue:[m
[31m-      return value_.int_ == other.value_.int_;[m
[31m-   case uintValue:[m
[31m-      return value_.uint_ == other.value_.uint_;[m
[31m-   case realValue:[m
[31m-      return value_.real_ == other.value_.real_;[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_ == other.value_.bool_;[m
[31m-   case stringValue:[m
[31m-      return ( value_.string_ == other.value_.string_ )[m
[31m-             || ( other.value_.string_  [m
[31m-                  &&  value_.string_  [m
[31m-                  && strcmp( value_.string_, other.value_.string_ ) == 0 );[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      return value_.map_->size() == other.value_.map_->size()[m
[31m-             && (*value_.map_) == (*other.value_.map_);[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      return value_.array_->compare( *(other.value_.array_) ) == 0;[m
[31m-   case objectValue:[m
[31m-      return value_.map_->compare( *(other.value_.map_) ) == 0;[m
[31m-#endif[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return 0;  // unreachable[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::operator !=( const Value &other ) const[m
[31m-{[m
[31m-   return !( *this == other );[m
[31m-}[m
[31m-[m
[31m-const char *[m
[31m-Value::asCString() const[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == stringValue );[m
[31m-   return value_.string_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-Value::asString() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return "";[m
[31m-   case stringValue:[m
[31m-      return value_.string_ ? value_.string_ : "";[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_ ? "true" : "false";[m
[31m-   case intValue:[m
[31m-   case uintValue:[m
[31m-   case realValue:[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      JSON_ASSERT_MESSAGE( false, "Type is not convertible to string" );[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return ""; // unreachable[m
[31m-}[m
[31m-[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-CppTL::ConstString [m
[31m-Value::asConstString() const[m
[31m-{[m
[31m-   return CppTL::ConstString( asString().c_str() );[m
[31m-}[m
[31m-# endif[m
[31m-[m
[31m-Value::Int [m
[31m-Value::asInt() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return 0;[m
[31m-   case intValue:[m
[31m-      return value_.int_;[m
[31m-   case uintValue:[m
[31m-      JSON_ASSERT_MESSAGE( value_.uint_ < (unsigned)maxInt, "integer out of signed integer range" );[m
[31m-      return value_.uint_;[m
[31m-   case realValue:[m
[31m-      JSON_ASSERT_MESSAGE( value_.real_ >= minInt  &&  value_.real_ <= maxInt, "Real out of signed integer range" );[m
[31m-      return Int( value_.real_ );[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_ ? 1 : 0;[m
[31m-   case stringValue:[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      JSON_ASSERT_MESSAGE( false, "Type is not convertible to int" );[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return 0; // unreachable;[m
[31m-}[m
[31m-[m
[31m-Value::UInt [m
[31m-Value::asUInt() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return 0;[m
[31m-   case intValue:[m
[31m-      JSON_ASSERT_MESSAGE( value_.int_ >= 0, "Negative integer can not be converted to unsigned integer" );[m
[31m-      return value_.int_;[m
[31m-   case uintValue:[m
[31m-      return value_.uint_;[m
[31m-   case realValue:[m
[31m-      JSON_ASSERT_MESSAGE( value_.real_ >= 0  &&  value_.real_ <= maxUInt,  "Real out of unsigned integer range" );[m
[31m-      return UInt( value_.real_ );[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_ ? 1 : 0;[m
[31m-   case stringValue:[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      JSON_ASSERT_MESSAGE( false, "Type is not convertible to uint" );[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return 0; // unreachable;[m
[31m-}[m
[31m-[m
[31m-double [m
[31m-Value::asDouble() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return 0.0;[m
[31m-   case intValue:[m
[31m-      return value_.int_;[m
[31m-   case uintValue:[m
[31m-      return value_.uint_;[m
[31m-   case realValue:[m
[31m-      return value_.real_;[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_ ? 1.0 : 0.0;[m
[31m-   case stringValue:[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      JSON_ASSERT_MESSAGE( false, "Type is not convertible to double" );[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return 0; // unreachable;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::asBool() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return false;[m
[31m-   case intValue:[m
[31m-   case uintValue:[m
[31m-      return value_.int_ != 0;[m
[31m-   case realValue:[m
[31m-      return value_.real_ != 0.0;[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_;[m
[31m-   case stringValue:[m
[31m-      return value_.string_  &&  value_.string_[0] != 0;[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      return value_.map_->size() != 0;[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return false; // unreachable;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isConvertibleTo( ValueType other ) const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return true;[m
[31m-   case intValue:[m
[31m-      return ( other == nullValue  &&  value_.int_ == 0 )[m
[31m-             || other == intValue[m
[31m-             || ( other == uintValue  && value_.int_ >= 0 )[m
[31m-             || other == realValue[m
[31m-             || other == stringValue[m
[31m-             || other == booleanValue;[m
[31m-   case uintValue:[m
[31m-      return ( other == nullValue  &&  value_.uint_ == 0 )[m
[31m-             || ( other == intValue  && value_.uint_ <= (unsigned)maxInt )[m
[31m-             || other == uintValue[m
[31m-             || other == realValue[m
[31m-             || other == stringValue[m
[31m-             || other == booleanValue;[m
[31m-   case realValue:[m
[31m-      return ( other == nullValue  &&  value_.real_ == 0.0 )[m
[31m-             || ( other == intValue  &&  value_.real_ >= minInt  &&  value_.real_ <= maxInt )[m
[31m-             || ( other == uintValue  &&  value_.real_ >= 0  &&  value_.real_ <= maxUInt )[m
[31m-             || other == realValue[m
[31m-             || other == stringValue[m
[31m-             || other == booleanValue;[m
[31m-   case booleanValue:[m
[31m-      return ( other == nullValue  &&  value_.bool_ == false )[m
[31m-             || other == intValue[m
[31m-             || other == uintValue[m
[31m-             || other == realValue[m
[31m-             || other == stringValue[m
[31m-             || other == booleanValue;[m
[31m-   case stringValue:[m
[31m-      return other == stringValue[m
[31m-             || ( other == nullValue  &&  (!value_.string_  ||  value_.string_[0] == 0) );[m
[31m-   case arrayValue:[m
[31m-      return other == arrayValue[m
[31m-             ||  ( other == nullValue  &&  value_.map_->size() == 0 );[m
[31m-   case objectValue:[m
[31m-      return other == objectValue[m
[31m-             ||  ( other == nullValue  &&  value_.map_->size() == 0 );[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return false; // unreachable;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-/// Number of values in array or object[m
[31m-Value::UInt [m
[31m-Value::size() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-   case intValue:[m
[31m-   case uintValue:[m
[31m-   case realValue:[m
[31m-   case booleanValue:[m
[31m-   case stringValue:[m
[31m-      return 0;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:  // size of the array is highest index + 1[m
[31m-      if ( !value_.map_->empty() )[m
[31m-      {[m
[31m-         ObjectValues::const_iterator itLast = value_.map_->end();[m
[31m-         --itLast;[m
[31m-         return (*itLast).first.index()+1;[m
[31m-      }[m
[31m-      return 0;[m
[31m-   case objectValue:[m
[31m-      return Int( value_.map_->size() );[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      return Int( value_.array_->size() );[m
[31m-   case objectValue:[m
[31m-      return Int( value_.map_->size() );[m
[31m-#endif[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return 0; // unreachable;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::empty() const[m
[31m-{[m
[31m-   if ( isNull() || isArray() || isObject() )[m
[31m-      return size() == 0u;[m
[31m-   else[m
[31m-      return false;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool[m
[31m-Value::operator!() const[m
[31m-{[m
[31m-   return isNull();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Value::clear()[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == arrayValue  || type_ == objectValue );[m
[31m-[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      value_.map_->clear();[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      value_.array_->clear();[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      value_.map_->clear();[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      break;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-void [m
[31m-Value::resize( UInt newSize )[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == arrayValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-      *this = Value( arrayValue );[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   UInt oldSize = size();[m
[31m-   if ( newSize == 0 )[m
[31m-      clear();[m
[31m-   else if ( newSize > oldSize )[m
[31m-      (*this)[ newSize - 1 ];[m
[31m-   else[m
[31m-   {[m
[31m-      for ( UInt index = newSize; index < oldSize; ++index )[m
[31m-         value_.map_->erase( index );[m
[31m-      assert( size() == newSize );[m
[31m-   }[m
[31m-#else[m
[31m-   value_.array_->resize( newSize );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Value::operator[]( UInt index )[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == arrayValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-      *this = Value( arrayValue );[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   CZString key( index );[m
[31m-   ObjectValues::iterator it = value_.map_->lower_bound( key );[m
[31m-   if ( it != value_.map_->end()  &&  (*it).first == key )[m
[31m-      return (*it).second;[m
[31m-[m
[31m-   ObjectValues::value_type defaultValue( key, null );[m
[31m-   it = value_.map_->insert( it, defaultValue );[m
[31m-   return (*it).second;[m
[31m-#else[m
[31m-   return value_.array_->resolveReference( index );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const Value &[m
[31m-Value::operator[]( UInt index ) const[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == arrayValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-      return null;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   CZString key( index );[m
[31m-   ObjectValues::const_iterator it = value_.map_->find( key );[m
[31m-   if ( it == value_.map_->end() )[m
[31m-      return null;[m
[31m-   return (*it).second;[m
[31m-#else[m
[31m-   Value *value = value_.array_->find( index );[m
[31m-   return value ? *value : null;[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Value::operator[]( const char *key )[m
[31m-{[m
[31m-   return resolveReference( key, false );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Value::resolveReference( const char *key, [m
[31m-                         bool isStatic )[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == objectValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-      *this = Value( objectValue );[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   CZString actualKey( key, isStatic ? CZString::noDuplication [m
[31m-                                     : CZString::duplicateOnCopy );[m
[31m-   ObjectValues::iterator it = value_.map_->lower_bound( actualKey );[m
[31m-   if ( it != value_.map_->end()  &&  (*it).first == actualKey )[m
[31m-      return (*it).second;[m
[31m-[m
[31m-   ObjectValues::value_type defaultValue( actualKey, null );[m
[31m-   it = value_.map_->insert( it, defaultValue );[m
[31m-   Value &value = (*it).second;[m
[31m-   return value;[m
[31m-#else[m
[31m-   return value_.map_->resolveReference( key, isStatic );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value [m
[31m-Value::get( UInt index, [m
[31m-            const Value &defaultValue ) const[m
[31m-{[m
[31m-   const Value *value = &((*this)[index]);[m
[31m-   return value == &null ? defaultValue : *value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isValidIndex( UInt index ) const[m
[31m-{[m
[31m-   return index < size();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-[m
[31m-const Value &[m
[31m-Value::operator[]( const char *key ) const[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == objectValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-      return null;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   CZString actualKey( key, CZString::noDuplication );[m
[31m-   ObjectValues::const_iterator it = value_.map_->find( actualKey );[m
[31m-   if ( it == value_.map_->end() )[m
[31m-      return null;[m
[31m-   return (*it).second;[m
[31m-#else[m
[31m-   const Value *value = value_.map_->find( key );[m
[31m-   return value ? *value : null;[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Value::operator[]( const std::string &key )[m
[31m-{[m
[31m-   return (*this)[ key.c_str() ];[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const Value &[m
[31m-Value::operator[]( const std::string &key ) const[m
[31m-{[m
[31m-   return (*this)[ key.c_str() ];[m
[31m-}[m
[31m-[m
[31m-Value &[m
[31m-Value::operator[]( const StaticString &key )[m
[31m-{[m
[31m-   return resolveReference( key, true );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-Value &[m
[31m-Value::operator[]( const CppTL::ConstString &key )[m
[31m-{[m
[31m-   return (*this)[ key.c_str() ];[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const Value &[m
[31m-Value::operator[]( const CppTL::ConstString &key ) const[m
[31m-{[m
[31m-   return (*this)[ key.c_str() ];[m
[31m-}[m
[31m-# endif[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Value::append( const Value &value )[m
[31m-{[m
[31m-   return (*this)[size()] = value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value [m
[31m-Value::get( const char *key, [m
[31m-            const Value &defaultValue ) const[m
[31m-{[m
[31m-   const Value *value = &((*this)[key]);[m
[31m-   return value == &null ? defaultValue : *value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value [m
[31m-Value::get( const std::string &key,[m
[31m-            const Value &defaultValue ) const[m
[31m-{[m
[31m-   return get( key.c_str(), defaultValue );[m
[31m-}[m
[31m-[m
[31m-Value[m
[31m-Value::removeMember( const char* key )[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == objectValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-      return null;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   CZString actualKey( key, CZString::noDuplication );[m
[31m-   ObjectValues::iterator it = value_.map_->find( actualKey );[m
[31m-   if ( it == value_.map_->end() )[m
[31m-      return null;[m
[31m-   Value old(it->second);[m
[31m-   value_.map_->erase(it);[m
[31m-   return old;[m
[31m-#else[m
[31m-   Value *value = value_.map_->find( key );[m
[31m-   if (value){[m
[31m-      Value old(*value);[m
[31m-      value_.map_.remove( key );[m
[31m-      return old;[m
[31m-   } else {[m
[31m-      return null;[m
[31m-   }[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-Value[m
[31m-Value::removeMember( const std::string &key )[m
[31m-{[m
[31m-   return removeMember( key.c_str() );[m
[31m-}[m
[31m-[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-Value [m
[31m-Value::get( const CppTL::ConstString &key,[m
[31m-            const Value &defaultValue ) const[m
[31m-{[m
[31m-   return get( key.c_str(), defaultValue );[m
[31m-}[m
[31m-# endif[m
[31m-[m
[31m-bool [m
[31m-Value::isMember( const char *key ) const[m
[31m-{[m
[31m-   const Value *value = &((*this)[key]);[m
[31m-   return value != &null;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isMember( const std::string &key ) const[m
[31m-{[m
[31m-   return isMember( key.c_str() );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-bool [m
[31m-Value::isMember( const CppTL::ConstString &key ) const[m
[31m-{[m
[31m-   return isMember( key.c_str() );[m
[31m-}[m
[31m-#endif[m
[31m-[m
[31m-Value::Members [m
[31m-Value::getMemberNames() const[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == objectValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-       return Value::Members();[m
[31m-   Members members;[m
[31m-   members.reserve( value_.map_->size() );[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   ObjectValues::const_iterator it = value_.map_->begin();[m
[31m-   ObjectValues::const_iterator itEnd = value_.map_->end();[m
[31m-   for ( ; it != itEnd; ++it )[m
[31m-      members.push_back( std::string( (*it).first.c_str() ) );[m
[31m-#else[m
[31m-   ValueInternalMap::IteratorState it;[m
[31m-   ValueInternalMap::IteratorState itEnd;[m
[31m-   value_.map_->makeBeginIterator( it );[m
[31m-   value_.map_->makeEndIterator( itEnd );[m
[31m-   for ( ; !ValueInternalMap::equals( it, itEnd ); ValueInternalMap::increment(it) )[m
[31m-      members.push_back( std::string( ValueInternalMap::key( it ) ) );[m
[31m-#endif[m
[31m-   return members;[m
[31m-}[m
[31m-//[m
[31m-//# ifdef JSON_USE_CPPTL[m
[31m-//EnumMemberNames[m
[31m-//Value::enumMemberNames() const[m
[31m-//{[m
[31m-//   if ( type_ == objectValue )[m
[31m-//   {[m
[31m-//      return CppTL::Enum::any(  CppTL::Enum::transform([m
[31m-//         CppTL::Enum::keys( *(value_.map_), CppTL::Type<const CZString &>() ),[m
[31m-//         MemberNamesTransform() ) );[m
[31m-//   }[m
[31m-//   return EnumMemberNames();[m
[31m-//}[m
[31m-//[m
[31m-//[m
[31m-//EnumValues [m
[31m-//Value::enumValues() const[m
[31m-//{[m
[31m-//   if ( type_ == objectValue  ||  type_ == arrayValue )[m
[31m-//      return CppTL::Enum::anyValues( *(value_.map_), [m
[31m-//                                     CppTL::Type<const Value &>() );[m
[31m-//   return EnumValues();[m
[31m-//}[m
[31m-//[m
[31m-//# endif[m
[31m-[m
[31m-[m
[31m-bool[m
[31m-Value::isNull() const[m
[31m-{[m
[31m-   return type_ == nullValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isBool() const[m
[31m-{[m
[31m-   return type_ == booleanValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isInt() const[m
[31m-{[m
[31m-   return type_ == intValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isUInt() const[m
[31m-{[m
[31m-   return type_ == uintValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isIntegral() const[m
[31m-{[m
[31m-   return type_ == intValue  [m
[31m-          ||  type_ == uintValue  [m
[31m-          ||  type_ == booleanValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isDouble() const[m
[31m-{[m
[31m-   return type_ == realValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isNumeric() const[m
[31m-{[m
[31m-   return isIntegral() || isDouble();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isString() const[m
[31m-{[m
[31m-   return type_ == stringValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isArray() const[m
[31m-{[m
[31m-   return type_ == nullValue  ||  type_ == arrayValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isObject() const[m
[31m-{[m
[31m-   return type_ == nullValue  ||  type_ == objectValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Value::setComment( const char *comment,[m
[31m-                   CommentPlacement placement )[m
[31m-{[m
[31m-   if ( !comments_ )[m
[31m-      comments_ = new CommentInfo[numberOfCommentPlacement];[m
[31m-   comments_[placement].setComment( comment );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Value::setComment( const std::string &comment,[m
[31m-                   CommentPlacement placement )[m
[31m-{[m
[31m-   setComment( comment.c_str(), placement );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::hasComment( CommentPlacement placement ) const[m
[31m-{[m
[31m-   return comments_ != 0  &&  comments_[placement].comment_ != 0;[m
[31m-}[m
[31m-[m
[31m-std::string [m
[31m-Value::getComment( CommentPlacement placement ) const[m
[31m-{[m
[31m-   if ( hasComment(placement) )[m
[31m-      return comments_[placement].comment_;[m
[31m-   return "";[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-Value::toStyledString() const[m
[31m-{[m
[31m-   StyledWriter writer;[m
[31m-   return writer.write( *this );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::const_iterator [m
[31m-Value::begin() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-      if ( value_.array_ )[m
[31m-      {[m
[31m-         ValueInternalArray::IteratorState it;[m
[31m-         value_.array_->makeBeginIterator( it );[m
[31m-         return const_iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-      {[m
[31m-         ValueInternalMap::IteratorState it;[m
[31m-         value_.map_->makeBeginIterator( it );[m
[31m-         return const_iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-         return const_iterator( value_.map_->begin() );[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      break;[m
[31m-   }[m
[31m-   return const_iterator();[m
[31m-}[m
[31m-[m
[31m-Value::const_iterator [m
[31m-Value::end() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-      if ( value_.array_ )[m
[31m-      {[m
[31m-         ValueInternalArray::IteratorState it;[m
[31m-         value_.array_->makeEndIterator( it );[m
[31m-         return const_iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-      {[m
[31m-         ValueInternalMap::IteratorState it;[m
[31m-         value_.map_->makeEndIterator( it );[m
[31m-         return const_iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-         return const_iterator( value_.map_->end() );[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      break;[m
[31m-   }[m
[31m-   return const_iterator();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::iterator [m
[31m-Value::begin()[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-      if ( value_.array_ )[m
[31m-      {[m
[31m-         ValueInternalArray::IteratorState it;[m
[31m-         value_.array_->makeBeginIterator( it );[m
[31m-         return iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-      {[m
[31m-         ValueInternalMap::IteratorState it;[m
[31m-         value_.map_->makeBeginIterator( it );[m
[31m-         return iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-         return iterator( value_.map_->begin() );[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      break;[m
[31m-   }[m
[31m-   return iterator();[m
[31m-}[m
[31m-[m
[31m-Value::iterator [m
[31m-Value::end()[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-      if ( value_.array_ )[m
[31m-      {[m
[31m-         ValueInternalArray::IteratorState it;[m
[31m-         value_.array_->makeEndIterator( it );[m
[31m-         return iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-      {[m
[31m-         ValueInternalMap::IteratorState it;[m
[31m-         value_.map_->makeEndIterator( it );[m
[31m-         return iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-         return iterator( value_.map_->end() );[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      break;[m
[31m-   }[m
[31m-   return iterator();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// class PathArgument[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-PathArgument::PathArgument()[m
[31m-   : kind_( kindNone )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-PathArgument::PathArgument( Value::UInt index )[m
[31m-   : index_( index )[m
[31m-   , kind_( kindIndex )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-PathArgument::PathArgument( const char *key )[m
[31m-   : key_( key )[m
[31m-   , kind_( kindKey )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-PathArgument::PathArgument( const std::string &key )[m
[31m-   : key_( key.c_str() )[m
[31m-   , kind_( kindKey )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-// class Path[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-Path::Path( const std::string &path,[m
[31m-            const PathArgument &a1,[m
[31m-            const PathArgument &a2,[m
[31m-            const PathArgument &a3,[m
[31m-            const PathArgument &a4,[m
[31m-            const PathArgument &a5 )[m
[31m-{[m
[31m-   InArgs in;[m
[31m-   in.push_back( &a1 );[m
[31m-   in.push_back( &a2 );[m
[31m-   in.push_back( &a3 );[m
[31m-   in.push_back( &a4 );[m
[31m-   in.push_back( &a5 );[m
[31m-   makePath( path, in );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Path::makePath( const std::string &path,[m
[31m-                const InArgs &in )[m
[31m-{[m
[31m-   const char *current = path.c_str();[m
[31m-   const char *end = current + path.length();[m
[31m-   InArgs::const_iterator itInArg = in.begin();[m
[31m-   while ( current != end )[m
[31m-   {[m
[31m-      if ( *current == '[' )[m
[31m-      {[m
[31m-         ++current;[m
[31m-         if ( *current == '%' )[m
[31m-            addPathInArg( path, in, itInArg, PathArgument::kindIndex );[m
[31m-         else[m
[31m-         {[m
[31m-            Value::UInt index = 0;[m
[31m-            for ( ; current != end && *current >= '0'  &&  *current <= '9'; ++current )[m
[31m-               index = index * 10 + Value::UInt(*current - '0');[m
[31m-            args_.push_back( index );[m
[31m-         }[m
[31m-         if ( current == end  ||  *current++ != ']' )[m
[31m-            invalidPath( path, int(current - path.c_str()) );[m
[31m-      }[m
[31m-      else if ( *current == '%' )[m
[31m-      {[m
[31m-         addPathInArg( path, in, itInArg, PathArgument::kindKey );[m
[31m-         ++current;[m
[31m-      }[m
[31m-      else if ( *current == '.' )[m
[31m-      {[m
[31m-         ++current;[m
[31m-      }[m
[31m-      else[m
[31m-      {[m
[31m-         const char *beginName = current;[m
[31m-         while ( current != end  &&  !strchr( "[.", *current ) )[m
[31m-            ++current;[m
[31m-         args_.push_back( std::string( beginName, current ) );[m
[31m-      }[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Path::addPathInArg( const std::string &path, [m
[31m-                    const InArgs &in, [m
[31m-                    InArgs::const_iterator &itInArg, [m
[31m-                    PathArgument::Kind kind )[m
[31m-{[m
[31m-   if ( itInArg == in.end() )[m
[31m-   {[m
[31m-      // Error: missing argument %d[m
[31m-   }[m
[31m-   else if ( (*itInArg)->kind_ != kind )[m
[31m-   {[m
[31m-      // Error: bad argument type[m
[31m-   }[m
[31m-   else[m
[31m-   {[m
[31m-      args_.push_back( **itInArg );[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Path::invalidPath( const std::string &path, [m
[31m-                   int location )[m
[31m-{[m
[31m-   // Error: invalid path.[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const Value &[m
[31m-Path::resolve( const Value &root ) const[m
[31m-{[m
[31m-   const Value *node = &root;[m
[31m-   for ( Args::const_iterator it = args_.begin(); it != args_.end(); ++it )[m
[31m-   {[m
[31m-      const PathArgument &arg = *it;[m
[31m-      if ( arg.kind_ == PathArgument::kindIndex )[m
[31m-      {[m
[31m-         if ( !node->isArray()  ||  node->isValidIndex( arg.index_ ) )[m
[31m-         {[m
[31m-            // Error: unable to resolve path (array value expected at position...[m
[31m-         }[m
[31m-         node = &((*node)[arg.index_]);[m
[31m-      }[m
[31m-      else if ( arg.kind_ == PathArgument::kindKey )[m
[31m-      {[m
[31m-         if ( !node->isObject() )[m
[31m-         {[m
[31m-            // Error: unable to resolve path (object value expected at position...)[m
[31m-         }[m
[31m-         node = &((*node)[arg.key_]);[m
[31m-         if ( node == &Value::null )[m
[31m-         {[m
[31m-            // Error: unable to resolve path (object has no member named '' at position...)[m
[31m-         }[m
[31m-      }[m
[31m-   }[m
[31m-   return *node;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value [m
[31m-Path::resolve( const Value &root, [m
[31m-               const Value &defaultValue ) const[m
[31m-{[m
[31m-   const Value *node = &root;[m
[31m-   for ( Args::const_iterator it = args_.begin(); it != args_.end(); ++it )[m
[31m-   {[m
[31m-      const PathArgument &arg = *it;[m
[31m-      if ( arg.kind_ == PathArgument::kindIndex )[m
[31m-      {[m
[31m-         if ( !node->isArray()  ||  node->isValidIndex( arg.index_ ) )[m
[31m-            return defaultValue;[m
[31m-         node = &((*node)[arg.index_]);[m
[31m-      }[m
[31m-      else if ( arg.kind_ == PathArgument::kindKey )[m
[31m-      {[m
[31m-         if ( !node->isObject() )[m
[31m-            return defaultValue;[m
[31m-         node = &((*node)[arg.key_]);[m
[31m-         if ( node == &Value::null )[m
[31m-            return defaultValue;[m
[31m-      }[m
[31m-   }[m
[31m-   return *node;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Path::make( Value &root ) const[m
[31m-{[m
[31m-   Value *node = &root;[m
[31m-   for ( Args::const_iterator it = args_.begin(); it != args_.end(); ++it )[m
[31m-   {[m
[31m-      const PathArgument &arg = *it;[m
[31m-      if ( arg.kind_ == PathArgument::kindIndex )[m
[31m-      {[m
[31m-         if ( !node->isArray() )[m
[31m-         {[m
[31m-            // Error: node is not an array at position ...[m
[31m-         }[m
[31m-         node = &((*node)[arg.index_]);[m
[31m-      }[m
[31m-      else if ( arg.kind_ == PathArgument::kindKey )[m
[31m-      {[m
[31m-         if ( !node->isObject() )[m
[31m-         {[m
[31m-            // Error: node is not an object at position...[m
[31m-         }[m
[31m-         node = &((*node)[arg.key_]);[m
[31m-      }[m
[31m-   }[m
[31m-   return *node;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-} // namespace Json[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_valueiterator.inl b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_valueiterator.inl[m
[1mdeleted file mode 100644[m
[1mindex 736e260..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_valueiterator.inl[m
[1m+++ /dev/null[m
[36m@@ -1,292 +0,0 @@[m
[31m-// included by json_value.cpp[m
[31m-// everything is within Json namespace[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class ValueIteratorBase[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-ValueIteratorBase::ValueIteratorBase()[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   : current_()[m
[31m-   , isNull_( true )[m
[31m-{[m
[31m-}[m
[31m-#else[m
[31m-   : isArray_( true )[m
[31m-   , isNull_( true )[m
[31m-{[m
[31m-   iterator_.array_ = ValueInternalArray::IteratorState();[m
[31m-}[m
[31m-#endif[m
[31m-[m
[31m-[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-ValueIteratorBase::ValueIteratorBase( const Value::ObjectValues::iterator &current )[m
[31m-   : current_( current )[m
[31m-   , isNull_( false )[m
[31m-{[m
[31m-}[m
[31m-#else[m
[31m-ValueIteratorBase::ValueIteratorBase( const ValueInternalArray::IteratorState &state )[m
[31m-   : isArray_( true )[m
[31m-{[m
[31m-   iterator_.array_ = state;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueIteratorBase::ValueIteratorBase( const ValueInternalMap::IteratorState &state )[m
[31m-   : isArray_( false )[m
[31m-{[m
[31m-   iterator_.map_ = state;[m
[31m-}[m
[31m-#endif[m
[31m-[m
[31m-Value &[m
[31m-ValueIteratorBase::deref() const[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   return current_->second;[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      return ValueInternalArray::dereference( iterator_.array_ );[m
[31m-   return ValueInternalMap::value( iterator_.map_ );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueIteratorBase::increment()[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   ++current_;[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      ValueInternalArray::increment( iterator_.array_ );[m
[31m-   ValueInternalMap::increment( iterator_.map_ );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueIteratorBase::decrement()[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   --current_;[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      ValueInternalArray::decrement( iterator_.array_ );[m
[31m-   ValueInternalMap::decrement( iterator_.map_ );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueIteratorBase::difference_type [m
[31m-ValueIteratorBase::computeDistance( const SelfType &other ) const[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-# ifdef JSON_USE_CPPTL_SMALLMAP[m
[31m-   return current_ - other.current_;[m
[31m-# else[m
[31m-   // Iterator for null value are initialized using the default[m
[31m-   // constructor, which initialize current_ to the default[m
[31m-   // std::map::iterator. As begin() and end() are two instance [m
[31m-   // of the default std::map::iterator, they can not be compared.[m
[31m-   // To allow this, we handle this comparison specifically.[m
[31m-   if ( isNull_  &&  other.isNull_ )[m
[31m-   {[m
[31m-      return 0;[m
[31m-   }[m
[31m-[m
[31m-[m
[31m-   // Usage of std::distance is not portable (does not compile with Sun Studio 12 RogueWave STL,[m
[31m-   // which is the one used by default).[m
[31m-   // Using a portable hand-made version for non random iterator instead:[m
[31m-   //   return difference_type( std::distance( current_, other.current_ ) );[m
[31m-   difference_type myDistance = 0;[m
[31m-   for ( Value::ObjectValues::iterator it = current_; it != other.current_; ++it )[m
[31m-   {[m
[31m-      ++myDistance;[m
[31m-   }[m
[31m-   return myDistance;[m
[31m-# endif[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      return ValueInternalArray::distance( iterator_.array_, other.iterator_.array_ );[m
[31m-   return ValueInternalMap::distance( iterator_.map_, other.iterator_.map_ );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-ValueIteratorBase::isEqual( const SelfType &other ) const[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   if ( isNull_ )[m
[31m-   {[m
[31m-      return other.isNull_;[m
[31m-   }[m
[31m-   return current_ == other.current_;[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      return ValueInternalArray::equals( iterator_.array_, other.iterator_.array_ );[m
[31m-   return ValueInternalMap::equals( iterator_.map_, other.iterator_.map_ );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueIteratorBase::copy( const SelfType &other )[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   current_ = other.current_;[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      iterator_.array_ = other.iterator_.array_;[m
[31m-   iterator_.map_ = other.iterator_.map_;[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value [m
[31m-ValueIteratorBase::key() const[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   const Value::CZString czstring = (*current_).first;[m
[31m-   if ( czstring.c_str() )[m
[31m-   {[m
[31m-      if ( czstring.isStaticString() )[m
[31m-         return Value( StaticString( czstring.c_str() ) );[m
[31m-      return Value( czstring.c_str() );[m
[31m-   }[m
[31m-   return Value( czstring.index() );[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      return Value( ValueInternalArray::indexOf( iterator_.array_ ) );[m
[31m-   bool isStatic;[m
[31m-   const char *memberName = ValueInternalMap::key( iterator_.map_, isStatic );[m
[31m-   if ( isStatic )[m
[31m-      return Value( StaticString( memberName ) );[m
[31m-   return Value( memberName );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-UInt [m
[31m-ValueIteratorBase::index() const[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   const Value::CZString czstring = (*current_).first;[m
[31m-   if ( !czstring.c_str() )[m
[31m-      return czstring.index();[m
[31m-   return Value::UInt( -1 );[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      return Value::UInt( ValueInternalArray::indexOf( iterator_.array_ ) );[m
[31m-   return Value::UInt( -1 );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const char *[m
[31m-ValueIteratorBase::memberName() const[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   const char *name = (*current_).first.c_str();[m
[31m-   return name ? name : "";[m
[31m-#else[m
[31m-   if ( !isArray_ )[m
[31m-      return ValueInternalMap::key( iterator_.map_ );[m
[31m-   return "";[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class ValueConstIterator[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-ValueConstIterator::ValueConstIterator()[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-ValueConstIterator::ValueConstIterator( const Value::ObjectValues::iterator &current )[m
[31m-   : ValueIteratorBase( current )[m
[31m-{[m
[31m-}[m
[31m-#else[m
[31m-ValueConstIterator::ValueConstIterator( const ValueInternalArray::IteratorState &state )[m
[31m-   : ValueIteratorBase( state )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-ValueConstIterator::ValueConstIterator( const ValueInternalMap::IteratorState &state )[m
[31m-   : ValueIteratorBase( state )[m
[31m-{[m
[31m-}[m
[31m-#endif[m
[31m-[m
[31m-ValueConstIterator &[m
[31m-ValueConstIterator::operator =( const ValueIteratorBase &other )[m
[31m-{[m
[31m-   copy( other );[m
[31m-   return *this;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class ValueIterator[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-ValueIterator::ValueIterator()[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-ValueIterator::ValueIterator( const Value::ObjectValues::iterator &current )[m
[31m-   : ValueIteratorBase( current )[m
[31m-{[m
[31m-}[m
[31m-#else[m
[31m-ValueIterator::ValueIterator( const ValueInternalArray::IteratorState &state )[m
[31m-   : ValueIteratorBase( state )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-ValueIterator::ValueIterator( const ValueInternalMap::IteratorState &state )[m
[31m-   : ValueIteratorBase( state )[m
[31m-{[m
[31m-}[m
[31m-#endif[m
[31m-[m
[31m-ValueIterator::ValueIterator( const ValueConstIterator &other )[m
[31m-   : ValueIteratorBase( other )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-ValueIterator::ValueIterator( const ValueIterator &other )[m
[31m-   : ValueIteratorBase( other )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-ValueIterator &[m
[31m-ValueIterator::operator =( const SelfType &other )[m
[31m-{[m
[31m-   copy( other );[m
[31m-   return *this;[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_writer.cpp b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_writer.cpp[m
[1mdeleted file mode 100644[m
[1mindex cdf4188..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/json_writer.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,829 +0,0 @@[m
[31m-#include <json/writer.h>[m
[31m-#include <utility>[m
[31m-#include <assert.h>[m
[31m-#include <stdio.h>[m
[31m-#include <string.h>[m
[31m-#include <iostream>[m
[31m-#include <sstream>[m
[31m-#include <iomanip>[m
[31m-[m
[31m-#if _MSC_VER >= 1400 // VC++ 8.0[m
[31m-#pragma warning( disable : 4996 )   // disable warning about strdup being deprecated.[m
[31m-#endif[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-static bool isControlCharacter(char ch)[m
[31m-{[m
[31m-   return ch > 0 && ch <= 0x1F;[m
[31m-}[m
[31m-[m
[31m-static bool containsControlCharacter( const char* str )[m
[31m-{[m
[31m-   while ( *str ) [m
[31m-   {[m
[31m-      if ( isControlCharacter( *(str++) ) )[m
[31m-         return true;[m
[31m-   }[m
[31m-   return false;[m
[31m-}[m
[31m-static void uintToString( unsigned int value, [m
[31m-                          char *&current )[m
[31m-{[m
[31m-   *--current = 0;[m
[31m-   do[m
[31m-   {[m
[31m-      *--current = (value % 10) + '0';[m
[31m-      value /= 10;[m
[31m-   }[m
[31m-   while ( value != 0 );[m
[31m-}[m
[31m-[m
[31m-std::string valueToString( Int value )[m
[31m-{[m
[31m-   char buffer[32];[m
[31m-   char *current = buffer + sizeof(buffer);[m
[31m-   bool isNegative = value < 0;[m
[31m-   if ( isNegative )[m
[31m-      value = -value;[m
[31m-   uintToString( UInt(value), current );[m
[31m-   if ( isNegative )[m
[31m-      *--current = '-';[m
[31m-   assert( current >= buffer );[m
[31m-   return current;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string valueToString( UInt value )[m
[31m-{[m
[31m-   char buffer[32];[m
[31m-   char *current = buffer + sizeof(buffer);[m
[31m-   uintToString( value, current );[m
[31m-   assert( current >= buffer );[m
[31m-   return current;[m
[31m-}[m
[31m-[m
[31m-std::string valueToString( double value )[m
[31m-{[m
[31m-   char buffer[32];[m
[31m-#if defined(_MSC_VER) && defined(__STDC_SECURE_LIB__) // Use secure version with visual studio 2005 to avoid warning. [m
[31m-   sprintf_s(buffer, sizeof(buffer), "%#.16g", value); [m
[31m-#else	[m
[31m-   sprintf(buffer, "%#.16g", value); [m
[31m-#endif[m
[31m-   char* ch = buffer + strlen(buffer) - 1;[m
[31m-   if (*ch != '0') return buffer; // nothing to truncate, so save time[m
[31m-   while(ch > buffer && *ch == '0'){[m
[31m-     --ch;[m
[31m-   }[m
[31m-   char* last_nonzero = ch;[m
[31m-   while(ch >= buffer){[m
[31m-     switch(*ch){[m
[31m-     case '0':[m
[31m-     case '1':[m
[31m-     case '2':[m
[31m-     case '3':[m
[31m-     case '4':[m
[31m-     case '5':[m
[31m-     case '6':[m
[31m-     case '7':[m
[31m-     case '8':[m
[31m-     case '9':[m
[31m-       --ch;[m
[31m-       continue;[m
[31m-     case '.':[m
[31m-       // Truncate zeroes to save bytes in output, but keep one.[m
[31m-       *(last_nonzero+2) = '\0';[m
[31m-       return buffer;[m
[31m-     default:[m
[31m-       return buffer;[m
[31m-     }[m
[31m-   }[m
[31m-   return buffer;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string valueToString( bool value )[m
[31m-{[m
[31m-   return value ? "true" : "false";[m
[31m-}[m
[31m-[m
[31m-std::string valueToQuotedString( const char *value )[m
[31m-{[m
[31m-   // Not sure how to handle unicode...[m
[31m-   if (strpbrk(value, "\"\\\b\f\n\r\t") == NULL && !containsControlCharacter( value ))[m
[31m-      return std::string("\"") + value + "\"";[m
[31m-   // We have to walk value and escape any special characters.[m
[31m-   // Appending to std::string is not efficient, but this should be rare.[m
[31m-   // (Note: forward slashes are *not* rare, but I am not escaping them.)[m
[31m-   unsigned maxsize = strlen(value)*2 + 3; // allescaped+quotes+NULL[m
[31m-   std::string result;[m
[31m-   result.reserve(maxsize); // to avoid lots of mallocs[m
[31m-   result += "\"";[m
[31m-   for (const char* c=value; *c != 0; ++c)[m
[31m-   {[m
[31m-      switch(*c)[m
[31m-      {[m
[31m-         case '\"':[m
[31m-            result += "\\\"";[m
[31m-            break;[m
[31m-         case '\\':[m
[31m-            result += "\\\\";[m
[31m-            break;[m
[31m-         case '\b':[m
[31m-            result += "\\b";[m
[31m-            break;[m
[31m-         case '\f':[m
[31m-            result += "\\f";[m
[31m-            break;[m
[31m-         case '\n':[m
[31m-            result += "\\n";[m
[31m-            break;[m
[31m-         case '\r':[m
[31m-            result += "\\r";[m
[31m-            break;[m
[31m-         case '\t':[m
[31m-            result += "\\t";[m
[31m-            break;[m
[31m-         //case '/':[m
[31m-            // Even though \/ is considered a legal escape in JSON, a bare[m
[31m-            // slash is also legal, so I see no reason to escape it.[m
[31m-            // (I hope I am not misunderstanding something.[m
[31m-            // blep notes: actually escaping \/ may be useful in javascript to avoid </ [m
[31m-            // sequence.[m
[31m-            // Should add a flag to allow this compatibility mode and prevent this [m
[31m-            // sequence from occurring.[m
[31m-         default:[m
[31m-            if ( isControlCharacter( *c ) )[m
[31m-            {[m
[31m-               std::ostringstream oss;[m
[31m-               oss << "\\u" << std::hex << std::uppercase << std::setfill('0') << std::setw(4) << static_cast<int>(*c);[m
[31m-               result += oss.str();[m
[31m-            }[m
[31m-            else[m
[31m-            {[m
[31m-               result += *c;[m
[31m-            }[m
[31m-            break;[m
[31m-      }[m
[31m-   }[m
[31m-   result += "\"";[m
[31m-   return result;[m
[31m-}[m
[31m-[m
[31m-// Class Writer[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-Writer::~Writer()[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// Class FastWriter[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-FastWriter::FastWriter()[m
[31m-   : yamlCompatiblityEnabled_( false )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-FastWriter::enableYAMLCompatibility()[m
[31m-{[m
[31m-   yamlCompatiblityEnabled_ = true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-FastWriter::write( const Value &root )[m
[31m-{[m
[31m-   document_ = "";[m
[31m-   writeValue( root );[m
[31m-   document_ += "\n";[m
[31m-   return document_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-FastWriter::writeValue( const Value &value )[m
[31m-{[m
[31m-   switch ( value.type() )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      document_ += "null";[m
[31m-      break;[m
[31m-   case intValue:[m
[31m-      document_ += valueToString( value.asInt() );[m
[31m-      break;[m
[31m-   case uintValue:[m
[31m-      document_ += valueToString( value.asUInt() );[m
[31m-      break;[m
[31m-   case realValue:[m
[31m-      document_ += valueToString( value.asDouble() );[m
[31m-      break;[m
[31m-   case stringValue:[m
[31m-      document_ += valueToQuotedString( value.asCString() );[m
[31m-      break;[m
[31m-   case booleanValue:[m
[31m-      document_ += valueToString( value.asBool() );[m
[31m-      break;[m
[31m-   case arrayValue:[m
[31m-      {[m
[31m-         document_ += "[";[m
[31m-         int size = value.size();[m
[31m-         for ( int index =0; index < size; ++index )[m
[31m-         {[m
[31m-            if ( index > 0 )[m
[31m-               document_ += ",";[m
[31m-            writeValue( value[index] );[m
[31m-         }[m
[31m-         document_ += "]";[m
[31m-      }[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      {[m
[31m-         Value::Members members( value.getMemberNames() );[m
[31m-         document_ += "{";[m
[31m-         for ( Value::Members::iterator it = members.begin(); [m
[31m-               it != members.end(); [m
[31m-               ++it )[m
[31m-         {[m
[31m-            const std::string &name = *it;[m
[31m-            if ( it != members.begin() )[m
[31m-               document_ += ",";[m
[31m-            document_ += valueToQuotedString( name.c_str() );[m
[31m-            document_ += yamlCompatiblityEnabled_ ? ": " [m
[31m-                                                  : ":";[m
[31m-            writeValue( value[name] );[m
[31m-         }[m
[31m-         document_ += "}";[m
[31m-      }[m
[31m-      break;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// Class StyledWriter[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-StyledWriter::StyledWriter()[m
[31m-   : rightMargin_( 74 )[m
[31m-   , indentSize_( 3 )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-StyledWriter::write( const Value &root )[m
[31m-{[m
[31m-   document_ = "";[m
[31m-   addChildValues_ = false;[m
[31m-   indentString_ = "";[m
[31m-   writeCommentBeforeValue( root );[m
[31m-   writeValue( root );[m
[31m-   writeCommentAfterValueOnSameLine( root );[m
[31m-   document_ += "\n";[m
[31m-   return document_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::writeValue( const Value &value )[m
[31m-{[m
[31m-   switch ( value.type() )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      pushValue( "null" );[m
[31m-      break;[m
[31m-   case intValue:[m
[31m-      pushValue( valueToString( value.asInt() ) );[m
[31m-      break;[m
[31m-   case uintValue:[m
[31m-      pushValue( valueToString( value.asUInt() ) );[m
[31m-      break;[m
[31m-   case realValue:[m
[31m-      pushValue( valueToString( value.asDouble() ) );[m
[31m-      break;[m
[31m-   case stringValue:[m
[31m-      pushValue( valueToQuotedString( value.asCString() ) );[m
[31m-      break;[m
[31m-   case booleanValue:[m
[31m-      pushValue( valueToString( value.asBool() ) );[m
[31m-      break;[m
[31m-   case arrayValue:[m
[31m-      writeArrayValue( value);[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      {[m
[31m-         Value::Members members( value.getMemberNames() );[m
[31m-         if ( members.empty() )[m
[31m-            pushValue( "{}" );[m
[31m-         else[m
[31m-         {[m
[31m-            writeWithIndent( "{" );[m
[31m-            indent();[m
[31m-            Value::Members::iterator it = members.begin();[m
[31m-            while ( true )[m
[31m-            {[m
[31m-               const std::string &name = *it;[m
[31m-               const Value &childValue = value[name];[m
[31m-               writeCommentBeforeValue( childValue );[m
[31m-               writeWithIndent( valueToQuotedString( name.c_str() ) );[m
[31m-               document_ += " : ";[m
[31m-               writeValue( childValue );[m
[31m-               if ( ++it == members.end() )[m
[31m-               {[m
[31m-                  writeCommentAfterValueOnSameLine( childValue );[m
[31m-                  break;[m
[31m-               }[m
[31m-               document_ += ",";[m
[31m-               writeCommentAfterValueOnSameLine( childValue );[m
[31m-            }[m
[31m-            unindent();[m
[31m-            writeWithIndent( "}" );[m
[31m-         }[m
[31m-      }[m
[31m-      break;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::writeArrayValue( const Value &value )[m
[31m-{[m
[31m-   unsigned size = value.size();[m
[31m-   if ( size == 0 )[m
[31m-      pushValue( "[]" );[m
[31m-   else[m
[31m-   {[m
[31m-      bool isArrayMultiLine = isMultineArray( value );[m
[31m-      if ( isArrayMultiLine )[m
[31m-      {[m
[31m-         writeWithIndent( "[" );[m
[31m-         indent();[m
[31m-         bool hasChildValue = !childValues_.empty();[m
[31m-         unsigned index =0;[m
[31m-         while ( true )[m
[31m-         {[m
[31m-            const Value &childValue = value[index];[m
[31m-            writeCommentBeforeValue( childValue );[m
[31m-            if ( hasChildValue )[m
[31m-               writeWithIndent( childValues_[index] );[m
[31m-            else[m
[31m-            {[m
[31m-               writeIndent();[m
[31m-               writeValue( childValue );[m
[31m-            }[m
[31m-            if ( ++index == size )[m
[31m-            {[m
[31m-               writeCommentAfterValueOnSameLine( childValue );[m
[31m-               break;[m
[31m-            }[m
[31m-            document_ += ",";[m
[31m-            writeCommentAfterValueOnSameLine( childValue );[m
[31m-         }[m
[31m-         unindent();[m
[31m-         writeWithIndent( "]" );[m
[31m-      }[m
[31m-      else // output on a single line[m
[31m-      {[m
[31m-         assert( childValues_.size() == size );[m
[31m-         document_ += "[ ";[m
[31m-         for ( unsigned index =0; index < size; ++index )[m
[31m-         {[m
[31m-            if ( index > 0 )[m
[31m-               document_ += ", ";[m
[31m-            document_ += childValues_[index];[m
[31m-         }[m
[31m-         document_ += " ]";[m
[31m-      }[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-StyledWriter::isMultineArray( const Value &value )[m
[31m-{[m
[31m-   int size = value.size();[m
[31m-   bool isMultiLine = size*3 >= rightMargin_ ;[m
[31m-   childValues_.clear();[m
[31m-   for ( int index =0; index < size  &&  !isMultiLine; ++index )[m
[31m-   {[m
[31m-      const Value &childValue = value[index];[m
[31m-      isMultiLine = isMultiLine  ||[m
[31m-                     ( (childValue.isArray()  ||  childValue.isObject())  &&  [m
[31m-                        childValue.size() > 0 );[m
[31m-   }[m
[31m-   if ( !isMultiLine ) // check if line length > max line length[m
[31m-   {[m
[31m-      childValues_.reserve( size );[m
[31m-      addChildValues_ = true;[m
[31m-      int lineLength = 4 + (size-1)*2; // '[ ' + ', '*n + ' ]'[m
[31m-      for ( int index =0; index < size  &&  !isMultiLine; ++index )[m
[31m-      {[m
[31m-         writeValue( value[index] );[m
[31m-         lineLength += int( childValues_[index].length() );[m
[31m-         isMultiLine = isMultiLine  &&  hasCommentForValue( value[index] );[m
[31m-      }[m
[31m-      addChildValues_ = false;[m
[31m-      isMultiLine = isMultiLine  ||  lineLength >= rightMargin_;[m
[31m-   }[m
[31m-   return isMultiLine;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::pushValue( const std::string &value )[m
[31m-{[m
[31m-   if ( addChildValues_ )[m
[31m-      childValues_.push_back( value );[m
[31m-   else[m
[31m-      document_ += value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::writeIndent()[m
[31m-{[m
[31m-   if ( !document_.empty() )[m
[31m-   {[m
[31m-      char last = document_[document_.length()-1];[m
[31m-      if ( last == ' ' )     // already indented[m
[31m-         return;[m
[31m-      if ( last != '\n' )    // Comments may add new-line[m
[31m-         document_ += '\n';[m
[31m-   }[m
[31m-   document_ += indentString_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::writeWithIndent( const std::string &value )[m
[31m-{[m
[31m-   writeIndent();[m
[31m-   document_ += value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::indent()[m
[31m-{[m
[31m-   indentString_ += std::string( indentSize_, ' ' );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::unindent()[m
[31m-{[m
[31m-   assert( int(indentString_.size()) >= indentSize_ );[m
[31m-   indentString_.resize( indentString_.size() - indentSize_ );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::writeCommentBeforeValue( const Value &root )[m
[31m-{[m
[31m-   if ( !root.hasComment( commentBefore ) )[m
[31m-      return;[m
[31m-   document_ += normalizeEOL( root.getComment( commentBefore ) );[m
[31m-   document_ += "\n";[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::writeCommentAfterValueOnSameLine( const Value &root )[m
[31m-{[m
[31m-   if ( root.hasComment( commentAfterOnSameLine ) )[m
[31m-      document_ += " " + normalizeEOL( root.getComment( commentAfterOnSameLine ) );[m
[31m-[m
[31m-   if ( root.hasComment( commentAfter ) )[m
[31m-   {[m
[31m-      document_ += "\n";[m
[31m-      document_ += normalizeEOL( root.getComment( commentAfter ) );[m
[31m-      document_ += "\n";[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-StyledWriter::hasCommentForValue( const Value &value )[m
[31m-{[m
[31m-   return value.hasComment( commentBefore )[m
[31m-          ||  value.hasComment( commentAfterOnSameLine )[m
[31m-          ||  value.hasComment( commentAfter );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-StyledWriter::normalizeEOL( const std::string &text )[m
[31m-{[m
[31m-   std::string normalized;[m
[31m-   normalized.reserve( text.length() );[m
[31m-   const char *begin = text.c_str();[m
[31m-   const char *end = begin + text.length();[m
[31m-   const char *current = begin;[m
[31m-   while ( current != end )[m
[31m-   {[m
[31m-      char c = *current++;[m
[31m-      if ( c == '\r' ) // mac or dos EOL[m
[31m-      {[m
[31m-         if ( *current == '\n' ) // convert dos EOL[m
[31m-            ++current;[m
[31m-         normalized += '\n';[m
[31m-      }[m
[31m-      else // handle unix EOL & other char[m
[31m-         normalized += c;[m
[31m-   }[m
[31m-   return normalized;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// Class StyledStreamWriter[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-StyledStreamWriter::StyledStreamWriter( std::string indentation )[m
[31m-   : document_(NULL)[m
[31m-   , rightMargin_( 74 )[m
[31m-   , indentation_( indentation )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void[m
[31m-StyledStreamWriter::write( std::ostream &out, const Value &root )[m
[31m-{[m
[31m-   document_ = &out;[m
[31m-   addChildValues_ = false;[m
[31m-   indentString_ = "";[m
[31m-   writeCommentBeforeValue( root );[m
[31m-   writeValue( root );[m
[31m-   writeCommentAfterValueOnSameLine( root );[m
[31m-   *document_ << "\n";[m
[31m-   document_ = NULL; // Forget the stream, for safety.[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::writeValue( const Value &value )[m
[31m-{[m
[31m-   switch ( value.type() )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      pushValue( "null" );[m
[31m-      break;[m
[31m-   case intValue:[m
[31m-      pushValue( valueToString( value.asInt() ) );[m
[31m-      break;[m
[31m-   case uintValue:[m
[31m-      pushValue( valueToString( value.asUInt() ) );[m
[31m-      break;[m
[31m-   case realValue:[m
[31m-      pushValue( valueToString( value.asDouble() ) );[m
[31m-      break;[m
[31m-   case stringValue:[m
[31m-      pushValue( valueToQuotedString( value.asCString() ) );[m
[31m-      break;[m
[31m-   case booleanValue:[m
[31m-      pushValue( valueToString( value.asBool() ) );[m
[31m-      break;[m
[31m-   case arrayValue:[m
[31m-      writeArrayValue( value);[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      {[m
[31m-         Value::Members members( value.getMemberNames() );[m
[31m-         if ( members.empty() )[m
[31m-            pushValue( "{}" );[m
[31m-         else[m
[31m-         {[m
[31m-            writeWithIndent( "{" );[m
[31m-            indent();[m
[31m-            Value::Members::iterator it = members.begin();[m
[31m-            while ( true )[m
[31m-            {[m
[31m-               const std::string &name = *it;[m
[31m-               const Value &childValue = value[name];[m
[31m-               writeCommentBeforeValue( childValue );[m
[31m-               writeWithIndent( valueToQuotedString( name.c_str() ) );[m
[31m-               *document_ << " : ";[m
[31m-               writeValue( childValue );[m
[31m-               if ( ++it == members.end() )[m
[31m-               {[m
[31m-                  writeCommentAfterValueOnSameLine( childValue );[m
[31m-                  break;[m
[31m-               }[m
[31m-               *document_ << ",";[m
[31m-               writeCommentAfterValueOnSameLine( childValue );[m
[31m-            }[m
[31m-            unindent();[m
[31m-            writeWithIndent( "}" );[m
[31m-         }[m
[31m-      }[m
[31m-      break;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::writeArrayValue( const Value &value )[m
[31m-{[m
[31m-   unsigned size = value.size();[m
[31m-   if ( size == 0 )[m
[31m-      pushValue( "[]" );[m
[31m-   else[m
[31m-   {[m
[31m-      bool isArrayMultiLine = isMultineArray( value );[m
[31m-      if ( isArrayMultiLine )[m
[31m-      {[m
[31m-         writeWithIndent( "[" );[m
[31m-         indent();[m
[31m-         bool hasChildValue = !childValues_.empty();[m
[31m-         unsigned index =0;[m
[31m-         while ( true )[m
[31m-         {[m
[31m-            const Value &childValue = value[index];[m
[31m-            writeCommentBeforeValue( childValue );[m
[31m-            if ( hasChildValue )[m
[31m-               writeWithIndent( childValues_[index] );[m
[31m-            else[m
[31m-            {[m
[31m-	       writeIndent();[m
[31m-               writeValue( childValue );[m
[31m-            }[m
[31m-            if ( ++index == size )[m
[31m-            {[m
[31m-               writeCommentAfterValueOnSameLine( childValue );[m
[31m-               break;[m
[31m-            }[m
[31m-            *document_ << ",";[m
[31m-            writeCommentAfterValueOnSameLine( childValue );[m
[31m-         }[m
[31m-         unindent();[m
[31m-         writeWithIndent( "]" );[m
[31m-      }[m
[31m-      else // output on a single line[m
[31m-      {[m
[31m-         assert( childValues_.size() == size );[m
[31m-         *document_ << "[ ";[m
[31m-         for ( unsigned index =0; index < size; ++index )[m
[31m-         {[m
[31m-            if ( index > 0 )[m
[31m-               *document_ << ", ";[m
[31m-            *document_ << childValues_[index];[m
[31m-         }[m
[31m-         *document_ << " ]";[m
[31m-      }[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-StyledStreamWriter::isMultineArray( const Value &value )[m
[31m-{[m
[31m-   int size = value.size();[m
[31m-   bool isMultiLine = size*3 >= rightMargin_ ;[m
[31m-   childValues_.clear();[m
[31m-   for ( int index =0; index < size  &&  !isMultiLine; ++index )[m
[31m-   {[m
[31m-      const Value &childValue = value[index];[m
[31m-      isMultiLine = isMultiLine  ||[m
[31m-                     ( (childValue.isArray()  ||  childValue.isObject())  &&  [m
[31m-                        childValue.size() > 0 );[m
[31m-   }[m
[31m-   if ( !isMultiLine ) // check if line length > max line length[m
[31m-   {[m
[31m-      childValues_.reserve( size );[m
[31m-      addChildValues_ = true;[m
[31m-      int lineLength = 4 + (size-1)*2; // '[ ' + ', '*n + ' ]'[m
[31m-      for ( int index =0; index < size  &&  !isMultiLine; ++index )[m
[31m-      {[m
[31m-         writeValue( value[index] );[m
[31m-         lineLength += int( childValues_[index].length() );[m
[31m-         isMultiLine = isMultiLine  &&  hasCommentForValue( value[index] );[m
[31m-      }[m
[31m-      addChildValues_ = false;[m
[31m-      isMultiLine = isMultiLine  ||  lineLength >= rightMargin_;[m
[31m-   }[m
[31m-   return isMultiLine;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::pushValue( const std::string &value )[m
[31m-{[m
[31m-   if ( addChildValues_ )[m
[31m-      childValues_.push_back( value );[m
[31m-   else[m
[31m-      *document_ << value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::writeIndent()[m
[31m-{[m
[31m-  /*[m
[31m-    Some comments in this method would have been nice. ;-)[m
[31m-[m
[31m-   if ( !document_.empty() )[m
[31m-   {[m
[31m-      char last = document_[document_.length()-1];[m
[31m-      if ( last == ' ' )     // already indented[m
[31m-         return;[m
[31m-      if ( last != '\n' )    // Comments may add new-line[m
[31m-         *document_ << '\n';[m
[31m-   }[m
[31m-  */[m
[31m-   *document_ << '\n' << indentString_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::writeWithIndent( const std::string &value )[m
[31m-{[m
[31m-   writeIndent();[m
[31m-   *document_ << value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::indent()[m
[31m-{[m
[31m-   indentString_ += indentation_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::unindent()[m
[31m-{[m
[31m-   assert( indentString_.size() >= indentation_.size() );[m
[31m-   indentString_.resize( indentString_.size() - indentation_.size() );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::writeCommentBeforeValue( const Value &root )[m
[31m-{[m
[31m-   if ( !root.hasComment( commentBefore ) )[m
[31m-      return;[m
[31m-   *document_ << normalizeEOL( root.getComment( commentBefore ) );[m
[31m-   *document_ << "\n";[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::writeCommentAfterValueOnSameLine( const Value &root )[m
[31m-{[m
[31m-   if ( root.hasComment( commentAfterOnSameLine ) )[m
[31m-      *document_ << " " + normalizeEOL( root.getComment( commentAfterOnSameLine ) );[m
[31m-[m
[31m-   if ( root.hasComment( commentAfter ) )[m
[31m-   {[m
[31m-      *document_ << "\n";[m
[31m-      *document_ << normalizeEOL( root.getComment( commentAfter ) );[m
[31m-      *document_ << "\n";[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-StyledStreamWriter::hasCommentForValue( const Value &value )[m
[31m-{[m
[31m-   return value.hasComment( commentBefore )[m
[31m-          ||  value.hasComment( commentAfterOnSameLine )[m
[31m-          ||  value.hasComment( commentAfter );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-StyledStreamWriter::normalizeEOL( const std::string &text )[m
[31m-{[m
[31m-   std::string normalized;[m
[31m-   normalized.reserve( text.length() );[m
[31m-   const char *begin = text.c_str();[m
[31m-   const char *end = begin + text.length();[m
[31m-   const char *current = begin;[m
[31m-   while ( current != end )[m
[31m-   {[m
[31m-      char c = *current++;[m
[31m-      if ( c == '\r' ) // mac or dos EOL[m
[31m-      {[m
[31m-         if ( *current == '\n' ) // convert dos EOL[m
[31m-            ++current;[m
[31m-         normalized += '\n';[m
[31m-      }[m
[31m-      else // handle unix EOL & other char[m
[31m-         normalized += c;[m
[31m-   }[m
[31m-   return normalized;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::ostream& operator<<( std::ostream &sout, const Value &root )[m
[31m-{[m
[31m-   Json::StyledStreamWriter writer;[m
[31m-   writer.write(sout, root);[m
[31m-   return sout;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-} // namespace Json[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/plugin.cpp b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/plugin.cpp[m
[1mdeleted file mode 100644[m
[1mindex 6906275..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/plugin.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,320 +0,0 @@[m
[31m-#include "plugin.h"[m
[31m-#include "tokenizer.h"[m
[31m-[m
[31m-#ifdef _WINDOWS[m
[31m-#include <windows.h>[m
[31m-BOOL APIENTRY DllMain( HANDLE hModule,[m
[31m-                       DWORD ul_reason_for_call,[m
[31m-                       LPVOID lpReserved )[m
[31m-{[m
[31m-    return TRUE;[m
[31m-}[m
[31m-#else[m
[31m-#include <errno.h>[m
[31m-#include <string.h>[m
[31m-[m
[31m-extern int errno;[m
[31m-#endif[m
[31m-[m
[31m-SendPluginEv SendPluginEvent;[m
[31m-[m
[31m-string g_GetSysErrMsg( void )[m
[31m-{[m
[31m-    string strError = "Unknown";[m
[31m-    // Problem loading[m
[31m-#ifdef _WINDOWS[m
[31m-    int nErrorCode = GetLastError();[m
[31m-    LPTSTR s;[m
[31m-    if ( ::FormatMessage( FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM,[m
[31m-    NULL, nErrorCode, 0, ( LPTSTR ) &s, 0, NULL ) )[m
[31m-    {[m
[31m-        strError = s;[m
[31m-    }[m
[31m-    else[m
[31m-    {[m
[31m-        char szBuf[ 20 ];[m
[31m-        _snprintf_s( szBuf, _countof(szBuf), 19, "%d", nErrorCode );[m
[31m-        strError = szBuf;[m
[31m-    }[m
[31m-#else[m
[31m-    char szError[80];[m
[31m-    if ( strerror_r( errno, szError, sizeof(szError)  ) )[m
[31m-    {[m
[31m-        strError = "no description found";[m
[31m-    }[m
[31m-    else[m
[31m-    {[m
[31m-        strError = szError;[m
[31m-    }[m
[31m-#endif[m
[31m-    return strError;[m
[31m-}[m
[31m-[m
[31m-void g_sleep( unsigned int mseconds )[m
[31m-{[m
[31m-#ifdef _WINDOWS[m
[31m-    Sleep( mseconds );[m
[31m-#else[m
[31m-    usleep( mseconds * 1000 );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-string& g_trim( string& str )[m
[31m-{[m
[31m-    // Whitespace characters[m
[31m-    char whspc[] = " \t\r\n\v\f";[m
[31m-[m
[31m-    // Whack off first part[m
[31m-    size_t pos = str.find_first_not_of( whspc );[m
[31m-[m
[31m-    if ( pos != string::npos )[m
[31m-        str.replace( 0, pos, "" );[m
[31m-[m
[31m-    // Whack off trailing stuff[m
[31m-    pos = str.find_last_not_of( whspc );[m
[31m-[m
[31m-    if ( pos != string::npos )[m
[31m-        str.replace( pos + 1, str.length() - pos, "" );[m
[31m-[m
[31m-    return str;[m
[31m-}[m
[31m-[m
[31m-void g_tokenize( const string& str, const string& delimiters, vector<string>& tokens )[m
[31m-{[m
[31m-    tokenize( str, tokens, delimiters );[m
[31m-}[m
[31m-[m
[31m-char* SetEventFunc( SendPluginEv funcPtr )[m
[31m-{[m
[31m-    static char * szObjList = onGetObjList();[m
[31m-    SendPluginEvent = funcPtr;[m
[31m-    return szObjList;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const int nMAXSIZE = 512;[m
[31m-char* g_pszRetVal = NULL;[m
[31m-[m
[31m-//-----------------------------------------------------------[m
[31m-// Map from an object Id to an object instance[m
[31m-//-----------------------------------------------------------[m
[31m-typedef std::map<string, JSExt*> StringToJExt_T;[m
[31m-[m
[31m-//-----------------------------------------------------------[m
[31m-// Map from a browser context to an id mapping[m
[31m-//-----------------------------------------------------------[m
[31m-typedef std::map<void*, StringToJExt_T*> VoidToMap_T;[m
[31m-[m
[31m-VoidToMap_T g_context2Map;[m
[31m-[m
[31m-class GlobalSharedModule[m
[31m-{[m
[31m-[m
[31m-public:[m
[31m-    GlobalSharedModule( void )[m
[31m-    {[m
[31m-        g_pszRetVal = new char[ nMAXSIZE ];[m
[31m-    }[m
[31m-[m
[31m-    ~GlobalSharedModule()[m
[31m-    {[m
[31m-        delete [] g_pszRetVal;[m
[31m-[m
[31m-        VoidToMap_T::iterator posMaps;[m
[31m-[m
[31m-        for ( posMaps = g_context2Map.begin(); posMaps != g_context2Map.end(); ++posMaps )[m
[31m-        {[m
[31m-            StringToJExt_T& id2Obj = *posMaps->second;[m
[31m-            StringToJExt_T::iterator posMap;[m
[31m-[m
[31m-            for ( posMap = id2Obj.begin(); posMap != id2Obj.end(); ++posMap )[m
[31m-            {[m
[31m-                JSExt* pJSExt = posMap->second;[m
[31m-[m
[31m-                if ( pJSExt->CanDelete() )[m
[31m-                {[m
[31m-                    delete pJSExt;[m
[31m-                }[m
[31m-            }[m
[31m-[m
[31m-            id2Obj.erase( id2Obj.begin(), id2Obj.end() );[m
[31m-        }[m
[31m-[m
[31m-        g_context2Map.erase( g_context2Map.begin(), g_context2Map.end() );[m
[31m-    }[m
[31m-};[m
[31m-[m
[31m-GlobalSharedModule g_sharedModule;[m
[31m-[m
[31m-char* g_str2global( const string& strRetVal )[m
[31m-{[m
[31m-    int nLen = strRetVal.size();[m
[31m-[m
[31m-    if ( nLen >= nMAXSIZE )[m
[31m-    {[m
[31m-        delete [] g_pszRetVal;[m
[31m-        g_pszRetVal = new char[ nLen + 1 ];[m
[31m-    }[m
[31m-[m
[31m-    else[m
[31m-    {[m
[31m-        // To minimaize the number of memory reallocations, the assumption[m
[31m-        // is that in most times this will be the case[m
[31m-        delete [] g_pszRetVal;[m
[31m-        g_pszRetVal = new char[ nMAXSIZE ];[m
[31m-    }[m
[31m-[m
[31m-    strcpy( g_pszRetVal, strRetVal.c_str() );[m
[31m-    return g_pszRetVal;[m
[31m-}[m
[31m-[m
[31m-bool g_unregisterObject( const string& strObjId, void* pContext )[m
[31m-{[m
[31m-    // Called by the plugin extension implementation[m
[31m-    // if the extension handles the deletion of its object[m
[31m-[m
[31m-    StringToJExt_T * pID2Obj = NULL;[m
[31m-[m
[31m-    VoidToMap_T::iterator iter = g_context2Map.find( pContext );[m
[31m-[m
[31m-    if ( iter != g_context2Map.end() )[m
[31m-    {[m
[31m-        pID2Obj = iter->second;[m
[31m-    }[m
[31m-    else[m
[31m-    {[m
[31m-        return false;[m
[31m-    }[m
[31m-[m
[31m-    StringToJExt_T& mapID2Obj = *pID2Obj;[m
[31m-[m
[31m-    StringToJExt_T::iterator r = mapID2Obj.find( strObjId );[m
[31m-[m
[31m-    if ( r == mapID2Obj.end() )[m
[31m-    {[m
[31m-        return false;[m
[31m-    }[m
[31m-[m
[31m-    mapID2Obj.erase( strObjId );[m
[31m-    return true;[m
[31m-}[m
[31m-[m
[31m-char* InvokeFunction( const char* szCommand, void* pContext )[m
[31m-{[m
[31m-    StringToJExt_T * pID2Obj = NULL;[m
[31m-[m
[31m-    VoidToMap_T::iterator iter = g_context2Map.find( pContext );[m
[31m-[m
[31m-    if ( iter != g_context2Map.end() )[m
[31m-    {[m
[31m-        pID2Obj = iter->second;[m
[31m-    }[m
[31m-    else[m
[31m-    {[m
[31m-        pID2Obj = new StringToJExt_T;[m
[31m-        g_context2Map[ pContext ] = pID2Obj;[m
[31m-    }[m
[31m-[m
[31m-    StringToJExt_T& mapID2Obj = *pID2Obj;[m
[31m-[m
[31m-    string strFullCommand = szCommand;[m
[31m-    vector<string> arParams;[m
[31m-    g_tokenize( strFullCommand, " ", arParams );[m
[31m-    string strCommand = arParams[ 0 ];[m
[31m-    string strRetVal = szERROR;[m
[31m-[m
[31m-    if ( strCommand == szCREATE )[m
[31m-    {[m
[31m-        string strClassName = arParams[ 1 ];[m
[31m-        string strObjId = arParams[ 2 ];[m
[31m-[m
[31m-        StringToJExt_T::iterator r = mapID2Obj.find( strObjId );[m
[31m-[m
[31m-        if ( r != mapID2Obj.end() )[m
[31m-        {[m
[31m-            strRetVal += strObjId;[m
[31m-            strRetVal += " :Object already exists.";[m
[31m-            return g_str2global( strRetVal );[m
[31m-        }[m
[31m-[m
[31m-        JSExt* pJSExt = onCreateObject( strClassName, strObjId );[m
[31m-[m
[31m-        if ( pJSExt == NULL )[m
[31m-        {[m
[31m-            strRetVal += strObjId;[m
[31m-            strRetVal += " :Unknown object type ";[m
[31m-            strRetVal += strClassName;[m
[31m-            return g_str2global( strRetVal );[m
[31m-        }[m
[31m-[m
[31m-        pJSExt->m_pContext = pContext;[m
[31m-        mapID2Obj[ strObjId ] = pJSExt;[m
[31m-[m
[31m-        strRetVal = szOK;[m
[31m-        strRetVal += strObjId;[m
[31m-        return g_str2global( strRetVal );[m
[31m-    }[m
[31m-    else[m
[31m-    if ( strCommand == szINVOKE )[m
[31m-    {[m
[31m-        string strObjId = arParams[ 1 ];[m
[31m-        string strMethod = arParams[ 2 ];[m
[31m-[m
[31m-        StringToJExt_T::iterator r = mapID2Obj.find( strObjId );[m
[31m-[m
[31m-        if ( r == mapID2Obj.end() )[m
[31m-        {[m
[31m-            strRetVal += strObjId;[m
[31m-            strRetVal += " :No object found for id.";[m
[31m-            return g_str2global( strRetVal );[m
[31m-        }[m
[31m-[m
[31m-        JSExt* pJSExt = r->second;[m
[31m-[m
[31m-        size_t nLoc = strFullCommand.find( strObjId );[m
[31m-[m
[31m-        if ( nLoc == string::npos )[m
[31m-        {[m
[31m-            strRetVal += strObjId;[m
[31m-            strRetVal += " :Internal InvokeMethod error.";[m
[31m-            return g_str2global( strRetVal );[m
[31m-        }[m
[31m-[m
[31m-        if ( strMethod == szDISPOSE )[m
[31m-        {[m
[31m-            StringToJExt_T::iterator r = mapID2Obj.find( strObjId );[m
[31m-[m
[31m-            if ( r == mapID2Obj.end() )[m
[31m-            {[m
[31m-                strRetVal = szERROR;[m
[31m-                strRetVal += strObjId;[m
[31m-                return g_str2global( strRetVal );[m
[31m-            }[m
[31m-[m
[31m-            JSExt * pJSExt = mapID2Obj[ strObjId ];[m
[31m-[m
[31m-            if ( pJSExt->CanDelete() )[m
[31m-            {[m
[31m-                delete pJSExt;[m
[31m-            }[m
[31m-[m
[31m-            mapID2Obj.erase( strObjId );[m
[31m-            strRetVal = szOK;[m
[31m-            strRetVal += strObjId;[m
[31m-            return g_str2global( strRetVal );[m
[31m-        }[m
[31m-[m
[31m-        size_t nSuffixLoc = nLoc + strObjId.size();[m
[31m-        string strInvoke = strFullCommand.substr( nSuffixLoc );[m
[31m-        strInvoke = g_trim( strInvoke );[m
[31m-        strRetVal = pJSExt->InvokeMethod( strInvoke );[m
[31m-        return g_str2global( strRetVal );[m
[31m-    }[m
[31m-[m
[31m-    strRetVal += " :Unknown command ";[m
[31m-    strRetVal += strCommand;[m
[31m-    return g_str2global( strRetVal );[m
[31m-}[m
[31m-[m
[31m-//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/plugin.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/plugin.h[m
[1mdeleted file mode 100644[m
[1mindex 4ef7116..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/plugin.h[m
[1m+++ /dev/null[m
[36m@@ -1,70 +0,0 @@[m
[31m-#ifndef _PLUGIN_H[m
[31m-#define _PLUGIN_H[m
[31m-[m
[31m-#include <map>[m
[31m-#include <string>[m
[31m-#include <vector>[m
[31m-#include <unistd.h>[m
[31m-//#include "tokenizer.h"[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%[m
[31m-//%% Functions exported by this DLL[m
[31m-//%% Should always be only SetEventFunc and InvokeFunction[m
[31m-//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%[m
[31m-// g++ requires extern "C" otherwise the names of SetEventFunc and InvokeFunction[m
[31m-// are mangled C++ style. MS Visual Studio doesn't seem to care though.[m
[31m-extern "C"[m
[31m-{[m
[31m-    typedef void (*SendPluginEv)( const char* szEvent, void* pContext );[m
[31m-    char* SetEventFunc(SendPluginEv funcPtr);[m
[31m-    char* InvokeFunction( const char* szCommand, void* pContext );[m
[31m-}[m
[31m-[m
[31m-// JNEXT Framework function of the form:[m
[31m-// typedef void (*SendPluginEv)( const char* szEvent );[m
[31m-// used to notify JavaScript of an asynchronous event[m
[31m-extern SendPluginEv SendPluginEvent;[m
[31m-[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-// Constants and methods common to all JNEXT extensions types[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-#define szERROR         "Error "[m
[31m-#define szOK            "Ok "[m
[31m-[m
[31m-#define szDISPOSE       "Dispose"[m
[31m-#define szINVOKE        "InvokeMethod"[m
[31m-#define szCREATE        "CreateObj"[m
[31m-[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-// Utility functions[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-string& g_trim( string& str );[m
[31m-void g_tokenize(const string& str,const string& delimiters, vector<string>& tokens);[m
[31m-char* g_str2static( const string& strRetVal );[m
[31m-void g_sleep( unsigned int mseconds );[m
[31m-bool g_unregisterObject( const string& strObjId, void* pContext );[m
[31m-[m
[31m-[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-// Abstract extension object[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-class JSExt[m
[31m-{[m
[31m-public:[m
[31m-    virtual ~JSExt() {};[m
[31m-    virtual string InvokeMethod( const string& strCommand ) = 0;[m
[31m-    virtual bool CanDelete( void ) = 0;[m
[31m-    virtual void TryDelete( void ) {}[m
[31m-public:[m
[31m-    void* m_pContext;[m
[31m-};[m
[31m-[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-// Callback functions to be implemented by the plugin implementation[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-extern char* onGetObjList( void );[m
[31m-extern JSExt* onCreateObject( const string& strClassName, const string& strObjId );[m
[31m-[m
[31m-#endif[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/tokenizer.cpp b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/tokenizer.cpp[m
[1mdeleted file mode 100644[m
[1mindex 4a39573..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/tokenizer.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,222 +0,0 @@[m
[31m-/************************************************************************[m
[31m-The zlib/libpng License[m
[31m-[m
[31m-Copyright (c) 2006 Joerg Wiedenmann[m
[31m-[m
[31m-This software is provided 'as-is', without any express or implied warranty.[m
[31m-In no event will the authors be held liable for any damages arising from[m
[31m-the use of this software.[m
[31m-[m
[31m-Permission is granted to anyone to use this software for any purpose,[m
[31m-including commercial applications, and to alter it and redistribute it[m
[31m-freely, subject to the following restrictions:[m
[31m-[m
[31m-1. The origin of this software must not be misrepresented;[m
[31m-you must not claim that you wrote the original software.[m
[31m-If you use this software in a product, an acknowledgment[m
[31m-in the product documentation would be appreciated but is[m
[31m-not required.[m
[31m-[m
[31m-2. Altered source versions must be plainly marked as such,[m
[31m-and must not be misrepresented as being the original software.[m
[31m-[m
[31m-3. This notice may not be removed or altered from any source distribution.[m
[31m-[m
[31m-***********************************************************************/[m
[31m-[m
[31m-/********************************************************************[m
[31m-	created:	2006-01-28[m
[31m-	filename: 	tokenizer.cpp[m
[31m-	author:		Jrg Wiedenmann[m
[31m-	[m
[31m-	purpose:	A tokenizer function which provides a very[m
[31m-				customizable way of breaking up strings.[m
[31m-[m
[31m-	history:	2006-01-28, Original version[m
[31m-				2006-03-04, Fixed a small parsing bug, thanks Elias.[m
[31m-*********************************************************************/[m
[31m-[m
[31m-#include "tokenizer.h"[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-void tokenize ( const string& str, vector<string>& result,[m
[31m-			   const string& delimiters, const string& delimiters_preserve,[m
[31m-			   const string& quote, const string& esc )[m
[31m-{[m
[31m-	// clear the vector[m
[31m-	if ( false == result.empty() )[m
[31m-	{[m
[31m-		result.clear();[m
[31m-	}[m
[31m-[m
[31m-	string::size_type pos = 0; // the current position (char) in the string[m
[31m-	char ch = 0; // buffer for the current character[m
[31m-	char delimiter = 0;	// the buffer for the delimiter char which[m
[31m-							// will be added to the tokens if the delimiter[m
[31m-							// is preserved[m
[31m-	char current_quote = 0; // the char of the current open quote[m
[31m-	bool quoted = false; // indicator if there is an open quote[m
[31m-	string token;  // string buffer for the token[m
[31m-	bool token_complete = false; // indicates if the current token is[m
[31m-								 // read to be added to the result vector[m
[31m-	string::size_type len = str.length();  // length of the input-string[m
[31m-[m
[31m-	// for every char in the input-string[m
[31m-	while ( len > pos )[m
[31m-	{[m
[31m-		// get the character of the string and reset the delimiter buffer[m
[31m-		ch = str.at(pos);[m
[31m-		delimiter = 0;[m
[31m-[m
[31m-		// assume ch isn't a delimiter[m
[31m-		bool add_char = true;[m
[31m-[m
[31m-		// check ...[m
[31m-[m
[31m-		// ... if the delimiter is an escaped character[m
[31m-		bool escaped = false; // indicates if the next char is protected[m
[31m-		if ( false == esc.empty() ) // check if esc-chars are  provided[m
[31m-		{[m
[31m-			if ( string::npos != esc.find_first_of(ch) )[m
[31m-			{[m
[31m-				// get the escaped char[m
[31m-				++pos;[m
[31m-				if ( pos < len ) // if there are more chars left[m
[31m-				{[m
[31m-					// get the next one[m
[31m-					ch = str.at(pos);[m
[31m-[m
[31m-					// add the escaped character to the token[m
[31m-					add_char = true;[m
[31m-				}[m
[31m-				else // cannot get any more characters[m
[31m-				{[m
[31m-					// don't add the esc-char[m
[31m-					add_char = false;[m
[31m-				}[m
[31m-[m
[31m-				// ignore the remaining delimiter checks[m
[31m-				escaped = true;[m
[31m-			}[m
[31m-		}[m
[31m-[m
[31m-		// ... if the delimiter is a quote[m
[31m-		if ( false == quote.empty() && false == escaped )[m
[31m-		{[m
[31m-			// if quote chars are provided and the char isn't protected[m
[31m-			if ( string::npos != quote.find_first_of(ch) )[m
[31m-			{[m
[31m-				// if not quoted, set state to open quote and set[m
[31m-				// the quote character[m
[31m-				if ( false == quoted )[m
[31m-				{[m
[31m-					quoted = true;[m
[31m-					current_quote = ch;[m
[31m-[m
[31m-					// don't add the quote-char to the token[m
[31m-					add_char = false;[m
[31m-				}[m
[31m-				else // if quote is open already[m
[31m-				{[m
[31m-					// check if it is the matching character to close it[m
[31m-					if ( current_quote == ch )[m
[31m-					{[m
[31m-						// close quote and reset the quote character[m
[31m-						quoted = false;[m
[31m-						current_quote = 0;[m
[31m-[m
[31m-						// don't add the quote-char to the token[m
[31m-						add_char = false;[m
[31m-					}[m
[31m-				} // else[m
[31m-			}[m
[31m-		}[m
[31m-[m
[31m-		// ... if the delimiter isn't preserved[m
[31m-		if ( false == delimiters.empty() && false == escaped &&[m
[31m-			 false == quoted )[m
[31m-		{[m
[31m-			// if a delimiter is provided and the char isn't protected by[m
[31m-			// quote or escape char[m
[31m-			if ( string::npos != delimiters.find_first_of(ch) )[m
[31m-			{[m
[31m-				// if ch is a delimiter and the token string isn't empty[m
[31m-				// the token is complete[m
[31m-				if ( false == token.empty() ) // BUGFIX: 2006-03-04[m
[31m-				{[m
[31m-					token_complete = true;[m
[31m-				}[m
[31m-[m
[31m-				// don't add the delimiter to the token[m
[31m-				add_char = false;[m
[31m-			}[m
[31m-		}[m
[31m-[m
[31m-		// ... if the delimiter is preserved - add it as a token[m
[31m-		bool add_delimiter = false;[m
[31m-		if ( false == delimiters_preserve.empty() && false == escaped &&[m
[31m-			 false == quoted )[m
[31m-		{[m
[31m-			// if a delimiter which will be preserved is provided and the[m
[31m-			// char isn't protected by quote or escape char[m
[31m-			if ( string::npos != delimiters_preserve.find_first_of(ch) )[m
[31m-			{[m
[31m-				// if ch is a delimiter and the token string isn't empty[m
[31m-				// the token is complete[m
[31m-				if ( false == token.empty() ) // BUGFIX: 2006-03-04[m
[31m-				{[m
[31m-					token_complete = true;[m
[31m-				}[m
[31m-[m
[31m-				// don't add the delimiter to the token[m
[31m-				add_char = false;[m
[31m-[m
[31m-				// add the delimiter[m
[31m-				delimiter = ch;[m
[31m-				add_delimiter = true;[m
[31m-			}[m
[31m-		}[m
[31m-[m
[31m-[m
[31m-		// add the character to the token[m
[31m-		if ( true == add_char )[m
[31m-		{[m
[31m-			// add the current char[m
[31m-			token.push_back( ch );[m
[31m-		}[m
[31m-[m
[31m-		// add the token if it is complete[m
[31m-		if ( true == token_complete && false == token.empty() )[m
[31m-		{[m
[31m-			// add the token string[m
[31m-			result.push_back( token );[m
[31m-[m
[31m-			// clear the contents[m
[31m-			token.clear();[m
[31m-[m
[31m-			// build the next token[m
[31m-			token_complete = false;[m
[31m-		}[m
[31m-[m
[31m-		// add the delimiter[m
[31m-		if ( true == add_delimiter )[m
[31m-		{[m
[31m-			// the next token is the delimiter[m
[31m-			string delim_token;[m
[31m-			delim_token.push_back( delimiter );[m
[31m-			result.push_back( delim_token );[m
[31m-[m
[31m-			// REMOVED: 2006-03-04, Bugfix[m
[31m-		}[m
[31m-[m
[31m-		// repeat for the next character[m
[31m-		++pos;[m
[31m-	} // while[m
[31m-[m
[31m-	// add the final token[m
[31m-	if ( false == token.empty() )[m
[31m-	{[m
[31m-		result.push_back( token );[m
[31m-	}[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/tokenizer.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/tokenizer.h[m
[1mdeleted file mode 100644[m
[1mindex 75f567c..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/public/tokenizer.h[m
[1m+++ /dev/null[m
[36m@@ -1,55 +0,0 @@[m
[31m-/************************************************************************[m
[31m-The zlib/libpng License[m
[31m-[m
[31m-Copyright (c) 2006 Joerg Wiedenmann[m
[31m-[m
[31m-This software is provided 'as-is', without any express or implied warranty.[m
[31m-In no event will the authors be held liable for any damages arising from[m
[31m-the use of this software.[m
[31m-[m
[31m-Permission is granted to anyone to use this software for any purpose,[m
[31m-including commercial applications, and to alter it and redistribute it[m
[31m-freely, subject to the following restrictions:[m
[31m-[m
[31m-1. The origin of this software must not be misrepresented;[m
[31m-	you must not claim that you wrote the original software.[m
[31m-	If you use this software in a product, an acknowledgment[m
[31m-	in the product documentation would be appreciated but is[m
[31m-	not required.[m
[31m-[m
[31m-2. Altered source versions must be plainly marked as such,[m
[31m-	and must not be misrepresented as being the original software.[m
[31m-[m
[31m-3. This notice may not be removed or altered from any source distribution.[m
[31m-[m
[31m-***********************************************************************/[m
[31m-[m
[31m-/********************************************************************[m
[31m-	created:	2006-01-28[m
[31m-	filename: 	tokenizer.cpp[m
[31m-	author:		Jrg Wiedenmann[m
[31m-[m
[31m-	purpose:	A tokenizer function which provides a very[m
[31m-				customizable way of breaking up strings.[m
[31m-*********************************************************************/[m
[31m-[m
[31m-#include <vector>[m
[31m-#include <string>[m
[31m-using namespace std;[m
[31m-[m
[31m-// Function to break up a string into tokens[m
[31m-//[m
[31m-// Parameters:[m
[31m-//-----------[m
[31m-// str = the input string that will be tokenized[m
[31m-// result = the tokens for str[m
[31m-// delimiters = the delimiter characters[m
[31m-// delimiters preserve = same as above, but the delimiter characters[m
[31m-//		will be put into the result as a token[m
[31m-// quote = characters to protect the enclosed characters[m
[31m-// esc = characters to protect a single character[m
[31m-//[m
[31m-[m
[31m-void tokenize ( const string& str, vector<string>& result,[m
[31m-			const string& delimiters, const string& delimiters_preserve = "",[m
[31m-			const string& quote = "\"", const string& esc = "\\" );[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/libKeyboard.so b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/libKeyboard.so[m
[1mdeleted file mode 100755[m
[1mindex 0bf122d..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/libKeyboard.so and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/json_reader.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/json_reader.o[m
[1mdeleted file mode 100644[m
[1mindex 16859fd..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/json_reader.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/json_value.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/json_value.o[m
[1mdeleted file mode 100644[m
[1mindex 396e7e4..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/json_value.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/json_writer.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/json_writer.o[m
[1mdeleted file mode 100644[m
[1mindex 7d1452d..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/json_writer.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/plugin.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/plugin.o[m
[1mdeleted file mode 100644[m
[1mindex 1304845..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/plugin.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/tokenizer.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/tokenizer.o[m
[1mdeleted file mode 100644[m
[1mindex 4b4683c..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/public/tokenizer.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/src/CallKeyboard.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/src/CallKeyboard.o[m
[1mdeleted file mode 100644[m
[1mindex c67ac9e..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/src/CallKeyboard.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/src/Logger.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/src/Logger.o[m
[1mdeleted file mode 100644[m
[1mindex 7bb472f..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/src/Logger.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/src/keyboard_js.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/src/keyboard_js.o[m
[1mdeleted file mode 100644[m
[1mindex 2a57835..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/src/keyboard_js.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/src/keyboard_ndk.o b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/src/keyboard_ndk.o[m
[1mdeleted file mode 100644[m
[1mindex 989dc0b..0000000[m
Binary files a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/simulator/src/keyboard_ndk.o and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/Logger.cpp b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/Logger.cpp[m
[1mdeleted file mode 100644[m
[1mindex 57b7075..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/Logger.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,104 +0,0 @@[m
[31m-/*[m
[31m- * Copyright (c) 2013 BlackBerry Limited[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- * http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-#include "Logger.hpp"[m
[31m-#include "keyboard_js.hpp"[m
[31m-#include <slog2.h>[m
[31m-[m
[31m-namespace webworks {[m
[31m-[m
[31m-Logger::Logger(const char* name, Keyboard_JS *parent): m_pParent(parent) {[m
[31m-	buffer_config.buffer_set_name = name;[m
[31m-	buffer_config.num_buffers = 2;[m
[31m-	buffer_config.verbosity_level = SLOG2_DEBUG1;[m
[31m-[m
[31m-	/* Configure the first buffer, using 7 x 4KB pages.  This larger buffer will be used for[m
[31m-	   very chatty logging.  Our goal is to have 30-60 seconds of history at any given time,[m
[31m-	   so we will want to log at a rate of around one log line with a string of 16 bytes[m
[31m-	   long every 150 milliseconds.[m
[31m-	*/[m
[31m-[m
[31m-	buffer_config.buffer_config[0].buffer_name = "low_priority";[m
[31m-	buffer_config.buffer_config[0].num_pages = 7;[m
[31m-[m
[31m-	/* Configure the second buffer, which we will use for high level info logging that is very[m
[31m-	   infrequent, but we want a longer history (hours or maybe even over a day or two).  This[m
[31m-	   buffer uses 1 x 4KB.[m
[31m-	*/[m
[31m-[m
[31m-	buffer_config.buffer_config[1].buffer_name = "high_priority";[m
[31m-	buffer_config.buffer_config[1].num_pages = 1;[m
[31m-[m
[31m-	/* Register the buffer set. */[m
[31m-[m
[31m-	if( -1 == slog2_register( &buffer_config, buffer_handle, 0 ) ) {[m
[31m-		fprintf( stderr, "Error registering slogger2 buffer!\n" );[m
[31m-	} else {[m
[31m-		info("Created slogger2 buffers");[m
[31m-	}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-Logger::~Logger() {[m
[31m-	critical("slogger2 buffers reset");[m
[31m-	slog2_reset();[m
[31m-}[m
[31m-[m
[31m-int Logger::log(slog2_buffer_t buffer, _Uint8t severity, const char* message) {[m
[31m-	return slog2c(buffer, 0, severity, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::debug(const char* message) {[m
[31m-	return log(lowPriorityBuffer(), SLOG2_DEBUG1, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::info(const char* message) {[m
[31m-	return log(lowPriorityBuffer(), SLOG2_INFO, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::notice(const char* message) {[m
[31m-	return log(lowPriorityBuffer(), SLOG2_NOTICE, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::warn(const char* message) {[m
[31m-	return log(lowPriorityBuffer(), SLOG2_WARNING, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::error(const char* message) {[m
[31m-	return log(hiPriorityBuffer(), SLOG2_ERROR, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::critical(const char* message) {[m
[31m-	return log(hiPriorityBuffer(), SLOG2_CRITICAL, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::setVerbosity(_Uint8t verbosity) {[m
[31m-	return slog2_set_verbosity(buffer_handle[0], verbosity);[m
[31m-}[m
[31m-[m
[31m-_Uint8t Logger::getVerbosity() {[m
[31m-	return slog2_get_verbosity(buffer_handle[0]);[m
[31m-}[m
[31m-[m
[31m-slog2_buffer_t Logger::hiPriorityBuffer() {[m
[31m-	return buffer_handle[1];[m
[31m-}[m
[31m-[m
[31m-slog2_buffer_t Logger::lowPriorityBuffer() {[m
[31m-	return buffer_handle[0];[m
[31m-}[m
[31m-[m
[31m-} /* namespace webworks */[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/Logger.hpp b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/Logger.hpp[m
[1mdeleted file mode 100644[m
[1mindex ca379ca..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/Logger.hpp[m
[1m+++ /dev/null[m
[36m@@ -1,49 +0,0 @@[m
[31m-/*[m
[31m- * Copyright (c) 2013 BlackBerry Limited[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- * http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-#ifndef LOGGER_HPP_[m
[31m-#define LOGGER_HPP_[m
[31m-[m
[31m-#include <string>[m
[31m-#include <slog2.h>[m
[31m-[m
[31m-class Keyboard_JS;[m
[31m-[m
[31m-namespace webworks {[m
[31m-[m
[31m-class Logger {[m
[31m-public:[m
[31m-	explicit Logger(const char* name, Keyboard_JS *parent = NULL);[m
[31m-	virtual ~Logger();[m
[31m-	int debug(const char* message);[m
[31m-	int info(const char* message);[m
[31m-	int notice(const char* message);[m
[31m-	int warn(const char* message);[m
[31m-	int error(const char* message);[m
[31m-	int critical(const char* message);[m
[31m-	int setVerbosity(_Uint8t verbosity);[m
[31m-	_Uint8t getVerbosity();[m
[31m-	slog2_buffer_t hiPriorityBuffer();[m
[31m-	slog2_buffer_t lowPriorityBuffer();[m
[31m-private:[m
[31m-	Keyboard_JS *m_pParent;[m
[31m-	slog2_buffer_set_config_t buffer_config;[m
[31m-	slog2_buffer_t buffer_handle[2];[m
[31m-	int log(slog2_buffer_t buffer, _Uint8t severity, const char* message);[m
[31m-};[m
[31m-[m
[31m-} /* namespace webworks */[m
[31m-#endif /* LOGGER_HPP_ */[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/keyboard_js.cpp b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/keyboard_js.cpp[m
[1mdeleted file mode 100644[m
[1mindex 64250a1..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/keyboard_js.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,117 +0,0 @@[m
[31m-/*[m
[31m- * Copyright (c) 2013 BlackBerry Limited[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- * http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-#include <string>[m
[31m-#include "../public/tokenizer.h"[m
[31m-#include "keyboard_js.hpp"[m
[31m-#include "keyboard_ndk.hpp"[m
[31m-#include <sstream>[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-/**[m
[31m- * Default constructor.[m
[31m- */[m
[31m-Keyboard_JS::Keyboard_JS(const std::string& id) :[m
[31m-		m_id(id) {[m
[31m-	m_pLogger = new webworks::Logger("Keyboard_JS", this);[m
[31m-	m_pKeyboardController = new webworks::Keyboard_NDK(this);[m
[31m-[m
[31m-[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * Keyboard_JS destructor.[m
[31m- */[m
[31m-Keyboard_JS::~Keyboard_JS() {[m
[31m-	if (m_pKeyboardController)[m
[31m-		delete m_pKeyboardController;[m
[31m-	if (m_pLogger)[m
[31m-		delete m_pLogger;[m
[31m-}[m
[31m-[m
[31m-webworks::Logger* Keyboard_JS::getLog() {[m
[31m-	return m_pLogger;[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * This method returns the list of objects implemented by this native[m
[31m- * extension.[m
[31m- */[m
[31m-char* onGetObjList() {[m
[31m-	static char name[] = "Keyboard_JS";[m
[31m-	return name;[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * This method is used by JNext to instantiate the Keyboard_JS object when[m
[31m- * an object is created on the JavaScript server side.[m
[31m- */[m
[31m-JSExt* onCreateObject(const string& className, const string& id) {[m
[31m-	if (className == "Keyboard_JS") {[m
[31m-		return new Keyboard_JS(id);[m
[31m-	}[m
[31m-[m
[31m-	return NULL;[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * Method used by JNext to determine if the object can be deleted.[m
[31m- */[m
[31m-bool Keyboard_JS::CanDelete() {[m
[31m-	return true;[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * It will be called from JNext JavaScript side with passed string.[m
[31m- * This method implements the interface for the JavaScript to native binding[m
[31m- * for invoking native code. This method is triggered when JNext.invoke is[m
[31m- * called on the JavaScript side with this native objects id.[m
[31m- */[m
[31m-string Keyboard_JS::InvokeMethod(const string& command) {[m
[31m-	// format must be: "command callbackId params"[m
[31m-	size_t commandIndex = command.find_first_of(" ");[m
[31m-	std::string strCommand = command.substr(0, commandIndex);[m
[31m-	size_t callbackIndex = command.find_first_of(" ", commandIndex + 1);[m
[31m-	std::string callbackId = command.substr(commandIndex + 1, callbackIndex - commandIndex - 1);[m
[31m-	std::string arg = command.substr(callbackIndex + 1, command.length());[m
[31m-[m
[31m-	// based on the command given, run the appropriate method in keyboard_ndk.cpp[m
[31m-	if (strCommand == "showKeyboard") {[m
[31m-	    m_pKeyboardController->callKeyboardEmail();[m
[31m-		return "Show Keyboard";[m
[31m-	} else if (strCommand == "closeKeyboard") {[m
[31m-		m_pKeyboardController->cancelKeyboard();[m
[31m-		return "Cancel Keyboard";[m
[31m-	}[m
[31m-	else if(strCommand == "startService"){[m
[31m-	    m_pKeyboardController->keyboardStartThread();[m
[31m-	    return "Starting Service";[m
[31m-	}[m
[31m-[m
[31m-	strCommand.append(";");[m
[31m-	strCommand.append(command);[m
[31m-	return strCommand;[m
[31m-}[m
[31m-[m
[31m-// Notifies JavaScript of an event[m
[31m-void Keyboard_JS::NotifyEvent(const std::string& event) {[m
[31m-	std::string eventString = m_id + " ";[m
[31m-	eventString.append(event);[m
[31m-	SendPluginEvent(eventString.c_str(), m_pContext);[m
[31m-[m
[31m-}[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/keyboard_js.hpp b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/keyboard_js.hpp[m
[1mdeleted file mode 100644[m
[1mindex 1ed3bb7..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/keyboard_js.hpp[m
[1m+++ /dev/null[m
[36m@@ -1,42 +0,0 @@[m
[31m-/*[m
[31m-* Copyright (c) 2013 BlackBerry Limited[m
[31m-*[m
[31m-* Licensed under the Apache License, Version 2.0 (the "License");[m
[31m-* you may not use this file except in compliance with the License.[m
[31m-* You may obtain a copy of the License at[m
[31m-*[m
[31m-* http://www.apache.org/licenses/LICENSE-2.0[m
[31m-*[m
[31m-* Unless required by applicable law or agreed to in writing, software[m
[31m-* distributed under the License is distributed on an "AS IS" BASIS,[m
[31m-* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m-* See the License for the specific language governing permissions and[m
[31m-* limitations under the License.[m
[31m-*/[m
[31m-[m
[31m-#ifndef Keyboard_JS_HPP_[m
[31m-#define Keyboard_JS_HPP_[m
[31m-[m
[31m-#include <string>[m
[31m-#include "../public/plugin.h"[m
[31m-#include "keyboard_ndk.hpp"[m
[31m-#include "Logger.hpp"[m
[31m-[m
[31m-[m
[31m-class Keyboard_JS: public JSExt {[m
[31m-[m
[31m-public:[m
[31m-    explicit Keyboard_JS(const std::string& id);[m
[31m-    virtual ~Keyboard_JS();[m
[31m-    virtual bool CanDelete();[m
[31m-    virtual std::string InvokeMethod(const std::string& command);[m
[31m-    void NotifyEvent(const std::string& event);[m
[31m-    webworks::Logger* getLog();[m
[31m-private:[m
[31m-    std::string m_id;[m
[31m-    webworks::Keyboard_NDK *m_pKeyboardController;[m
[31m-    webworks::Logger *m_pLogger;[m
[31m-[m
[31m-};[m
[31m-[m
[31m-#endif /* Keyboard_JS_HPP_ */[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/keyboard_ndk.cpp b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/keyboard_ndk.cpp[m
[1mdeleted file mode 100644[m
[1mindex 26b2e39..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/keyboard_ndk.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,155 +0,0 @@[m
[31m-/*[m
[31m- * Copyright (c) 2013 BlackBerry Limited[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- * http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-#include <string>[m
[31m-#include <sstream>[m
[31m-#include <json/reader.h>[m
[31m-#include <json/writer.h>[m
[31m-#include <pthread.h>[m
[31m-#include "keyboard_ndk.hpp"[m
[31m-#include "keyboard_js.hpp"[m
[31m-#include <QtCore>[m
[31m-namespace webworks {[m
[31m-[m
[31m-Keyboard_NDK::Keyboard_NDK(Keyboard_JS *parent):[m
[31m-	m_pParent(parent),[m
[31m-	keyboardProperty(50),[m
[31m-	keyboardThreadCount(1),[m
[31m-	threadHalt(true),[m
[31m-	m_thread(0) {[m
[31m-		pthread_cond_t cond  = PTHREAD_COND_INITIALIZER;[m
[31m-		pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;[m
[31m-	   bps_initialize();[m
[31m-[m
[31m-	    virtualkeyboard_request_events(0);[m
[31m-[m
[31m-	    virtualkeyboard_change_options(VIRTUALKEYBOARD_LAYOUT_EMAIL,VIRTUALKEYBOARD_ENTER_DEFAULT);[m
[31m-[m
[31m-		m_pParent->getLog()->info("Keyboard Created");[m
[31m-[m
[31m-[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Keyboard_NDK::~Keyboard_NDK() {[m
[31m-    //bps_shutdown();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// Loops and runs the callback method[m
[31m-void* KeyboardThread(void* parent) {[m
[31m-	Keyboard_NDK *pParent = static_cast<Keyboard_NDK *>(parent);[m
[31m-[m
[31m-	sleep(1);[m
[31m-[m
[31m-	 // 1. Start the library[m
[31m-	 bps_initialize();[m
[31m-[m
[31m-	 // 2. Request events to flow into the event queue[m
[31m-	 virtualkeyboard_request_events(0);[m
[31m-[m
[31m-	 sleep(3);[m
[31m-	 // 3. Use any service at any time[m
[31m-	 //virtualkeyboard_show(); // Show the virtual keyboard[m
[31m-[m
[31m-	 // 4. Listen for events[m
[31m-	 for (;;) {[m
[31m-	   // get an event[m
[31m-	    bps_event_t *event;[m
[31m-	    bps_get_event(&event, -1); // blocking[m
[31m-[m
[31m-	    // handle the event[m
[31m-	    pParent->event(event);[m
[31m-	 }[m
[31m-	 return NULL;[m
[31m-}[m
[31m-[m
[31m-// Starts the thread and returns a message on status[m
[31m-std::string Keyboard_NDK::keyboardStartThread() {[m
[31m-    m_pParent->NotifyEvent("Teste");[m
[31m-    if (!m_thread) {[m
[31m-	    m_pParent->NotifyEvent("Teste");[m
[31m-		int rc;[m
[31m-	    rc = pthread_mutex_lock(&mutex);[m
[31m-	    threadHalt = false;[m
[31m-	    rc = pthread_cond_signal(&cond);[m
[31m-	    rc = pthread_mutex_unlock(&mutex);[m
[31m-[m
[31m-		pthread_attr_t thread_attr;[m
[31m-		pthread_attr_init(&thread_attr);[m
[31m-		pthread_attr_setdetachstate(&thread_attr, PTHREAD_CREATE_JOINABLE);[m
[31m-[m
[31m-		pthread_create(&m_thread, &thread_attr, KeyboardThread,[m
[31m-				static_cast<void *>(this));[m
[31m-		pthread_attr_destroy(&thread_attr);[m
[31m-		//threadCallbackId = callbackId;[m
[31m-		m_pParent->getLog()->info("Thread Started");[m
[31m-		return "Thread Started";[m
[31m-	} else {[m
[31m-		m_pParent->getLog()->warn("Thread Started but already running");[m
[31m-		return "Thread Running";[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void Keyboard_NDK::event(bps_event_t *event) {[m
[31m-    Json::FastWriter writer;[m
[31m-    Json::Value root;[m
[31m-    root["threadCount"] = "10";[m
[31m-    int domain = bps_event_get_domain(event);[m
[31m-      if (domain == virtualkeyboard_get_domain()) {[m
[31m-          int code = bps_event_get_code(event);[m
[31m-          int a;[m
[31m-          std::string str;[m
[31m-          std::string eventString;[m
[31m-          std::ostringstream strs;[m
[31m-          switch(code) {[m
[31m-              case VIRTUALKEYBOARD_EVENT_VISIBLE:[m
[31m-                  eventString = "native.keyboardshow";[m
[31m-                  eventString.append(" ");[m
[31m-                  virtualkeyboard_get_height(&a) ;[m
[31m-                  strs << a;[m
[31m-                  str = strs.str();[m
[31m-                  eventString.append("{\"keyboardHeight\":\""+str+"\"}");[m
[31m-                  m_pParent->NotifyEvent(eventString);[m
[31m-[m
[31m-                  break;[m
[31m-              case VIRTUALKEYBOARD_EVENT_HIDDEN:[m
[31m-[m
[31m-                  m_pParent->NotifyEvent("native.keyboardhide");[m
[31m-                  break;[m
[31m-          }[m
[31m-      }[m
[31m-[m
[31m-}[m
[31m-void Keyboard_NDK::callKeyboardEmail(){[m
[31m-    virtualkeyboard_change_options(VIRTUALKEYBOARD_LAYOUT_EMAIL,VIRTUALKEYBOARD_ENTER_SEND);[m
[31m-    virtualkeyboard_show();[m
[31m-}[m
[31m-[m
[31m-void Keyboard_NDK::callKeyboardNumber(){[m
[31m-[m
[31m-    virtualkeyboard_change_options(VIRTUALKEYBOARD_LAYOUT_NUMBER,VIRTUALKEYBOARD_ENTER_SEND);[m
[31m-    virtualkeyboard_show();[m
[31m-}[m
[31m-void Keyboard_NDK::cancelKeyboard(){[m
[31m-    virtualkeyboard_hide();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-[m
[31m-[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/keyboard_ndk.hpp b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/keyboard_ndk.hpp[m
[1mdeleted file mode 100644[m
[1mindex 0106227..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/blackberry10/native/src/keyboard_ndk.hpp[m
[1m+++ /dev/null[m
[36m@@ -1,71 +0,0 @@[m
[31m-/*[m
[31m-* Copyright (c) 2013 BlackBerry Limited[m
[31m-*[m
[31m-* Licensed under the Apache License, Version 2.0 (the "License");[m
[31m-* you may not use this file except in compliance with the License.[m
[31m-* You may obtain a copy of the License at[m
[31m-*[m
[31m-* http://www.apache.org/licenses/LICENSE-2.0[m
[31m-*[m
[31m-* Unless required by applicable law or agreed to in writing, software[m
[31m-* distributed under the License is distributed on an "AS IS" BASIS,[m
[31m-* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m-* See the License for the specific language governing permissions and[m
[31m-* limitations under the License.[m
[31m-*/[m
[31m-[m
[31m-#ifndef Keyboard_NDK_HPP_[m
[31m-#define Keyboard_NDK_HPP_[m
[31m-[m
[31m-#include <string>[m
[31m-#include <pthread.h>[m
[31m-#include <bb/AbstractBpsEventHandler>[m
[31m-#include <bps/bps.h>[m
[31m-#include<bps/netstatus.h>[m
[31m-#include<bps/locale.h>[m
[31m-#include<bps/virtualkeyboard.h>[m
[31m-#include<bps/navigator.h>[m
[31m-#include <bps/event.h>[m
[31m-#include <string>[m
[31m-#include <sstream>[m
[31m-[m
[31m-class Keyboard_JS;[m
[31m-[m
[31m-namespace webworks {[m
[31m-[m
[31m-class Keyboard_NDK  {[m
[31m-public:[m
[31m-	explicit Keyboard_NDK(Keyboard_JS *parent = NULL);[m
[31m-	virtual ~Keyboard_NDK();[m
[31m-    virtual void event(bps_event_t *event);[m
[31m-[m
[31m-    void callKeyboardEmail(); // Method Calls the Keyboard style Email (default)[m
[31m-[m
[31m-    void callKeyboardNumber(); // Method Calls the Keyboard style number[m
[31m-[m
[31m-    void cancelKeyboard(); // Method cancel the keyboard[m
[31m-[m
[31m-	std::string keyboardStartThread();[m
[31m-[m
[31m-[m
[31m-[m
[31m-[m
[31m-[m
[31m-[m
[31m-[m
[31m-private:[m
[31m-[m
[31m-	Keyboard_JS *m_pParent;[m
[31m-	int keyboardProperty;[m
[31m-	int keyboardThreadCount;[m
[31m-	bool threadHalt;[m
[31m-	std::string threadCallbackId;[m
[31m-	pthread_t m_thread;[m
[31m-	pthread_cond_t cond;[m
[31m-	pthread_mutex_t mutex;[m
[31m-[m
[31m-};[m
[31m-[m
[31m-} // namespace webworks[m
[31m-[m
[31m-#endif /* Keyboard_NDK_HPP_ */[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/ios/IonicKeyboard.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/ios/IonicKeyboard.h[m
[1mdeleted file mode 100644[m
[1mindex b54f430..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/ios/IonicKeyboard.h[m
[1m+++ /dev/null[m
[36m@@ -1,13 +0,0 @@[m
[31m-#import <Cordova/CDVPlugin.h>[m
[31m-[m
[31m-@interface IonicKeyboard : CDVPlugin <UIScrollViewDelegate> {[m
[31m-    @protected[m
[31m-    id _keyboardShowObserver, _keyboardHideObserver;[m
[31m-}[m
[31m-[m
[31m-@property (readwrite, assign) BOOL hideKeyboardAccessoryBar;[m
[31m-@property (readwrite, assign) BOOL disableScroll;[m
[31m-//@property (readwrite, assign) BOOL styleDark;[m
[31m-[m
[31m-@end[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/ios/IonicKeyboard.m b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/ios/IonicKeyboard.m[m
[1mdeleted file mode 100644[m
[1mindex 045cc65..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/ios/IonicKeyboard.m[m
[1m+++ /dev/null[m
[36m@@ -1,160 +0,0 @@[m
[31m-#import "IonicKeyboard.h"[m
[31m-#import "UIWebViewExtension.h"[m
[31m-#import <Cordova/CDVAvailability.h>[m
[31m-[m
[31m-@implementation IonicKeyboard[m
[31m-[m
[31m-@synthesize hideKeyboardAccessoryBar = _hideKeyboardAccessoryBar;[m
[31m-@synthesize disableScroll = _disableScroll;[m
[31m-//@synthesize styleDark = _styleDark;[m
[31m-[m
[31m-- (void)pluginInitialize {[m
[31m-  [m
[31m-    NSNotificationCenter* nc = [NSNotificationCenter defaultCenter];[m
[31m-    __weak IonicKeyboard* weakSelf = self;[m
[31m-[m
[31m-    //set defaults[m
[31m-    self.hideKeyboardAccessoryBar = NO;[m
[31m-    self.disableScroll = NO;[m
[31m-    //self.styleDark = NO;[m
[31m-    [m
[31m-    _keyboardShowObserver = [nc addObserverForName:UIKeyboardWillShowNotification[m
[31m-                               object:nil[m
[31m-                               queue:[NSOperationQueue mainQueue][m
[31m-                               usingBlock:^(NSNotification* notification) {[m
[31m-                                   [m
[31m-                                   CGRect keyboardFrame = [notification.userInfo[UIKeyboardFrameEndUserInfoKey] CGRectValue];[m
[31m-                                   keyboardFrame = [self.viewController.view convertRect:keyboardFrame fromView:nil];[m
[31m-                                   [m
[31m-                                   [weakSelf.commandDelegate evalJs:[NSString stringWithFormat:@"cordova.plugins.Keyboard.isVisible = true; cordova.fireWindowEvent('native.keyboardshow', { 'keyboardHeight': %@ }); ", [@(keyboardFrame.size.height) stringValue]]];[m
[31m-[m
[31m-                                   //deprecated[m
[31m-                                   [weakSelf.commandDelegate evalJs:[NSString stringWithFormat:@"cordova.fireWindowEvent('native.showkeyboard', { 'keyboardHeight': %@ }); ", [@(keyboardFrame.size.height) stringValue]]];[m
[31m-                               }];[m
[31m-    [m
[31m-    _keyboardHideObserver = [nc addObserverForName:UIKeyboardWillHideNotification[m
[31m-                               object:nil[m
[31m-                               queue:[NSOperationQueue mainQueue][m
[31m-                               usingBlock:^(NSNotification* notification) {[m
[31m-                                   [weakSelf.commandDelegate evalJs:@"cordova.plugins.Keyboard.isVisible = false; cordova.fireWindowEvent('native.keyboardhide'); "];[m
[31m-[m
[31m-                                   //deprecated[m
[31m-                                   [weakSelf.commandDelegate evalJs:@"cordova.fireWindowEvent('native.hidekeyboard'); "];[m
[31m-                               }];[m
[31m-}[m
[31m-- (BOOL)disableScroll {[m
[31m-    return _disableScroll;[m
[31m-}[m
[31m-[m
[31m-- (void)setDisableScroll:(BOOL)disableScroll {[m
[31m-    if (disableScroll == _disableScroll) {[m
[31m-        return;[m
[31m-    }[m
[31m-    if (disableScroll) {[m
[31m-        self.webView.scrollView.scrollEnabled = NO;[m
[31m-        self.webView.scrollView.delegate = self;[m
[31m-    }[m
[31m-    else {[m
[31m-        self.webView.scrollView.scrollEnabled = YES;[m
[31m-        self.webView.scrollView.delegate = nil;[m
[31m-    }[m
[31m-[m
[31m-    _disableScroll = disableScroll;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-- (BOOL)hideKeyboardAccessoryBar {[m
[31m-    return _hideKeyboardAccessoryBar;[m
[31m-}[m
[31m-[m
[31m-- (void)setHideKeyboardAccessoryBar:(BOOL)hideKeyboardAccessoryBar {[m
[31m-    if (hideKeyboardAccessoryBar == _hideKeyboardAccessoryBar) {[m
[31m-        return;[m
[31m-    }[m
[31m-    if (hideKeyboardAccessoryBar) {[m
[31m-        self.webView.hackishlyHidesInputAccessoryView = YES;[m
[31m-    }[m
[31m-    else {[m
[31m-        self.webView.hackishlyHidesInputAccessoryView = NO;[m
[31m-    }[m
[31m-[m
[31m-    _hideKeyboardAccessoryBar = hideKeyboardAccessoryBar;[m
[31m-}[m
[31m-[m
[31m-/*[m
[31m-- (BOOL)styleDark {[m
[31m-    return _styleDark;[m
[31m-}[m
[31m-[m
[31m-- (void)setStyleDark:(BOOL)styleDark {[m
[31m-    if (styleDark == _styleDark) {[m
[31m-        return;[m
[31m-    }[m
[31m-    if (styleDark) {[m
[31m-        self.webView.styleDark = YES;[m
[31m-    }[m
[31m-    else {[m
[31m-        self.webView.styleDark = NO;[m
[31m-    }[m
[31m-[m
[31m-    _styleDark = styleDark;[m
[31m-}[m
[31m-*/[m
[31m-[m
[31m-[m
[31m-/* ------------------------------------------------------------- */[m
[31m-[m
[31m-- (void)scrollViewDidScroll:(UIScrollView *)scrollView {[m
[31m-    [scrollView setContentOffset: CGPointZero];[m
[31m-}[m
[31m-[m
[31m-/* ------------------------------------------------------------- */[m
[31m-[m
[31m-- (void)dealloc {[m
[31m-    NSNotificationCenter* nc = [NSNotificationCenter defaultCenter];[m
[31m-[m
[31m-    [nc removeObserver:self name:UIKeyboardWillShowNotification object:nil];[m
[31m-    [nc removeObserver:self name:UIKeyboardWillHideNotification object:nil];[m
[31m-}[m
[31m-[m
[31m-/* ------------------------------------------------------------- */[m
[31m-[m
[31m-- (void) disableScroll:(CDVInvokedUrlCommand*)command {[m
[31m-    if (!command.arguments || ![command.arguments count]){[m
[31m-      return;[m
[31m-    }[m
[31m-    id value = [command.arguments objectAtIndex:0];[m
[31m-    [m
[31m-    self.disableScroll = [value boolValue];[m
[31m-}[m
[31m-[m
[31m-- (void) hideKeyboardAccessoryBar:(CDVInvokedUrlCommand*)command {[m
[31m-    if (!command.arguments || ![command.arguments count]){[m
[31m-      return;[m
[31m-    }[m
[31m-    id value = [command.arguments objectAtIndex:0];[m
[31m-    [m
[31m-    self.hideKeyboardAccessoryBar = [value boolValue];[m
[31m-}[m
[31m-[m
[31m-- (void) close:(CDVInvokedUrlCommand*)command {[m
[31m-    [self.webView endEditing:YES];[m
[31m-}[m
[31m-[m
[31m-- (void) show:(CDVInvokedUrlCommand*)command {[m
[31m-    NSLog(@"Showing keyboard not supported in iOS due to platform limitations.");[m
[31m-}[m
[31m-[m
[31m-/*[m
[31m-- (void) styleDark:(CDVInvokedUrlCommand*)command {[m
[31m-    if (!command.arguments || ![command.arguments count]){[m
[31m-      return;[m
[31m-    }[m
[31m-    id value = [command.arguments objectAtIndex:0];[m
[31m-    [m
[31m-    self.styleDark = [value boolValue];[m
[31m-}[m
[31m-*/[m
[31m-[m
[31m-@end[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/ios/UIWebViewExtension.h b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/ios/UIWebViewExtension.h[m
[1mdeleted file mode 100644[m
[1mindex 1d6c293..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/ios/UIWebViewExtension.h[m
[1m+++ /dev/null[m
[36m@@ -1,4 +0,0 @@[m
[31m-@interface UIWebView (HackishAccessoryHiding)[m
[31m-@property (nonatomic, assign) BOOL hackishlyHidesInputAccessoryView;[m
[31m-//@property (nonatomic, assign) BOOL styleDark;[m
[31m-@end[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/ios/UIWebViewExtension.m b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/ios/UIWebViewExtension.m[m
[1mdeleted file mode 100644[m
[1mindex 25403e6..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/ios/UIWebViewExtension.m[m
[1m+++ /dev/null[m
[36m@@ -1,109 +0,0 @@[m
[31m-#import <objc/runtime.h>[m
[31m-#import <UIKit/UIKit.h>[m
[31m-#import "UIWebViewExtension.h"[m
[31m-[m
[31m-//Credit: https://gist.github.com/bjhomer/2048571[m
[31m-//Also: http://stackoverflow.com/a/23398487/1091751[m
[31m-@implementation UIWebView (HackishAccessoryHiding)[m
[31m- [m
[31m-static const char * const hackishFixClassName = "UIWebBrowserViewMinusAccessoryView";[m
[31m-static Class hackishFixClass = Nil;[m
[31m- [m
[31m-- (UIView *)hackishlyFoundBrowserView {[m
[31m-    UIScrollView *scrollView = self.scrollView;[m
[31m-    [m
[31m-    UIView *browserView = nil;[m
[31m-    for (UIView *subview in scrollView.subviews) {[m
[31m-        if ([NSStringFromClass([subview class]) hasPrefix:@"UIWebBrowserView"]) {[m
[31m-            browserView = subview;[m
[31m-            break;[m
[31m-        }[m
[31m-    }[m
[31m-    return browserView;[m
[31m-}[m
[31m- [m
[31m-- (id)methodReturningNil {[m
[31m-    return nil;[m
[31m-}[m
[31m- [m
[31m-- (void)ensureHackishSubclassExistsOfBrowserViewClass:(Class)browserViewClass {[m
[31m-    if (!hackishFixClass) {[m
[31m-        Class newClass = objc_allocateClassPair(browserViewClass, hackishFixClassName, 0);[m
[31m-        IMP nilImp = [self methodForSelector:@selector(methodReturningNil)];[m
[31m-        class_addMethod(newClass, @selector(inputAccessoryView), nilImp, "@@:");[m
[31m-        objc_registerClassPair(newClass);[m
[31m- [m
[31m-        hackishFixClass = newClass;[m
[31m-    }[m
[31m-}[m
[31m- [m
[31m-- (BOOL) hackishlyHidesInputAccessoryView {[m
[31m-    UIView *browserView = [self hackishlyFoundBrowserView];[m
[31m-    return [browserView class] == hackishFixClass;[m
[31m-}[m
[31m- [m
[31m-- (void) setHackishlyHidesInputAccessoryView:(BOOL)value {[m
[31m-    UIView *browserView = [self hackishlyFoundBrowserView];[m
[31m-    if (browserView == nil) {[m
[31m-        return;[m
[31m-    }[m
[31m-    [self ensureHackishSubclassExistsOfBrowserViewClass:[browserView class]];[m
[31m-	[m
[31m-    if (value) {[m
[31m-        object_setClass(browserView, hackishFixClass);[m
[31m-    }[m
[31m-    else {[m
[31m-        Class normalClass = objc_getClass("UIWebBrowserView");[m
[31m-        object_setClass(browserView, normalClass);[m
[31m-    }[m
[31m-    [browserView reloadInputViews];[m
[31m-}[m
[31m-/* ---------------------------------------------------------------- */[m
[31m-[m
[31m-/*[m
[31m-- (UIKeyboardAppearance) darkKeyboardAppearanceTemplateMethod {[m
[31m-    return UIKeyboardAppearanceDark;[m
[31m-}[m
[31m-[m
[31m-- (UIKeyboardAppearance) lightKeyboardAppearanceTemplateMethod {[m
[31m-    return UIKeyboardAppearanceLight;[m
[31m-}[m
[31m-[m
[31m-- (BOOL) styleDark {[m
[31m-    UIView *browserView = [self hackishlyFoundBrowserView];[m
[31m-    if (browserView == nil) {[m
[31m-      return false;[m
[31m-    }[m
[31m-    [m
[31m-    Method m = class_getInstanceMethod( [self class], @selector( darkKeyboardAppearanceTemplateMethod ) );[m
[31m-    IMP imp = method_getImplementation( m );[m
[31m-    [m
[31m-    Method m2 = class_getInstanceMethod( [browserView class], @selector(keyboardAppearance) );[m
[31m-    IMP imp2 = method_getImplementation( m2 );[m
[31m-    [m
[31m-    return imp == imp2;[m
[31m-}[m
[31m- [m
[31m-- (void) setStyleDark:(BOOL)styleDark {[m
[31m-    UIView *browserView = [self hackishlyFoundBrowserView];[m
[31m-    if (browserView == nil) {[m
[31m-        return;[m
[31m-    }[m
[31m-  [m
[31m-    if ( styleDark ) {[m
[31m-      Method m = class_getInstanceMethod( [self class], @selector( darkKeyboardAppearanceTemplateMethod ) );[m
[31m-      IMP imp = method_getImplementation( m );[m
[31m-      const char* typeEncoding = method_getTypeEncoding( m );[m
[31m-      class_replaceMethod( [browserView class], @selector(keyboardAppearance), imp, typeEncoding );[m
[31m-    }[m
[31m-    else {[m
[31m-      Method m = class_getInstanceMethod( [self class], @selector( lightKeyboardAppearanceTemplateMethod ) );[m
[31m-      IMP imp = method_getImplementation( m );[m
[31m-      const char* typeEncoding = method_getTypeEncoding( m );[m
[31m-      class_replaceMethod( [browserView class], @selector(keyboardAppearance), imp, typeEncoding );[m
[31m-    }[m
[31m-}[m
[31m-*/[m
[31m-[m
[31m-@end[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/windows/KeyboardProxy.js b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/windows/KeyboardProxy.js[m
[1mdeleted file mode 100644[m
[1mindex c5f6fd0..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/src/windows/KeyboardProxy.js[m
[1m+++ /dev/null[m
[36m@@ -1,38 +0,0 @@[m
[31m-[m
[31m-/*global Windows, WinJS, cordova, module, require*/[m
[31m-[m
[31m-var inputPane = Windows.UI.ViewManagement.InputPane.getForCurrentView();[m
[31m-var keyboardScrollDisabled = false;[m
[31m-[m
[31m-inputPane.addEventListener('hiding', function() {[m
[31m-    cordova.fireDocumentEvent('native.keyboardhide');[m
[31m-    cordova.plugins.Keyboard.isVisible = false;[m
[31m-});[m
[31m-[m
[31m-inputPane.addEventListener('showing', function(e) {[m
[31m-    if (keyboardScrollDisabled) {[m
[31m-        // this disables automatic scrolling of view contents to show focused control[m
[31m-        e.ensuredFocusedElementInView = true;[m
[31m-    }[m
[31m-    cordova.fireDocumentEvent('native.keyboardshow', { keyboardHeight: e.occludedRect.height });[m
[31m-    cordova.plugins.Keyboard.isVisible = true;[m
[31m-});[m
[31m-[m
[31m-module.exports.disableScroll = function (win, fail, args) {[m
[31m-    var disable = args[0];[m
[31m-    keyboardScrollDisabled = disable;[m
[31m-};[m
[31m-[m
[31m-module.exports.show = function () {[m
[31m-    if (typeof inputPane.tryShow === 'function') {[m
[31m-        inputPane.tryShow();[m
[31m-    }[m
[31m-};[m
[31m-[m
[31m-module.exports.close = function () {[m
[31m-    if (typeof inputPane.tryShow === 'function') {[m
[31m-        inputPane.tryHide();[m
[31m-    }[m
[31m-};[m
[31m-[m
[31m-require("cordova/exec/proxy").add("Keyboard", module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/www/keyboard.js b/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/www/keyboard.js[m
[1mdeleted file mode 100644[m
[1mindex 21b3bf6..0000000[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-ionic-keyboard/www/keyboard.js[m
[1m+++ /dev/null[m
[36m@@ -1,37 +0,0 @@[m
[31m-[m
[31m-var argscheck = require('cordova/argscheck'),[m
[31m-    utils = require('cordova/utils'),[m
[31m-    exec = require('cordova/exec');[m
[31m-[m
[31m-[m
[31m-var Keyboard = function() {[m
[31m-};[m
[31m-[m
[31m-Keyboard.hideKeyboardAccessoryBar = function(hide) {[m
[31m-    exec(null, null, "Keyboard", "hideKeyboardAccessoryBar", [hide]);[m
[31m-};[m
[31m-[m
[31m-Keyboard.close = function() {	[m
[31m-    exec(null, null, "Keyboard", "close", []);[m
[31m-};[m
[31m-[m
[31m-Keyboard.show = function() {[m
[31m-    exec(null, null, "Keyboard", "show", []);[m
[31m-};[m
[31m-[m
[31m-Keyboard.disableScroll = function(disable) {[m
[31m-    exec(null, null, "Keyboard", "disableScroll", [disable]);[m
[31m-};[m
[31m-[m
[31m-/*[m
[31m-Keyboard.styleDark = function(dark) {[m
[31m- exec(null, null, "Keyboard", "styleDark", [dark]);[m
[31m-};[m
[31m-*/[m
[31m-[m
[31m-Keyboard.isVisible = false;[m
[31m-[m
[31m-module.exports = Keyboard;[m
[31m-[m
[31m-[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/CONTRIBUTING.md b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/CONTRIBUTING.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/LICENSE b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/LICENSE[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/NOTICE b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/NOTICE[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/README.md b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 45d4d14..e19d230[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/README.md[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/README.md[m
[36m@@ -1,3 +1,7 @@[m
[32m+[m[32m---[m
[32m+[m[32mtitle: Whitelist[m
[32m+[m[32mdescription: Whitelist external content accessible by your app.[m
[32m+[m[32m---[m
 <!--[m
 # license: Licensed to the Apache Software Foundation (ASF) under one[m
 #         or more contributor license agreements.  See the NOTICE file[m
[36m@@ -23,6 +27,14 @@[m [mThis plugin implements a whitelist policy for navigating the application webview[m
 [m
 :warning: Report issues on the [Apache Cordova issue tracker](https://issues.apache.org/jira/issues/?jql=project%20%3D%20CB%20AND%20status%20in%20%28Open%2C%20%22In%20Progress%22%2C%20Reopened%29%20AND%20resolution%20%3D%20Unresolved%20AND%20component%20%3D%20%22Plugin%20Whitelist%22%20ORDER%20BY%20priority%20DESC%2C%20summary%20ASC%2C%20updatedDate%20DESC)[m
 [m
[32m+[m[32m## Installation[m
[32m+[m
[32m+[m[32mYou can install whitelist plugin with Cordova CLI, from npm:[m
[32m+[m
[32m+[m[32m```[m
[32m+[m[32m$ cordova plugin add cordova-plugin-whitelist[m
[32m+[m[32m$ cordova prepare[m
[32m+[m[32m```[m
 [m
 ## Supported Cordova Platforms[m
 [m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/RELEASENOTES.md b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/RELEASENOTES.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 3242eb2..718fa05[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/RELEASENOTES.md[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/RELEASENOTES.md[m
[36m@@ -20,12 +20,32 @@[m
 -->[m
 # Release Notes[m
 [m
[32m+[m[32m### 1.3.3 (Nov 06, 2017)[m
[32m+[m[32m* [CB-12847](https://issues.apache.org/jira/browse/CB-12847) added `bugs` entry to `package.json`.[m
[32m+[m
[32m+[m[32m### 1.3.2 (Feb 28, 2017)[m
[32m+[m[32m* [CB-12236](https://issues.apache.org/jira/browse/CB-12236) Fixed `RELEASENOTES` for `cordova-plugin-whitelist`[m
[32m+[m
[32m+[m[32m### 1.3.1 (Dec 07, 2016)[m
[32m+[m[32m* [CB-12224](https://issues.apache.org/jira/browse/CB-12224) Updated version and RELEASENOTES.md for release 1.3.1[m
[32m+[m[32m* [CB-11917](https://issues.apache.org/jira/browse/CB-11917) - Remove pull request template checklist item: "iCLA has been submitted…"[m
[32m+[m[32m* Edit package.json license to match SPDX id[m
[32m+[m[32m* [CB-11832](https://issues.apache.org/jira/browse/CB-11832) Incremented plugin version.[m
[32m+[m
[32m+[m[32m### 1.3.0 (Sep 08, 2016)[m
[32m+[m[32m* [CB-11795](https://issues.apache.org/jira/browse/CB-11795) Add 'protective' entry to cordovaDependencies[m
[32m+[m[32m* Updated installation section[m
[32m+[m[32m* Plugin uses `Android Log class` and not `Cordova LOG class`[m
[32m+[m[32m* Add pull request template.[m
[32m+[m[32m* [CB-10866](https://issues.apache.org/jira/browse/CB-10866) Adding engine info to `package.json`[m
[32m+[m[32m* [CB-10996](https://issues.apache.org/jira/browse/CB-10996) Adding front matter to README.md[m
[32m+[m
 ### 1.2.2 (Apr 15, 2016)[m
 * add note about redirects[m
[31m-* CB-10624 remove error message from `whitelist.js`, which leaves it empty[m
[32m+[m[32m* [CB-10624](https://issues.apache.org/jira/browse/CB-10624) remove error message from `whitelist.js`, which leaves it empty[m
 [m
 ### 1.2.1 (Jan 15, 2016)[m
[31m-* CB-10194 info tag prints for ios when not applicable[m
[32m+[m[32m* [CB-10194](https://issues.apache.org/jira/browse/CB-10194) info tag prints for ios when not applicable[m
 [m
 ### 1.2.0 (Nov 18, 2015)[m
 * removed **iOS** engine check from `plugin.xml`[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/de/README.md b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/de/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/es/README.md b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/es/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/fr/README.md b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/fr/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/it/README.md b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/it/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/ja/README.md b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/ja/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/ko/README.md b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/ko/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/pl/README.md b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/pl/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/zh/README.md b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/doc/zh/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/package.json b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/package.json[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex d07a816..811a0a8[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/package.json[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/package.json[m
[36m@@ -1,28 +1,120 @@[m
 {[m
[31m-  "name": "cordova-plugin-whitelist",[m
[31m-  "version": "1.2.2",[m
[31m-  "description": "Cordova Whitelist Plugin",[m
[32m+[m[32m  "_args": [[m
[32m+[m[32m    [[m
[32m+[m[32m      {[m
[32m+[m[32m        "raw": "cordova-plugin-whitelist@1",[m
[32m+[m[32m        "scope": null,[m
[32m+[m[32m        "escapedName": "cordova-plugin-whitelist",[m
[32m+[m[32m        "name": "cordova-plugin-whitelist",[m
[32m+[m[32m        "rawSpec": "1",[m
[32m+[m[32m        "spec": ">=1.0.0 <2.0.0",[m
[32m+[m[32m        "type": "range"[m
[32m+[m[32m      },[m
[32m+[m[32m      "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test"[m
[32m+[m[32m    ][m
[32m+[m[32m  ],[m
[32m+[m[32m  "_from": "cordova-plugin-whitelist@>=1.0.0 <2.0.0",[m
[32m+[m[32m  "_id": "cordova-plugin-whitelist@1.3.3",[m
[32m+[m[32m  "_inCache": true,[m
[32m+[m[32m  "_location": "/cordova-plugin-whitelist",[m
[32m+[m[32m  "_nodeVersion": "6.6.0",[m
[32m+[m[32m  "_npmOperationalInternal": {[m
[32m+[m[32m    "host": "s3://npm-registry-packages",[m
[32m+[m[32m    "tmp": "tmp/cordova-plugin-whitelist-1.3.3.tgz_1510361682681_0.11782261240296066"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmUser": {[m
[32m+[m[32m    "name": "stevegill",[m
[32m+[m[32m    "email": "stevengill97@gmail.com"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmVersion": "4.6.1",[m
[32m+[m[32m  "_phantomChildren": {},[m
[32m+[m[32m  "_requested": {[m
[32m+[m[32m    "raw": "cordova-plugin-whitelist@1",[m
[32m+[m[32m    "scope": null,[m
[32m+[m[32m    "escapedName": "cordova-plugin-whitelist",[m
[32m+[m[32m    "name": "cordova-plugin-whitelist",[m
[32m+[m[32m    "rawSpec": "1",[m
[32m+[m[32m    "spec": ">=1.0.0 <2.0.0",[m
[32m+[m[32m    "type": "range"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_requiredBy": [[m
[32m+[m[32m    "#USER",[m
[32m+[m[32m    "/"[m
[32m+[m[32m  ],[m
[32m+[m[32m  "_resolved": "https://registry.npmjs.org/cordova-plugin-whitelist/-/cordova-plugin-whitelist-1.3.3.tgz",[m
[32m+[m[32m  "_shasum": "b5e85ecdbbfe5aeded40a1bf4ee2372e67d96fb4",[m
[32m+[m[32m  "_shrinkwrap": null,[m
[32m+[m[32m  "_spec": "cordova-plugin-whitelist@1",[m
[32m+[m[32m  "_where": "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test",[m
[32m+[m[32m  "author": {[m
[32m+[m[32m    "name": "Apache Software Foundation"[m
[32m+[m[32m  },[m
[32m+[m[32m  "bugs": {[m
[32m+[m[32m    "url": "https://issues.apache.org/jira/browse/CB"[m
[32m+[m[32m  },[m
   "cordova": {[m
     "platforms": [[m
       "android"[m
     ][m
   },[m
[31m-  "repository": {[m
[31m-    "type": "git",[m
[31m-    "url": "https://github.com/apache/cordova-plugin-whitelist"[m
[32m+[m[32m  "dependencies": {},[m
[32m+[m[32m  "description": "Cordova Whitelist Plugin",[m
[32m+[m[32m  "devDependencies": {},[m
[32m+[m[32m  "directories": {},[m
[32m+[m[32m  "dist": {[m
[32m+[m[32m    "shasum": "b5e85ecdbbfe5aeded40a1bf4ee2372e67d96fb4",[m
[32m+[m[32m    "tarball": "https://registry.npmjs.org/cordova-plugin-whitelist/-/cordova-plugin-whitelist-1.3.3.tgz"[m
[32m+[m[32m  },[m
[32m+[m[32m  "engines": {[m
[32m+[m[32m    "cordovaDependencies": {[m
[32m+[m[32m      "0.0.0": {[m
[32m+[m[32m        "cordova-android": ">=4.0.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "2.0.0": {[m
[32m+[m[32m        "cordova": ">100"[m
[32m+[m[32m      }[m
[32m+[m[32m    }[m
   },[m
[32m+[m[32m  "homepage": "https://github.com/apache/cordova-plugin-whitelist#readme",[m
   "keywords": [[m
     "cordova",[m
     "whitelist",[m
     "ecosystem:cordova",[m
     "cordova-android"[m
   ],[m
[31m-  "engines": [[m
[32m+[m[32m  "license": "Apache-2.0",[m
[32m+[m[32m  "maintainers": [[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "bowserj",[m
[32m+[m[32m      "email": "bowserj@apache.org"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "csantanapr",[m
[32m+[m[32m      "email": "csantana23@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "filmaj",[m
[32m+[m[32m      "email": "maj.fil@gmail.com"[m
[32m+[m[32m    },[m
     {[m
[31m-      "name": "cordova-android",[m
[31m-      "version": ">=4.0.0"[m
[32m+[m[32m      "name": "purplecabbage",[m
[32m+[m[32m      "email": "purplecabbage@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "shazron",[m
[32m+[m[32m      "email": "shazron@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "stevegill",[m
[32m+[m[32m      "email": "stevengill97@gmail.com"[m
     }[m
   ],[m
[31m-  "author": "Apache Software Foundation",[m
[31m-  "license": "Apache 2.0"[m
[32m+[m[32m  "name": "cordova-plugin-whitelist",[m
[32m+[m[32m  "optionalDependencies": {},[m
[32m+[m[32m  "readme": "ERROR: No README data found!",[m
[32m+[m[32m  "repository": {[m
[32m+[m[32m    "type": "git",[m
[32m+[m[32m    "url": "git+https://github.com/apache/cordova-plugin-whitelist.git"[m
[32m+[m[32m  },[m
[32m+[m[32m  "version": "1.3.3"[m
 }[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/plugin.xml b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/plugin.xml[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 3b4ace8..ecc7fb2[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/plugin.xml[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/plugin.xml[m
[36m@@ -20,7 +20,7 @@[m
 [m
 <plugin xmlns="http://apache.org/cordova/ns/plugins/1.0"[m
            id="cordova-plugin-whitelist"[m
[31m-      version="1.2.2">[m
[32m+[m[32m      version="1.3.3">[m
     <name>Whitelist</name>[m
     <description>Cordova Network Whitelist Plugin</description>[m
     <license>Apache 2.0</license>[m
[36m@@ -44,7 +44,5 @@[m
                This plugin is only applicable for versions of cordova-android greater than 4.0. If you have a previous platform version, you do *not* need this plugin since the whitelist will be built in.[m
           </info>[m
     </platform>[m
[31m-	[m
[31m-[m
 [m
 </plugin>[m
[1mdiff --git a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/src/android/WhitelistPlugin.java b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/src/android/WhitelistPlugin.java[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 4e4f57e..3656788[m
[1m--- a/cordova_exchange_dist/plugins/cordova-plugin-whitelist/src/android/WhitelistPlugin.java[m
[1m+++ b/cordova_exchange_dist/plugins/cordova-plugin-whitelist/src/android/WhitelistPlugin.java[m
[36m@@ -21,11 +21,11 @@[m [mpackage org.apache.cordova.whitelist;[m
 [m
 import org.apache.cordova.CordovaPlugin;[m
 import org.apache.cordova.ConfigXmlParser;[m
[32m+[m[32mimport org.apache.cordova.LOG;[m
 import org.apache.cordova.Whitelist;[m
 import org.xmlpull.v1.XmlPullParser;[m
 [m
 import android.content.Context;[m
[31m-import android.util.Log;[m
 [m
 public class WhitelistPlugin extends CordovaPlugin {[m
     private static final String LOG_TAG = "WhitelistPlugin";[m
[36m@@ -90,7 +90,7 @@[m [mpublic class WhitelistPlugin extends CordovaPlugin {[m
                 boolean external = (xml.getAttributeValue(null, "launch-external") != null);[m
                 if (origin != null) {[m
                     if (external) {[m
[31m-                        Log.w(LOG_TAG, "Found <access launch-external> within config.xml. Please use <allow-intent> instead.");[m
[32m+[m[32m                        LOG.w(LOG_TAG, "Found <access launch-external> within config.xml. Please use <allow-intent> instead.");[m
                         allowedIntents.addWhiteListEntry(origin, (subdomains != null) && (subdomains.compareToIgnoreCase("true") == 0));[m
                     } else {[m
                         if ("*".equals(origin)) {[m
[1mdiff --git a/cordova_exchange_dist/plugins/fetch.json b/cordova_exchange_dist/plugins/fetch.json[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex fe55ef3..17c3d2f[m
[1m--- a/cordova_exchange_dist/plugins/fetch.json[m
[1m+++ b/cordova_exchange_dist/plugins/fetch.json[m
[36m@@ -1,66 +1,100 @@[m
 {[m
[31m-    "cordova-plugin-whitelist": {[m
[31m-        "source": {[m
[31m-            "type": "registry",[m
[31m-            "id": "cordova-plugin-whitelist@1"[m
[31m-        },[m
[31m-        "is_top_level": true,[m
[31m-        "variables": {}[m
[32m+[m[32m  "cordova-plugin-whitelist": {[m
[32m+[m[32m    "source": {[m
[32m+[m[32m      "type": "registry",[m
[32m+[m[32m      "id": "cordova-plugin-whitelist@1"[m
     },[m
[31m-    "phonegap-plugin-barcodescanner": {[m
[31m-        "source": {[m
[31m-            "type": "registry",[m
[31m-            "id": "phonegap-plugin-barcodescanner"[m
[31m-        },[m
[31m-        "is_top_level": true,[m
[31m-        "variables": {}[m
[32m+[m[32m    "is_top_level": true,[m
[32m+[m[32m    "variables": {}[m
[32m+[m[32m  },[m
[32m+[m[32m  "phonegap-plugin-barcodescanner": {[m
[32m+[m[32m    "source": {[m
[32m+[m[32m      "type": "registry",[m
[32m+[m[32m      "id": "phonegap-plugin-barcodescanner@8.0.1"[m
     },[m
[31m-    "cordova-plugin-compat": {[m
[31m-        "source": {[m
[31m-            "type": "registry",[m
[31m-            "id": "cordova-plugin-compat"[m
[31m-        },[m
[31m-        "is_top_level": false,[m
[31m-        "variables": {}[m
[32m+[m[32m    "is_top_level": true,[m
[32m+[m[32m    "variables": {}[m
[32m+[m[32m  },[m
[32m+[m[32m  "cordova-plugin-file": {[m
[32m+[m[32m    "source": {[m
[32m+[m[32m      "type": "registry",[m
[32m+[m[32m      "id": "cordova-plugin-file@6.0.1"[m
     },[m
[31m-    "cordova-plugin-console": {[m
[31m-        "source": {[m
[31m-            "type": "registry",[m
[31m-            "id": "cordova-plugin-console"[m
[31m-        },[m
[31m-        "is_top_level": true,[m
[31m-        "variables": {}[m
[32m+[m[32m    "is_top_level": true,[m
[32m+[m[32m    "variables": {}[m
[32m+[m[32m  },[m
[32m+[m[32m  "cordova-plugin-fingerprint-aio": {[m
[32m+[m[32m    "source": {[m
[32m+[m[32m      "type": "registry",[m
[32m+[m[32m      "id": "cordova-plugin-fingerprint-aio"[m
     },[m
[31m-    "cordova-plugin-file": {[m
[31m-        "source": {[m
[31m-            "type": "registry",[m
[31m-            "id": "cordova-plugin-file"[m
[31m-        },[m
[31m-        "is_top_level": true,[m
[31m-        "variables": {}[m
[32m+[m[32m    "is_top_level": true,[m
[32m+[m[32m    "variables": {}[m
[32m+[m[32m  },[m
[32m+[m[32m  "cordova-plugin-inappbrowser": {[m
[32m+[m[32m    "source": {[m
[32m+[m[32m      "type": "registry",[m
[32m+[m[32m      "id": "cordova-plugin-inappbrowser@3.0.0"[m
     },[m
[31m-    "cordova-plugin-device": {[m
[31m-        "source": {[m
[31m-            "type": "registry",[m
[31m-            "id": "cordova-plugin-device"[m
[31m-        },[m
[31m-        "is_top_level": true,[m
[31m-        "variables": {}[m
[32m+[m[32m    "is_top_level": true,[m
[32m+[m[32m    "variables": {}[m
[32m+[m[32m  },[m
[32m+[m[32m  "cordova-plugin-ionic-keyboard": {[m
[32m+[m[32m    "source": {[m
[32m+[m[32m      "type": "registry",[m
[32m+[m[32m      "id": "cordova-plugin-ionic-keyboard"[m
     },[m
[31m-    "cordova-plugin-ionic-keyboard": {[m
[31m-        "source": {[m
[31m-            "type": "registry",[m
[31m-            "id": "cordova-plugin-ionic-keyboard"[m
[31m-        },[m
[31m-        "is_top_level": true,[m
[31m-        "variables": {}[m
[32m+[m[32m    "is_top_level": true,[m
[32m+[m[32m    "variables": {}[m
[32m+[m[32m  },[m
[32m+[m[32m  "cordova-plugin-urlhandler": {[m
[32m+[m[32m    "source": {[m
[32m+[m[32m      "type": "registry",[m
[32m+[m[32m      "id": "cordova-plugin-urlhandler@^0.7.2"[m
     },[m
[31m-    "cordova-plugin-inappbrowser": {[m
[31m-        "source": {[m
[31m-            "type": "registry",[m
[31m-            "id": "cordova-plugin-inappbrowser"[m
[31m-        },[m
[31m-        "is_top_level": true,[m
[31m-        "variables": {}[m
[32m+[m[32m    "is_top_level": true,[m
[32m+[m[32m    "variables": {[m
[32m+[m[32m      "URL_SCHEME": "comchain"[m
     }[m
[32m+[m[32m  },[m
[32m+[m[32m  "cordova-plugin-app-event": {[m
[32m+[m[32m    "source": {[m
[32m+[m[32m      "type": "registry",[m
[32m+[m[32m      "id": "cordova-plugin-app-event"[m
[32m+[m[32m    },[m
[32m+[m[32m    "is_top_level": true,[m
[32m+[m[32m    "variables": {}[m
[32m+[m[32m  },[m
[32m+[m[32m  "cordova-plugin-console": {[m
[32m+[m[32m    "source": {[m
[32m+[m[32m      "type": "registry",[m
[32m+[m[32m      "id": "cordova-plugin-console"[m
[32m+[m[32m    },[m
[32m+[m[32m    "is_top_level": true,[m
[32m+[m[32m    "variables": {}[m
[32m+[m[32m  },[m
[32m+[m[32m  "cordova-plugin-device": {[m
[32m+[m[32m    "source": {[m
[32m+[m[32m      "type": "registry",[m
[32m+[m[32m      "id": "cordova-plugin-device"[m
[32m+[m[32m    },[m
[32m+[m[32m    "is_top_level": true,[m
[32m+[m[32m    "variables": {}[m
[32m+[m[32m  },[m
[32m+[m[32m  "de.appplant.cordova.plugin.local-notification": {[m
[32m+[m[32m    "source": {[m
[32m+[m[32m      "type": "registry",[m
[32m+[m[32m      "id": "de.appplant.cordova.plugin.local-notification"[m
[32m+[m[32m    },[m
[32m+[m[32m    "is_top_level": true,[m
[32m+[m[32m    "variables": {}[m
[32m+[m[32m  },[m
[32m+[m[32m  "cordova-plugin-compat": {[m
[32m+[m[32m    "source": {[m
[32m+[m[32m      "type": "registry",[m
[32m+[m[32m      "id": "cordova-plugin-compat@1.2.0"[m
[32m+[m[32m    },[m
[32m+[m[32m    "is_top_level": true,[m
[32m+[m[32m    "variables": {}[m
[32m+[m[32m  }[m
 }[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/README.md b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex e82a1ed..4521014[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/README.md[m
[1m+++ b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/README.md[m
[36m@@ -5,30 +5,29 @@[m
 [m
 Cross-platform BarcodeScanner for Cordova / PhoneGap.[m
 [m
[31m-Follows the [Cordova Plugin spec](http://cordova.apache.org/docs/en/5.0.0/plugin_ref_spec.md), so that it works with [Plugman](https://github.com/apache/cordova-plugman).[m
[32m+[m[32mFollows the [Cordova Plugin spec](https://cordova.apache.org/docs/en/latest/plugin_ref/spec.html), so that it works with [Plugman](https://github.com/apache/cordova-plugman).[m
 [m
 ## Installation[m
 [m
[31m-    [m
[31m-This requires phonegap 5.0+ ( current stable v3.0.0 )[m
 [m
[31m-    phonegap plugin add phonegap-plugin-barcodescanner[m
[31m-[m
[31m-Older versions of phonegap can still install via the __deprecated__ id ( stale v2.0.1 )[m
[32m+[m[32mThis requires phonegap 7.1.0+ ( current stable v8.0.0 )[m
 [m
[31m-    phonegap plugin add com.phonegap.plugins.barcodescanner[m
[32m+[m[32m    phonegap plugin add phonegap-plugin-barcodescanner[m
 [m
 It is also possible to install via repo url directly ( unstable )[m
 [m
     phonegap plugin add https://github.com/phonegap/phonegap-plugin-barcodescanner.git[m
 [m
[32m+[m[32mOptional variables:[m
[32m+[m[32mThis plugin requires the Android support library v4. The minimum version is `24.1.0`. Default value is `27.+`.  Check out the latest version [here](https://developer.android.com/topic/libraries/support-library/revisions.html).[m
[32m+[m[32m```[m
[32m+[m[32mphonegap plugin add phonegap-plugin-barcodescanner --variable ANDROID_SUPPORT_V4_VERSION="27.1.1"[m
[32m+[m[32m```[m
 ### Supported Platforms[m
 [m
 - Android[m
 - iOS[m
 - Windows (Windows/Windows Phone 8.1 and Windows 10)[m
[31m-- Windows Phone 8[m
[31m-- BlackBerry 10[m
 - Browser[m
 [m
 Note: the Android source for this project includes an Android Library Project.[m
[36m@@ -42,91 +41,42 @@[m [mNote: Windows 10 applications can not be build for `AnyCPU` architecture, which[m
 cordova run windows -- --archs=x86[m
 ```[m
 [m
[31m-### PhoneGap Build[m
[31m-If you're using [PhoneGap Build](https://build.phonegap.com/) please make sure you specify `gradle` as your Android build tool in `config.xml`: `<preference name="android-build-tool" value="gradle" />`.[m
[32m+[m[32m### PhoneGap Build Usage[m
[32m+[m
[32m+[m[32mAdd the following to your config.xml:[m
[32m+[m
[32m+[m[32m```[m
[32m+[m[32m<!-- add a version here, otherwise PGB will use whatever the latest version of the package on npm is -->[m
[32m+[m[32m<plugin name="phonegap-plugin-barcodescanner" />[m
[32m+[m[32m```[m
[32m+[m[32mOn PhoneGap Build if you're using a version of cordova-android of 4 or less, ensure you're building with gradle:[m
[32m+[m[32m```[m
[32m+[m[32m<preference name="android-build-tool" value="gradle" />[m
[32m+[m[32m```[m
 [m
 ## Using the plugin ##[m
[31m-The plugin creates the object `cordova/plugin/BarcodeScanner` with the method `scan(success, fail)`. [m
[32m+[m[32mThe plugin creates the object `cordova.plugins.barcodeScanner` with the method `scan(success, fail)`.[m
 [m
 The following barcode types are currently supported:[m
[31m-### Android[m
[31m-[m
[31m-* QR_CODE[m
[31m-* DATA_MATRIX[m
[31m-* UPC_E[m
[31m-* UPC_A[m
[31m-* EAN_8[m
[31m-* EAN_13[m
[31m-* CODE_128[m
[31m-* CODE_39[m
[31m-* CODE_93[m
[31m-* CODABAR[m
[31m-* ITF[m
[31m-* RSS14[m
[31m-* RSS_EXPANDED[m
[31m-[m
[31m-Not by default, but supported if you pass in the "formats" option:[m
[31m-* PDF417[m
[31m-* AZTEC[m
[31m-[m
[31m-### iOS[m
[31m-[m
[31m-* QR_CODE[m
[31m-* DATA_MATRIX[m
[31m-* UPC_E[m
[31m-* UPC_A[m
[31m-* EAN_8[m
[31m-* EAN_13[m
[31m-* CODE_128[m
[31m-* CODE_39[m
[31m-* ITF[m
[31m-[m
[31m-### Windows[m
[31m-[m
[31m-* UPC_A[m
[31m-* UPC_E[m
[31m-* EAN_8[m
[31m-* EAN_13[m
[31m-* CODE_39[m
[31m-* CODE_93[m
[31m-* CODE_128[m
[31m-* ITF[m
[31m-* CODABAR[m
[31m-* MSI[m
[31m-* RSS14[m
[31m-* QR_CODE[m
[31m-* DATA_MATRIX[m
[31m-* AZTEC[m
[31m-* PDF417[m
[31m-[m
[31m-### Windows Phone 8[m
[31m-[m
[31m-* UPC_A[m
[31m-* UPC_E[m
[31m-* EAN_8[m
[31m-* EAN_13[m
[31m-* CODE_39[m
[31m-* CODE_93[m
[31m-* CODE_128[m
[31m-* ITF[m
[31m-* CODABAR[m
[31m-* MSI[m
[31m-* RSS14[m
[31m-* QR_CODE[m
[31m-* DATA_MATRIX[m
[31m-* AZTEC[m
[31m-* PDF417[m
[31m-[m
[31m-### BlackBerry 10[m
[31m-* UPC_A[m
[31m-* UPC_E[m
[31m-* EAN_8[m
[31m-* EAN_13[m
[31m-* CODE_39[m
[31m-* CODE_128[m
[31m-* ITF[m
[31m-* DATA_MATRIX[m
[31m-* AZTEC[m
[32m+[m
[32m+[m[32m|  Barcode Type | Android | iOS | Windows  |[m
[32m+[m[32m|---------------|:-------:|:---:|:--------:|[m
[32m+[m[32m| QR_CODE       |    ✔    |  ✔  |     ✔    |[m
[32m+[m[32m| DATA_MATRIX   |    ✔    |  ✔  |     ✔    |[m
[32m+[m[32m| UPC_A         |    ✔    |  ✔  |     ✔    |[m
[32m+[m[32m| UPC_E         |    ✔    |  ✔  |     ✔    |[m
[32m+[m[32m| EAN_8         |    ✔    |  ✔  |     ✔    |[m
[32m+[m[32m| EAN_13        |    ✔    |  ✔  |     ✔    |[m
[32m+[m[32m| CODE_39       |    ✔    |  ✔  |     ✔    |[m
[32m+[m[32m| CODE_93       |    ✔    |  ✖  |     ✔    |[m
[32m+[m[32m| CODE_128      |    ✔    |  ✔  |     ✔    |[m
[32m+[m[32m| CODABAR       |    ✔    |  ✖  |     ✔    |[m
[32m+[m[32m| ITF           |    ✔    |  ✔  |     ✔    |[m
[32m+[m[32m| RSS14         |    ✔    |  ✖  |     ✔    |[m
[32m+[m[32m| PDF_417       |    ✔    |  ✔  |     ✔    |[m
[32m+[m[32m| RSS_EXPANDED  |    ✔    |  ✖  |     ✖    |[m
[32m+[m[32m| MSI           |    ✖    |  ✖  |     ✔    |[m
[32m+[m[32m| AZTEC         |    ✖    |  ✖  |     ✔    |[m
 [m
 `success` and `fail` are callback functions. Success is passed an object with data, type and cancelled properties. Data is the text representation of the barcode data, type is the type of barcode detected and cancelled is whether or not the user cancelled the scan.[m
 [m
[36m@@ -138,23 +88,29 @@[m [mA full example could be:[m
                 "Result: " + result.text + "\n" +[m
                 "Format: " + result.format + "\n" +[m
                 "Cancelled: " + result.cancelled);[m
[31m-      }, [m
[32m+[m[32m      },[m
       function (error) {[m
           alert("Scanning failed: " + error);[m
       },[m
       {[m
[31m-          "preferFrontCamera" : true, // iOS and Android[m
[31m-          "showFlipCameraButton" : true, // iOS and Android[m
[31m-          "prompt" : "Place a barcode inside the scan area", // supported on Android only[m
[31m-          "formats" : "QR_CODE,PDF_417", // default: all but PDF_417 and RSS_EXPANDED[m
[31m-          "orientation" : "landscape" // Android only (portrait|landscape), default unset so it rotates with the device[m
[32m+[m[32m          preferFrontCamera : true, // iOS and Android[m
[32m+[m[32m          showFlipCameraButton : true, // iOS and Android[m
[32m+[m[32m          showTorchButton : true, // iOS and Android[m
[32m+[m[32m          torchOn: true, // Android, launch with the torch switched on (if available)[m
[32m+[m[32m          saveHistory: true, // Android, save scan history (default false)[m
[32m+[m[32m          prompt : "Place a barcode inside the scan area", // Android[m
[32m+[m[32m          resultDisplayDuration: 500, // Android, display scanned text for X ms. 0 suppresses it entirely, default 1500[m
[32m+[m[32m          formats : "QR_CODE,PDF_417", // default: all but PDF_417 and RSS_EXPANDED[m
[32m+[m[32m          orientation : "landscape", // Android only (portrait|landscape), default unset so it rotates with the device[m
[32m+[m[32m          disableAnimations : true, // iOS[m
[32m+[m[32m          disableSuccessBeep: false // iOS and Android[m
       }[m
    );[m
 ```[m
 [m
 ## Encoding a Barcode ##[m
 [m
[31m-The plugin creates the object `cordova.plugins.barcodeScanner` with the method `encode(type, data, success, fail)`. [m
[32m+[m[32mThe plugin creates the object `cordova.plugins.barcodeScanner` with the method `encode(type, data, success, fail)`.[m
 [m
 Supported encoding types:[m
 [m
[36m@@ -174,19 +130,30 @@[m [mA full example could be:[m
         );[m
 ```[m
 [m
[32m+[m[32m## iOS quirks ##[m
[32m+[m
[32m+[m[32mSince iOS 10 it's mandatory to add a `NSCameraUsageDescription` in the `Info.plist`.[m
[32m+[m
[32m+[m[32m`NSCameraUsageDescription` describes the reason that the app accesses the user's camera.[m
[32m+[m[32mWhen the system prompts the user to allow access, this string is displayed as part of the dialog box. If you didn't provide the usage description, the app will crash before showing the dialog. Also, Apple will reject apps that access private data but don't provide an usage description.[m
[32m+[m
[32m+[m[32mTo add this entry you can use the `edit-config` tag in the `config.xml` like this:[m
[32m+[m
[32m+[m[32m```[m
[32m+[m[32m<edit-config target="NSCameraUsageDescription" file="*-Info.plist" mode="merge">[m
[32m+[m[32m    <string>To scan barcodes</string>[m
[32m+[m[32m</edit-config>[m
[32m+[m[32m```[m
[32m+[m
 ## Windows quirks ##[m
[31m-Windows implementation currently doesn't support encode functionality.[m
 [m
[31m-## Windows Phone 8 quirks ##[m
[31m-Windows Phone 8 implementation currently doesn't support encode functionality.[m
[32m+[m[32m* Windows implementation currently doesn't support encode functionality.[m
 [m
[31m-## BlackBerry 10 quirks[m
[31m-BlackBerry 10 implementation currently doesn't support encode functionality.[m
[31m-Cancelling a scan on BlackBerry 10 is done by touching the screen.[m
[32m+[m[32m* On Windows 10 desktop ensure that you have Windows Media Player and Media Feature pack installed.[m
 [m
 ## Thanks on Github ##[m
 [m
[31m-So many -- check out the original [iOS](https://github.com/phonegap/phonegap-plugins/tree/DEPRECATED/iOS/BarcodeScanner),  [Android](https://github.com/phonegap/phonegap-plugins/tree/DEPRECATED/Android/BarcodeScanner) and [m
[32m+[m[32mSo many -- check out the original [iOS](https://github.com/phonegap/phonegap-plugins/tree/DEPRECATED/iOS/BarcodeScanner),  [Android](https://github.com/phonegap/phonegap-plugins/tree/DEPRECATED/Android/BarcodeScanner) and[m
 [BlackBerry 10](https://github.com/blackberry/WebWorks-Community-APIs/tree/master/BB10-Cordova/BarcodeScanner) repos.[m
 [m
 ## Licence ##[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/package.json b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/package.json[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 7f47c7d..fb361b1[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/package.json[m
[1m+++ b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/package.json[m
[36m@@ -1,45 +1,151 @@[m
 {[m
[31m-  "name": "phonegap-plugin-barcodescanner",[m
[31m-  "version": "5.0.1",[m
[31m-  "description": "You can use the BarcodeScanner plugin to scan different types of barcodes (using the device's camera) and get the metadata encoded in them for processing within your application.",[m
[32m+[m[32m  "_args": [[m
[32m+[m[32m    [[m
[32m+[m[32m      {[m
[32m+[m[32m        "raw": "phonegap-plugin-barcodescanner@8.0.1",[m
[32m+[m[32m        "scope": null,[m
[32m+[m[32m        "escapedName": "phonegap-plugin-barcodescanner",[m
[32m+[m[32m        "name": "phonegap-plugin-barcodescanner",[m
[32m+[m[32m        "rawSpec": "8.0.1",[m
[32m+[m[32m        "spec": "8.0.1",[m
[32m+[m[32m        "type": "version"[m
[32m+[m[32m      },[m
[32m+[m[32m      "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test"[m
[32m+[m[32m    ][m
[32m+[m[32m  ],[m
[32m+[m[32m  "_from": "phonegap-plugin-barcodescanner@8.0.1",[m
[32m+[m[32m  "_hasShrinkwrap": false,[m
[32m+[m[32m  "_id": "phonegap-plugin-barcodescanner@8.0.1",[m
[32m+[m[32m  "_inCache": true,[m
[32m+[m[32m  "_location": "/phonegap-plugin-barcodescanner",[m
[32m+[m[32m  "_nodeVersion": "10.12.0",[m
[32m+[m[32m  "_npmOperationalInternal": {[m
[32m+[m[32m    "host": "s3://npm-registry-packages",[m
[32m+[m[32m    "tmp": "tmp/phonegap-plugin-barcodescanner_8.0.1_1543343810591_0.7964319914236477"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmUser": {[m
[32m+[m[32m    "name": "jcesarmobile",[m
[32m+[m[32m    "email": "jcesarmobile@gmail.com"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_npmVersion": "6.4.1",[m
[32m+[m[32m  "_phantomChildren": {},[m
[32m+[m[32m  "_requested": {[m
[32m+[m[32m    "raw": "phonegap-plugin-barcodescanner@8.0.1",[m
[32m+[m[32m    "scope": null,[m
[32m+[m[32m    "escapedName": "phonegap-plugin-barcodescanner",[m
[32m+[m[32m    "name": "phonegap-plugin-barcodescanner",[m
[32m+[m[32m    "rawSpec": "8.0.1",[m
[32m+[m[32m    "spec": "8.0.1",[m
[32m+[m[32m    "type": "version"[m
[32m+[m[32m  },[m
[32m+[m[32m  "_requiredBy": [[m
[32m+[m[32m    "#USER",[m
[32m+[m[32m    "/"[m
[32m+[m[32m  ],[m
[32m+[m[32m  "_resolved": "https://registry.npmjs.org/phonegap-plugin-barcodescanner/-/phonegap-plugin-barcodescanner-8.0.1.tgz",[m
[32m+[m[32m  "_shasum": "829348e7e2e4353b39ea1ef15fed08b4617f683a",[m
[32m+[m[32m  "_shrinkwrap": null,[m
[32m+[m[32m  "_spec": "phonegap-plugin-barcodescanner@8.0.1",[m
[32m+[m[32m  "_where": "/d00/perso/Lemam-Wallet/automated-building/cc-wallet/cordova_test",[m
[32m+[m[32m  "author": {[m
[32m+[m[32m    "name": "Adobe PhoneGap Team"[m
[32m+[m[32m  },[m
[32m+[m[32m  "bugs": {[m
[32m+[m[32m    "url": "https://github.com/phonegap/phonegap-plugin-barcodescanner/issues"[m
[32m+[m[32m  },[m
   "cordova": {[m
     "id": "phonegap-plugin-barcodescanner",[m
     "platforms": [[m
       "ios",[m
       "android",[m
[31m-      "windows8",[m
       "windows",[m
[31m-      "wp8",[m
[31m-      "blackberry10",[m
       "browser"[m
     ][m
   },[m
[31m-  "repository": {[m
[31m-    "type": "git",[m
[31m-    "url": "git+https://github.com/phonegap/phonegap-plugin-barcodescanner.git"[m
[32m+[m[32m  "dependencies": {},[m
[32m+[m[32m  "description": "You can use the BarcodeScanner plugin to scan different types of barcodes (using the device's camera) and get the metadata encoded in them for processing within your application.",[m
[32m+[m[32m  "devDependencies": {[m
[32m+[m[32m    "jasmine-node": "1.14.5",[m
[32m+[m[32m    "pluginpub": "^0.0.9"[m
[32m+[m[32m  },[m
[32m+[m[32m  "directories": {},[m
[32m+[m[32m  "dist": {[m
[32m+[m[32m    "integrity": "sha512-s+wY33+FPgfl/Yc81mIKoPuBX9yhRow0ARGpFZkmiwNplNs8eEwS+XnAzUlYCn77yvyiSymRmSMjjQdbvyHDuQ==",[m
[32m+[m[32m    "shasum": "829348e7e2e4353b39ea1ef15fed08b4617f683a",[m
[32m+[m[32m    "tarball": "https://registry.npmjs.org/phonegap-plugin-barcodescanner/-/phonegap-plugin-barcodescanner-8.0.1.tgz",[m
[32m+[m[32m    "fileCount": 37,[m
[32m+[m[32m    "unpackedSize": 3459779,[m
[32m+[m[32m    "npm-signature": "-----BEGIN PGP SIGNATURE-----\r\nVersion: OpenPGP.js v3.0.4\r\nComment: https://openpgpjs.org\r\n\r\nwsFcBAEBCAAQBQJb/Y7DCRA9TVsSAnZWagAAuPAP/1kPHh/mxvKH7fj1BCja\nSNIy4mP6ELMgF7bZl1wU4v5HdPfiiCpXPd4mcf82DiQJXOY4aV//GNe9C1tz\n5SurHfDOUdTnGlBVBDCA7gf4mWUPxJ6UuckIbAiSVtb7cZJwLT+LDFROm5Ar\nxdEVeIoTm/N83XrlXalzm5z2Jcoc+z96hKU64ouX4ZIt7dkHuvCc5pZs9Mdm\nq02IeGX2eGobjBM2r6BHZF+WkhT0tHiDTZsix0jrd0cCUp/Xr4vlIb7ZfXz3\nld2R398CQTCeOPXYwntTU4RD+BzqXA24Xc9YcKfzH6Or6l3BG/nQH+HXYBXt\nzmTyhy0cPrR7h4+vPiyfKJPqhvFYWZphJlXKKiq+WgGX14s4Ec1kAb5u9cVT\nK52F/jRQAvl9cgB7EdpOYmaDzqBqR0zx3hLZjRm54BkQzQQ2LIP+C3AbN3xz\nSN/EbWzxHImSVq5Q/dae5brwI2XMJWDPpsSD/3qndJx5nODfFts/QRLut7iP\nV6tyW63Z/4CT81DBKxrzgxJVqTB8Yzt8VGnFetHThRrwccXtVRxrCYUA0qoT\n7FRLxacCwegYNDlNz/G7v7mRaPBSi4ubjNfcZSPlCaKOp/iFZJ32ipw5TEBf\n4TY00wI21El1+ZY6kxvfTQ+YvJnAM201MjAFTaUvzXBliw6CMWTJiPG7m2lX\nitii\r\n=R+it\r\n-----END PGP SIGNATURE-----\r\n"[m
   },[m
[32m+[m[32m  "engines": {[m
[32m+[m[32m    "cordovaDependencies": {[m
[32m+[m[32m      "7.0.0": {[m
[32m+[m[32m        "cordova-android": ">=6.3.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "7.1.0": {[m
[32m+[m[32m        "cordova": ">=7.1.0",[m
[32m+[m[32m        "cordova-android": ">=6.3.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "8.0.0": {[m
[32m+[m[32m        "cordova": ">=7.1.0",[m
[32m+[m[32m        "cordova-android": ">=6.3.0"[m
[32m+[m[32m      },[m
[32m+[m[32m      "<7.0.0": {[m
[32m+[m[32m        "cordova-android": "<6.3.0"[m
[32m+[m[32m      }[m
[32m+[m[32m    }[m
[32m+[m[32m  },[m
[32m+[m[32m  "gitHead": "c5dbca2770d7c0f22ccb23473cd38c5fad8f8fa9",[m
[32m+[m[32m  "homepage": "https://github.com/phonegap/phonegap-plugin-barcodescanner#readme",[m
   "keywords": [[m
     "ecosystem:cordova",[m
     "ecosystem:phonegap",[m
     "cordova-ios",[m
     "cordova-android",[m
[31m-    "cordova-windows8",[m
     "cordova-windows",[m
[31m-    "cordova-wp8",[m
[31m-    "cordova-blackberry10",[m
     "cordova-browser",[m
     "cordova:plugin"[m
   ],[m
[31m-  "engines": [[m
[32m+[m[32m  "license": "MIT",[m
[32m+[m[32m  "maintainers": [[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "eddyverbruggen",[m
[32m+[m[32m      "email": "eddyverbruggen@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "jcesarmobile",[m
[32m+[m[32m      "email": "jcesarmobile@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "kotikov.vladimir",[m
[32m+[m[32m      "email": "kotikov.vladimir@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "macdonst",[m
[32m+[m[32m      "email": "simon.macdonald@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "stevegill",[m
[32m+[m[32m      "email": "stevengill97@gmail.com"[m
[32m+[m[32m    },[m
[32m+[m[32m    {[m
[32m+[m[32m      "name": "timbarham",[m
[32m+[m[32m      "email": "npmjs@barhams.info"[m
[32m+[m[32m    },[m
     {[m
[31m-      "name": "cordova",[m
[31m-      "version": ">=3.0.0"[m
[32m+[m[32m      "name": "timwindsor",[m
[32m+[m[32m      "email": "timothy.windsor@gmail.com"[m
     }[m
   ],[m
[31m-  "author": "Adobe PhoneGap Team",[m
[31m-  "license": "MIT",[m
[31m-  "bugs": {[m
[31m-    "url": "https://github.com/phonegap/phonegap-plugin-barcodescanner/issues"[m
[32m+[m[32m  "name": "phonegap-plugin-barcodescanner",[m
[32m+[m[32m  "optionalDependencies": {},[m
[32m+[m[32m  "readme": "ERROR: No README data found!",[m
[32m+[m[32m  "repository": {[m
[32m+[m[32m    "type": "git",[m
[32m+[m[32m    "url": "git+https://github.com/phonegap/phonegap-plugin-barcodescanner.git"[m
[32m+[m[32m  },[m
[32m+[m[32m  "scripts": {[m
[32m+[m[32m    "test": "jasmine-node --color spec"[m
   },[m
[31m-  "homepage": "https://github.com/phonegap/phonegap-plugin-barcodescanner#readme"[m
[32m+[m[32m  "version": "8.0.1"[m
 }[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/plugin.xml b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/plugin.xml[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 8c53f4b..d3a7d6c[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/plugin.xml[m
[1m+++ b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/plugin.xml[m
[36m@@ -1,183 +1,74 @@[m
[31m-<?xml version="1.0" encoding="UTF-8"?><plugin xmlns="http://www.phonegap.com/ns/plugins/1.0"[m
[31m-    xmlns:android="http://schemas.android.com/apk/res/android"[m
[31m-    xmlns:rim="http://www.blackberry.com/ns/widgets"[m
[31m-    id="phonegap-plugin-barcodescanner"[m
[31m-    version="5.0.1">[m
[31m-[m
[31m-    <name>BarcodeScanner</name>[m
[31m-    <description>You can use the BarcodeScanner plugin to scan different types of barcodes (using the device's camera) and get the metadata encoded in them for processing within your application.</description>[m
[31m-    <license>MIT</license>[m
[31m-[m
[31m-    <repo>https://github.com/phonegap/phonegap-plugin-barcodescanner</repo>[m
[31m-    <issue>https://github.com/phonegap/phonegap-plugin-barcodescanner/issues</issue>[m
[31m-[m
[31m-    <engines>[m
[31m-        <engine name="cordova" version=">=3.0.0" />[m
[31m-    </engines>[m
[31m-[m
[31m-    <js-module src="www/barcodescanner.js" name="BarcodeScanner">[m
[31m-        <clobbers target="cordova.plugins.barcodeScanner" />[m
[32m+[m[32m<?xml version="1.0" encoding="UTF-8" standalone="yes"?>[m
[32m+[m[32m<plugin xmlns="http://www.phonegap.com/ns/plugins/1.0" xmlns:android="http://schemas.android.com/apk/res/android" xmlns:rim="http://www.blackberry.com/ns/widgets" id="phonegap-plugin-barcodescanner" version="8.0.1">[m
[32m+[m[32m  <name>BarcodeScanner</name>[m
[32m+[m[32m  <description>You can use the BarcodeScanner plugin to scan different types of barcodes (using the device's camera) and get the metadata encoded in them for processing within your application.</description>[m
[32m+[m[32m  <license>MIT</license>[m
[32m+[m[32m  <repo>https://github.com/phonegap/phonegap-plugin-barcodescanner</repo>[m
[32m+[m[32m  <issue>https://github.com/phonegap/phonegap-plugin-barcodescanner/issues</issue>[m
[32m+[m[32m  <engines>[m
[32m+[m[32m    <engine name="cordova" version=">=7.1.0"/>[m
[32m+[m[32m    <engine name="cordova-android" version=">=6.3.0"/>[m
[32m+[m[32m  </engines>[m
[32m+[m[32m  <js-module src="www/barcodescanner.js" name="BarcodeScanner">[m
[32m+[m[32m    <clobbers target="cordova.plugins.barcodeScanner"/>[m
[32m+[m[32m  </js-module>[m
[32m+[m[32m  <platform name="ios">[m
[32m+[m[32m    <config-file target="config.xml" parent="/*">[m
[32m+[m[32m      <feature name="BarcodeScanner">[m
[32m+[m[32m        <param name="ios-package" value="CDVBarcodeScanner"/>[m
[32m+[m[32m      </feature>[m
[32m+[m[32m    </config-file>[m
[32m+[m[32m    <resource-file src="src/ios/scannerOverlay.xib"/>[m
[32m+[m[32m    <resource-file src="src/ios/CDVBarcodeScanner.bundle"/>[m
[32m+[m[32m    <source-file src="src/ios/CDVBarcodeScanner.mm"/>[m
[32m+[m[32m    <!-- frameworks -->[m
[32m+[m[32m    <framework src="AVFoundation.framework" />[m
[32m+[m[32m    <framework src="AudioToolbox.framework" />[m
[32m+[m[32m  </platform>[m
[32m+[m[32m  <platform name="android">[m
[32m+[m[32m    <source-file src="src/android/com/phonegap/plugins/barcodescanner/BarcodeScanner.java" target-dir="src/com/phonegap/plugins/barcodescanner"/>[m
[32m+[m[32m    <config-file target="res/xml/config.xml" parent="/*">[m
[32m+[m[32m      <feature name="BarcodeScanner">[m
[32m+[m[32m        <param name="android-package" value="com.phonegap.plugins.barcodescanner.BarcodeScanner"/>[m
[32m+[m[32m      </feature>[m
[32m+[m[32m    </config-file>[m
[32m+[m[32m    <config-file target="AndroidManifest.xml" parent="/manifest/application">[m
[32m+[m[32m      <activity android:name="com.google.zxing.client.android.CaptureActivity" android:clearTaskOnLaunch="true" android:configChanges="orientation|keyboardHidden|screenSize" android:theme="@android:style/Theme.NoTitleBar.Fullscreen" android:windowSoftInputMode="stateAlwaysHidden" android:exported="false"/>[m
[32m+[m[32m      <activity android:name="com.google.zxing.client.android.encode.EncodeActivity" android:label="Share"/>[m
[32m+[m[32m    </config-file>[m
[32m+[m[32m    <config-file target="AndroidManifest.xml" parent="/manifest">[m
[32m+[m[32m      <uses-permission android:name="android.permission.CAMERA"/>[m
[32m+[m[32m      <uses-permission android:name="android.permission.FLASHLIGHT"/>[m
[32m+[m[32m      <uses-feature android:name="android.hardware.camera" android:required="true"/>[m
[32m+[m[32m    </config-file>[m
[32m+[m[32m    <framework src="src/android/barcodescanner.gradle" custom="true" type="gradleReference"/>[m
[32m+[m[32m    <framework src="com.android.support:support-v4:$ANDROID_SUPPORT_V4_VERSION"/>[m
[32m+[m[32m    <lib-file src="src/android/barcodescanner-release-2.1.5.aar"/>[m
[32m+[m[32m    <preference name="ANDROID_SUPPORT_V4_VERSION" default="27.+"/>[m
[32m+[m[32m  </platform>[m
[32m+[m[32m  <platform name="windows">[m
[32m+[m[32m    <js-module src="src/windows/BarcodeScannerProxy.js" name="BarcodeScannerProxy">[m
[32m+[m[32m      <merges target=""/>[m
     </js-module>[m
[31m-[m
[31m-    <!-- ios -->[m
[31m-    <platform name="ios">[m
[31m-        <!-- Cordova >= 2.8 -->[m
[31m-        <config-file target="config.xml" parent="/*">[m
[31m-            <feature name="BarcodeScanner">[m
[31m-                <param name="ios-package" value="CDVBarcodeScanner" />[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <resource-file src="src/ios/scannerOverlay.xib" />[m
[31m-        <resource-file src="src/ios/CDVBarcodeScanner.bundle" />[m
[31m-[m
[31m-        <header-file src="src/ios/zxing-all-in-one.h" />[m
[31m-[m
[31m-        <source-file src="src/ios/CDVBarcodeScanner.mm" compiler-flags="-fno-objc-arc" />[m
[31m-        <source-file src="src/ios/zxing-all-in-one.cpp" />[m
[31m-[m
[31m-        <framework src="libiconv.dylib" />[m
[31m-        <framework src="AVFoundation.framework" />[m
[31m-        <framework src="AssetsLibrary.framework" />[m
[31m-        <framework src="CoreVideo.framework" />[m
[31m-        <framework src="QuartzCore.framework" />[m
[31m-        <framework src="CoreGraphics.framework" />[m
[31m-        <framework src="CoreImage.framework" />[m
[31m-        <framework src="AudioToolbox.framework" />[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- android -->[m
[31m-    <platform name="android">[m
[31m-[m
[31m-        <source-file src="src/android/com/phonegap/plugins/barcodescanner/BarcodeScanner.java" target-dir="src/com/phonegap/plugins/barcodescanner" />[m
[31m-[m
[31m-        <config-file target="res/xml/config.xml" parent="/*">[m
[31m-            <feature name="BarcodeScanner">[m
[31m-                <param name="android-package" value="com.phonegap.plugins.barcodescanner.BarcodeScanner" />[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <config-file target="AndroidManifest.xml" parent="/manifest/application">[m
[31m-            <activity[m
[31m-                android:name="com.google.zxing.client.android.CaptureActivity"[m
[31m-                android:clearTaskOnLaunch="true"[m
[31m-                android:configChanges="orientation|keyboardHidden|screenSize"[m
[31m-                android:theme="@android:style/Theme.NoTitleBar.Fullscreen"[m
[31m-                android:windowSoftInputMode="stateAlwaysHidden"[m
[31m-                android:exported="false">[m
[31m-                <intent-filter>[m
[31m-                    <action android:name="com.google.zxing.client.android.SCAN"/>[m
[31m-                    <category android:name="android.intent.category.DEFAULT"/>[m
[31m-                </intent-filter>[m
[31m-            </activity>[m
[31m-            <activity android:name="com.google.zxing.client.android.encode.EncodeActivity" android:label="Share">[m
[31m-                <intent-filter>[m
[31m-                    <action android:name="com.phonegap.plugins.barcodescanner.ENCODE"/>[m
[31m-                    <category android:name="android.intent.category.DEFAULT"/>[m
[31m-                </intent-filter>[m
[31m-            </activity>[m
[31m-            <activity android:name="com.google.zxing.client.android.HelpActivity" android:label="Share">[m
[31m-                <intent-filter>[m
[31m-                    <action android:name="android.intent.action.VIEW"/>[m
[31m-                    <category android:name="android.intent.category.DEFAULT"/>[m
[31m-                </intent-filter>[m
[31m-            </activity>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <config-file target="AndroidManifest.xml" parent="/manifest">[m
[31m-            <uses-permission android:name="android.permission.CAMERA" />[m
[31m-            <uses-permission android:name="android.permission.FLASHLIGHT" />[m
[31m-            <!-- Not required to allow users to work around this -->[m
[31m-            <uses-feature android:name="android.hardware.camera" android:required="false" />[m
[31m-        </config-file>[m
[31m-[m
[31m-        <framework src="src/android/barcodescanner.gradle" custom="true" type="gradleReference"/>[m
[31m-        <resource-file src="src/android/barcodescanner-release-2.0.1.aar" target="libs/barcodescanner.aar" />[m
[31m-[m
[31m-        <dependency id="cordova-plugin-compat" version="^1.0.0" />[m
[31m-    </platform>[m
[31m-[m
[31m-    <platform name="windows8">[m
[31m-        <js-module src="src/windows/BarcodeScannerProxy.js" name="BarcodeScannerProxy">[m
[31m-            <merges target="" />[m
[31m-        </js-module>[m
[31m-[m
[31m-        <config-file target="package.appxmanifest" parent="/Package/Capabilities">[m
[31m-            <DeviceCapability Name="webcam" />[m
[31m-        </config-file>[m
[31m-[m
[31m-        <framework src="src/windows/lib/WinRTBarcodeReader.csproj" custom="true" type="projectReference" versions="&lt;=8.1"/>[m
[31m-        <framework src="src/windows/lib.UW/WinRTBarcodeReader.UW.csproj" custom="true" type="projectReference" versions=">8.1"/>[m
[31m-[m
[31m-        <asset src="src/windows/assets/plugin-barcodeScanner.css" target="css/plugin-barcodeScanner.css" />[m
[31m-    </platform>[m
[31m-[m
[31m-    <platform name="windows">[m
[31m-        <js-module src="src/windows/BarcodeScannerProxy.js" name="BarcodeScannerProxy">[m
[31m-            <merges target="" />[m
[31m-        </js-module>[m
[31m-[m
[31m-        <config-file target="package.appxmanifest" parent="/Package/Capabilities">[m
[31m-            <DeviceCapability Name="webcam" />[m
[31m-        </config-file>[m
[31m-[m
[31m-        <framework src="src/windows/lib.UW/x86/ZXing.winmd" target-dir="x86" arch="x86" custom="true" versions=">8.1" />[m
[31m-        <framework src="src/windows/lib.UW/x64/ZXing.winmd" target-dir="x64" arch="x64" custom="true" versions=">8.1" />[m
[31m-        <framework src="src/windows/lib.UW/ARM/ZXing.winmd" target-dir="ARM" arch="ARM" custom="true" versions=">8.1" />[m
[31m-        <framework src="src/windows/lib/WinRTBarcodeReader.csproj" custom="true" type="projectReference" versions="&lt;=8.1"/>[m
[31m-[m
[31m-        <asset src="src/windows/assets/plugin-barcodeScanner.css" target="css/plugin-barcodeScanner.css" />[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- Windows Phone 8 -->[m
[31m-    <platform name="wp8">[m
[31m-        <config-file target="config.xml" parent="/*">[m
[31m-            <feature name="BarcodeScanner">[m
[31m-                <param name="wp-package" value="BarcodeScanner"/>[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <config-file target="Properties/WMAppManifest.xml" parent="/Deployment/App/Capabilities">[m
[31m-            <Capability Name="ID_CAP_ISV_CAMERA" />[m
[31m-        </config-file>[m
[31m-[m
[31m-        <framework src="src/wp8/lib/zxing.wp8.0.dll" custom="true" />[m
[31m-[m
[31m-        <asset src="src/wp8/assets/cancel.png" target="Images/appbar.cancel.png" />[m
[31m-[m
[31m-        <source-file src="src/wp8/BarcodeScanner.cs" />[m
[31m-        <source-file src="src/wp8/BarcodeScannerTask.cs" />[m
[31m-        <source-file src="src/wp8/BarcodeScannerUI.xaml" />[m
[31m-        <source-file src="src/wp8/BarcodeScannerUI.xaml.cs" />[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- browser -->[m
[31m-    <platform name="browser">[m
[31m-        <config-file target="config.xml" parent="/*">[m
[31m-            <feature name="BarcodeScanner">[m
[31m-                <param name="browser-package" value="BarcodeScanner" />[m
[31m-            </feature>[m
[31m-        </config-file>[m
[31m-[m
[31m-        <js-module src="src/browser/BarcodeScannerProxy.js" name="BarcodeScannerProxy">[m
[31m-            <runs />[m
[31m-        </js-module>[m
[31m-    </platform>[m
[31m-[m
[31m-    <!-- BlackBerry 10 -->[m
[31m-    <platform name="blackberry10">[m
[31m-        <source-file src="src/blackberry10/index.js" target-dir="BarcodeScanner" />[m
[31m-        <source-file src="src/blackberry10/qrcode.js" target-dir="BarcodeScanner" />[m
[31m-        <lib-file src="src/blackberry10/native/device/libBarcodeScanner.so" arch="device"/>[m
[31m-        <lib-file src="src/blackberry10/native/simulator/libBarcodeScanner.so" arch="simulator"/>[m
[31m-        <config-file target="www/config.xml" parent="/widget">[m
[31m-            <feature name="BarcodeScanner">[m
[31m-		<param name="blackberry-package" value="phonegap-plugin-barcodescanner" />[m
[31m-	    </feature>[m
[31m-        </config-file>[m
[31m-        <config-file target="www/config.xml" parent="/widget/rim:permissions">[m
[31m-            <rim:permit>use_camera</rim:permit>[m
[31m-        </config-file>[m
[31m-        <dependency id="cordova-plugin-bb-app" />[m
[31m-    </platform>[m
[32m+[m[32m    <config-file target="package.appxmanifest" parent="/Package/Capabilities">[m
[32m+[m[32m      <DeviceCapability Name="webcam"/>[m
[32m+[m[32m    </config-file>[m
[32m+[m[32m    <framework src="src/windows/lib.UW/x86/ZXing.winmd" target-dir="x86" arch="x86" custom="true" versions=">8.1"/>[m
[32m+[m[32m    <framework src="src/windows/lib.UW/x64/ZXing.winmd" target-dir="x64" arch="x64" custom="true" versions=">8.1"/>[m
[32m+[m[32m    <framework src="src/windows/lib.UW/ARM/ZXing.winmd" target-dir="ARM" arch="ARM" custom="true" versions=">8.1"/>[m
[32m+[m[32m    <framework src="src/windows/lib/WinRTBarcodeReader.csproj" custom="true" type="projectReference" versions="&lt;=8.1"/>[m
[32m+[m[32m    <asset src="src/windows/assets/plugin-barcodeScanner.css" target="css/plugin-barcodeScanner.css"/>[m
[32m+[m[32m    <hook src="hooks/windows/check-arch.js" type="before_compile"/>[m
[32m+[m[32m    <hook src="hooks/windows/check-arch.js" type="before_run"/>[m
[32m+[m[32m  </platform>[m
[32m+[m[32m  <platform name="browser">[m
[32m+[m[32m    <config-file target="config.xml" parent="/*">[m
[32m+[m[32m      <feature name="BarcodeScanner">[m
[32m+[m[32m        <param name="browser-package" value="BarcodeScanner"/>[m
[32m+[m[32m      </feature>[m
[32m+[m[32m    </config-file>[m
[32m+[m[32m    <js-module src="src/browser/BarcodeScannerProxy.js" name="BarcodeScannerProxy">[m
[32m+[m[32m      <runs/>[m
[32m+[m[32m    </js-module>[m
[32m+[m[32m  </platform>[m
 </plugin>[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/README.md b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/README.md[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/barcodescanner-release-2.0.1.aar b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/barcodescanner-release-2.0.1.aar[m
[1mdeleted file mode 100755[m
[1mindex abea644..0000000[m
Binary files a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/barcodescanner-release-2.0.1.aar and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/barcodescanner.gradle b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/barcodescanner.gradle[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex ff2b44d..93c8d61[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/barcodescanner.gradle[m
[1m+++ b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/barcodescanner.gradle[m
[36m@@ -1,5 +1,3 @@[m
[31m-ext.cdvMinSdkVersion = 15[m
[31m-[m
 repositories{[m
     jcenter()[m
     flatDir{[m
[36m@@ -8,8 +6,7 @@[m [mrepositories{[m
 }[m
 [m
 dependencies {[m
[31m-    compile 'com.android.support:support-v4:+'[m
[31m-    compile(name:'barcodescanner', ext:'aar')[m
[32m+[m[32m    compile(name:'barcodescanner-release-2.1.5', ext:'aar')[m
 }[m
 [m
 android {[m
[36m@@ -17,4 +14,4 @@[m [mandroid {[m
         exclude 'META-INF/NOTICE'[m
         exclude 'META-INF/LICENSE'[m
     }[m
[31m-}[m
\ No newline at end of file[m
[32m+[m[32m}[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/com/phonegap/plugins/barcodescanner/BarcodeScanner.java b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/com/phonegap/plugins/barcodescanner/BarcodeScanner.java[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex f2d4234..71c0e6e[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/com/phonegap/plugins/barcodescanner/BarcodeScanner.java[m
[1m+++ b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/android/com/phonegap/plugins/barcodescanner/BarcodeScanner.java[m
[36m@@ -15,6 +15,7 @@[m [mimport org.json.JSONObject;[m
 import android.Manifest;[m
 import android.app.Activity;[m
 import android.content.Intent;[m
[32m+[m[32mimport android.os.Bundle;[m
 import android.util.Log;[m
 import android.content.pm.PackageManager;[m
 [m
[36m@@ -23,6 +24,8 @@[m [mimport org.apache.cordova.CallbackContext;[m
 import org.apache.cordova.PluginResult;[m
 import org.apache.cordova.PermissionHelper;[m
 [m
[32m+[m[32mimport com.google.zxing.client.android.CaptureActivity;[m
[32m+[m[32mimport com.google.zxing.client.android.encode.EncodeActivity;[m
 import com.google.zxing.client.android.Intents;[m
 [m
 /**[m
[36m@@ -31,7 +34,7 @@[m [mimport com.google.zxing.client.android.Intents;[m
  * @sa https://github.com/apache/cordova-android/blob/master/framework/src/org/apache/cordova/CordovaPlugin.java[m
  */[m
 public class BarcodeScanner extends CordovaPlugin {[m
[31m-    public static final int REQUEST_CODE = 0x0ba7c0de;[m
[32m+[m[32m    public static final int REQUEST_CODE = 0x0ba7c;[m
 [m
     private static final String SCAN = "scan";[m
     private static final String ENCODE = "encode";[m
[36m@@ -43,12 +46,13 @@[m [mpublic class BarcodeScanner extends CordovaPlugin {[m
     private static final String PREFER_FRONTCAMERA = "preferFrontCamera";[m
     private static final String ORIENTATION = "orientation";[m
     private static final String SHOW_FLIP_CAMERA_BUTTON = "showFlipCameraButton";[m
[32m+[m[32m    private static final String RESULTDISPLAY_DURATION = "resultDisplayDuration";[m
[32m+[m[32m    private static final String SHOW_TORCH_BUTTON = "showTorchButton";[m
[32m+[m[32m    private static final String TORCH_ON = "torchOn";[m
[32m+[m[32m    private static final String SAVE_HISTORY = "saveHistory";[m
[32m+[m[32m    private static final String DISABLE_BEEP = "disableSuccessBeep";[m
     private static final String FORMATS = "formats";[m
     private static final String PROMPT = "prompt";[m
[31m-    private static final String SCAN_INTENT = "com.google.zxing.client.android.SCAN";[m
[31m-    private static final String ENCODE_DATA = "ENCODE_DATA";[m
[31m-    private static final String ENCODE_TYPE = "ENCODE_TYPE";[m
[31m-    private static final String ENCODE_INTENT = "com.phonegap.plugins.barcodescanner.ENCODE";[m
     private static final String TEXT_TYPE = "TEXT_TYPE";[m
     private static final String EMAIL_TYPE = "EMAIL_TYPE";[m
     private static final String PHONE_TYPE = "PHONE_TYPE";[m
[36m@@ -133,7 +137,8 @@[m [mpublic class BarcodeScanner extends CordovaPlugin {[m
         cordova.getThreadPool().execute(new Runnable() {[m
             public void run() {[m
 [m
[31m-                Intent intentScan = new Intent(SCAN_INTENT);[m
[32m+[m[32m                Intent intentScan = new Intent(that.cordova.getActivity().getBaseContext(), CaptureActivity.class);[m
[32m+[m[32m                intentScan.setAction(Intents.Scan.ACTION);[m
                 intentScan.addCategory(Intent.CATEGORY_DEFAULT);[m
 [m
                 // add config as intent extras[m
[36m@@ -172,6 +177,14 @@[m [mpublic class BarcodeScanner extends CordovaPlugin {[m
 [m
                         intentScan.putExtra(Intents.Scan.CAMERA_ID, obj.optBoolean(PREFER_FRONTCAMERA, false) ? 1 : 0);[m
                         intentScan.putExtra(Intents.Scan.SHOW_FLIP_CAMERA_BUTTON, obj.optBoolean(SHOW_FLIP_CAMERA_BUTTON, false));[m
[32m+[m[32m                        intentScan.putExtra(Intents.Scan.SHOW_TORCH_BUTTON, obj.optBoolean(SHOW_TORCH_BUTTON, false));[m
[32m+[m[32m                        intentScan.putExtra(Intents.Scan.TORCH_ON, obj.optBoolean(TORCH_ON, false));[m
[32m+[m[32m                        intentScan.putExtra(Intents.Scan.SAVE_HISTORY, obj.optBoolean(SAVE_HISTORY, false));[m
[32m+[m[32m                        boolean beep = obj.optBoolean(DISABLE_BEEP, false);[m
[32m+[m[32m                        intentScan.putExtra(Intents.Scan.BEEP_ON_SCAN, !beep);[m
[32m+[m[32m                        if (obj.has(RESULTDISPLAY_DURATION)) {[m
[32m+[m[32m                            intentScan.putExtra(Intents.Scan.RESULT_DISPLAY_DURATION_MS, "" + obj.optLong(RESULTDISPLAY_DURATION));[m
[32m+[m[32m                        }[m
                         if (obj.has(FORMATS)) {[m
                             intentScan.putExtra(Intents.Scan.FORMATS, obj.optString(FORMATS));[m
                         }[m
[36m@@ -240,9 +253,10 @@[m [mpublic class BarcodeScanner extends CordovaPlugin {[m
      * @param data The data to encode in the bar code.[m
      */[m
     public void encode(String type, String data) {[m
[31m-        Intent intentEncode = new Intent(ENCODE_INTENT);[m
[31m-        intentEncode.putExtra(ENCODE_TYPE, type);[m
[31m-        intentEncode.putExtra(ENCODE_DATA, data);[m
[32m+[m[32m        Intent intentEncode = new Intent(this.cordova.getActivity().getBaseContext(), EncodeActivity.class);[m
[32m+[m[32m        intentEncode.setAction(Intents.Encode.ACTION);[m
[32m+[m[32m        intentEncode.putExtra(Intents.Encode.TYPE, type);[m
[32m+[m[32m        intentEncode.putExtra(Intents.Encode.DATA, data);[m
         // avoid calling other phonegap apps[m
         intentEncode.setPackage(this.cordova.getActivity().getApplicationContext().getPackageName());[m
 [m
[36m@@ -302,4 +316,13 @@[m [mpublic class BarcodeScanner extends CordovaPlugin {[m
        }[m
    }[m
 [m
[32m+[m[32m    /**[m
[32m+[m[32m     * This plugin launches an external Activity when the camera is opened, so we[m
[32m+[m[32m     * need to implement the save/restore API in case the Activity gets killed[m
[32m+[m[32m     * by the OS while it's in the background.[m
[32m+[m[32m     */[m
[32m+[m[32m    public void onRestoreStateForActivityResult(Bundle state, CallbackContext callbackContext) {[m
[32m+[m[32m        this.callbackContext = callbackContext;[m
[32m+[m[32m    }[m
[32m+[m
 }[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/LICENSE b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/LICENSE[m
[1mdeleted file mode 100755[m
[1mindex 680566f..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/LICENSE[m
[1m+++ /dev/null[m
[36m@@ -1,703 +0,0 @@[m
[31m-                                 Apache License[m
[31m-                           Version 2.0, January 2004[m
[31m-                        http://www.apache.org/licenses/[m
[31m-[m
[31m-   TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION[m
[31m-[m
[31m-   1. Definitions.[m
[31m-[m
[31m-      "License" shall mean the terms and conditions for use, reproduction,[m
[31m-      and distribution as defined by Sections 1 through 9 of this document.[m
[31m-[m
[31m-      "Licensor" shall mean the copyright owner or entity authorized by[m
[31m-      the copyright owner that is granting the License.[m
[31m-[m
[31m-      "Legal Entity" shall mean the union of the acting entity and all[m
[31m-      other entities that control, are controlled by, or are under common[m
[31m-      control with that entity. For the purposes of this definition,[m
[31m-      "control" means (i) the power, direct or indirect, to cause the[m
[31m-      direction or management of such entity, whether by contract or[m
[31m-      otherwise, or (ii) ownership of fifty percent (50%) or more of the[m
[31m-      outstanding shares, or (iii) beneficial ownership of such entity.[m
[31m-[m
[31m-      "You" (or "Your") shall mean an individual or Legal Entity[m
[31m-      exercising permissions granted by this License.[m
[31m-[m
[31m-      "Source" form shall mean the preferred form for making modifications,[m
[31m-      including but not limited to software source code, documentation[m
[31m-      source, and configuration files.[m
[31m-[m
[31m-      "Object" form shall mean any form resulting from mechanical[m
[31m-      transformation or translation of a Source form, including but[m
[31m-      not limited to compiled object code, generated documentation,[m
[31m-      and conversions to other media types.[m
[31m-[m
[31m-      "Work" shall mean the work of authorship, whether in Source or[m
[31m-      Object form, made available under the License, as indicated by a[m
[31m-      copyright notice that is included in or attached to the work[m
[31m-      (an example is provided in the Appendix below).[m
[31m-[m
[31m-      "Derivative Works" shall mean any work, whether in Source or Object[m
[31m-      form, that is based on (or derived from) the Work and for which the[m
[31m-      editorial revisions, annotations, elaborations, or other modifications[m
[31m-      represent, as a whole, an original work of authorship. For the purposes[m
[31m-      of this License, Derivative Works shall not include works that remain[m
[31m-      separable from, or merely link (or bind by name) to the interfaces of,[m
[31m-      the Work and Derivative Works thereof.[m
[31m-[m
[31m-      "Contribution" shall mean any work of authorship, including[m
[31m-      the original version of the Work and any modifications or additions[m
[31m-      to that Work or Derivative Works thereof, that is intentionally[m
[31m-      submitted to Licensor for inclusion in the Work by the copyright owner[m
[31m-      or by an individual or Legal Entity authorized to submit on behalf of[m
[31m-      the copyright owner. For the purposes of this definition, "submitted"[m
[31m-      means any form of electronic, verbal, or written communication sent[m
[31m-      to the Licensor or its representatives, including but not limited to[m
[31m-      communication on electronic mailing lists, source code control systems,[m
[31m-      and issue tracking systems that are managed by, or on behalf of, the[m
[31m-      Licensor for the purpose of discussing and improving the Work, but[m
[31m-      excluding communication that is conspicuously marked or otherwise[m
[31m-      designated in writing by the copyright owner as "Not a Contribution."[m
[31m-[m
[31m-      "Contributor" shall mean Licensor and any individual or Legal Entity[m
[31m-      on behalf of whom a Contribution has been received by Licensor and[m
[31m-      subsequently incorporated within the Work.[m
[31m-[m
[31m-   2. Grant of Copyright License. Subject to the terms and conditions of[m
[31m-      this License, each Contributor hereby grants to You a perpetual,[m
[31m-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable[m
[31m-      copyright license to reproduce, prepare Derivative Works of,[m
[31m-      publicly display, publicly perform, sublicense, and distribute the[m
[31m-      Work and such Derivative Works in Source or Object form.[m
[31m-[m
[31m-   3. Grant of Patent License. Subject to the terms and conditions of[m
[31m-      this License, each Contributor hereby grants to You a perpetual,[m
[31m-      worldwide, non-exclusive, no-charge, royalty-free, irrevocable[m
[31m-      (except as stated in this section) patent license to make, have made,[m
[31m-      use, offer to sell, sell, import, and otherwise transfer the Work,[m
[31m-      where such license applies only to those patent claims licensable[m
[31m-      by such Contributor that are necessarily infringed by their[m
[31m-      Contribution(s) alone or by combination of their Contribution(s)[m
[31m-      with the Work to which such Contribution(s) was submitted. If You[m
[31m-      institute patent litigation against any entity (including a[m
[31m-      cross-claim or counterclaim in a lawsuit) alleging that the Work[m
[31m-      or a Contribution incorporated within the Work constitutes direct[m
[31m-      or contributory patent infringement, then any patent licenses[m
[31m-      granted to You under this License for that Work shall terminate[m
[31m-      as of the date such litigation is filed.[m
[31m-[m
[31m-   4. Redistribution. You may reproduce and distribute copies of the[m
[31m-      Work or Derivative Works thereof in any medium, with or without[m
[31m-      modifications, and in Source or Object form, provided that You[m
[31m-      meet the following conditions:[m
[31m-[m
[31m-      (a) You must give any other recipients of the Work or[m
[31m-          Derivative Works a copy of this License; and[m
[31m-[m
[31m-      (b) You must cause any modified files to carry prominent notices[m
[31m-          stating that You changed the files; and[m
[31m-[m
[31m-      (c) You must retain, in the Source form of any Derivative Works[m
[31m-          that You distribute, all copyright, patent, trademark, and[m
[31m-          attribution notices from the Source form of the Work,[m
[31m-          excluding those notices that do not pertain to any part of[m
[31m-          the Derivative Works; and[m
[31m-[m
[31m-      (d) If the Work includes a "NOTICE" text file as part of its[m
[31m-          distribution, then any Derivative Works that You distribute must[m
[31m-          include a readable copy of the attribution notices contained[m
[31m-          within such NOTICE file, excluding those notices that do not[m
[31m-          pertain to any part of the Derivative Works, in at least one[m
[31m-          of the following places: within a NOTICE text file distributed[m
[31m-          as part of the Derivative Works; within the Source form or[m
[31m-          documentation, if provided along with the Derivative Works; or,[m
[31m-          within a display generated by the Derivative Works, if and[m
[31m-          wherever such third-party notices normally appear. The contents[m
[31m-          of the NOTICE file are for informational purposes only and[m
[31m-          do not modify the License. You may add Your own attribution[m
[31m-          notices within Derivative Works that You distribute, alongside[m
[31m-          or as an addendum to the NOTICE text from the Work, provided[m
[31m-          that such additional attribution notices cannot be construed[m
[31m-          as modifying the License.[m
[31m-[m
[31m-      You may add Your own copyright statement to Your modifications and[m
[31m-      may provide additional or different license terms and conditions[m
[31m-      for use, reproduction, or distribution of Your modifications, or[m
[31m-      for any such Derivative Works as a whole, provided Your use,[m
[31m-      reproduction, and distribution of the Work otherwise complies with[m
[31m-      the conditions stated in this License.[m
[31m-[m
[31m-   5. Submission of Contributions. Unless You explicitly state otherwise,[m
[31m-      any Contribution intentionally submitted for inclusion in the Work[m
[31m-      by You to the Licensor shall be under the terms and conditions of[m
[31m-      this License, without any additional terms or conditions.[m
[31m-      Notwithstanding the above, nothing herein shall supersede or modify[m
[31m-      the terms of any separate license agreement you may have executed[m
[31m-      with Licensor regarding such Contributions.[m
[31m-[m
[31m-   6. Trademarks. This License does not grant permission to use the trade[m
[31m-      names, trademarks, service marks, or product names of the Licensor,[m
[31m-      except as required for reasonable and customary use in describing the[m
[31m-      origin of the Work and reproducing the content of the NOTICE file.[m
[31m-[m
[31m-   7. Disclaimer of Warranty. Unless required by applicable law or[m
[31m-      agreed to in writing, Licensor provides the Work (and each[m
[31m-      Contributor provides its Contributions) on an "AS IS" BASIS,[m
[31m-      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or[m
[31m-      implied, including, without limitation, any warranties or conditions[m
[31m-      of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A[m
[31m-      PARTICULAR PURPOSE. You are solely responsible for determining the[m
[31m-      appropriateness of using or redistributing the Work and assume any[m
[31m-      risks associated with Your exercise of permissions under this License.[m
[31m-[m
[31m-   8. Limitation of Liability. In no event and under no legal theory,[m
[31m-      whether in tort (including negligence), contract, or otherwise,[m
[31m-      unless required by applicable law (such as deliberate and grossly[m
[31m-      negligent acts) or agreed to in writing, shall any Contributor be[m
[31m-      liable to You for damages, including any direct, indirect, special,[m
[31m-      incidental, or consequential damages of any character arising as a[m
[31m-      result of this License or out of the use or inability to use the[m
[31m-      Work (including but not limited to damages for loss of goodwill,[m
[31m-      work stoppage, computer failure or malfunction, or any and all[m
[31m-      other commercial damages or losses), even if such Contributor[m
[31m-      has been advised of the possibility of such damages.[m
[31m-[m
[31m-   9. Accepting Warranty or Additional Liability. While redistributing[m
[31m-      the Work or Derivative Works thereof, You may choose to offer,[m
[31m-      and charge a fee for, acceptance of support, warranty, indemnity,[m
[31m-      or other liability obligations and/or rights consistent with this[m
[31m-      License. However, in accepting such obligations, You may act only[m
[31m-      on Your own behalf and on Your sole responsibility, not on behalf[m
[31m-      of any other Contributor, and only if You agree to indemnify,[m
[31m-      defend, and hold each Contributor harmless for any liability[m
[31m-      incurred by, or claims asserted against, such Contributor by reason[m
[31m-      of your accepting any such warranty or additional liability.[m
[31m-[m
[31m-   END OF TERMS AND CONDITIONS[m
[31m-[m
[31m-   APPENDIX: How to apply the Apache License to your work.[m
[31m-[m
[31m-      To apply the Apache License to your work, attach the following[m
[31m-      boilerplate notice, with the fields enclosed by brackets "[]"[m
[31m-      replaced with your own identifying information. (Don't include[m
[31m-      the brackets!)  The text should be enclosed in the appropriate[m
[31m-      comment syntax for the file format. We also recommend that a[m
[31m-      file or class name and description of purpose be included on the[m
[31m-      same "printed page" as the copyright notice for easier[m
[31m-      identification within third-party archives.[m
[31m-[m
[31m-   Copyright [yyyy] [name of copyright owner][m
[31m-[m
[31m-   Licensed under the Apache License, Version 2.0 (the "License");[m
[31m-   you may not use this file except in compliance with the License.[m
[31m-   You may obtain a copy of the License at[m
[31m-[m
[31m-       http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-   Unless required by applicable law or agreed to in writing, software[m
[31m-   distributed under the License is distributed on an "AS IS" BASIS,[m
[31m-   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m-   See the License for the specific language governing permissions and[m
[31m-   limitations under the License.[m
[31m-[m
[31m--------------------------------------------------------[m
[31m-*JNEXT (v1.0.8.3)[m
[31m-[m
[31m-                          MOZILLA PUBLIC LICENSE[m
[31m-                                Version 1.1[m
[31m-[m
[31m-                              ---------------[m
[31m-[m
[31m-1. Definitions.[m
[31m-[m
[31m-     1.0.1. "Commercial Use" means distribution or otherwise making the[m
[31m-     Covered Code available to a third party.[m
[31m-[m
[31m-     1.1. "Contributor" means each entity that creates or contributes to[m
[31m-     the creation of Modifications.[m
[31m-[m
[31m-     1.2. "Contributor Version" means the combination of the Original[m
[31m-     Code, prior Modifications used by a Contributor, and the Modifications[m
[31m-     made by that particular Contributor.[m
[31m-[m
[31m-     1.3. "Covered Code" means the Original Code or Modifications or the[m
[31m-     combination of the Original Code and Modifications, in each case[m
[31m-     including portions thereof.[m
[31m-[m
[31m-     1.4. "Electronic Distribution Mechanism" means a mechanism generally[m
[31m-     accepted in the software development community for the electronic[m
[31m-     transfer of data.[m
[31m-[m
[31m-     1.5. "Executable" means Covered Code in any form other than Source[m
[31m-     Code.[m
[31m-[m
[31m-     1.6. "Initial Developer" means the individual or entity identified[m
[31m-     as the Initial Developer in the Source Code notice required by Exhibit[m
[31m-     A.[m
[31m-[m
[31m-     1.7. "Larger Work" means a work which combines Covered Code or[m
[31m-     portions thereof with code not governed by the terms of this License.[m
[31m-[m
[31m-     1.8. "License" means this document.[m
[31m-[m
[31m-     1.8.1. "Licensable" means having the right to grant, to the maximum[m
[31m-     extent possible, whether at the time of the initial grant or[m
[31m-     subsequently acquired, any and all of the rights conveyed herein.[m
[31m-[m
[31m-     1.9. "Modifications" means any addition to or deletion from the[m
[31m-     substance or structure of either the Original Code or any previous[m
[31m-     Modifications. When Covered Code is released as a series of files, a[m
[31m-     Modification is:[m
[31m-          A. Any addition to or deletion from the contents of a file[m
[31m-          containing Original Code or previous Modifications.[m
[31m-[m
[31m-          B. Any new file that contains any part of the Original Code or[m
[31m-          previous Modifications.[m
[31m-[m
[31m-     1.10. "Original Code" means Source Code of computer software code[m
[31m-     which is described in the Source Code notice required by Exhibit A as[m
[31m-     Original Code, and which, at the time of its release under this[m
[31m-     License is not already Covered Code governed by this License.[m
[31m-[m
[31m-     1.10.1. "Patent Claims" means any patent claim(s), now owned or[m
[31m-     hereafter acquired, including without limitation,  method, process,[m
[31m-     and apparatus claims, in any patent Licensable by grantor.[m
[31m-[m
[31m-     1.11. "Source Code" means the preferred form of the Covered Code for[m
[31m-     making modifications to it, including all modules it contains, plus[m
[31m-     any associated interface definition files, scripts used to control[m
[31m-     compilation and installation of an Executable, or source code[m
[31m-     differential comparisons against either the Original Code or another[m
[31m-     well known, available Covered Code of the Contributor's choice. The[m
[31m-     Source Code can be in a compressed or archival form, provided the[m
[31m-     appropriate decompression or de-archiving software is widely available[m
[31m-     for no charge.[m
[31m-[m
[31m-     1.12. "You" (or "Your")  means an individual or a legal entity[m
[31m-     exercising rights under, and complying with all of the terms of, this[m
[31m-     License or a future version of this License issued under Section 6.1.[m
[31m-     For legal entities, "You" includes any entity which controls, is[m
[31m-     controlled by, or is under common control with You. For purposes of[m
[31m-     this definition, "control" means (a) the power, direct or indirect,[m
[31m-     to cause the direction or management of such entity, whether by[m
[31m-     contract or otherwise, or (b) ownership of more than fifty percent[m
[31m-     (50%) of the outstanding shares or beneficial ownership of such[m
[31m-     entity.[m
[31m-[m
[31m-2. Source Code License.[m
[31m-[m
[31m-     2.1. The Initial Developer Grant.[m
[31m-     The Initial Developer hereby grants You a world-wide, royalty-free,[m
[31m-     non-exclusive license, subject to third party intellectual property[m
[31m-     claims:[m
[31m-          (a)  under intellectual property rights (other than patent or[m
[31m-          trademark) Licensable by Initial Developer to use, reproduce,[m
[31m-          modify, display, perform, sublicense and distribute the Original[m
[31m-          Code (or portions thereof) with or without Modifications, and/or[m
[31m-          as part of a Larger Work; and[m
[31m-[m
[31m-          (b) under Patents Claims infringed by the making, using or[m
[31m-          selling of Original Code, to make, have made, use, practice,[m
[31m-          sell, and offer for sale, and/or otherwise dispose of the[m
[31m-          Original Code (or portions thereof).[m
[31m-[m
[31m-          (c) the licenses granted in this Section 2.1(a) and (b) are[m
[31m-          effective on the date Initial Developer first distributes[m
[31m-          Original Code under the terms of this License.[m
[31m-[m
[31m-          (d) Notwithstanding Section 2.1(b) above, no patent license is[m
[31m-          granted: 1) for code that You delete from the Original Code; 2)[m
[31m-          separate from the Original Code;  or 3) for infringements caused[m
[31m-          by: i) the modification of the Original Code or ii) the[m
[31m-          combination of the Original Code with other software or devices.[m
[31m-[m
[31m-     2.2. Contributor Grant.[m
[31m-     Subject to third party intellectual property claims, each Contributor[m
[31m-     hereby grants You a world-wide, royalty-free, non-exclusive license[m
[31m-[m
[31m-          (a)  under intellectual property rights (other than patent or[m
[31m-          trademark) Licensable by Contributor, to use, reproduce, modify,[m
[31m-          display, perform, sublicense and distribute the Modifications[m
[31m-          created by such Contributor (or portions thereof) either on an[m
[31m-          unmodified basis, with other Modifications, as Covered Code[m
[31m-          and/or as part of a Larger Work; and[m
[31m-[m
[31m-          (b) under Patent Claims infringed by the making, using, or[m
[31m-          selling of  Modifications made by that Contributor either alone[m
[31m-          and/or in combination with its Contributor Version (or portions[m
[31m-          of such combination), to make, use, sell, offer for sale, have[m
[31m-          made, and/or otherwise dispose of: 1) Modifications made by that[m
[31m-          Contributor (or portions thereof); and 2) the combination of[m
[31m-          Modifications made by that Contributor with its Contributor[m
[31m-          Version (or portions of such combination).[m
[31m-[m
[31m-          (c) the licenses granted in Sections 2.2(a) and 2.2(b) are[m
[31m-          effective on the date Contributor first makes Commercial Use of[m
[31m-          the Covered Code.[m
[31m-[m
[31m-          (d)    Notwithstanding Section 2.2(b) above, no patent license is[m
[31m-          granted: 1) for any code that Contributor has deleted from the[m
[31m-          Contributor Version; 2)  separate from the Contributor Version;[m
[31m-          3)  for infringements caused by: i) third party modifications of[m
[31m-          Contributor Version or ii)  the combination of Modifications made[m
[31m-          by that Contributor with other software  (except as part of the[m
[31m-          Contributor Version) or other devices; or 4) under Patent Claims[m
[31m-          infringed by Covered Code in the absence of Modifications made by[m
[31m-          that Contributor.[m
[31m-[m
[31m-3. Distribution Obligations.[m
[31m-[m
[31m-     3.1. Application of License.[m
[31m-     The Modifications which You create or to which You contribute are[m
[31m-     governed by the terms of this License, including without limitation[m
[31m-     Section 2.2. The Source Code version of Covered Code may be[m
[31m-     distributed only under the terms of this License or a future version[m
[31m-     of this License released under Section 6.1, and You must include a[m
[31m-     copy of this License with every copy of the Source Code You[m
[31m-     distribute. You may not offer or impose any terms on any Source Code[m
[31m-     version that alters or restricts the applicable version of this[m
[31m-     License or the recipients' rights hereunder. However, You may include[m
[31m-     an additional document offering the additional rights described in[m
[31m-     Section 3.5.[m
[31m-[m
[31m-     3.2. Availability of Source Code.[m
[31m-     Any Modification which You create or to which You contribute must be[m
[31m-     made available in Source Code form under the terms of this License[m
[31m-     either on the same media as an Executable version or via an accepted[m
[31m-     Electronic Distribution Mechanism to anyone to whom you made an[m
[31m-     Executable version available; and if made available via Electronic[m
[31m-     Distribution Mechanism, must remain available for at least twelve (12)[m
[31m-     months after the date it initially became available, or at least six[m
[31m-     (6) months after a subsequent version of that particular Modification[m
[31m-     has been made available to such recipients. You are responsible for[m
[31m-     ensuring that the Source Code version remains available even if the[m
[31m-     Electronic Distribution Mechanism is maintained by a third party.[m
[31m-[m
[31m-     3.3. Description of Modifications.[m
[31m-     You must cause all Covered Code to which You contribute to contain a[m
[31m-     file documenting the changes You made to create that Covered Code and[m
[31m-     the date of any change. You must include a prominent statement that[m
[31m-     the Modification is derived, directly or indirectly, from Original[m
[31m-     Code provided by the Initial Developer and including the name of the[m
[31m-     Initial Developer in (a) the Source Code, and (b) in any notice in an[m
[31m-     Executable version or related documentation in which You describe the[m
[31m-     origin or ownership of the Covered Code.[m
[31m-[m
[31m-     3.4. Intellectual Property Matters[m
[31m-          (a) Third Party Claims.[m
[31m-          If Contributor has knowledge that a license under a third party's[m
[31m-          intellectual property rights is required to exercise the rights[m
[31m-          granted by such Contributor under Sections 2.1 or 2.2,[m
[31m-          Contributor must include a text file with the Source Code[m
[31m-          distribution titled "LEGAL" which describes the claim and the[m
[31m-          party making the claim in sufficient detail that a recipient will[m
[31m-          know whom to contact. If Contributor obtains such knowledge after[m
[31m-          the Modification is made available as described in Section 3.2,[m
[31m-          Contributor shall promptly modify the LEGAL file in all copies[m
[31m-          Contributor makes available thereafter and shall take other steps[m
[31m-          (such as notifying appropriate mailing lists or newsgroups)[m
[31m-          reasonably calculated to inform those who received the Covered[m
[31m-          Code that new knowledge has been obtained.[m
[31m-[m
[31m-          (b) Contributor APIs.[m
[31m-          If Contributor's Modifications include an application programming[m
[31m-          interface and Contributor has knowledge of patent licenses which[m
[31m-          are reasonably necessary to implement that API, Contributor must[m
[31m-          also include this information in the LEGAL file.[m
[31m-[m
[31m-               (c)    Representations.[m
[31m-          Contributor represents that, except as disclosed pursuant to[m
[31m-          Section 3.4(a) above, Contributor believes that Contributor's[m
[31m-          Modifications are Contributor's original creation(s) and/or[m
[31m-          Contributor has sufficient rights to grant the rights conveyed by[m
[31m-          this License.[m
[31m-[m
[31m-     3.5. Required Notices.[m
[31m-     You must duplicate the notice in Exhibit A in each file of the Source[m
[31m-     Code.  If it is not possible to put such notice in a particular Source[m
[31m-     Code file due to its structure, then You must include such notice in a[m
[31m-     location (such as a relevant directory) where a user would be likely[m
[31m-     to look for such a notice.  If You created one or more Modification(s)[m
[31m-     You may add your name as a Contributor to the notice described in[m
[31m-     Exhibit A.  You must also duplicate this License in any documentation[m
[31m-     for the Source Code where You describe recipients' rights or ownership[m
[31m-     rights relating to Covered Code.  You may choose to offer, and to[m
[31m-     charge a fee for, warranty, support, indemnity or liability[m
[31m-     obligations to one or more recipients of Covered Code. However, You[m
[31m-     may do so only on Your own behalf, and not on behalf of the Initial[m
[31m-     Developer or any Contributor. You must make it absolutely clear than[m
[31m-     any such warranty, support, indemnity or liability obligation is[m
[31m-     offered by You alone, and You hereby agree to indemnify the Initial[m
[31m-     Developer and every Contributor for any liability incurred by the[m
[31m-     Initial Developer or such Contributor as a result of warranty,[m
[31m-     support, indemnity or liability terms You offer.[m
[31m-[m
[31m-     3.6. Distribution of Executable Versions.[m
[31m-     You may distribute Covered Code in Executable form only if the[m
[31m-     requirements of Section 3.1-3.5 have been met for that Covered Code,[m
[31m-     and if You include a notice stating that the Source Code version of[m
[31m-     the Covered Code is available under the terms of this License,[m
[31m-     including a description of how and where You have fulfilled the[m
[31m-     obligations of Section 3.2. The notice must be conspicuously included[m
[31m-     in any notice in an Executable version, related documentation or[m
[31m-     collateral in which You describe recipients' rights relating to the[m
[31m-     Covered Code. You may distribute the Executable version of Covered[m
[31m-     Code or ownership rights under a license of Your choice, which may[m
[31m-     contain terms different from this License, provided that You are in[m
[31m-     compliance with the terms of this License and that the license for the[m
[31m-     Executable version does not attempt to limit or alter the recipient's[m
[31m-     rights in the Source Code version from the rights set forth in this[m
[31m-     License. If You distribute the Executable version under a different[m
[31m-     license You must make it absolutely clear that any terms which differ[m
[31m-     from this License are offered by You alone, not by the Initial[m
[31m-     Developer or any Contributor. You hereby agree to indemnify the[m
[31m-     Initial Developer and every Contributor for any liability incurred by[m
[31m-     the Initial Developer or such Contributor as a result of any such[m
[31m-     terms You offer.[m
[31m-[m
[31m-     3.7. Larger Works.[m
[31m-     You may create a Larger Work by combining Covered Code with other code[m
[31m-     not governed by the terms of this License and distribute the Larger[m
[31m-     Work as a single product. In such a case, You must make sure the[m
[31m-     requirements of this License are fulfilled for the Covered Code.[m
[31m-[m
[31m-4. Inability to Comply Due to Statute or Regulation.[m
[31m-[m
[31m-     If it is impossible for You to comply with any of the terms of this[m
[31m-     License with respect to some or all of the Covered Code due to[m
[31m-     statute, judicial order, or regulation then You must: (a) comply with[m
[31m-     the terms of this License to the maximum extent possible; and (b)[m
[31m-     describe the limitations and the code they affect. Such description[m
[31m-     must be included in the LEGAL file described in Section 3.4 and must[m
[31m-     be included with all distributions of the Source Code. Except to the[m
[31m-     extent prohibited by statute or regulation, such description must be[m
[31m-     sufficiently detailed for a recipient of ordinary skill to be able to[m
[31m-     understand it.[m
[31m-[m
[31m-5. Application of this License.[m
[31m-[m
[31m-     This License applies to code to which the Initial Developer has[m
[31m-     attached the notice in Exhibit A and to related Covered Code.[m
[31m-[m
[31m-6. Versions of the License.[m
[31m-[m
[31m-     6.1. New Versions.[m
[31m-     Netscape Communications Corporation ("Netscape") may publish revised[m
[31m-     and/or new versions of the License from time to time. Each version[m
[31m-     will be given a distinguishing version number.[m
[31m-[m
[31m-     6.2. Effect of New Versions.[m
[31m-     Once Covered Code has been published under a particular version of the[m
[31m-     License, You may always continue to use it under the terms of that[m
[31m-     version. You may also choose to use such Covered Code under the terms[m
[31m-     of any subsequent version of the License published by Netscape. No one[m
[31m-     other than Netscape has the right to modify the terms applicable to[m
[31m-     Covered Code created under this License.[m
[31m-[m
[31m-     6.3. Derivative Works.[m
[31m-     If You create or use a modified version of this License (which you may[m
[31m-     only do in order to apply it to code which is not already Covered Code[m
[31m-     governed by this License), You must (a) rename Your license so that[m
[31m-     the phrases "Mozilla", "MOZILLAPL", "MOZPL", "Netscape",[m
[31m-     "MPL", "NPL" or any confusingly similar phrase do not appear in your[m
[31m-     license (except to note that your license differs from this License)[m
[31m-     and (b) otherwise make it clear that Your version of the license[m
[31m-     contains terms which differ from the Mozilla Public License and[m
[31m-     Netscape Public License. (Filling in the name of the Initial[m
[31m-     Developer, Original Code or Contributor in the notice described in[m
[31m-     Exhibit A shall not of themselves be deemed to be modifications of[m
[31m-     this License.)[m
[31m-[m
[31m-7. DISCLAIMER OF WARRANTY.[m
[31m-[m
[31m-     COVERED CODE IS PROVIDED UNDER THIS LICENSE ON AN "AS IS" BASIS,[m
[31m-     WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING,[m
[31m-     WITHOUT LIMITATION, WARRANTIES THAT THE COVERED CODE IS FREE OF[m
[31m-     DEFECTS, MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE OR NON-INFRINGING.[m
[31m-     THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE COVERED CODE[m
[31m-     IS WITH YOU. SHOULD ANY COVERED CODE PROVE DEFECTIVE IN ANY RESPECT,[m
[31m-     YOU (NOT THE INITIAL DEVELOPER OR ANY OTHER CONTRIBUTOR) ASSUME THE[m
[31m-     COST OF ANY NECESSARY SERVICING, REPAIR OR CORRECTION. THIS DISCLAIMER[m
[31m-     OF WARRANTY CONSTITUTES AN ESSENTIAL PART OF THIS LICENSE. NO USE OF[m
[31m-     ANY COVERED CODE IS AUTHORIZED HEREUNDER EXCEPT UNDER THIS DISCLAIMER.[m
[31m-[m
[31m-8. TERMINATION.[m
[31m-[m
[31m-     8.1.  This License and the rights granted hereunder will terminate[m
[31m-     automatically if You fail to comply with terms herein and fail to cure[m
[31m-     such breach within 30 days of becoming aware of the breach. All[m
[31m-     sublicenses to the Covered Code which are properly granted shall[m
[31m-     survive any termination of this License. Provisions which, by their[m
[31m-     nature, must remain in effect beyond the termination of this License[m
[31m-     shall survive.[m
[31m-[m
[31m-     8.2.  If You initiate litigation by asserting a patent infringement[m
[31m-     claim (excluding declatory judgment actions) against Initial Developer[m
[31m-     or a Contributor (the Initial Developer or Contributor against whom[m
[31m-     You file such action is referred to as "Participant")  alleging that:[m
[31m-[m
[31m-     (a)  such Participant's Contributor Version directly or indirectly[m
[31m-     infringes any patent, then any and all rights granted by such[m
[31m-     Participant to You under Sections 2.1 and/or 2.2 of this License[m
[31m-     shall, upon 60 days notice from Participant terminate prospectively,[m
[31m-     unless if within 60 days after receipt of notice You either: (i)[m
[31m-     agree in writing to pay Participant a mutually agreeable reasonable[m
[31m-     royalty for Your past and future use of Modifications made by such[m
[31m-     Participant, or (ii) withdraw Your litigation claim with respect to[m
[31m-     the Contributor Version against such Participant.  If within 60 days[m
[31m-     of notice, a reasonable royalty and payment arrangement are not[m
[31m-     mutually agreed upon in writing by the parties or the litigation claim[m
[31m-     is not withdrawn, the rights granted by Participant to You under[m
[31m-     Sections 2.1 and/or 2.2 automatically terminate at the expiration of[m
[31m-     the 60 day notice period specified above.[m
[31m-[m
[31m-     (b)  any software, hardware, or device, other than such Participant's[m
[31m-     Contributor Version, directly or indirectly infringes any patent, then[m
[31m-     any rights granted to You by such Participant under Sections 2.1(b)[m
[31m-     and 2.2(b) are revoked effective as of the date You first made, used,[m
[31m-     sold, distributed, or had made, Modifications made by that[m
[31m-     Participant.[m
[31m-[m
[31m-     8.3.  If You assert a patent infringement claim against Participant[m
[31m-     alleging that such Participant's Contributor Version directly or[m
[31m-     indirectly infringes any patent where such claim is resolved (such as[m
[31m-     by license or settlement) prior to the initiation of patent[m
[31m-     infringement litigation, then the reasonable value of the licenses[m
[31m-     granted by such Participant under Sections 2.1 or 2.2 shall be taken[m
[31m-     into account in determining the amount or value of any payment or[m
[31m-     license.[m
[31m-[m
[31m-     8.4.  In the event of termination under Sections 8.1 or 8.2 above,[m
[31m-     all end user license agreements (excluding distributors and resellers)[m
[31m-     which have been validly granted by You or any distributor hereunder[m
[31m-     prior to termination shall survive termination.[m
[31m-[m
[31m-9. LIMITATION OF LIABILITY.[m
[31m-[m
[31m-     UNDER NO CIRCUMSTANCES AND UNDER NO LEGAL THEORY, WHETHER TORT[m
[31m-     (INCLUDING NEGLIGENCE), CONTRACT, OR OTHERWISE, SHALL YOU, THE INITIAL[m
[31m-     DEVELOPER, ANY OTHER CONTRIBUTOR, OR ANY DISTRIBUTOR OF COVERED CODE,[m
[31m-     OR ANY SUPPLIER OF ANY OF SUCH PARTIES, BE LIABLE TO ANY PERSON FOR[m
[31m-     ANY INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES OF ANY[m
[31m-     CHARACTER INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF GOODWILL,[m
[31m-     WORK STOPPAGE, COMPUTER FAILURE OR MALFUNCTION, OR ANY AND ALL OTHER[m
[31m-     COMMERCIAL DAMAGES OR LOSSES, EVEN IF SUCH PARTY SHALL HAVE BEEN[m
[31m-     INFORMED OF THE POSSIBILITY OF SUCH DAMAGES. THIS LIMITATION OF[m
[31m-     LIABILITY SHALL NOT APPLY TO LIABILITY FOR DEATH OR PERSONAL INJURY[m
[31m-     RESULTING FROM SUCH PARTY'S NEGLIGENCE TO THE EXTENT APPLICABLE LAW[m
[31m-     PROHIBITS SUCH LIMITATION. SOME JURISDICTIONS DO NOT ALLOW THE[m
[31m-     EXCLUSION OR LIMITATION OF INCIDENTAL OR CONSEQUENTIAL DAMAGES, SO[m
[31m-     THIS EXCLUSION AND LIMITATION MAY NOT APPLY TO YOU.[m
[31m-[m
[31m-10. U.S. GOVERNMENT END USERS.[m
[31m-[m
[31m-     The Covered Code is a "commercial item," as that term is defined in[m
[31m-     48 C.F.R. 2.101 (Oct. 1995), consisting of "commercial computer[m
[31m-     software" and "commercial computer software documentation," as such[m
[31m-     terms are used in 48 C.F.R. 12.212 (Sept. 1995). Consistent with 48[m
[31m-     C.F.R. 12.212 and 48 C.F.R. 227.7202-1 through 227.7202-4 (June 1995),[m
[31m-     all U.S. Government End Users acquire Covered Code with only those[m
[31m-     rights set forth herein.[m
[31m-[m
[31m-11. MISCELLANEOUS.[m
[31m-[m
[31m-     This License represents the complete agreement concerning subject[m
[31m-     matter hereof. If any provision of this License is held to be[m
[31m-     unenforceable, such provision shall be reformed only to the extent[m
[31m-     necessary to make it enforceable. This License shall be governed by[m
[31m-     California law provisions (except to the extent applicable law, if[m
[31m-     any, provides otherwise), excluding its conflict-of-law provisions.[m
[31m-     With respect to disputes in which at least one party is a citizen of,[m
[31m-     or an entity chartered or registered to do business in the United[m
[31m-     States of America, any litigation relating to this License shall be[m
[31m-     subject to the jurisdiction of the Federal Courts of the Northern[m
[31m-     District of California, with venue lying in Santa Clara County,[m
[31m-     California, with the losing party responsible for costs, including[m
[31m-     without limitation, court costs and reasonable attorneys' fees and[m
[31m-     expenses. The application of the United Nations Convention on[m
[31m-     Contracts for the International Sale of Goods is expressly excluded.[m
[31m-     Any law or regulation which provides that the language of a contract[m
[31m-     shall be construed against the drafter shall not apply to this[m
[31m-     License.[m
[31m-[m
[31m-12. RESPONSIBILITY FOR CLAIMS.[m
[31m-[m
[31m-     As between Initial Developer and the Contributors, each party is[m
[31m-     responsible for claims and damages arising, directly or indirectly,[m
[31m-     out of its utilization of rights under this License and You agree to[m
[31m-     work with Initial Developer and Contributors to distribute such[m
[31m-     responsibility on an equitable basis. Nothing herein is intended or[m
[31m-     shall be deemed to constitute any admission of liability.[m
[31m-[m
[31m-13. MULTIPLE-LICENSED CODE.[m
[31m-[m
[31m-     Initial Developer may designate portions of the Covered Code as[m
[31m-     "Multiple-Licensed".  "Multiple-Licensed" means that the Initial[m
[31m-     Developer permits you to utilize portions of the Covered Code under[m
[31m-     Your choice of the NPL or the alternative licenses, if any, specified[m
[31m-     by the Initial Developer in the file described in Exhibit A.[m
[31m-[m
[31m-EXHIBIT A -Mozilla Public License.[m
[31m-[m
[31m-     ``The contents of this file are subject to the Mozilla Public License[m
[31m-     Version 1.1 (the "License"); you may not use this file except in[m
[31m-     compliance with the License. You may obtain a copy of the License at[m
[31m-     http://www.mozilla.org/MPL/[m
[31m-[m
[31m-     Software distributed under the License is distributed on an "AS IS"[m
[31m-     basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the[m
[31m-     License for the specific language governing rights and limitations[m
[31m-     under the License.[m
[31m-[m
[31m-     The Original Code is ______________________________________.[m
[31m-[m
[31m-     The Initial Developer of the Original Code is ________________________.[m
[31m-     Portions created by ______________________ are Copyright (C) ______[m
[31m-     _______________________. All Rights Reserved.[m
[31m-[m
[31m-     Contributor(s): ______________________________________.[m
[31m-[m
[31m-     Alternatively, the contents of this file may be used under the terms[m
[31m-     of the _____ license (the  "[___] License"), in which case the[m
[31m-     provisions of [______] License are applicable instead of those[m
[31m-     above.  If you wish to allow use of your version of this file only[m
[31m-     under the terms of the [____] License and not to allow others to use[m
[31m-     your version of this file under the MPL, indicate your decision by[m
[31m-     deleting  the provisions above and replace  them with the notice and[m
[31m-     other provisions required by the [___] License.  If you do not delete[m
[31m-     the provisions above, a recipient may use your version of this file[m
[31m-     under either the MPL or the [___] License."[m
[31m-[m
[31m-     [NOTE: The text of this Exhibit A may differ slightly from the text of[m
[31m-     the notices in the Source Code files of the Original Code. You should[m
[31m-     use the text of this Exhibit A rather than the text found in the[m
[31m-     Original Code Source Code for Your Modifications.][m
[31m-[m
[31m--------------------------------------------------------[m
[31m-[m
[31m-* Tokenizer[m
[31m-/************************************************************************[m
[31m-The zlib/libpng License[m
[31m-[m
[31m-Copyright (c) 2006 Joerg Wiedenmann[m
[31m-[m
[31m-This software is provided 'as-is', without any express or implied warranty.[m
[31m-In no event will the authors be held liable for any damages arising from[m
[31m-the use of this software.[m
[31m-[m
[31m-Permission is granted to anyone to use this software for any purpose,[m
[31m-including commercial applications, and to alter it and redistribute it[m
[31m-freely, subject to the following restrictions:[m
[31m-[m
[31m-1. The origin of this software must not be misrepresented;[m
[31m-  you must not claim that you wrote the original software.[m
[31m-  If you use this software in a product, an acknowledgment[m
[31m-  in the product documentation would be appreciated but is[m
[31m-  not required.[m
[31m-[m
[31m-2. Altered source versions must be plainly marked as such,[m
[31m-  and must not be misrepresented as being the original software.[m
[31m-[m
[31m-3. This notice may not be removed or altered from any source distribution.[m
[31m-[m
[31m-***********************************************************************/[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/index.js b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/index.js[m
[1mdeleted file mode 100755[m
[1mindex e263f07..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/index.js[m
[1m+++ /dev/null[m
[36m@@ -1,213 +0,0 @@[m
[31m-/*[m
[31m-* Copyright 2013-2015 BlackBerry Limited.[m
[31m-*[m
[31m-* Licensed under the Apache License, Version 2.0 (the "License");[m
[31m-* you may not use this file except in compliance with the License.[m
[31m-* You may obtain a copy of the License at[m
[31m-*[m
[31m-* http://www.apache.org/licenses/LICENSE-2.0[m
[31m-*[m
[31m-* Unless required by applicable law or agreed to in writing, software[m
[31m-* distributed under the License is distributed on an "AS IS" BASIS,[m
[31m-* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m-* See the License for the specific language governing permissions and[m
[31m-* limitations under the License.[m
[31m-*/[m
[31m-var barcodescanner,[m
[31m-	resultObjs = {},[m
[31m-	readCallback,[m
[31m-	_utils = require("../../lib/utils"),[m
[31m-	_qr = require('plugin/BarcodeScanner/qrcode.js');[m
[31m-[m
[31m-const SMS_URI_ONE = "smsto:",[m
[31m-	  SMS_URI_TWO = "sms:",[m
[31m-	  EMAIL_URI = "mailto:",[m
[31m-	  PHONE_URI = "tel:+1",[m
[31m-	  SMS_TYPE = "SMS_TYPE",[m
[31m-	  PHONE_TYPE = "PHONE_TYPE",[m
[31m-	  EMAIL_TYPE = "EMAIL_TYPE",[m
[31m-	  TEXT_TYPE = "TEXT_TYPE";[m
[31m-[m
[31m-module.exports = {[m
[31m-[m
[31m-	// methods to start and stop scanning[m
[31m-	scan: function (success, fail, args, env) {[m
[31m-		var result = new PluginResult(args, env);[m
[31m-		resultObjs[result.callbackId] = result;[m
[31m-		readCallback = result.callbackId;[m
[31m-		var views = qnx.webplatform.getWebViews();[m
[31m-		var handle = null;[m
[31m-		var group = null;[m
[31m-		var z = -1;[m
[31m-		for (var i = 0; i < views.length; i++) {[m
[31m-			if (views[i].visible && views[i].zOrder > z){[m
[31m-				z = views[i].zOrder;[m
[31m-				group = views[i].windowGroup;[m
[31m-				handle = views[i].jsScreenWindowHandle;[m
[31m-			}[m
[31m-		}[m
[31m-		if (handle !== null) {[m
[31m-			var values = { group: group, handle: handle };[m
[31m-			barcodescanner.getInstance().startRead(result.callbackId, values);[m
[31m-			result.noResult(true);[m
[31m-		} else {[m
[31m-			result.error("Failed to find window handle", false);[m
[31m-		}[m
[31m-	},[m
[31m-[m
[31m-	/*[m
[31m-	Method for barcode encoding. Returns base 64 image URI [m
[31m-	Currently only creates QRcodes[m
[31m-	*/[m
[31m-	encode: function (success, fail, args, env) {[m
[31m-		[m
[31m-		var result = new PluginResult(args, env);[m
[31m-		values = decodeURIComponent(args[0]);[m
[31m-		values = JSON.parse(values);[m
[31m-		data = values["data"];[m
[31m-		type = values["type"];[m
[31m-	[m
[31m-		if(data == "" || data == undefined){[m
[31m-			result.error("Data to be encoded was not specified", false);[m
[31m-			return;[m
[31m-		}[m
[31m-		if(type == "" || type == undefined){[m
[31m-			type = TEXT_TYPE;[m
[31m-		}[m
[31m-[m
[31m-		if(type == SMS_TYPE){[m
[31m-			var check_one = data.substring(0,6).toLowerCase();[m
[31m-			var check_two = data.substring(0,4).toLowerCase();[m
[31m-			if(!(check_one == SMS_URI_ONE || check_two == SMS_URI_TWO)){[m
[31m-				data = SMS_URI_ONE+data;[m
[31m-			} [m
[31m-		}else if(type == EMAIL_TYPE){[m
[31m-			var check = data.substring(0,7).toLowerCase();[m
[31m-			if(check != EMAIL_URI){[m
[31m-				data = EMAIL_URI+data;[m
[31m-			} [m
[31m-		}else if(type == PHONE_TYPE){[m
[31m-			var check = data.substring(0,4).toLowerCase();[m
[31m-			if(check != PHONE_URI){[m
[31m-				data = PHONE_URI+data;[m
[31m-			} [m
[31m-		}[m
[31m-[m
[31m-		console.log("Type: "+type + " Data: " + data);[m
[31m-[m
[31m-		//Make QRcode using qrcode.js [m
[31m-		var bdiv = document.createElement('div');[m
[31m-		var options = {[m
[31m-	    	text: data,[m
[31m-	   		width: 256,[m
[31m-	    	height: 256,[m
[31m-	    	colorDark : "#000000",[m
[31m-	    	colorLight : "#ffffff",[m
[31m-		};[m
[31m-[m
[31m-		var imageURI = _qr.makeQRcode(bdiv, options);[m
[31m-[m
[31m-		try{[m
[31m-			result.ok(imageURI,false);[m
[31m-		}catch(e){[m
[31m-			result.error("Failed to encode barcode", false);[m
[31m-		}[m
[31m-	}[m
[31m-};[m
[31m-[m
[31m-[m
[31m-JNEXT.BarcodeScanner = function () {[m
[31m-	var self = this,[m
[31m-		hasInstance = false;[m
[31m-[m
[31m-	self.getId = function () {[m
[31m-		return self.m_id;[m
[31m-	};[m
[31m-[m
[31m-	self.init = function () {[m
[31m-		if (!JNEXT.require("libBarcodeScanner")) {[m
[31m-			return false;[m
[31m-		}[m
[31m-[m
[31m-		self.m_id = JNEXT.createObject("libBarcodeScanner.BarcodeScannerJS");[m
[31m-[m
[31m-		if (self.m_id === "") {[m
[31m-			return false;[m
[31m-		}[m
[31m-[m
[31m-		JNEXT.registerEvents(self);[m
[31m-	};[m
[31m-[m
[31m-	// ************************[m
[31m-	// Enter your methods here[m
[31m-	// ************************[m
[31m-[m
[31m-	// Fired by the Event framework (used by asynchronous callbacks)[m
[31m-[m
[31m-	self.onEvent = function (strData) {[m
[31m-		var arData = strData.split(" "),[m
[31m-			callbackId = arData[0],[m
[31m-			receivedEvent = arData[1],[m
[31m-			data = arData[2],[m
[31m-			result = resultObjs[callbackId],[m
[31m-			events = ["community.barcodescanner.codefound.native",[m
[31m-					  "community.barcodescanner.errorfound.native",[m
[31m-					  "community.barcodescanner.started.native",[m
[31m-					  "community.barcodescanner.ended.native"];[m
[31m-			[m
[31m-		// Restructures results when codefound has spaces		  [m
[31m-		if(arData.length > 3){[m
[31m-			var i;[m
[31m-			for(i=3; i<arData.length; i++) {[m
[31m-				data += " " + arData[i];[m
[31m-			}[m
[31m-		}[m
[31m-		[m
[31m-		if (receivedEvent == "community.barcodescanner.codefound.native") {[m
[31m-			if (result) {[m
[31m-				var parsed = JSON.parse(data);[m
[31m-				result.callbackOk(parsed, false);[m
[31m-			}[m
[31m-			this.stopRead(callbackId);[m
[31m-[m
[31m-		}[m
[31m-		if (receivedEvent == "community.barcodescanner.started.native") {[m
[31m-			console.log("Scanning started successfully");[m
[31m-		}[m
[31m-		if (receivedEvent == "community.barcodescanner.errorfound.native") {[m
[31m-			if (result) {[m
[31m-				result.callbackError(data, false);[m
[31m-			}[m
[31m-		}[m
[31m-[m
[31m-		if(receivedEvent == "community.barcodescanner.ended.native" || receivedEvent == "community.barcodescanner.errorfound.native") {[m
[31m-			delete resultObjs[readCallback];[m
[31m-			readCallback = null;[m
[31m-		}[m
[31m-[m
[31m-	};[m
[31m-[m
[31m-	// Thread methods[m
[31m-	self.startRead = function (callbackId, handle) {[m
[31m-		return JNEXT.invoke(self.m_id, "startRead " + callbackId + " " + JSON.stringify(handle));[m
[31m-	};[m
[31m-	self.stopRead = function (callbackId) {[m
[31m-		return JNEXT.invoke(self.m_id, "stopRead " + callbackId);[m
[31m-	};[m
[31m-[m
[31m-	// ************************[m
[31m-	// End of methods to edit[m
[31m-	// ************************[m
[31m-	self.m_id = "";[m
[31m-[m
[31m-	self.getInstance = function () {[m
[31m-		if (!hasInstance) {[m
[31m-			hasInstance = true;[m
[31m-			self.init();[m
[31m-		}[m
[31m-		return self;[m
[31m-	};[m
[31m-[m
[31m-};[m
[31m-[m
[31m-barcodescanner = new JNEXT.BarcodeScanner();[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/.cproject b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/.cproject[m
[1mdeleted file mode 100755[m
[1mindex 5a94b8d..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/.cproject[m
[1m+++ /dev/null[m
[36m@@ -1,220 +0,0 @@[m
[31m-<?xml version="1.0" encoding="UTF-8" standalone="no"?>[m
[31m-<?fileVersion 4.0.0?><cproject storage_type_id="org.eclipse.cdt.core.XmlProjectDescriptionStorage">[m
[31m-	<storageModule moduleId="org.eclipse.cdt.core.settings">[m
[31m-		<cconfiguration id="com.qnx.qcc.configuration.sharedLib.release.608922875.1009704567">[m
[31m-			<storageModule buildSystemId="org.eclipse.cdt.managedbuilder.core.configurationDataProvider" id="com.qnx.qcc.configuration.sharedLib.release.608922875.1009704567" moduleId="org.eclipse.cdt.core.settings" name="device">[m
[31m-				<externalSettings/>[m
[31m-				<extensions>[m
[31m-					<extension id="com.qnx.tools.ide.qde.core.QDELinkerErrorParser" point="org.eclipse.cdt.core.ErrorParser"/>[m
[31m-					<extension id="org.eclipse.cdt.core.GCCErrorParser" point="org.eclipse.cdt.core.ErrorParser"/>[m
[31m-					<extension id="org.eclipse.cdt.core.GLDErrorParser" point="org.eclipse.cdt.core.ErrorParser"/>[m
[31m-					<extension id="com.qnx.tools.ide.qde.core.QDEBynaryParser" point="org.eclipse.cdt.core.BinaryParser"/>[m
[31m-				</extensions>[m
[31m-			</storageModule>[m
[31m-			<storageModule moduleId="cdtBuildSystem" version="4.0.0">[m
[31m-				<configuration artifactExtension="so" artifactName="${ProjName}" buildArtefactType="org.eclipse.cdt.build.core.buildArtefactType.sharedLib" buildProperties="org.eclipse.cdt.build.core.buildType=org.eclipse.cdt.build.core.buildType.release,org.eclipse.cdt.build.core.buildArtefactType=org.eclipse.cdt.build.core.buildArtefactType.sharedLib" description="" errorParsers="com.qnx.tools.ide.qde.core.QDELinkerErrorParser;org.eclipse.cdt.core.GCCErrorParser;org.eclipse.cdt.core.GLDErrorParser" id="com.qnx.qcc.configuration.sharedLib.release.608922875.1009704567" name="device" parent="com.qnx.qcc.configuration.sharedLib.release" postannouncebuildStep="" postbuildStep="" preannouncebuildStep="" prebuildStep="">[m
[31m-					<folderInfo id="com.qnx.qcc.configuration.sharedLib.release.608922875.1009704567." name="/" resourcePath="">[m
[31m-						<toolChain errorParsers="" id="com.qnx.qcc.toolChain.2215983" name="QNX QCC" superClass="com.qnx.qcc.toolChain">[m
[31m-							<option id="com.qnx.qcc.option.cpu.315540759" name="Target CPU:" superClass="com.qnx.qcc.option.cpu" value="com.qnx.qcc.option.gen.cpu.armle-v7" valueType="enumerated"/>[m
[31m-							<targetPlatform archList="all" binaryParser="com.qnx.tools.ide.qde.core.QDEBynaryParser" id="com.qnx.qcc.targetPlatform.1359109141" osList="all" superClass="com.qnx.qcc.targetPlatform"/>[m
[31m-							<builder buildPath="${workspace_loc:/Template/Device-Release}" errorParsers="" id="com.qnx.nto.938326560" keepEnvironmentInBuildfile="false" name="CDT Internal Builder" superClass="com.qnx.nto"/>[m
[31m-							<tool command="qcc" commandLinePattern="${COMMAND}  ${OUTPUT_FLAG} ${OUTPUT_PREFIX}${OUTPUT} ${INPUTS} ${FLAGS}" errorParsers="org.eclipse.cdt.core.GCCErrorParser" id="com.qnx.qcc.tool.compiler.242697771" name="QCC Compiler" superClass="com.qnx.qcc.tool.compiler">[m
[31m-								<option id="com.qnx.qcc.option.compiler.shared.553244928" name="Shared (-shared)" superClass="com.qnx.qcc.option.compiler.shared" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.compiler.optlevel.2070537906" name="Optimization Level" superClass="com.qnx.qcc.option.compiler.optlevel" value="com.qnx.qcc.option.compiler.optlevel.2" valueType="enumerated"/>[m
[31m-								<option id="com.qnx.qcc.option.compiler.includePath.1483355415" name="Include Directories (-I)" superClass="com.qnx.qcc.option.compiler.includePath" valueType="includePath">[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/usr/include/img"/>[m
[31m-									<listOptionValue builtIn="false" value="${workspace_loc:/${ProjName}/public}"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/usr/include/freetype2"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/../target-override/usr/include"/>[m
[31m-								</option>[m
[31m-								<option id="com.qnx.qcc.option.compiler.security.9625963" name="Enhanced Security (-fstack-protector-strong)" superClass="com.qnx.qcc.option.compiler.security" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.compiler.defines.872099896" name="Defines (-D)" superClass="com.qnx.qcc.option.compiler.defines" valueType="definedSymbols">[m
[31m-									<listOptionValue builtIn="false" value="_FORTIFY_SOURCE=2"/>[m
[31m-								</option>[m
[31m-								<option id="com.qnx.qcc.option.compiler.qccoptions.1015003128" name="QCC Options" superClass="com.qnx.qcc.option.compiler.qccoptions" valueType="stringList">[m
[31m-									<listOptionValue builtIn="false" value="-frecord-gcc-switches"/>[m
[31m-								</option>[m
[31m-								<option id="com.qnx.qcc.option.compiler.warningLevel.331428330" name="Warning Level (-w)" superClass="com.qnx.qcc.option.compiler.warningLevel" value="com.qnx.qcc.option.warningLevel.9" valueType="enumerated"/>[m
[31m-								<inputType id="com.qnx.qcc.inputType.compiler.1443568066" superClass="com.qnx.qcc.inputType.compiler"/>[m
[31m-							</tool>[m
[31m-							<tool command="qcc" commandLinePattern="${COMMAND}  ${OUTPUT_FLAG} ${OUTPUT_PREFIX}${OUTPUT} ${INPUTS} ${FLAGS}" errorParsers="" id="com.qnx.qcc.tool.assembler.1996828008" name="QCC Assembler" superClass="com.qnx.qcc.tool.assembler">[m
[31m-								<option id="com.qnx.qcc.option.assembler.warningLevel.1519589523" name="Warning Level (-w)" superClass="com.qnx.qcc.option.assembler.warningLevel" value="com.qnx.qcc.option.warningLevel.9" valueType="enumerated"/>[m
[31m-								<inputType id="com.qnx.qcc.inputType.assembler.116798417" superClass="com.qnx.qcc.inputType.assembler"/>[m
[31m-							</tool>[m
[31m-							<tool command="qcc" commandLinePattern="${COMMAND}  ${OUTPUT_FLAG} ${OUTPUT_PREFIX}${OUTPUT} ${INPUTS} ${FLAGS}" errorParsers="com.qnx.tools.ide.qde.core.QDELinkerErrorParser;org.eclipse.cdt.core.GLDErrorParser" id="com.qnx.qcc.tool.linker.871546588" name="QCC Linker" superClass="com.qnx.qcc.tool.linker">[m
[31m-								<option id="com.qnx.qcc.option.linker.shared.915102752" name="Shared (-shared)" superClass="com.qnx.qcc.option.linker.shared" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.linker.libraryPaths.1049529253" name="Library Paths (-L)" superClass="com.qnx.qcc.option.linker.libraryPaths" valueType="libPaths">[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/../target-override/${CPUVARDIR}/lib"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/../target-override/${CPUVARDIR}/usr/lib"/>[m
[31m-								</option>[m
[31m-								<option id="com.qnx.qcc.option.linker.security.1157664997" name="Enhanced Security (-Wl,-z,relro -Wl,-z,now)" superClass="com.qnx.qcc.option.linker.security" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.linker.libraries.1316432206" name="Libraries (-l)" superClass="com.qnx.qcc.option.linker.libraries" valueType="libs">[m
[31m-									<listOptionValue builtIn="false" value="camapi"/>[m
[31m-									<listOptionValue builtIn="false" value="zxing"/>[m
[31m-									<listOptionValue builtIn="false" value="img"/>[m
[31m-									<listOptionValue builtIn="false" value="slog2"/>[m
[31m-									<listOptionValue builtIn="false" value="bps"/>[m
[31m-									<listOptionValue builtIn="false" value="screen"/>[m
[31m-								</option>[m
[31m-								<option id="com.qnx.qcc.option.linker.warningLevel.2067914469" name="Warning Level (-w)" superClass="com.qnx.qcc.option.linker.warningLevel" value="com.qnx.qcc.option.warningLevel.9" valueType="enumerated"/>[m
[31m-								<inputType id="com.qnx.qcc.inputType.linker.1028572887" superClass="com.qnx.qcc.inputType.linker">[m
[31m-									<additionalInput kind="additionalinputdependency" paths="$(USER_OBJS)"/>[m
[31m-									<additionalInput kind="additionalinput" paths="$(LIBS)"/>[m
[31m-								</inputType>[m
[31m-							</tool>[m
[31m-							<tool id="com.qnx.qcc.tool.archiver.1781914947" name="QCC Archiver" superClass="com.qnx.qcc.tool.archiver"/>[m
[31m-						</toolChain>[m
[31m-					</folderInfo>[m
[31m-					<sourceEntries>[m
[31m-						<entry flags="VALUE_WORKSPACE_PATH|RESOLVED" kind="sourcePath" name="src"/>[m
[31m-						<entry flags="VALUE_WORKSPACE_PATH|RESOLVED" kind="sourcePath" name="public"/>[m
[31m-					</sourceEntries>[m
[31m-				</configuration>[m
[31m-			</storageModule>[m
[31m-			<storageModule moduleId="org.eclipse.cdt.core.externalSettings"/>[m
[31m-		</cconfiguration>[m
[31m-		<cconfiguration id="com.qnx.qcc.configuration.sharedLib.debug.193597202.362186091">[m
[31m-			<storageModule buildSystemId="org.eclipse.cdt.managedbuilder.core.configurationDataProvider" id="com.qnx.qcc.configuration.sharedLib.debug.193597202.362186091" moduleId="org.eclipse.cdt.core.settings" name="simulator">[m
[31m-				<externalSettings/>[m
[31m-				<extensions>[m
[31m-					<extension id="com.qnx.tools.ide.qde.core.QDELinkerErrorParser" point="org.eclipse.cdt.core.ErrorParser"/>[m
[31m-					<extension id="org.eclipse.cdt.core.GCCErrorParser" point="org.eclipse.cdt.core.ErrorParser"/>[m
[31m-					<extension id="org.eclipse.cdt.core.GLDErrorParser" point="org.eclipse.cdt.core.ErrorParser"/>[m
[31m-					<extension id="com.qnx.tools.ide.qde.core.QDEBynaryParser" point="org.eclipse.cdt.core.BinaryParser"/>[m
[31m-				</extensions>[m
[31m-			</storageModule>[m
[31m-			<storageModule moduleId="cdtBuildSystem" version="4.0.0">[m
[31m-				<configuration artifactExtension="so" artifactName="${ProjName}" buildArtefactType="org.eclipse.cdt.build.core.buildArtefactType.sharedLib" buildProperties="org.eclipse.cdt.build.core.buildType=org.eclipse.cdt.build.core.buildType.debug,org.eclipse.cdt.build.core.buildArtefactType=org.eclipse.cdt.build.core.buildArtefactType.sharedLib" description="" id="com.qnx.qcc.configuration.sharedLib.debug.193597202.362186091" name="simulator" parent="com.qnx.qcc.configuration.sharedLib.debug">[m
[31m-					<folderInfo id="com.qnx.qcc.configuration.sharedLib.debug.193597202.362186091." name="/" resourcePath="">[m
[31m-						<toolChain id="com.qnx.qcc.toolChain.688026907" name="QNX QCC" superClass="com.qnx.qcc.toolChain">[m
[31m-							<targetPlatform archList="all" binaryParser="com.qnx.tools.ide.qde.core.QDEBynaryParser" id="com.qnx.qcc.targetPlatform.469207190" osList="all" superClass="com.qnx.qcc.targetPlatform"/>[m
[31m-							<builder buildPath="${workspace_loc:/Template/Simulator-Debug}" id="com.qnx.nto.2029800497" keepEnvironmentInBuildfile="false" name="CDT Internal Builder" superClass="com.qnx.nto"/>[m
[31m-							<tool id="com.qnx.qcc.tool.compiler.1028279123" name="QCC Compiler" superClass="com.qnx.qcc.tool.compiler">[m
[31m-								<option id="com.qnx.qcc.option.compiler.shared.235893159" name="Shared (-shared)" superClass="com.qnx.qcc.option.compiler.shared" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.compiler.optlevel.1164238904" name="Optimization Level" superClass="com.qnx.qcc.option.compiler.optlevel" value="com.qnx.qcc.option.compiler.optlevel.0" valueType="enumerated"/>[m
[31m-								<option id="com.qnx.qcc.option.compile.debug.3716470" name="Debug (-g)" superClass="com.qnx.qcc.option.compile.debug" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.compiler.includePath.306305432" name="Include Directories (-I)" superClass="com.qnx.qcc.option.compiler.includePath" valueType="includePath">[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/usr/include/img"/>[m
[31m-									<listOptionValue builtIn="false" value="${workspace_loc:/${ProjName}/public}"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/usr/include/freetype2"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/../target-override/usr/include"/>[m
[31m-								</option>[m
[31m-								<option id="com.qnx.qcc.option.compiler.security.1730007887" name="Enhanced Security (-fstack-protector-strong)" superClass="com.qnx.qcc.option.compiler.security" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.compiler.defines.1526896965" name="Defines (-D)" superClass="com.qnx.qcc.option.compiler.defines" valueType="definedSymbols">[m
[31m-									<listOptionValue builtIn="false" value="_FORTIFY_SOURCE=2"/>[m
[31m-								</option>[m
[31m-								<inputType id="com.qnx.qcc.inputType.compiler.1881183122" superClass="com.qnx.qcc.inputType.compiler"/>[m
[31m-							</tool>[m
[31m-							<tool id="com.qnx.qcc.tool.assembler.312168125" name="QCC Assembler" superClass="com.qnx.qcc.tool.assembler">[m
[31m-								<option id="com.qnx.qcc.option.assembler.debug.416544277" name="Debug (-g)" superClass="com.qnx.qcc.option.assembler.debug" value="true" valueType="boolean"/>[m
[31m-								<inputType id="com.qnx.qcc.inputType.assembler.1722778407" superClass="com.qnx.qcc.inputType.assembler"/>[m
[31m-							</tool>[m
[31m-							<tool id="com.qnx.qcc.tool.linker.2130364088" name="QCC Linker" superClass="com.qnx.qcc.tool.linker">[m
[31m-								<option id="com.qnx.qcc.option.linker.debug.1332880614" name="Debug (-g)" superClass="com.qnx.qcc.option.linker.debug" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.linker.shared.1633267255" name="Shared (-shared)" superClass="com.qnx.qcc.option.linker.shared" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.linker.libraryPaths.565794953" name="Library Paths (-L)" superClass="com.qnx.qcc.option.linker.libraryPaths" valueType="libPaths">[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/../target-override/${CPUVARDIR}/lib"/>[m
[31m-									<listOptionValue builtIn="false" value="${QNX_TARGET}/../target-override/${CPUVARDIR}/usr/lib"/>[m
[31m-								</option>[m
[31m-								<option id="com.qnx.qcc.option.linker.security.9141791" name="Enhanced Security (-Wl,-z,relro -Wl,-z,now)" superClass="com.qnx.qcc.option.linker.security" value="true" valueType="boolean"/>[m
[31m-								<option id="com.qnx.qcc.option.linker.libraries.220836649" name="Libraries (-l)" superClass="com.qnx.qcc.option.linker.libraries" valueType="libs">[m
[31m-									<listOptionValue builtIn="false" value="zxing"/>[m
[31m-									<listOptionValue builtIn="false" value="camapi"/>[m
[31m-									<listOptionValue builtIn="false" value="img"/>[m
[31m-									<listOptionValue builtIn="false" value="slog2"/>[m
[31m-									<listOptionValue builtIn="false" value="bps"/>[m
[31m-									<listOptionValue builtIn="false" value="screen"/>[m
[31m-								</option>[m
[31m-								<inputType id="com.qnx.qcc.inputType.linker.167117375" superClass="com.qnx.qcc.inputType.linker">[m
[31m-									<additionalInput kind="additionalinputdependency" paths="$(USER_OBJS)"/>[m
[31m-									<additionalInput kind="additionalinput" paths="$(LIBS)"/>[m
[31m-								</inputType>[m
[31m-							</tool>[m
[31m-							<tool id="com.qnx.qcc.tool.archiver.489682882" name="QCC Archiver" superClass="com.qnx.qcc.tool.archiver"/>[m
[31m-						</toolChain>[m
[31m-					</folderInfo>[m
[31m-					<sourceEntries>[m
[31m-						<entry flags="VALUE_WORKSPACE_PATH|RESOLVED" kind="sourcePath" name="src"/>[m
[31m-						<entry flags="VALUE_WORKSPACE_PATH|RESOLVED" kind="sourcePath" name="public"/>[m
[31m-					</sourceEntries>[m
[31m-				</configuration>[m
[31m-			</storageModule>[m
[31m-			<storageModule moduleId="org.eclipse.cdt.core.externalSettings"/>[m
[31m-		</cconfiguration>[m
[31m-	</storageModule>[m
[31m-	<storageModule moduleId="cdtBuildSystem" version="4.0.0">[m
[31m-		<project id="BarcodeScanner.null.629823540" name="BarcodeScanner"/>[m
[31m-	</storageModule>[m
[31m-	<storageModule moduleId="refreshScope" versionNumber="2">[m
[31m-		<configuration configurationName="Simulator-Profile">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/BarcodeScanner"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="Device-Profile">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/BarcodeScanner"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="Simulator-Coverage">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/BarcodeScanner"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="Device-Debug">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/BarcodeScanner"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="simulator"/>[m
[31m-		<configuration configurationName="Simulator-Debug">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/BarcodeScanner"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="device"/>[m
[31m-		<configuration configurationName="Device-Release">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/BarcodeScanner"/>[m
[31m-		</configuration>[m
[31m-		<configuration configurationName="Device-Coverage">[m
[31m-			<resource resourceType="PROJECT" workspacePath="/BarcodeScanner"/>[m
[31m-		</configuration>[m
[31m-	</storageModule>[m
[31m-	<storageModule moduleId="org.eclipse.cdt.core.LanguageSettingsProviders"/>[m
[31m-	<storageModule moduleId="scannerConfiguration">[m
[31m-		<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.coverage.1963950149">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.profile.1521124627">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.profile.1662874485">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.release.1167756743">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.coverage.1920932411">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.release.274485450">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.debug.823677416">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.debug.606841429">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.profile.783070498">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.coverage.89043708">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.profile.815111702">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.debug.1815235065">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.debug.2137677126">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-		<scannerConfigBuildInfo instanceId="com.qnx.qcc.configuration.sharedLib.coverage.1030515335">[m
[31m-			<autodiscovery enabled="true" problemReportingEnabled="true" selectedProfileId="com.qnx.tools.ide.qde.managedbuilder.core.qccScannerInfo"/>[m
[31m-		</scannerConfigBuildInfo>[m
[31m-	</storageModule>[m
[31m-	<storageModule moduleId="org.eclipse.cdt.internal.ui.text.commentOwnerProjectMappings"/>[m
[31m-</cproject>[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/.settings/com.qnx.tools.ide.core.prefs b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/.settings/com.qnx.tools.ide.core.prefs[m
[1mdeleted file mode 100755[m
[1mindex 5227f00..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/.settings/com.qnx.tools.ide.core.prefs[m
[1m+++ /dev/null[m
[36m@@ -1,2 +0,0 @@[m
[31m-QNX_CURRENT_INSTALL=BlackBerry Native SDK 10.2[m
[31m-eclipse.preferences.version=1[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/device/.npmignore b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/device/.npmignore[m
[1mdeleted file mode 100755[m
[1mindex 1209638..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/device/.npmignore[m
[1m+++ /dev/null[m
[36m@@ -1,2 +0,0 @@[m
[31m-/src[m
[31m-/public[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/device/libBarcodeScanner.so b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/device/libBarcodeScanner.so[m
[1mdeleted file mode 100755[m
[1mindex bd8a3af..0000000[m
Binary files a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/device/libBarcodeScanner.so and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/autolink.h b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/autolink.h[m
[1mdeleted file mode 100755[m
[1mindex 37c9258..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/autolink.h[m
[1m+++ /dev/null[m
[36m@@ -1,19 +0,0 @@[m
[31m-#ifndef JSON_AUTOLINK_H_INCLUDED[m
[31m-# define JSON_AUTOLINK_H_INCLUDED[m
[31m-[m
[31m-# include "config.h"[m
[31m-[m
[31m-# ifdef JSON_IN_CPPTL[m
[31m-#  include <cpptl/cpptl_autolink.h>[m
[31m-# endif[m
[31m-[m
[31m-# if !defined(JSON_NO_AUTOLINK)  &&  !defined(JSON_DLL_BUILD)  &&  !defined(JSON_IN_CPPTL)[m
[31m-#  define CPPTL_AUTOLINK_NAME "json"[m
[31m-#  undef CPPTL_AUTOLINK_DLL[m
[31m-#  ifdef JSON_DLL[m
[31m-#   define CPPTL_AUTOLINK_DLL[m
[31m-#  endif[m
[31m-#  include "autolink.h"[m
[31m-# endif[m
[31m-[m
[31m-#endif // JSON_AUTOLINK_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/config.h b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/config.h[m
[1mdeleted file mode 100755[m
[1mindex 5d334cb..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/config.h[m
[1m+++ /dev/null[m
[36m@@ -1,43 +0,0 @@[m
[31m-#ifndef JSON_CONFIG_H_INCLUDED[m
[31m-# define JSON_CONFIG_H_INCLUDED[m
[31m-[m
[31m-/// If defined, indicates that json library is embedded in CppTL library.[m
[31m-//# define JSON_IN_CPPTL 1[m
[31m-[m
[31m-/// If defined, indicates that json may leverage CppTL library[m
[31m-//#  define JSON_USE_CPPTL 1[m
[31m-/// If defined, indicates that cpptl vector based map should be used instead of std::map[m
[31m-/// as Value container.[m
[31m-//#  define JSON_USE_CPPTL_SMALLMAP 1[m
[31m-/// If defined, indicates that Json specific container should be used[m
[31m-/// (hash table & simple deque container with customizable allocator).[m
[31m-/// THIS FEATURE IS STILL EXPERIMENTAL![m
[31m-//#  define JSON_VALUE_USE_INTERNAL_MAP 1[m
[31m-/// Force usage of standard new/malloc based allocator instead of memory pool based allocator.[m
[31m-/// The memory pools allocator used optimization (initializing Value and ValueInternalLink[m
[31m-/// as if it was a POD) that may cause some validation tool to report errors.[m
[31m-/// Only has effects if JSON_VALUE_USE_INTERNAL_MAP is defined.[m
[31m-//#  define JSON_USE_SIMPLE_INTERNAL_ALLOCATOR 1[m
[31m-[m
[31m-/// If defined, indicates that Json use exception to report invalid type manipulation[m
[31m-/// instead of C assert macro.[m
[31m-# define JSON_USE_EXCEPTION 1[m
[31m-[m
[31m-# ifdef JSON_IN_CPPTL[m
[31m-#  include <cpptl/config.h>[m
[31m-#  ifndef JSON_USE_CPPTL[m
[31m-#   define JSON_USE_CPPTL 1[m
[31m-#  endif[m
[31m-# endif[m
[31m-[m
[31m-# ifdef JSON_IN_CPPTL[m
[31m-#  define JSON_API CPPTL_API[m
[31m-# elif defined(JSON_DLL_BUILD)[m
[31m-#  define JSON_API __declspec(dllexport)[m
[31m-# elif defined(JSON_DLL)[m
[31m-#  define JSON_API __declspec(dllimport)[m
[31m-# else[m
[31m-#  define JSON_API[m
[31m-# endif[m
[31m-[m
[31m-#endif // JSON_CONFIG_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/features.h b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/features.h[m
[1mdeleted file mode 100755[m
[1mindex 5a9adec..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/features.h[m
[1m+++ /dev/null[m
[36m@@ -1,42 +0,0 @@[m
[31m-#ifndef CPPTL_JSON_FEATURES_H_INCLUDED[m
[31m-# define CPPTL_JSON_FEATURES_H_INCLUDED[m
[31m-[m
[31m-# include "forwards.h"[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-   /** \brief Configuration passed to reader and writer.[m
[31m-    * This configuration object can be used to force the Reader or Writer[m
[31m-    * to behave in a standard conforming way.[m
[31m-    */[m
[31m-   class JSON_API Features[m
[31m-   {[m
[31m-   public:[m
[31m-      /** \brief A configuration that allows all features and assumes all strings are UTF-8.[m
[31m-       * - C & C++ comments are allowed[m
[31m-       * - Root object can be any JSON value[m
[31m-       * - Assumes Value strings are encoded in UTF-8[m
[31m-       */[m
[31m-      static Features all();[m
[31m-[m
[31m-      /** \brief A configuration that is strictly compatible with the JSON specification.[m
[31m-       * - Comments are forbidden.[m
[31m-       * - Root object must be either an array or an object value.[m
[31m-       * - Assumes Value strings are encoded in UTF-8[m
[31m-       */[m
[31m-      static Features strictMode();[m
[31m-[m
[31m-      /** \brief Initialize the configuration like JsonConfig::allFeatures;[m
[31m-       */[m
[31m-      Features();[m
[31m-[m
[31m-      /// \c true if comments are allowed. Default: \c true.[m
[31m-      bool allowComments_;[m
[31m-[m
[31m-      /// \c true if root must be either an array or an object value. Default: \c false.[m
[31m-      bool strictRoot_;[m
[31m-   };[m
[31m-[m
[31m-} // namespace Json[m
[31m-[m
[31m-#endif // CPPTL_JSON_FEATURES_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/forwards.h b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/forwards.h[m
[1mdeleted file mode 100755[m
[1mindex d0ce830..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/forwards.h[m
[1m+++ /dev/null[m
[36m@@ -1,39 +0,0 @@[m
[31m-#ifndef JSON_FORWARDS_H_INCLUDED[m
[31m-# define JSON_FORWARDS_H_INCLUDED[m
[31m-[m
[31m-# include "config.h"[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-   // writer.h[m
[31m-   class FastWriter;[m
[31m-   class StyledWriter;[m
[31m-[m
[31m-   // reader.h[m
[31m-   class Reader;[m
[31m-[m
[31m-   // features.h[m
[31m-   class Features;[m
[31m-[m
[31m-   // value.h[m
[31m-   typedef int Int;[m
[31m-   typedef unsigned int UInt;[m
[31m-   class StaticString;[m
[31m-   class Path;[m
[31m-   class PathArgument;[m
[31m-   class Value;[m
[31m-   class ValueIteratorBase;[m
[31m-   class ValueIterator;[m
[31m-   class ValueConstIterator;[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   class ValueAllocator;[m
[31m-   class ValueMapAllocator;[m
[31m-   class ValueInternalLink;[m
[31m-   class ValueInternalArray;[m
[31m-   class ValueInternalMap;[m
[31m-#endif // #ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-[m
[31m-} // namespace Json[m
[31m-[m
[31m-[m
[31m-#endif // JSON_FORWARDS_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/json.h b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/json.h[m
[1mdeleted file mode 100755[m
[1mindex c71ed65..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/json.h[m
[1m+++ /dev/null[m
[36m@@ -1,10 +0,0 @@[m
[31m-#ifndef JSON_JSON_H_INCLUDED[m
[31m-# define JSON_JSON_H_INCLUDED[m
[31m-[m
[31m-# include "autolink.h"[m
[31m-# include "value.h"[m
[31m-# include "reader.h"[m
[31m-# include "writer.h"[m
[31m-# include "features.h"[m
[31m-[m
[31m-#endif // JSON_JSON_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/reader.h b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/reader.h[m
[1mdeleted file mode 100755[m
[1mindex ee1d6a2..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/reader.h[m
[1m+++ /dev/null[m
[36m@@ -1,196 +0,0 @@[m
[31m-#ifndef CPPTL_JSON_READER_H_INCLUDED[m
[31m-# define CPPTL_JSON_READER_H_INCLUDED[m
[31m-[m
[31m-# include "features.h"[m
[31m-# include "value.h"[m
[31m-# include <deque>[m
[31m-# include <stack>[m
[31m-# include <string>[m
[31m-# include <iostream>[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-   /** \brief Unserialize a <a HREF="http://www.json.org">JSON</a> document into a Value.[m
[31m-    *[m
[31m-    */[m
[31m-   class JSON_API Reader[m
[31m-   {[m
[31m-   public:[m
[31m-      typedef char Char;[m
[31m-      typedef const Char *Location;[m
[31m-[m
[31m-      /** \brief Constructs a Reader allowing all features[m
[31m-       * for parsing.[m
[31m-       */[m
[31m-      Reader();[m
[31m-[m
[31m-      /** \brief Constructs a Reader allowing the specified feature set[m
[31m-       * for parsing.[m
[31m-       */[m
[31m-      Reader( const Features &features );[m
[31m-[m
[31m-      /** \brief Read a Value from a <a HREF="http://www.json.org">JSON</a> document.[m
[31m-       * \param document UTF-8 encoded string containing the document to read.[m
[31m-       * \param root [out] Contains the root value of the document if it was[m
[31m-       *             successfully parsed.[m
[31m-       * \param collectComments \c true to collect comment and allow writing them back during[m
[31m-       *                        serialization, \c false to discard comments.[m
[31m-       *                        This parameter is ignored if Features::allowComments_[m
[31m-       *                        is \c false.[m
[31m-       * \return \c true if the document was successfully parsed, \c false if an error occurred.[m
[31m-       */[m
[31m-      bool parse( const std::string &document, [m
[31m-                  Value &root,[m
[31m-                  bool collectComments = true );[m
[31m-[m
[31m-      /** \brief Read a Value from a <a HREF="http://www.json.org">JSON</a> document.[m
[31m-       * \param document UTF-8 encoded string containing the document to read.[m
[31m-       * \param root [out] Contains the root value of the document if it was[m
[31m-       *             successfully parsed.[m
[31m-       * \param collectComments \c true to collect comment and allow writing them back during[m
[31m-       *                        serialization, \c false to discard comments.[m
[31m-       *                        This parameter is ignored if Features::allowComments_[m
[31m-       *                        is \c false.[m
[31m-       * \return \c true if the document was successfully parsed, \c false if an error occurred.[m
[31m-       */[m
[31m-      bool parse( const char *beginDoc, const char *endDoc, [m
[31m-                  Value &root,[m
[31m-                  bool collectComments = true );[m
[31m-[m
[31m-      /// \brief Parse from input stream.[m
[31m-      /// \see Json::operator>>(std::istream&, Json::Value&).[m
[31m-      bool parse( std::istream &is,[m
[31m-                  Value &root,[m
[31m-                  bool collectComments = true );[m
[31m-[m
[31m-      /** \brief Returns a user friendly string that list errors in the parsed document.[m
[31m-       * \return Formatted error message with the list of errors with their location in [m
[31m-       *         the parsed document. An empty string is returned if no error occurred[m
[31m-       *         during parsing.[m
[31m-       */[m
[31m-      std::string getFormatedErrorMessages() const;[m
[31m-[m
[31m-   private:[m
[31m-      enum TokenType[m
[31m-      {[m
[31m-         tokenEndOfStream = 0,[m
[31m-         tokenObjectBegin,[m
[31m-         tokenObjectEnd,[m
[31m-         tokenArrayBegin,[m
[31m-         tokenArrayEnd,[m
[31m-         tokenString,[m
[31m-         tokenNumber,[m
[31m-         tokenTrue,[m
[31m-         tokenFalse,[m
[31m-         tokenNull,[m
[31m-         tokenArraySeparator,[m
[31m-         tokenMemberSeparator,[m
[31m-         tokenComment,[m
[31m-         tokenError[m
[31m-      };[m
[31m-[m
[31m-      class Token[m
[31m-      {[m
[31m-      public:[m
[31m-         TokenType type_;[m
[31m-         Location start_;[m
[31m-         Location end_;[m
[31m-      };[m
[31m-[m
[31m-      class ErrorInfo[m
[31m-      {[m
[31m-      public:[m
[31m-         Token token_;[m
[31m-         std::string message_;[m
[31m-         Location extra_;[m
[31m-      };[m
[31m-[m
[31m-      typedef std::deque<ErrorInfo> Errors;[m
[31m-[m
[31m-      bool expectToken( TokenType type, Token &token, const char *message );[m
[31m-      bool readToken( Token &token );[m
[31m-      void skipSpaces();[m
[31m-      bool match( Location pattern, [m
[31m-                  int patternLength );[m
[31m-      bool readComment();[m
[31m-      bool readCStyleComment();[m
[31m-      bool readCppStyleComment();[m
[31m-      bool readString();[m
[31m-      void readNumber();[m
[31m-      bool readValue();[m
[31m-      bool readObject( Token &token );[m
[31m-      bool readArray( Token &token );[m
[31m-      bool decodeNumber( Token &token );[m
[31m-      bool decodeString( Token &token );[m
[31m-      bool decodeString( Token &token, std::string &decoded );[m
[31m-      bool decodeDouble( Token &token );[m
[31m-      bool decodeUnicodeCodePoint( Token &token, [m
[31m-                                   Location &current, [m
[31m-                                   Location end, [m
[31m-                                   unsigned int &unicode );[m
[31m-      bool decodeUnicodeEscapeSequence( Token &token, [m
[31m-                                        Location &current, [m
[31m-                                        Location end, [m
[31m-                                        unsigned int &unicode );[m
[31m-      bool addError( const std::string &message, [m
[31m-                     Token &token,[m
[31m-                     Location extra = 0 );[m
[31m-      bool recoverFromError( TokenType skipUntilToken );[m
[31m-      bool addErrorAndRecover( const std::string &message, [m
[31m-                               Token &token,[m
[31m-                               TokenType skipUntilToken );[m
[31m-      void skipUntilSpace();[m
[31m-      Value &currentValue();[m
[31m-      Char getNextChar();[m
[31m-      void getLocationLineAndColumn( Location location,[m
[31m-                                     int &line,[m
[31m-                                     int &column ) const;[m
[31m-      std::string getLocationLineAndColumn( Location location ) const;[m
[31m-      void addComment( Location begin, [m
[31m-                       Location end, [m
[31m-                       CommentPlacement placement );[m
[31m-      void skipCommentTokens( Token &token );[m
[31m-   [m
[31m-      typedef std::stack<Value *> Nodes;[m
[31m-      Nodes nodes_;[m
[31m-      Errors errors_;[m
[31m-      std::string document_;[m
[31m-      Location begin_;[m
[31m-      Location end_;[m
[31m-      Location current_;[m
[31m-      Location lastValueEnd_;[m
[31m-      Value *lastValue_;[m
[31m-      std::string commentsBefore_;[m
[31m-      Features features_;[m
[31m-      bool collectComments_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Read from 'sin' into 'root'.[m
[31m-[m
[31m-    Always keep comments from the input JSON.[m
[31m-[m
[31m-    This can be used to read a file into a particular sub-object.[m
[31m-    For example:[m
[31m-    \code[m
[31m-    Json::Value root;[m
[31m-    cin >> root["dir"]["file"];[m
[31m-    cout << root;[m
[31m-    \endcode[m
[31m-    Result:[m
[31m-    \verbatim[m
[31m-    {[m
[31m-	"dir": {[m
[31m-	    "file": {[m
[31m-		// The input stream JSON would be nested here.[m
[31m-	    }[m
[31m-	}[m
[31m-    }[m
[31m-    \endverbatim[m
[31m-    \throw std::exception on parse error.[m
[31m-    \see Json::operator<<()[m
[31m-   */[m
[31m-   std::istream& operator>>( std::istream&, Value& );[m
[31m-[m
[31m-} // namespace Json[m
[31m-[m
[31m-#endif // CPPTL_JSON_READER_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/value.h b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/value.h[m
[1mdeleted file mode 100755[m
[1mindex 58bfd88..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/value.h[m
[1m+++ /dev/null[m
[36m@@ -1,1069 +0,0 @@[m
[31m-#ifndef CPPTL_JSON_H_INCLUDED[m
[31m-# define CPPTL_JSON_H_INCLUDED[m
[31m-[m
[31m-# include "forwards.h"[m
[31m-# include <string>[m
[31m-# include <vector>[m
[31m-[m
[31m-# ifndef JSON_USE_CPPTL_SMALLMAP[m
[31m-#  include <map>[m
[31m-# else[m
[31m-#  include <cpptl/smallmap.h>[m
[31m-# endif[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-#  include <cpptl/forwards.h>[m
[31m-# endif[m
[31m-[m
[31m-/** \brief JSON (JavaScript Object Notation).[m
[31m- */[m
[31m-namespace Json {[m
[31m-[m
[31m-   /** \brief Type of the value held by a Value object.[m
[31m-    */[m
[31m-   enum ValueType[m
[31m-   {[m
[31m-      nullValue = 0, ///< 'null' value[m
[31m-      intValue,      ///< signed integer value[m
[31m-      uintValue,     ///< unsigned integer value[m
[31m-      realValue,     ///< double value[m
[31m-      stringValue,   ///< UTF-8 string value[m
[31m-      booleanValue,  ///< bool value[m
[31m-      arrayValue,    ///< array value (ordered list)[m
[31m-      objectValue    ///< object value (collection of name/value pairs).[m
[31m-   };[m
[31m-[m
[31m-   enum CommentPlacement[m
[31m-   {[m
[31m-      commentBefore = 0,        ///< a comment placed on the line before a value[m
[31m-      commentAfterOnSameLine,   ///< a comment just after a value on the same line[m
[31m-      commentAfter,             ///< a comment on the line after a value (only make sense for root value)[m
[31m-      numberOfCommentPlacement[m
[31m-   };[m
[31m-[m
[31m-//# ifdef JSON_USE_CPPTL[m
[31m-//   typedef CppTL::AnyEnumerator<const char *> EnumMemberNames;[m
[31m-//   typedef CppTL::AnyEnumerator<const Value &> EnumValues;[m
[31m-//# endif[m
[31m-[m
[31m-   /** \brief Lightweight wrapper to tag static string.[m
[31m-    *[m
[31m-    * Value constructor and objectValue member assignement takes advantage of the[m
[31m-    * StaticString and avoid the cost of string duplication when storing the[m
[31m-    * string or the member name.[m
[31m-    *[m
[31m-    * Example of usage:[m
[31m-    * \code[m
[31m-    * Json::Value aValue( StaticString("some text") );[m
[31m-    * Json::Value object;[m
[31m-    * static const StaticString code("code");[m
[31m-    * object[code] = 1234;[m
[31m-    * \endcode[m
[31m-    */[m
[31m-   class JSON_API StaticString[m
[31m-   {[m
[31m-   public:[m
[31m-      explicit StaticString( const char *czstring )[m
[31m-         : str_( czstring )[m
[31m-      {[m
[31m-      }[m
[31m-[m
[31m-      operator const char *() const[m
[31m-      {[m
[31m-         return str_;[m
[31m-      }[m
[31m-[m
[31m-      const char *c_str() const[m
[31m-      {[m
[31m-         return str_;[m
[31m-      }[m
[31m-[m
[31m-   private:[m
[31m-      const char *str_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Represents a <a HREF="http://www.json.org">JSON</a> value.[m
[31m-    *[m
[31m-    * This class is a discriminated union wrapper that can represents a:[m
[31m-    * - signed integer [range: Value::minInt - Value::maxInt][m
[31m-    * - unsigned integer (range: 0 - Value::maxUInt)[m
[31m-    * - double[m
[31m-    * - UTF-8 string[m
[31m-    * - boolean[m
[31m-    * - 'null'[m
[31m-    * - an ordered list of Value[m
[31m-    * - collection of name/value pairs (javascript object)[m
[31m-    *[m
[31m-    * The type of the held value is represented by a #ValueType and [m
[31m-    * can be obtained using type().[m
[31m-    *[m
[31m-    * values of an #objectValue or #arrayValue can be accessed using operator[]() methods. [m
[31m-    * Non const methods will automatically create the a #nullValue element [m
[31m-    * if it does not exist. [m
[31m-    * The sequence of an #arrayValue will be automatically resize and initialized [m
[31m-    * with #nullValue. resize() can be used to enlarge or truncate an #arrayValue.[m
[31m-    *[m
[31m-    * The get() methods can be used to obtanis default value in the case the required element[m
[31m-    * does not exist.[m
[31m-    *[m
[31m-    * It is possible to iterate over the list of a #objectValue values using [m
[31m-    * the getMemberNames() method.[m
[31m-    */[m
[31m-   class JSON_API Value [m
[31m-   {[m
[31m-      friend class ValueIteratorBase;[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      friend class ValueInternalLink;[m
[31m-      friend class ValueInternalMap;[m
[31m-# endif[m
[31m-   public:[m
[31m-      typedef std::vector<std::string> Members;[m
[31m-      typedef ValueIterator iterator;[m
[31m-      typedef ValueConstIterator const_iterator;[m
[31m-      typedef Json::UInt UInt;[m
[31m-      typedef Json::Int Int;[m
[31m-      typedef UInt ArrayIndex;[m
[31m-[m
[31m-      static const Value null;[m
[31m-      static const Int minInt;[m
[31m-      static const Int maxInt;[m
[31m-      static const UInt maxUInt;[m
[31m-[m
[31m-   private:[m
[31m-#ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-# ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      class CZString [m
[31m-      {[m
[31m-      public:[m
[31m-         enum DuplicationPolicy [m
[31m-         {[m
[31m-            noDuplication = 0,[m
[31m-            duplicate,[m
[31m-            duplicateOnCopy[m
[31m-         };[m
[31m-         CZString( int index );[m
[31m-         CZString( const char *cstr, DuplicationPolicy allocate );[m
[31m-         CZString( const CZString &other );[m
[31m-         ~CZString();[m
[31m-         CZString &operator =( const CZString &other );[m
[31m-         bool operator<( const CZString &other ) const;[m
[31m-         bool operator==( const CZString &other ) const;[m
[31m-         int index() const;[m
[31m-         const char *c_str() const;[m
[31m-         bool isStaticString() const;[m
[31m-      private:[m
[31m-         void swap( CZString &other );[m
[31m-         const char *cstr_;[m
[31m-         int index_;[m
[31m-      };[m
[31m-[m
[31m-   public:[m
[31m-#  ifndef JSON_USE_CPPTL_SMALLMAP[m
[31m-      typedef std::map<CZString, Value> ObjectValues;[m
[31m-#  else[m
[31m-      typedef CppTL::SmallMap<CZString, Value> ObjectValues;[m
[31m-#  endif // ifndef JSON_USE_CPPTL_SMALLMAP[m
[31m-# endif // ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-#endif // ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-[m
[31m-   public:[m
[31m-      /** \brief Create a default Value of the given type.[m
[31m-[m
[31m-        This is a very useful constructor.[m
[31m-        To create an empty array, pass arrayValue.[m
[31m-        To create an empty object, pass objectValue.[m
[31m-        Another Value can then be set to this one by assignment.[m
[31m-	This is useful since clear() and resize() will not alter types.[m
[31m-[m
[31m-        Examples:[m
[31m-	\code[m
[31m-	Json::Value null_value; // null[m
[31m-	Json::Value arr_value(Json::arrayValue); // [][m
[31m-	Json::Value obj_value(Json::objectValue); // {}[m
[31m-	\endcode[m
[31m-      */[m
[31m-      Value( ValueType type = nullValue );[m
[31m-      Value( Int value );[m
[31m-      Value( UInt value );[m
[31m-      Value( double value );[m
[31m-      Value( const char *value );[m
[31m-      Value( const char *beginValue, const char *endValue );[m
[31m-      /** \brief Constructs a value from a static string.[m
[31m-[m
[31m-       * Like other value string constructor but do not duplicate the string for[m
[31m-       * internal storage. The given string must remain alive after the call to this[m
[31m-       * constructor.[m
[31m-       * Example of usage:[m
[31m-       * \code[m
[31m-       * Json::Value aValue( StaticString("some text") );[m
[31m-       * \endcode[m
[31m-       */[m
[31m-      Value( const StaticString &value );[m
[31m-      Value( const std::string &value );[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-      Value( const CppTL::ConstString &value );[m
[31m-# endif[m
[31m-      Value( bool value );[m
[31m-      Value( const Value &other );[m
[31m-      ~Value();[m
[31m-[m
[31m-      Value &operator=( const Value &other );[m
[31m-      /// Swap values.[m
[31m-      /// \note Currently, comments are intentionally not swapped, for[m
[31m-      /// both logic and efficiency.[m
[31m-      void swap( Value &other );[m
[31m-[m
[31m-      ValueType type() const;[m
[31m-[m
[31m-      bool operator <( const Value &other ) const;[m
[31m-      bool operator <=( const Value &other ) const;[m
[31m-      bool operator >=( const Value &other ) const;[m
[31m-      bool operator >( const Value &other ) const;[m
[31m-[m
[31m-      bool operator ==( const Value &other ) const;[m
[31m-      bool operator !=( const Value &other ) const;[m
[31m-[m
[31m-      int compare( const Value &other );[m
[31m-[m
[31m-      const char *asCString() const;[m
[31m-      std::string asString() const;[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-      CppTL::ConstString asConstString() const;[m
[31m-# endif[m
[31m-      Int asInt() const;[m
[31m-      UInt asUInt() const;[m
[31m-      double asDouble() const;[m
[31m-      bool asBool() const;[m
[31m-[m
[31m-      bool isNull() const;[m
[31m-      bool isBool() const;[m
[31m-      bool isInt() const;[m
[31m-      bool isUInt() const;[m
[31m-      bool isIntegral() const;[m
[31m-      bool isDouble() const;[m
[31m-      bool isNumeric() const;[m
[31m-      bool isString() const;[m
[31m-      bool isArray() const;[m
[31m-      bool isObject() const;[m
[31m-[m
[31m-      bool isConvertibleTo( ValueType other ) const;[m
[31m-[m
[31m-      /// Number of values in array or object[m
[31m-      UInt size() const;[m
[31m-[m
[31m-      /// \brief Return true if empty array, empty object, or null;[m
[31m-      /// otherwise, false.[m
[31m-      bool empty() const;[m
[31m-[m
[31m-      /// Return isNull()[m
[31m-      bool operator!() const;[m
[31m-[m
[31m-      /// Remove all object members and array elements.[m
[31m-      /// \pre type() is arrayValue, objectValue, or nullValue[m
[31m-      /// \post type() is unchanged[m
[31m-      void clear();[m
[31m-[m
[31m-      /// Resize the array to size elements. [m
[31m-      /// New elements are initialized to null.[m
[31m-      /// May only be called on nullValue or arrayValue.[m
[31m-      /// \pre type() is arrayValue or nullValue[m
[31m-      /// \post type() is arrayValue[m
[31m-      void resize( UInt size );[m
[31m-[m
[31m-      /// Access an array element (zero based index ).[m
[31m-      /// If the array contains less than index element, then null value are inserted[m
[31m-      /// in the array so that its size is index+1.[m
[31m-      /// (You may need to say 'value[0u]' to get your compiler to distinguish[m
[31m-      ///  this from the operator[] which takes a string.)[m
[31m-      Value &operator[]( UInt index );[m
[31m-      /// Access an array element (zero based index )[m
[31m-      /// (You may need to say 'value[0u]' to get your compiler to distinguish[m
[31m-      ///  this from the operator[] which takes a string.)[m
[31m-      const Value &operator[]( UInt index ) const;[m
[31m-      /// If the array contains at least index+1 elements, returns the element value, [m
[31m-      /// otherwise returns defaultValue.[m
[31m-      Value get( UInt index, [m
[31m-                 const Value &defaultValue ) const;[m
[31m-      /// Return true if index < size().[m
[31m-      bool isValidIndex( UInt index ) const;[m
[31m-      /// \brief Append value to array at the end.[m
[31m-      ///[m
[31m-      /// Equivalent to jsonvalue[jsonvalue.size()] = value;[m
[31m-      Value &append( const Value &value );[m
[31m-[m
[31m-      /// Access an object value by name, create a null member if it does not exist.[m
[31m-      Value &operator[]( const char *key );[m
[31m-      /// Access an object value by name, returns null if there is no member with that name.[m
[31m-      const Value &operator[]( const char *key ) const;[m
[31m-      /// Access an object value by name, create a null member if it does not exist.[m
[31m-      Value &operator[]( const std::string &key );[m
[31m-      /// Access an object value by name, returns null if there is no member with that name.[m
[31m-      const Value &operator[]( const std::string &key ) const;[m
[31m-      /** \brief Access an object value by name, create a null member if it does not exist.[m
[31m-[m
[31m-       * If the object as no entry for that name, then the member name used to store[m
[31m-       * the new entry is not duplicated.[m
[31m-       * Example of use:[m
[31m-       * \code[m
[31m-       * Json::Value object;[m
[31m-       * static const StaticString code("code");[m
[31m-       * object[code] = 1234;[m
[31m-       * \endcode[m
[31m-       */[m
[31m-      Value &operator[]( const StaticString &key );[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-      /// Access an object value by name, create a null member if it does not exist.[m
[31m-      Value &operator[]( const CppTL::ConstString &key );[m
[31m-      /// Access an object value by name, returns null if there is no member with that name.[m
[31m-      const Value &operator[]( const CppTL::ConstString &key ) const;[m
[31m-# endif[m
[31m-      /// Return the member named key if it exist, defaultValue otherwise.[m
[31m-      Value get( const char *key, [m
[31m-                 const Value &defaultValue ) const;[m
[31m-      /// Return the member named key if it exist, defaultValue otherwise.[m
[31m-      Value get( const std::string &key,[m
[31m-                 const Value &defaultValue ) const;[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-      /// Return the member named key if it exist, defaultValue otherwise.[m
[31m-      Value get( const CppTL::ConstString &key,[m
[31m-                 const Value &defaultValue ) const;[m
[31m-# endif[m
[31m-      /// \brief Remove and return the named member.  [m
[31m-      ///[m
[31m-      /// Do nothing if it did not exist.[m
[31m-      /// \return the removed Value, or null.[m
[31m-      /// \pre type() is objectValue or nullValue[m
[31m-      /// \post type() is unchanged[m
[31m-      Value removeMember( const char* key );[m
[31m-      /// Same as removeMember(const char*)[m
[31m-      Value removeMember( const std::string &key );[m
[31m-[m
[31m-      /// Return true if the object has a member named key.[m
[31m-      bool isMember( const char *key ) const;[m
[31m-      /// Return true if the object has a member named key.[m
[31m-      bool isMember( const std::string &key ) const;[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-      /// Return true if the object has a member named key.[m
[31m-      bool isMember( const CppTL::ConstString &key ) const;[m
[31m-# endif[m
[31m-[m
[31m-      /// \brief Return a list of the member names.[m
[31m-      ///[m
[31m-      /// If null, return an empty list.[m
[31m-      /// \pre type() is objectValue or nullValue[m
[31m-      /// \post if type() was nullValue, it remains nullValue[m
[31m-      Members getMemberNames() const;[m
[31m-[m
[31m-//# ifdef JSON_USE_CPPTL[m
[31m-//      EnumMemberNames enumMemberNames() const;[m
[31m-//      EnumValues enumValues() const;[m
[31m-//# endif[m
[31m-[m
[31m-      /// Comments must be //... or /* ... */[m
[31m-      void setComment( const char *comment,[m
[31m-                       CommentPlacement placement );[m
[31m-      /// Comments must be //... or /* ... */[m
[31m-      void setComment( const std::string &comment,[m
[31m-                       CommentPlacement placement );[m
[31m-      bool hasComment( CommentPlacement placement ) const;[m
[31m-      /// Include delimiters and embedded newlines.[m
[31m-      std::string getComment( CommentPlacement placement ) const;[m
[31m-[m
[31m-      std::string toStyledString() const;[m
[31m-[m
[31m-      const_iterator begin() const;[m
[31m-      const_iterator end() const;[m
[31m-[m
[31m-      iterator begin();[m
[31m-      iterator end();[m
[31m-[m
[31m-   private:[m
[31m-      Value &resolveReference( const char *key, [m
[31m-                               bool isStatic );[m
[31m-[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      inline bool isItemAvailable() const[m
[31m-      {[m
[31m-         return itemIsUsed_ == 0;[m
[31m-      }[m
[31m-[m
[31m-      inline void setItemUsed( bool isUsed = true )[m
[31m-      {[m
[31m-         itemIsUsed_ = isUsed ? 1 : 0;[m
[31m-      }[m
[31m-[m
[31m-      inline bool isMemberNameStatic() const[m
[31m-      {[m
[31m-         return memberNameIsStatic_ == 0;[m
[31m-      }[m
[31m-[m
[31m-      inline void setMemberNameIsStatic( bool isStatic )[m
[31m-      {[m
[31m-         memberNameIsStatic_ = isStatic ? 1 : 0;[m
[31m-      }[m
[31m-# endif // # ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-[m
[31m-   private:[m
[31m-      struct CommentInfo[m
[31m-      {[m
[31m-         CommentInfo();[m
[31m-         ~CommentInfo();[m
[31m-[m
[31m-         void setComment( const char *text );[m
[31m-[m
[31m-         char *comment_;[m
[31m-      };[m
[31m-[m
[31m-      //struct MemberNamesTransform[m
[31m-      //{[m
[31m-      //   typedef const char *result_type;[m
[31m-      //   const char *operator()( const CZString &name ) const[m
[31m-      //   {[m
[31m-      //      return name.c_str();[m
[31m-      //   }[m
[31m-      //};[m
[31m-[m
[31m-      union ValueHolder[m
[31m-      {[m
[31m-         Int int_;[m
[31m-         UInt uint_;[m
[31m-         double real_;[m
[31m-         bool bool_;[m
[31m-         char *string_;[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-         ValueInternalArray *array_;[m
[31m-         ValueInternalMap *map_;[m
[31m-#else[m
[31m-         ObjectValues *map_;[m
[31m-# endif[m
[31m-      } value_;[m
[31m-      ValueType type_ : 8;[m
[31m-      int allocated_ : 1;     // Notes: if declared as bool, bitfield is useless.[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      unsigned int itemIsUsed_ : 1;      // used by the ValueInternalMap container.[m
[31m-      int memberNameIsStatic_ : 1;       // used by the ValueInternalMap container.[m
[31m-# endif[m
[31m-      CommentInfo *comments_;[m
[31m-   };[m
[31m-[m
[31m-[m
[31m-   /** \brief Experimental and untested: represents an element of the "path" to access a node.[m
[31m-    */[m
[31m-   class PathArgument[m
[31m-   {[m
[31m-   public:[m
[31m-      friend class Path;[m
[31m-[m
[31m-      PathArgument();[m
[31m-      PathArgument( UInt index );[m
[31m-      PathArgument( const char *key );[m
[31m-      PathArgument( const std::string &key );[m
[31m-[m
[31m-   private:[m
[31m-      enum Kind[m
[31m-      {[m
[31m-         kindNone = 0,[m
[31m-         kindIndex,[m
[31m-         kindKey[m
[31m-      };[m
[31m-      std::string key_;[m
[31m-      UInt index_;[m
[31m-      Kind kind_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Experimental and untested: represents a "path" to access a node.[m
[31m-    *[m
[31m-    * Syntax:[m
[31m-    * - "." => root node[m
[31m-    * - ".[n]" => elements at index 'n' of root node (an array value)[m
[31m-    * - ".name" => member named 'name' of root node (an object value)[m
[31m-    * - ".name1.name2.name3"[m
[31m-    * - ".[0][1][2].name1[3]"[m
[31m-    * - ".%" => member name is provided as parameter[m
[31m-    * - ".[%]" => index is provied as parameter[m
[31m-    */[m
[31m-   class Path[m
[31m-   {[m
[31m-   public:[m
[31m-      Path( const std::string &path,[m
[31m-            const PathArgument &a1 = PathArgument(),[m
[31m-            const PathArgument &a2 = PathArgument(),[m
[31m-            const PathArgument &a3 = PathArgument(),[m
[31m-            const PathArgument &a4 = PathArgument(),[m
[31m-            const PathArgument &a5 = PathArgument() );[m
[31m-[m
[31m-      const Value &resolve( const Value &root ) const;[m
[31m-      Value resolve( const Value &root, [m
[31m-                     const Value &defaultValue ) const;[m
[31m-      /// Creates the "path" to access the specified node and returns a reference on the node.[m
[31m-      Value &make( Value &root ) const;[m
[31m-[m
[31m-   private:[m
[31m-      typedef std::vector<const PathArgument *> InArgs;[m
[31m-      typedef std::vector<PathArgument> Args;[m
[31m-[m
[31m-      void makePath( const std::string &path,[m
[31m-                     const InArgs &in );[m
[31m-      void addPathInArg( const std::string &path, [m
[31m-                         const InArgs &in, [m
[31m-                         InArgs::const_iterator &itInArg, [m
[31m-                         PathArgument::Kind kind );[m
[31m-      void invalidPath( const std::string &path, [m
[31m-                        int location );[m
[31m-[m
[31m-      Args args_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Experimental do not use: Allocator to customize member name and string value memory management done by Value.[m
[31m-    *[m
[31m-    * - makeMemberName() and releaseMemberName() are called to respectively duplicate and[m
[31m-    *   free an Json::objectValue member name.[m
[31m-    * - duplicateStringValue() and releaseStringValue() are called similarly to[m
[31m-    *   duplicate and free a Json::stringValue value.[m
[31m-    */[m
[31m-   class ValueAllocator[m
[31m-   {[m
[31m-   public:[m
[31m-      enum { unknown = (unsigned)-1 };[m
[31m-[m
[31m-      virtual ~ValueAllocator();[m
[31m-[m
[31m-      virtual char *makeMemberName( const char *memberName ) = 0;[m
[31m-      virtual void releaseMemberName( char *memberName ) = 0;[m
[31m-      virtual char *duplicateStringValue( const char *value, [m
[31m-                                          unsigned int length = unknown ) = 0;[m
[31m-      virtual void releaseStringValue( char *value ) = 0;[m
[31m-   };[m
[31m-[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   /** \brief Allocator to customize Value internal map.[m
[31m-    * Below is an example of a simple implementation (default implementation actually[m
[31m-    * use memory pool for speed).[m
[31m-    * \code[m
[31m-      class DefaultValueMapAllocator : public ValueMapAllocator[m
[31m-      {[m
[31m-      public: // overridden from ValueMapAllocator[m
[31m-         virtual ValueInternalMap *newMap()[m
[31m-         {[m
[31m-            return new ValueInternalMap();[m
[31m-         }[m
[31m-[m
[31m-         virtual ValueInternalMap *newMapCopy( const ValueInternalMap &other )[m
[31m-         {[m
[31m-            return new ValueInternalMap( other );[m
[31m-         }[m
[31m-[m
[31m-         virtual void destructMap( ValueInternalMap *map )[m
[31m-         {[m
[31m-            delete map;[m
[31m-         }[m
[31m-[m
[31m-         virtual ValueInternalLink *allocateMapBuckets( unsigned int size )[m
[31m-         {[m
[31m-            return new ValueInternalLink[size];[m
[31m-         }[m
[31m-[m
[31m-         virtual void releaseMapBuckets( ValueInternalLink *links )[m
[31m-         {[m
[31m-            delete [] links;[m
[31m-         }[m
[31m-[m
[31m-         virtual ValueInternalLink *allocateMapLink()[m
[31m-         {[m
[31m-            return new ValueInternalLink();[m
[31m-         }[m
[31m-[m
[31m-         virtual void releaseMapLink( ValueInternalLink *link )[m
[31m-         {[m
[31m-            delete link;[m
[31m-         }[m
[31m-      };[m
[31m-    * \endcode[m
[31m-    */ [m
[31m-   class JSON_API ValueMapAllocator[m
[31m-   {[m
[31m-   public:[m
[31m-      virtual ~ValueMapAllocator();[m
[31m-      virtual ValueInternalMap *newMap() = 0;[m
[31m-      virtual ValueInternalMap *newMapCopy( const ValueInternalMap &other ) = 0;[m
[31m-      virtual void destructMap( ValueInternalMap *map ) = 0;[m
[31m-      virtual ValueInternalLink *allocateMapBuckets( unsigned int size ) = 0;[m
[31m-      virtual void releaseMapBuckets( ValueInternalLink *links ) = 0;[m
[31m-      virtual ValueInternalLink *allocateMapLink() = 0;[m
[31m-      virtual void releaseMapLink( ValueInternalLink *link ) = 0;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief ValueInternalMap hash-map bucket chain link (for internal use only).[m
[31m-    * \internal previous_ & next_ allows for bidirectional traversal.[m
[31m-    */[m
[31m-   class JSON_API ValueInternalLink[m
[31m-   {[m
[31m-   public:[m
[31m-      enum { itemPerLink = 6 };  // sizeof(ValueInternalLink) = 128 on 32 bits architecture.[m
[31m-      enum InternalFlags { [m
[31m-         flagAvailable = 0,[m
[31m-         flagUsed = 1[m
[31m-      };[m
[31m-[m
[31m-      ValueInternalLink();[m
[31m-[m
[31m-      ~ValueInternalLink();[m
[31m-[m
[31m-      Value items_[itemPerLink];[m
[31m-      char *keys_[itemPerLink];[m
[31m-      ValueInternalLink *previous_;[m
[31m-      ValueInternalLink *next_;[m
[31m-   };[m
[31m-[m
[31m-[m
[31m-   /** \brief A linked page based hash-table implementation used internally by Value.[m
[31m-    * \internal ValueInternalMap is a tradional bucket based hash-table, with a linked[m
[31m-    * list in each bucket to handle collision. There is an addional twist in that[m
[31m-    * each node of the collision linked list is a page containing a fixed amount of[m
[31m-    * value. This provides a better compromise between memory usage and speed.[m
[31m-    * [m
[31m-    * Each bucket is made up of a chained list of ValueInternalLink. The last[m
[31m-    * link of a given bucket can be found in the 'previous_' field of the following bucket.[m
[31m-    * The last link of the last bucket is stored in tailLink_ as it has no following bucket.[m
[31m-    * Only the last link of a bucket may contains 'available' item. The last link always[m
[31m-    * contains at least one element unless is it the bucket one very first link.[m
[31m-    */[m
[31m-   class JSON_API ValueInternalMap[m
[31m-   {[m
[31m-      friend class ValueIteratorBase;[m
[31m-      friend class Value;[m
[31m-   public:[m
[31m-      typedef unsigned int HashKey;[m
[31m-      typedef unsigned int BucketIndex;[m
[31m-[m
[31m-# ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-      struct IteratorState[m
[31m-      {[m
[31m-         IteratorState() [m
[31m-            : map_(0)[m
[31m-            , link_(0)[m
[31m-            , itemIndex_(0)[m
[31m-            , bucketIndex_(0) [m
[31m-         {[m
[31m-         }[m
[31m-         ValueInternalMap *map_;[m
[31m-         ValueInternalLink *link_;[m
[31m-         BucketIndex itemIndex_;[m
[31m-         BucketIndex bucketIndex_;[m
[31m-      };[m
[31m-# endif // ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-[m
[31m-      ValueInternalMap();[m
[31m-      ValueInternalMap( const ValueInternalMap &other );[m
[31m-      ValueInternalMap &operator =( const ValueInternalMap &other );[m
[31m-      ~ValueInternalMap();[m
[31m-[m
[31m-      void swap( ValueInternalMap &other );[m
[31m-[m
[31m-      BucketIndex size() const;[m
[31m-[m
[31m-      void clear();[m
[31m-[m
[31m-      bool reserveDelta( BucketIndex growth );[m
[31m-[m
[31m-      bool reserve( BucketIndex newItemCount );[m
[31m-[m
[31m-      const Value *find( const char *key ) const;[m
[31m-[m
[31m-      Value *find( const char *key );[m
[31m-[m
[31m-      Value &resolveReference( const char *key, [m
[31m-                               bool isStatic );[m
[31m-[m
[31m-      void remove( const char *key );[m
[31m-[m
[31m-      void doActualRemove( ValueInternalLink *link, [m
[31m-                           BucketIndex index,[m
[31m-                           BucketIndex bucketIndex );[m
[31m-[m
[31m-      ValueInternalLink *&getLastLinkInBucket( BucketIndex bucketIndex );[m
[31m-[m
[31m-      Value &setNewItem( const char *key, [m
[31m-                         bool isStatic, [m
[31m-                         ValueInternalLink *link, [m
[31m-                         BucketIndex index );[m
[31m-[m
[31m-      Value &unsafeAdd( const char *key, [m
[31m-                        bool isStatic, [m
[31m-                        HashKey hashedKey );[m
[31m-[m
[31m-      HashKey hash( const char *key ) const;[m
[31m-[m
[31m-      int compare( const ValueInternalMap &other ) const;[m
[31m-[m
[31m-   private:[m
[31m-      void makeBeginIterator( IteratorState &it ) const;[m
[31m-      void makeEndIterator( IteratorState &it ) const;[m
[31m-      static bool equals( const IteratorState &x, const IteratorState &other );[m
[31m-      static void increment( IteratorState &iterator );[m
[31m-      static void incrementBucket( IteratorState &iterator );[m
[31m-      static void decrement( IteratorState &iterator );[m
[31m-      static const char *key( const IteratorState &iterator );[m
[31m-      static const char *key( const IteratorState &iterator, bool &isStatic );[m
[31m-      static Value &value( const IteratorState &iterator );[m
[31m-      static int distance( const IteratorState &x, const IteratorState &y );[m
[31m-[m
[31m-   private:[m
[31m-      ValueInternalLink *buckets_;[m
[31m-      ValueInternalLink *tailLink_;[m
[31m-      BucketIndex bucketsSize_;[m
[31m-      BucketIndex itemCount_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief A simplified deque implementation used internally by Value.[m
[31m-   * \internal[m
[31m-   * It is based on a list of fixed "page", each page contains a fixed number of items.[m
[31m-   * Instead of using a linked-list, a array of pointer is used for fast item look-up.[m
[31m-   * Look-up for an element is as follow:[m
[31m-   * - compute page index: pageIndex = itemIndex / itemsPerPage[m
[31m-   * - look-up item in page: pages_[pageIndex][itemIndex % itemsPerPage][m
[31m-   *[m
[31m-   * Insertion is amortized constant time (only the array containing the index of pointers[m
[31m-   * need to be reallocated when items are appended).[m
[31m-   */[m
[31m-   class JSON_API ValueInternalArray[m
[31m-   {[m
[31m-      friend class Value;[m
[31m-      friend class ValueIteratorBase;[m
[31m-   public:[m
[31m-      enum { itemsPerPage = 8 };    // should be a power of 2 for fast divide and modulo.[m
[31m-      typedef Value::ArrayIndex ArrayIndex;[m
[31m-      typedef unsigned int PageIndex;[m
[31m-[m
[31m-# ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-      struct IteratorState // Must be a POD[m
[31m-      {[m
[31m-         IteratorState() [m
[31m-            : array_(0)[m
[31m-            , currentPageIndex_(0)[m
[31m-            , currentItemIndex_(0) [m
[31m-         {[m
[31m-         }[m
[31m-         ValueInternalArray *array_;[m
[31m-         Value **currentPageIndex_;[m
[31m-         unsigned int currentItemIndex_;[m
[31m-      };[m
[31m-# endif // ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-[m
[31m-      ValueInternalArray();[m
[31m-      ValueInternalArray( const ValueInternalArray &other );[m
[31m-      ValueInternalArray &operator =( const ValueInternalArray &other );[m
[31m-      ~ValueInternalArray();[m
[31m-      void swap( ValueInternalArray &other );[m
[31m-[m
[31m-      void clear();[m
[31m-      void resize( ArrayIndex newSize );[m
[31m-[m
[31m-      Value &resolveReference( ArrayIndex index );[m
[31m-[m
[31m-      Value *find( ArrayIndex index ) const;[m
[31m-[m
[31m-      ArrayIndex size() const;[m
[31m-[m
[31m-      int compare( const ValueInternalArray &other ) const;[m
[31m-[m
[31m-   private:[m
[31m-      static bool equals( const IteratorState &x, const IteratorState &other );[m
[31m-      static void increment( IteratorState &iterator );[m
[31m-      static void decrement( IteratorState &iterator );[m
[31m-      static Value &dereference( const IteratorState &iterator );[m
[31m-      static Value &unsafeDereference( const IteratorState &iterator );[m
[31m-      static int distance( const IteratorState &x, const IteratorState &y );[m
[31m-      static ArrayIndex indexOf( const IteratorState &iterator );[m
[31m-      void makeBeginIterator( IteratorState &it ) const;[m
[31m-      void makeEndIterator( IteratorState &it ) const;[m
[31m-      void makeIterator( IteratorState &it, ArrayIndex index ) const;[m
[31m-[m
[31m-      void makeIndexValid( ArrayIndex index );[m
[31m-[m
[31m-      Value **pages_;[m
[31m-      ArrayIndex size_;[m
[31m-      PageIndex pageCount_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Experimental: do not use. Allocator to customize Value internal array.[m
[31m-    * Below is an example of a simple implementation (actual implementation use[m
[31m-    * memory pool).[m
[31m-      \code[m
[31m-class DefaultValueArrayAllocator : public ValueArrayAllocator[m
[31m-{[m
[31m-public: // overridden from ValueArrayAllocator[m
[31m-   virtual ~DefaultValueArrayAllocator()[m
[31m-   {[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalArray *newArray()[m
[31m-   {[m
[31m-      return new ValueInternalArray();[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalArray *newArrayCopy( const ValueInternalArray &other )[m
[31m-   {[m
[31m-      return new ValueInternalArray( other );[m
[31m-   }[m
[31m-[m
[31m-   virtual void destruct( ValueInternalArray *array )[m
[31m-   {[m
[31m-      delete array;[m
[31m-   }[m
[31m-[m
[31m-   virtual void reallocateArrayPageIndex( Value **&indexes, [m
[31m-                                          ValueInternalArray::PageIndex &indexCount,[m
[31m-                                          ValueInternalArray::PageIndex minNewIndexCount )[m
[31m-   {[m
[31m-      ValueInternalArray::PageIndex newIndexCount = (indexCount*3)/2 + 1;[m
[31m-      if ( minNewIndexCount > newIndexCount )[m
[31m-         newIndexCount = minNewIndexCount;[m
[31m-      void *newIndexes = realloc( indexes, sizeof(Value*) * newIndexCount );[m
[31m-      if ( !newIndexes )[m
[31m-         throw std::bad_alloc();[m
[31m-      indexCount = newIndexCount;[m
[31m-      indexes = static_cast<Value **>( newIndexes );[m
[31m-   }[m
[31m-   virtual void releaseArrayPageIndex( Value **indexes, [m
[31m-                                       ValueInternalArray::PageIndex indexCount )[m
[31m-   {[m
[31m-      if ( indexes )[m
[31m-         free( indexes );[m
[31m-   }[m
[31m-[m
[31m-   virtual Value *allocateArrayPage()[m
[31m-   {[m
[31m-      return static_cast<Value *>( malloc( sizeof(Value) * ValueInternalArray::itemsPerPage ) );[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseArrayPage( Value *value )[m
[31m-   {[m
[31m-      if ( value )[m
[31m-         free( value );[m
[31m-   }[m
[31m-};[m
[31m-      \endcode[m
[31m-    */ [m
[31m-   class JSON_API ValueArrayAllocator[m
[31m-   {[m
[31m-   public:[m
[31m-      virtual ~ValueArrayAllocator();[m
[31m-      virtual ValueInternalArray *newArray() = 0;[m
[31m-      virtual ValueInternalArray *newArrayCopy( const ValueInternalArray &other ) = 0;[m
[31m-      virtual void destructArray( ValueInternalArray *array ) = 0;[m
[31m-      /** \brief Reallocate array page index.[m
[31m-       * Reallocates an array of pointer on each page.[m
[31m-       * \param indexes [input] pointer on the current index. May be \c NULL.[m
[31m-       *                [output] pointer on the new index of at least [m
[31m-       *                         \a minNewIndexCount pages. [m
[31m-       * \param indexCount [input] current number of pages in the index.[m
[31m-       *                   [output] number of page the reallocated index can handle.[m
[31m-       *                            \b MUST be >= \a minNewIndexCount.[m
[31m-       * \param minNewIndexCount Minimum number of page the new index must be able to[m
[31m-       *                         handle.[m
[31m-       */[m
[31m-      virtual void reallocateArrayPageIndex( Value **&indexes, [m
[31m-                                             ValueInternalArray::PageIndex &indexCount,[m
[31m-                                             ValueInternalArray::PageIndex minNewIndexCount ) = 0;[m
[31m-      virtual void releaseArrayPageIndex( Value **indexes, [m
[31m-                                          ValueInternalArray::PageIndex indexCount ) = 0;[m
[31m-      virtual Value *allocateArrayPage() = 0;[m
[31m-      virtual void releaseArrayPage( Value *value ) = 0;[m
[31m-   };[m
[31m-#endif // #ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-[m
[31m-[m
[31m-   /** \brief base class for Value iterators.[m
[31m-    *[m
[31m-    */[m
[31m-   class ValueIteratorBase[m
[31m-   {[m
[31m-   public:[m
[31m-      typedef unsigned int size_t;[m
[31m-      typedef int difference_type;[m
[31m-      typedef ValueIteratorBase SelfType;[m
[31m-[m
[31m-      ValueIteratorBase();[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      explicit ValueIteratorBase( const Value::ObjectValues::iterator &current );[m
[31m-#else[m
[31m-      ValueIteratorBase( const ValueInternalArray::IteratorState &state );[m
[31m-      ValueIteratorBase( const ValueInternalMap::IteratorState &state );[m
[31m-#endif[m
[31m-[m
[31m-      bool operator ==( const SelfType &other ) const[m
[31m-      {[m
[31m-         return isEqual( other );[m
[31m-      }[m
[31m-[m
[31m-      bool operator !=( const SelfType &other ) const[m
[31m-      {[m
[31m-         return !isEqual( other );[m
[31m-      }[m
[31m-[m
[31m-      difference_type operator -( const SelfType &other ) const[m
[31m-      {[m
[31m-         return computeDistance( other );[m
[31m-      }[m
[31m-[m
[31m-      /// Return either the index or the member name of the referenced value as a Value.[m
[31m-      Value key() const;[m
[31m-[m
[31m-      /// Return the index of the referenced Value. -1 if it is not an arrayValue.[m
[31m-      UInt index() const;[m
[31m-[m
[31m-      /// Return the member name of the referenced Value. "" if it is not an objectValue.[m
[31m-      const char *memberName() const;[m
[31m-[m
[31m-   protected:[m
[31m-      Value &deref() const;[m
[31m-[m
[31m-      void increment();[m
[31m-[m
[31m-      void decrement();[m
[31m-[m
[31m-      difference_type computeDistance( const SelfType &other ) const;[m
[31m-[m
[31m-      bool isEqual( const SelfType &other ) const;[m
[31m-[m
[31m-      void copy( const SelfType &other );[m
[31m-[m
[31m-   private:[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      Value::ObjectValues::iterator current_;[m
[31m-      // Indicates that iterator is for a null value.[m
[31m-      bool isNull_;[m
[31m-#else[m
[31m-      union[m
[31m-      {[m
[31m-         ValueInternalArray::IteratorState array_;[m
[31m-         ValueInternalMap::IteratorState map_;[m
[31m-      } iterator_;[m
[31m-      bool isArray_;[m
[31m-#endif[m
[31m-   };[m
[31m-[m
[31m-   /** \brief const iterator for object and array value.[m
[31m-    *[m
[31m-    */[m
[31m-   class ValueConstIterator : public ValueIteratorBase[m
[31m-   {[m
[31m-      friend class Value;[m
[31m-   public:[m
[31m-      typedef unsigned int size_t;[m
[31m-      typedef int difference_type;[m
[31m-      typedef const Value &reference;[m
[31m-      typedef const Value *pointer;[m
[31m-      typedef ValueConstIterator SelfType;[m
[31m-[m
[31m-      ValueConstIterator();[m
[31m-   private:[m
[31m-      /*! \internal Use by Value to create an iterator.[m
[31m-       */[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      explicit ValueConstIterator( const Value::ObjectValues::iterator &current );[m
[31m-#else[m
[31m-      ValueConstIterator( const ValueInternalArray::IteratorState &state );[m
[31m-      ValueConstIterator( const ValueInternalMap::IteratorState &state );[m
[31m-#endif[m
[31m-   public:[m
[31m-      SelfType &operator =( const ValueIteratorBase &other );[m
[31m-[m
[31m-      SelfType operator++( int )[m
[31m-      {[m
[31m-         SelfType temp( *this );[m
[31m-         ++*this;[m
[31m-         return temp;[m
[31m-      }[m
[31m-[m
[31m-      SelfType operator--( int )[m
[31m-      {[m
[31m-         SelfType temp( *this );[m
[31m-         --*this;[m
[31m-         return temp;[m
[31m-      }[m
[31m-[m
[31m-      SelfType &operator--()[m
[31m-      {[m
[31m-         decrement();[m
[31m-         return *this;[m
[31m-      }[m
[31m-[m
[31m-      SelfType &operator++()[m
[31m-      {[m
[31m-         increment();[m
[31m-         return *this;[m
[31m-      }[m
[31m-[m
[31m-      reference operator *() const[m
[31m-      {[m
[31m-         return deref();[m
[31m-      }[m
[31m-   };[m
[31m-[m
[31m-[m
[31m-   /** \brief Iterator for object and array value.[m
[31m-    */[m
[31m-   class ValueIterator : public ValueIteratorBase[m
[31m-   {[m
[31m-      friend class Value;[m
[31m-   public:[m
[31m-      typedef unsigned int size_t;[m
[31m-      typedef int difference_type;[m
[31m-      typedef Value &reference;[m
[31m-      typedef Value *pointer;[m
[31m-      typedef ValueIterator SelfType;[m
[31m-[m
[31m-      ValueIterator();[m
[31m-      ValueIterator( const ValueConstIterator &other );[m
[31m-      ValueIterator( const ValueIterator &other );[m
[31m-   private:[m
[31m-      /*! \internal Use by Value to create an iterator.[m
[31m-       */[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-      explicit ValueIterator( const Value::ObjectValues::iterator &current );[m
[31m-#else[m
[31m-      ValueIterator( const ValueInternalArray::IteratorState &state );[m
[31m-      ValueIterator( const ValueInternalMap::IteratorState &state );[m
[31m-#endif[m
[31m-   public:[m
[31m-[m
[31m-      SelfType &operator =( const SelfType &other );[m
[31m-[m
[31m-      SelfType operator++( int )[m
[31m-      {[m
[31m-         SelfType temp( *this );[m
[31m-         ++*this;[m
[31m-         return temp;[m
[31m-      }[m
[31m-[m
[31m-      SelfType operator--( int )[m
[31m-      {[m
[31m-         SelfType temp( *this );[m
[31m-         --*this;[m
[31m-         return temp;[m
[31m-      }[m
[31m-[m
[31m-      SelfType &operator--()[m
[31m-      {[m
[31m-         decrement();[m
[31m-         return *this;[m
[31m-      }[m
[31m-[m
[31m-      SelfType &operator++()[m
[31m-      {[m
[31m-         increment();[m
[31m-         return *this;[m
[31m-      }[m
[31m-[m
[31m-      reference operator *() const[m
[31m-      {[m
[31m-         return deref();[m
[31m-      }[m
[31m-   };[m
[31m-[m
[31m-[m
[31m-} // namespace Json[m
[31m-[m
[31m-[m
[31m-#endif // CPPTL_JSON_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/writer.h b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/writer.h[m
[1mdeleted file mode 100755[m
[1mindex 5f4b83b..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json/writer.h[m
[1m+++ /dev/null[m
[36m@@ -1,174 +0,0 @@[m
[31m-#ifndef JSON_WRITER_H_INCLUDED[m
[31m-# define JSON_WRITER_H_INCLUDED[m
[31m-[m
[31m-# include "value.h"[m
[31m-# include <vector>[m
[31m-# include <string>[m
[31m-# include <iostream>[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-   class Value;[m
[31m-[m
[31m-   /** \brief Abstract class for writers.[m
[31m-    */[m
[31m-   class JSON_API Writer[m
[31m-   {[m
[31m-   public:[m
[31m-      virtual ~Writer();[m
[31m-[m
[31m-      virtual std::string write( const Value &root ) = 0;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Outputs a Value in <a HREF="http://www.json.org">JSON</a> format without formatting (not human friendly).[m
[31m-    *[m
[31m-    * The JSON document is written in a single line. It is not intended for 'human' consumption,[m
[31m-    * but may be usefull to support feature such as RPC where bandwith is limited.[m
[31m-    * \sa Reader, Value[m
[31m-    */[m
[31m-   class JSON_API FastWriter : public Writer[m
[31m-   {[m
[31m-   public:[m
[31m-      FastWriter();[m
[31m-      virtual ~FastWriter(){}[m
[31m-[m
[31m-      void enableYAMLCompatibility();[m
[31m-[m
[31m-   public: // overridden from Writer[m
[31m-      virtual std::string write( const Value &root );[m
[31m-[m
[31m-   private:[m
[31m-      void writeValue( const Value &value );[m
[31m-[m
[31m-      std::string document_;[m
[31m-      bool yamlCompatiblityEnabled_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Writes a Value in <a HREF="http://www.json.org">JSON</a> format in a human friendly way.[m
[31m-    *[m
[31m-    * The rules for line break and indent are as follow:[m
[31m-    * - Object value:[m
[31m-    *     - if empty then print {} without indent and line break[m
[31m-    *     - if not empty the print '{', line break & indent, print one value per line[m
[31m-    *       and then unindent and line break and print '}'.[m
[31m-    * - Array value:[m
[31m-    *     - if empty then print [] without indent and line break[m
[31m-    *     - if the array contains no object value, empty array or some other value types,[m
[31m-    *       and all the values fit on one lines, then print the array on a single line.[m
[31m-    *     - otherwise, it the values do not fit on one line, or the array contains[m
[31m-    *       object or non empty array, then print one value per line.[m
[31m-    *[m
[31m-    * If the Value have comments then they are outputed according to their #CommentPlacement.[m
[31m-    *[m
[31m-    * \sa Reader, Value, Value::setComment()[m
[31m-    */[m
[31m-   class JSON_API StyledWriter: public Writer[m
[31m-   {[m
[31m-   public:[m
[31m-      StyledWriter();[m
[31m-      virtual ~StyledWriter(){}[m
[31m-[m
[31m-   public: // overridden from Writer[m
[31m-      /** \brief Serialize a Value in <a HREF="http://www.json.org">JSON</a> format.[m
[31m-       * \param root Value to serialize.[m
[31m-       * \return String containing the JSON document that represents the root value.[m
[31m-       */[m
[31m-      virtual std::string write( const Value &root );[m
[31m-[m
[31m-   private:[m
[31m-      void writeValue( const Value &value );[m
[31m-      void writeArrayValue( const Value &value );[m
[31m-      bool isMultineArray( const Value &value );[m
[31m-      void pushValue( const std::string &value );[m
[31m-      void writeIndent();[m
[31m-      void writeWithIndent( const std::string &value );[m
[31m-      void indent();[m
[31m-      void unindent();[m
[31m-      void writeCommentBeforeValue( const Value &root );[m
[31m-      void writeCommentAfterValueOnSameLine( const Value &root );[m
[31m-      bool hasCommentForValue( const Value &value );[m
[31m-      static std::string normalizeEOL( const std::string &text );[m
[31m-[m
[31m-      typedef std::vector<std::string> ChildValues;[m
[31m-[m
[31m-      ChildValues childValues_;[m
[31m-      std::string document_;[m
[31m-      std::string indentString_;[m
[31m-      int rightMargin_;[m
[31m-      int indentSize_;[m
[31m-      bool addChildValues_;[m
[31m-   };[m
[31m-[m
[31m-   /** \brief Writes a Value in <a HREF="http://www.json.org">JSON</a> format in a human friendly way,[m
[31m-        to a stream rather than to a string.[m
[31m-    *[m
[31m-    * The rules for line break and indent are as follow:[m
[31m-    * - Object value:[m
[31m-    *     - if empty then print {} without indent and line break[m
[31m-    *     - if not empty the print '{', line break & indent, print one value per line[m
[31m-    *       and then unindent and line break and print '}'.[m
[31m-    * - Array value:[m
[31m-    *     - if empty then print [] without indent and line break[m
[31m-    *     - if the array contains no object value, empty array or some other value types,[m
[31m-    *       and all the values fit on one lines, then print the array on a single line.[m
[31m-    *     - otherwise, it the values do not fit on one line, or the array contains[m
[31m-    *       object or non empty array, then print one value per line.[m
[31m-    *[m
[31m-    * If the Value have comments then they are outputed according to their #CommentPlacement.[m
[31m-    *[m
[31m-    * \param indentation Each level will be indented by this amount extra.[m
[31m-    * \sa Reader, Value, Value::setComment()[m
[31m-    */[m
[31m-   class JSON_API StyledStreamWriter[m
[31m-   {[m
[31m-   public:[m
[31m-      StyledStreamWriter( std::string indentation="\t" );[m
[31m-      ~StyledStreamWriter(){}[m
[31m-[m
[31m-   public:[m
[31m-      /** \brief Serialize a Value in <a HREF="http://www.json.org">JSON</a> format.[m
[31m-       * \param out Stream to write to. (Can be ostringstream, e.g.)[m
[31m-       * \param root Value to serialize.[m
[31m-       * \note There is no point in deriving from Writer, since write() should not return a value.[m
[31m-       */[m
[31m-      void write( std::ostream &out, const Value &root );[m
[31m-[m
[31m-   private:[m
[31m-      void writeValue( const Value &value );[m
[31m-      void writeArrayValue( const Value &value );[m
[31m-      bool isMultineArray( const Value &value );[m
[31m-      void pushValue( const std::string &value );[m
[31m-      void writeIndent();[m
[31m-      void writeWithIndent( const std::string &value );[m
[31m-      void indent();[m
[31m-      void unindent();[m
[31m-      void writeCommentBeforeValue( const Value &root );[m
[31m-      void writeCommentAfterValueOnSameLine( const Value &root );[m
[31m-      bool hasCommentForValue( const Value &value );[m
[31m-      static std::string normalizeEOL( const std::string &text );[m
[31m-[m
[31m-      typedef std::vector<std::string> ChildValues;[m
[31m-[m
[31m-      ChildValues childValues_;[m
[31m-      std::ostream* document_;[m
[31m-      std::string indentString_;[m
[31m-      int rightMargin_;[m
[31m-      std::string indentation_;[m
[31m-      bool addChildValues_;[m
[31m-   };[m
[31m-[m
[31m-   std::string JSON_API valueToString( Int value );[m
[31m-   std::string JSON_API valueToString( UInt value );[m
[31m-   std::string JSON_API valueToString( double value );[m
[31m-   std::string JSON_API valueToString( bool value );[m
[31m-   std::string JSON_API valueToQuotedString( const char *value );[m
[31m-[m
[31m-   /// \brief Output using the StyledStreamWriter.[m
[31m-   /// \see Json::operator>>()[m
[31m-   std::ostream& operator<<( std::ostream&, const Value &root );[m
[31m-[m
[31m-} // namespace Json[m
[31m-[m
[31m-[m
[31m-[m
[31m-#endif // JSON_WRITER_H_INCLUDED[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_batchallocator.h b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_batchallocator.h[m
[1mdeleted file mode 100755[m
[1mindex 87ea5ed..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_batchallocator.h[m
[1m+++ /dev/null[m
[36m@@ -1,125 +0,0 @@[m
[31m-#ifndef JSONCPP_BATCHALLOCATOR_H_INCLUDED[m
[31m-# define JSONCPP_BATCHALLOCATOR_H_INCLUDED[m
[31m-[m
[31m-# include <stdlib.h>[m
[31m-# include <assert.h>[m
[31m-[m
[31m-# ifndef JSONCPP_DOC_EXCLUDE_IMPLEMENTATION[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-/* Fast memory allocator.[m
[31m- *[m
[31m- * This memory allocator allocates memory for a batch of object (specified by[m
[31m- * the page size, the number of object in each page).[m
[31m- *[m
[31m- * It does not allow the destruction of a single object. All the allocated objects[m
[31m- * can be destroyed at once. The memory can be either released or reused for future[m
[31m- * allocation.[m
[31m- * [m
[31m- * The in-place new operator must be used to construct the object using the pointer[m
[31m- * returned by allocate.[m
[31m- */[m
[31m-template<typename AllocatedType[m
[31m-        ,const unsigned int objectPerAllocation>[m
[31m-class BatchAllocator[m
[31m-{[m
[31m-public:[m
[31m-   typedef AllocatedType Type;[m
[31m-[m
[31m-   BatchAllocator( unsigned int objectsPerPage = 255 )[m
[31m-      : freeHead_( 0 )[m
[31m-      , objectsPerPage_( objectsPerPage )[m
[31m-   {[m
[31m-//      printf( "Size: %d => %s\n", sizeof(AllocatedType), typeid(AllocatedType).name() );[m
[31m-      assert( sizeof(AllocatedType) * objectPerAllocation >= sizeof(AllocatedType *) ); // We must be able to store a slist in the object free space.[m
[31m-      assert( objectsPerPage >= 16 );[m
[31m-      batches_ = allocateBatch( 0 );   // allocated a dummy page[m
[31m-      currentBatch_ = batches_;[m
[31m-   }[m
[31m-[m
[31m-   ~BatchAllocator()[m
[31m-   {[m
[31m-      for ( BatchInfo *batch = batches_; batch;  )[m
[31m-      {[m
[31m-         BatchInfo *nextBatch = batch->next_;[m
[31m-         free( batch );[m
[31m-         batch = nextBatch;[m
[31m-      }[m
[31m-   }[m
[31m-[m
[31m-   /// allocate space for an array of objectPerAllocation object.[m
[31m-   /// @warning it is the responsability of the caller to call objects constructors.[m
[31m-   AllocatedType *allocate()[m
[31m-   {[m
[31m-      if ( freeHead_ ) // returns node from free list.[m
[31m-      {[m
[31m-         AllocatedType *object = freeHead_;[m
[31m-         freeHead_ = *(AllocatedType **)object;[m
[31m-         return object;[m
[31m-      }[m
[31m-      if ( currentBatch_->used_ == currentBatch_->end_ )[m
[31m-      {[m
[31m-         currentBatch_ = currentBatch_->next_;[m
[31m-         while ( currentBatch_  &&  currentBatch_->used_ == currentBatch_->end_ )[m
[31m-            currentBatch_ = currentBatch_->next_;[m
[31m-[m
[31m-         if ( !currentBatch_  ) // no free batch found, allocate a new one[m
[31m-         { [m
[31m-            currentBatch_ = allocateBatch( objectsPerPage_ );[m
[31m-            currentBatch_->next_ = batches_; // insert at the head of the list[m
[31m-            batches_ = currentBatch_;[m
[31m-         }[m
[31m-      }[m
[31m-      AllocatedType *allocated = currentBatch_->used_;[m
[31m-      currentBatch_->used_ += objectPerAllocation;[m
[31m-      return allocated;[m
[31m-   }[m
[31m-[m
[31m-   /// Release the object.[m
[31m-   /// @warning it is the responsability of the caller to actually destruct the object.[m
[31m-   void release( AllocatedType *object )[m
[31m-   {[m
[31m-      assert( object != 0 );[m
[31m-      *(AllocatedType **)object = freeHead_;[m
[31m-      freeHead_ = object;[m
[31m-   }[m
[31m-[m
[31m-private:[m
[31m-   struct BatchInfo[m
[31m-   {[m
[31m-      BatchInfo *next_;[m
[31m-      AllocatedType *used_;[m
[31m-      AllocatedType *end_;[m
[31m-      AllocatedType buffer_[objectPerAllocation];[m
[31m-   };[m
[31m-[m
[31m-   // disabled copy constructor and assignement operator.[m
[31m-   BatchAllocator( const BatchAllocator & );[m
[31m-   void operator =( const BatchAllocator &);[m
[31m-[m
[31m-   static BatchInfo *allocateBatch( unsigned int objectsPerPage )[m
[31m-   {[m
[31m-      const unsigned int mallocSize = sizeof(BatchInfo) - sizeof(AllocatedType)* objectPerAllocation[m
[31m-                                + sizeof(AllocatedType) * objectPerAllocation * objectsPerPage;[m
[31m-      BatchInfo *batch = static_cast<BatchInfo*>( malloc( mallocSize ) );[m
[31m-      batch->next_ = 0;[m
[31m-      batch->used_ = batch->buffer_;[m
[31m-      batch->end_ = batch->buffer_ + objectsPerPage;[m
[31m-      return batch;[m
[31m-   }[m
[31m-[m
[31m-   BatchInfo *batches_;[m
[31m-   BatchInfo *currentBatch_;[m
[31m-   /// Head of a single linked list within the allocated space of freeed object[m
[31m-   AllocatedType *freeHead_;[m
[31m-   unsigned int objectsPerPage_;[m
[31m-};[m
[31m-[m
[31m-[m
[31m-} // namespace Json[m
[31m-[m
[31m-# endif // ifndef JSONCPP_DOC_INCLUDE_IMPLEMENTATION[m
[31m-[m
[31m-#endif // JSONCPP_BATCHALLOCATOR_H_INCLUDED[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_internalarray.inl b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_internalarray.inl[m
[1mdeleted file mode 100755[m
[1mindex 9b985d2..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_internalarray.inl[m
[1m+++ /dev/null[m
[36m@@ -1,448 +0,0 @@[m
[31m-// included by json_value.cpp[m
[31m-// everything is within Json namespace[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class ValueInternalArray[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-ValueArrayAllocator::~ValueArrayAllocator()[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class DefaultValueArrayAllocator[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-#ifdef JSON_USE_SIMPLE_INTERNAL_ALLOCATOR[m
[31m-class DefaultValueArrayAllocator : public ValueArrayAllocator[m
[31m-{[m
[31m-public: // overridden from ValueArrayAllocator[m
[31m-   virtual ~DefaultValueArrayAllocator()[m
[31m-   {[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalArray *newArray()[m
[31m-   {[m
[31m-      return new ValueInternalArray();[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalArray *newArrayCopy( const ValueInternalArray &other )[m
[31m-   {[m
[31m-      return new ValueInternalArray( other );[m
[31m-   }[m
[31m-[m
[31m-   virtual void destructArray( ValueInternalArray *array )[m
[31m-   {[m
[31m-      delete array;[m
[31m-   }[m
[31m-[m
[31m-   virtual void reallocateArrayPageIndex( Value **&indexes, [m
[31m-                                          ValueInternalArray::PageIndex &indexCount,[m
[31m-                                          ValueInternalArray::PageIndex minNewIndexCount )[m
[31m-   {[m
[31m-      ValueInternalArray::PageIndex newIndexCount = (indexCount*3)/2 + 1;[m
[31m-      if ( minNewIndexCount > newIndexCount )[m
[31m-         newIndexCount = minNewIndexCount;[m
[31m-      void *newIndexes = realloc( indexes, sizeof(Value*) * newIndexCount );[m
[31m-      if ( !newIndexes )[m
[31m-         throw std::bad_alloc();[m
[31m-      indexCount = newIndexCount;[m
[31m-      indexes = static_cast<Value **>( newIndexes );[m
[31m-   }[m
[31m-   virtual void releaseArrayPageIndex( Value **indexes, [m
[31m-                                       ValueInternalArray::PageIndex indexCount )[m
[31m-   {[m
[31m-      if ( indexes )[m
[31m-         free( indexes );[m
[31m-   }[m
[31m-[m
[31m-   virtual Value *allocateArrayPage()[m
[31m-   {[m
[31m-      return static_cast<Value *>( malloc( sizeof(Value) * ValueInternalArray::itemsPerPage ) );[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseArrayPage( Value *value )[m
[31m-   {[m
[31m-      if ( value )[m
[31m-         free( value );[m
[31m-   }[m
[31m-};[m
[31m-[m
[31m-#else // #ifdef JSON_USE_SIMPLE_INTERNAL_ALLOCATOR[m
[31m-/// @todo make this thread-safe (lock when accessign batch allocator)[m
[31m-class DefaultValueArrayAllocator : public ValueArrayAllocator[m
[31m-{[m
[31m-public: // overridden from ValueArrayAllocator[m
[31m-   virtual ~DefaultValueArrayAllocator()[m
[31m-   {[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalArray *newArray()[m
[31m-   {[m
[31m-      ValueInternalArray *array = arraysAllocator_.allocate();[m
[31m-      new (array) ValueInternalArray(); // placement new[m
[31m-      return array;[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalArray *newArrayCopy( const ValueInternalArray &other )[m
[31m-   {[m
[31m-      ValueInternalArray *array = arraysAllocator_.allocate();[m
[31m-      new (array) ValueInternalArray( other ); // placement new[m
[31m-      return array;[m
[31m-   }[m
[31m-[m
[31m-   virtual void destructArray( ValueInternalArray *array )[m
[31m-   {[m
[31m-      if ( array )[m
[31m-      {[m
[31m-         array->~ValueInternalArray();[m
[31m-         arraysAllocator_.release( array );[m
[31m-      }[m
[31m-   }[m
[31m-[m
[31m-   virtual void reallocateArrayPageIndex( Value **&indexes, [m
[31m-                                          ValueInternalArray::PageIndex &indexCount,[m
[31m-                                          ValueInternalArray::PageIndex minNewIndexCount )[m
[31m-   {[m
[31m-      ValueInternalArray::PageIndex newIndexCount = (indexCount*3)/2 + 1;[m
[31m-      if ( minNewIndexCount > newIndexCount )[m
[31m-         newIndexCount = minNewIndexCount;[m
[31m-      void *newIndexes = realloc( indexes, sizeof(Value*) * newIndexCount );[m
[31m-      if ( !newIndexes )[m
[31m-         throw std::bad_alloc();[m
[31m-      indexCount = newIndexCount;[m
[31m-      indexes = static_cast<Value **>( newIndexes );[m
[31m-   }[m
[31m-   virtual void releaseArrayPageIndex( Value **indexes, [m
[31m-                                       ValueInternalArray::PageIndex indexCount )[m
[31m-   {[m
[31m-      if ( indexes )[m
[31m-         free( indexes );[m
[31m-   }[m
[31m-[m
[31m-   virtual Value *allocateArrayPage()[m
[31m-   {[m
[31m-      return static_cast<Value *>( pagesAllocator_.allocate() );[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseArrayPage( Value *value )[m
[31m-   {[m
[31m-      if ( value )[m
[31m-         pagesAllocator_.release( value );[m
[31m-   }[m
[31m-private:[m
[31m-   BatchAllocator<ValueInternalArray,1> arraysAllocator_;[m
[31m-   BatchAllocator<Value,ValueInternalArray::itemsPerPage> pagesAllocator_;[m
[31m-};[m
[31m-#endif // #ifdef JSON_USE_SIMPLE_INTERNAL_ALLOCATOR[m
[31m-[m
[31m-static ValueArrayAllocator *&arrayAllocator()[m
[31m-{[m
[31m-   static DefaultValueArrayAllocator defaultAllocator;[m
[31m-   static ValueArrayAllocator *arrayAllocator = &defaultAllocator;[m
[31m-   return arrayAllocator;[m
[31m-}[m
[31m-[m
[31m-static struct DummyArrayAllocatorInitializer {[m
[31m-   DummyArrayAllocatorInitializer() [m
[31m-   {[m
[31m-      arrayAllocator();      // ensure arrayAllocator() statics are initialized before main().[m
[31m-   }[m
[31m-} dummyArrayAllocatorInitializer;[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class ValueInternalArray[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-bool [m
[31m-ValueInternalArray::equals( const IteratorState &x, [m
[31m-                            const IteratorState &other )[m
[31m-{[m
[31m-   return x.array_ == other.array_  [m
[31m-          &&  x.currentItemIndex_ == other.currentItemIndex_  [m
[31m-          &&  x.currentPageIndex_ == other.currentPageIndex_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::increment( IteratorState &it )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( it.array_  &&[m
[31m-      (it.currentPageIndex_ - it.array_->pages_)*itemsPerPage + it.currentItemIndex_[m
[31m-      != it.array_->size_,[m
[31m-      "ValueInternalArray::increment(): moving iterator beyond end" );[m
[31m-   ++(it.currentItemIndex_);[m
[31m-   if ( it.currentItemIndex_ == itemsPerPage )[m
[31m-   {[m
[31m-      it.currentItemIndex_ = 0;[m
[31m-      ++(it.currentPageIndex_);[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::decrement( IteratorState &it )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( it.array_  &&  it.currentPageIndex_ == it.array_->pages_ [m
[31m-                        &&  it.currentItemIndex_ == 0,[m
[31m-      "ValueInternalArray::decrement(): moving iterator beyond end" );[m
[31m-   if ( it.currentItemIndex_ == 0 )[m
[31m-   {[m
[31m-      it.currentItemIndex_ = itemsPerPage-1;[m
[31m-      --(it.currentPageIndex_);[m
[31m-   }[m
[31m-   else[m
[31m-   {[m
[31m-      --(it.currentItemIndex_);[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalArray::unsafeDereference( const IteratorState &it )[m
[31m-{[m
[31m-   return (*(it.currentPageIndex_))[it.currentItemIndex_];[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalArray::dereference( const IteratorState &it )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( it.array_  &&[m
[31m-      (it.currentPageIndex_ - it.array_->pages_)*itemsPerPage + it.currentItemIndex_[m
[31m-      < it.array_->size_,[m
[31m-      "ValueInternalArray::dereference(): dereferencing invalid iterator" );[m
[31m-   return unsafeDereference( it );[m
[31m-}[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::makeBeginIterator( IteratorState &it ) const[m
[31m-{[m
[31m-   it.array_ = const_cast<ValueInternalArray *>( this );[m
[31m-   it.currentItemIndex_ = 0;[m
[31m-   it.currentPageIndex_ = pages_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::makeIterator( IteratorState &it, ArrayIndex index ) const[m
[31m-{[m
[31m-   it.array_ = const_cast<ValueInternalArray *>( this );[m
[31m-   it.currentItemIndex_ = index % itemsPerPage;[m
[31m-   it.currentPageIndex_ = pages_ + index / itemsPerPage;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::makeEndIterator( IteratorState &it ) const[m
[31m-{[m
[31m-   makeIterator( it, size_ );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalArray::ValueInternalArray()[m
[31m-   : pages_( 0 )[m
[31m-   , size_( 0 )[m
[31m-   , pageCount_( 0 )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalArray::ValueInternalArray( const ValueInternalArray &other )[m
[31m-   : pages_( 0 )[m
[31m-   , pageCount_( 0 )[m
[31m-   , size_( other.size_ )[m
[31m-{[m
[31m-   PageIndex minNewPages = other.size_ / itemsPerPage;[m
[31m-   arrayAllocator()->reallocateArrayPageIndex( pages_, pageCount_, minNewPages );[m
[31m-   JSON_ASSERT_MESSAGE( pageCount_ >= minNewPages, [m
[31m-                        "ValueInternalArray::reserve(): bad reallocation" );[m
[31m-   IteratorState itOther;[m
[31m-   other.makeBeginIterator( itOther );[m
[31m-   Value *value;[m
[31m-   for ( ArrayIndex index = 0; index < size_; ++index, increment(itOther) )[m
[31m-   {[m
[31m-      if ( index % itemsPerPage == 0 )[m
[31m-      {[m
[31m-         PageIndex pageIndex = index / itemsPerPage;[m
[31m-         value = arrayAllocator()->allocateArrayPage();[m
[31m-         pages_[pageIndex] = value;[m
[31m-      }[m
[31m-      new (value) Value( dereference( itOther ) );[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalArray &[m
[31m-ValueInternalArray::operator =( const ValueInternalArray &other )[m
[31m-{[m
[31m-   ValueInternalArray temp( other );[m
[31m-   swap( temp );[m
[31m-   return *this;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalArray::~ValueInternalArray()[m
[31m-{[m
[31m-   // destroy all constructed items[m
[31m-   IteratorState it;[m
[31m-   IteratorState itEnd;[m
[31m-   makeBeginIterator( it);[m
[31m-   makeEndIterator( itEnd );[m
[31m-   for ( ; !equals(it,itEnd); increment(it) )[m
[31m-   {[m
[31m-      Value *value = &dereference(it);[m
[31m-      value->~Value();[m
[31m-   }[m
[31m-   // release all pages[m
[31m-   PageIndex lastPageIndex = size_ / itemsPerPage;[m
[31m-   for ( PageIndex pageIndex = 0; pageIndex < lastPageIndex; ++pageIndex )[m
[31m-      arrayAllocator()->releaseArrayPage( pages_[pageIndex] );[m
[31m-   // release pages index[m
[31m-   arrayAllocator()->releaseArrayPageIndex( pages_, pageCount_ );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::swap( ValueInternalArray &other )[m
[31m-{[m
[31m-   Value **tempPages = pages_;[m
[31m-   pages_ = other.pages_;[m
[31m-   other.pages_ = tempPages;[m
[31m-   ArrayIndex tempSize = size_;[m
[31m-   size_ = other.size_;[m
[31m-   other.size_ = tempSize;[m
[31m-   PageIndex tempPageCount = pageCount_;[m
[31m-   pageCount_ = other.pageCount_;[m
[31m-   other.pageCount_ = tempPageCount;[m
[31m-}[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::clear()[m
[31m-{[m
[31m-   ValueInternalArray dummy;[m
[31m-   swap( dummy );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::resize( ArrayIndex newSize )[m
[31m-{[m
[31m-   if ( newSize == 0 )[m
[31m-      clear();[m
[31m-   else if ( newSize < size_ )[m
[31m-   {[m
[31m-      IteratorState it;[m
[31m-      IteratorState itEnd;[m
[31m-      makeIterator( it, newSize );[m
[31m-      makeIterator( itEnd, size_ );[m
[31m-      for ( ; !equals(it,itEnd); increment(it) )[m
[31m-      {[m
[31m-         Value *value = &dereference(it);[m
[31m-         value->~Value();[m
[31m-      }[m
[31m-      PageIndex pageIndex = (newSize + itemsPerPage - 1) / itemsPerPage;[m
[31m-      PageIndex lastPageIndex = size_ / itemsPerPage;[m
[31m-      for ( ; pageIndex < lastPageIndex; ++pageIndex )[m
[31m-         arrayAllocator()->releaseArrayPage( pages_[pageIndex] );[m
[31m-      size_ = newSize;[m
[31m-   }[m
[31m-   else if ( newSize > size_ )[m
[31m-      resolveReference( newSize );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalArray::makeIndexValid( ArrayIndex index )[m
[31m-{[m
[31m-   // Need to enlarge page index ?[m
[31m-   if ( index >= pageCount_ * itemsPerPage )[m
[31m-   {[m
[31m-      PageIndex minNewPages = (index + 1) / itemsPerPage;[m
[31m-      arrayAllocator()->reallocateArrayPageIndex( pages_, pageCount_, minNewPages );[m
[31m-      JSON_ASSERT_MESSAGE( pageCount_ >= minNewPages, "ValueInternalArray::reserve(): bad reallocation" );[m
[31m-   }[m
[31m-[m
[31m-   // Need to allocate new pages ?[m
[31m-   ArrayIndex nextPageIndex = [m
[31m-      (size_ % itemsPerPage) != 0 ? size_ - (size_%itemsPerPage) + itemsPerPage[m
[31m-                                  : size_;[m
[31m-   if ( nextPageIndex <= index )[m
[31m-   {[m
[31m-      PageIndex pageIndex = nextPageIndex / itemsPerPage;[m
[31m-      PageIndex pageToAllocate = (index - nextPageIndex) / itemsPerPage + 1;[m
[31m-      for ( ; pageToAllocate-- > 0; ++pageIndex )[m
[31m-         pages_[pageIndex] = arrayAllocator()->allocateArrayPage();[m
[31m-   }[m
[31m-[m
[31m-   // Initialize all new entries[m
[31m-   IteratorState it;[m
[31m-   IteratorState itEnd;[m
[31m-   makeIterator( it, size_ );[m
[31m-   size_ = index + 1;[m
[31m-   makeIterator( itEnd, size_ );[m
[31m-   for ( ; !equals(it,itEnd); increment(it) )[m
[31m-   {[m
[31m-      Value *value = &dereference(it);[m
[31m-      new (value) Value(); // Construct a default value using placement new[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalArray::resolveReference( ArrayIndex index )[m
[31m-{[m
[31m-   if ( index >= size_ )[m
[31m-      makeIndexValid( index );[m
[31m-   return pages_[index/itemsPerPage][index%itemsPerPage];[m
[31m-}[m
[31m-[m
[31m-Value *[m
[31m-ValueInternalArray::find( ArrayIndex index ) const[m
[31m-{[m
[31m-   if ( index >= size_ )[m
[31m-      return 0;[m
[31m-   return &(pages_[index/itemsPerPage][index%itemsPerPage]);[m
[31m-}[m
[31m-[m
[31m-ValueInternalArray::ArrayIndex [m
[31m-ValueInternalArray::size() const[m
[31m-{[m
[31m-   return size_;[m
[31m-}[m
[31m-[m
[31m-int [m
[31m-ValueInternalArray::distance( const IteratorState &x, const IteratorState &y )[m
[31m-{[m
[31m-   return indexOf(y) - indexOf(x);[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalArray::ArrayIndex [m
[31m-ValueInternalArray::indexOf( const IteratorState &iterator )[m
[31m-{[m
[31m-   if ( !iterator.array_ )[m
[31m-      return ArrayIndex(-1);[m
[31m-   return ArrayIndex([m
[31m-      (iterator.currentPageIndex_ - iterator.array_->pages_) * itemsPerPage [m
[31m-      + iterator.currentItemIndex_ );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-int [m
[31m-ValueInternalArray::compare( const ValueInternalArray &other ) const[m
[31m-{[m
[31m-   int sizeDiff( size_ - other.size_ );[m
[31m-   if ( sizeDiff != 0 )[m
[31m-      return sizeDiff;[m
[31m-   [m
[31m-   for ( ArrayIndex index =0; index < size_; ++index )[m
[31m-   {[m
[31m-      int diff = pages_[index/itemsPerPage][index%itemsPerPage].compare( [m
[31m-         other.pages_[index/itemsPerPage][index%itemsPerPage] );[m
[31m-      if ( diff != 0 )[m
[31m-         return diff;[m
[31m-   }[m
[31m-   return 0;[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_internalmap.inl b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_internalmap.inl[m
[1mdeleted file mode 100755[m
[1mindex 1977148..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_internalmap.inl[m
[1m+++ /dev/null[m
[36m@@ -1,607 +0,0 @@[m
[31m-// included by json_value.cpp[m
[31m-// everything is within Json namespace[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class ValueInternalMap[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-/** \internal MUST be safely initialized using memset( this, 0, sizeof(ValueInternalLink) );[m
[31m-   * This optimization is used by the fast allocator.[m
[31m-   */[m
[31m-ValueInternalLink::ValueInternalLink()[m
[31m-   : previous_( 0 )[m
[31m-   , next_( 0 )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-ValueInternalLink::~ValueInternalLink()[m
[31m-{ [m
[31m-   for ( int index =0; index < itemPerLink; ++index )[m
[31m-   {[m
[31m-      if ( !items_[index].isItemAvailable() )[m
[31m-      {[m
[31m-         if ( !items_[index].isMemberNameStatic() )[m
[31m-            free( keys_[index] );[m
[31m-      }[m
[31m-      else[m
[31m-         break;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-[m
[31m-ValueMapAllocator::~ValueMapAllocator()[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-#ifdef JSON_USE_SIMPLE_INTERNAL_ALLOCATOR[m
[31m-class DefaultValueMapAllocator : public ValueMapAllocator[m
[31m-{[m
[31m-public: // overridden from ValueMapAllocator[m
[31m-   virtual ValueInternalMap *newMap()[m
[31m-   {[m
[31m-      return new ValueInternalMap();[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalMap *newMapCopy( const ValueInternalMap &other )[m
[31m-   {[m
[31m-      return new ValueInternalMap( other );[m
[31m-   }[m
[31m-[m
[31m-   virtual void destructMap( ValueInternalMap *map )[m
[31m-   {[m
[31m-      delete map;[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalLink *allocateMapBuckets( unsigned int size )[m
[31m-   {[m
[31m-      return new ValueInternalLink[size];[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseMapBuckets( ValueInternalLink *links )[m
[31m-   {[m
[31m-      delete [] links;[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalLink *allocateMapLink()[m
[31m-   {[m
[31m-      return new ValueInternalLink();[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseMapLink( ValueInternalLink *link )[m
[31m-   {[m
[31m-      delete link;[m
[31m-   }[m
[31m-};[m
[31m-#else[m
[31m-/// @todo make this thread-safe (lock when accessign batch allocator)[m
[31m-class DefaultValueMapAllocator : public ValueMapAllocator[m
[31m-{[m
[31m-public: // overridden from ValueMapAllocator[m
[31m-   virtual ValueInternalMap *newMap()[m
[31m-   {[m
[31m-      ValueInternalMap *map = mapsAllocator_.allocate();[m
[31m-      new (map) ValueInternalMap(); // placement new[m
[31m-      return map;[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalMap *newMapCopy( const ValueInternalMap &other )[m
[31m-   {[m
[31m-      ValueInternalMap *map = mapsAllocator_.allocate();[m
[31m-      new (map) ValueInternalMap( other ); // placement new[m
[31m-      return map;[m
[31m-   }[m
[31m-[m
[31m-   virtual void destructMap( ValueInternalMap *map )[m
[31m-   {[m
[31m-      if ( map )[m
[31m-      {[m
[31m-         map->~ValueInternalMap();[m
[31m-         mapsAllocator_.release( map );[m
[31m-      }[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalLink *allocateMapBuckets( unsigned int size )[m
[31m-   {[m
[31m-      return new ValueInternalLink[size];[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseMapBuckets( ValueInternalLink *links )[m
[31m-   {[m
[31m-      delete [] links;[m
[31m-   }[m
[31m-[m
[31m-   virtual ValueInternalLink *allocateMapLink()[m
[31m-   {[m
[31m-      ValueInternalLink *link = linksAllocator_.allocate();[m
[31m-      memset( link, 0, sizeof(ValueInternalLink) );[m
[31m-      return link;[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseMapLink( ValueInternalLink *link )[m
[31m-   {[m
[31m-      link->~ValueInternalLink();[m
[31m-      linksAllocator_.release( link );[m
[31m-   }[m
[31m-private:[m
[31m-   BatchAllocator<ValueInternalMap,1> mapsAllocator_;[m
[31m-   BatchAllocator<ValueInternalLink,1> linksAllocator_;[m
[31m-};[m
[31m-#endif[m
[31m-[m
[31m-static ValueMapAllocator *&mapAllocator()[m
[31m-{[m
[31m-   static DefaultValueMapAllocator defaultAllocator;[m
[31m-   static ValueMapAllocator *mapAllocator = &defaultAllocator;[m
[31m-   return mapAllocator;[m
[31m-}[m
[31m-[m
[31m-static struct DummyMapAllocatorInitializer {[m
[31m-   DummyMapAllocatorInitializer() [m
[31m-   {[m
[31m-      mapAllocator();      // ensure mapAllocator() statics are initialized before main().[m
[31m-   }[m
[31m-} dummyMapAllocatorInitializer;[m
[31m-[m
[31m-[m
[31m-[m
[31m-// h(K) = value * K >> w ; with w = 32 & K prime w.r.t. 2^32.[m
[31m-[m
[31m-/*[m
[31m-use linked list hash map. [m
[31m-buckets array is a container.[m
[31m-linked list element contains 6 key/values. (memory = (16+4) * 6 + 4 = 124)[m
[31m-value have extra state: valid, available, deleted[m
[31m-*/[m
[31m-[m
[31m-[m
[31m-ValueInternalMap::ValueInternalMap()[m
[31m-   : buckets_( 0 )[m
[31m-   , tailLink_( 0 )[m
[31m-   , bucketsSize_( 0 )[m
[31m-   , itemCount_( 0 )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalMap::ValueInternalMap( const ValueInternalMap &other )[m
[31m-   : buckets_( 0 )[m
[31m-   , tailLink_( 0 )[m
[31m-   , bucketsSize_( 0 )[m
[31m-   , itemCount_( 0 )[m
[31m-{[m
[31m-   reserve( other.itemCount_ );[m
[31m-   IteratorState it;[m
[31m-   IteratorState itEnd;[m
[31m-   other.makeBeginIterator( it );[m
[31m-   other.makeEndIterator( itEnd );[m
[31m-   for ( ; !equals(it,itEnd); increment(it) )[m
[31m-   {[m
[31m-      bool isStatic;[m
[31m-      const char *memberName = key( it, isStatic );[m
[31m-      const Value &aValue = value( it );[m
[31m-      resolveReference(memberName, isStatic) = aValue;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalMap &[m
[31m-ValueInternalMap::operator =( const ValueInternalMap &other )[m
[31m-{[m
[31m-   ValueInternalMap dummy( other );[m
[31m-   swap( dummy );[m
[31m-   return *this;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalMap::~ValueInternalMap()[m
[31m-{[m
[31m-   if ( buckets_ )[m
[31m-   {[m
[31m-      for ( BucketIndex bucketIndex =0; bucketIndex < bucketsSize_; ++bucketIndex )[m
[31m-      {[m
[31m-         ValueInternalLink *link = buckets_[bucketIndex].next_;[m
[31m-         while ( link )[m
[31m-         {[m
[31m-            ValueInternalLink *linkToRelease = link;[m
[31m-            link = link->next_;[m
[31m-            mapAllocator()->releaseMapLink( linkToRelease );[m
[31m-         }[m
[31m-      }[m
[31m-      mapAllocator()->releaseMapBuckets( buckets_ );[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::swap( ValueInternalMap &other )[m
[31m-{[m
[31m-   ValueInternalLink *tempBuckets = buckets_;[m
[31m-   buckets_ = other.buckets_;[m
[31m-   other.buckets_ = tempBuckets;[m
[31m-   ValueInternalLink *tempTailLink = tailLink_;[m
[31m-   tailLink_ = other.tailLink_;[m
[31m-   other.tailLink_ = tempTailLink;[m
[31m-   BucketIndex tempBucketsSize = bucketsSize_;[m
[31m-   bucketsSize_ = other.bucketsSize_;[m
[31m-   other.bucketsSize_ = tempBucketsSize;[m
[31m-   BucketIndex tempItemCount = itemCount_;[m
[31m-   itemCount_ = other.itemCount_;[m
[31m-   other.itemCount_ = tempItemCount;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::clear()[m
[31m-{[m
[31m-   ValueInternalMap dummy;[m
[31m-   swap( dummy );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalMap::BucketIndex [m
[31m-ValueInternalMap::size() const[m
[31m-{[m
[31m-   return itemCount_;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-ValueInternalMap::reserveDelta( BucketIndex growth )[m
[31m-{[m
[31m-   return reserve( itemCount_ + growth );[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-ValueInternalMap::reserve( BucketIndex newItemCount )[m
[31m-{[m
[31m-   if ( !buckets_  &&  newItemCount > 0 )[m
[31m-   {[m
[31m-      buckets_ = mapAllocator()->allocateMapBuckets( 1 );[m
[31m-      bucketsSize_ = 1;[m
[31m-      tailLink_ = &buckets_[0];[m
[31m-   }[m
[31m-//   BucketIndex idealBucketCount = (newItemCount + ValueInternalLink::itemPerLink) / ValueInternalLink::itemPerLink;[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const Value *[m
[31m-ValueInternalMap::find( const char *key ) const[m
[31m-{[m
[31m-   if ( !bucketsSize_ )[m
[31m-      return 0;[m
[31m-   HashKey hashedKey = hash( key );[m
[31m-   BucketIndex bucketIndex = hashedKey % bucketsSize_;[m
[31m-   for ( const ValueInternalLink *current = &buckets_[bucketIndex]; [m
[31m-         current != 0; [m
[31m-         current = current->next_ )[m
[31m-   {[m
[31m-      for ( BucketIndex index=0; index < ValueInternalLink::itemPerLink; ++index )[m
[31m-      {[m
[31m-         if ( current->items_[index].isItemAvailable() )[m
[31m-            return 0;[m
[31m-         if ( strcmp( key, current->keys_[index] ) == 0 )[m
[31m-            return &current->items_[index];[m
[31m-      }[m
[31m-   }[m
[31m-   return 0;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value *[m
[31m-ValueInternalMap::find( const char *key )[m
[31m-{[m
[31m-   const ValueInternalMap *constThis = this;[m
[31m-   return const_cast<Value *>( constThis->find( key ) );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalMap::resolveReference( const char *key,[m
[31m-                                    bool isStatic )[m
[31m-{[m
[31m-   HashKey hashedKey = hash( key );[m
[31m-   if ( bucketsSize_ )[m
[31m-   {[m
[31m-      BucketIndex bucketIndex = hashedKey % bucketsSize_;[m
[31m-      ValueInternalLink **previous = 0;[m
[31m-      BucketIndex index;[m
[31m-      for ( ValueInternalLink *current = &buckets_[bucketIndex]; [m
[31m-            current != 0; [m
[31m-            previous = &current->next_, current = current->next_ )[m
[31m-      {[m
[31m-         for ( index=0; index < ValueInternalLink::itemPerLink; ++index )[m
[31m-         {[m
[31m-            if ( current->items_[index].isItemAvailable() )[m
[31m-               return setNewItem( key, isStatic, current, index );[m
[31m-            if ( strcmp( key, current->keys_[index] ) == 0 )[m
[31m-               return current->items_[index];[m
[31m-         }[m
[31m-      }[m
[31m-   }[m
[31m-[m
[31m-   reserveDelta( 1 );[m
[31m-   return unsafeAdd( key, isStatic, hashedKey );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::remove( const char *key )[m
[31m-{[m
[31m-   HashKey hashedKey = hash( key );[m
[31m-   if ( !bucketsSize_ )[m
[31m-      return;[m
[31m-   BucketIndex bucketIndex = hashedKey % bucketsSize_;[m
[31m-   for ( ValueInternalLink *link = &buckets_[bucketIndex]; [m
[31m-         link != 0; [m
[31m-         link = link->next_ )[m
[31m-   {[m
[31m-      BucketIndex index;[m
[31m-      for ( index =0; index < ValueInternalLink::itemPerLink; ++index )[m
[31m-      {[m
[31m-         if ( link->items_[index].isItemAvailable() )[m
[31m-            return;[m
[31m-         if ( strcmp( key, link->keys_[index] ) == 0 )[m
[31m-         {[m
[31m-            doActualRemove( link, index, bucketIndex );[m
[31m-            return;[m
[31m-         }[m
[31m-      }[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::doActualRemove( ValueInternalLink *link, [m
[31m-                                  BucketIndex index,[m
[31m-                                  BucketIndex bucketIndex )[m
[31m-{[m
[31m-   // find last item of the bucket and swap it with the 'removed' one.[m
[31m-   // set removed items flags to 'available'.[m
[31m-   // if last page only contains 'available' items, then desallocate it (it's empty)[m
[31m-   ValueInternalLink *&lastLink = getLastLinkInBucket( index );[m
[31m-   BucketIndex lastItemIndex = 1; // a link can never be empty, so start at 1[m
[31m-   for ( ;   [m
[31m-         lastItemIndex < ValueInternalLink::itemPerLink; [m
[31m-         ++lastItemIndex ) // may be optimized with dicotomic search[m
[31m-   {[m
[31m-      if ( lastLink->items_[lastItemIndex].isItemAvailable() )[m
[31m-         break;[m
[31m-   }[m
[31m-   [m
[31m-   BucketIndex lastUsedIndex = lastItemIndex - 1;[m
[31m-   Value *valueToDelete = &link->items_[index];[m
[31m-   Value *valueToPreserve = &lastLink->items_[lastUsedIndex];[m
[31m-   if ( valueToDelete != valueToPreserve )[m
[31m-      valueToDelete->swap( *valueToPreserve );[m
[31m-   if ( lastUsedIndex == 0 )  // page is now empty[m
[31m-   {  // remove it from bucket linked list and delete it.[m
[31m-      ValueInternalLink *linkPreviousToLast = lastLink->previous_;[m
[31m-      if ( linkPreviousToLast != 0 )   // can not deleted bucket link.[m
[31m-      {[m
[31m-         mapAllocator()->releaseMapLink( lastLink );[m
[31m-         linkPreviousToLast->next_ = 0;[m
[31m-         lastLink = linkPreviousToLast;[m
[31m-      }[m
[31m-   }[m
[31m-   else[m
[31m-   {[m
[31m-      Value dummy;[m
[31m-      valueToPreserve->swap( dummy ); // restore deleted to default Value.[m
[31m-      valueToPreserve->setItemUsed( false );[m
[31m-   }[m
[31m-   --itemCount_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalLink *&[m
[31m-ValueInternalMap::getLastLinkInBucket( BucketIndex bucketIndex )[m
[31m-{[m
[31m-   if ( bucketIndex == bucketsSize_ - 1 )[m
[31m-      return tailLink_;[m
[31m-   ValueInternalLink *&previous = buckets_[bucketIndex+1].previous_;[m
[31m-   if ( !previous )[m
[31m-      previous = &buckets_[bucketIndex];[m
[31m-   return previous;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalMap::setNewItem( const char *key, [m
[31m-                              bool isStatic,[m
[31m-                              ValueInternalLink *link, [m
[31m-                              BucketIndex index )[m
[31m-{[m
[31m-   char *duplicatedKey = valueAllocator()->makeMemberName( key );[m
[31m-   ++itemCount_;[m
[31m-   link->keys_[index] = duplicatedKey;[m
[31m-   link->items_[index].setItemUsed();[m
[31m-   link->items_[index].setMemberNameIsStatic( isStatic );[m
[31m-   return link->items_[index]; // items already default constructed.[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalMap::unsafeAdd( const char *key, [m
[31m-                             bool isStatic, [m
[31m-                             HashKey hashedKey )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( bucketsSize_ > 0, "ValueInternalMap::unsafeAdd(): internal logic error." );[m
[31m-   BucketIndex bucketIndex = hashedKey % bucketsSize_;[m
[31m-   ValueInternalLink *&previousLink = getLastLinkInBucket( bucketIndex );[m
[31m-   ValueInternalLink *link = previousLink;[m
[31m-   BucketIndex index;[m
[31m-   for ( index =0; index < ValueInternalLink::itemPerLink; ++index )[m
[31m-   {[m
[31m-      if ( link->items_[index].isItemAvailable() )[m
[31m-         break;[m
[31m-   }[m
[31m-   if ( index == ValueInternalLink::itemPerLink ) // need to add a new page[m
[31m-   {[m
[31m-      ValueInternalLink *newLink = mapAllocator()->allocateMapLink();[m
[31m-      index = 0;[m
[31m-      link->next_ = newLink;[m
[31m-      previousLink = newLink;[m
[31m-      link = newLink;[m
[31m-   }[m
[31m-   return setNewItem( key, isStatic, link, index );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueInternalMap::HashKey [m
[31m-ValueInternalMap::hash( const char *key ) const[m
[31m-{[m
[31m-   HashKey hash = 0;[m
[31m-   while ( *key )[m
[31m-      hash += *key++ * 37;[m
[31m-   return hash;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-int [m
[31m-ValueInternalMap::compare( const ValueInternalMap &other ) const[m
[31m-{[m
[31m-   int sizeDiff( itemCount_ - other.itemCount_ );[m
[31m-   if ( sizeDiff != 0 )[m
[31m-      return sizeDiff;[m
[31m-   // Strict order guaranty is required. Compare all keys FIRST, then compare values.[m
[31m-   IteratorState it;[m
[31m-   IteratorState itEnd;[m
[31m-   makeBeginIterator( it );[m
[31m-   makeEndIterator( itEnd );[m
[31m-   for ( ; !equals(it,itEnd); increment(it) )[m
[31m-   {[m
[31m-      if ( !other.find( key( it ) ) )[m
[31m-         return 1;[m
[31m-   }[m
[31m-[m
[31m-   // All keys are equals, let's compare values[m
[31m-   makeBeginIterator( it );[m
[31m-   for ( ; !equals(it,itEnd); increment(it) )[m
[31m-   {[m
[31m-      const Value *otherValue = other.find( key( it ) );[m
[31m-      int valueDiff = value(it).compare( *otherValue );[m
[31m-      if ( valueDiff != 0 )[m
[31m-         return valueDiff;[m
[31m-   }[m
[31m-   return 0;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::makeBeginIterator( IteratorState &it ) const[m
[31m-{[m
[31m-   it.map_ = const_cast<ValueInternalMap *>( this );[m
[31m-   it.bucketIndex_ = 0;[m
[31m-   it.itemIndex_ = 0;[m
[31m-   it.link_ = buckets_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::makeEndIterator( IteratorState &it ) const[m
[31m-{[m
[31m-   it.map_ = const_cast<ValueInternalMap *>( this );[m
[31m-   it.bucketIndex_ = bucketsSize_;[m
[31m-   it.itemIndex_ = 0;[m
[31m-   it.link_ = 0;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-ValueInternalMap::equals( const IteratorState &x, const IteratorState &other )[m
[31m-{[m
[31m-   return x.map_ == other.map_  [m
[31m-          &&  x.bucketIndex_ == other.bucketIndex_  [m
[31m-          &&  x.link_ == other.link_[m
[31m-          &&  x.itemIndex_ == other.itemIndex_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::incrementBucket( IteratorState &iterator )[m
[31m-{[m
[31m-   ++iterator.bucketIndex_;[m
[31m-   JSON_ASSERT_MESSAGE( iterator.bucketIndex_ <= iterator.map_->bucketsSize_,[m
[31m-      "ValueInternalMap::increment(): attempting to iterate beyond end." );[m
[31m-   if ( iterator.bucketIndex_ == iterator.map_->bucketsSize_ )[m
[31m-      iterator.link_ = 0;[m
[31m-   else[m
[31m-      iterator.link_ = &(iterator.map_->buckets_[iterator.bucketIndex_]);[m
[31m-   iterator.itemIndex_ = 0;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::increment( IteratorState &iterator )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( iterator.map_, "Attempting to iterator using invalid iterator." );[m
[31m-   ++iterator.itemIndex_;[m
[31m-   if ( iterator.itemIndex_ == ValueInternalLink::itemPerLink )[m
[31m-   {[m
[31m-      JSON_ASSERT_MESSAGE( iterator.link_ != 0,[m
[31m-         "ValueInternalMap::increment(): attempting to iterate beyond end." );[m
[31m-      iterator.link_ = iterator.link_->next_;[m
[31m-      if ( iterator.link_ == 0 )[m
[31m-         incrementBucket( iterator );[m
[31m-   }[m
[31m-   else if ( iterator.link_->items_[iterator.itemIndex_].isItemAvailable() )[m
[31m-   {[m
[31m-      incrementBucket( iterator );[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueInternalMap::decrement( IteratorState &iterator )[m
[31m-{[m
[31m-   if ( iterator.itemIndex_ == 0 )[m
[31m-   {[m
[31m-      JSON_ASSERT_MESSAGE( iterator.map_, "Attempting to iterate using invalid iterator." );[m
[31m-      if ( iterator.link_ == &iterator.map_->buckets_[iterator.bucketIndex_] )[m
[31m-      {[m
[31m-         JSON_ASSERT_MESSAGE( iterator.bucketIndex_ > 0, "Attempting to iterate beyond beginning." );[m
[31m-         --(iterator.bucketIndex_);[m
[31m-      }[m
[31m-      iterator.link_ = iterator.link_->previous_;[m
[31m-      iterator.itemIndex_ = ValueInternalLink::itemPerLink - 1;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const char *[m
[31m-ValueInternalMap::key( const IteratorState &iterator )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( iterator.link_, "Attempting to iterate using invalid iterator." );[m
[31m-   return iterator.link_->keys_[iterator.itemIndex_];[m
[31m-}[m
[31m-[m
[31m-const char *[m
[31m-ValueInternalMap::key( const IteratorState &iterator, bool &isStatic )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( iterator.link_, "Attempting to iterate using invalid iterator." );[m
[31m-   isStatic = iterator.link_->items_[iterator.itemIndex_].isMemberNameStatic();[m
[31m-   return iterator.link_->keys_[iterator.itemIndex_];[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-ValueInternalMap::value( const IteratorState &iterator )[m
[31m-{[m
[31m-   JSON_ASSERT_MESSAGE( iterator.link_, "Attempting to iterate using invalid iterator." );[m
[31m-   return iterator.link_->items_[iterator.itemIndex_];[m
[31m-}[m
[31m-[m
[31m-[m
[31m-int [m
[31m-ValueInternalMap::distance( const IteratorState &x, const IteratorState &y )[m
[31m-{[m
[31m-   int offset = 0;[m
[31m-   IteratorState it = x;[m
[31m-   while ( !equals( it, y ) )[m
[31m-      increment( it );[m
[31m-   return offset;[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_reader.cpp b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_reader.cpp[m
[1mdeleted file mode 100755[m
[1mindex 5af16c8..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_reader.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,892 +0,0 @@[m
[31m-#include <json/reader.h>[m
[31m-#include <json/value.h>[m
[31m-#include <utility>[m
[31m-#include <cstdio>[m
[31m-#include <cassert>[m
[31m-#include <cstring>[m
[31m-#include <iostream>[m
[31m-#include <stdexcept>[m
[31m-[m
[31m-#if _MSC_VER >= 1400 // VC++ 8.0[m
[31m-#pragma warning( disable : 4996 )   // disable warning about strdup being deprecated.[m
[31m-#endif[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-// QNX is strict about declaring C symbols in the std namespace.[m
[31m-#ifdef __QNXNTO__[m
[31m-using std::memcpy;[m
[31m-using std::sprintf;[m
[31m-using std::sscanf;[m
[31m-#endif[m
[31m-[m
[31m-// Implementation of class Features[m
[31m-// ////////////////////////////////[m
[31m-[m
[31m-Features::Features()[m
[31m-   : allowComments_( true )[m
[31m-   , strictRoot_( false )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Features [m
[31m-Features::all()[m
[31m-{[m
[31m-   return Features();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Features [m
[31m-Features::strictMode()[m
[31m-{[m
[31m-   Features features;[m
[31m-   features.allowComments_ = false;[m
[31m-   features.strictRoot_ = true;[m
[31m-   return features;[m
[31m-}[m
[31m-[m
[31m-// Implementation of class Reader[m
[31m-// ////////////////////////////////[m
[31m-[m
[31m-[m
[31m-static inline bool [m
[31m-in( Reader::Char c, Reader::Char c1, Reader::Char c2, Reader::Char c3, Reader::Char c4 )[m
[31m-{[m
[31m-   return c == c1  ||  c == c2  ||  c == c3  ||  c == c4;[m
[31m-}[m
[31m-[m
[31m-static inline bool [m
[31m-in( Reader::Char c, Reader::Char c1, Reader::Char c2, Reader::Char c3, Reader::Char c4, Reader::Char c5 )[m
[31m-{[m
[31m-   return c == c1  ||  c == c2  ||  c == c3  ||  c == c4  ||  c == c5;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-static bool [m
[31m-containsNewLine( Reader::Location begin, [m
[31m-                 Reader::Location end )[m
[31m-{[m
[31m-   for ( ;begin < end; ++begin )[m
[31m-      if ( *begin == '\n'  ||  *begin == '\r' )[m
[31m-         return true;[m
[31m-   return false;[m
[31m-}[m
[31m-[m
[31m-static std::string codePointToUTF8(unsigned int cp)[m
[31m-{[m
[31m-   std::string result;[m
[31m-   [m
[31m-   // based on description from http://en.wikipedia.org/wiki/UTF-8[m
[31m-[m
[31m-   if (cp <= 0x7f) [m
[31m-   {[m
[31m-      result.resize(1);[m
[31m-      result[0] = static_cast<char>(cp);[m
[31m-   } [m
[31m-   else if (cp <= 0x7FF) [m
[31m-   {[m
[31m-      result.resize(2);[m
[31m-      result[1] = static_cast<char>(0x80 | (0x3f & cp));[m
[31m-      result[0] = static_cast<char>(0xC0 | (0x1f & (cp >> 6)));[m
[31m-   } [m
[31m-   else if (cp <= 0xFFFF) [m
[31m-   {[m
[31m-      result.resize(3);[m
[31m-      result[2] = static_cast<char>(0x80 | (0x3f & cp));[m
[31m-      result[1] = 0x80 | static_cast<char>((0x3f & (cp >> 6)));[m
[31m-      result[0] = 0xE0 | static_cast<char>((0xf & (cp >> 12)));[m
[31m-   }[m
[31m-   else if (cp <= 0x10FFFF) [m
[31m-   {[m
[31m-      result.resize(4);[m
[31m-      result[3] = static_cast<char>(0x80 | (0x3f & cp));[m
[31m-      result[2] = static_cast<char>(0x80 | (0x3f & (cp >> 6)));[m
[31m-      result[1] = static_cast<char>(0x80 | (0x3f & (cp >> 12)));[m
[31m-      result[0] = static_cast<char>(0xF0 | (0x7 & (cp >> 18)));[m
[31m-   }[m
[31m-[m
[31m-   return result;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// Class Reader[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-Reader::Reader()[m
[31m-   : features_( Features::all() )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Reader::Reader( const Features &features )[m
[31m-   : features_( features )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool[m
[31m-Reader::parse( const std::string &document, [m
[31m-               Value &root,[m
[31m-               bool collectComments )[m
[31m-{[m
[31m-   document_ = document;[m
[31m-   const char *begin = document_.c_str();[m
[31m-   const char *end = begin + document_.length();[m
[31m-   return parse( begin, end, root, collectComments );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool[m
[31m-Reader::parse( std::istream& sin,[m
[31m-               Value &root,[m
[31m-               bool collectComments )[m
[31m-{[m
[31m-   //std::istream_iterator<char> begin(sin);[m
[31m-   //std::istream_iterator<char> end;[m
[31m-   // Those would allow streamed input from a file, if parse() were a[m
[31m-   // template function.[m
[31m-[m
[31m-   // Since std::string is reference-counted, this at least does not[m
[31m-   // create an extra copy.[m
[31m-   std::string doc;[m
[31m-   std::getline(sin, doc, (char)EOF);[m
[31m-   return parse( doc, root, collectComments );[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Reader::parse( const char *beginDoc, const char *endDoc, [m
[31m-               Value &root,[m
[31m-               bool collectComments )[m
[31m-{[m
[31m-   if ( !features_.allowComments_ )[m
[31m-   {[m
[31m-      collectComments = false;[m
[31m-   }[m
[31m-[m
[31m-   begin_ = beginDoc;[m
[31m-   end_ = endDoc;[m
[31m-   collectComments_ = collectComments;[m
[31m-   current_ = begin_;[m
[31m-   lastValueEnd_ = 0;[m
[31m-   lastValue_ = 0;[m
[31m-   commentsBefore_ = "";[m
[31m-   errors_.clear();[m
[31m-   while ( !nodes_.empty() )[m
[31m-      nodes_.pop();[m
[31m-   nodes_.push( &root );[m
[31m-   [m
[31m-   bool successful = readValue();[m
[31m-   Token token;[m
[31m-   skipCommentTokens( token );[m
[31m-   if ( collectComments_  &&  !commentsBefore_.empty() )[m
[31m-      root.setComment( commentsBefore_, commentAfter );[m
[31m-   if ( features_.strictRoot_ )[m
[31m-   {[m
[31m-      if ( !root.isArray()  &&  !root.isObject() )[m
[31m-      {[m
[31m-         // Set error location to start of doc, ideally should be first token found in doc[m
[31m-         token.type_ = tokenError;[m
[31m-         token.start_ = beginDoc;[m
[31m-         token.end_ = endDoc;[m
[31m-         addError( "A valid JSON document must be either an array or an object value.",[m
[31m-                   token );[m
[31m-         return false;[m
[31m-      }[m
[31m-   }[m
[31m-   return successful;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool[m
[31m-Reader::readValue()[m
[31m-{[m
[31m-   Token token;[m
[31m-   skipCommentTokens( token );[m
[31m-   bool successful = true;[m
[31m-[m
[31m-   if ( collectComments_  &&  !commentsBefore_.empty() )[m
[31m-   {[m
[31m-      currentValue().setComment( commentsBefore_, commentBefore );[m
[31m-      commentsBefore_ = "";[m
[31m-   }[m
[31m-[m
[31m-[m
[31m-   switch ( token.type_ )[m
[31m-   {[m
[31m-   case tokenObjectBegin:[m
[31m-      successful = readObject( token );[m
[31m-      break;[m
[31m-   case tokenArrayBegin:[m
[31m-      successful = readArray( token );[m
[31m-      break;[m
[31m-   case tokenNumber:[m
[31m-      successful = decodeNumber( token );[m
[31m-      break;[m
[31m-   case tokenString:[m
[31m-      successful = decodeString( token );[m
[31m-      break;[m
[31m-   case tokenTrue:[m
[31m-      currentValue() = true;[m
[31m-      break;[m
[31m-   case tokenFalse:[m
[31m-      currentValue() = false;[m
[31m-      break;[m
[31m-   case tokenNull:[m
[31m-      currentValue() = Value();[m
[31m-      break;[m
[31m-   default:[m
[31m-      return addError( "Syntax error: value, object or array expected.", token );[m
[31m-   }[m
[31m-[m
[31m-   if ( collectComments_ )[m
[31m-   {[m
[31m-      lastValueEnd_ = current_;[m
[31m-      lastValue_ = &currentValue();[m
[31m-   }[m
[31m-[m
[31m-   return successful;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Reader::skipCommentTokens( Token &token )[m
[31m-{[m
[31m-   if ( features_.allowComments_ )[m
[31m-   {[m
[31m-      do[m
[31m-      {[m
[31m-         readToken( token );[m
[31m-      }[m
[31m-      while ( token.type_ == tokenComment );[m
[31m-   }[m
[31m-   else[m
[31m-   {[m
[31m-      readToken( token );[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::expectToken( TokenType type, Token &token, const char *message )[m
[31m-{[m
[31m-   readToken( token );[m
[31m-   if ( token.type_ != type )[m
[31m-      return addError( message, token );[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::readToken( Token &token )[m
[31m-{[m
[31m-   skipSpaces();[m
[31m-   token.start_ = current_;[m
[31m-   Char c = getNextChar();[m
[31m-   bool ok = true;[m
[31m-   switch ( c )[m
[31m-   {[m
[31m-   case '{':[m
[31m-      token.type_ = tokenObjectBegin;[m
[31m-      break;[m
[31m-   case '}':[m
[31m-      token.type_ = tokenObjectEnd;[m
[31m-      break;[m
[31m-   case '[':[m
[31m-      token.type_ = tokenArrayBegin;[m
[31m-      break;[m
[31m-   case ']':[m
[31m-      token.type_ = tokenArrayEnd;[m
[31m-      break;[m
[31m-   case '"':[m
[31m-      token.type_ = tokenString;[m
[31m-      ok = readString();[m
[31m-      break;[m
[31m-   case '/':[m
[31m-      token.type_ = tokenComment;[m
[31m-      ok = readComment();[m
[31m-      break;[m
[31m-   case '0':[m
[31m-   case '1':[m
[31m-   case '2':[m
[31m-   case '3':[m
[31m-   case '4':[m
[31m-   case '5':[m
[31m-   case '6':[m
[31m-   case '7':[m
[31m-   case '8':[m
[31m-   case '9':[m
[31m-   case '-':[m
[31m-      token.type_ = tokenNumber;[m
[31m-      readNumber();[m
[31m-      break;[m
[31m-   case 't':[m
[31m-      token.type_ = tokenTrue;[m
[31m-      ok = match( "rue", 3 );[m
[31m-      break;[m
[31m-   case 'f':[m
[31m-      token.type_ = tokenFalse;[m
[31m-      ok = match( "alse", 4 );[m
[31m-      break;[m
[31m-   case 'n':[m
[31m-      token.type_ = tokenNull;[m
[31m-      ok = match( "ull", 3 );[m
[31m-      break;[m
[31m-   case ',':[m
[31m-      token.type_ = tokenArraySeparator;[m
[31m-      break;[m
[31m-   case ':':[m
[31m-      token.type_ = tokenMemberSeparator;[m
[31m-      break;[m
[31m-   case 0:[m
[31m-      token.type_ = tokenEndOfStream;[m
[31m-      break;[m
[31m-   default:[m
[31m-      ok = false;[m
[31m-      break;[m
[31m-   }[m
[31m-   if ( !ok )[m
[31m-      token.type_ = tokenError;[m
[31m-   token.end_ = current_;[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Reader::skipSpaces()[m
[31m-{[m
[31m-   while ( current_ != end_ )[m
[31m-   {[m
[31m-      Char c = *current_;[m
[31m-      if ( c == ' '  ||  c == '\t'  ||  c == '\r'  ||  c == '\n' )[m
[31m-         ++current_;[m
[31m-      else[m
[31m-         break;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::match( Location pattern, [m
[31m-               int patternLength )[m
[31m-{[m
[31m-   if ( end_ - current_ < patternLength )[m
[31m-      return false;[m
[31m-   int index = patternLength;[m
[31m-   while ( index-- )[m
[31m-      if ( current_[index] != pattern[index] )[m
[31m-         return false;[m
[31m-   current_ += patternLength;[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool[m
[31m-Reader::readComment()[m
[31m-{[m
[31m-   Location commentBegin = current_ - 1;[m
[31m-   Char c = getNextChar();[m
[31m-   bool successful = false;[m
[31m-   if ( c == '*' )[m
[31m-      successful = readCStyleComment();[m
[31m-   else if ( c == '/' )[m
[31m-      successful = readCppStyleComment();[m
[31m-   if ( !successful )[m
[31m-      return false;[m
[31m-[m
[31m-   if ( collectComments_ )[m
[31m-   {[m
[31m-      CommentPlacement placement = commentBefore;[m
[31m-      if ( lastValueEnd_  &&  !containsNewLine( lastValueEnd_, commentBegin ) )[m
[31m-      {[m
[31m-         if ( c != '*'  ||  !containsNewLine( commentBegin, current_ ) )[m
[31m-            placement = commentAfterOnSameLine;[m
[31m-      }[m
[31m-[m
[31m-      addComment( commentBegin, current_, placement );[m
[31m-   }[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Reader::addComment( Location begin, [m
[31m-                    Location end, [m
[31m-                    CommentPlacement placement )[m
[31m-{[m
[31m-   assert( collectComments_ );[m
[31m-   if ( placement == commentAfterOnSameLine )[m
[31m-   {[m
[31m-      assert( lastValue_ != 0 );[m
[31m-      lastValue_->setComment( std::string( begin, end ), placement );[m
[31m-   }[m
[31m-   else[m
[31m-   {[m
[31m-      if ( !commentsBefore_.empty() )[m
[31m-         commentsBefore_ += "\n";[m
[31m-      commentsBefore_ += std::string( begin, end );[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::readCStyleComment()[m
[31m-{[m
[31m-   while ( current_ != end_ )[m
[31m-   {[m
[31m-      Char c = getNextChar();[m
[31m-      if ( c == '*'  &&  *current_ == '/' )[m
[31m-         break;[m
[31m-   }[m
[31m-   return getNextChar() == '/';[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::readCppStyleComment()[m
[31m-{[m
[31m-   while ( current_ != end_ )[m
[31m-   {[m
[31m-      Char c = getNextChar();[m
[31m-      if (  c == '\r'  ||  c == '\n' )[m
[31m-         break;[m
[31m-   }[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Reader::readNumber()[m
[31m-{[m
[31m-   while ( current_ != end_ )[m
[31m-   {[m
[31m-      if ( !(*current_ >= '0'  &&  *current_ <= '9')  &&[m
[31m-           !in( *current_, '.', 'e', 'E', '+', '-' ) )[m
[31m-         break;[m
[31m-      ++current_;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-bool[m
[31m-Reader::readString()[m
[31m-{[m
[31m-   Char c = 0;[m
[31m-   while ( current_ != end_ )[m
[31m-   {[m
[31m-      c = getNextChar();[m
[31m-      if ( c == '\\' )[m
[31m-         getNextChar();[m
[31m-      else if ( c == '"' )[m
[31m-         break;[m
[31m-   }[m
[31m-   return c == '"';[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::readObject( Token &tokenStart )[m
[31m-{[m
[31m-   Token tokenName;[m
[31m-   std::string name;[m
[31m-   currentValue() = Value( objectValue );[m
[31m-   while ( readToken( tokenName ) )[m
[31m-   {[m
[31m-      bool initialTokenOk = true;[m
[31m-      while ( tokenName.type_ == tokenComment  &&  initialTokenOk )[m
[31m-         initialTokenOk = readToken( tokenName );[m
[31m-      if  ( !initialTokenOk )[m
[31m-         break;[m
[31m-      if ( tokenName.type_ == tokenObjectEnd  &&  name.empty() )  // empty object[m
[31m-         return true;[m
[31m-      if ( tokenName.type_ != tokenString )[m
[31m-         break;[m
[31m-      [m
[31m-      name = "";[m
[31m-      if ( !decodeString( tokenName, name ) )[m
[31m-         return recoverFromError( tokenObjectEnd );[m
[31m-[m
[31m-      Token colon;[m
[31m-      if ( !readToken( colon ) ||  colon.type_ != tokenMemberSeparator )[m
[31m-      {[m
[31m-         return addErrorAndRecover( "Missing ':' after object member name", [m
[31m-                                    colon, [m
[31m-                                    tokenObjectEnd );[m
[31m-      }[m
[31m-      Value &value = currentValue()[ name ];[m
[31m-      nodes_.push( &value );[m
[31m-      bool ok = readValue();[m
[31m-      nodes_.pop();[m
[31m-      if ( !ok ) // error already set[m
[31m-         return recoverFromError( tokenObjectEnd );[m
[31m-[m
[31m-      Token comma;[m
[31m-      if ( !readToken( comma )[m
[31m-            ||  ( comma.type_ != tokenObjectEnd  &&  [m
[31m-                  comma.type_ != tokenArraySeparator &&[m
[31m-		  comma.type_ != tokenComment ) )[m
[31m-      {[m
[31m-         return addErrorAndRecover( "Missing ',' or '}' in object declaration", [m
[31m-                                    comma, [m
[31m-                                    tokenObjectEnd );[m
[31m-      }[m
[31m-      bool finalizeTokenOk = true;[m
[31m-      while ( comma.type_ == tokenComment &&[m
[31m-              finalizeTokenOk )[m
[31m-         finalizeTokenOk = readToken( comma );[m
[31m-      if ( comma.type_ == tokenObjectEnd )[m
[31m-         return true;[m
[31m-   }[m
[31m-   return addErrorAndRecover( "Missing '}' or object member name", [m
[31m-                              tokenName, [m
[31m-                              tokenObjectEnd );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::readArray( Token &tokenStart )[m
[31m-{[m
[31m-   currentValue() = Value( arrayValue );[m
[31m-   skipSpaces();[m
[31m-   if ( *current_ == ']' ) // empty array[m
[31m-   {[m
[31m-      Token endArray;[m
[31m-      readToken( endArray );[m
[31m-      return true;[m
[31m-   }[m
[31m-   int index = 0;[m
[31m-   while ( true )[m
[31m-   {[m
[31m-      Value &value = currentValue()[ index++ ];[m
[31m-      nodes_.push( &value );[m
[31m-      bool ok = readValue();[m
[31m-      nodes_.pop();[m
[31m-      if ( !ok ) // error already set[m
[31m-         return recoverFromError( tokenArrayEnd );[m
[31m-[m
[31m-      Token token;[m
[31m-      // Accept Comment after last item in the array.[m
[31m-      ok = readToken( token );[m
[31m-      while ( token.type_ == tokenComment  &&  ok )[m
[31m-      {[m
[31m-         ok = readToken( token );[m
[31m-      }[m
[31m-      bool badTokenType = ( token.type_ == tokenArraySeparator  &&  [m
[31m-                            token.type_ == tokenArrayEnd );[m
[31m-      if ( !ok  ||  badTokenType )[m
[31m-      {[m
[31m-         return addErrorAndRecover( "Missing ',' or ']' in array declaration", [m
[31m-                                    token, [m
[31m-                                    tokenArrayEnd );[m
[31m-      }[m
[31m-      if ( token.type_ == tokenArrayEnd )[m
[31m-         break;[m
[31m-   }[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::decodeNumber( Token &token )[m
[31m-{[m
[31m-   bool isDouble = false;[m
[31m-   for ( Location inspect = token.start_; inspect != token.end_; ++inspect )[m
[31m-   {[m
[31m-      isDouble = isDouble  [m
[31m-                 ||  in( *inspect, '.', 'e', 'E', '+' )  [m
[31m-                 ||  ( *inspect == '-'  &&  inspect != token.start_ );[m
[31m-   }[m
[31m-   if ( isDouble )[m
[31m-      return decodeDouble( token );[m
[31m-   Location current = token.start_;[m
[31m-   bool isNegative = *current == '-';[m
[31m-   if ( isNegative )[m
[31m-      ++current;[m
[31m-   Value::UInt threshold = (isNegative ? Value::UInt(-Value::minInt) [m
[31m-                                       : Value::maxUInt) / 10;[m
[31m-   Value::UInt value = 0;[m
[31m-   while ( current < token.end_ )[m
[31m-   {[m
[31m-      Char c = *current++;[m
[31m-      if ( c < '0'  ||  c > '9' )[m
[31m-         return addError( "'" + std::string( token.start_, token.end_ ) + "' is not a number.", token );[m
[31m-      if ( value >= threshold )[m
[31m-         return decodeDouble( token );[m
[31m-      value = value * 10 + Value::UInt(c - '0');[m
[31m-   }[m
[31m-   if ( isNegative )[m
[31m-      currentValue() = -Value::Int( value );[m
[31m-   else if ( value <= Value::UInt(Value::maxInt) )[m
[31m-      currentValue() = Value::Int( value );[m
[31m-   else[m
[31m-      currentValue() = value;[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::decodeDouble( Token &token )[m
[31m-{[m
[31m-   double value = 0;[m
[31m-   const int bufferSize = 32;[m
[31m-   int count;[m
[31m-   int length = int(token.end_ - token.start_);[m
[31m-   if ( length <= bufferSize )[m
[31m-   {[m
[31m-      Char buffer[bufferSize];[m
[31m-      memcpy( buffer, token.start_, length );[m
[31m-      buffer[length] = 0;[m
[31m-      count = sscanf( buffer, "%lf", &value );[m
[31m-   }[m
[31m-   else[m
[31m-   {[m
[31m-      std::string buffer( token.start_, token.end_ );[m
[31m-      count = sscanf( buffer.c_str(), "%lf", &value );[m
[31m-   }[m
[31m-[m
[31m-   if ( count != 1 )[m
[31m-      return addError( "'" + std::string( token.start_, token.end_ ) + "' is not a number.", token );[m
[31m-   currentValue() = value;[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::decodeString( Token &token )[m
[31m-{[m
[31m-   std::string decoded;[m
[31m-   if ( !decodeString( token, decoded ) )[m
[31m-      return false;[m
[31m-   currentValue() = decoded;[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::decodeString( Token &token, std::string &decoded )[m
[31m-{[m
[31m-   decoded.reserve( token.end_ - token.start_ - 2 );[m
[31m-   Location current = token.start_ + 1; // skip '"'[m
[31m-   Location end = token.end_ - 1;      // do not include '"'[m
[31m-   while ( current != end )[m
[31m-   {[m
[31m-      Char c = *current++;[m
[31m-      if ( c == '"' )[m
[31m-         break;[m
[31m-      else if ( c == '\\' )[m
[31m-      {[m
[31m-         if ( current == end )[m
[31m-            return addError( "Empty escape sequence in string", token, current );[m
[31m-         Char escape = *current++;[m
[31m-         switch ( escape )[m
[31m-         {[m
[31m-         case '"': decoded += '"'; break;[m
[31m-         case '/': decoded += '/'; break;[m
[31m-         case '\\': decoded += '\\'; break;[m
[31m-         case 'b': decoded += '\b'; break;[m
[31m-         case 'f': decoded += '\f'; break;[m
[31m-         case 'n': decoded += '\n'; break;[m
[31m-         case 'r': decoded += '\r'; break;[m
[31m-         case 't': decoded += '\t'; break;[m
[31m-         case 'u':[m
[31m-            {[m
[31m-               unsigned int unicode;[m
[31m-               if ( !decodeUnicodeCodePoint( token, current, end, unicode ) )[m
[31m-                  return false;[m
[31m-               decoded += codePointToUTF8(unicode);[m
[31m-            }[m
[31m-            break;[m
[31m-         default:[m
[31m-            return addError( "Bad escape sequence in string", token, current );[m
[31m-         }[m
[31m-      }[m
[31m-      else[m
[31m-      {[m
[31m-         decoded += c;[m
[31m-      }[m
[31m-   }[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-bool[m
[31m-Reader::decodeUnicodeCodePoint( Token &token, [m
[31m-                                     Location &current, [m
[31m-                                     Location end, [m
[31m-                                     unsigned int &unicode )[m
[31m-{[m
[31m-[m
[31m-   if ( !decodeUnicodeEscapeSequence( token, current, end, unicode ) )[m
[31m-      return false;[m
[31m-   if (unicode >= 0xD800 && unicode <= 0xDBFF)[m
[31m-   {[m
[31m-      // surrogate pairs[m
[31m-      if (end - current < 6)[m
[31m-         return addError( "additional six characters expected to parse unicode surrogate pair.", token, current );[m
[31m-      unsigned int surrogatePair;[m
[31m-      if (*(current++) == '\\' && *(current++)== 'u')[m
[31m-      {[m
[31m-         if (decodeUnicodeEscapeSequence( token, current, end, surrogatePair ))[m
[31m-         {[m
[31m-            unicode = 0x10000 + ((unicode & 0x3FF) << 10) + (surrogatePair & 0x3FF);[m
[31m-         } [m
[31m-         else[m
[31m-            return false;[m
[31m-      } [m
[31m-      else[m
[31m-         return addError( "expecting another \\u token to begin the second half of a unicode surrogate pair", token, current );[m
[31m-   }[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Reader::decodeUnicodeEscapeSequence( Token &token, [m
[31m-                                     Location &current, [m
[31m-                                     Location end, [m
[31m-                                     unsigned int &unicode )[m
[31m-{[m
[31m-   if ( end - current < 4 )[m
[31m-      return addError( "Bad unicode escape sequence in string: four digits expected.", token, current );[m
[31m-   unicode = 0;[m
[31m-   for ( int index =0; index < 4; ++index )[m
[31m-   {[m
[31m-      Char c = *current++;[m
[31m-      unicode *= 16;[m
[31m-      if ( c >= '0'  &&  c <= '9' )[m
[31m-         unicode += c - '0';[m
[31m-      else if ( c >= 'a'  &&  c <= 'f' )[m
[31m-         unicode += c - 'a' + 10;[m
[31m-      else if ( c >= 'A'  &&  c <= 'F' )[m
[31m-         unicode += c - 'A' + 10;[m
[31m-      else[m
[31m-         return addError( "Bad unicode escape sequence in string: hexadecimal digit expected.", token, current );[m
[31m-   }[m
[31m-   return true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::addError( const std::string &message, [m
[31m-                  Token &token,[m
[31m-                  Location extra )[m
[31m-{[m
[31m-   ErrorInfo info;[m
[31m-   info.token_ = token;[m
[31m-   info.message_ = message;[m
[31m-   info.extra_ = extra;[m
[31m-   errors_.push_back( info );[m
[31m-   return false;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::recoverFromError( TokenType skipUntilToken )[m
[31m-{[m
[31m-   int errorCount = int(errors_.size());[m
[31m-   Token skip;[m
[31m-   while ( true )[m
[31m-   {[m
[31m-      if ( !readToken(skip) )[m
[31m-         errors_.resize( errorCount ); // discard errors caused by recovery[m
[31m-      if ( skip.type_ == skipUntilToken  ||  skip.type_ == tokenEndOfStream )[m
[31m-         break;[m
[31m-   }[m
[31m-   errors_.resize( errorCount );[m
[31m-   return false;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Reader::addErrorAndRecover( const std::string &message, [m
[31m-                            Token &token,[m
[31m-                            TokenType skipUntilToken )[m
[31m-{[m
[31m-   addError( message, token );[m
[31m-   return recoverFromError( skipUntilToken );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Reader::currentValue()[m
[31m-{[m
[31m-   return *(nodes_.top());[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Reader::Char [m
[31m-Reader::getNextChar()[m
[31m-{[m
[31m-   if ( current_ == end_ )[m
[31m-      return 0;[m
[31m-   return *current_++;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Reader::getLocationLineAndColumn( Location location,[m
[31m-                                  int &line,[m
[31m-                                  int &column ) const[m
[31m-{[m
[31m-   Location current = begin_;[m
[31m-   Location lastLineStart = current;[m
[31m-   line = 0;[m
[31m-   while ( current < location  &&  current != end_ )[m
[31m-   {[m
[31m-      Char c = *current++;[m
[31m-      if ( c == '\r' )[m
[31m-      {[m
[31m-         if ( *current == '\n' )[m
[31m-            ++current;[m
[31m-         lastLineStart = current;[m
[31m-         ++line;[m
[31m-      }[m
[31m-      else if ( c == '\n' )[m
[31m-      {[m
[31m-         lastLineStart = current;[m
[31m-         ++line;[m
[31m-      }[m
[31m-   }[m
[31m-   // column & line start at 1[m
[31m-   column = int(location - lastLineStart) + 1;[m
[31m-   ++line;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string[m
[31m-Reader::getLocationLineAndColumn( Location location ) const[m
[31m-{[m
[31m-   int line, column;[m
[31m-   getLocationLineAndColumn( location, line, column );[m
[31m-   char buffer[18+16+16+1];[m
[31m-   sprintf( buffer, "Line %d, Column %d", line, column );[m
[31m-   return buffer;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-Reader::getFormatedErrorMessages() const[m
[31m-{[m
[31m-   std::string formattedMessage;[m
[31m-   for ( Errors::const_iterator itError = errors_.begin();[m
[31m-         itError != errors_.end();[m
[31m-         ++itError )[m
[31m-   {[m
[31m-      const ErrorInfo &error = *itError;[m
[31m-      formattedMessage += "* " + getLocationLineAndColumn( error.token_.start_ ) + "\n";[m
[31m-      formattedMessage += "  " + error.message_ + "\n";[m
[31m-      if ( error.extra_ )[m
[31m-         formattedMessage += "See " + getLocationLineAndColumn( error.extra_ ) + " for detail.\n";[m
[31m-   }[m
[31m-   return formattedMessage;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::istream& operator>>( std::istream &sin, Value &root )[m
[31m-{[m
[31m-    Json::Reader reader;[m
[31m-    bool ok = reader.parse(sin, root, true);[m
[31m-    //JSON_ASSERT( ok );[m
[31m-    if (!ok) throw std::runtime_error(reader.getFormatedErrorMessages());[m
[31m-    return sin;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-} // namespace Json[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_value.cpp b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_value.cpp[m
[1mdeleted file mode 100755[m
[1mindex 6e5dcd3..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_value.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,1726 +0,0 @@[m
[31m-#include <iostream>[m
[31m-#include <json/value.h>[m
[31m-#include <json/writer.h>[m
[31m-#include <utility>[m
[31m-#include <stdexcept>[m
[31m-#include <cstring>[m
[31m-#include <cassert>[m
[31m-#ifdef JSON_USE_CPPTL[m
[31m-# include <cpptl/conststring.h>[m
[31m-#endif[m
[31m-#include <cstddef>    // size_t[m
[31m-#ifndef JSON_USE_SIMPLE_INTERNAL_ALLOCATOR[m
[31m-# include "json_batchallocator.h"[m
[31m-#endif // #ifndef JSON_USE_SIMPLE_INTERNAL_ALLOCATOR[m
[31m-[m
[31m-#define JSON_ASSERT_UNREACHABLE assert( false )[m
[31m-#define JSON_ASSERT( condition ) assert( condition );  // @todo <= change this into an exception throw[m
[31m-#define JSON_ASSERT_MESSAGE( condition, message ) if (!( condition )) throw std::runtime_error( message );[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-// QNX is strict about declaring C symbols in the std namespace.[m
[31m-#ifdef __QNXNTO__[m
[31m-using std::memcpy;[m
[31m-using std::strchr;[m
[31m-using std::strcmp;[m
[31m-using std::strlen;[m
[31m-#endif[m
[31m-[m
[31m-const Value Value::null;[m
[31m-const Int Value::minInt = Int( ~(UInt(-1)/2) );[m
[31m-const Int Value::maxInt = Int( UInt(-1)/2 );[m
[31m-const UInt Value::maxUInt = UInt(-1);[m
[31m-[m
[31m-// A "safe" implementation of strdup. Allow null pointer to be passed. [m
[31m-// Also avoid warning on msvc80.[m
[31m-//[m
[31m-//inline char *safeStringDup( const char *czstring )[m
[31m-//{[m
[31m-//   if ( czstring )[m
[31m-//   {[m
[31m-//      const size_t length = (unsigned int)( strlen(czstring) + 1 );[m
[31m-//      char *newString = static_cast<char *>( malloc( length ) );[m
[31m-//      memcpy( newString, czstring, length );[m
[31m-//      return newString;[m
[31m-//   }[m
[31m-//   return 0;[m
[31m-//}[m
[31m-//[m
[31m-//inline char *safeStringDup( const std::string &str )[m
[31m-//{[m
[31m-//   if ( !str.empty() )[m
[31m-//   {[m
[31m-//      const size_t length = str.length();[m
[31m-//      char *newString = static_cast<char *>( malloc( length + 1 ) );[m
[31m-//      memcpy( newString, str.c_str(), length );[m
[31m-//      newString[length] = 0;[m
[31m-//      return newString;[m
[31m-//   }[m
[31m-//   return 0;[m
[31m-//}[m
[31m-[m
[31m-ValueAllocator::~ValueAllocator()[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-class DefaultValueAllocator : public ValueAllocator[m
[31m-{[m
[31m-public:[m
[31m-   virtual ~DefaultValueAllocator()[m
[31m-   {[m
[31m-   }[m
[31m-[m
[31m-   virtual char *makeMemberName( const char *memberName )[m
[31m-   {[m
[31m-      return duplicateStringValue( memberName );[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseMemberName( char *memberName )[m
[31m-   {[m
[31m-      releaseStringValue( memberName );[m
[31m-   }[m
[31m-[m
[31m-   virtual char *duplicateStringValue( const char *value, [m
[31m-                                       unsigned int length = unknown )[m
[31m-   {[m
[31m-      //@todo invesgate this old optimization[m
[31m-      //if ( !value  ||  value[0] == 0 )[m
[31m-      //   return 0;[m
[31m-[m
[31m-      if ( length == unknown )[m
[31m-         length = (unsigned int)strlen(value);[m
[31m-      char *newString = static_cast<char *>( malloc( length + 1 ) );[m
[31m-      memcpy( newString, value, length );[m
[31m-      newString[length] = 0;[m
[31m-      return newString;[m
[31m-   }[m
[31m-[m
[31m-   virtual void releaseStringValue( char *value )[m
[31m-   {[m
[31m-      if ( value )[m
[31m-         free( value );[m
[31m-   }[m
[31m-};[m
[31m-[m
[31m-static ValueAllocator *&valueAllocator()[m
[31m-{[m
[31m-   static DefaultValueAllocator defaultAllocator;[m
[31m-   static ValueAllocator *valueAllocator = &defaultAllocator;[m
[31m-   return valueAllocator;[m
[31m-}[m
[31m-[m
[31m-static struct DummyValueAllocatorInitializer {[m
[31m-   DummyValueAllocatorInitializer() [m
[31m-   {[m
[31m-      valueAllocator();      // ensure valueAllocator() statics are initialized before main().[m
[31m-   }[m
[31m-} dummyValueAllocatorInitializer;[m
[31m-[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// ValueInternals...[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-# include "json_internalarray.inl"[m
[31m-# include "json_internalmap.inl"[m
[31m-#endif // JSON_VALUE_USE_INTERNAL_MAP[m
[31m-[m
[31m-# include "json_valueiterator.inl"[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class Value::CommentInfo[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-[m
[31m-Value::CommentInfo::CommentInfo()[m
[31m-   : comment_( 0 )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-Value::CommentInfo::~CommentInfo()[m
[31m-{[m
[31m-   if ( comment_ )[m
[31m-      valueAllocator()->releaseStringValue( comment_ );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Value::CommentInfo::setComment( const char *text )[m
[31m-{[m
[31m-   if ( comment_ )[m
[31m-      valueAllocator()->releaseStringValue( comment_ );[m
[31m-   JSON_ASSERT( text );[m
[31m-   JSON_ASSERT_MESSAGE( text[0]=='\0' || text[0]=='/', "Comments must start with /");[m
[31m-   // It seems that /**/ style comments are acceptable as well.[m
[31m-   comment_ = valueAllocator()->duplicateStringValue( text );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class Value::CZString[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-# ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-[m
[31m-// Notes: index_ indicates if the string was allocated when[m
[31m-// a string is stored.[m
[31m-[m
[31m-Value::CZString::CZString( int index )[m
[31m-   : cstr_( 0 )[m
[31m-   , index_( index )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-Value::CZString::CZString( const char *cstr, DuplicationPolicy allocate )[m
[31m-   : cstr_( allocate == duplicate ? valueAllocator()->makeMemberName(cstr) [m
[31m-                                  : cstr )[m
[31m-   , index_( allocate )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-Value::CZString::CZString( const CZString &other )[m
[31m-: cstr_( other.index_ != noDuplication &&  other.cstr_ != 0[m
[31m-                ?  valueAllocator()->makeMemberName( other.cstr_ )[m
[31m-                : other.cstr_ )[m
[31m-   , index_( other.cstr_ ? (other.index_ == noDuplication ? noDuplication : duplicate)[m
[31m-                         : other.index_ )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-Value::CZString::~CZString()[m
[31m-{[m
[31m-   if ( cstr_  &&  index_ == duplicate )[m
[31m-      valueAllocator()->releaseMemberName( const_cast<char *>( cstr_ ) );[m
[31m-}[m
[31m-[m
[31m-void [m
[31m-Value::CZString::swap( CZString &other )[m
[31m-{[m
[31m-   std::swap( cstr_, other.cstr_ );[m
[31m-   std::swap( index_, other.index_ );[m
[31m-}[m
[31m-[m
[31m-Value::CZString &[m
[31m-Value::CZString::operator =( const CZString &other )[m
[31m-{[m
[31m-   CZString temp( other );[m
[31m-   swap( temp );[m
[31m-   return *this;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::CZString::operator<( const CZString &other ) const [m
[31m-{[m
[31m-   if ( cstr_ )[m
[31m-      return strcmp( cstr_, other.cstr_ ) < 0;[m
[31m-   return index_ < other.index_;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::CZString::operator==( const CZString &other ) const [m
[31m-{[m
[31m-   if ( cstr_ )[m
[31m-      return strcmp( cstr_, other.cstr_ ) == 0;[m
[31m-   return index_ == other.index_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-int [m
[31m-Value::CZString::index() const[m
[31m-{[m
[31m-   return index_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const char *[m
[31m-Value::CZString::c_str() const[m
[31m-{[m
[31m-   return cstr_;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::CZString::isStaticString() const[m
[31m-{[m
[31m-   return index_ == noDuplication;[m
[31m-}[m
[31m-[m
[31m-#endif // ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class Value::Value[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-/*! \internal Default constructor initialization must be equivalent to:[m
[31m- * memset( this, 0, sizeof(Value) )[m
[31m- * This optimization is used in ValueInternalMap fast allocator.[m
[31m- */[m
[31m-Value::Value( ValueType type )[m
[31m-   : type_( type )[m
[31m-   , allocated_( 0 )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   switch ( type )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      break;[m
[31m-   case intValue:[m
[31m-   case uintValue:[m
[31m-      value_.int_ = 0;[m
[31m-      break;[m
[31m-   case realValue:[m
[31m-      value_.real_ = 0.0;[m
[31m-      break;[m
[31m-   case stringValue:[m
[31m-      value_.string_ = 0;[m
[31m-      break;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      value_.map_ = new ObjectValues();[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      value_.array_ = arrayAllocator()->newArray();[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      value_.map_ = mapAllocator()->newMap();[m
[31m-      break;[m
[31m-#endif[m
[31m-   case booleanValue:[m
[31m-      value_.bool_ = false;[m
[31m-      break;[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::Value( Int value )[m
[31m-   : type_( intValue )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.int_ = value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::Value( UInt value )[m
[31m-   : type_( uintValue )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.uint_ = value;[m
[31m-}[m
[31m-[m
[31m-Value::Value( double value )[m
[31m-   : type_( realValue )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.real_ = value;[m
[31m-}[m
[31m-[m
[31m-Value::Value( const char *value )[m
[31m-   : type_( stringValue )[m
[31m-   , allocated_( true )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.string_ = valueAllocator()->duplicateStringValue( value );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::Value( const char *beginValue, [m
[31m-              const char *endValue )[m
[31m-   : type_( stringValue )[m
[31m-   , allocated_( true )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.string_ = valueAllocator()->duplicateStringValue( beginValue, [m
[31m-                                                            UInt(endValue - beginValue) );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::Value( const std::string &value )[m
[31m-   : type_( stringValue )[m
[31m-   , allocated_( true )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.string_ = valueAllocator()->duplicateStringValue( value.c_str(), [m
[31m-                                                            (unsigned int)value.length() );[m
[31m-[m
[31m-}[m
[31m-[m
[31m-Value::Value( const StaticString &value )[m
[31m-   : type_( stringValue )[m
[31m-   , allocated_( false )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.string_ = const_cast<char *>( value.c_str() );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-Value::Value( const CppTL::ConstString &value )[m
[31m-   : type_( stringValue )[m
[31m-   , allocated_( true )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.string_ = valueAllocator()->duplicateStringValue( value, value.length() );[m
[31m-}[m
[31m-# endif[m
[31m-[m
[31m-Value::Value( bool value )[m
[31m-   : type_( booleanValue )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   value_.bool_ = value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::Value( const Value &other )[m
[31m-   : type_( other.type_ )[m
[31m-   , comments_( 0 )[m
[31m-# ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   , itemIsUsed_( 0 )[m
[31m-#endif[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-   case intValue:[m
[31m-   case uintValue:[m
[31m-   case realValue:[m
[31m-   case booleanValue:[m
[31m-      value_ = other.value_;[m
[31m-      break;[m
[31m-   case stringValue:[m
[31m-      if ( other.value_.string_ )[m
[31m-      {[m
[31m-         value_.string_ = valueAllocator()->duplicateStringValue( other.value_.string_ );[m
[31m-         allocated_ = true;[m
[31m-      }[m
[31m-      else[m
[31m-         value_.string_ = 0;[m
[31m-      break;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      value_.map_ = new ObjectValues( *other.value_.map_ );[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      value_.array_ = arrayAllocator()->newArrayCopy( *other.value_.array_ );[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      value_.map_ = mapAllocator()->newMapCopy( *other.value_.map_ );[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   if ( other.comments_ )[m
[31m-   {[m
[31m-      comments_ = new CommentInfo[numberOfCommentPlacement];[m
[31m-      for ( int comment =0; comment < numberOfCommentPlacement; ++comment )[m
[31m-      {[m
[31m-         const CommentInfo &otherComment = other.comments_[comment];[m
[31m-         if ( otherComment.comment_ )[m
[31m-            comments_[comment].setComment( otherComment.comment_ );[m
[31m-      }[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::~Value()[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-   case intValue:[m
[31m-   case uintValue:[m
[31m-   case realValue:[m
[31m-   case booleanValue:[m
[31m-      break;[m
[31m-   case stringValue:[m
[31m-      if ( allocated_ )[m
[31m-         valueAllocator()->releaseStringValue( value_.string_ );[m
[31m-      break;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      delete value_.map_;[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      arrayAllocator()->destructArray( value_.array_ );[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      mapAllocator()->destructMap( value_.map_ );[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-[m
[31m-   if ( comments_ )[m
[31m-      delete[] comments_;[m
[31m-}[m
[31m-[m
[31m-Value &[m
[31m-Value::operator=( const Value &other )[m
[31m-{[m
[31m-   Value temp( other );[m
[31m-   swap( temp );[m
[31m-   return *this;[m
[31m-}[m
[31m-[m
[31m-void [m
[31m-Value::swap( Value &other )[m
[31m-{[m
[31m-   ValueType temp = type_;[m
[31m-   type_ = other.type_;[m
[31m-   other.type_ = temp;[m
[31m-   std::swap( value_, other.value_ );[m
[31m-   int temp2 = allocated_;[m
[31m-   allocated_ = other.allocated_;[m
[31m-   other.allocated_ = temp2;[m
[31m-}[m
[31m-[m
[31m-ValueType [m
[31m-Value::type() const[m
[31m-{[m
[31m-   return type_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-int [m
[31m-Value::compare( const Value &other )[m
[31m-{[m
[31m-   /*[m
[31m-   int typeDelta = other.type_ - type_;[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-[m
[31m-      return other.type_ == type_;[m
[31m-   case intValue:[m
[31m-      if ( other.type_.isNumeric()[m
[31m-   case uintValue:[m
[31m-   case realValue:[m
[31m-   case booleanValue:[m
[31m-      break;[m
[31m-   case stringValue,[m
[31m-      break;[m
[31m-   case arrayValue:[m
[31m-      delete value_.array_;[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      delete value_.map_;[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   */[m
[31m-   return 0;  // unreachable[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::operator <( const Value &other ) const[m
[31m-{[m
[31m-   int typeDelta = type_ - other.type_;[m
[31m-   if ( typeDelta )[m
[31m-      return typeDelta < 0 ? true : false;[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return false;[m
[31m-   case intValue:[m
[31m-      return value_.int_ < other.value_.int_;[m
[31m-   case uintValue:[m
[31m-      return value_.uint_ < other.value_.uint_;[m
[31m-   case realValue:[m
[31m-      return value_.real_ < other.value_.real_;[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_ < other.value_.bool_;[m
[31m-   case stringValue:[m
[31m-      return ( value_.string_ == 0  &&  other.value_.string_ )[m
[31m-             || ( other.value_.string_  [m
[31m-                  &&  value_.string_  [m
[31m-                  && strcmp( value_.string_, other.value_.string_ ) < 0 );[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      {[m
[31m-         int delta = int( value_.map_->size() - other.value_.map_->size() );[m
[31m-         if ( delta )[m
[31m-            return delta < 0;[m
[31m-         return (*value_.map_) < (*other.value_.map_);[m
[31m-      }[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      return value_.array_->compare( *(other.value_.array_) ) < 0;[m
[31m-   case objectValue:[m
[31m-      return value_.map_->compare( *(other.value_.map_) ) < 0;[m
[31m-#endif[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return 0;  // unreachable[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::operator <=( const Value &other ) const[m
[31m-{[m
[31m-   return !(other > *this);[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::operator >=( const Value &other ) const[m
[31m-{[m
[31m-   return !(*this < other);[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::operator >( const Value &other ) const[m
[31m-{[m
[31m-   return other < *this;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::operator ==( const Value &other ) const[m
[31m-{[m
[31m-   //if ( type_ != other.type_ )[m
[31m-   // GCC 2.95.3 says:[m
[31m-   // attempt to take address of bit-field structure member `Json::Value::type_'[m
[31m-   // Beats me, but a temp solves the problem.[m
[31m-   int temp = other.type_;[m
[31m-   if ( type_ != temp )[m
[31m-      return false;[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return true;[m
[31m-   case intValue:[m
[31m-      return value_.int_ == other.value_.int_;[m
[31m-   case uintValue:[m
[31m-      return value_.uint_ == other.value_.uint_;[m
[31m-   case realValue:[m
[31m-      return value_.real_ == other.value_.real_;[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_ == other.value_.bool_;[m
[31m-   case stringValue:[m
[31m-      return ( value_.string_ == other.value_.string_ )[m
[31m-             || ( other.value_.string_  [m
[31m-                  &&  value_.string_  [m
[31m-                  && strcmp( value_.string_, other.value_.string_ ) == 0 );[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      return value_.map_->size() == other.value_.map_->size()[m
[31m-             && (*value_.map_) == (*other.value_.map_);[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      return value_.array_->compare( *(other.value_.array_) ) == 0;[m
[31m-   case objectValue:[m
[31m-      return value_.map_->compare( *(other.value_.map_) ) == 0;[m
[31m-#endif[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return 0;  // unreachable[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::operator !=( const Value &other ) const[m
[31m-{[m
[31m-   return !( *this == other );[m
[31m-}[m
[31m-[m
[31m-const char *[m
[31m-Value::asCString() const[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == stringValue );[m
[31m-   return value_.string_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-Value::asString() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return "";[m
[31m-   case stringValue:[m
[31m-      return value_.string_ ? value_.string_ : "";[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_ ? "true" : "false";[m
[31m-   case intValue:[m
[31m-   case uintValue:[m
[31m-   case realValue:[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      JSON_ASSERT_MESSAGE( false, "Type is not convertible to string" );[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return ""; // unreachable[m
[31m-}[m
[31m-[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-CppTL::ConstString [m
[31m-Value::asConstString() const[m
[31m-{[m
[31m-   return CppTL::ConstString( asString().c_str() );[m
[31m-}[m
[31m-# endif[m
[31m-[m
[31m-Value::Int [m
[31m-Value::asInt() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return 0;[m
[31m-   case intValue:[m
[31m-      return value_.int_;[m
[31m-   case uintValue:[m
[31m-      JSON_ASSERT_MESSAGE( value_.uint_ < (unsigned)maxInt, "integer out of signed integer range" );[m
[31m-      return value_.uint_;[m
[31m-   case realValue:[m
[31m-      JSON_ASSERT_MESSAGE( value_.real_ >= minInt  &&  value_.real_ <= maxInt, "Real out of signed integer range" );[m
[31m-      return Int( value_.real_ );[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_ ? 1 : 0;[m
[31m-   case stringValue:[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      JSON_ASSERT_MESSAGE( false, "Type is not convertible to int" );[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return 0; // unreachable;[m
[31m-}[m
[31m-[m
[31m-Value::UInt [m
[31m-Value::asUInt() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return 0;[m
[31m-   case intValue:[m
[31m-      JSON_ASSERT_MESSAGE( value_.int_ >= 0, "Negative integer can not be converted to unsigned integer" );[m
[31m-      return value_.int_;[m
[31m-   case uintValue:[m
[31m-      return value_.uint_;[m
[31m-   case realValue:[m
[31m-      JSON_ASSERT_MESSAGE( value_.real_ >= 0  &&  value_.real_ <= maxUInt,  "Real out of unsigned integer range" );[m
[31m-      return UInt( value_.real_ );[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_ ? 1 : 0;[m
[31m-   case stringValue:[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      JSON_ASSERT_MESSAGE( false, "Type is not convertible to uint" );[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return 0; // unreachable;[m
[31m-}[m
[31m-[m
[31m-double [m
[31m-Value::asDouble() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return 0.0;[m
[31m-   case intValue:[m
[31m-      return value_.int_;[m
[31m-   case uintValue:[m
[31m-      return value_.uint_;[m
[31m-   case realValue:[m
[31m-      return value_.real_;[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_ ? 1.0 : 0.0;[m
[31m-   case stringValue:[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      JSON_ASSERT_MESSAGE( false, "Type is not convertible to double" );[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return 0; // unreachable;[m
[31m-}[m
[31m-[m
[31m-bool [m
[31m-Value::asBool() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return false;[m
[31m-   case intValue:[m
[31m-   case uintValue:[m
[31m-      return value_.int_ != 0;[m
[31m-   case realValue:[m
[31m-      return value_.real_ != 0.0;[m
[31m-   case booleanValue:[m
[31m-      return value_.bool_;[m
[31m-   case stringValue:[m
[31m-      return value_.string_  &&  value_.string_[0] != 0;[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      return value_.map_->size() != 0;[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return false; // unreachable;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isConvertibleTo( ValueType other ) const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      return true;[m
[31m-   case intValue:[m
[31m-      return ( other == nullValue  &&  value_.int_ == 0 )[m
[31m-             || other == intValue[m
[31m-             || ( other == uintValue  && value_.int_ >= 0 )[m
[31m-             || other == realValue[m
[31m-             || other == stringValue[m
[31m-             || other == booleanValue;[m
[31m-   case uintValue:[m
[31m-      return ( other == nullValue  &&  value_.uint_ == 0 )[m
[31m-             || ( other == intValue  && value_.uint_ <= (unsigned)maxInt )[m
[31m-             || other == uintValue[m
[31m-             || other == realValue[m
[31m-             || other == stringValue[m
[31m-             || other == booleanValue;[m
[31m-   case realValue:[m
[31m-      return ( other == nullValue  &&  value_.real_ == 0.0 )[m
[31m-             || ( other == intValue  &&  value_.real_ >= minInt  &&  value_.real_ <= maxInt )[m
[31m-             || ( other == uintValue  &&  value_.real_ >= 0  &&  value_.real_ <= maxUInt )[m
[31m-             || other == realValue[m
[31m-             || other == stringValue[m
[31m-             || other == booleanValue;[m
[31m-   case booleanValue:[m
[31m-      return ( other == nullValue  &&  value_.bool_ == false )[m
[31m-             || other == intValue[m
[31m-             || other == uintValue[m
[31m-             || other == realValue[m
[31m-             || other == stringValue[m
[31m-             || other == booleanValue;[m
[31m-   case stringValue:[m
[31m-      return other == stringValue[m
[31m-             || ( other == nullValue  &&  (!value_.string_  ||  value_.string_[0] == 0) );[m
[31m-   case arrayValue:[m
[31m-      return other == arrayValue[m
[31m-             ||  ( other == nullValue  &&  value_.map_->size() == 0 );[m
[31m-   case objectValue:[m
[31m-      return other == objectValue[m
[31m-             ||  ( other == nullValue  &&  value_.map_->size() == 0 );[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return false; // unreachable;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-/// Number of values in array or object[m
[31m-Value::UInt [m
[31m-Value::size() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-   case intValue:[m
[31m-   case uintValue:[m
[31m-   case realValue:[m
[31m-   case booleanValue:[m
[31m-   case stringValue:[m
[31m-      return 0;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:  // size of the array is highest index + 1[m
[31m-      if ( !value_.map_->empty() )[m
[31m-      {[m
[31m-         ObjectValues::const_iterator itLast = value_.map_->end();[m
[31m-         --itLast;[m
[31m-         return (*itLast).first.index()+1;[m
[31m-      }[m
[31m-      return 0;[m
[31m-   case objectValue:[m
[31m-      return Int( value_.map_->size() );[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      return Int( value_.array_->size() );[m
[31m-   case objectValue:[m
[31m-      return Int( value_.map_->size() );[m
[31m-#endif[m
[31m-   default:[m
[31m-      JSON_ASSERT_UNREACHABLE;[m
[31m-   }[m
[31m-   return 0; // unreachable;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::empty() const[m
[31m-{[m
[31m-   if ( isNull() || isArray() || isObject() )[m
[31m-      return size() == 0u;[m
[31m-   else[m
[31m-      return false;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool[m
[31m-Value::operator!() const[m
[31m-{[m
[31m-   return isNull();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Value::clear()[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == arrayValue  || type_ == objectValue );[m
[31m-[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      value_.map_->clear();[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-      value_.array_->clear();[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      value_.map_->clear();[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      break;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-void [m
[31m-Value::resize( UInt newSize )[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == arrayValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-      *this = Value( arrayValue );[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   UInt oldSize = size();[m
[31m-   if ( newSize == 0 )[m
[31m-      clear();[m
[31m-   else if ( newSize > oldSize )[m
[31m-      (*this)[ newSize - 1 ];[m
[31m-   else[m
[31m-   {[m
[31m-      for ( UInt index = newSize; index < oldSize; ++index )[m
[31m-         value_.map_->erase( index );[m
[31m-      assert( size() == newSize );[m
[31m-   }[m
[31m-#else[m
[31m-   value_.array_->resize( newSize );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Value::operator[]( UInt index )[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == arrayValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-      *this = Value( arrayValue );[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   CZString key( index );[m
[31m-   ObjectValues::iterator it = value_.map_->lower_bound( key );[m
[31m-   if ( it != value_.map_->end()  &&  (*it).first == key )[m
[31m-      return (*it).second;[m
[31m-[m
[31m-   ObjectValues::value_type defaultValue( key, null );[m
[31m-   it = value_.map_->insert( it, defaultValue );[m
[31m-   return (*it).second;[m
[31m-#else[m
[31m-   return value_.array_->resolveReference( index );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const Value &[m
[31m-Value::operator[]( UInt index ) const[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == arrayValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-      return null;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   CZString key( index );[m
[31m-   ObjectValues::const_iterator it = value_.map_->find( key );[m
[31m-   if ( it == value_.map_->end() )[m
[31m-      return null;[m
[31m-   return (*it).second;[m
[31m-#else[m
[31m-   Value *value = value_.array_->find( index );[m
[31m-   return value ? *value : null;[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Value::operator[]( const char *key )[m
[31m-{[m
[31m-   return resolveReference( key, false );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Value::resolveReference( const char *key, [m
[31m-                         bool isStatic )[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == objectValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-      *this = Value( objectValue );[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   CZString actualKey( key, isStatic ? CZString::noDuplication [m
[31m-                                     : CZString::duplicateOnCopy );[m
[31m-   ObjectValues::iterator it = value_.map_->lower_bound( actualKey );[m
[31m-   if ( it != value_.map_->end()  &&  (*it).first == actualKey )[m
[31m-      return (*it).second;[m
[31m-[m
[31m-   ObjectValues::value_type defaultValue( actualKey, null );[m
[31m-   it = value_.map_->insert( it, defaultValue );[m
[31m-   Value &value = (*it).second;[m
[31m-   return value;[m
[31m-#else[m
[31m-   return value_.map_->resolveReference( key, isStatic );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value [m
[31m-Value::get( UInt index, [m
[31m-            const Value &defaultValue ) const[m
[31m-{[m
[31m-   const Value *value = &((*this)[index]);[m
[31m-   return value == &null ? defaultValue : *value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isValidIndex( UInt index ) const[m
[31m-{[m
[31m-   return index < size();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-[m
[31m-const Value &[m
[31m-Value::operator[]( const char *key ) const[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == objectValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-      return null;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   CZString actualKey( key, CZString::noDuplication );[m
[31m-   ObjectValues::const_iterator it = value_.map_->find( actualKey );[m
[31m-   if ( it == value_.map_->end() )[m
[31m-      return null;[m
[31m-   return (*it).second;[m
[31m-#else[m
[31m-   const Value *value = value_.map_->find( key );[m
[31m-   return value ? *value : null;[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Value::operator[]( const std::string &key )[m
[31m-{[m
[31m-   return (*this)[ key.c_str() ];[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const Value &[m
[31m-Value::operator[]( const std::string &key ) const[m
[31m-{[m
[31m-   return (*this)[ key.c_str() ];[m
[31m-}[m
[31m-[m
[31m-Value &[m
[31m-Value::operator[]( const StaticString &key )[m
[31m-{[m
[31m-   return resolveReference( key, true );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-Value &[m
[31m-Value::operator[]( const CppTL::ConstString &key )[m
[31m-{[m
[31m-   return (*this)[ key.c_str() ];[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const Value &[m
[31m-Value::operator[]( const CppTL::ConstString &key ) const[m
[31m-{[m
[31m-   return (*this)[ key.c_str() ];[m
[31m-}[m
[31m-# endif[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Value::append( const Value &value )[m
[31m-{[m
[31m-   return (*this)[size()] = value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value [m
[31m-Value::get( const char *key, [m
[31m-            const Value &defaultValue ) const[m
[31m-{[m
[31m-   const Value *value = &((*this)[key]);[m
[31m-   return value == &null ? defaultValue : *value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value [m
[31m-Value::get( const std::string &key,[m
[31m-            const Value &defaultValue ) const[m
[31m-{[m
[31m-   return get( key.c_str(), defaultValue );[m
[31m-}[m
[31m-[m
[31m-Value[m
[31m-Value::removeMember( const char* key )[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == objectValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-      return null;[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   CZString actualKey( key, CZString::noDuplication );[m
[31m-   ObjectValues::iterator it = value_.map_->find( actualKey );[m
[31m-   if ( it == value_.map_->end() )[m
[31m-      return null;[m
[31m-   Value old(it->second);[m
[31m-   value_.map_->erase(it);[m
[31m-   return old;[m
[31m-#else[m
[31m-   Value *value = value_.map_->find( key );[m
[31m-   if (value){[m
[31m-      Value old(*value);[m
[31m-      value_.map_.remove( key );[m
[31m-      return old;[m
[31m-   } else {[m
[31m-      return null;[m
[31m-   }[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-Value[m
[31m-Value::removeMember( const std::string &key )[m
[31m-{[m
[31m-   return removeMember( key.c_str() );[m
[31m-}[m
[31m-[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-Value [m
[31m-Value::get( const CppTL::ConstString &key,[m
[31m-            const Value &defaultValue ) const[m
[31m-{[m
[31m-   return get( key.c_str(), defaultValue );[m
[31m-}[m
[31m-# endif[m
[31m-[m
[31m-bool [m
[31m-Value::isMember( const char *key ) const[m
[31m-{[m
[31m-   const Value *value = &((*this)[key]);[m
[31m-   return value != &null;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isMember( const std::string &key ) const[m
[31m-{[m
[31m-   return isMember( key.c_str() );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-# ifdef JSON_USE_CPPTL[m
[31m-bool [m
[31m-Value::isMember( const CppTL::ConstString &key ) const[m
[31m-{[m
[31m-   return isMember( key.c_str() );[m
[31m-}[m
[31m-#endif[m
[31m-[m
[31m-Value::Members [m
[31m-Value::getMemberNames() const[m
[31m-{[m
[31m-   JSON_ASSERT( type_ == nullValue  ||  type_ == objectValue );[m
[31m-   if ( type_ == nullValue )[m
[31m-       return Value::Members();[m
[31m-   Members members;[m
[31m-   members.reserve( value_.map_->size() );[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   ObjectValues::const_iterator it = value_.map_->begin();[m
[31m-   ObjectValues::const_iterator itEnd = value_.map_->end();[m
[31m-   for ( ; it != itEnd; ++it )[m
[31m-      members.push_back( std::string( (*it).first.c_str() ) );[m
[31m-#else[m
[31m-   ValueInternalMap::IteratorState it;[m
[31m-   ValueInternalMap::IteratorState itEnd;[m
[31m-   value_.map_->makeBeginIterator( it );[m
[31m-   value_.map_->makeEndIterator( itEnd );[m
[31m-   for ( ; !ValueInternalMap::equals( it, itEnd ); ValueInternalMap::increment(it) )[m
[31m-      members.push_back( std::string( ValueInternalMap::key( it ) ) );[m
[31m-#endif[m
[31m-   return members;[m
[31m-}[m
[31m-//[m
[31m-//# ifdef JSON_USE_CPPTL[m
[31m-//EnumMemberNames[m
[31m-//Value::enumMemberNames() const[m
[31m-//{[m
[31m-//   if ( type_ == objectValue )[m
[31m-//   {[m
[31m-//      return CppTL::Enum::any(  CppTL::Enum::transform([m
[31m-//         CppTL::Enum::keys( *(value_.map_), CppTL::Type<const CZString &>() ),[m
[31m-//         MemberNamesTransform() ) );[m
[31m-//   }[m
[31m-//   return EnumMemberNames();[m
[31m-//}[m
[31m-//[m
[31m-//[m
[31m-//EnumValues [m
[31m-//Value::enumValues() const[m
[31m-//{[m
[31m-//   if ( type_ == objectValue  ||  type_ == arrayValue )[m
[31m-//      return CppTL::Enum::anyValues( *(value_.map_), [m
[31m-//                                     CppTL::Type<const Value &>() );[m
[31m-//   return EnumValues();[m
[31m-//}[m
[31m-//[m
[31m-//# endif[m
[31m-[m
[31m-[m
[31m-bool[m
[31m-Value::isNull() const[m
[31m-{[m
[31m-   return type_ == nullValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isBool() const[m
[31m-{[m
[31m-   return type_ == booleanValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isInt() const[m
[31m-{[m
[31m-   return type_ == intValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isUInt() const[m
[31m-{[m
[31m-   return type_ == uintValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isIntegral() const[m
[31m-{[m
[31m-   return type_ == intValue  [m
[31m-          ||  type_ == uintValue  [m
[31m-          ||  type_ == booleanValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isDouble() const[m
[31m-{[m
[31m-   return type_ == realValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isNumeric() const[m
[31m-{[m
[31m-   return isIntegral() || isDouble();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isString() const[m
[31m-{[m
[31m-   return type_ == stringValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isArray() const[m
[31m-{[m
[31m-   return type_ == nullValue  ||  type_ == arrayValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::isObject() const[m
[31m-{[m
[31m-   return type_ == nullValue  ||  type_ == objectValue;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Value::setComment( const char *comment,[m
[31m-                   CommentPlacement placement )[m
[31m-{[m
[31m-   if ( !comments_ )[m
[31m-      comments_ = new CommentInfo[numberOfCommentPlacement];[m
[31m-   comments_[placement].setComment( comment );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Value::setComment( const std::string &comment,[m
[31m-                   CommentPlacement placement )[m
[31m-{[m
[31m-   setComment( comment.c_str(), placement );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-Value::hasComment( CommentPlacement placement ) const[m
[31m-{[m
[31m-   return comments_ != 0  &&  comments_[placement].comment_ != 0;[m
[31m-}[m
[31m-[m
[31m-std::string [m
[31m-Value::getComment( CommentPlacement placement ) const[m
[31m-{[m
[31m-   if ( hasComment(placement) )[m
[31m-      return comments_[placement].comment_;[m
[31m-   return "";[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-Value::toStyledString() const[m
[31m-{[m
[31m-   StyledWriter writer;[m
[31m-   return writer.write( *this );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::const_iterator [m
[31m-Value::begin() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-      if ( value_.array_ )[m
[31m-      {[m
[31m-         ValueInternalArray::IteratorState it;[m
[31m-         value_.array_->makeBeginIterator( it );[m
[31m-         return const_iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-      {[m
[31m-         ValueInternalMap::IteratorState it;[m
[31m-         value_.map_->makeBeginIterator( it );[m
[31m-         return const_iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-         return const_iterator( value_.map_->begin() );[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      break;[m
[31m-   }[m
[31m-   return const_iterator();[m
[31m-}[m
[31m-[m
[31m-Value::const_iterator [m
[31m-Value::end() const[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-      if ( value_.array_ )[m
[31m-      {[m
[31m-         ValueInternalArray::IteratorState it;[m
[31m-         value_.array_->makeEndIterator( it );[m
[31m-         return const_iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-      {[m
[31m-         ValueInternalMap::IteratorState it;[m
[31m-         value_.map_->makeEndIterator( it );[m
[31m-         return const_iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-         return const_iterator( value_.map_->end() );[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      break;[m
[31m-   }[m
[31m-   return const_iterator();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value::iterator [m
[31m-Value::begin()[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-      if ( value_.array_ )[m
[31m-      {[m
[31m-         ValueInternalArray::IteratorState it;[m
[31m-         value_.array_->makeBeginIterator( it );[m
[31m-         return iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-      {[m
[31m-         ValueInternalMap::IteratorState it;[m
[31m-         value_.map_->makeBeginIterator( it );[m
[31m-         return iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-         return iterator( value_.map_->begin() );[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      break;[m
[31m-   }[m
[31m-   return iterator();[m
[31m-}[m
[31m-[m
[31m-Value::iterator [m
[31m-Value::end()[m
[31m-{[m
[31m-   switch ( type_ )[m
[31m-   {[m
[31m-#ifdef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   case arrayValue:[m
[31m-      if ( value_.array_ )[m
[31m-      {[m
[31m-         ValueInternalArray::IteratorState it;[m
[31m-         value_.array_->makeEndIterator( it );[m
[31m-         return iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-      {[m
[31m-         ValueInternalMap::IteratorState it;[m
[31m-         value_.map_->makeEndIterator( it );[m
[31m-         return iterator( it );[m
[31m-      }[m
[31m-      break;[m
[31m-#else[m
[31m-   case arrayValue:[m
[31m-   case objectValue:[m
[31m-      if ( value_.map_ )[m
[31m-         return iterator( value_.map_->end() );[m
[31m-      break;[m
[31m-#endif[m
[31m-   default:[m
[31m-      break;[m
[31m-   }[m
[31m-   return iterator();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// class PathArgument[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-PathArgument::PathArgument()[m
[31m-   : kind_( kindNone )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-PathArgument::PathArgument( Value::UInt index )[m
[31m-   : index_( index )[m
[31m-   , kind_( kindIndex )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-PathArgument::PathArgument( const char *key )[m
[31m-   : key_( key )[m
[31m-   , kind_( kindKey )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-PathArgument::PathArgument( const std::string &key )[m
[31m-   : key_( key.c_str() )[m
[31m-   , kind_( kindKey )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-// class Path[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-Path::Path( const std::string &path,[m
[31m-            const PathArgument &a1,[m
[31m-            const PathArgument &a2,[m
[31m-            const PathArgument &a3,[m
[31m-            const PathArgument &a4,[m
[31m-            const PathArgument &a5 )[m
[31m-{[m
[31m-   InArgs in;[m
[31m-   in.push_back( &a1 );[m
[31m-   in.push_back( &a2 );[m
[31m-   in.push_back( &a3 );[m
[31m-   in.push_back( &a4 );[m
[31m-   in.push_back( &a5 );[m
[31m-   makePath( path, in );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Path::makePath( const std::string &path,[m
[31m-                const InArgs &in )[m
[31m-{[m
[31m-   const char *current = path.c_str();[m
[31m-   const char *end = current + path.length();[m
[31m-   InArgs::const_iterator itInArg = in.begin();[m
[31m-   while ( current != end )[m
[31m-   {[m
[31m-      if ( *current == '[' )[m
[31m-      {[m
[31m-         ++current;[m
[31m-         if ( *current == '%' )[m
[31m-            addPathInArg( path, in, itInArg, PathArgument::kindIndex );[m
[31m-         else[m
[31m-         {[m
[31m-            Value::UInt index = 0;[m
[31m-            for ( ; current != end && *current >= '0'  &&  *current <= '9'; ++current )[m
[31m-               index = index * 10 + Value::UInt(*current - '0');[m
[31m-            args_.push_back( index );[m
[31m-         }[m
[31m-         if ( current == end  ||  *current++ != ']' )[m
[31m-            invalidPath( path, int(current - path.c_str()) );[m
[31m-      }[m
[31m-      else if ( *current == '%' )[m
[31m-      {[m
[31m-         addPathInArg( path, in, itInArg, PathArgument::kindKey );[m
[31m-         ++current;[m
[31m-      }[m
[31m-      else if ( *current == '.' )[m
[31m-      {[m
[31m-         ++current;[m
[31m-      }[m
[31m-      else[m
[31m-      {[m
[31m-         const char *beginName = current;[m
[31m-         while ( current != end  &&  !strchr( "[.", *current ) )[m
[31m-            ++current;[m
[31m-         args_.push_back( std::string( beginName, current ) );[m
[31m-      }[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Path::addPathInArg( const std::string &path, [m
[31m-                    const InArgs &in, [m
[31m-                    InArgs::const_iterator &itInArg, [m
[31m-                    PathArgument::Kind kind )[m
[31m-{[m
[31m-   if ( itInArg == in.end() )[m
[31m-   {[m
[31m-      // Error: missing argument %d[m
[31m-   }[m
[31m-   else if ( (*itInArg)->kind_ != kind )[m
[31m-   {[m
[31m-      // Error: bad argument type[m
[31m-   }[m
[31m-   else[m
[31m-   {[m
[31m-      args_.push_back( **itInArg );[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-Path::invalidPath( const std::string &path, [m
[31m-                   int location )[m
[31m-{[m
[31m-   // Error: invalid path.[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const Value &[m
[31m-Path::resolve( const Value &root ) const[m
[31m-{[m
[31m-   const Value *node = &root;[m
[31m-   for ( Args::const_iterator it = args_.begin(); it != args_.end(); ++it )[m
[31m-   {[m
[31m-      const PathArgument &arg = *it;[m
[31m-      if ( arg.kind_ == PathArgument::kindIndex )[m
[31m-      {[m
[31m-         if ( !node->isArray()  ||  node->isValidIndex( arg.index_ ) )[m
[31m-         {[m
[31m-            // Error: unable to resolve path (array value expected at position...[m
[31m-         }[m
[31m-         node = &((*node)[arg.index_]);[m
[31m-      }[m
[31m-      else if ( arg.kind_ == PathArgument::kindKey )[m
[31m-      {[m
[31m-         if ( !node->isObject() )[m
[31m-         {[m
[31m-            // Error: unable to resolve path (object value expected at position...)[m
[31m-         }[m
[31m-         node = &((*node)[arg.key_]);[m
[31m-         if ( node == &Value::null )[m
[31m-         {[m
[31m-            // Error: unable to resolve path (object has no member named '' at position...)[m
[31m-         }[m
[31m-      }[m
[31m-   }[m
[31m-   return *node;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value [m
[31m-Path::resolve( const Value &root, [m
[31m-               const Value &defaultValue ) const[m
[31m-{[m
[31m-   const Value *node = &root;[m
[31m-   for ( Args::const_iterator it = args_.begin(); it != args_.end(); ++it )[m
[31m-   {[m
[31m-      const PathArgument &arg = *it;[m
[31m-      if ( arg.kind_ == PathArgument::kindIndex )[m
[31m-      {[m
[31m-         if ( !node->isArray()  ||  node->isValidIndex( arg.index_ ) )[m
[31m-            return defaultValue;[m
[31m-         node = &((*node)[arg.index_]);[m
[31m-      }[m
[31m-      else if ( arg.kind_ == PathArgument::kindKey )[m
[31m-      {[m
[31m-         if ( !node->isObject() )[m
[31m-            return defaultValue;[m
[31m-         node = &((*node)[arg.key_]);[m
[31m-         if ( node == &Value::null )[m
[31m-            return defaultValue;[m
[31m-      }[m
[31m-   }[m
[31m-   return *node;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value &[m
[31m-Path::make( Value &root ) const[m
[31m-{[m
[31m-   Value *node = &root;[m
[31m-   for ( Args::const_iterator it = args_.begin(); it != args_.end(); ++it )[m
[31m-   {[m
[31m-      const PathArgument &arg = *it;[m
[31m-      if ( arg.kind_ == PathArgument::kindIndex )[m
[31m-      {[m
[31m-         if ( !node->isArray() )[m
[31m-         {[m
[31m-            // Error: node is not an array at position ...[m
[31m-         }[m
[31m-         node = &((*node)[arg.index_]);[m
[31m-      }[m
[31m-      else if ( arg.kind_ == PathArgument::kindKey )[m
[31m-      {[m
[31m-         if ( !node->isObject() )[m
[31m-         {[m
[31m-            // Error: node is not an object at position...[m
[31m-         }[m
[31m-         node = &((*node)[arg.key_]);[m
[31m-      }[m
[31m-   }[m
[31m-   return *node;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-} // namespace Json[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_valueiterator.inl b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_valueiterator.inl[m
[1mdeleted file mode 100755[m
[1mindex 736e260..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_valueiterator.inl[m
[1m+++ /dev/null[m
[36m@@ -1,292 +0,0 @@[m
[31m-// included by json_value.cpp[m
[31m-// everything is within Json namespace[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class ValueIteratorBase[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-ValueIteratorBase::ValueIteratorBase()[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   : current_()[m
[31m-   , isNull_( true )[m
[31m-{[m
[31m-}[m
[31m-#else[m
[31m-   : isArray_( true )[m
[31m-   , isNull_( true )[m
[31m-{[m
[31m-   iterator_.array_ = ValueInternalArray::IteratorState();[m
[31m-}[m
[31m-#endif[m
[31m-[m
[31m-[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-ValueIteratorBase::ValueIteratorBase( const Value::ObjectValues::iterator &current )[m
[31m-   : current_( current )[m
[31m-   , isNull_( false )[m
[31m-{[m
[31m-}[m
[31m-#else[m
[31m-ValueIteratorBase::ValueIteratorBase( const ValueInternalArray::IteratorState &state )[m
[31m-   : isArray_( true )[m
[31m-{[m
[31m-   iterator_.array_ = state;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueIteratorBase::ValueIteratorBase( const ValueInternalMap::IteratorState &state )[m
[31m-   : isArray_( false )[m
[31m-{[m
[31m-   iterator_.map_ = state;[m
[31m-}[m
[31m-#endif[m
[31m-[m
[31m-Value &[m
[31m-ValueIteratorBase::deref() const[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   return current_->second;[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      return ValueInternalArray::dereference( iterator_.array_ );[m
[31m-   return ValueInternalMap::value( iterator_.map_ );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueIteratorBase::increment()[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   ++current_;[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      ValueInternalArray::increment( iterator_.array_ );[m
[31m-   ValueInternalMap::increment( iterator_.map_ );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueIteratorBase::decrement()[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   --current_;[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      ValueInternalArray::decrement( iterator_.array_ );[m
[31m-   ValueInternalMap::decrement( iterator_.map_ );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-ValueIteratorBase::difference_type [m
[31m-ValueIteratorBase::computeDistance( const SelfType &other ) const[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-# ifdef JSON_USE_CPPTL_SMALLMAP[m
[31m-   return current_ - other.current_;[m
[31m-# else[m
[31m-   // Iterator for null value are initialized using the default[m
[31m-   // constructor, which initialize current_ to the default[m
[31m-   // std::map::iterator. As begin() and end() are two instance [m
[31m-   // of the default std::map::iterator, they can not be compared.[m
[31m-   // To allow this, we handle this comparison specifically.[m
[31m-   if ( isNull_  &&  other.isNull_ )[m
[31m-   {[m
[31m-      return 0;[m
[31m-   }[m
[31m-[m
[31m-[m
[31m-   // Usage of std::distance is not portable (does not compile with Sun Studio 12 RogueWave STL,[m
[31m-   // which is the one used by default).[m
[31m-   // Using a portable hand-made version for non random iterator instead:[m
[31m-   //   return difference_type( std::distance( current_, other.current_ ) );[m
[31m-   difference_type myDistance = 0;[m
[31m-   for ( Value::ObjectValues::iterator it = current_; it != other.current_; ++it )[m
[31m-   {[m
[31m-      ++myDistance;[m
[31m-   }[m
[31m-   return myDistance;[m
[31m-# endif[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      return ValueInternalArray::distance( iterator_.array_, other.iterator_.array_ );[m
[31m-   return ValueInternalMap::distance( iterator_.map_, other.iterator_.map_ );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-ValueIteratorBase::isEqual( const SelfType &other ) const[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   if ( isNull_ )[m
[31m-   {[m
[31m-      return other.isNull_;[m
[31m-   }[m
[31m-   return current_ == other.current_;[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      return ValueInternalArray::equals( iterator_.array_, other.iterator_.array_ );[m
[31m-   return ValueInternalMap::equals( iterator_.map_, other.iterator_.map_ );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-ValueIteratorBase::copy( const SelfType &other )[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   current_ = other.current_;[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      iterator_.array_ = other.iterator_.array_;[m
[31m-   iterator_.map_ = other.iterator_.map_;[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Value [m
[31m-ValueIteratorBase::key() const[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   const Value::CZString czstring = (*current_).first;[m
[31m-   if ( czstring.c_str() )[m
[31m-   {[m
[31m-      if ( czstring.isStaticString() )[m
[31m-         return Value( StaticString( czstring.c_str() ) );[m
[31m-      return Value( czstring.c_str() );[m
[31m-   }[m
[31m-   return Value( czstring.index() );[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      return Value( ValueInternalArray::indexOf( iterator_.array_ ) );[m
[31m-   bool isStatic;[m
[31m-   const char *memberName = ValueInternalMap::key( iterator_.map_, isStatic );[m
[31m-   if ( isStatic )[m
[31m-      return Value( StaticString( memberName ) );[m
[31m-   return Value( memberName );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-UInt [m
[31m-ValueIteratorBase::index() const[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   const Value::CZString czstring = (*current_).first;[m
[31m-   if ( !czstring.c_str() )[m
[31m-      return czstring.index();[m
[31m-   return Value::UInt( -1 );[m
[31m-#else[m
[31m-   if ( isArray_ )[m
[31m-      return Value::UInt( ValueInternalArray::indexOf( iterator_.array_ ) );[m
[31m-   return Value::UInt( -1 );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const char *[m
[31m-ValueIteratorBase::memberName() const[m
[31m-{[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-   const char *name = (*current_).first.c_str();[m
[31m-   return name ? name : "";[m
[31m-#else[m
[31m-   if ( !isArray_ )[m
[31m-      return ValueInternalMap::key( iterator_.map_ );[m
[31m-   return "";[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class ValueConstIterator[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-ValueConstIterator::ValueConstIterator()[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-ValueConstIterator::ValueConstIterator( const Value::ObjectValues::iterator &current )[m
[31m-   : ValueIteratorBase( current )[m
[31m-{[m
[31m-}[m
[31m-#else[m
[31m-ValueConstIterator::ValueConstIterator( const ValueInternalArray::IteratorState &state )[m
[31m-   : ValueIteratorBase( state )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-ValueConstIterator::ValueConstIterator( const ValueInternalMap::IteratorState &state )[m
[31m-   : ValueIteratorBase( state )[m
[31m-{[m
[31m-}[m
[31m-#endif[m
[31m-[m
[31m-ValueConstIterator &[m
[31m-ValueConstIterator::operator =( const ValueIteratorBase &other )[m
[31m-{[m
[31m-   copy( other );[m
[31m-   return *this;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// class ValueIterator[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-ValueIterator::ValueIterator()[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-#ifndef JSON_VALUE_USE_INTERNAL_MAP[m
[31m-ValueIterator::ValueIterator( const Value::ObjectValues::iterator &current )[m
[31m-   : ValueIteratorBase( current )[m
[31m-{[m
[31m-}[m
[31m-#else[m
[31m-ValueIterator::ValueIterator( const ValueInternalArray::IteratorState &state )[m
[31m-   : ValueIteratorBase( state )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-ValueIterator::ValueIterator( const ValueInternalMap::IteratorState &state )[m
[31m-   : ValueIteratorBase( state )[m
[31m-{[m
[31m-}[m
[31m-#endif[m
[31m-[m
[31m-ValueIterator::ValueIterator( const ValueConstIterator &other )[m
[31m-   : ValueIteratorBase( other )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-ValueIterator::ValueIterator( const ValueIterator &other )[m
[31m-   : ValueIteratorBase( other )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-ValueIterator &[m
[31m-ValueIterator::operator =( const SelfType &other )[m
[31m-{[m
[31m-   copy( other );[m
[31m-   return *this;[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_writer.cpp b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_writer.cpp[m
[1mdeleted file mode 100755[m
[1mindex cdf4188..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/json_writer.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,829 +0,0 @@[m
[31m-#include <json/writer.h>[m
[31m-#include <utility>[m
[31m-#include <assert.h>[m
[31m-#include <stdio.h>[m
[31m-#include <string.h>[m
[31m-#include <iostream>[m
[31m-#include <sstream>[m
[31m-#include <iomanip>[m
[31m-[m
[31m-#if _MSC_VER >= 1400 // VC++ 8.0[m
[31m-#pragma warning( disable : 4996 )   // disable warning about strdup being deprecated.[m
[31m-#endif[m
[31m-[m
[31m-namespace Json {[m
[31m-[m
[31m-static bool isControlCharacter(char ch)[m
[31m-{[m
[31m-   return ch > 0 && ch <= 0x1F;[m
[31m-}[m
[31m-[m
[31m-static bool containsControlCharacter( const char* str )[m
[31m-{[m
[31m-   while ( *str ) [m
[31m-   {[m
[31m-      if ( isControlCharacter( *(str++) ) )[m
[31m-         return true;[m
[31m-   }[m
[31m-   return false;[m
[31m-}[m
[31m-static void uintToString( unsigned int value, [m
[31m-                          char *&current )[m
[31m-{[m
[31m-   *--current = 0;[m
[31m-   do[m
[31m-   {[m
[31m-      *--current = (value % 10) + '0';[m
[31m-      value /= 10;[m
[31m-   }[m
[31m-   while ( value != 0 );[m
[31m-}[m
[31m-[m
[31m-std::string valueToString( Int value )[m
[31m-{[m
[31m-   char buffer[32];[m
[31m-   char *current = buffer + sizeof(buffer);[m
[31m-   bool isNegative = value < 0;[m
[31m-   if ( isNegative )[m
[31m-      value = -value;[m
[31m-   uintToString( UInt(value), current );[m
[31m-   if ( isNegative )[m
[31m-      *--current = '-';[m
[31m-   assert( current >= buffer );[m
[31m-   return current;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string valueToString( UInt value )[m
[31m-{[m
[31m-   char buffer[32];[m
[31m-   char *current = buffer + sizeof(buffer);[m
[31m-   uintToString( value, current );[m
[31m-   assert( current >= buffer );[m
[31m-   return current;[m
[31m-}[m
[31m-[m
[31m-std::string valueToString( double value )[m
[31m-{[m
[31m-   char buffer[32];[m
[31m-#if defined(_MSC_VER) && defined(__STDC_SECURE_LIB__) // Use secure version with visual studio 2005 to avoid warning. [m
[31m-   sprintf_s(buffer, sizeof(buffer), "%#.16g", value); [m
[31m-#else	[m
[31m-   sprintf(buffer, "%#.16g", value); [m
[31m-#endif[m
[31m-   char* ch = buffer + strlen(buffer) - 1;[m
[31m-   if (*ch != '0') return buffer; // nothing to truncate, so save time[m
[31m-   while(ch > buffer && *ch == '0'){[m
[31m-     --ch;[m
[31m-   }[m
[31m-   char* last_nonzero = ch;[m
[31m-   while(ch >= buffer){[m
[31m-     switch(*ch){[m
[31m-     case '0':[m
[31m-     case '1':[m
[31m-     case '2':[m
[31m-     case '3':[m
[31m-     case '4':[m
[31m-     case '5':[m
[31m-     case '6':[m
[31m-     case '7':[m
[31m-     case '8':[m
[31m-     case '9':[m
[31m-       --ch;[m
[31m-       continue;[m
[31m-     case '.':[m
[31m-       // Truncate zeroes to save bytes in output, but keep one.[m
[31m-       *(last_nonzero+2) = '\0';[m
[31m-       return buffer;[m
[31m-     default:[m
[31m-       return buffer;[m
[31m-     }[m
[31m-   }[m
[31m-   return buffer;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string valueToString( bool value )[m
[31m-{[m
[31m-   return value ? "true" : "false";[m
[31m-}[m
[31m-[m
[31m-std::string valueToQuotedString( const char *value )[m
[31m-{[m
[31m-   // Not sure how to handle unicode...[m
[31m-   if (strpbrk(value, "\"\\\b\f\n\r\t") == NULL && !containsControlCharacter( value ))[m
[31m-      return std::string("\"") + value + "\"";[m
[31m-   // We have to walk value and escape any special characters.[m
[31m-   // Appending to std::string is not efficient, but this should be rare.[m
[31m-   // (Note: forward slashes are *not* rare, but I am not escaping them.)[m
[31m-   unsigned maxsize = strlen(value)*2 + 3; // allescaped+quotes+NULL[m
[31m-   std::string result;[m
[31m-   result.reserve(maxsize); // to avoid lots of mallocs[m
[31m-   result += "\"";[m
[31m-   for (const char* c=value; *c != 0; ++c)[m
[31m-   {[m
[31m-      switch(*c)[m
[31m-      {[m
[31m-         case '\"':[m
[31m-            result += "\\\"";[m
[31m-            break;[m
[31m-         case '\\':[m
[31m-            result += "\\\\";[m
[31m-            break;[m
[31m-         case '\b':[m
[31m-            result += "\\b";[m
[31m-            break;[m
[31m-         case '\f':[m
[31m-            result += "\\f";[m
[31m-            break;[m
[31m-         case '\n':[m
[31m-            result += "\\n";[m
[31m-            break;[m
[31m-         case '\r':[m
[31m-            result += "\\r";[m
[31m-            break;[m
[31m-         case '\t':[m
[31m-            result += "\\t";[m
[31m-            break;[m
[31m-         //case '/':[m
[31m-            // Even though \/ is considered a legal escape in JSON, a bare[m
[31m-            // slash is also legal, so I see no reason to escape it.[m
[31m-            // (I hope I am not misunderstanding something.[m
[31m-            // blep notes: actually escaping \/ may be useful in javascript to avoid </ [m
[31m-            // sequence.[m
[31m-            // Should add a flag to allow this compatibility mode and prevent this [m
[31m-            // sequence from occurring.[m
[31m-         default:[m
[31m-            if ( isControlCharacter( *c ) )[m
[31m-            {[m
[31m-               std::ostringstream oss;[m
[31m-               oss << "\\u" << std::hex << std::uppercase << std::setfill('0') << std::setw(4) << static_cast<int>(*c);[m
[31m-               result += oss.str();[m
[31m-            }[m
[31m-            else[m
[31m-            {[m
[31m-               result += *c;[m
[31m-            }[m
[31m-            break;[m
[31m-      }[m
[31m-   }[m
[31m-   result += "\"";[m
[31m-   return result;[m
[31m-}[m
[31m-[m
[31m-// Class Writer[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-Writer::~Writer()[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// Class FastWriter[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-FastWriter::FastWriter()[m
[31m-   : yamlCompatiblityEnabled_( false )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-FastWriter::enableYAMLCompatibility()[m
[31m-{[m
[31m-   yamlCompatiblityEnabled_ = true;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-FastWriter::write( const Value &root )[m
[31m-{[m
[31m-   document_ = "";[m
[31m-   writeValue( root );[m
[31m-   document_ += "\n";[m
[31m-   return document_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-FastWriter::writeValue( const Value &value )[m
[31m-{[m
[31m-   switch ( value.type() )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      document_ += "null";[m
[31m-      break;[m
[31m-   case intValue:[m
[31m-      document_ += valueToString( value.asInt() );[m
[31m-      break;[m
[31m-   case uintValue:[m
[31m-      document_ += valueToString( value.asUInt() );[m
[31m-      break;[m
[31m-   case realValue:[m
[31m-      document_ += valueToString( value.asDouble() );[m
[31m-      break;[m
[31m-   case stringValue:[m
[31m-      document_ += valueToQuotedString( value.asCString() );[m
[31m-      break;[m
[31m-   case booleanValue:[m
[31m-      document_ += valueToString( value.asBool() );[m
[31m-      break;[m
[31m-   case arrayValue:[m
[31m-      {[m
[31m-         document_ += "[";[m
[31m-         int size = value.size();[m
[31m-         for ( int index =0; index < size; ++index )[m
[31m-         {[m
[31m-            if ( index > 0 )[m
[31m-               document_ += ",";[m
[31m-            writeValue( value[index] );[m
[31m-         }[m
[31m-         document_ += "]";[m
[31m-      }[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      {[m
[31m-         Value::Members members( value.getMemberNames() );[m
[31m-         document_ += "{";[m
[31m-         for ( Value::Members::iterator it = members.begin(); [m
[31m-               it != members.end(); [m
[31m-               ++it )[m
[31m-         {[m
[31m-            const std::string &name = *it;[m
[31m-            if ( it != members.begin() )[m
[31m-               document_ += ",";[m
[31m-            document_ += valueToQuotedString( name.c_str() );[m
[31m-            document_ += yamlCompatiblityEnabled_ ? ": " [m
[31m-                                                  : ":";[m
[31m-            writeValue( value[name] );[m
[31m-         }[m
[31m-         document_ += "}";[m
[31m-      }[m
[31m-      break;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// Class StyledWriter[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-StyledWriter::StyledWriter()[m
[31m-   : rightMargin_( 74 )[m
[31m-   , indentSize_( 3 )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-StyledWriter::write( const Value &root )[m
[31m-{[m
[31m-   document_ = "";[m
[31m-   addChildValues_ = false;[m
[31m-   indentString_ = "";[m
[31m-   writeCommentBeforeValue( root );[m
[31m-   writeValue( root );[m
[31m-   writeCommentAfterValueOnSameLine( root );[m
[31m-   document_ += "\n";[m
[31m-   return document_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::writeValue( const Value &value )[m
[31m-{[m
[31m-   switch ( value.type() )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      pushValue( "null" );[m
[31m-      break;[m
[31m-   case intValue:[m
[31m-      pushValue( valueToString( value.asInt() ) );[m
[31m-      break;[m
[31m-   case uintValue:[m
[31m-      pushValue( valueToString( value.asUInt() ) );[m
[31m-      break;[m
[31m-   case realValue:[m
[31m-      pushValue( valueToString( value.asDouble() ) );[m
[31m-      break;[m
[31m-   case stringValue:[m
[31m-      pushValue( valueToQuotedString( value.asCString() ) );[m
[31m-      break;[m
[31m-   case booleanValue:[m
[31m-      pushValue( valueToString( value.asBool() ) );[m
[31m-      break;[m
[31m-   case arrayValue:[m
[31m-      writeArrayValue( value);[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      {[m
[31m-         Value::Members members( value.getMemberNames() );[m
[31m-         if ( members.empty() )[m
[31m-            pushValue( "{}" );[m
[31m-         else[m
[31m-         {[m
[31m-            writeWithIndent( "{" );[m
[31m-            indent();[m
[31m-            Value::Members::iterator it = members.begin();[m
[31m-            while ( true )[m
[31m-            {[m
[31m-               const std::string &name = *it;[m
[31m-               const Value &childValue = value[name];[m
[31m-               writeCommentBeforeValue( childValue );[m
[31m-               writeWithIndent( valueToQuotedString( name.c_str() ) );[m
[31m-               document_ += " : ";[m
[31m-               writeValue( childValue );[m
[31m-               if ( ++it == members.end() )[m
[31m-               {[m
[31m-                  writeCommentAfterValueOnSameLine( childValue );[m
[31m-                  break;[m
[31m-               }[m
[31m-               document_ += ",";[m
[31m-               writeCommentAfterValueOnSameLine( childValue );[m
[31m-            }[m
[31m-            unindent();[m
[31m-            writeWithIndent( "}" );[m
[31m-         }[m
[31m-      }[m
[31m-      break;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::writeArrayValue( const Value &value )[m
[31m-{[m
[31m-   unsigned size = value.size();[m
[31m-   if ( size == 0 )[m
[31m-      pushValue( "[]" );[m
[31m-   else[m
[31m-   {[m
[31m-      bool isArrayMultiLine = isMultineArray( value );[m
[31m-      if ( isArrayMultiLine )[m
[31m-      {[m
[31m-         writeWithIndent( "[" );[m
[31m-         indent();[m
[31m-         bool hasChildValue = !childValues_.empty();[m
[31m-         unsigned index =0;[m
[31m-         while ( true )[m
[31m-         {[m
[31m-            const Value &childValue = value[index];[m
[31m-            writeCommentBeforeValue( childValue );[m
[31m-            if ( hasChildValue )[m
[31m-               writeWithIndent( childValues_[index] );[m
[31m-            else[m
[31m-            {[m
[31m-               writeIndent();[m
[31m-               writeValue( childValue );[m
[31m-            }[m
[31m-            if ( ++index == size )[m
[31m-            {[m
[31m-               writeCommentAfterValueOnSameLine( childValue );[m
[31m-               break;[m
[31m-            }[m
[31m-            document_ += ",";[m
[31m-            writeCommentAfterValueOnSameLine( childValue );[m
[31m-         }[m
[31m-         unindent();[m
[31m-         writeWithIndent( "]" );[m
[31m-      }[m
[31m-      else // output on a single line[m
[31m-      {[m
[31m-         assert( childValues_.size() == size );[m
[31m-         document_ += "[ ";[m
[31m-         for ( unsigned index =0; index < size; ++index )[m
[31m-         {[m
[31m-            if ( index > 0 )[m
[31m-               document_ += ", ";[m
[31m-            document_ += childValues_[index];[m
[31m-         }[m
[31m-         document_ += " ]";[m
[31m-      }[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-StyledWriter::isMultineArray( const Value &value )[m
[31m-{[m
[31m-   int size = value.size();[m
[31m-   bool isMultiLine = size*3 >= rightMargin_ ;[m
[31m-   childValues_.clear();[m
[31m-   for ( int index =0; index < size  &&  !isMultiLine; ++index )[m
[31m-   {[m
[31m-      const Value &childValue = value[index];[m
[31m-      isMultiLine = isMultiLine  ||[m
[31m-                     ( (childValue.isArray()  ||  childValue.isObject())  &&  [m
[31m-                        childValue.size() > 0 );[m
[31m-   }[m
[31m-   if ( !isMultiLine ) // check if line length > max line length[m
[31m-   {[m
[31m-      childValues_.reserve( size );[m
[31m-      addChildValues_ = true;[m
[31m-      int lineLength = 4 + (size-1)*2; // '[ ' + ', '*n + ' ]'[m
[31m-      for ( int index =0; index < size  &&  !isMultiLine; ++index )[m
[31m-      {[m
[31m-         writeValue( value[index] );[m
[31m-         lineLength += int( childValues_[index].length() );[m
[31m-         isMultiLine = isMultiLine  &&  hasCommentForValue( value[index] );[m
[31m-      }[m
[31m-      addChildValues_ = false;[m
[31m-      isMultiLine = isMultiLine  ||  lineLength >= rightMargin_;[m
[31m-   }[m
[31m-   return isMultiLine;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::pushValue( const std::string &value )[m
[31m-{[m
[31m-   if ( addChildValues_ )[m
[31m-      childValues_.push_back( value );[m
[31m-   else[m
[31m-      document_ += value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::writeIndent()[m
[31m-{[m
[31m-   if ( !document_.empty() )[m
[31m-   {[m
[31m-      char last = document_[document_.length()-1];[m
[31m-      if ( last == ' ' )     // already indented[m
[31m-         return;[m
[31m-      if ( last != '\n' )    // Comments may add new-line[m
[31m-         document_ += '\n';[m
[31m-   }[m
[31m-   document_ += indentString_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::writeWithIndent( const std::string &value )[m
[31m-{[m
[31m-   writeIndent();[m
[31m-   document_ += value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::indent()[m
[31m-{[m
[31m-   indentString_ += std::string( indentSize_, ' ' );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::unindent()[m
[31m-{[m
[31m-   assert( int(indentString_.size()) >= indentSize_ );[m
[31m-   indentString_.resize( indentString_.size() - indentSize_ );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::writeCommentBeforeValue( const Value &root )[m
[31m-{[m
[31m-   if ( !root.hasComment( commentBefore ) )[m
[31m-      return;[m
[31m-   document_ += normalizeEOL( root.getComment( commentBefore ) );[m
[31m-   document_ += "\n";[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledWriter::writeCommentAfterValueOnSameLine( const Value &root )[m
[31m-{[m
[31m-   if ( root.hasComment( commentAfterOnSameLine ) )[m
[31m-      document_ += " " + normalizeEOL( root.getComment( commentAfterOnSameLine ) );[m
[31m-[m
[31m-   if ( root.hasComment( commentAfter ) )[m
[31m-   {[m
[31m-      document_ += "\n";[m
[31m-      document_ += normalizeEOL( root.getComment( commentAfter ) );[m
[31m-      document_ += "\n";[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-StyledWriter::hasCommentForValue( const Value &value )[m
[31m-{[m
[31m-   return value.hasComment( commentBefore )[m
[31m-          ||  value.hasComment( commentAfterOnSameLine )[m
[31m-          ||  value.hasComment( commentAfter );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-StyledWriter::normalizeEOL( const std::string &text )[m
[31m-{[m
[31m-   std::string normalized;[m
[31m-   normalized.reserve( text.length() );[m
[31m-   const char *begin = text.c_str();[m
[31m-   const char *end = begin + text.length();[m
[31m-   const char *current = begin;[m
[31m-   while ( current != end )[m
[31m-   {[m
[31m-      char c = *current++;[m
[31m-      if ( c == '\r' ) // mac or dos EOL[m
[31m-      {[m
[31m-         if ( *current == '\n' ) // convert dos EOL[m
[31m-            ++current;[m
[31m-         normalized += '\n';[m
[31m-      }[m
[31m-      else // handle unix EOL & other char[m
[31m-         normalized += c;[m
[31m-   }[m
[31m-   return normalized;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// Class StyledStreamWriter[m
[31m-// //////////////////////////////////////////////////////////////////[m
[31m-[m
[31m-StyledStreamWriter::StyledStreamWriter( std::string indentation )[m
[31m-   : document_(NULL)[m
[31m-   , rightMargin_( 74 )[m
[31m-   , indentation_( indentation )[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void[m
[31m-StyledStreamWriter::write( std::ostream &out, const Value &root )[m
[31m-{[m
[31m-   document_ = &out;[m
[31m-   addChildValues_ = false;[m
[31m-   indentString_ = "";[m
[31m-   writeCommentBeforeValue( root );[m
[31m-   writeValue( root );[m
[31m-   writeCommentAfterValueOnSameLine( root );[m
[31m-   *document_ << "\n";[m
[31m-   document_ = NULL; // Forget the stream, for safety.[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::writeValue( const Value &value )[m
[31m-{[m
[31m-   switch ( value.type() )[m
[31m-   {[m
[31m-   case nullValue:[m
[31m-      pushValue( "null" );[m
[31m-      break;[m
[31m-   case intValue:[m
[31m-      pushValue( valueToString( value.asInt() ) );[m
[31m-      break;[m
[31m-   case uintValue:[m
[31m-      pushValue( valueToString( value.asUInt() ) );[m
[31m-      break;[m
[31m-   case realValue:[m
[31m-      pushValue( valueToString( value.asDouble() ) );[m
[31m-      break;[m
[31m-   case stringValue:[m
[31m-      pushValue( valueToQuotedString( value.asCString() ) );[m
[31m-      break;[m
[31m-   case booleanValue:[m
[31m-      pushValue( valueToString( value.asBool() ) );[m
[31m-      break;[m
[31m-   case arrayValue:[m
[31m-      writeArrayValue( value);[m
[31m-      break;[m
[31m-   case objectValue:[m
[31m-      {[m
[31m-         Value::Members members( value.getMemberNames() );[m
[31m-         if ( members.empty() )[m
[31m-            pushValue( "{}" );[m
[31m-         else[m
[31m-         {[m
[31m-            writeWithIndent( "{" );[m
[31m-            indent();[m
[31m-            Value::Members::iterator it = members.begin();[m
[31m-            while ( true )[m
[31m-            {[m
[31m-               const std::string &name = *it;[m
[31m-               const Value &childValue = value[name];[m
[31m-               writeCommentBeforeValue( childValue );[m
[31m-               writeWithIndent( valueToQuotedString( name.c_str() ) );[m
[31m-               *document_ << " : ";[m
[31m-               writeValue( childValue );[m
[31m-               if ( ++it == members.end() )[m
[31m-               {[m
[31m-                  writeCommentAfterValueOnSameLine( childValue );[m
[31m-                  break;[m
[31m-               }[m
[31m-               *document_ << ",";[m
[31m-               writeCommentAfterValueOnSameLine( childValue );[m
[31m-            }[m
[31m-            unindent();[m
[31m-            writeWithIndent( "}" );[m
[31m-         }[m
[31m-      }[m
[31m-      break;[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::writeArrayValue( const Value &value )[m
[31m-{[m
[31m-   unsigned size = value.size();[m
[31m-   if ( size == 0 )[m
[31m-      pushValue( "[]" );[m
[31m-   else[m
[31m-   {[m
[31m-      bool isArrayMultiLine = isMultineArray( value );[m
[31m-      if ( isArrayMultiLine )[m
[31m-      {[m
[31m-         writeWithIndent( "[" );[m
[31m-         indent();[m
[31m-         bool hasChildValue = !childValues_.empty();[m
[31m-         unsigned index =0;[m
[31m-         while ( true )[m
[31m-         {[m
[31m-            const Value &childValue = value[index];[m
[31m-            writeCommentBeforeValue( childValue );[m
[31m-            if ( hasChildValue )[m
[31m-               writeWithIndent( childValues_[index] );[m
[31m-            else[m
[31m-            {[m
[31m-	       writeIndent();[m
[31m-               writeValue( childValue );[m
[31m-            }[m
[31m-            if ( ++index == size )[m
[31m-            {[m
[31m-               writeCommentAfterValueOnSameLine( childValue );[m
[31m-               break;[m
[31m-            }[m
[31m-            *document_ << ",";[m
[31m-            writeCommentAfterValueOnSameLine( childValue );[m
[31m-         }[m
[31m-         unindent();[m
[31m-         writeWithIndent( "]" );[m
[31m-      }[m
[31m-      else // output on a single line[m
[31m-      {[m
[31m-         assert( childValues_.size() == size );[m
[31m-         *document_ << "[ ";[m
[31m-         for ( unsigned index =0; index < size; ++index )[m
[31m-         {[m
[31m-            if ( index > 0 )[m
[31m-               *document_ << ", ";[m
[31m-            *document_ << childValues_[index];[m
[31m-         }[m
[31m-         *document_ << " ]";[m
[31m-      }[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-StyledStreamWriter::isMultineArray( const Value &value )[m
[31m-{[m
[31m-   int size = value.size();[m
[31m-   bool isMultiLine = size*3 >= rightMargin_ ;[m
[31m-   childValues_.clear();[m
[31m-   for ( int index =0; index < size  &&  !isMultiLine; ++index )[m
[31m-   {[m
[31m-      const Value &childValue = value[index];[m
[31m-      isMultiLine = isMultiLine  ||[m
[31m-                     ( (childValue.isArray()  ||  childValue.isObject())  &&  [m
[31m-                        childValue.size() > 0 );[m
[31m-   }[m
[31m-   if ( !isMultiLine ) // check if line length > max line length[m
[31m-   {[m
[31m-      childValues_.reserve( size );[m
[31m-      addChildValues_ = true;[m
[31m-      int lineLength = 4 + (size-1)*2; // '[ ' + ', '*n + ' ]'[m
[31m-      for ( int index =0; index < size  &&  !isMultiLine; ++index )[m
[31m-      {[m
[31m-         writeValue( value[index] );[m
[31m-         lineLength += int( childValues_[index].length() );[m
[31m-         isMultiLine = isMultiLine  &&  hasCommentForValue( value[index] );[m
[31m-      }[m
[31m-      addChildValues_ = false;[m
[31m-      isMultiLine = isMultiLine  ||  lineLength >= rightMargin_;[m
[31m-   }[m
[31m-   return isMultiLine;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::pushValue( const std::string &value )[m
[31m-{[m
[31m-   if ( addChildValues_ )[m
[31m-      childValues_.push_back( value );[m
[31m-   else[m
[31m-      *document_ << value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::writeIndent()[m
[31m-{[m
[31m-  /*[m
[31m-    Some comments in this method would have been nice. ;-)[m
[31m-[m
[31m-   if ( !document_.empty() )[m
[31m-   {[m
[31m-      char last = document_[document_.length()-1];[m
[31m-      if ( last == ' ' )     // already indented[m
[31m-         return;[m
[31m-      if ( last != '\n' )    // Comments may add new-line[m
[31m-         *document_ << '\n';[m
[31m-   }[m
[31m-  */[m
[31m-   *document_ << '\n' << indentString_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::writeWithIndent( const std::string &value )[m
[31m-{[m
[31m-   writeIndent();[m
[31m-   *document_ << value;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::indent()[m
[31m-{[m
[31m-   indentString_ += indentation_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::unindent()[m
[31m-{[m
[31m-   assert( indentString_.size() >= indentation_.size() );[m
[31m-   indentString_.resize( indentString_.size() - indentation_.size() );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::writeCommentBeforeValue( const Value &root )[m
[31m-{[m
[31m-   if ( !root.hasComment( commentBefore ) )[m
[31m-      return;[m
[31m-   *document_ << normalizeEOL( root.getComment( commentBefore ) );[m
[31m-   *document_ << "\n";[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void [m
[31m-StyledStreamWriter::writeCommentAfterValueOnSameLine( const Value &root )[m
[31m-{[m
[31m-   if ( root.hasComment( commentAfterOnSameLine ) )[m
[31m-      *document_ << " " + normalizeEOL( root.getComment( commentAfterOnSameLine ) );[m
[31m-[m
[31m-   if ( root.hasComment( commentAfter ) )[m
[31m-   {[m
[31m-      *document_ << "\n";[m
[31m-      *document_ << normalizeEOL( root.getComment( commentAfter ) );[m
[31m-      *document_ << "\n";[m
[31m-   }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-bool [m
[31m-StyledStreamWriter::hasCommentForValue( const Value &value )[m
[31m-{[m
[31m-   return value.hasComment( commentBefore )[m
[31m-          ||  value.hasComment( commentAfterOnSameLine )[m
[31m-          ||  value.hasComment( commentAfter );[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::string [m
[31m-StyledStreamWriter::normalizeEOL( const std::string &text )[m
[31m-{[m
[31m-   std::string normalized;[m
[31m-   normalized.reserve( text.length() );[m
[31m-   const char *begin = text.c_str();[m
[31m-   const char *end = begin + text.length();[m
[31m-   const char *current = begin;[m
[31m-   while ( current != end )[m
[31m-   {[m
[31m-      char c = *current++;[m
[31m-      if ( c == '\r' ) // mac or dos EOL[m
[31m-      {[m
[31m-         if ( *current == '\n' ) // convert dos EOL[m
[31m-            ++current;[m
[31m-         normalized += '\n';[m
[31m-      }[m
[31m-      else // handle unix EOL & other char[m
[31m-         normalized += c;[m
[31m-   }[m
[31m-   return normalized;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::ostream& operator<<( std::ostream &sout, const Value &root )[m
[31m-{[m
[31m-   Json::StyledStreamWriter writer;[m
[31m-   writer.write(sout, root);[m
[31m-   return sout;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-} // namespace Json[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/plugin.cpp b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/plugin.cpp[m
[1mdeleted file mode 100755[m
[1mindex 6906275..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/plugin.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,320 +0,0 @@[m
[31m-#include "plugin.h"[m
[31m-#include "tokenizer.h"[m
[31m-[m
[31m-#ifdef _WINDOWS[m
[31m-#include <windows.h>[m
[31m-BOOL APIENTRY DllMain( HANDLE hModule,[m
[31m-                       DWORD ul_reason_for_call,[m
[31m-                       LPVOID lpReserved )[m
[31m-{[m
[31m-    return TRUE;[m
[31m-}[m
[31m-#else[m
[31m-#include <errno.h>[m
[31m-#include <string.h>[m
[31m-[m
[31m-extern int errno;[m
[31m-#endif[m
[31m-[m
[31m-SendPluginEv SendPluginEvent;[m
[31m-[m
[31m-string g_GetSysErrMsg( void )[m
[31m-{[m
[31m-    string strError = "Unknown";[m
[31m-    // Problem loading[m
[31m-#ifdef _WINDOWS[m
[31m-    int nErrorCode = GetLastError();[m
[31m-    LPTSTR s;[m
[31m-    if ( ::FormatMessage( FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM,[m
[31m-    NULL, nErrorCode, 0, ( LPTSTR ) &s, 0, NULL ) )[m
[31m-    {[m
[31m-        strError = s;[m
[31m-    }[m
[31m-    else[m
[31m-    {[m
[31m-        char szBuf[ 20 ];[m
[31m-        _snprintf_s( szBuf, _countof(szBuf), 19, "%d", nErrorCode );[m
[31m-        strError = szBuf;[m
[31m-    }[m
[31m-#else[m
[31m-    char szError[80];[m
[31m-    if ( strerror_r( errno, szError, sizeof(szError)  ) )[m
[31m-    {[m
[31m-        strError = "no description found";[m
[31m-    }[m
[31m-    else[m
[31m-    {[m
[31m-        strError = szError;[m
[31m-    }[m
[31m-#endif[m
[31m-    return strError;[m
[31m-}[m
[31m-[m
[31m-void g_sleep( unsigned int mseconds )[m
[31m-{[m
[31m-#ifdef _WINDOWS[m
[31m-    Sleep( mseconds );[m
[31m-#else[m
[31m-    usleep( mseconds * 1000 );[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-string& g_trim( string& str )[m
[31m-{[m
[31m-    // Whitespace characters[m
[31m-    char whspc[] = " \t\r\n\v\f";[m
[31m-[m
[31m-    // Whack off first part[m
[31m-    size_t pos = str.find_first_not_of( whspc );[m
[31m-[m
[31m-    if ( pos != string::npos )[m
[31m-        str.replace( 0, pos, "" );[m
[31m-[m
[31m-    // Whack off trailing stuff[m
[31m-    pos = str.find_last_not_of( whspc );[m
[31m-[m
[31m-    if ( pos != string::npos )[m
[31m-        str.replace( pos + 1, str.length() - pos, "" );[m
[31m-[m
[31m-    return str;[m
[31m-}[m
[31m-[m
[31m-void g_tokenize( const string& str, const string& delimiters, vector<string>& tokens )[m
[31m-{[m
[31m-    tokenize( str, tokens, delimiters );[m
[31m-}[m
[31m-[m
[31m-char* SetEventFunc( SendPluginEv funcPtr )[m
[31m-{[m
[31m-    static char * szObjList = onGetObjList();[m
[31m-    SendPluginEvent = funcPtr;[m
[31m-    return szObjList;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-const int nMAXSIZE = 512;[m
[31m-char* g_pszRetVal = NULL;[m
[31m-[m
[31m-//-----------------------------------------------------------[m
[31m-// Map from an object Id to an object instance[m
[31m-//-----------------------------------------------------------[m
[31m-typedef std::map<string, JSExt*> StringToJExt_T;[m
[31m-[m
[31m-//-----------------------------------------------------------[m
[31m-// Map from a browser context to an id mapping[m
[31m-//-----------------------------------------------------------[m
[31m-typedef std::map<void*, StringToJExt_T*> VoidToMap_T;[m
[31m-[m
[31m-VoidToMap_T g_context2Map;[m
[31m-[m
[31m-class GlobalSharedModule[m
[31m-{[m
[31m-[m
[31m-public:[m
[31m-    GlobalSharedModule( void )[m
[31m-    {[m
[31m-        g_pszRetVal = new char[ nMAXSIZE ];[m
[31m-    }[m
[31m-[m
[31m-    ~GlobalSharedModule()[m
[31m-    {[m
[31m-        delete [] g_pszRetVal;[m
[31m-[m
[31m-        VoidToMap_T::iterator posMaps;[m
[31m-[m
[31m-        for ( posMaps = g_context2Map.begin(); posMaps != g_context2Map.end(); ++posMaps )[m
[31m-        {[m
[31m-            StringToJExt_T& id2Obj = *posMaps->second;[m
[31m-            StringToJExt_T::iterator posMap;[m
[31m-[m
[31m-            for ( posMap = id2Obj.begin(); posMap != id2Obj.end(); ++posMap )[m
[31m-            {[m
[31m-                JSExt* pJSExt = posMap->second;[m
[31m-[m
[31m-                if ( pJSExt->CanDelete() )[m
[31m-                {[m
[31m-                    delete pJSExt;[m
[31m-                }[m
[31m-            }[m
[31m-[m
[31m-            id2Obj.erase( id2Obj.begin(), id2Obj.end() );[m
[31m-        }[m
[31m-[m
[31m-        g_context2Map.erase( g_context2Map.begin(), g_context2Map.end() );[m
[31m-    }[m
[31m-};[m
[31m-[m
[31m-GlobalSharedModule g_sharedModule;[m
[31m-[m
[31m-char* g_str2global( const string& strRetVal )[m
[31m-{[m
[31m-    int nLen = strRetVal.size();[m
[31m-[m
[31m-    if ( nLen >= nMAXSIZE )[m
[31m-    {[m
[31m-        delete [] g_pszRetVal;[m
[31m-        g_pszRetVal = new char[ nLen + 1 ];[m
[31m-    }[m
[31m-[m
[31m-    else[m
[31m-    {[m
[31m-        // To minimaize the number of memory reallocations, the assumption[m
[31m-        // is that in most times this will be the case[m
[31m-        delete [] g_pszRetVal;[m
[31m-        g_pszRetVal = new char[ nMAXSIZE ];[m
[31m-    }[m
[31m-[m
[31m-    strcpy( g_pszRetVal, strRetVal.c_str() );[m
[31m-    return g_pszRetVal;[m
[31m-}[m
[31m-[m
[31m-bool g_unregisterObject( const string& strObjId, void* pContext )[m
[31m-{[m
[31m-    // Called by the plugin extension implementation[m
[31m-    // if the extension handles the deletion of its object[m
[31m-[m
[31m-    StringToJExt_T * pID2Obj = NULL;[m
[31m-[m
[31m-    VoidToMap_T::iterator iter = g_context2Map.find( pContext );[m
[31m-[m
[31m-    if ( iter != g_context2Map.end() )[m
[31m-    {[m
[31m-        pID2Obj = iter->second;[m
[31m-    }[m
[31m-    else[m
[31m-    {[m
[31m-        return false;[m
[31m-    }[m
[31m-[m
[31m-    StringToJExt_T& mapID2Obj = *pID2Obj;[m
[31m-[m
[31m-    StringToJExt_T::iterator r = mapID2Obj.find( strObjId );[m
[31m-[m
[31m-    if ( r == mapID2Obj.end() )[m
[31m-    {[m
[31m-        return false;[m
[31m-    }[m
[31m-[m
[31m-    mapID2Obj.erase( strObjId );[m
[31m-    return true;[m
[31m-}[m
[31m-[m
[31m-char* InvokeFunction( const char* szCommand, void* pContext )[m
[31m-{[m
[31m-    StringToJExt_T * pID2Obj = NULL;[m
[31m-[m
[31m-    VoidToMap_T::iterator iter = g_context2Map.find( pContext );[m
[31m-[m
[31m-    if ( iter != g_context2Map.end() )[m
[31m-    {[m
[31m-        pID2Obj = iter->second;[m
[31m-    }[m
[31m-    else[m
[31m-    {[m
[31m-        pID2Obj = new StringToJExt_T;[m
[31m-        g_context2Map[ pContext ] = pID2Obj;[m
[31m-    }[m
[31m-[m
[31m-    StringToJExt_T& mapID2Obj = *pID2Obj;[m
[31m-[m
[31m-    string strFullCommand = szCommand;[m
[31m-    vector<string> arParams;[m
[31m-    g_tokenize( strFullCommand, " ", arParams );[m
[31m-    string strCommand = arParams[ 0 ];[m
[31m-    string strRetVal = szERROR;[m
[31m-[m
[31m-    if ( strCommand == szCREATE )[m
[31m-    {[m
[31m-        string strClassName = arParams[ 1 ];[m
[31m-        string strObjId = arParams[ 2 ];[m
[31m-[m
[31m-        StringToJExt_T::iterator r = mapID2Obj.find( strObjId );[m
[31m-[m
[31m-        if ( r != mapID2Obj.end() )[m
[31m-        {[m
[31m-            strRetVal += strObjId;[m
[31m-            strRetVal += " :Object already exists.";[m
[31m-            return g_str2global( strRetVal );[m
[31m-        }[m
[31m-[m
[31m-        JSExt* pJSExt = onCreateObject( strClassName, strObjId );[m
[31m-[m
[31m-        if ( pJSExt == NULL )[m
[31m-        {[m
[31m-            strRetVal += strObjId;[m
[31m-            strRetVal += " :Unknown object type ";[m
[31m-            strRetVal += strClassName;[m
[31m-            return g_str2global( strRetVal );[m
[31m-        }[m
[31m-[m
[31m-        pJSExt->m_pContext = pContext;[m
[31m-        mapID2Obj[ strObjId ] = pJSExt;[m
[31m-[m
[31m-        strRetVal = szOK;[m
[31m-        strRetVal += strObjId;[m
[31m-        return g_str2global( strRetVal );[m
[31m-    }[m
[31m-    else[m
[31m-    if ( strCommand == szINVOKE )[m
[31m-    {[m
[31m-        string strObjId = arParams[ 1 ];[m
[31m-        string strMethod = arParams[ 2 ];[m
[31m-[m
[31m-        StringToJExt_T::iterator r = mapID2Obj.find( strObjId );[m
[31m-[m
[31m-        if ( r == mapID2Obj.end() )[m
[31m-        {[m
[31m-            strRetVal += strObjId;[m
[31m-            strRetVal += " :No object found for id.";[m
[31m-            return g_str2global( strRetVal );[m
[31m-        }[m
[31m-[m
[31m-        JSExt* pJSExt = r->second;[m
[31m-[m
[31m-        size_t nLoc = strFullCommand.find( strObjId );[m
[31m-[m
[31m-        if ( nLoc == string::npos )[m
[31m-        {[m
[31m-            strRetVal += strObjId;[m
[31m-            strRetVal += " :Internal InvokeMethod error.";[m
[31m-            return g_str2global( strRetVal );[m
[31m-        }[m
[31m-[m
[31m-        if ( strMethod == szDISPOSE )[m
[31m-        {[m
[31m-            StringToJExt_T::iterator r = mapID2Obj.find( strObjId );[m
[31m-[m
[31m-            if ( r == mapID2Obj.end() )[m
[31m-            {[m
[31m-                strRetVal = szERROR;[m
[31m-                strRetVal += strObjId;[m
[31m-                return g_str2global( strRetVal );[m
[31m-            }[m
[31m-[m
[31m-            JSExt * pJSExt = mapID2Obj[ strObjId ];[m
[31m-[m
[31m-            if ( pJSExt->CanDelete() )[m
[31m-            {[m
[31m-                delete pJSExt;[m
[31m-            }[m
[31m-[m
[31m-            mapID2Obj.erase( strObjId );[m
[31m-            strRetVal = szOK;[m
[31m-            strRetVal += strObjId;[m
[31m-            return g_str2global( strRetVal );[m
[31m-        }[m
[31m-[m
[31m-        size_t nSuffixLoc = nLoc + strObjId.size();[m
[31m-        string strInvoke = strFullCommand.substr( nSuffixLoc );[m
[31m-        strInvoke = g_trim( strInvoke );[m
[31m-        strRetVal = pJSExt->InvokeMethod( strInvoke );[m
[31m-        return g_str2global( strRetVal );[m
[31m-    }[m
[31m-[m
[31m-    strRetVal += " :Unknown command ";[m
[31m-    strRetVal += strCommand;[m
[31m-    return g_str2global( strRetVal );[m
[31m-}[m
[31m-[m
[31m-//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/plugin.h b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/plugin.h[m
[1mdeleted file mode 100755[m
[1mindex 4ef7116..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/plugin.h[m
[1m+++ /dev/null[m
[36m@@ -1,70 +0,0 @@[m
[31m-#ifndef _PLUGIN_H[m
[31m-#define _PLUGIN_H[m
[31m-[m
[31m-#include <map>[m
[31m-#include <string>[m
[31m-#include <vector>[m
[31m-#include <unistd.h>[m
[31m-//#include "tokenizer.h"[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%[m
[31m-//%% Functions exported by this DLL[m
[31m-//%% Should always be only SetEventFunc and InvokeFunction[m
[31m-//%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%[m
[31m-// g++ requires extern "C" otherwise the names of SetEventFunc and InvokeFunction[m
[31m-// are mangled C++ style. MS Visual Studio doesn't seem to care though.[m
[31m-extern "C"[m
[31m-{[m
[31m-    typedef void (*SendPluginEv)( const char* szEvent, void* pContext );[m
[31m-    char* SetEventFunc(SendPluginEv funcPtr);[m
[31m-    char* InvokeFunction( const char* szCommand, void* pContext );[m
[31m-}[m
[31m-[m
[31m-// JNEXT Framework function of the form:[m
[31m-// typedef void (*SendPluginEv)( const char* szEvent );[m
[31m-// used to notify JavaScript of an asynchronous event[m
[31m-extern SendPluginEv SendPluginEvent;[m
[31m-[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-// Constants and methods common to all JNEXT extensions types[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-#define szERROR         "Error "[m
[31m-#define szOK            "Ok "[m
[31m-[m
[31m-#define szDISPOSE       "Dispose"[m
[31m-#define szINVOKE        "InvokeMethod"[m
[31m-#define szCREATE        "CreateObj"[m
[31m-[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-// Utility functions[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-string& g_trim( string& str );[m
[31m-void g_tokenize(const string& str,const string& delimiters, vector<string>& tokens);[m
[31m-char* g_str2static( const string& strRetVal );[m
[31m-void g_sleep( unsigned int mseconds );[m
[31m-bool g_unregisterObject( const string& strObjId, void* pContext );[m
[31m-[m
[31m-[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-// Abstract extension object[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-class JSExt[m
[31m-{[m
[31m-public:[m
[31m-    virtual ~JSExt() {};[m
[31m-    virtual string InvokeMethod( const string& strCommand ) = 0;[m
[31m-    virtual bool CanDelete( void ) = 0;[m
[31m-    virtual void TryDelete( void ) {}[m
[31m-public:[m
[31m-    void* m_pContext;[m
[31m-};[m
[31m-[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-// Callback functions to be implemented by the plugin implementation[m
[31m-/////////////////////////////////////////////////////////////////////////[m
[31m-extern char* onGetObjList( void );[m
[31m-extern JSExt* onCreateObject( const string& strClassName, const string& strObjId );[m
[31m-[m
[31m-#endif[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/tokenizer.cpp b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/tokenizer.cpp[m
[1mdeleted file mode 100755[m
[1mindex 4a39573..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/tokenizer.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,222 +0,0 @@[m
[31m-/************************************************************************[m
[31m-The zlib/libpng License[m
[31m-[m
[31m-Copyright (c) 2006 Joerg Wiedenmann[m
[31m-[m
[31m-This software is provided 'as-is', without any express or implied warranty.[m
[31m-In no event will the authors be held liable for any damages arising from[m
[31m-the use of this software.[m
[31m-[m
[31m-Permission is granted to anyone to use this software for any purpose,[m
[31m-including commercial applications, and to alter it and redistribute it[m
[31m-freely, subject to the following restrictions:[m
[31m-[m
[31m-1. The origin of this software must not be misrepresented;[m
[31m-you must not claim that you wrote the original software.[m
[31m-If you use this software in a product, an acknowledgment[m
[31m-in the product documentation would be appreciated but is[m
[31m-not required.[m
[31m-[m
[31m-2. Altered source versions must be plainly marked as such,[m
[31m-and must not be misrepresented as being the original software.[m
[31m-[m
[31m-3. This notice may not be removed or altered from any source distribution.[m
[31m-[m
[31m-***********************************************************************/[m
[31m-[m
[31m-/********************************************************************[m
[31m-	created:	2006-01-28[m
[31m-	filename: 	tokenizer.cpp[m
[31m-	author:		Jrg Wiedenmann[m
[31m-	[m
[31m-	purpose:	A tokenizer function which provides a very[m
[31m-				customizable way of breaking up strings.[m
[31m-[m
[31m-	history:	2006-01-28, Original version[m
[31m-				2006-03-04, Fixed a small parsing bug, thanks Elias.[m
[31m-*********************************************************************/[m
[31m-[m
[31m-#include "tokenizer.h"[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-void tokenize ( const string& str, vector<string>& result,[m
[31m-			   const string& delimiters, const string& delimiters_preserve,[m
[31m-			   const string& quote, const string& esc )[m
[31m-{[m
[31m-	// clear the vector[m
[31m-	if ( false == result.empty() )[m
[31m-	{[m
[31m-		result.clear();[m
[31m-	}[m
[31m-[m
[31m-	string::size_type pos = 0; // the current position (char) in the string[m
[31m-	char ch = 0; // buffer for the current character[m
[31m-	char delimiter = 0;	// the buffer for the delimiter char which[m
[31m-							// will be added to the tokens if the delimiter[m
[31m-							// is preserved[m
[31m-	char current_quote = 0; // the char of the current open quote[m
[31m-	bool quoted = false; // indicator if there is an open quote[m
[31m-	string token;  // string buffer for the token[m
[31m-	bool token_complete = false; // indicates if the current token is[m
[31m-								 // read to be added to the result vector[m
[31m-	string::size_type len = str.length();  // length of the input-string[m
[31m-[m
[31m-	// for every char in the input-string[m
[31m-	while ( len > pos )[m
[31m-	{[m
[31m-		// get the character of the string and reset the delimiter buffer[m
[31m-		ch = str.at(pos);[m
[31m-		delimiter = 0;[m
[31m-[m
[31m-		// assume ch isn't a delimiter[m
[31m-		bool add_char = true;[m
[31m-[m
[31m-		// check ...[m
[31m-[m
[31m-		// ... if the delimiter is an escaped character[m
[31m-		bool escaped = false; // indicates if the next char is protected[m
[31m-		if ( false == esc.empty() ) // check if esc-chars are  provided[m
[31m-		{[m
[31m-			if ( string::npos != esc.find_first_of(ch) )[m
[31m-			{[m
[31m-				// get the escaped char[m
[31m-				++pos;[m
[31m-				if ( pos < len ) // if there are more chars left[m
[31m-				{[m
[31m-					// get the next one[m
[31m-					ch = str.at(pos);[m
[31m-[m
[31m-					// add the escaped character to the token[m
[31m-					add_char = true;[m
[31m-				}[m
[31m-				else // cannot get any more characters[m
[31m-				{[m
[31m-					// don't add the esc-char[m
[31m-					add_char = false;[m
[31m-				}[m
[31m-[m
[31m-				// ignore the remaining delimiter checks[m
[31m-				escaped = true;[m
[31m-			}[m
[31m-		}[m
[31m-[m
[31m-		// ... if the delimiter is a quote[m
[31m-		if ( false == quote.empty() && false == escaped )[m
[31m-		{[m
[31m-			// if quote chars are provided and the char isn't protected[m
[31m-			if ( string::npos != quote.find_first_of(ch) )[m
[31m-			{[m
[31m-				// if not quoted, set state to open quote and set[m
[31m-				// the quote character[m
[31m-				if ( false == quoted )[m
[31m-				{[m
[31m-					quoted = true;[m
[31m-					current_quote = ch;[m
[31m-[m
[31m-					// don't add the quote-char to the token[m
[31m-					add_char = false;[m
[31m-				}[m
[31m-				else // if quote is open already[m
[31m-				{[m
[31m-					// check if it is the matching character to close it[m
[31m-					if ( current_quote == ch )[m
[31m-					{[m
[31m-						// close quote and reset the quote character[m
[31m-						quoted = false;[m
[31m-						current_quote = 0;[m
[31m-[m
[31m-						// don't add the quote-char to the token[m
[31m-						add_char = false;[m
[31m-					}[m
[31m-				} // else[m
[31m-			}[m
[31m-		}[m
[31m-[m
[31m-		// ... if the delimiter isn't preserved[m
[31m-		if ( false == delimiters.empty() && false == escaped &&[m
[31m-			 false == quoted )[m
[31m-		{[m
[31m-			// if a delimiter is provided and the char isn't protected by[m
[31m-			// quote or escape char[m
[31m-			if ( string::npos != delimiters.find_first_of(ch) )[m
[31m-			{[m
[31m-				// if ch is a delimiter and the token string isn't empty[m
[31m-				// the token is complete[m
[31m-				if ( false == token.empty() ) // BUGFIX: 2006-03-04[m
[31m-				{[m
[31m-					token_complete = true;[m
[31m-				}[m
[31m-[m
[31m-				// don't add the delimiter to the token[m
[31m-				add_char = false;[m
[31m-			}[m
[31m-		}[m
[31m-[m
[31m-		// ... if the delimiter is preserved - add it as a token[m
[31m-		bool add_delimiter = false;[m
[31m-		if ( false == delimiters_preserve.empty() && false == escaped &&[m
[31m-			 false == quoted )[m
[31m-		{[m
[31m-			// if a delimiter which will be preserved is provided and the[m
[31m-			// char isn't protected by quote or escape char[m
[31m-			if ( string::npos != delimiters_preserve.find_first_of(ch) )[m
[31m-			{[m
[31m-				// if ch is a delimiter and the token string isn't empty[m
[31m-				// the token is complete[m
[31m-				if ( false == token.empty() ) // BUGFIX: 2006-03-04[m
[31m-				{[m
[31m-					token_complete = true;[m
[31m-				}[m
[31m-[m
[31m-				// don't add the delimiter to the token[m
[31m-				add_char = false;[m
[31m-[m
[31m-				// add the delimiter[m
[31m-				delimiter = ch;[m
[31m-				add_delimiter = true;[m
[31m-			}[m
[31m-		}[m
[31m-[m
[31m-[m
[31m-		// add the character to the token[m
[31m-		if ( true == add_char )[m
[31m-		{[m
[31m-			// add the current char[m
[31m-			token.push_back( ch );[m
[31m-		}[m
[31m-[m
[31m-		// add the token if it is complete[m
[31m-		if ( true == token_complete && false == token.empty() )[m
[31m-		{[m
[31m-			// add the token string[m
[31m-			result.push_back( token );[m
[31m-[m
[31m-			// clear the contents[m
[31m-			token.clear();[m
[31m-[m
[31m-			// build the next token[m
[31m-			token_complete = false;[m
[31m-		}[m
[31m-[m
[31m-		// add the delimiter[m
[31m-		if ( true == add_delimiter )[m
[31m-		{[m
[31m-			// the next token is the delimiter[m
[31m-			string delim_token;[m
[31m-			delim_token.push_back( delimiter );[m
[31m-			result.push_back( delim_token );[m
[31m-[m
[31m-			// REMOVED: 2006-03-04, Bugfix[m
[31m-		}[m
[31m-[m
[31m-		// repeat for the next character[m
[31m-		++pos;[m
[31m-	} // while[m
[31m-[m
[31m-	// add the final token[m
[31m-	if ( false == token.empty() )[m
[31m-	{[m
[31m-		result.push_back( token );[m
[31m-	}[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/tokenizer.h b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/tokenizer.h[m
[1mdeleted file mode 100755[m
[1mindex 75f567c..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/public/tokenizer.h[m
[1m+++ /dev/null[m
[36m@@ -1,55 +0,0 @@[m
[31m-/************************************************************************[m
[31m-The zlib/libpng License[m
[31m-[m
[31m-Copyright (c) 2006 Joerg Wiedenmann[m
[31m-[m
[31m-This software is provided 'as-is', without any express or implied warranty.[m
[31m-In no event will the authors be held liable for any damages arising from[m
[31m-the use of this software.[m
[31m-[m
[31m-Permission is granted to anyone to use this software for any purpose,[m
[31m-including commercial applications, and to alter it and redistribute it[m
[31m-freely, subject to the following restrictions:[m
[31m-[m
[31m-1. The origin of this software must not be misrepresented;[m
[31m-	you must not claim that you wrote the original software.[m
[31m-	If you use this software in a product, an acknowledgment[m
[31m-	in the product documentation would be appreciated but is[m
[31m-	not required.[m
[31m-[m
[31m-2. Altered source versions must be plainly marked as such,[m
[31m-	and must not be misrepresented as being the original software.[m
[31m-[m
[31m-3. This notice may not be removed or altered from any source distribution.[m
[31m-[m
[31m-***********************************************************************/[m
[31m-[m
[31m-/********************************************************************[m
[31m-	created:	2006-01-28[m
[31m-	filename: 	tokenizer.cpp[m
[31m-	author:		Jrg Wiedenmann[m
[31m-[m
[31m-	purpose:	A tokenizer function which provides a very[m
[31m-				customizable way of breaking up strings.[m
[31m-*********************************************************************/[m
[31m-[m
[31m-#include <vector>[m
[31m-#include <string>[m
[31m-using namespace std;[m
[31m-[m
[31m-// Function to break up a string into tokens[m
[31m-//[m
[31m-// Parameters:[m
[31m-//-----------[m
[31m-// str = the input string that will be tokenized[m
[31m-// result = the tokens for str[m
[31m-// delimiters = the delimiter characters[m
[31m-// delimiters preserve = same as above, but the delimiter characters[m
[31m-//		will be put into the result as a token[m
[31m-// quote = characters to protect the enclosed characters[m
[31m-// esc = characters to protect a single character[m
[31m-//[m
[31m-[m
[31m-void tokenize ( const string& str, vector<string>& result,[m
[31m-			const string& delimiters, const string& delimiters_preserve = "",[m
[31m-			const string& quote = "\"", const string& esc = "\\" );[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/simulator/.npmignore b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/simulator/.npmignore[m
[1mdeleted file mode 100755[m
[1mindex f0ed2b6..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/simulator/.npmignore[m
[1m+++ /dev/null[m
[36m@@ -1,2 +0,0 @@[m
[31m-/public[m
[31m-/src[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/simulator/libBarcodeScanner.so b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/simulator/libBarcodeScanner.so[m
[1mdeleted file mode 100755[m
[1mindex 3d26d8e..0000000[m
Binary files a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/simulator/libBarcodeScanner.so and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/Logger.cpp b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/Logger.cpp[m
[1mdeleted file mode 100755[m
[1mindex 357e051..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/Logger.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,104 +0,0 @@[m
[31m-/*[m
[31m- * Copyright (c) 2013 BlackBerry Limited[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- * http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-#include "Logger.hpp"[m
[31m-#include "barcodescanner_js.hpp"[m
[31m-#include <slog2.h>[m
[31m-[m
[31m-namespace webworks {[m
[31m-[m
[31m-Logger::Logger(const char* name, BarcodeScannerJS *parent): m_pParent(parent) {[m
[31m-	buffer_config.buffer_set_name = name;[m
[31m-	buffer_config.num_buffers = 2;[m
[31m-	buffer_config.verbosity_level = SLOG2_DEBUG1;[m
[31m-[m
[31m-	/* Configure the first buffer, using 7 x 4KB pages.  This larger buffer will be used for[m
[31m-	   very chatty logging.  Our goal is to have 30-60 seconds of history at any given time,[m
[31m-	   so we will want to log at a rate of around one log line with a string of 16 bytes[m
[31m-	   long every 150 milliseconds.[m
[31m-	*/[m
[31m-[m
[31m-	buffer_config.buffer_config[0].buffer_name = "low_priority";[m
[31m-	buffer_config.buffer_config[0].num_pages = 7;[m
[31m-[m
[31m-	/* Configure the second buffer, which we will use for high level info logging that is very[m
[31m-	   infrequent, but we want a longer history (hours or maybe even over a day or two).  This[m
[31m-	   buffer uses 1 x 4KB.[m
[31m-	*/[m
[31m-[m
[31m-	buffer_config.buffer_config[1].buffer_name = "high_priority";[m
[31m-	buffer_config.buffer_config[1].num_pages = 1;[m
[31m-[m
[31m-	/* Register the buffer set. */[m
[31m-[m
[31m-	if( -1 == slog2_register( &buffer_config, buffer_handle, 0 ) ) {[m
[31m-		fprintf( stderr, "Error registering slogger2 buffer!\n" );[m
[31m-	} else {[m
[31m-		info("Created slogger2 buffers");[m
[31m-	}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-Logger::~Logger() {[m
[31m-	critical("slogger2 buffers reset");[m
[31m-	slog2_reset();[m
[31m-}[m
[31m-[m
[31m-int Logger::log(slog2_buffer_t buffer, _Uint8t severity, const char* message) {[m
[31m-	return slog2c(buffer, 0, severity, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::debug(const char* message) {[m
[31m-	return log(lowPriorityBuffer(), SLOG2_DEBUG1, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::info(const char* message) {[m
[31m-	return log(lowPriorityBuffer(), SLOG2_INFO, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::notice(const char* message) {[m
[31m-	return log(lowPriorityBuffer(), SLOG2_NOTICE, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::warn(const char* message) {[m
[31m-	return log(lowPriorityBuffer(), SLOG2_WARNING, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::error(const char* message) {[m
[31m-	return log(hiPriorityBuffer(), SLOG2_ERROR, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::critical(const char* message) {[m
[31m-	return log(hiPriorityBuffer(), SLOG2_CRITICAL, message);[m
[31m-}[m
[31m-[m
[31m-int Logger::setVerbosity(_Uint8t verbosity) {[m
[31m-	return slog2_set_verbosity(buffer_handle[0], verbosity);[m
[31m-}[m
[31m-[m
[31m-_Uint8t Logger::getVerbosity() {[m
[31m-	return slog2_get_verbosity(buffer_handle[0]);[m
[31m-}[m
[31m-[m
[31m-slog2_buffer_t Logger::hiPriorityBuffer() {[m
[31m-	return buffer_handle[1];[m
[31m-}[m
[31m-[m
[31m-slog2_buffer_t Logger::lowPriorityBuffer() {[m
[31m-	return buffer_handle[0];[m
[31m-}[m
[31m-[m
[31m-} /* namespace webworks */[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/Logger.hpp b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/Logger.hpp[m
[1mdeleted file mode 100755[m
[1mindex 2344fd9..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/Logger.hpp[m
[1m+++ /dev/null[m
[36m@@ -1,49 +0,0 @@[m
[31m-/*[m
[31m- * Copyright (c) 2013 BlackBerry Limited[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- * http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-#ifndef LOGGER_HPP_[m
[31m-#define LOGGER_HPP_[m
[31m-[m
[31m-#include <string>[m
[31m-#include <slog2.h>[m
[31m-[m
[31m-class BarcodeScannerJS;[m
[31m-[m
[31m-namespace webworks {[m
[31m-[m
[31m-class Logger {[m
[31m-public:[m
[31m-	explicit Logger(const char* name, BarcodeScannerJS *parent = NULL);[m
[31m-	virtual ~Logger();[m
[31m-	int debug(const char* message);[m
[31m-	int info(const char* message);[m
[31m-	int notice(const char* message);[m
[31m-	int warn(const char* message);[m
[31m-	int error(const char* message);[m
[31m-	int critical(const char* message);[m
[31m-	int setVerbosity(_Uint8t verbosity);[m
[31m-	_Uint8t getVerbosity();[m
[31m-	slog2_buffer_t hiPriorityBuffer();[m
[31m-	slog2_buffer_t lowPriorityBuffer();[m
[31m-private:[m
[31m-	BarcodeScannerJS *m_pParent;[m
[31m-	slog2_buffer_set_config_t buffer_config;[m
[31m-	slog2_buffer_t buffer_handle[2];[m
[31m-	int log(slog2_buffer_t buffer, _Uint8t severity, const char* message);[m
[31m-};[m
[31m-[m
[31m-} /* namespace webworks */[m
[31m-#endif /* LOGGER_HPP_ */[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/barcodescanner_js.cpp b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/barcodescanner_js.cpp[m
[1mdeleted file mode 100755[m
[1mindex fd1db92..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/barcodescanner_js.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,105 +0,0 @@[m
[31m-/*[m
[31m- * Copyright 2013-2014 BlackBerry Limited.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- * http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-#include "../public/tokenizer.h"[m
[31m-#include "barcodescanner_js.hpp"[m
[31m-#include "barcodescanner_ndk.hpp"[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-/**[m
[31m- * Default constructor.[m
[31m- */[m
[31m-BarcodeScannerJS::BarcodeScannerJS(const std::string& id) :[m
[31m-        m_id(id) {[m
[31m-	m_pLogger = new webworks::Logger("BarcodeScannerJS", this);[m
[31m-    m_pBarcodeScannerController = new webworks::BarcodeScannerNDK(this);[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * BarcodeScannerJS destructor.[m
[31m- */[m
[31m-BarcodeScannerJS::~BarcodeScannerJS() {[m
[31m-    if (m_pBarcodeScannerController)[m
[31m-    		delete m_pBarcodeScannerController;[m
[31m-	if (m_pLogger)[m
[31m-		delete m_pLogger;[m
[31m-}[m
[31m-[m
[31m-webworks::Logger* BarcodeScannerJS::getLog() {[m
[31m-	return m_pLogger;[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * This method returns the list of objects implemented by this native[m
[31m- * extension.[m
[31m- */[m
[31m-char* onGetObjList() {[m
[31m-    static char name[] = "BarcodeScannerJS";[m
[31m-    return name;[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * This method is used by JNext to instantiate the BarcodeScannerJS object when[m
[31m- * an object is created on the JavaScript server side.[m
[31m- */[m
[31m-JSExt* onCreateObject(const string& className, const string& id) {[m
[31m-    if (className == "BarcodeScannerJS") {[m
[31m-        return new BarcodeScannerJS(id);[m
[31m-    }[m
[31m-[m
[31m-    return NULL;[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * Method used by JNext to determine if the object can be deleted.[m
[31m- */[m
[31m-bool BarcodeScannerJS::CanDelete() {[m
[31m-    return true;[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * It will be called from JNext JavaScript side with passed string.[m
[31m- * This method implements the interface for the JavaScript to native binding[m
[31m- * for invoking native code. This method is triggered when JNext.invoke is[m
[31m- * called on the JavaScript side with this native objects id.[m
[31m- */[m
[31m-string BarcodeScannerJS::InvokeMethod(const std::string& command) {[m
[31m-    // command appears with parameters following after a space[m
[31m-	size_t commandIndex = command.find_first_of(" ");[m
[31m-	std::string strCommand = command.substr(0, commandIndex);[m
[31m-	size_t callbackIndex = command.find_first_of(" ", commandIndex + 1);[m
[31m-	std::string callbackId = command.substr(commandIndex + 1, callbackIndex - commandIndex - 1);[m
[31m-	std::string arg = command.substr(callbackIndex + 1, command.length());[m
[31m-[m
[31m-    if (strCommand == "startRead") {[m
[31m-        m_pBarcodeScannerController->startRead(callbackId, arg);[m
[31m-    }[m
[31m-    else if (strCommand == "stopRead") {[m
[31m-        m_pBarcodeScannerController->stopRead(callbackId);[m
[31m-    }[m
[31m-[m
[31m-    strCommand.append(";");[m
[31m-    strCommand.append(command);[m
[31m-    return strCommand;[m
[31m-}[m
[31m-[m
[31m-// Notifies JavaScript of an event[m
[31m-void BarcodeScannerJS::NotifyEvent(const std::string& event) {[m
[31m-    std::string eventString = m_id + " ";[m
[31m-    eventString.append(event);[m
[31m-    SendPluginEvent(eventString.c_str(), m_pContext);[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/barcodescanner_js.hpp b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/barcodescanner_js.hpp[m
[1mdeleted file mode 100755[m
[1mindex 4b04a78..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/barcodescanner_js.hpp[m
[1m+++ /dev/null[m
[36m@@ -1,41 +0,0 @@[m
[31m-/*[m
[31m-* Copyright 2013-2014 BlackBerry Limited.[m
[31m-*[m
[31m-* Licensed under the Apache License, Version 2.0 (the "License");[m
[31m-* you may not use this file except in compliance with the License.[m
[31m-* You may obtain a copy of the License at[m
[31m-*[m
[31m-* http://www.apache.org/licenses/LICENSE-2.0[m
[31m-*[m
[31m-* Unless required by applicable law or agreed to in writing, software[m
[31m-* distributed under the License is distributed on an "AS IS" BASIS,[m
[31m-* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m-* See the License for the specific language governing permissions and[m
[31m-* limitations under the License.[m
[31m-*/[m
[31m-[m
[31m-#ifndef BARCODESCANNERJS_HPP_[m
[31m-#define BARCODESCANNERJS_HPP_[m
[31m-[m
[31m-#include "../public/plugin.h"[m
[31m-#include "barcodescanner_ndk.hpp"[m
[31m-#include "Logger.hpp"[m
[31m-#include <string>[m
[31m-[m
[31m-class BarcodeScannerJS: public JSExt {[m
[31m-[m
[31m-public:[m
[31m-    explicit BarcodeScannerJS(const std::string& id);[m
[31m-    virtual ~BarcodeScannerJS();[m
[31m-    virtual bool CanDelete();[m
[31m-    virtual std::string InvokeMethod(const std::string& command);[m
[31m-    void NotifyEvent(const std::string& event);[m
[31m-    webworks::Logger* getLog();[m
[31m-    webworks::BarcodeScannerNDK *m_pBarcodeScannerController;[m
[31m-private:[m
[31m-    std::string m_id;[m
[31m-    // Definition of a pointer to the actual native extension code[m
[31m-    webworks::Logger *m_pLogger;[m
[31m-};[m
[31m-[m
[31m-#endif /* BarcodeScannerJS_HPP_ */[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/barcodescanner_ndk.cpp b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/barcodescanner_ndk.cpp[m
[1mdeleted file mode 100755[m
[1mindex 830f17b..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/barcodescanner_ndk.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,709 +0,0 @@[m
[31m-/*[m
[31m- * Copyright 2013-2015 BlackBerry Limited.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- * http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-#include <json/reader.h>[m
[31m-#include <json/writer.h>[m
[31m-[m
[31m-#include <zxing/common/GreyscaleLuminanceSource.h>[m
[31m-#include <zxing/common/HybridBinarizer.h>[m
[31m-#include <zxing/MultiFormatReader.h>[m
[31m-#include <img/img.h>[m
[31m-#include <stdio.h>[m
[31m-#include <bps/bps.h>[m
[31m-#include <bps/event.h>[m
[31m-#include <bps/navigator.h>[m
[31m-#include <bps/screen.h>[m
[31m-#include <screen/screen.h>[m
[31m-#include <pthread.h>[m
[31m-[m
[31m-#include "barcodescanner_ndk.hpp"[m
[31m-#include "barcodescanner_js.hpp"[m
[31m-[m
[31m-#include <string>[m
[31m-#include <sstream>[m
[31m-[m
[31m-using namespace zxing;[m
[31m-[m
[31m-namespace webworks {[m
[31m-[m
[31m-BarcodeScannerJS* eventDispatcher = NULL;[m
[31m-// Variables for native viewfinder screen[m
[31m-static screen_window_t vf_win = NULL;[m
[31m-static uint32_t vfRotation = 0;[m
[31m-static bool touch = false;[m
[31m-[m
[31m-[m
[31m-#define MUTEX_LOCK() pthread_mutex_trylock(&m_lock)[m
[31m-#define MUTEX_UNLOCK() pthread_mutex_unlock(&m_lock)[m
[31m-[m
[31m-static pthread_mutex_t m_lock;[m
[31m-static pthread_t m_thread = 0;[m
[31m-[m
[31m-    /*[m
[31m-     * getCameraErrorDesc[m
[31m-     *[m
[31m-     * Returns a descriptive error message for a given camera error code[m
[31m-     */[m
[31m-    const char* getCameraErrorDesc(camera_error_t err) {[m
[31m-        switch (err) {[m
[31m-        case CAMERA_EOK:[m
[31m-            return "The function call to the camera completed successfully.";[m
[31m-        case CAMERA_EAGAIN:[m
[31m-            return "The specified camera was not available. Try again.";[m
[31m-        case CAMERA_EINVAL:[m
[31m-            return "The camera call failed because of an invalid parameter.";[m
[31m-        case CAMERA_ENODEV:[m
[31m-            return "No such camera was found.";[m
[31m-        case CAMERA_EMFILE:[m
[31m-            return "The camera called failed because of a file table overflow.";[m
[31m-        case CAMERA_EBADF:[m
[31m-            return "Indicates that an invalid handle to a @c camera_handle_t value was used.";[m
[31m-        case CAMERA_EACCESS:[m
[31m-            return "Indicates that the necessary permissions to access the camera are not available.";[m
[31m-        case CAMERA_EBADR:[m
[31m-            return "Indicates that an invalid file descriptor was used.";[m
[31m-        case CAMERA_ENOENT:[m
[31m-            return "Indicates that the access a file or directory that does not exist.";[m
[31m-        case CAMERA_ENOMEM:[m
[31m-            return "Indicates that memory allocation failed.";[m
[31m-        case CAMERA_EOPNOTSUPP:[m
[31m-            return "Indicates that the requested operation is not supported.";[m
[31m-        case CAMERA_ETIMEDOUT:[m
[31m-            return "The function call failed due to communication problem or time-out with the camera.";[m
[31m-        case CAMERA_EALREADY:[m
[31m-            return "Indicates an operation on the camera is already in progress. In addition, this error can indicate that an error could not be completed because it was already completed. For example, if you called the @c camera_stop_video() function but the camera had already stopped recording video, this error code would be returned.";[m
[31m-        case CAMERA_EUNINIT:[m
[31m-            return "Indicates that the Camera Library is not initialized.";[m
[31m-        case CAMERA_EREGFAULT:[m
[31m-            return "Indicates that registration of a callback failed.";[m
[31m-        case CAMERA_EMICINUSE:[m
[31m-            return "Indicates that it failed to open because microphone is already in use.";[m
[31m-        }[m
[31m-        return NULL;[m
[31m-    }[m
[31m-[m
[31m-[m
[31m-    /*[m
[31m-     * viewfinder_callback[m
[31m-     *[m
[31m-     * This callback is invoked when an image frame from the camera viewfinder becomes available.[m
[31m-     * The frame is analyzed to determine if a barcode can be matched.[m
[31m-     * Frames come in NV12 format which makes code analysis very fast.[m
[31m-     */[m
[31m-    void viewfinder_callback(camera_handle_t handle,camera_buffer_t* buf,void* arg) {[m
[31m-        camera_frame_nv12_t* data = (camera_frame_nv12_t*)(&(buf->framedesc));[m
[31m-        uint8_t* buff = buf->framebuf;[m
[31m-        int stride = data->stride;[m
[31m-        int width = data->width;[m
[31m-        int height = data->height;[m
[31m-        if ( eventDispatcher != NULL ){[m
[31m-//            eventDispatcher->getLog()->debug("Frame received");[m
[31m-        }[m
[31m-[m
[31m-        try {[m
[31m-            Ref<LuminanceSource> source(new GreyscaleLuminanceSource((unsigned char *)buff, stride, height, 0,0,width,height));[m
[31m-[m
[31m-            Ref<Binarizer> binarizer(new HybridBinarizer(source));[m
[31m-            Ref<BinaryBitmap> bitmap(new BinaryBitmap(binarizer));[m
[31m-            Ref<Result> result;[m
[31m-[m
[31m-            // setup the code reader[m
[31m-            MultiFormatReader *reader = new MultiFormatReader();[m
[31m-            DecodeHints *hints = new DecodeHints();[m
[31m-[m
[31m-            hints->addFormat(BarcodeFormat_QR_CODE);[m
[31m-            hints->addFormat(BarcodeFormat_EAN_8);[m
[31m-            hints->addFormat(BarcodeFormat_EAN_13);[m
[31m-            hints->addFormat(BarcodeFormat_UPC_A);[m
[31m-            hints->addFormat(BarcodeFormat_UPC_E);[m
[31m-            hints->addFormat(BarcodeFormat_DATA_MATRIX);[m
[31m-            hints->addFormat(BarcodeFormat_CODE_128);[m
[31m-            hints->addFormat(BarcodeFormat_CODE_39);[m
[31m-            hints->addFormat(BarcodeFormat_ITF);[m
[31m-            hints->addFormat(BarcodeFormat_AZTEC);[m
[31m-[m
[31m-			// attempt to decode and retrieve a valid QR code from the image bitmap[m
[31m-			result = reader->decode(bitmap, *hints);[m
[31m-[m
[31m-            std::string newBarcodeData = result->getText()->getText().data();[m
[31m-[m
[31m-            Json::FastWriter writer;[m
[31m-            Json::Value root;[m
[31m-            root["text"] = newBarcodeData;[m
[31m-            root["format"] = barcodeFormatNames[result->getBarcodeFormat()];[m
[31m-            root["cancelled"] = false;[m
[31m-[m
[31m-            // notify caller that a valid QR code has been decoded[m
[31m-            if ( eventDispatcher != NULL){[m
[31m-            	std::string event = "community.barcodescanner.codefound.native";[m
[31m-            	event.insert(0, " ");[m
[31m-            	event.insert(0, (char *) arg);[m
[31m-            	eventDispatcher->NotifyEvent(event + " " + writer.write(root));[m
[31m-            	eventDispatcher->getLog()->debug("This is the detected Barcode");[m
[31m-            	eventDispatcher->getLog()->debug(newBarcodeData.c_str());[m
[31m-            }[m
[31m-[m
[31m-        }[m
[31m-        catch (const std::exception& ex)[m
[31m-        {[m
[31m-            // Uncomment this if you need to verify scanning[m
[31m-            if ( eventDispatcher != NULL ){[m
[31m-//               eventDispatcher->getLog()->warn("Scan error");[m
[31m-//               eventDispatcher->getLog()->warn(ex.what());[m
[31m-            }[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    std::string convertIntToString(int i) {[m
[31m-		stringstream ss;[m
[31m-		ss << i;[m
[31m-		return ss.str();[m
[31m-	}[m
[31m-[m
[31m-[m
[31m-    /*[m
[31m-     * Constructor for Barcode Scanner NDK class[m
[31m-     */[m
[31m-    BarcodeScannerNDK::BarcodeScannerNDK(BarcodeScannerJS *parent): threadHalt(false) {[m
[31m-    	cbId = new char[1000];[m
[31m-        m_pParent     = parent;[m
[31m-        eventDispatcher = parent;[m
[31m-        mCameraHandle = CAMERA_HANDLE_INVALID;[m
[31m-    }[m
[31m-[m
[31m-    BarcodeScannerNDK::~BarcodeScannerNDK() {[m
[31m-    	delete[] cbId;[m
[31m-    }[m
[31m-[m
[31m-    webworks::Logger* BarcodeScannerNDK::getLog() {[m
[31m-        return m_pParent->getLog();[m
[31m-    }[m
[31m-[m
[31m-    void interrogateWindowCV(screen_window_t window, Logger* log, string description, int property) {[m
[31m-        char* value = new char[256];[m
[31m-        int ok = screen_get_window_property_cv(window, property, 256, value);[m
[31m-        if (ok == 0) {[m
[31m-            log->info(description.c_str());[m
[31m-            log->info(value);[m
[31m-        } else {[m
[31m-            log->warn("Unable to interpret value for");[m
[31m-            log->warn(description.c_str());[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    void interrogateWindowIV(screen_window_t window, Logger* log, string description, int property) {[m
[31m-        int value = -1;[m
[31m-        int ok = screen_get_window_property_iv(window, property, &value);[m
[31m-        if (ok == 0) {[m
[31m-            log->info(description.c_str());[m
[31m-            log->info(convertIntToString(value).c_str());[m
[31m-        } else {[m
[31m-            log->warn("Unable to interpret value for");[m
[31m-            log->warn(description.c_str());[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    void interrogateWindow(screen_window_t window, Logger* log) {[m
[31m-        log->info("Window Details--->");[m
[31m-        interrogateWindowCV(window, log, "Window ID", SCREEN_PROPERTY_ID_STRING);[m
[31m-        interrogateWindowIV(window, log, "Window Type", SCREEN_PROPERTY_TYPE);[m
[31m-        interrogateWindowIV(window, log, "Window Owner PID", SCREEN_PROPERTY_OWNER_PID);[m
[31m-        interrogateWindowCV(window, log, "Window Group", SCREEN_PROPERTY_GROUP);[m
[31m-        interrogateWindowIV(window, log, "Window Z Order", SCREEN_PROPERTY_ZORDER);[m
[31m-        interrogateWindowIV(window, log, "Window Visible", SCREEN_PROPERTY_VISIBLE);[m
[31m-        log->info("Window Interrogation complete");[m
[31m-    }[m
[31m-[m
[31m-    void *HandleEvents(void *args) {[m
[31m-        BarcodeScannerNDK *parent = static_cast<BarcodeScannerNDK *>(args);[m
[31m-        parent->getLog()->debug("BarcodeScannerNDK EventHandler");[m
[31m-[m
[31m-        /**[m
[31m-         * Creating a native viewfinder screen[m
[31m-         */[m
[31m-        const int usage = SCREEN_USAGE_NATIVE;[m
[31m-        screen_window_t screen_win;[m
[31m-        screen_buffer_t screen_buf = NULL;[m
[31m-        int rect[4] = { 0, 0, 0, 0 };[m
[31m-[m
[31m-        if(screen_create_window_type(&screen_win, parent->windowContext, SCREEN_CHILD_WINDOW) == -1) {[m
[31m-            parent->getLog()->error("screen_create_window() failed");;[m
[31m-        }[m
[31m-        screen_join_window_group(screen_win, parent->windowGroup);[m
[31m-        char * groupCheck = new char[256];[m
[31m-        screen_get_window_property_cv(screen_win, SCREEN_PROPERTY_GROUP, 256, groupCheck);[m
[31m-        parent->getLog()->info("Window Group Check");[m
[31m-        parent->getLog()->info(groupCheck);[m
[31m-        screen_set_window_property_iv(screen_win, SCREEN_PROPERTY_USAGE, &usage);[m
[31m-        int r = 0;[m
[31m-        screen_display_t display = NULL;[m
[31m-        screen_get_window_property_pv(screen_win, SCREEN_PROPERTY_DISPLAY, (void**)&display);[m
[31m-        if (display != NULL) {[m
[31m-            screen_get_display_property_iv(display, SCREEN_PROPERTY_ROTATION, &r);[m
[31m-            parent->getLog()->debug("Current Display Rotation");[m
[31m-            parent->getLog()->debug(convertIntToString(r).c_str());[m
[31m-        }[m
[31m-        screen_create_window_buffers(screen_win, 1);[m
[31m-        screen_get_window_property_pv(screen_win, SCREEN_PROPERTY_RENDER_BUFFERS, (void **)&screen_buf);[m
[31m-        screen_get_window_property_iv(screen_win, SCREEN_PROPERTY_BUFFER_SIZE, rect+2);[m
[31m-        // The screen (and backing buffer) don't take into account the rotation, so we need to swap the size.[m
[31m-        if (r == 90 || r == 270) {[m
[31m-            int swap = rect[2];[m
[31m-            rect[2] = rect[3];[m
[31m-            rect[3] = swap;[m
[31m-        }[m
[31m-        // Set the window size and the buffer follows along[m
[31m-        screen_set_window_property_iv(screen_win, SCREEN_PROPERTY_SIZE, rect+2);[m
[31m-        screen_get_window_property_iv(screen_win, SCREEN_PROPERTY_BUFFER_SIZE, rect+2);[m
[31m-[m
[31m-        parent->getLog()->debug("Screen Buffer Size:");[m
[31m-        parent->getLog()->debug(convertIntToString(rect[0]).c_str());[m
[31m-        parent->getLog()->debug(convertIntToString(rect[1]).c_str());[m
[31m-        parent->getLog()->debug(convertIntToString(rect[2]).c_str());[m
[31m-        parent->getLog()->debug(convertIntToString(rect[3]).c_str());[m
[31m-[m
[31m-        int type = -1;[m
[31m-        screen_get_window_property_iv(screen_win, SCREEN_PROPERTY_TYPE, &type);[m
[31m-        parent->getLog()->debug("Window Type");[m
[31m-        parent->getLog()->debug(convertIntToString(type).c_str());[m
[31m-[m
[31m-        // fill the window with a flat colour[m
[31m-        int attribs[] = { SCREEN_BLIT_COLOR, 0x00333333, SCREEN_BLIT_END };[m
[31m-        screen_fill(parent->windowContext, screen_buf, attribs);[m
[31m-        screen_post_window(screen_win, screen_buf, 1, rect, 0);[m
[31m-        // position the window at an arbitrary z-order[m
[31m-        int i = 1;[m
[31m-        screen_set_window_property_iv(screen_win, SCREEN_PROPERTY_ZORDER, &i);[m
[31m-        screen_get_window_property_iv(screen_win, SCREEN_PROPERTY_ZORDER, &i);[m
[31m-        parent->getLog()->debug("Current Zorder");[m
[31m-        parent->getLog()->debug(convertIntToString(i).c_str());[m
[31m-        int visible = 1;[m
[31m-        screen_set_window_property_iv(screen_win, SCREEN_PROPERTY_VISIBLE, &visible);[m
[31m-        screen_get_window_property_iv(screen_win, SCREEN_PROPERTY_VISIBLE, &visible);[m
[31m-        parent->getLog()->debug("Visible?");[m
[31m-        parent->getLog()->debug(convertIntToString(visible).c_str());[m
[31m-        screen_flush_context(parent->windowContext, 0);[m
[31m-[m
[31m-        parent->getLog()->debug("Created Background window");[m
[31m-[m
[31m-        if (parent->windowContext) {[m
[31m-            if (BPS_SUCCESS == screen_request_events(parent->windowContext)) {[m
[31m-                parent->getLog()->debug("Requested Events");[m
[31m-            } else {[m
[31m-                parent->getLog()->error("Unable to request events");[m
[31m-                return NULL;[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        screen_group_t group;[m
[31m-        screen_get_window_property_pv(screen_win, SCREEN_PROPERTY_GROUP, (void **)&group);[m
[31m-        char* groupName = new char[256];[m
[31m-        screen_get_group_property_cv(group, SCREEN_PROPERTY_NAME, 256, groupName);[m
[31m-        parent->getLog()->debug("Group Found");[m
[31m-        parent->getLog()->debug(groupName);[m
[31m-[m
[31m-        // reset Touch value before starting up listening for touch events[m
[31m-        touch = false;[m
[31m-[m
[31m-        while(!parent->isThreadHalt()) {[m
[31m-            MUTEX_LOCK();[m
[31m-[m
[31m-            int domain;[m
[31m-            // Get the first event in the queue.[m
[31m-            bps_event_t *event = NULL;[m
[31m-            if (BPS_SUCCESS != bps_get_event(&event, 0)) {[m
[31m-                parent->getLog()->warn("bps_get_event() failed");[m
[31m-            }[m
[31m-[m
[31m-            // Handle all events in the queue.[m
[31m-            while (event) {[m
[31m-                if (touch) {[m
[31m-                    // HandleScreenEvent got a tap on the screen[m
[31m-                    // Shutdown the scanning[m
[31m-                    parent->cancelScan();[m
[31m-                    break;[m
[31m-                }[m
[31m-                if (event) {[m
[31m-                    domain = bps_event_get_domain(event);[m
[31m-                    parent->getLog()->debug("BPS Event");[m
[31m-                    if (domain == screen_get_domain()) {[m
[31m-                        parent->getLog()->debug("BPS Screen Event");[m
[31m-                        parent->handleScreenEvent(event, parent->getLog(), parent->windowGroup);[m
[31m-                    }[m
[31m-                }[m
[31m-                if (BPS_SUCCESS != bps_get_event(&event, 0)) {[m
[31m-                    parent->getLog()->error("bps_get_event() failed");[m
[31m-//                                return;[m
[31m-                }[m
[31m-            }[m
[31m-[m
[31m-            MUTEX_UNLOCK();[m
[31m-[m
[31m-            // Poll at 10hz[m
[31m-            usleep(100000);[m
[31m-        }[m
[31m-        // stop screen events on this thread[m
[31m-        if(screen_stop_events(parent->windowContext) == -1) {[m
[31m-            parent->getLog()->error("screen_stop_events failed");[m
[31m-        }[m
[31m-        screen_destroy_window(screen_win);[m
[31m-        return NULL;[m
[31m-    }[m
[31m-[m
[31m-    void BarcodeScannerNDK::handleScreenEvent(bps_event_t *event, Logger* log, const char* windowGroup) {[m
[31m-        int eventType, objectType, eventProperty;[m
[31m-[m
[31m-        screen_event_t screen_event = screen_event_get_event(event);[m
[31m-        screen_get_event_property_iv(screen_event, SCREEN_PROPERTY_TYPE, &eventType);[m
[31m-[m
[31m-        switch (eventType) {[m
[31m-        case SCREEN_EVENT_MTOUCH_RELEASE:[m
[31m-        case SCREEN_EVENT_MTOUCH_TOUCH:[m
[31m-        case SCREEN_EVENT_MTOUCH_MOVE:[m
[31m-            log->info("Touch Event");[m
[31m-            touch = true;[m
[31m-            break;[m
[31m-        case SCREEN_EVENT_CREATE:[m
[31m-            log->info("Screen Create Event");[m
[31m-            if (screen_get_event_property_pv(screen_event, SCREEN_PROPERTY_WINDOW, (void **)&vf_win) == -1) {[m
[31m-                log->error("screen_get_event_property_pv(SCREEN_PROPERTY_WINDOW)");[m
[31m-            } else {[m
[31m-                log->info("viewfinder window found!");[m
[31m-            }[m
[31m-            break;[m
[31m-        case SCREEN_EVENT_IDLE:[m
[31m-            log->debug("Screen Idle");[m
[31m-            break;[m
[31m-        case SCREEN_EVENT_POST:[m
[31m-            log->debug("Screen posted first frame");[m
[31m-            if (screen_get_event_property_pv(screen_event, SCREEN_PROPERTY_WINDOW, (void **)&vf_win) == -1) {[m
[31m-                log->error("screen_get_event_property_pv(SCREEN_PROPERTY_WINDOW)");[m
[31m-            } else {[m
[31m-                interrogateWindow(vf_win, log);[m
[31m-                int i = 100;[m
[31m-                screen_set_window_property_iv(vf_win, SCREEN_PROPERTY_ZORDER, &i);[m
[31m-                screen_get_window_property_iv(vf_win, SCREEN_PROPERTY_ZORDER, &i);[m
[31m-                log->debug("Current Zorder");[m
[31m-                log->debug(convertIntToString(i).c_str());[m
[31m-                // make viewfinder window visible[m
[31m-                i = 1;[m
[31m-                screen_set_window_property_iv(vf_win, SCREEN_PROPERTY_VISIBLE, &i);[m
[31m-                screen_get_window_property_iv(vf_win, SCREEN_PROPERTY_VISIBLE, &i);[m
[31m-                log->debug("Visible?");[m
[31m-                log->debug(convertIntToString(i).c_str());[m
[31m-                // Rotate the window as needed[m
[31m-                screen_get_window_property_iv(vf_win, SCREEN_PROPERTY_ROTATION, &i);[m
[31m-                log->debug("Current Rotation");[m
[31m-                log->debug(convertIntToString(i).c_str());[m
[31m-                i = 360 - vfRotation;[m
[31m-                screen_set_window_property_iv(vf_win, SCREEN_PROPERTY_ROTATION, &i);[m
[31m-                screen_get_window_property_iv(vf_win, SCREEN_PROPERTY_ROTATION, &i);[m
[31m-                log->debug("Rotation");[m
[31m-                log->debug(convertIntToString(i).c_str());[m
[31m-                // Make full screen[m
[31m-                screen_display_t display = NULL;[m
[31m-                screen_get_window_property_pv(vf_win, SCREEN_PROPERTY_DISPLAY, (void **)&display);[m
[31m-                if (display != NULL) {[m
[31m-                    log->debug("Found a Display");[m
[31m-                    int size[2] = { 0, 0 };[m
[31m-                    screen_get_display_property_iv(display, SCREEN_PROPERTY_SIZE, size);[m
[31m-                    log->debug("Display Size");[m
[31m-                    log->debug(convertIntToString(size[0]).c_str());[m
[31m-                    log->debug(convertIntToString(size[1]).c_str());[m
[31m-                    int r = 0;[m
[31m-                    screen_get_display_property_iv(display, SCREEN_PROPERTY_ROTATION, &r);[m
[31m-                    log->debug("Current Display Rotation");[m
[31m-                    log->debug(convertIntToString(r).c_str());[m
[31m-                    if (r == 90 || r == 270) {[m
[31m-                        int swap = size[0];[m
[31m-                        size[0] = size[1];[m
[31m-                        size[1] = swap;[m
[31m-                    }[m
[31m-                    screen_set_window_property_iv(vf_win, SCREEN_PROPERTY_SIZE, size);[m
[31m-                    screen_get_window_property_iv(vf_win, SCREEN_PROPERTY_SIZE, size);[m
[31m-                    log->debug("Window Size");[m
[31m-                    log->debug(convertIntToString(size[0]).c_str());[m
[31m-                    log->debug(convertIntToString(size[1]).c_str());[m
[31m-                }[m
[31m-[m
[31m-            }[m
[31m-            break;[m
[31m-        case SCREEN_EVENT_CLOSE:[m
[31m-            log->debug("Screen closed");[m
[31m-            break;[m
[31m-        case SCREEN_EVENT_INPUT:[m
[31m-            log->debug("Screen input event");[m
[31m-            break;[m
[31m-        case SCREEN_EVENT_PROPERTY:[m
[31m-            log->debug("Screen property event");[m
[31m-            screen_get_event_property_iv(screen_event, SCREEN_PROPERTY_OBJECT_TYPE, &objectType);[m
[31m-            log->debug("Object Type");[m
[31m-            log->debug(convertIntToString(objectType).c_str());[m
[31m-            screen_get_event_property_iv(screen_event, SCREEN_PROPERTY_NAME, &eventProperty);[m
[31m-            log->debug("Property Name");[m
[31m-            log->debug(convertIntToString(eventProperty).c_str());[m
[31m-            break;[m
[31m-        default:[m
[31m-            log->warn("Unhandled Screen Event Type");[m
[31m-            log->warn(convertIntToString(eventType).c_str());[m
[31m-            break;[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    bool BarcodeScannerNDK::StartEvents() {[m
[31m-        if (!m_thread) {[m
[31m-            threadHalt = false;[m
[31m-            pthread_attr_t thread_attr;[m
[31m-            pthread_attr_init(&thread_attr);[m
[31m-            pthread_attr_setdetachstate(&thread_attr, PTHREAD_CREATE_JOINABLE);[m
[31m-            int error = pthread_create(&m_thread, &thread_attr, HandleEvents, static_cast<void *>(this));[m
[31m-            pthread_attr_destroy(&thread_attr);[m
[31m-            if (error) {[m
[31m-                m_pParent->getLog()->error("Thread Failed to start");[m
[31m-                m_thread = 0;[m
[31m-                return false;[m
[31m-            } else {[m
[31m-                m_pParent->getLog()->info("Thread Started");[m
[31m-                MUTEX_LOCK();[m
[31m-                return true;[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        return false;[m
[31m-    }[m
[31m-[m
[31m-    void BarcodeScannerNDK::StopEvents() {[m
[31m-        if (m_thread) {[m
[31m-            MUTEX_LOCK();[m
[31m-            threadHalt = true;[m
[31m-            MUTEX_UNLOCK();[m
[31m-            m_pParent->getLog()->debug("BarcodeScannerNDK joining event thread");[m
[31m-            pthread_join(m_thread, NULL);[m
[31m-            m_thread = 0;[m
[31m-            m_pParent->getLog()->debug("BarcodeScannerNDK event thread stopped");[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-[m
[31m-    // getter for the stop value[m
[31m-    bool BarcodeScannerNDK::isThreadHalt() {[m
[31m-        bool isThreadHalt;[m
[31m-        MUTEX_LOCK();[m
[31m-        isThreadHalt = threadHalt;[m
[31m-        MUTEX_UNLOCK();[m
[31m-        return isThreadHalt;[m
[31m-    }[m
[31m-[m
[31m-    void BarcodeScannerNDK::cancelScan() {[m
[31m-        m_pParent->getLog()->warn("Cancel Scan");[m
[31m-        std::string event = "community.barcodescanner.codefound.native";[m
[31m-        std::string callbackId = cbId;[m
[31m-        Json::FastWriter writer;[m
[31m-        Json::Value root;[m
[31m-[m
[31m-        // Scan cancelled by user[m
[31m-        root["text"] = "";[m
[31m-        root["format"] = "";[m
[31m-        root["cancelled"] = true;[m
[31m-[m
[31m-        m_pParent->NotifyEvent(callbackId + " "  + event + " " + writer.write(root));[m
[31m-    }[m
[31m-[m
[31m-    /*[m
[31m-     * BarcodeScannerNDK::startRead[m
[31m-     *[m
[31m-     * This method is called to start a QR code read. A connection is opened to the device camera[m
[31m-     * and the photo viewfinder is started.[m
[31m-     */[m
[31m-    int BarcodeScannerNDK::startRead(const string &callbackId, const string &arg) {[m
[31m-    	std::string errorEvent = "community.barcodescanner.errorfound.native";[m
[31m-        Json::FastWriter writer;[m
[31m-        Json::Value root;[m
[31m-[m
[31m-        // Important for maintaining proper event queue support on 10.2.1[m
[31m-        bps_initialize();[m
[31m-[m
[31m-        std::string handle;[m
[31m-        std::string group;[m
[31m-        Json::Reader reader;[m
[31m-        Json::Value input;[m
[31m-        bool parse = reader.parse(arg, input);[m
[31m-[m
[31m-        if (!parse) {[m
[31m-            m_pParent->getLog()->error("Parse Error");[m
[31m-            Json::Value error;[m
[31m-            root["state"] = "Parsing JSON object";[m
[31m-            root["error"] = "Cannot parse JSON object";[m
[31m-            root["description"] = "";[m
[31m-            m_pParent->NotifyEvent(callbackId + " " + errorEvent + " " + writer.write(error));[m
[31m-            return EIO;[m
[31m-        } else {[m
[31m-            handle = input["handle"].asString();[m
[31m-            group = input["group"].asString();[m
[31m-        }[m
[31m-[m
[31m-        std::copy(callbackId.begin(), callbackId.end(), this->cbId);[m
[31m-        this->cbId[callbackId.size()] = '\0';[m
[31m-[m
[31m-        this->windowHandle = handle;[m
[31m-        m_pParent->getLog()->info("Window Handle");[m
[31m-        m_pParent->getLog()->info(handle.c_str());[m
[31m-        // the jsScreenWindowHandle of the UIWebView that we passed in[m
[31m-        int windowPointer = (int) strtol(handle.c_str(), NULL, 10);[m
[31m-        // As an integer is the actual window handle[m
[31m-        screen_window_t window = (screen_window_t) windowPointer;[m
[31m-        interrogateWindow(window, m_pParent->getLog());[m
[31m-        // Create a group for the main window[m
[31m-        windowGroup = new char[group.length()+1];[m
[31m-        std::strcpy (windowGroup, group.c_str());[m
[31m-        m_pParent->getLog()->debug("Window Group using:");[m
[31m-        m_pParent->getLog()->debug(windowGroup);[m
[31m-[m
[31m-        int getContext = screen_get_window_property_pv(window, SCREEN_PROPERTY_CONTEXT, (void **)&windowContext);[m
[31m-        if (getContext == -1) {[m
[31m-            m_pParent->getLog()->critical("Unable to get Context");[m
[31m-            root["state"] = "Get App Window Context";[m
[31m-            root["error"] = getContext;[m
[31m-            root["description"] = "Unable to get application context";[m
[31m-            m_pParent->NotifyEvent(callbackId + " " + errorEvent + " " + writer.write(root));[m
[31m-            return EIO;[m
[31m-        }[m
[31m-[m
[31m-        StartEvents();[m
[31m-[m
[31m-        camera_error_t err;[m
[31m-        // Open the camera first before running any operations on it[m
[31m-        err = camera_open(CAMERA_UNIT_REAR,CAMERA_MODE_RW | CAMERA_MODE_ROLL,&mCameraHandle);[m
[31m-[m
[31m-        if ( err != CAMERA_EOK){[m
[31m-            m_pParent->getLog()->error("Ran into an issue when initializing the camera");[m
[31m-            m_pParent->getLog()->error(getCameraErrorDesc( err ));[m
[31m-            root["state"] = "Open Camera";[m
[31m-            root["error"] = err;[m
[31m-            root["description"] = getCameraErrorDesc( err );[m
[31m-            m_pParent->NotifyEvent(callbackId + " " + errorEvent + " " + writer.write(root));[m
[31m-            return EIO;[m
[31m-        }[m
[31m-[m
[31m-        // We want maximum framerate from the viewfinder which will scan for codes[m
[31m-        int numRates = 0;[m
[31m-		err = camera_get_photo_vf_framerates(mCameraHandle, true, 0, &numRates, NULL, NULL);[m
[31m-		double* camFramerates = new double[numRates];[m
[31m-		bool maxmin = false;[m
[31m-		err = camera_get_photo_vf_framerates(mCameraHandle, true, numRates, &numRates, camFramerates, &maxmin);[m
[31m-[m
[31m-		// do we need to rotate the viewfinder?[m
[31m-[m
[31m-		err = camera_get_photovf_property(mCameraHandle, CAMERA_IMGPROP_ROTATION, &vfRotation);[m
[31m-		m_pParent->getLog()->debug("Viewfinder Rotation");[m
[31m-		m_pParent->getLog()->debug(convertIntToString(vfRotation).c_str());[m
[31m-[m
[31m-		m_pParent->getLog()->debug("Camera Window Group");[m
[31m-		m_pParent->getLog()->debug(windowGroup);[m
[31m-		// We're going to have the viewfinder window join our app's window group, and start an embedded window[m
[31m-		err = camera_set_photovf_property(mCameraHandle,[m
[31m-		    CAMERA_IMGPROP_WIN_GROUPID, windowGroup,[m
[31m-		    CAMERA_IMGPROP_WIN_ID, "my_viewfinder");[m
[31m-		if ( err != CAMERA_EOK){[m
[31m-		    m_pParent->getLog()->error("Ran into an issue when configuring the camera viewfinder");[m
[31m-		    m_pParent->getLog()->error(getCameraErrorDesc( err ));[m
[31m-			root["state"] = "Set VF Props";[m
[31m-			root["error"] = err;[m
[31m-			root["description"] = getCameraErrorDesc( err );[m
[31m-			m_pParent->NotifyEvent(callbackId + " " + errorEvent + " " + writer.write(root));[m
[31m-			return EIO;[m
[31m-		}[m
[31m-[m
[31m-		// Starting viewfinder up which will call the viewfinder callback - this gets the NV12 images for scanning[m
[31m-        err = camera_start_photo_viewfinder( mCameraHandle, &viewfinder_callback, NULL, this->cbId);[m
[31m-        if ( err != CAMERA_EOK) {[m
[31m-            m_pParent->getLog()->error("Ran into a strange issue when starting up the camera viewfinder");[m
[31m-            m_pParent->getLog()->error(getCameraErrorDesc( err ));[m
[31m-            root["state"] = "ViewFinder Start";[m
[31m-            root["error"] = err;[m
[31m-            root["description"] = getCameraErrorDesc( err );[m
[31m-            m_pParent->NotifyEvent(callbackId + " " + errorEvent + " " + writer.write(root));[m
[31m-            return EIO;[m
[31m-        }[m
[31m-[m
[31m-        // Focus mode can't be set until the viewfinder is started. We need Continuous Macro for barcodes[m
[31m-        err = camera_set_focus_mode(mCameraHandle, CAMERA_FOCUSMODE_CONTINUOUS_MACRO);[m
[31m-		if ( err != CAMERA_EOK){[m
[31m-		    m_pParent->getLog()->error("Ran into an issue when setting focus mode");[m
[31m-		    m_pParent->getLog()->error(getCameraErrorDesc( err ));[m
[31m-			root["state"] = "Set Focus Mode";[m
[31m-			root["error"] = err;[m
[31m-			root["description"] =  getCameraErrorDesc( err );[m
[31m-			m_pParent->NotifyEvent(callbackId + " " + errorEvent + " " + writer.write(root));[m
[31m-			return EIO;[m
[31m-		}[m
[31m-[m
[31m-        std::string successEvent = "community.barcodescanner.started.native";[m
[31m-        root["successful"] = true;[m
[31m-        m_pParent->NotifyEvent(callbackId + " " + successEvent + " " + writer.write(root));[m
[31m-        return EOK;[m
[31m-    }[m
[31m-[m
[31m-[m
[31m-    /*[m
[31m-     * BarcodeScannerNDK::stopRead[m
[31m-     *[m
[31m-     * This method is called to clean up following successful detection of a barcode.[m
[31m-     * Calling this method will stop the viewfinder and close an open connection to the device camera.[m
[31m-     */[m
[31m-    int BarcodeScannerNDK::stopRead(const string &callbackId) {[m
[31m-    	std::string errorEvent = "community.barcodescanner.errorfound.native";[m
[31m-		Json::FastWriter writer;[m
[31m-		Json::Value root;[m
[31m-        camera_error_t err;[m
[31m-[m
[31m-        // Stop events first so that you don't get better response from the screen[m
[31m-        StopEvents();[m
[31m-[m
[31m-        err = camera_stop_photo_viewfinder(mCameraHandle);[m
[31m-        if ( err != CAMERA_EOK)[m
[31m-        {[m
[31m-            m_pParent->getLog()->error("Error with turning off the photo viewfinder");[m
[31m-            m_pParent->getLog()->error(getCameraErrorDesc( err ));[m
[31m-            root["error"] = err;[m
[31m-		    root["description"] = getCameraErrorDesc( err );[m
[31m-		    m_pParent->NotifyEvent(callbackId + " " + errorEvent + " " + writer.write(root));[m
[31m-            return EIO;[m
[31m-        }[m
[31m-[m
[31m-        //check to see if the camera is open, if it is open, then close it[m
[31m-        err = camera_close(mCameraHandle);[m
[31m-        if ( err != CAMERA_EOK){[m
[31m-            m_pParent->getLog()->error("Error with closing the camera");[m
[31m-            m_pParent->getLog()->error(getCameraErrorDesc( err ));[m
[31m-            root["error"] = err;[m
[31m-            root["description"] = getCameraErrorDesc( err );[m
[31m-            m_pParent->NotifyEvent(callbackId + " " + errorEvent + " " + writer.write(root));[m
[31m-            return EIO;[m
[31m-        }[m
[31m-[m
[31m-        std::string successEvent = "community.barcodescanner.ended.native";[m
[31m-        root["successful"] = true;[m
[31m-        mCameraHandle = CAMERA_HANDLE_INVALID;[m
[31m-        m_pParent->NotifyEvent(callbackId + " " + successEvent + " " + writer.write(root));[m
[31m-[m
[31m-        // Important for maintaining proper event queue support on 10.2.1[m
[31m-        bps_shutdown();[m
[31m-[m
[31m-        return EOK;[m
[31m-    }[m
[31m-[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/barcodescanner_ndk.hpp b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/barcodescanner_ndk.hpp[m
[1mdeleted file mode 100755[m
[1mindex 9289f6a..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/native/src/barcodescanner_ndk.hpp[m
[1m+++ /dev/null[m
[36m@@ -1,55 +0,0 @@[m
[31m-/*[m
[31m-* Copyright 2013-2015 BlackBerry Limited.[m
[31m-*[m
[31m-* Licensed under the Apache License, Version 2.0 (the "License");[m
[31m-* you may not use this file except in compliance with the License.[m
[31m-* You may obtain a copy of the License at[m
[31m-*[m
[31m-* http://www.apache.org/licenses/LICENSE-2.0[m
[31m-*[m
[31m-* Unless required by applicable law or agreed to in writing, software[m
[31m-* distributed under the License is distributed on an "AS IS" BASIS,[m
[31m-* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m-* See the License for the specific language governing permissions and[m
[31m-* limitations under the License.[m
[31m-*/[m
[31m-[m
[31m-#ifndef BARCODESCANNERNDK_HPP_[m
[31m-#define BARCODESCANNERNDK_HPP_[m
[31m-[m
[31m-#include <camera/camera_api.h>[m
[31m-#include "Logger.hpp"[m
[31m-#include <bps/event.h>[m
[31m-#include <string>[m
[31m-[m
[31m-class BarcodeScannerJS;[m
[31m-[m
[31m-namespace webworks {[m
[31m-[m
[31m-class BarcodeScannerNDK {[m
[31m-public:[m
[31m-    explicit BarcodeScannerNDK(BarcodeScannerJS *parent = NULL);[m
[31m-    virtual ~BarcodeScannerNDK();[m
[31m-[m
[31m-    int startRead(const std::string& callbackId, const std::string& handle);[m
[31m-    int stopRead(const std::string& callbackId);[m
[31m-    bool isThreadHalt();[m
[31m-    void StopEvents();[m
[31m-    bool StartEvents();[m
[31m-    Logger* getLog();[m
[31m-    void handleScreenEvent(bps_event_t *event, Logger* log, const char* windowGroup);[m
[31m-    void cancelScan();[m
[31m-    char* windowGroup;[m
[31m-    screen_context_t windowContext;[m
[31m-    char* cbId;[m
[31m-[m
[31m-private:[m
[31m-    BarcodeScannerJS *m_pParent;[m
[31m-    camera_handle_t mCameraHandle;[m
[31m-    bool threadHalt;[m
[31m-    std::string windowHandle;[m
[31m-};[m
[31m-[m
[31m-} // namespace webworks[m
[31m-[m
[31m-#endif /* BARCODESCANNERNDK_H_ */[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/qrcode.js b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/qrcode.js[m
[1mdeleted file mode 100755[m
[1mindex 5cb6a7a..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/blackberry10/qrcode.js[m
[1m+++ /dev/null[m
[36m@@ -1,622 +0,0 @@[m
[31m-/**[m
[31m- * @fileoverview[m
[31m- * - Using the 'QRCode for Javascript library'[m
[31m- * - Fixed dataset of 'QRCode for Javascript library' for support full-spec.[m
[31m- * - this library has no dependencies.[m
[31m- * [m
[31m- * @author davidshimjs[m
[31m- * @see <a href="http://www.d-project.com/" target="_blank">http://www.d-project.com/</a>[m
[31m- * @see <a href="http://jeromeetienne.github.com/jquery-qrcode/" target="_blank">http://jeromeetienne.github.com/jquery-qrcode/</a>[m
[31m- */[m
[31m-var QRCode;[m
[31m-//var _utils = require("../../lib/utils");[m
[31m-[m
[31m-(function () {[m
[31m-	//---------------------------------------------------------------------[m
[31m-	// QRCode for JavaScript[m
[31m-	//[m
[31m-	// Copyright (c) 2009 Kazuhiko Arase[m
[31m-	//[m
[31m-	// URL: http://www.d-project.com/[m
[31m-	//[m
[31m-	// Licensed under the MIT license:[m
[31m-	//   http://www.opensource.org/licenses/mit-license.php[m
[31m-	//[m
[31m-	// The word "QR Code" is registered trademark of [m
[31m-	// DENSO WAVE INCORPORATED[m
[31m-	//   http://www.denso-wave.com/qrcode/faqpatent-e.html[m
[31m-	//[m
[31m-	//---------------------------------------------------------------------[m
[31m-	function QR8bitByte(data) {[m
[31m-		this.mode = QRMode.MODE_8BIT_BYTE;[m
[31m-		this.data = data;[m
[31m-		this.parsedData = [];[m
[31m-[m
[31m-		// Added to support UTF-8 Characters[m
[31m-		for (var i = 0, l = this.data.length; i < l; i++) {[m
[31m-			var byteArray = [];[m
[31m-			var code = this.data.charCodeAt(i);[m
[31m-[m
[31m-			if (code > 0x10000) {[m
[31m-				byteArray[0] = 0xF0 | ((code & 0x1C0000) >>> 18);[m
[31m-				byteArray[1] = 0x80 | ((code & 0x3F000) >>> 12);[m
[31m-				byteArray[2] = 0x80 | ((code & 0xFC0) >>> 6);[m
[31m-				byteArray[3] = 0x80 | (code & 0x3F);[m
[31m-			} else if (code > 0x800) {[m
[31m-				byteArray[0] = 0xE0 | ((code & 0xF000) >>> 12);[m
[31m-				byteArray[1] = 0x80 | ((code & 0xFC0) >>> 6);[m
[31m-				byteArray[2] = 0x80 | (code & 0x3F);[m
[31m-			} else if (code > 0x80) {[m
[31m-				byteArray[0] = 0xC0 | ((code & 0x7C0) >>> 6);[m
[31m-				byteArray[1] = 0x80 | (code & 0x3F);[m
[31m-			} else {[m
[31m-				byteArray[0] = code;[m
[31m-			}[m
[31m-[m
[31m-			this.parsedData.push(byteArray);[m
[31m-		}[m
[31m-[m
[31m-		this.parsedData = Array.prototype.concat.apply([], this.parsedData);[m
[31m-[m
[31m-		if (this.parsedData.length != this.data.length) {[m
[31m-			this.parsedData.unshift(191);[m
[31m-			this.parsedData.unshift(187);[m
[31m-			this.parsedData.unshift(239);[m
[31m-		}[m
[31m-	}[m
[31m-[m
[31m-	QR8bitByte.prototype = {[m
[31m-		getLength: function (buffer) {[m
[31m-			return this.parsedData.length;[m
[31m-		},[m
[31m-		write: function (buffer) {[m
[31m-			for (var i = 0, l = this.parsedData.length; i < l; i++) {[m
[31m-				buffer.put(this.parsedData[i], 8);[m
[31m-			}[m
[31m-		}[m
[31m-	};[m
[31m-[m
[31m-	function QRCodeModel(typeNumber, errorCorrectLevel) {[m
[31m-		this.typeNumber = typeNumber;[m
[31m-		this.errorCorrectLevel = errorCorrectLevel;[m
[31m-		this.modules = null;[m
[31m-		this.moduleCount = 0;[m
[31m-		this.dataCache = null;[m
[31m-		this.dataList = [];[m
[31m-	}[m
[31m-[m
[31m-	QRCodeModel.prototype={addData:function(data){var newData=new QR8bitByte(data);this.dataList.push(newData);this.dataCache=null;},isDark:function(row,col){if(row<0||this.moduleCount<=row||col<0||this.moduleCount<=col){throw new Error(row+","+col);}[m
[31m-	return this.modules[row][col];},getModuleCount:function(){return this.moduleCount;},make:function(){this.makeImpl(false,this.getBestMaskPattern());},makeImpl:function(test,maskPattern){this.moduleCount=this.typeNumber*4+17;this.modules=new Array(this.moduleCount);for(var row=0;row<this.moduleCount;row++){this.modules[row]=new Array(this.moduleCount);for(var col=0;col<this.moduleCount;col++){this.modules[row][col]=null;}}[m
[31m-	this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(test,maskPattern);if(this.typeNumber>=7){this.setupTypeNumber(test);}[m
[31m-	if(this.dataCache==null){this.dataCache=QRCodeModel.createData(this.typeNumber,this.errorCorrectLevel,this.dataList);}[m
[31m-	this.mapData(this.dataCache,maskPattern);},setupPositionProbePattern:function(row,col){for(var r=-1;r<=7;r++){if(row+r<=-1||this.moduleCount<=row+r)continue;for(var c=-1;c<=7;c++){if(col+c<=-1||this.moduleCount<=col+c)continue;if((0<=r&&r<=6&&(c==0||c==6))||(0<=c&&c<=6&&(r==0||r==6))||(2<=r&&r<=4&&2<=c&&c<=4)){this.modules[row+r][col+c]=true;}else{this.modules[row+r][col+c]=false;}}}},getBestMaskPattern:function(){var minLostPoint=0;var pattern=0;for(var i=0;i<8;i++){this.makeImpl(true,i);var lostPoint=QRUtil.getLostPoint(this);if(i==0||minLostPoint>lostPoint){minLostPoint=lostPoint;pattern=i;}}[m
[31m-	return pattern;},createMovieClip:function(target_mc,instance_name,depth){var qr_mc=target_mc.createEmptyMovieClip(instance_name,depth);var cs=1;this.make();for(var row=0;row<this.modules.length;row++){var y=row*cs;for(var col=0;col<this.modules[row].length;col++){var x=col*cs;var dark=this.modules[row][col];if(dark){qr_mc.beginFill(0,100);qr_mc.moveTo(x,y);qr_mc.lineTo(x+cs,y);qr_mc.lineTo(x+cs,y+cs);qr_mc.lineTo(x,y+cs);qr_mc.endFill();}}}[m
[31m-	return qr_mc;},setupTimingPattern:function(){for(var r=8;r<this.moduleCount-8;r++){if(this.modules[r][6]!=null){continue;}[m
[31m-	this.modules[r][6]=(r%2==0);}[m
[31m-	for(var c=8;c<this.moduleCount-8;c++){if(this.modules[6][c]!=null){continue;}[m
[31m-	this.modules[6][c]=(c%2==0);}},setupPositionAdjustPattern:function(){var pos=QRUtil.getPatternPosition(this.typeNumber);for(var i=0;i<pos.length;i++){for(var j=0;j<pos.length;j++){var row=pos[i];var col=pos[j];if(this.modules[row][col]!=null){continue;}[m
[31m-	for(var r=-2;r<=2;r++){for(var c=-2;c<=2;c++){if(r==-2||r==2||c==-2||c==2||(r==0&&c==0)){this.modules[row+r][col+c]=true;}else{this.modules[row+r][col+c]=false;}}}}}},setupTypeNumber:function(test){var bits=QRUtil.getBCHTypeNumber(this.typeNumber);for(var i=0;i<18;i++){var mod=(!test&&((bits>>i)&1)==1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=mod;}[m
[31m-	for(var i=0;i<18;i++){var mod=(!test&&((bits>>i)&1)==1);this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=mod;}},setupTypeInfo:function(test,maskPattern){var data=(this.errorCorrectLevel<<3)|maskPattern;var bits=QRUtil.getBCHTypeInfo(data);for(var i=0;i<15;i++){var mod=(!test&&((bits>>i)&1)==1);if(i<6){this.modules[i][8]=mod;}else if(i<8){this.modules[i+1][8]=mod;}else{this.modules[this.moduleCount-15+i][8]=mod;}}[m
[31m-	for(var i=0;i<15;i++){var mod=(!test&&((bits>>i)&1)==1);if(i<8){this.modules[8][this.moduleCount-i-1]=mod;}else if(i<9){this.modules[8][15-i-1+1]=mod;}else{this.modules[8][15-i-1]=mod;}}[m
[31m-	this.modules[this.moduleCount-8][8]=(!test);},mapData:function(data,maskPattern){var inc=-1;var row=this.moduleCount-1;var bitIndex=7;var byteIndex=0;for(var col=this.moduleCount-1;col>0;col-=2){if(col==6)col--;while(true){for(var c=0;c<2;c++){if(this.modules[row][col-c]==null){var dark=false;if(byteIndex<data.length){dark=(((data[byteIndex]>>>bitIndex)&1)==1);}[m
[31m-	var mask=QRUtil.getMask(maskPattern,row,col-c);if(mask){dark=!dark;}[m
[31m-	this.modules[row][col-c]=dark;bitIndex--;if(bitIndex==-1){byteIndex++;bitIndex=7;}}}[m
[31m-	row+=inc;if(row<0||this.moduleCount<=row){row-=inc;inc=-inc;break;}}}}};QRCodeModel.PAD0=0xEC;QRCodeModel.PAD1=0x11;QRCodeModel.createData=function(typeNumber,errorCorrectLevel,dataList){var rsBlocks=QRRSBlock.getRSBlocks(typeNumber,errorCorrectLevel);var buffer=new QRBitBuffer();for(var i=0;i<dataList.length;i++){var data=dataList[i];buffer.put(data.mode,4);buffer.put(data.getLength(),QRUtil.getLengthInBits(data.mode,typeNumber));data.write(buffer);}[m
[31m-	var totalDataCount=0;for(var i=0;i<rsBlocks.length;i++){totalDataCount+=rsBlocks[i].dataCount;}[m
[31m-	if(buffer.getLengthInBits()>totalDataCount*8){throw new Error("code length overflow. ("[m
[31m-	+buffer.getLengthInBits()[m
[31m-	+">"[m
[31m-	+totalDataCount*8[m
[31m-	+")");}[m
[31m-	if(buffer.getLengthInBits()+4<=totalDataCount*8){buffer.put(0,4);}[m
[31m-	while(buffer.getLengthInBits()%8!=0){buffer.putBit(false);}[m
[31m-	while(true){if(buffer.getLengthInBits()>=totalDataCount*8){break;}[m
[31m-	buffer.put(QRCodeModel.PAD0,8);if(buffer.getLengthInBits()>=totalDataCount*8){break;}[m
[31m-	buffer.put(QRCodeModel.PAD1,8);}[m
[31m-	return QRCodeModel.createBytes(buffer,rsBlocks);};QRCodeModel.createBytes=function(buffer,rsBlocks){var offset=0;var maxDcCount=0;var maxEcCount=0;var dcdata=new Array(rsBlocks.length);var ecdata=new Array(rsBlocks.length);for(var r=0;r<rsBlocks.length;r++){var dcCount=rsBlocks[r].dataCount;var ecCount=rsBlocks[r].totalCount-dcCount;maxDcCount=Math.max(maxDcCount,dcCount);maxEcCount=Math.max(maxEcCount,ecCount);dcdata[r]=new Array(dcCount);for(var i=0;i<dcdata[r].length;i++){dcdata[r][i]=0xff&buffer.buffer[i+offset];}[m
[31m-	offset+=dcCount;var rsPoly=QRUtil.getErrorCorrectPolynomial(ecCount);var rawPoly=new QRPolynomial(dcdata[r],rsPoly.getLength()-1);var modPoly=rawPoly.mod(rsPoly);ecdata[r]=new Array(rsPoly.getLength()-1);for(var i=0;i<ecdata[r].length;i++){var modIndex=i+modPoly.getLength()-ecdata[r].length;ecdata[r][i]=(modIndex>=0)?modPoly.get(modIndex):0;}}[m
[31m-	var totalCodeCount=0;for(var i=0;i<rsBlocks.length;i++){totalCodeCount+=rsBlocks[i].totalCount;}[m
[31m-	var data=new Array(totalCodeCount);var index=0;for(var i=0;i<maxDcCount;i++){for(var r=0;r<rsBlocks.length;r++){if(i<dcdata[r].length){data[index++]=dcdata[r][i];}}}[m
[31m-	for(var i=0;i<maxEcCount;i++){for(var r=0;r<rsBlocks.length;r++){if(i<ecdata[r].length){data[index++]=ecdata[r][i];}}}[m
[31m-	return data;};var QRMode={MODE_NUMBER:1<<0,MODE_ALPHA_NUM:1<<1,MODE_8BIT_BYTE:1<<2,MODE_KANJI:1<<3};var QRErrorCorrectLevel={L:1,M:0,Q:3,H:2};var QRMaskPattern={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var QRUtil={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:(1<<10)|(1<<8)|(1<<5)|(1<<4)|(1<<2)|(1<<1)|(1<<0),G18:(1<<12)|(1<<11)|(1<<10)|(1<<9)|(1<<8)|(1<<5)|(1<<2)|(1<<0),G15_MASK:(1<<14)|(1<<12)|(1<<10)|(1<<4)|(1<<1),getBCHTypeInfo:function(data){var d=data<<10;while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G15)>=0){d^=(QRUtil.G15<<(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G15)));}[m
[31m-	return((data<<10)|d)^QRUtil.G15_MASK;},getBCHTypeNumber:function(data){var d=data<<12;while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G18)>=0){d^=(QRUtil.G18<<(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G18)));}[m
[31m-	return(data<<12)|d;},getBCHDigit:function(data){var digit=0;while(data!=0){digit++;data>>>=1;}[m
[31m-	return digit;},getPatternPosition:function(typeNumber){return QRUtil.PATTERN_POSITION_TABLE[typeNumber-1];},getMask:function(maskPattern,i,j){switch(maskPattern){case QRMaskPattern.PATTERN000:return(i+j)%2==0;case QRMaskPattern.PATTERN001:return i%2==0;case QRMaskPattern.PATTERN010:return j%3==0;case QRMaskPattern.PATTERN011:return(i+j)%3==0;case QRMaskPattern.PATTERN100:return(Math.floor(i/2)+Math.floor(j/3))%2==0;case QRMaskPattern.PATTERN101:return(i*j)%2+(i*j)%3==0;case QRMaskPattern.PATTERN110:return((i*j)%2+(i*j)%3)%2==0;case QRMaskPattern.PATTERN111:return((i*j)%3+(i+j)%2)%2==0;default:throw new Error("bad maskPattern:"+maskPattern);}},getErrorCorrectPolynomial:function(errorCorrectLength){var a=new QRPolynomial([1],0);for(var i=0;i<errorCorrectLength;i++){a=a.multiply(new QRPolynomial([1,QRMath.gexp(i)],0));}[m
[31m-	return a;},getLengthInBits:function(mode,type){if(1<=type&&type<10){switch(mode){case QRMode.MODE_NUMBER:return 10;case QRMode.MODE_ALPHA_NUM:return 9;case QRMode.MODE_8BIT_BYTE:return 8;case QRMode.MODE_KANJI:return 8;default:throw new Error("mode:"+mode);}}else if(type<27){switch(mode){case QRMode.MODE_NUMBER:return 12;case QRMode.MODE_ALPHA_NUM:return 11;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 10;default:throw new Error("mode:"+mode);}}else if(type<41){switch(mode){case QRMode.MODE_NUMBER:return 14;case QRMode.MODE_ALPHA_NUM:return 13;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 12;default:throw new Error("mode:"+mode);}}else{throw new Error("type:"+type);}},getLostPoint:function(qrCode){var moduleCount=qrCode.getModuleCount();var lostPoint=0;for(var row=0;row<moduleCount;row++){for(var col=0;col<moduleCount;col++){var sameCount=0;var dark=qrCode.isDark(row,col);for(var r=-1;r<=1;r++){if(row+r<0||moduleCount<=row+r){continue;}[m
[31m-	for(var c=-1;c<=1;c++){if(col+c<0||moduleCount<=col+c){continue;}[m
[31m-	if(r==0&&c==0){continue;}[m
[31m-	if(dark==qrCode.isDark(row+r,col+c)){sameCount++;}}}[m
[31m-	if(sameCount>5){lostPoint+=(3+sameCount-5);}}}[m
[31m-	for(var row=0;row<moduleCount-1;row++){for(var col=0;col<moduleCount-1;col++){var count=0;if(qrCode.isDark(row,col))count++;if(qrCode.isDark(row+1,col))count++;if(qrCode.isDark(row,col+1))count++;if(qrCode.isDark(row+1,col+1))count++;if(count==0||count==4){lostPoint+=3;}}}[m
[31m-	for(var row=0;row<moduleCount;row++){for(var col=0;col<moduleCount-6;col++){if(qrCode.isDark(row,col)&&!qrCode.isDark(row,col+1)&&qrCode.isDark(row,col+2)&&qrCode.isDark(row,col+3)&&qrCode.isDark(row,col+4)&&!qrCode.isDark(row,col+5)&&qrCode.isDark(row,col+6)){lostPoint+=40;}}}[m
[31m-	for(var col=0;col<moduleCount;col++){for(var row=0;row<moduleCount-6;row++){if(qrCode.isDark(row,col)&&!qrCode.isDark(row+1,col)&&qrCode.isDark(row+2,col)&&qrCode.isDark(row+3,col)&&qrCode.isDark(row+4,col)&&!qrCode.isDark(row+5,col)&&qrCode.isDark(row+6,col)){lostPoint+=40;}}}[m
[31m-	var darkCount=0;for(var col=0;col<moduleCount;col++){for(var row=0;row<moduleCount;row++){if(qrCode.isDark(row,col)){darkCount++;}}}[m
[31m-	var ratio=Math.abs(100*darkCount/moduleCount/moduleCount-50)/5;lostPoint+=ratio*10;return lostPoint;}};var QRMath={glog:function(n){if(n<1){throw new Error("glog("+n+")");}[m
[31m-	return QRMath.LOG_TABLE[n];},gexp:function(n){while(n<0){n+=255;}[m
[31m-	while(n>=256){n-=255;}[m
[31m-	return QRMath.EXP_TABLE[n];},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var i=0;i<8;i++){QRMath.EXP_TABLE[i]=1<<i;}[m
[31m-	for(var i=8;i<256;i++){QRMath.EXP_TABLE[i]=QRMath.EXP_TABLE[i-4]^QRMath.EXP_TABLE[i-5]^QRMath.EXP_TABLE[i-6]^QRMath.EXP_TABLE[i-8];}[m
[31m-	for(var i=0;i<255;i++){QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]]=i;}[m
[31m-	function QRPolynomial(num,shift){if(num.length==undefined){throw new Error(num.length+"/"+shift);}[m
[31m-	var offset=0;while(offset<num.length&&num[offset]==0){offset++;}[m
[31m-	this.num=new Array(num.length-offset+shift);for(var i=0;i<num.length-offset;i++){this.num[i]=num[i+offset];}}[m
[31m-	QRPolynomial.prototype={get:function(index){return this.num[index];},getLength:function(){return this.num.length;},multiply:function(e){var num=new Array(this.getLength()+e.getLength()-1);for(var i=0;i<this.getLength();i++){for(var j=0;j<e.getLength();j++){num[i+j]^=QRMath.gexp(QRMath.glog(this.get(i))+QRMath.glog(e.get(j)));}}[m
[31m-	return new QRPolynomial(num,0);},mod:function(e){if(this.getLength()-e.getLength()<0){return this;}[m
[31m-	var ratio=QRMath.glog(this.get(0))-QRMath.glog(e.get(0));var num=new Array(this.getLength());for(var i=0;i<this.getLength();i++){num[i]=this.get(i);}[m
[31m-	for(var i=0;i<e.getLength();i++){num[i]^=QRMath.gexp(QRMath.glog(e.get(i))+ratio);}[m
[31m-	return new QRPolynomial(num,0).mod(e);}};function QRRSBlock(totalCount,dataCount){this.totalCount=totalCount;this.dataCount=dataCount;}[m
[31m-	QRRSBlock.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];QRRSBlock.getRSBlocks=function(typeNumber,errorCorrectLevel){var rsBlock=QRRSBlock.getRsBlockTable(typeNumber,errorCorrectLevel);if(rsBlock==undefined){throw new Error("bad rs block @ typeNumber:"+typeNumber+"/errorCorrectLevel:"+errorCorrectLevel);}[m
[31m-	var length=rsBlock.length/3;var list=[];for(var i=0;i<length;i++){var count=rsBlock[i*3+0];var totalCount=rsBlock[i*3+1];var dataCount=rsBlock[i*3+2];for(var j=0;j<count;j++){list.push(new QRRSBlock(totalCount,dataCount));}}[m
[31m-	return list;};QRRSBlock.getRsBlockTable=function(typeNumber,errorCorrectLevel){switch(errorCorrectLevel){case QRErrorCorrectLevel.L:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+0];case QRErrorCorrectLevel.M:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+1];case QRErrorCorrectLevel.Q:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+2];case QRErrorCorrectLevel.H:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+3];default:return undefined;}};function QRBitBuffer(){this.buffer=[];this.length=0;}[m
[31m-	QRBitBuffer.prototype={get:function(index){var bufIndex=Math.floor(index/8);return((this.buffer[bufIndex]>>>(7-index%8))&1)==1;},put:function(num,length){for(var i=0;i<length;i++){this.putBit(((num>>>(length-i-1))&1)==1);}},getLengthInBits:function(){return this.length;},putBit:function(bit){var bufIndex=Math.floor(this.length/8);if(this.buffer.length<=bufIndex){this.buffer.push(0);}[m
[31m-	if(bit){this.buffer[bufIndex]|=(0x80>>>(this.length%8));}[m
[31m-	this.length++;}};var QRCodeLimitLength=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];[m
[31m-	[m
[31m-	function _isSupportCanvas() {[m
[31m-		return typeof CanvasRenderingContext2D != "undefined";[m
[31m-	}[m
[31m-	[m
[31m-	// android 2.x doesn't support Data-URI spec[m
[31m-	function _getAndroid() {[m
[31m-		var android = false;[m
[31m-		var sAgent = navigator.userAgent;[m
[31m-		[m
[31m-		if (/android/i.test(sAgent)) { // android[m
[31m-			android = true;[m
[31m-			var aMat = sAgent.toString().match(/android ([0-9]\.[0-9])/i);[m
[31m-			[m
[31m-			if (aMat && aMat[1]) {[m
[31m-				android = parseFloat(aMat[1]);[m
[31m-			}[m
[31m-		}[m
[31m-		[m
[31m-		return android;[m
[31m-	}[m
[31m-	[m
[31m-	var svgDrawer = (function() {[m
[31m-[m
[31m-		var Drawing = function (el, htOption) {[m
[31m-			this._el = el;[m
[31m-			this._htOption = htOption;[m
[31m-		};[m
[31m-[m
[31m-		Drawing.prototype.draw = function (oQRCode) {[m
[31m-			var _htOption = this._htOption;[m
[31m-			var _el = this._el;[m
[31m-			var nCount = oQRCode.getModuleCount();[m
[31m-			var nWidth = Math.floor(_htOption.width / nCount);[m
[31m-			var nHeight = Math.floor(_htOption.height / nCount);[m
[31m-[m
[31m-			this.clear();[m
[31m-[m
[31m-			function makeSVG(tag, attrs) {[m
[31m-				var el = document.createElementNS('http://www.w3.org/2000/svg', tag);[m
[31m-				for (var k in attrs)[m
[31m-					if (attrs.hasOwnProperty(k)) el.setAttribute(k, attrs[k]);[m
[31m-				return el;[m
[31m-			}[m
[31m-[m
[31m-			var svg = makeSVG("svg" , {'viewBox': '0 0 ' + String(nCount) + " " + String(nCount), 'width': '100%', 'height': '100%', 'fill': _htOption.colorLight});[m
[31m-			svg.setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns:xlink", "http://www.w3.org/1999/xlink");[m
[31m-			_el.appendChild(svg);[m
[31m-[m
[31m-			svg.appendChild(makeSVG("rect", {"fill": _htOption.colorLight, "width": "100%", "height": "100%"}));[m
[31m-			svg.appendChild(makeSVG("rect", {"fill": _htOption.colorDark, "width": "1", "height": "1", "id": "template"}));[m
[31m-[m
[31m-			for (var row = 0; row < nCount; row++) {[m
[31m-				for (var col = 0; col < nCount; col++) {[m
[31m-					if (oQRCode.isDark(row, col)) {[m
[31m-						var child = makeSVG("use", {"x": String(col), "y": String(row)});[m
[31m-						child.setAttributeNS("http://www.w3.org/1999/xlink", "href", "#template");[m
[31m-						svg.appendChild(child);[m
[31m-					}[m
[31m-				}[m
[31m-			}[m
[31m-		};[m
[31m-		Drawing.prototype.clear = function () {[m
[31m-			while (this._el.hasChildNodes())[m
[31m-				this._el.removeChild(this._el.lastChild);[m
[31m-		};[m
[31m-		return Drawing;[m
[31m-	})();[m
[31m-[m
[31m-	var useSVG = document.documentElement.tagName.toLowerCase() === "svg";[m
[31m-[m
[31m-	// Drawing in DOM by using Table tag[m
[31m-	var Drawing = useSVG ? svgDrawer : !_isSupportCanvas() ? (function () {[m
[31m-		var Drawing = function (el, htOption) {[m
[31m-			this._el = el;[m
[31m-			this._htOption = htOption;[m
[31m-		};[m
[31m-			[m
[31m-		/**[m
[31m-		 * Draw the QRCode[m
[31m-		 * [m
[31m-		 * @param {QRCode} oQRCode[m
[31m-		 */[m
[31m-		Drawing.prototype.draw = function (oQRCode) {[m
[31m-            var _htOption = this._htOption;[m
[31m-            var _el = this._el;[m
[31m-			var nCount = oQRCode.getModuleCount();[m
[31m-			var nWidth = Math.floor(_htOption.width / nCount);[m
[31m-			var nHeight = Math.floor(_htOption.height / nCount);[m
[31m-			var aHTML = ['<table style="border:0;border-collapse:collapse;">'];[m
[31m-			[m
[31m-			for (var row = 0; row < nCount; row++) {[m
[31m-				aHTML.push('<tr>');[m
[31m-				[m
[31m-				for (var col = 0; col < nCount; col++) {[m
[31m-					aHTML.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:' + nWidth + 'px;height:' + nHeight + 'px;background-color:' + (oQRCode.isDark(row, col) ? _htOption.colorDark : _htOption.colorLight) + ';"></td>');[m
[31m-				}[m
[31m-				[m
[31m-				aHTML.push('</tr>');[m
[31m-			}[m
[31m-			[m
[31m-			aHTML.push('</table>');[m
[31m-			_el.innerHTML = aHTML.join('');[m
[31m-			[m
[31m-			// Fix the margin values as real size.[m
[31m-			var elTable = _el.childNodes[0];[m
[31m-			var nLeftMarginTable = (_htOption.width - elTable.offsetWidth) / 2;[m
[31m-			var nTopMarginTable = (_htOption.height - elTable.offsetHeight) / 2;[m
[31m-			[m
[31m-			if (nLeftMarginTable > 0 && nTopMarginTable > 0) {[m
[31m-				elTable.style.margin = nTopMarginTable + "px " + nLeftMarginTable + "px";	[m
[31m-			}[m
[31m-		};[m
[31m-		[m
[31m-		/**[m
[31m-		 * Clear the QRCode[m
[31m-		 */[m
[31m-		Drawing.prototype.clear = function () {[m
[31m-			this._el.innerHTML = '';[m
[31m-		};[m
[31m-		[m
[31m-		return Drawing;[m
[31m-	})() : (function () { // Drawing in Canvas[m
[31m-		function _onMakeImage() {[m
[31m-			this._elImage.src = this._elCanvas.toDataURL("image/png");[m
[31m-			this._elImage.style.display = "block";[m
[31m-			this._elCanvas.style.display = "none";			[m
[31m-		}[m
[31m-		[m
[31m-		// Android 2.1 bug workaround[m
[31m-		// http://code.google.com/p/android/issues/detail?id=5141[m
[31m-		if (this._android && this._android <= 2.1) {[m
[31m-	    	var factor = 1 / window.devicePixelRatio;[m
[31m-	        var drawImage = CanvasRenderingContext2D.prototype.drawImage; [m
[31m-	    	CanvasRenderingContext2D.prototype.drawImage = function (image, sx, sy, sw, sh, dx, dy, dw, dh) {[m
[31m-	    		if (("nodeName" in image) && /img/i.test(image.nodeName)) {[m
[31m-		        	for (var i = arguments.length - 1; i >= 1; i--) {[m
[31m-		            	arguments[i] = arguments[i] * factor;[m
[31m-		        	}[m
[31m-	    		} else if (typeof dw == "undefined") {[m
[31m-	    			arguments[1] *= factor;[m
[31m-	    			arguments[2] *= factor;[m
[31m-	    			arguments[3] *= factor;[m
[31m-	    			arguments[4] *= factor;[m
[31m-	    		}[m
[31m-	    		[m
[31m-	        	drawImage.apply(this, arguments); [m
[31m-	    	};[m
[31m-		}[m
[31m-		[m
[31m-		/**[m
[31m-		 * Check whether the user's browser supports Data URI or not[m
[31m-		 * [m
[31m-		 * @private[m
[31m-		 * @param {Function} fSuccess Occurs if it supports Data URI[m
[31m-		 * @param {Function} fFail Occurs if it doesn't support Data URI[m
[31m-		 */[m
[31m-		function _safeSetDataURI(fSuccess, fFail) {[m
[31m-            var self = this;[m
[31m-            self._fFail = fFail;[m
[31m-            self._fSuccess = fSuccess;[m
[31m-[m
[31m-            // Check it just once[m
[31m-            if (self._bSupportDataURI === null) {[m
[31m-                var el = document.createElement("img");[m
[31m-                var fOnError = function() {[m
[31m-                    self._bSupportDataURI = false;[m
[31m-[m
[31m-                    if (self._fFail) {[m
[31m-                        self._fFail.call(self);[m
[31m-                    }[m
[31m-                };[m
[31m-                var fOnSuccess = function() {[m
[31m-                    self._bSupportDataURI = true;[m
[31m-[m
[31m-                    if (self._fSuccess) {[m
[31m-                        self._fSuccess.call(self);[m
[31m-                    }[m
[31m-                };[m
[31m-[m
[31m-                el.onabort = fOnError;[m
[31m-                el.onerror = fOnError;[m
[31m-                el.onload = fOnSuccess;[m
[31m-                el.src = "data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg=="; // the Image contains 1px data.[m
[31m-                return;[m
[31m-            } else if (self._bSupportDataURI === true && self._fSuccess) {[m
[31m-                self._fSuccess.call(self);[m
[31m-            } else if (self._bSupportDataURI === false && self._fFail) {[m
[31m-                self._fFail.call(self);[m
[31m-            }[m
[31m-		};[m
[31m-		[m
[31m-		/**[m
[31m-		 * Drawing QRCode by using canvas[m
[31m-		 * [m
[31m-		 * @constructor[m
[31m-		 * @param {HTMLElement} el[m
[31m-		 * @param {Object} htOption QRCode Options [m
[31m-		 */[m
[31m-		var Drawing = function (el, htOption) {[m
[31m-    		this._bIsPainted = false;[m
[31m-    		this._android = _getAndroid();[m
[31m-		[m
[31m-			this._htOption = htOption;[m
[31m-			this._elCanvas = document.createElement("canvas");[m
[31m-			this._elCanvas.width = htOption.width;[m
[31m-			this._elCanvas.height = htOption.height;[m
[31m-			el.appendChild(this._elCanvas);[m
[31m-			this._el = el;[m
[31m-			this._oContext = this._elCanvas.getContext("2d");[m
[31m-			this._bIsPainted = false;[m
[31m-			this._elImage = document.createElement("img");[m
[31m-			this._elImage.alt = "Scan me!";[m
[31m-			this._elImage.style.display = "none";[m
[31m-			this._el.appendChild(this._elImage);[m
[31m-			this._bSupportDataURI = null;[m
[31m-		};[m
[31m-			[m
[31m-		/**[m
[31m-		 * Draw the QRCode[m
[31m-		 * [m
[31m-		 * @param {QRCode} oQRCode [m
[31m-		 */[m
[31m-		Drawing.prototype.draw = function (oQRCode) {[m
[31m-            var _elImage = this._elImage;[m
[31m-            var _oContext = this._oContext;[m
[31m-            var _htOption = this._htOption;[m
[31m-            [m
[31m-			var nCount = oQRCode.getModuleCount();[m
[31m-			var nWidth = _htOption.width / nCount;[m
[31m-			var nHeight = _htOption.height / nCount;[m
[31m-			var nRoundedWidth = Math.round(nWidth);[m
[31m-			var nRoundedHeight = Math.round(nHeight);[m
[31m-[m
[31m-			_elImage.style.display = "none";[m
[31m-			this.clear();[m
[31m-			[m
[31m-			for (var row = 0; row < nCount; row++) {[m
[31m-				for (var col = 0; col < nCount; col++) {[m
[31m-					var bIsDark = oQRCode.isDark(row, col);[m
[31m-					var nLeft = col * nWidth;[m
[31m-					var nTop = row * nHeight;[m
[31m-					_oContext.strokeStyle = bIsDark ? _htOption.colorDark : _htOption.colorLight;[m
[31m-					_oContext.lineWidth = 1;[m
[31m-					_oContext.fillStyle = bIsDark ? _htOption.colorDark : _htOption.colorLight;					[m
[31m-					_oContext.fillRect(nLeft, nTop, nWidth, nHeight);[m
[31m-					[m
[31m-					// 안티 앨리어싱 방지 처리[m
[31m-					_oContext.strokeRect([m
[31m-						Math.floor(nLeft) + 0.5,[m
[31m-						Math.floor(nTop) + 0.5,[m
[31m-						nRoundedWidth,[m
[31m-						nRoundedHeight[m
[31m-					);[m
[31m-					[m
[31m-					_oContext.strokeRect([m
[31m-						Math.ceil(nLeft) - 0.5,[m
[31m-						Math.ceil(nTop) - 0.5,[m
[31m-						nRoundedWidth,[m
[31m-						nRoundedHeight[m
[31m-					);[m
[31m-				}[m
[31m-			}[m
[31m-			[m
[31m-			this._bIsPainted = true;[m
[31m-		};[m
[31m-			[m
[31m-		/**[m
[31m-		 * Make the image from Canvas if the browser supports Data URI.[m
[31m-		 */[m
[31m-		Drawing.prototype.makeImage = function () {[m
[31m-			if (this._bIsPainted) {[m
[31m-				_safeSetDataURI.call(this, _onMakeImage);[m
[31m-			}[m
[31m-		};[m
[31m-			[m
[31m-		/**[m
[31m-		 * Return whether the QRCode is painted or not[m
[31m-		 * [m
[31m-		 * @return {Boolean}[m
[31m-		 */[m
[31m-		Drawing.prototype.isPainted = function () {[m
[31m-			return this._bIsPainted;[m
[31m-		};[m
[31m-		[m
[31m-		/**[m
[31m-		 * Clear the QRCode[m
[31m-		 */[m
[31m-		Drawing.prototype.clear = function () {[m
[31m-			this._oContext.clearRect(0, 0, this._elCanvas.width, this._elCanvas.height);[m
[31m-			this._bIsPainted = false;[m
[31m-		};[m
[31m-		[m
[31m-		/**[m
[31m-		 * @private[m
[31m-		 * @param {Number} nNumber[m
[31m-		 */[m
[31m-		Drawing.prototype.round = function (nNumber) {[m
[31m-			if (!nNumber) {[m
[31m-				return nNumber;[m
[31m-			}[m
[31m-			[m
[31m-			return Math.floor(nNumber * 1000) / 1000;[m
[31m-		};[m
[31m-		[m
[31m-		return Drawing;[m
[31m-	})();[m
[31m-	[m
[31m-	/**[m
[31m-	 * Get the type by string length[m
[31m-	 * [m
[31m-	 * @private[m
[31m-	 * @param {String} sText[m
[31m-	 * @param {Number} nCorrectLevel[m
[31m-	 * @return {Number} type[m
[31m-	 */[m
[31m-	function _getTypeNumber(sText, nCorrectLevel) {			[m
[31m-		var nType = 1;[m
[31m-		var length = _getUTF8Length(sText);[m
[31m-		[m
[31m-		for (var i = 0, len = QRCodeLimitLength.length; i <= len; i++) {[m
[31m-			var nLimit = 0;[m
[31m-			[m
[31m-			switch (nCorrectLevel) {[m
[31m-				case QRErrorCorrectLevel.L :[m
[31m-					nLimit = QRCodeLimitLength[i][0];[m
[31m-					break;[m
[31m-				case QRErrorCorrectLevel.M :[m
[31m-					nLimit = QRCodeLimitLength[i][1];[m
[31m-					break;[m
[31m-				case QRErrorCorrectLevel.Q :[m
[31m-					nLimit = QRCodeLimitLength[i][2];[m
[31m-					break;[m
[31m-				case QRErrorCorrectLevel.H :[m
[31m-					nLimit = QRCodeLimitLength[i][3];[m
[31m-					break;[m
[31m-			}[m
[31m-			[m
[31m-			if (length <= nLimit) {[m
[31m-				break;[m
[31m-			} else {[m
[31m-				nType++;[m
[31m-			}[m
[31m-		}[m
[31m-		[m
[31m-		if (nType > QRCodeLimitLength.length) {[m
[31m-			throw new Error("Too long data");[m
[31m-		}[m
[31m-		[m
[31m-		return nType;[m
[31m-	}[m
[31m-[m
[31m-	function _getUTF8Length(sText) {[m
[31m-		var replacedText = encodeURI(sText).toString().replace(/\%[0-9a-fA-F]{2}/g, 'a');[m
[31m-		return replacedText.length + (replacedText.length != sText ? 3 : 0);[m
[31m-	}[m
[31m-	[m
[31m-	/**[m
[31m-	 * @class QRCode[m
[31m-	 * @constructor[m
[31m-	 * @example [m
[31m-	 * new QRCode(document.getElementById("test"), "http://jindo.dev.naver.com/collie");[m
[31m-	 *[m
[31m-	 * @example[m
[31m-	 * var oQRCode = new QRCode("test", {[m
[31m-	 *    text : "http://naver.com",[m
[31m-	 *    width : 128,[m
[31m-	 *    height : 128[m
[31m-	 * });[m
[31m-	 * [m
[31m-	 * oQRCode.clear(); // Clear the QRCode.[m
[31m-	 * oQRCode.makeCode("http://map.naver.com"); // Re-create the QRCode.[m
[31m-	 *[m
[31m-	 * @param {HTMLElement|String} el target element or 'id' attribute of element.[m
[31m-	 * @param {Object|String} vOption[m
[31m-	 * @param {String} vOption.text QRCode link data[m
[31m-	 * @param {Number} [vOption.width=256][m
[31m-	 * @param {Number} [vOption.height=256][m
[31m-	 * @param {String} [vOption.colorDark="#000000"][m
[31m-	 * @param {String} [vOption.colorLight="#ffffff"][m
[31m-	 * @param {QRCode.CorrectLevel} [vOption.correctLevel=QRCode.CorrectLevel.H] [L|M|Q|H] [m
[31m-	 */[m
[31m-	QRCode = function (el, vOption) {[m
[31m-		this._htOption = {[m
[31m-			width : 256, [m
[31m-			height : 256,[m
[31m-			typeNumber : 4,[m
[31m-			colorDark : "#000000",[m
[31m-			colorLight : "#ffffff",[m
[31m-			correctLevel : QRErrorCorrectLevel.H[m
[31m-		};[m
[31m-		[m
[31m-		if (typeof vOption === 'string') {[m
[31m-			vOption	= {[m
[31m-				text : vOption[m
[31m-			};[m
[31m-		}[m
[31m-		[m
[31m-		// Overwrites options[m
[31m-		if (vOption) {[m
[31m-			for (var i in vOption) {[m
[31m-				this._htOption[i] = vOption[i];[m
[31m-			}[m
[31m-		}[m
[31m-		[m
[31m-		if (typeof el == "string") {[m
[31m-			el = document.getElementById(el);[m
[31m-		}[m
[31m-[m
[31m-		if (this._htOption.useSVG) {[m
[31m-			Drawing = svgDrawer;[m
[31m-		}[m
[31m-		[m
[31m-		this._android = _getAndroid();[m
[31m-		this._el = el;[m
[31m-		this._oQRCode = null;[m
[31m-		this._oDrawing = new Drawing(this._el, this._htOption);[m
[31m-		[m
[31m-		if (this._htOption.text) {[m
[31m-			this.makeCode(this._htOption.text);	[m
[31m-		}[m
[31m-	};[m
[31m-	[m
[31m-	/**[m
[31m-	 * Make the QRCode[m
[31m-	 * [m
[31m-	 * @param {String} sText link data[m
[31m-	 */[m
[31m-	QRCode.prototype.makeCode = function (sText) {[m
[31m-		this._oQRCode = new QRCodeModel(_getTypeNumber(sText, this._htOption.correctLevel), this._htOption.correctLevel);[m
[31m-		this._oQRCode.addData(sText);[m
[31m-		this._oQRCode.make();[m
[31m-		this._el.title = sText;[m
[31m-		this._oDrawing.draw(this._oQRCode);			[m
[31m-		this.makeImage();[m
[31m-	};[m
[31m-	[m
[31m-	/**[m
[31m-	 * Make the Image from Canvas element[m
[31m-	 * - It occurs automatically[m
[31m-	 * - Android below 3 doesn't support Data-URI spec.[m
[31m-	 * [m
[31m-	 * @private[m
[31m-	 */[m
[31m-	QRCode.prototype.makeImage = function () {[m
[31m-		if (typeof this._oDrawing.makeImage == "function" && (!this._android || this._android >= 3)) {[m
[31m-			this._oDrawing.makeImage();[m
[31m-		}[m
[31m-	};[m
[31m-	[m
[31m-	/**[m
[31m-	 * Clear the QRCode[m
[31m-	 */[m
[31m-	QRCode.prototype.clear = function () {[m
[31m-		this._oDrawing.clear();[m
[31m-	};[m
[31m-	[m
[31m-	/**[m
[31m-	 * @name QRCode.CorrectLevel[m
[31m-	 */[m
[31m-	QRCode.CorrectLevel = QRErrorCorrectLevel;[m
[31m-[m
[31m-	module.exports = {[m
[31m-		makeQRcode : function(el, vOption){[m
[31m-			var qrcode = new QRCode(el, vOption);[m
[31m-			return qrcode._oDrawing._elCanvas.toDataURL();[m
[31m-		}[m
[31m-	}[m
[31m-})();[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/ios/CDVBarcodeScanner.mm b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/ios/CDVBarcodeScanner.mm[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 0c5011b..91f183a[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/ios/CDVBarcodeScanner.mm[m
[1m+++ b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/ios/CDVBarcodeScanner.mm[m
[36m@@ -6,16 +6,8 @@[m
  * Copyright (c) 2011, IBM Corporation[m
  */[m
 [m
[31m-#import <Foundation/Foundation.h>[m
[31m-#import <UIKit/UIKit.h>[m
 #import <AVFoundation/AVFoundation.h>[m
 #import <AssetsLibrary/AssetsLibrary.h>[m
[31m-#import <AudioToolbox/AudioToolbox.h>[m
[31m-[m
[31m-//------------------------------------------------------------------------------[m
[31m-// use the all-in-one version of zxing that we built[m
[31m-//------------------------------------------------------------------------------[m
[31m-#import "zxing-all-in-one.h"[m
 #import <Cordova/CDVPlugin.h>[m
 [m
 [m
[36m@@ -55,7 +47,7 @@[m
 //------------------------------------------------------------------------------[m
 // class that does the grunt work[m
 //------------------------------------------------------------------------------[m
[31m-@interface CDVbcsProcessor : NSObject <AVCaptureVideoDataOutputSampleBufferDelegate> {}[m
[32m+[m[32m@interface CDVbcsProcessor : NSObject <AVCaptureMetadataOutputObjectsDelegate> {}[m
 @property (nonatomic, retain) CDVBarcodeScanner*           plugin;[m
 @property (nonatomic, retain) NSString*                   callback;[m
 @property (nonatomic, retain) UIViewController*           parentViewController;[m
[36m@@ -70,7 +62,10 @@[m
 @property (nonatomic)         BOOL                        capturing;[m
 @property (nonatomic)         BOOL                        isFrontCamera;[m
 @property (nonatomic)         BOOL                        isShowFlipCameraButton;[m
[32m+[m[32m@property (nonatomic)         BOOL                        isShowTorchButton;[m
 @property (nonatomic)         BOOL                        isFlipped;[m
[32m+[m[32m@property (nonatomic)         BOOL                        isTransitionAnimated;[m
[32m+[m[32m@property (nonatomic)         BOOL                        isSuccessBeepEnabled;[m
 [m
 [m
 - (id)initWithPlugin:(CDVBarcodeScanner*)plugin callback:(NSString*)callback parentViewController:(UIViewController*)parentViewController alterateOverlayXib:(NSString *)alternateXib;[m
[36m@@ -81,11 +76,6 @@[m
 - (void)openDialog;[m
 - (NSString*)setUpCaptureSession;[m
 - (void)captureOutput:(AVCaptureOutput*)captureOutput didOutputSampleBuffer:(CMSampleBufferRef)sampleBuffer fromConnection:(AVCaptureConnection*)connection;[m
[31m-- (NSString*)formatStringFrom:(zxing::BarcodeFormat)format;[m
[31m-- (UIImage*)getImageFromSample:(CMSampleBufferRef)sampleBuffer;[m
[31m-- (zxing::Ref<zxing::LuminanceSource>) getLuminanceSourceFromSample:(CMSampleBufferRef)sampleBuffer imageBytes:(uint8_t**)ptr;[m
[31m-- (UIImage*) getImageFromLuminanceSource:(zxing::LuminanceSource*)luminanceSource;[m
[31m-- (void)dumpImage:(UIImage*)image;[m
 @end[m
 [m
 //------------------------------------------------------------------------------[m
[36m@@ -109,6 +99,8 @@[m
 @property (nonatomic, retain) NSString*        alternateXib;[m
 @property (nonatomic)         BOOL             shutterPressed;[m
 @property (nonatomic, retain) IBOutlet UIView* overlayView;[m
[32m+[m[32m@property (nonatomic, retain) UIToolbar * toolbar;[m
[32m+[m[32m@property (nonatomic, retain) UIView * reticleView;[m
 // unsafe_unretained is equivalent to assign - used to prevent retain cycles in the property below[m
 @property (nonatomic, unsafe_unretained) id orientationDelegate;[m
 [m
[36m@@ -118,6 +110,8 @@[m
 - (UIImage*)buildReticleImage;[m
 - (void)shutterButtonPressed;[m
 - (IBAction)cancelButtonPressed:(id)sender;[m
[32m+[m[32m- (IBAction)flipCameraButtonPressed:(id)sender;[m
[32m+[m[32m- (IBAction)torchButtonPressed:(id)sender;[m
 [m
 @end[m
 [m
[36m@@ -138,6 +132,25 @@[m
     return result;[m
 }[m
 [m
[32m+[m[32m-(BOOL)notHasPermission[m
[32m+[m[32m{[m
[32m+[m[32m    AVAuthorizationStatus authStatus = [AVCaptureDevice authorizationStatusForMediaType:AVMediaTypeVideo];[m
[32m+[m[32m    return (authStatus == AVAuthorizationStatusDenied ||[m
[32m+[m[32m            authStatus == AVAuthorizationStatusRestricted);[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m-(BOOL)isUsageDescriptionSet[m
[32m+[m[32m{[m
[32m+[m[32m  NSDictionary * plist = [[NSBundle mainBundle] infoDictionary];[m
[32m+[m[32m  if ([plist objectForKey:@"NSCameraUsageDescription" ] ||[m
[32m+[m[32m      [[NSBundle mainBundle] localizedStringForKey: @"NSCameraUsageDescription" value: nil table: @"InfoPlist"]) {[m
[32m+[m[32m    return YES;[m
[32m+[m[32m  }[m
[32m+[m[32m  return NO;[m
[32m+[m[32m}[m
[32m+[m
[32m+[m
[32m+[m
 //--------------------------------------------------------------------------[m
 - (void)scan:(CDVInvokedUrlCommand*)command {[m
     CDVbcsProcessor* processor;[m
[36m@@ -146,28 +159,42 @@[m
 [m
     callback = command.callbackId;[m
 [m
[31m-    NSDictionary* options = command.arguments.count == 0 ? [NSNull null] : [command.arguments objectAtIndex:0];[m
[31m-[m
[31m-    if ([options isKindOfClass:[NSNull class]]) {[m
[32m+[m[32m    NSDictionary* options;[m
[32m+[m[32m    if (command.arguments.count == 0) {[m
       options = [NSDictionary dictionary];[m
[32m+[m[32m    } else {[m
[32m+[m[32m      options = command.arguments[0];[m
     }[m
[32m+[m
     BOOL preferFrontCamera = [options[@"preferFrontCamera"] boolValue];[m
     BOOL showFlipCameraButton = [options[@"showFlipCameraButton"] boolValue];[m
[32m+[m[32m    BOOL showTorchButton = [options[@"showTorchButton"] boolValue];[m
[32m+[m[32m    BOOL disableAnimations = [options[@"disableAnimations"] boolValue];[m
[32m+[m[32m    BOOL disableSuccessBeep = [options[@"disableSuccessBeep"] boolValue];[m
[32m+[m
     // We allow the user to define an alternate xib file for loading the overlay.[m
[31m-    NSString *overlayXib = [options objectForKey:@"overlayXib"];[m
[32m+[m[32m    NSString *overlayXib = options[@"overlayXib"];[m
 [m
     capabilityError = [self isScanNotPossible];[m
     if (capabilityError) {[m
         [self returnError:capabilityError callback:callback];[m
         return;[m
[32m+[m[32m    } else if ([self notHasPermission]) {[m
[32m+[m[32m        NSString * error = NSLocalizedString(@"Access to the camera has been prohibited; please enable it in the Settings app to continue.",nil);[m
[32m+[m[32m        [self returnError:error callback:callback];[m
[32m+[m[32m        return;[m
[32m+[m[32m    } else if (![self isUsageDescriptionSet]) {[m
[32m+[m[32m      NSString * error = NSLocalizedString(@"NSCameraUsageDescription is not set in the info.plist", nil);[m
[32m+[m[32m      [self returnError:error callback:callback];[m
[32m+[m[32m      return;[m
     }[m
 [m
     processor = [[CDVbcsProcessor alloc][m
[31m-                 initWithPlugin:self[m
[31m-                 callback:callback[m
[31m-                 parentViewController:self.viewController[m
[31m-                 alterateOverlayXib:overlayXib[m
[31m-                 ];[m
[32m+[m[32m                initWithPlugin:self[m
[32m+[m[32m                      callback:callback[m
[32m+[m[32m          parentViewController:self.viewController[m
[32m+[m[32m            alterateOverlayXib:overlayXib[m
[32m+[m[32m            ];[m
     // queue [processor scanBarcode] to run on the event loop[m
 [m
     if (preferFrontCamera) {[m
[36m@@ -178,6 +205,14 @@[m
       processor.isShowFlipCameraButton = true;[m
     }[m
 [m
[32m+[m[32m    if (showTorchButton) {[m
[32m+[m[32m      processor.isShowTorchButton = true;[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    processor.isSuccessBeepEnabled = !disableSuccessBeep;[m
[32m+[m
[32m+[m[32m    processor.isTransitionAnimated = !disableAnimations;[m
[32m+[m
     processor.formats = options[@"formats"];[m
 [m
     [processor performSelector:@selector(scanBarcode) withObject:nil afterDelay:0];[m
[36m@@ -197,18 +232,14 @@[m
                  callback:callback[m
                  stringToEncode: command.arguments[0][@"data"][m
                  ];[m
[31m-[m
[31m-    [processor retain];[m
[31m-    [processor retain];[m
[31m-    [processor retain];[m
     // queue [processor generateImage] to run on the event loop[m
     [processor performSelector:@selector(generateImage) withObject:nil afterDelay:0];[m
 }[m
 [m
 - (void)returnImage:(NSString*)filePath format:(NSString*)format callback:(NSString*)callback{[m
[31m-    NSMutableDictionary* resultDict = [[[NSMutableDictionary alloc] init] autorelease];[m
[31m-    [resultDict setObject:format forKey:@"format"];[m
[31m-    [resultDict setObject:filePath forKey:@"file"];[m
[32m+[m[32m    NSMutableDictionary* resultDict = [[NSMutableDictionary alloc] init];[m
[32m+[m[32m    resultDict[@"format"] = format;[m
[32m+[m[32m    resultDict[@"file"] = filePath;[m
 [m
     CDVPluginResult* result = [CDVPluginResult[m
                                resultWithStatus: CDVCommandStatus_OK[m
[36m@@ -220,12 +251,12 @@[m
 [m
 //--------------------------------------------------------------------------[m
 - (void)returnSuccess:(NSString*)scannedText format:(NSString*)format cancelled:(BOOL)cancelled flipped:(BOOL)flipped callback:(NSString*)callback{[m
[31m-    NSNumber* cancelledNumber = [NSNumber numberWithInt:(cancelled?1:0)];[m
[32m+[m[32m    NSNumber* cancelledNumber = @(cancelled ? 1 : 0);[m
 [m
[31m-    NSMutableDictionary* resultDict = [[NSMutableDictionary alloc] init];[m
[31m-    [resultDict setObject:scannedText     forKey:@"text"];[m
[31m-    [resultDict setObject:format          forKey:@"format"];[m
[31m-    [resultDict setObject:cancelledNumber forKey:@"cancelled"];[m
[32m+[m[32m    NSMutableDictionary* resultDict = [NSMutableDictionary new];[m
[32m+[m[32m    resultDict[@"text"] = scannedText;[m
[32m+[m[32m    resultDict[@"format"] = format;[m
[32m+[m[32m    resultDict[@"cancelled"] = cancelledNumber;[m
 [m
     CDVPluginResult* result = [CDVPluginResult[m
                                resultWithStatus: CDVCommandStatus_OK[m
[36m@@ -304,8 +335,6 @@[m [mparentViewController:(UIViewController*)parentViewController[m
 [m
     AudioServicesRemoveSystemSoundCompletion(_soundFileObject);[m
     AudioServicesDisposeSystemSoundID(_soundFileObject);[m
[31m-[m
[31m-    [super dealloc];[m
 }[m
 [m
 //--------------------------------------------------------------------------[m
[36m@@ -331,15 +360,23 @@[m [mparentViewController:(UIViewController*)parentViewController[m
 - (void)openDialog {[m
     [self.parentViewController[m
      presentViewController:self.viewController[m
[31m-     animated:YES completion:nil[m
[32m+[m[32m     animated:self.isTransitionAnimated completion:nil[m
      ];[m
 }[m
 [m
 //--------------------------------------------------------------------------[m
[31m-- (void)barcodeScanDone {[m
[32m+[m[32m- (void)barcodeScanDone:(void (^)(void))callbackBlock {[m
     self.capturing = NO;[m
     [self.captureSession stopRunning];[m
[31m-    [self.parentViewController dismissViewControllerAnimated: YES completion:nil];[m
[32m+[m[32m    [self.parentViewController dismissViewControllerAnimated:self.isTransitionAnimated completion:callbackBlock];[m
[32m+[m
[32m+[m
[32m+[m[32m    AVCaptureDevice *device = [AVCaptureDevice defaultDeviceWithMediaType:AVMediaTypeVideo];[m
[32m+[m[32m    [device lockForConfiguration:nil];[m
[32m+[m[32m    if([device isAutoFocusRangeRestrictionSupported]) {[m
[32m+[m[32m        [device setAutoFocusRangeRestriction:AVCaptureAutoFocusRangeRestrictionNone];[m
[32m+[m[32m    }[m
[32m+[m[32m    [device unlockForConfiguration];[m
 [m
     // viewcontroller holding onto a reference to us, release them so they[m
     // will release us[m
[36m@@ -362,7 +399,7 @@[m [mparentViewController:(UIViewController*)parentViewController[m
     }[m
 [m
     BOOL allEqual = YES;[m
[31m-    NSString *compareString = [self.results objectAtIndex:0];[m
[32m+[m[32m    NSString *compareString = self.results[0];[m
 [m
     for (NSString *aResult in self.results)[m
     {[m
[36m@@ -380,22 +417,29 @@[m [mparentViewController:(UIViewController*)parentViewController[m
 //--------------------------------------------------------------------------[m
 - (void)barcodeScanSucceeded:(NSString*)text format:(NSString*)format {[m
     dispatch_sync(dispatch_get_main_queue(), ^{[m
[31m-        [self barcodeScanDone];[m
[31m-        AudioServicesPlaySystemSound(_soundFileObject);[m
[31m-        [self.plugin returnSuccess:text format:format cancelled:FALSE flipped:FALSE callback:self.callback];[m
[32m+[m[32m        if (self.isSuccessBeepEnabled) {[m
[32m+[m[32m            AudioServicesPlaySystemSound(_soundFileObject);[m
[32m+[m[32m        }[m
[32m+[m[32m        [self barcodeScanDone:^{[m
[32m+[m[32m            [self.plugin returnSuccess:text format:format cancelled:FALSE flipped:FALSE callback:self.callback];[m
[32m+[m[32m        }];[m
     });[m
 }[m
 [m
 //--------------------------------------------------------------------------[m
 - (void)barcodeScanFailed:(NSString*)message {[m
[31m-    [self barcodeScanDone];[m
[31m-    [self.plugin returnError:message callback:self.callback];[m
[32m+[m[32m    dispatch_sync(dispatch_get_main_queue(), ^{[m
[32m+[m[32m        [self barcodeScanDone:^{[m
[32m+[m[32m            [self.plugin returnError:message callback:self.callback];[m
[32m+[m[32m        }];[m
[32m+[m[32m    });[m
 }[m
 [m
 //--------------------------------------------------------------------------[m
 - (void)barcodeScanCancelled {[m
[31m-    [self barcodeScanDone];[m
[31m-    [self.plugin returnSuccess:@"" format:@"" cancelled:TRUE flipped:self.isFlipped callback:self.callback];[m
[32m+[m[32m    [self barcodeScanDone:^{[m
[32m+[m[32m        [self.plugin returnSuccess:@"" format:@"" cancelled:TRUE flipped:self.isFlipped callback:self.callback];[m
[32m+[m[32m    }];[m
     if (self.isFlipped) {[m
         self.isFlipped = NO;[m
     }[m
[36m@@ -404,11 +448,25 @@[m [mparentViewController:(UIViewController*)parentViewController[m
 - (void)flipCamera {[m
     self.isFlipped = YES;[m
     self.isFrontCamera = !self.isFrontCamera;[m
[31m-    [self barcodeScanDone];[m
[31m-    if (self.isFlipped) {[m
[31m-      self.isFlipped = NO;[m
[31m-    }[m
[32m+[m[32m    [self barcodeScanDone:^{[m
[32m+[m[32m        if (self.isFlipped) {[m
[32m+[m[32m            self.isFlipped = NO;[m
[32m+[m[32m        }[m
     [self performSelector:@selector(scanBarcode) withObject:nil afterDelay:0.1];[m
[32m+[m[32m    }];[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m- (void)toggleTorch {[m
[32m+[m[32m  AVCaptureDevice *device = [AVCaptureDevice defaultDeviceWithMediaType:AVMediaTypeVideo];[m
[32m+[m[32m  [device lockForConfiguration:nil];[m
[32m+[m[32m  if (device.flashActive) {[m
[32m+[m[32m    [device setTorchMode:AVCaptureTorchModeOff];[m
[32m+[m[32m    [device setFlashMode:AVCaptureFlashModeOff];[m
[32m+[m[32m  } else {[m
[32m+[m[32m    [device setTorchModeOnWithLevel:AVCaptureMaxAvailableTorchLevel error:nil];[m
[32m+[m[32m    [device setFlashMode:AVCaptureFlashModeOn];[m
[32m+[m[32m  }[m
[32m+[m[32m  [device unlockForConfiguration];[m
 }[m
 [m
 //--------------------------------------------------------------------------[m
[36m@@ -433,22 +491,25 @@[m [mparentViewController:(UIViewController*)parentViewController[m
 [m
     }[m
 [m
[32m+[m[32m    // set focus params if available to improve focusing[m
[32m+[m[32m    [device lockForConfiguration:&error];[m
[32m+[m[32m    if (error == nil) {[m
[32m+[m[32m        if([device isFocusModeSupported:AVCaptureFocusModeContinuousAutoFocus]) {[m
[32m+[m[32m            [device setFocusMode:AVCaptureFocusModeContinuousAutoFocus];[m
[32m+[m[32m        }[m
[32m+[m[32m        if([device isAutoFocusRangeRestrictionSupported]) {[m
[32m+[m[32m            [device setAutoFocusRangeRestriction:AVCaptureAutoFocusRangeRestrictionNear];[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m    [device unlockForConfiguration];[m
 [m
     AVCaptureDeviceInput* input = [AVCaptureDeviceInput deviceInputWithDevice:device error:&error];[m
     if (!input) return @"unable to obtain video capture device input";[m
 [m
[31m-    AVCaptureVideoDataOutput* output = [[AVCaptureVideoDataOutput alloc] init];[m
[32m+[m[32m    AVCaptureMetadataOutput* output = [[AVCaptureMetadataOutput alloc] init];[m
     if (!output) return @"unable to obtain video capture output";[m
 [m
[31m-    NSDictionary* videoOutputSettings = [NSDictionary[m
[31m-                                         dictionaryWithObject:[NSNumber numberWithInt:kCVPixelFormatType_32BGRA][m
[31m-                                         forKey:(id)kCVPixelBufferPixelFormatTypeKey[m
[31m-                                         ];[m
[31m-[m
[31m-    output.alwaysDiscardsLateVideoFrames = YES;[m
[31m-    output.videoSettings = videoOutputSettings;[m
[31m-[m
[31m-    [output setSampleBufferDelegate:self queue:dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_LOW, 0)];[m
[32m+[m[32m    [output setMetadataObjectsDelegate:self queue:dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_LOW, 0)];[m
 [m
     if ([captureSession canSetSessionPreset:AVCaptureSessionPresetHigh]) {[m
       captureSession.sessionPreset = AVCaptureSessionPresetHigh;[m
[36m@@ -472,8 +533,11 @@[m [mparentViewController:(UIViewController*)parentViewController[m
         return @"unable to add video capture output to session";[m
     }[m
 [m
[32m+[m[32m    [output setMetadataObjectTypes:[self formatObjectTypes]];[m
[32m+[m
     // setup capture preview layer[m
     self.previewLayer = [AVCaptureVideoPreviewLayer layerWithSession:captureSession];[m
[32m+[m[32m    self.previewLayer.videoGravity = AVLayerVideoGravityResizeAspectFill;[m
 [m
     // run on next event loop pass [captureSession startRunning][m
     [captureSession performSelector:@selector(startRunning) withObject:nil afterDelay:0];[m
[36m@@ -484,7 +548,7 @@[m [mparentViewController:(UIViewController*)parentViewController[m
 //--------------------------------------------------------------------------[m
 // this method gets sent the captured frames[m
 //--------------------------------------------------------------------------[m
[31m-- (void)captureOutput:(AVCaptureOutput*)captureOutput didOutputSampleBuffer:(CMSampleBufferRef)sampleBuffer fromConnection:(AVCaptureConnection*)connection {[m
[32m+[m[32m- (void)captureOutput:(AVCaptureOutput*)captureOutput didOutputMetadataObjects:(NSArray *)metadataObjects fromConnection:(AVCaptureConnection*)connection {[m
 [m
     if (!self.capturing) return;[m
 [m
[36m@@ -505,79 +569,19 @@[m [mparentViewController:(UIViewController*)parentViewController[m
          [flashView removeFromSuperview];[m
      }[m
      ];[m
[31m-[m
[31m-    //         [self dumpImage: [[self getImageFromSample:sampleBuffer] autorelease]];[m
 #endif[m
 [m
 [m
[31m-    using namespace zxing;[m
[31m-[m
[31m-    // LuminanceSource is pretty dumb; we have to give it a pointer to[m
[31m-    // a byte array, but then can't get it back out again.  We need to[m
[31m-    // get it back to free it.  Saving it in imageBytes.[m
[31m-    uint8_t* imageBytes;[m
[31m-[m
[31m-    //        NSTimeInterval timeStart = [NSDate timeIntervalSinceReferenceDate];[m
[31m-[m
     try {[m
[31m-        NSArray *supportedFormats = nil;[m
[31m-        if (self.formats != nil) {[m
[31m-            supportedFormats = [self.formats componentsSeparatedByString:@","];[m
[31m-        }[m
[31m-        DecodeHints decodeHints;[m
[31m-        if (supportedFormats == nil || [supportedFormats containsObject:[self formatStringFrom:BarcodeFormat_QR_CODE]]) {[m
[31m-            decodeHints.addFormat(BarcodeFormat_QR_CODE);[m
[31m-        }[m
[31m-        if (supportedFormats == nil || [supportedFormats containsObject:[self formatStringFrom:BarcodeFormat_CODE_128]]) {[m
[31m-            decodeHints.addFormat(BarcodeFormat_CODE_128);[m
[31m-        }[m
[31m-        if (supportedFormats == nil || [supportedFormats containsObject:[self formatStringFrom:BarcodeFormat_CODE_39]]) {[m
[31m-            decodeHints.addFormat(BarcodeFormat_CODE_39);[m
[31m-        }[m
[31m-        if (supportedFormats == nil || [supportedFormats containsObject:[self formatStringFrom:BarcodeFormat_DATA_MATRIX]]) {[m
[31m-            decodeHints.addFormat(BarcodeFormat_DATA_MATRIX);[m
[31m-        }[m
[31m-        if (supportedFormats == nil || [supportedFormats containsObject:[self formatStringFrom:BarcodeFormat_UPC_E]]) {[m
[31m-            decodeHints.addFormat(BarcodeFormat_UPC_E);[m
[31m-        }[m
[31m-        if (supportedFormats == nil || [supportedFormats containsObject:[self formatStringFrom:BarcodeFormat_UPC_A]]) {[m
[31m-            decodeHints.addFormat(BarcodeFormat_UPC_A);[m
[31m-        }[m
[31m-        if (supportedFormats == nil || [supportedFormats containsObject:[self formatStringFrom:BarcodeFormat_EAN_8]]) {[m
[31m-            decodeHints.addFormat(BarcodeFormat_EAN_8);[m
[31m-        }[m
[31m-        if (supportedFormats == nil || [supportedFormats containsObject:[self formatStringFrom:BarcodeFormat_EAN_13]]) {[m
[31m-            decodeHints.addFormat(BarcodeFormat_EAN_13);[m
[31m-        }[m
[31m-//        decodeHints.addFormat(BarcodeFormat_ITF);   causing crashes[m
[31m-[m
[31m-        // here's the meat of the decode process[m
[31m-        Ref<LuminanceSource>   luminanceSource   ([self getLuminanceSourceFromSample: sampleBuffer imageBytes:&imageBytes]);[m
[31m-        //            [self dumpImage: [[self getImageFromLuminanceSource:luminanceSource] autorelease]];[m
[31m-        Ref<Binarizer>         binarizer         (new HybridBinarizer(luminanceSource));[m
[31m-        Ref<BinaryBitmap>      bitmap            (new BinaryBitmap(binarizer));[m
[31m-        Ref<MultiFormatReader> reader            (new MultiFormatReader());[m
[31m-        Ref<Result>            result            (reader->decode(bitmap, decodeHints));[m
[31m-        Ref<String>            resultText        (result->getText());[m
[31m-        BarcodeFormat          formatVal =       result->getBarcodeFormat();[m
[31m-        NSString*              format    =       [self formatStringFrom:formatVal];[m
[31m-[m
[31m-[m
[31m-        const char* cString      = resultText->getText().c_str();[m
[31m-        NSString*   resultString = [[NSString alloc] initWithCString:cString encoding:NSUTF8StringEncoding];[m
[32m+[m[32m        // This will bring in multiple entities if there are multiple 2D codes in frame.[m
[32m+[m[32m        for (AVMetadataObject *metaData in metadataObjects) {[m
[32m+[m[32m            AVMetadataMachineReadableCodeObject* code = (AVMetadataMachineReadableCodeObject*)[self.previewLayer transformedMetadataObjectForMetadataObject:(AVMetadataMachineReadableCodeObject*)metaData];[m
 [m
[31m-        if ([self checkResult:resultString]) {[m
[31m-            [self barcodeScanSucceeded:resultString format:format];[m
[32m+[m[32m            if ([self checkResult:code.stringValue]) {[m
[32m+[m[32m                [self barcodeScanSucceeded:code.stringValue format:[self formatStringFromMetadata:code]];[m
[32m+[m[32m            }[m
         }[m
     }[m
[31m-    catch (zxing::ReaderException &rex) {[m
[31m-        //            NSString *message = [[[NSString alloc] initWithCString:rex.what() encoding:NSUTF8StringEncoding] autorelease];[m
[31m-        //            NSLog(@"decoding: ReaderException: %@", message);[m
[31m-    }[m
[31m-    catch (zxing::IllegalArgumentException &iex) {[m
[31m-        //            NSString *message = [[[NSString alloc] initWithCString:iex.what() encoding:NSUTF8StringEncoding] autorelease];[m
[31m-        //            NSLog(@"decoding: IllegalArgumentException: %@", message);[m
[31m-    }[m
     catch (...) {[m
         //            NSLog(@"decoding: unknown exception");[m
         //            [self barcodeScanFailed:@"unknown exception decoding barcode"];[m
[36m@@ -586,164 +590,55 @@[m [mparentViewController:(UIViewController*)parentViewController[m
     //        NSTimeInterval timeElapsed  = [NSDate timeIntervalSinceReferenceDate] - timeStart;[m
     //        NSLog(@"decoding completed in %dms", (int) (timeElapsed * 1000));[m
 [m
[31m-    // free the buffer behind the LuminanceSource[m
[31m-    if (imageBytes) {[m
[31m-        free(imageBytes);[m
[31m-    }[m
 }[m
 [m
 //--------------------------------------------------------------------------[m
[31m-// convert barcode format to string[m
[32m+[m[32m// convert metadata object information to barcode format string[m
 //--------------------------------------------------------------------------[m
[31m-- (NSString*)formatStringFrom:(zxing::BarcodeFormat)format {[m
[31m-    if (format == zxing::BarcodeFormat_QR_CODE)      return @"QR_CODE";[m
[31m-    if (format == zxing::BarcodeFormat_DATA_MATRIX)  return @"DATA_MATRIX";[m
[31m-    if (format == zxing::BarcodeFormat_UPC_E)        return @"UPC_E";[m
[31m-    if (format == zxing::BarcodeFormat_UPC_A)        return @"UPC_A";[m
[31m-    if (format == zxing::BarcodeFormat_EAN_8)        return @"EAN_8";[m
[31m-    if (format == zxing::BarcodeFormat_EAN_13)       return @"EAN_13";[m
[31m-    if (format == zxing::BarcodeFormat_CODE_128)     return @"CODE_128";[m
[31m-    if (format == zxing::BarcodeFormat_CODE_39)      return @"CODE_39";[m
[31m-    if (format == zxing::BarcodeFormat_ITF)          return @"ITF";[m
[32m+[m[32m- (NSString*)formatStringFromMetadata:(AVMetadataMachineReadableCodeObject*)format {[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypeQRCode)          return @"QR_CODE";[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypeAztecCode)       return @"AZTEC";[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypeDataMatrixCode)  return @"DATA_MATRIX";[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypeUPCECode)        return @"UPC_E";[m
[32m+[m[32m    // According to Apple documentation, UPC_A is EAN13 with a leading 0.[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypeEAN13Code && [format.stringValue characterAtIndex:0] == '0') return @"UPC_A";[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypeEAN8Code)        return @"EAN_8";[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypeEAN13Code)       return @"EAN_13";[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypeCode128Code)     return @"CODE_128";[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypeCode93Code)      return @"CODE_93";[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypeCode39Code)      return @"CODE_39";[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypeInterleaved2of5Code) return @"ITF";[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypeITF14Code)          return @"ITF_14";[m
[32m+[m
[32m+[m[32m    if (format.type == AVMetadataObjectTypePDF417Code)      return @"PDF_417";[m
     return @"???";[m
 }[m
 [m
 //--------------------------------------------------------------------------[m
[31m-// convert capture's sample buffer (scanned picture) into the thing that[m
[31m-// zxing needs.[m
[32m+[m[32m// convert string formats to metadata objects[m
 //--------------------------------------------------------------------------[m
[31m-- (zxing::Ref<zxing::LuminanceSource>) getLuminanceSourceFromSample:(CMSampleBufferRef)sampleBuffer imageBytes:(uint8_t**)ptr {[m
[31m-    CVImageBufferRef imageBuffer = CMSampleBufferGetImageBuffer(sampleBuffer);[m
[31m-    CVPixelBufferLockBaseAddress(imageBuffer, 0);[m
[31m-[m
[31m-    size_t   bytesPerRow =            CVPixelBufferGetBytesPerRow(imageBuffer);[m
[31m-    size_t   width       =            CVPixelBufferGetWidth(imageBuffer);[m
[31m-    size_t   height      =            CVPixelBufferGetHeight(imageBuffer);[m
[31m-    uint8_t* baseAddress = (uint8_t*) CVPixelBufferGetBaseAddress(imageBuffer);[m
[31m-[m
[31m-    // only going to get 90% of the min(width,height) of the captured image[m
[31m-    size_t    greyWidth  = 9 * MIN(width, height) / 10;[m
[31m-    uint8_t*  greyData   = (uint8_t*) malloc(greyWidth * greyWidth);[m
[31m-[m
[31m-    // remember this pointer so we can free it later[m
[31m-    *ptr = greyData;[m
[31m-[m
[31m-    if (!greyData) {[m
[31m-        CVPixelBufferUnlockBaseAddress(imageBuffer,0);[m
[31m-        throw new zxing::ReaderException("out of memory");[m
[31m-    }[m
[31m-[m
[31m-    size_t offsetX = (width  - greyWidth) / 2;[m
[31m-    size_t offsetY = (height - greyWidth) / 2;[m
[31m-[m
[31m-    // pixel-by-pixel ...[m
[31m-    for (size_t i=0; i<greyWidth; i++) {[m
[31m-        for (size_t j=0; j<greyWidth; j++) {[m
[31m-            // i,j are the coordinates from the sample buffer[m
[31m-            // ni, nj are the coordinates in the LuminanceSource[m
[31m-            // in this case, there's a rotation taking place[m
[31m-            size_t ni = greyWidth-j;[m
[31m-            size_t nj = i;[m
[31m-[m
[31m-            size_t baseOffset = (j+offsetY)*bytesPerRow + (i + offsetX)*4;[m
[31m-[m
[31m-            // convert from color to grayscale[m
[31m-            // http://en.wikipedia.org/wiki/Grayscale#Converting_color_to_grayscale[m
[31m-            size_t value = 0.11 * baseAddress[baseOffset] +[m
[31m-            0.59 * baseAddress[baseOffset + 1] +[m
[31m-            0.30 * baseAddress[baseOffset + 2];[m
[31m-[m
[31m-            greyData[nj*greyWidth + ni] = value;[m
[31m-        }[m
[32m+[m[32m- (NSArray*) formatObjectTypes {[m
[32m+[m[32m    NSArray *supportedFormats = nil;[m
[32m+[m[32m    if (self.formats != nil) {[m
[32m+[m[32m        supportedFormats = [self.formats componentsSeparatedByString:@","];[m
     }[m
 [m
[31m-    CVPixelBufferUnlockBaseAddress(imageBuffer,0);[m
[31m-[m
[31m-    using namespace zxing;[m
[31m-[m
[31m-    Ref<LuminanceSource> luminanceSource ([m
[31m-                                          new GreyscaleLuminanceSource(greyData, (int)greyWidth, (int)greyWidth, 0, 0, (int)greyWidth, (int)greyWidth)[m
[31m-                                          );[m
[31m-[m
[31m-    return luminanceSource;[m
[31m-}[m
[31m-[m
[31m-//--------------------------------------------------------------------------[m
[31m-// for debugging[m
[31m-//--------------------------------------------------------------------------[m
[31m-- (UIImage*) getImageFromLuminanceSource:(zxing::LuminanceSource*)luminanceSource  {[m
[31m-    unsigned char* bytes = luminanceSource->getMatrix();[m
[31m-    CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceGray();[m
[31m-    CGContextRef context = CGBitmapContextCreate([m
[31m-                                                 bytes,[m
[31m-                                                 luminanceSource->getWidth(), luminanceSource->getHeight(), 8, luminanceSource->getWidth(),[m
[31m-                                                 colorSpace,[m
[31m-                                                 kCGImageAlphaNone[m
[31m-                                                 );[m
[31m-[m
[31m-    CGImageRef cgImage = CGBitmapContextCreateImage(context);[m
[31m-    UIImage*   image   = [[UIImage alloc] initWithCGImage:cgImage];[m
[31m-[m
[31m-    CGContextRelease(context);[m
[31m-    CGColorSpaceRelease(colorSpace);[m
[31m-    CGImageRelease(cgImage);[m
[31m-    free(bytes);[m
[31m-[m
[31m-    return image;[m
[31m-}[m
[31m-[m
[31m-//--------------------------------------------------------------------------[m
[31m-// for debugging[m
[31m-//--------------------------------------------------------------------------[m
[31m-- (UIImage*)getImageFromSample:(CMSampleBufferRef)sampleBuffer {[m
[31m-    CVImageBufferRef imageBuffer = CMSampleBufferGetImageBuffer(sampleBuffer);[m
[31m-    CVPixelBufferLockBaseAddress(imageBuffer, 0);[m
[31m-[m
[31m-    size_t bytesPerRow = CVPixelBufferGetBytesPerRow(imageBuffer);[m
[31m-    size_t width       = CVPixelBufferGetWidth(imageBuffer);[m
[31m-    size_t height      = CVPixelBufferGetHeight(imageBuffer);[m
[31m-[m
[31m-    uint8_t* baseAddress    = (uint8_t*) CVPixelBufferGetBaseAddress(imageBuffer);[m
[31m-    int      length         = (int)(height * bytesPerRow);[m
[31m-    uint8_t* newBaseAddress = (uint8_t*) malloc(length);[m
[31m-    memcpy(newBaseAddress, baseAddress, length);[m
[31m-    baseAddress = newBaseAddress;[m
[31m-[m
[31m-    CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();[m
[31m-    CGContextRef context = CGBitmapContextCreate([m
[31m-                                                 baseAddress,[m
[31m-                                                 width, height, 8, bytesPerRow,[m
[31m-                                                 colorSpace,[m
[31m-                                                 kCGBitmapByteOrder32Little | kCGImageAlphaNoneSkipFirst[m
[31m-                                                 );[m
[31m-[m
[31m-    CGImageRef cgImage = CGBitmapContextCreateImage(context);[m
[31m-    UIImage*   image   = [[UIImage alloc] initWithCGImage:cgImage];[m
[31m-[m
[31m-    CVPixelBufferUnlockBaseAddress(imageBuffer,0);[m
[31m-    CGContextRelease(context);[m
[31m-    CGColorSpaceRelease(colorSpace);[m
[31m-    CGImageRelease(cgImage);[m
[31m-[m
[31m-    free(baseAddress);[m
[31m-[m
[31m-    return image;[m
[31m-}[m
[31m-[m
[31m-//--------------------------------------------------------------------------[m
[31m-// for debugging[m
[31m-//--------------------------------------------------------------------------[m
[31m-- (void)dumpImage:(UIImage*)image {[m
[31m-    NSLog(@"writing image to library: %dx%d", (int)image.size.width, (int)image.size.height);[m
[31m-    ALAssetsLibrary* assetsLibrary = [[ALAssetsLibrary alloc] init];[m
[31m-    [assetsLibrary[m
[31m-     writeImageToSavedPhotosAlbum:image.CGImage[m
[31m-     orientation:ALAssetOrientationUp[m
[31m-     completionBlock:^(NSURL* assetURL, NSError* error){[m
[31m-         if (error) NSLog(@"   error writing image to library");[m
[31m-         else       NSLog(@"   wrote image to library %@", assetURL);[m
[31m-     }[m
[31m-     ];[m
[32m+[m[32m    NSMutableArray * formatObjectTypes = [NSMutableArray array];[m
[32m+[m
[32m+[m[32m    if (self.formats == nil || [supportedFormats containsObject:@"QR_CODE"]) [formatObjectTypes addObject:AVMetadataObjectTypeQRCode];[m
[32m+[m[32m    if (self.formats == nil || [supportedFormats containsObject:@"AZTEC"]) [formatObjectTypes addObject:AVMetadataObjectTypeAztecCode];[m
[32m+[m[32m    if (self.formats == nil || [supportedFormats containsObject:@"DATA_MATRIX"]) [formatObjectTypes addObject:AVMetadataObjectTypeDataMatrixCode];[m
[32m+[m[32m    if (self.formats == nil || [supportedFormats containsObject:@"UPC_E"]) [formatObjectTypes addObject:AVMetadataObjectTypeUPCECode];[m
[32m+[m[32m    if (self.formats == nil || [supportedFormats containsObject:@"EAN_8"]) [formatObjectTypes addObject:AVMetadataObjectTypeEAN8Code];[m
[32m+[m[32m    if (self.formats == nil || [supportedFormats containsObject:@"EAN_13"]) [formatObjectTypes addObject:AVMetadataObjectTypeEAN13Code];[m
[32m+[m[32m    if (self.formats == nil || [supportedFormats containsObject:@"CODE_128"]) [formatObjectTypes addObject:AVMetadataObjectTypeCode128Code];[m
[32m+[m[32m    if (self.formats == nil || [supportedFormats containsObject:@"CODE_93"]) [formatObjectTypes addObject:AVMetadataObjectTypeCode93Code];[m
[32m+[m[32m    if (self.formats == nil || [supportedFormats containsObject:@"CODE_39"]) [formatObjectTypes addObject:AVMetadataObjectTypeCode39Code];[m
[32m+[m[32m    if (self.formats == nil || [supportedFormats containsObject:@"ITF"]) [formatObjectTypes addObject:AVMetadataObjectTypeInterleaved2of5Code];[m
[32m+[m[32m    if (self.formats == nil || [supportedFormats containsObject:@"ITF_14"]) [formatObjectTypes addObject:AVMetadataObjectTypeITF14Code];[m
[32m+[m[32m    if (self.formats == nil || [supportedFormats containsObject:@"PDF_417"]) [formatObjectTypes addObject:AVMetadataObjectTypePDF417Code];[m
[32m+[m
[32m+[m[32m    return formatObjectTypes;[m
 }[m
 [m
 @end[m
[36m@@ -774,8 +669,6 @@[m [mparentViewController:(UIViewController*)parentViewController[m
     self.plugin = nil;[m
     self.callback = nil;[m
     self.stringToEncode = nil;[m
[31m-[m
[31m-    [super dealloc];[m
 }[m
 //--------------------------------------------------------------------------[m
 - (void)generateImage{[m
[36m@@ -818,7 +711,8 @@[m [mparentViewController:(UIViewController*)parentViewController[m
     CGImageRelease(cgImage);[m
 [m
     /* save image to file */[m
[31m-    NSString* filePath = [NSTemporaryDirectory() stringByAppendingPathComponent:@"tmpqrcode.jpeg"];[m
[32m+[m[32m    NSString* fileName = [[[NSProcessInfo processInfo] globallyUniqueString] stringByAppendingString:@".jpg"];[m
[32m+[m[32m    NSString* filePath = [NSTemporaryDirectory() stringByAppendingPathComponent:fileName];[m
     [UIImageJPEGRepresentation(qrImage, 1.0) writeToFile:filePath atomically:YES];[m
 [m
     /* return file path back to cordova */[m
[36m@@ -854,32 +748,18 @@[m [mparentViewController:(UIViewController*)parentViewController[m
     self.shutterPressed = NO;[m
     self.alternateXib = nil;[m
     self.overlayView = nil;[m
[31m-    [super dealloc];[m
 }[m
 [m
 //--------------------------------------------------------------------------[m
 - (void)loadView {[m
     self.view = [[UIView alloc] initWithFrame: self.processor.parentViewController.view.frame];[m
[31m-[m
[31m-    // setup capture preview layer[m
[31m-    AVCaptureVideoPreviewLayer* previewLayer = self.processor.previewLayer;[m
[31m-    previewLayer.frame = self.view.bounds;[m
[31m-    previewLayer.videoGravity = AVLayerVideoGravityResizeAspectFill;[m
[31m-[m
[31m-    if ([previewLayer.connection isVideoOrientationSupported]) {[m
[31m-        [previewLayer.connection setVideoOrientation:AVCaptureVideoOrientationPortrait];[m
[31m-    }[m
[31m-[m
[31m-    [self.view.layer insertSublayer:previewLayer below:[[self.view.layer sublayers] objectAtIndex:0]];[m
[31m-[m
[31m-    [self.view addSubview:[self buildOverlayView]];[m
 }[m
 [m
 //--------------------------------------------------------------------------[m
 - (void)viewWillAppear:(BOOL)animated {[m
 [m
     // set video orientation to what the camera sees[m
[31m-    self.processor.previewLayer.connection.videoOrientation = [[UIApplication sharedApplication] statusBarOrientation];[m
[32m+[m[32m    self.processor.previewLayer.connection.videoOrientation = [self interfaceOrientationToVideoOrientation:[UIApplication sharedApplication].statusBarOrientation];[m
 [m
     // this fixes the bug when the statusbar is landscape, and the preview layer[m
     // starts up in portrait (not filling the whole view)[m
[36m@@ -888,18 +768,45 @@[m [mparentViewController:(UIViewController*)parentViewController[m
 [m
 //--------------------------------------------------------------------------[m
 - (void)viewDidAppear:(BOOL)animated {[m
[32m+[m[32m    // setup capture preview layer[m
[32m+[m[32m    AVCaptureVideoPreviewLayer* previewLayer = self.processor.previewLayer;[m
[32m+[m[32m    previewLayer.frame = self.view.bounds;[m
[32m+[m[32m    previewLayer.videoGravity = AVLayerVideoGravityResizeAspectFill;[m
[32m+[m
[32m+[m[32m    if ([previewLayer.connection isVideoOrientationSupported]) {[m
[32m+[m[32m        previewLayer.connection.videoOrientation = [self interfaceOrientationToVideoOrientation:[UIApplication sharedApplication].statusBarOrientation];[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    [self.view.layer insertSublayer:previewLayer below:[[self.view.layer sublayers] objectAtIndex:0]];[m
[32m+[m
[32m+[m[32m    [self.view addSubview:[self buildOverlayView]];[m
     [self startCapturing];[m
 [m
     [super viewDidAppear:animated];[m
 }[m
 [m
[32m+[m[32m- (AVCaptureVideoOrientation)interfaceOrientationToVideoOrientation:(UIInterfaceOrientation)orientation {[m
[32m+[m[32m    switch (orientation) {[m
[32m+[m[32m        case UIInterfaceOrientationPortrait:[m
[32m+[m[32m            return AVCaptureVideoOrientationPortrait;[m
[32m+[m[32m        case UIInterfaceOrientationPortraitUpsideDown:[m
[32m+[m[32m            return AVCaptureVideoOrientationPortraitUpsideDown;[m
[32m+[m[32m        case UIInterfaceOrientationLandscapeLeft:[m
[32m+[m[32m            return AVCaptureVideoOrientationLandscapeLeft;[m
[32m+[m[32m        case UIInterfaceOrientationLandscapeRight:[m
[32m+[m[32m            return AVCaptureVideoOrientationLandscapeRight;[m
[32m+[m[32m        default:[m
[32m+[m[32m            return AVCaptureVideoOrientationPortrait;[m
[32m+[m[32m   }[m
[32m+[m[32m}[m
[32m+[m
 //--------------------------------------------------------------------------[m
 - (void)startCapturing {[m
     self.processor.capturing = YES;[m
 }[m
 [m
 //--------------------------------------------------------------------------[m
[31m-- (void)shutterButtonPressed {[m
[32m+[m[32m- (IBAction)shutterButtonPressed {[m
     self.shutterPressed = YES;[m
 }[m
 [m
[36m@@ -908,11 +815,16 @@[m [mparentViewController:(UIViewController*)parentViewController[m
     [self.processor performSelector:@selector(barcodeScanCancelled) withObject:nil afterDelay:0];[m
 }[m
 [m
[31m-- (void)flipCameraButtonPressed:(id)sender[m
[32m+[m[32m- (IBAction)flipCameraButtonPressed:(id)sender[m
 {[m
     [self.processor performSelector:@selector(flipCamera) withObject:nil afterDelay:0];[m
 }[m
 [m
[32m+[m[32m- (IBAction)torchButtonPressed:(id)sender[m
[32m+[m[32m{[m
[32m+[m[32m  [self.processor performSelector:@selector(toggleTorch) withObject:nil afterDelay:0];[m
[32m+[m[32m}[m
[32m+[m
 //--------------------------------------------------------------------------[m
 - (UIView *)buildOverlayViewFromXib[m
 {[m
[36m@@ -924,6 +836,15 @@[m [mparentViewController:(UIViewController*)parentViewController[m
         return nil;[m
     }[m
 [m
[32m+[m	[32mself.overlayView.autoresizesSubviews = YES;[m
[32m+[m[32m    self.overlayView.autoresizingMask    = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;[m
[32m+[m[32m    self.overlayView.opaque              = NO;[m
[32m+[m
[32m+[m	[32mCGRect bounds = self.view.bounds;[m
[32m+[m[32m    bounds = CGRectMake(0, 0, bounds.size.width, bounds.size.height);[m
[32m+[m
[32m+[m	[32m[self.overlayView setFrame:bounds];[m
[32m+[m
     return self.overlayView;[m
 }[m
 [m
[36m@@ -934,7 +855,7 @@[m [mparentViewController:(UIViewController*)parentViewController[m
     {[m
         return [self buildOverlayViewFromXib];[m
     }[m
[31m-    CGRect bounds = self.view.bounds;[m
[32m+[m[32m    CGRect bounds = self.view.frame;[m
     bounds = CGRectMake(0, 0, bounds.size.width, bounds.size.height);[m
 [m
     UIView* overlayView = [[UIView alloc] initWithFrame:bounds];[m
[36m@@ -942,8 +863,8 @@[m [mparentViewController:(UIViewController*)parentViewController[m
     overlayView.autoresizingMask    = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;[m
     overlayView.opaque              = NO;[m
 [m
[31m-    UIToolbar* toolbar = [[UIToolbar alloc] init];[m
[31m-    toolbar.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleTopMargin;[m
[32m+[m[32m    self.toolbar = [[UIToolbar alloc] init];[m
[32m+[m[32m    self.toolbar.autoresizingMask = UIViewAutoresizingFlexibleWidth;[m
 [m
     id cancelButton = [[UIBarButtonItem alloc][m
                        initWithBarButtonSystemItem:UIBarButtonSystemItemCancel[m
[36m@@ -964,6 +885,8 @@[m [mparentViewController:(UIViewController*)parentViewController[m
                        action:@selector(flipCameraButtonPressed:)[m
                        ];[m
 [m
[32m+[m[32m    NSMutableArray *items;[m
[32m+[m
 #if USE_SHUTTER[m
     id shutterButton = [[UIBarButtonItem alloc][m
                         initWithBarButtonSystemItem:UIBarButtonSystemItemCamera[m
[36m@@ -972,52 +895,53 @@[m [mparentViewController:(UIViewController*)parentViewController[m
                         ];[m
 [m
     if (_processor.isShowFlipCameraButton) {[m
[31m-      toolbar.items = [NSArray arrayWithObjects:flexSpace,cancelButton,flexSpace, flipCamera ,shutterButton,nil];[m
[32m+[m[32m      items = [NSMutableArray arrayWithObjects:flexSpace, cancelButton, flexSpace, flipCamera, shutterButton, nil];[m
     } else {[m
[31m-      toolbar.items = [NSArray arrayWithObjects:flexSpace,cancelButton,flexSpace ,shutterButton,nil];[m
[32m+[m[32m      items = [NSMutableArray arrayWithObjects:flexSpace, cancelButton, flexSpace, shutterButton, nil];[m
     }[m
 #else[m
     if (_processor.isShowFlipCameraButton) {[m
[31m-      toolbar.items = [NSArray arrayWithObjects:flexSpace,cancelButton,flexSpace, flipCamera,nil];[m
[32m+[m[32m      items = [@[flexSpace, cancelButton, flexSpace, flipCamera] mutableCopy];[m
     } else {[m
[31m-      toolbar.items = [NSArray arrayWithObjects:flexSpace,cancelButton,flexSpace,nil];[m
[32m+[m[32m      items = [@[flexSpace, cancelButton, flexSpace] mutableCopy];[m
     }[m
 #endif[m
[31m-    bounds = overlayView.bounds;[m
 [m
[31m-    [toolbar sizeToFit];[m
[31m-    CGFloat toolbarHeight  = [toolbar frame].size.height;[m
[31m-    CGFloat rootViewHeight = CGRectGetHeight(bounds);[m
[31m-    CGFloat rootViewWidth  = CGRectGetWidth(bounds);[m
[31m-    CGRect  rectArea       = CGRectMake(0, rootViewHeight - toolbarHeight, rootViewWidth, toolbarHeight);[m
[31m-    [toolbar setFrame:rectArea];[m
[31m-[m
[31m-    [overlayView addSubview: toolbar];[m
[32m+[m[32m    if (_processor.isShowTorchButton && !_processor.isFrontCamera) {[m
[32m+[m[32m      AVCaptureDevice *device = [AVCaptureDevice defaultDeviceWithMediaType:AVMediaTypeVideo];[m
[32m+[m[32m      if ([device hasTorch] && [device hasFlash]) {[m
[32m+[m[32m        NSURL *bundleURL = [[NSBundle mainBundle] URLForResource:@"CDVBarcodeScanner" withExtension:@"bundle"];[m
[32m+[m[32m        NSBundle *bundle = [NSBundle bundleWithURL:bundleURL];[m
[32m+[m[32m        NSString *imagePath = [bundle pathForResource:@"torch" ofType:@"png"];[m
[32m+[m[32m        UIImage *image = [UIImage imageWithContentsOfFile:imagePath];[m
[32m+[m
[32m+[m[32m        id torchButton = [[UIBarButtonItem alloc][m
[32m+[m[32m                           initWithImage:image[m
[32m+[m[32m                                   style:UIBarButtonItemStylePlain[m
[32m+[m[32m                                  target:(id)self[m
[32m+[m[32m                                  action:@selector(torchButtonPressed:)[m
[32m+[m[32m                           ];[m
[32m+[m
[32m+[m[32m      [items insertObject:torchButton atIndex:0];[m
[32m+[m[32m    }[m
[32m+[m[32m  }[m
[32m+[m[32m    self.toolbar.items = items;[m
[32m+[m[32m    [overlayView addSubview: self.toolbar];[m
 [m
     UIImage* reticleImage = [self buildReticleImage];[m
[31m-    UIView* reticleView = [[UIImageView alloc] initWithImage: reticleImage];[m
[31m-    CGFloat minAxis = MIN(rootViewHeight, rootViewWidth);[m
[31m-[m
[31m-    rectArea = CGRectMake([m
[31m-                          0.5 * (rootViewWidth  - minAxis),[m
[31m-                          0.5 * (rootViewHeight - minAxis),[m
[31m-                          minAxis,[m
[31m-                          minAxis[m
[31m-                          );[m
[31m-[m
[31m-    [reticleView setFrame:rectArea];[m
[31m-[m
[31m-    reticleView.opaque           = NO;[m
[31m-    reticleView.contentMode      = UIViewContentModeScaleAspectFit;[m
[31m-    reticleView.autoresizingMask = 0[m
[31m-    | UIViewAutoresizingFlexibleLeftMargin[m
[31m-    | UIViewAutoresizingFlexibleRightMargin[m
[31m-    | UIViewAutoresizingFlexibleTopMargin[m
[31m-    | UIViewAutoresizingFlexibleBottomMargin[m
[32m+[m[32m    self.reticleView = [[UIImageView alloc] initWithImage:reticleImage];[m
[32m+[m
[32m+[m[32m    self.reticleView.opaque           = NO;[m
[32m+[m[32m    self.reticleView.contentMode      = UIViewContentModeScaleAspectFit;[m
[32m+[m[32m    self.reticleView.autoresizingMask = (UIViewAutoresizing) (0[m
[32m+[m[32m        | UIViewAutoresizingFlexibleLeftMargin[m
[32m+[m[32m        | UIViewAutoresizingFlexibleRightMargin[m
[32m+[m[32m        | UIViewAutoresizingFlexibleTopMargin[m
[32m+[m[32m        | UIViewAutoresizingFlexibleBottomMargin)[m
     ;[m
 [m
[31m-    [overlayView addSubview: reticleView];[m
[31m-[m
[32m+[m[32m    [overlayView addSubview: self.reticleView];[m
[32m+[m[32m    [self resizeElements];[m
     return overlayView;[m
 }[m
 [m
[36m@@ -1041,9 +965,9 @@[m [mparentViewController:(UIViewController*)parentViewController[m
         CGContextSetStrokeColorWithColor(context, color.CGColor);[m
         CGContextSetLineWidth(context, RETICLE_WIDTH);[m
         CGContextBeginPath(context);[m
[31m-        CGFloat lineOffset = RETICLE_OFFSET+(0.5*RETICLE_WIDTH);[m
[32m+[m[32m        CGFloat lineOffset = (CGFloat) (RETICLE_OFFSET+(0.5*RETICLE_WIDTH));[m
         CGContextMoveToPoint(context, lineOffset, RETICLE_SIZE/2);[m
[31m-        CGContextAddLineToPoint(context, RETICLE_SIZE-lineOffset, 0.5*RETICLE_SIZE);[m
[32m+[m[32m        CGContextAddLineToPoint(context, RETICLE_SIZE-lineOffset, (CGFloat) (0.5*RETICLE_SIZE));[m
         CGContextStrokePath(context);[m
     }[m
 [m
[36m@@ -1109,7 +1033,35 @@[m [mparentViewController:(UIViewController*)parentViewController[m
     }[m
 [m
     previewLayer.videoGravity = AVLayerVideoGravityResizeAspectFill;[m
[32m+[m
[32m+[m[32m    [self resizeElements];[m
     [UIView setAnimationsEnabled:YES];[m
 }[m
 [m
[32m+[m[32m-(void) resizeElements {[m
[32m+[m[32m    CGRect bounds = self.view.bounds;[m
[32m+[m[32m    if (@available(iOS 11.0, *)) {[m
[32m+[m[32m        bounds = CGRectMake(bounds.origin.x, bounds.origin.y, bounds.size.width, self.view.safeAreaLayoutGuide.layoutFrame.size.height+self.view.safeAreaLayoutGuide.layoutFrame.origin.y);[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    [self.toolbar sizeToFit];[m
[32m+[m[32m    CGFloat toolbarHeight  = [self.toolbar frame].size.height;[m
[32m+[m[32m    CGFloat rootViewHeight = CGRectGetHeight(bounds);[m
[32m+[m[32m    CGFloat rootViewWidth  = CGRectGetWidth(bounds);[m
[32m+[m[32m    CGRect  rectArea       = CGRectMake(0, rootViewHeight - toolbarHeight, rootViewWidth, toolbarHeight);[m
[32m+[m[32m    [self.toolbar setFrame:rectArea];[m
[32m+[m
[32m+[m[32m    CGFloat minAxis = MIN(rootViewHeight, rootViewWidth);[m
[32m+[m
[32m+[m[32m    rectArea = CGRectMake([m
[32m+[m[32m                          (CGFloat) (0.5 * (rootViewWidth  - minAxis)),[m
[32m+[m[32m                          (CGFloat) (0.5 * (rootViewHeight - minAxis)),[m
[32m+[m[32m                          minAxis,[m
[32m+[m[32m                          minAxis[m
[32m+[m[32m                          );[m
[32m+[m
[32m+[m[32m    [self.reticleView setFrame:rectArea];[m
[32m+[m[32m    self.reticleView.center = CGPointMake(self.view.center.x, self.view.center.y-self.toolbar.frame.size.height/2);[m
[32m+[m[32m}[m
[32m+[m
 @end[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/ios/scannerOverlay.xib b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/ios/scannerOverlay.xib[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/ios/zxing-all-in-one.cpp b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/ios/zxing-all-in-one.cpp[m
[1mdeleted file mode 100755[m
[1mindex 86559fb..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/ios/zxing-all-in-one.cpp[m
[1m+++ /dev/null[m
[36m@@ -1,11982 +0,0 @@[m
[31m-[m
[31m-#include "zxing-all-in-one.h"[m
[31m-[m
[31m-// file: zxing/BarcodeFormat.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Created by Christian Brunschen on 13/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/BarcodeFormat.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-const char *barcodeFormatNames[] = {[m
[31m-    "None",[m
[31m-    "QR_CODE",[m
[31m-    "DATA_MATRIX",[m
[31m-    "UPC_E",[m
[31m-    "UPC_A",[m
[31m-    "EAN_8",[m
[31m-    "EAN_13",[m
[31m-    "CODE_128",[m
[31m-    "CODE_39",[m
[31m-    "ITF"[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/Binarizer.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Binarizer.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Ralf Kistner on 16/10/2009.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *  Modified by Lukasz Warchol on 02/02/2010.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/Binarizer.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-	Binarizer::Binarizer(Ref<LuminanceSource> source) : source_(source) {[m
[31m-  }[m
[31m-[m
[31m-	Binarizer::~Binarizer() {[m
[31m-	}[m
[31m-[m
[31m-	Ref<LuminanceSource> Binarizer::getLuminanceSource() const {[m
[31m-		return source_;[m
[31m-	}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/BinaryBitmap.cpp[m
[31m-[m
[31m-/*[m
[31m- *  BinaryBitmap.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/BinaryBitmap.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-	BinaryBitmap::BinaryBitmap(Ref<Binarizer> binarizer) : binarizer_(binarizer) {[m
[31m-[m
[31m-	}[m
[31m-[m
[31m-	BinaryBitmap::~BinaryBitmap() {[m
[31m-	}[m
[31m-[m
[31m-	Ref<BitArray> BinaryBitmap::getBlackRow(int y, Ref<BitArray> row) {[m
[31m-		return binarizer_->getBlackRow(y, row);[m
[31m-	}[m
[31m-[m
[31m-	Ref<BitMatrix> BinaryBitmap::getBlackMatrix() {[m
[31m-		return binarizer_->getBlackMatrix();[m
[31m-	}[m
[31m-[m
[31m-	int BinaryBitmap::getWidth() const {[m
[31m-		return getLuminanceSource()->getWidth();[m
[31m-	}[m
[31m-[m
[31m-	int BinaryBitmap::getHeight() const {[m
[31m-		return getLuminanceSource()->getHeight();[m
[31m-	}[m
[31m-[m
[31m-	Ref<LuminanceSource> BinaryBitmap::getLuminanceSource() const {[m
[31m-		return binarizer_->getLuminanceSource();[m
[31m-	}[m
[31m-[m
[31m-[m
[31m-	bool BinaryBitmap::isCropSupported() const {[m
[31m-	  return getLuminanceSource()->isCropSupported();[m
[31m-	}[m
[31m-[m
[31m-	Ref<BinaryBitmap> BinaryBitmap::crop(int left, int top, int width, int height) {[m
[31m-	  return Ref<BinaryBitmap> (new BinaryBitmap(binarizer_->createBinarizer(getLuminanceSource()->crop(left, top, width, height))));[m
[31m-	}[m
[31m-[m
[31m-	bool BinaryBitmap::isRotateSupported() const {[m
[31m-	  return getLuminanceSource()->isRotateSupported();[m
[31m-	}[m
[31m-[m
[31m-	Ref<BinaryBitmap> BinaryBitmap::rotateCounterClockwise() {[m
[31m-	  return Ref<BinaryBitmap> (new BinaryBitmap(binarizer_->createBinarizer(getLuminanceSource()->rotateCounterClockwise())));[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/DecodeHints.cpp[m
[31m-[m
[31m-/*[m
[31m- *  DecodeHintType.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-namespace zxing {[m
[31m-[m
[31m-const DecodeHintType DecodeHints::CHARACTER_SET;[m
[31m-[m
[31m-const DecodeHints DecodeHints::PRODUCT_HINT([m
[31m-    BARCODEFORMAT_UPC_E_HINT |[m
[31m-    BARCODEFORMAT_UPC_A_HINT |[m
[31m-    BARCODEFORMAT_EAN_8_HINT |[m
[31m-    BARCODEFORMAT_EAN_13_HINT);[m
[31m-[m
[31m-const DecodeHints DecodeHints::ONED_HINT([m
[31m-    BARCODEFORMAT_UPC_E_HINT |[m
[31m-    BARCODEFORMAT_UPC_A_HINT |[m
[31m-    BARCODEFORMAT_EAN_8_HINT |[m
[31m-    BARCODEFORMAT_EAN_13_HINT |[m
[31m-    BARCODEFORMAT_CODE_128_HINT |[m
[31m-    BARCODEFORMAT_CODE_39_HINT |[m
[31m-    BARCODEFORMAT_ITF_HINT);[m
[31m-[m
[31m-const DecodeHints DecodeHints::DEFAULT_HINT([m
[31m-    BARCODEFORMAT_UPC_E_HINT |[m
[31m-    BARCODEFORMAT_UPC_A_HINT |[m
[31m-    BARCODEFORMAT_EAN_8_HINT |[m
[31m-    BARCODEFORMAT_EAN_13_HINT |[m
[31m-    BARCODEFORMAT_CODE_128_HINT |[m
[31m-    BARCODEFORMAT_CODE_39_HINT |[m
[31m-    BARCODEFORMAT_ITF_HINT |[m
[31m-    BARCODEFORMAT_DATA_MATRIX_HINT |[m
[31m-    BARCODEFORMAT_QR_CODE_HINT);[m
[31m-[m
[31m-DecodeHints::DecodeHints() {[m
[31m-  hints = 0;[m
[31m-}[m
[31m-[m
[31m-DecodeHints::DecodeHints(DecodeHintType init) {[m
[31m-  hints = init;[m
[31m-}[m
[31m-[m
[31m-void DecodeHints::addFormat(BarcodeFormat toadd) {[m
[31m-  switch (toadd) {[m
[31m-    case BarcodeFormat_QR_CODE: hints |= BARCODEFORMAT_QR_CODE_HINT; break;[m
[31m-    case BarcodeFormat_DATA_MATRIX: hints |= BARCODEFORMAT_DATA_MATRIX_HINT; break;[m
[31m-    case BarcodeFormat_UPC_E: hints |= BARCODEFORMAT_UPC_E_HINT; break;[m
[31m-    case BarcodeFormat_UPC_A: hints |= BARCODEFORMAT_UPC_A_HINT; break;[m
[31m-    case BarcodeFormat_EAN_8: hints |= BARCODEFORMAT_EAN_8_HINT; break;[m
[31m-    case BarcodeFormat_EAN_13: hints |= BARCODEFORMAT_EAN_13_HINT; break;[m
[31m-    case BarcodeFormat_CODE_128: hints |= BARCODEFORMAT_CODE_128_HINT; break;[m
[31m-    case BarcodeFormat_CODE_39: hints |= BARCODEFORMAT_CODE_39_HINT; break;[m
[31m-    case BarcodeFormat_ITF: hints |= BARCODEFORMAT_ITF_HINT; break;[m
[31m-    default: throw IllegalArgumentException("Unrecognizd barcode format");[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-bool DecodeHints::containsFormat(BarcodeFormat tocheck) const {[m
[31m-  DecodeHintType checkAgainst;[m
[31m-  switch (tocheck) {[m
[31m-    case BarcodeFormat_QR_CODE: checkAgainst = BARCODEFORMAT_QR_CODE_HINT; break;[m
[31m-    case BarcodeFormat_DATA_MATRIX: checkAgainst = BARCODEFORMAT_DATA_MATRIX_HINT; break;[m
[31m-    case BarcodeFormat_UPC_E: checkAgainst = BARCODEFORMAT_UPC_E_HINT; break;[m
[31m-    case BarcodeFormat_UPC_A: checkAgainst = BARCODEFORMAT_UPC_A_HINT; break;[m
[31m-    case BarcodeFormat_EAN_8: checkAgainst = BARCODEFORMAT_EAN_8_HINT; break;[m
[31m-    case BarcodeFormat_EAN_13: checkAgainst = BARCODEFORMAT_EAN_13_HINT; break;[m
[31m-    case BarcodeFormat_CODE_128: checkAgainst = BARCODEFORMAT_CODE_128_HINT; break;[m
[31m-    case BarcodeFormat_CODE_39: checkAgainst = BARCODEFORMAT_CODE_39_HINT; break;[m
[31m-    case BarcodeFormat_ITF: checkAgainst = BARCODEFORMAT_ITF_HINT; break;[m
[31m-    default: throw IllegalArgumentException("Unrecognizd barcode format");[m
[31m-  }[m
[31m-  return (hints & checkAgainst);[m
[31m-}[m
[31m-[m
[31m-void DecodeHints::setTryHarder(bool toset) {[m
[31m-  if (toset) {[m
[31m-    hints |= TRYHARDER_HINT;[m
[31m-  } else {[m
[31m-    hints &= ~TRYHARDER_HINT;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-bool DecodeHints::getTryHarder() const {[m
[31m-  return (hints & TRYHARDER_HINT);[m
[31m-}[m
[31m-[m
[31m-void DecodeHints::setResultPointCallback(Ref<ResultPointCallback> const& _callback) {[m
[31m-    callback = _callback;[m
[31m-}[m
[31m-[m
[31m-Ref<ResultPointCallback> DecodeHints::getResultPointCallback() const {[m
[31m-    return callback;[m
[31m-}[m
[31m-[m
[31m-} /* namespace */[m
[31m-[m
[31m-// file: zxing/Exception.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Exception.cpp[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 03/06/2008.[m
[31m- *  Copyright 2008-2011 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m-[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/Exception.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-Exception::Exception() {}[m
[31m-[m
[31m-Exception::Exception(const char *msg) :[m
[31m-    message(msg) {[m
[31m-}[m
[31m-[m
[31m-const char* Exception::what() const throw() {[m
[31m-  return message.c_str();[m
[31m-}[m
[31m-[m
[31m-Exception::~Exception() throw() {[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/FormatException.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  FormatException.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 13/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/FormatException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-FormatException::FormatException() {}[m
[31m-[m
[31m-FormatException::FormatException(const char *msg) :[m
[31m-    ReaderException(msg) {[m
[31m-}[m
[31m-[m
[31m-FormatException::~FormatException() throw() {[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/LuminanceSource.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  LuminanceSource.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <sstream>[m
[31m-// #include <zxing/LuminanceSource.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-LuminanceSource::LuminanceSource() {[m
[31m-}[m
[31m-[m
[31m-LuminanceSource::~LuminanceSource() {[m
[31m-}[m
[31m-[m
[31m-bool LuminanceSource::isCropSupported() const {[m
[31m-  return false;[m
[31m-}[m
[31m-[m
[31m-Ref<LuminanceSource> LuminanceSource::crop(int left, int top, int width, int height) {[m
[31m-  (void)left;[m
[31m-  (void)top;[m
[31m-  (void)width;[m
[31m-  (void)height;[m
[31m-  throw IllegalArgumentException("This luminance source does not support cropping.");[m
[31m-}[m
[31m-[m
[31m-bool LuminanceSource::isRotateSupported() const {[m
[31m-  return false;[m
[31m-}[m
[31m-[m
[31m-Ref<LuminanceSource> LuminanceSource::rotateCounterClockwise() {[m
[31m-  throw IllegalArgumentException("This luminance source does not support rotation.");[m
[31m-}[m
[31m-[m
[31m-LuminanceSource::operator std::string() {[m
[31m-  unsigned char* row = 0;[m
[31m-  std::ostringstream oss;[m
[31m-  for (int y = 0; y < getHeight(); y++) {[m
[31m-    row = getRow(y, row);[m
[31m-    for (int x = 0; x < getWidth(); x++) {[m
[31m-      int luminance = row[x] & 0xFF;[m
[31m-      char c;[m
[31m-      if (luminance < 0x40) {[m
[31m-        c = '#';[m
[31m-      } else if (luminance < 0x80) {[m
[31m-        c = '+';[m
[31m-      } else if (luminance < 0xC0) {[m
[31m-        c = '.';[m
[31m-      } else {[m
[31m-        c = ' ';[m
[31m-      }[m
[31m-      oss << c;[m
[31m-    }[m
[31m-    oss << '\n';[m
[31m-  }[m
[31m-  delete [] row;[m
[31m-  return oss.str();[m
[31m-}[m
[31m-[m
[31m-[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/MultiFormatReader.cpp[m
[31m-[m
[31m-/*[m
[31m- *  MultiFormatBarcodeReader.cpp[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Created by Lukasz Warchol on 10-01-26.[m
[31m- *  Modified by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/MultiFormatReader.h>[m
[31m-// #include <zxing/qrcode/QRCodeReader.h>[m
[31m-// #include <zxing/datamatrix/DataMatrixReader.h>[m
[31m-// #include <zxing/oned/MultiFormatUPCEANReader.h>[m
[31m-// #include <zxing/oned/MultiFormatOneDReader.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  MultiFormatReader::MultiFormatReader() {[m
[31m-[m
[31m-  }[m
[31m-[m
[31m-  Ref<Result> MultiFormatReader::decode(Ref<BinaryBitmap> image) {[m
[31m-    setHints(DecodeHints::DEFAULT_HINT);[m
[31m-    return decodeInternal(image);[m
[31m-  }[m
[31m-[m
[31m-  Ref<Result> MultiFormatReader::decode(Ref<BinaryBitmap> image, DecodeHints hints) {[m
[31m-    setHints(hints);[m
[31m-    return decodeInternal(image);[m
[31m-  }[m
[31m-[m
[31m-  Ref<Result> MultiFormatReader::decodeWithState(Ref<BinaryBitmap> image) {[m
[31m-    // Make sure to set up the default state so we don't crash[m
[31m-    if (readers_.size() == 0) {[m
[31m-      setHints(DecodeHints::DEFAULT_HINT);[m
[31m-    }[m
[31m-    return decodeInternal(image);[m
[31m-  }[m
[31m-[m
[31m-  void MultiFormatReader::setHints(DecodeHints hints) {[m
[31m-    hints_ = hints;[m
[31m-    readers_.clear();[m
[31m-    bool tryHarder = hints.getTryHarder();[m
[31m-[m
[31m-    bool addOneDReader = hints.containsFormat(BarcodeFormat_UPC_E) ||[m
[31m-                         hints.containsFormat(BarcodeFormat_UPC_A) ||[m
[31m-                         hints.containsFormat(BarcodeFormat_EAN_8) ||[m
[31m-                         hints.containsFormat(BarcodeFormat_EAN_13) ||[m
[31m-                         hints.containsFormat(BarcodeFormat_CODE_128) ||[m
[31m-                         hints.containsFormat(BarcodeFormat_CODE_39) ||[m
[31m-                         hints.containsFormat(BarcodeFormat_ITF);[m
[31m-    if (addOneDReader && !tryHarder) {[m
[31m-      readers_.push_back(Ref<Reader>(new zxing::oned::MultiFormatOneDReader(hints)));[m
[31m-    }[m
[31m-    if (hints.containsFormat(BarcodeFormat_QR_CODE)) {[m
[31m-      readers_.push_back(Ref<Reader>(new zxing::qrcode::QRCodeReader()));[m
[31m-    }[m
[31m-    if (hints.containsFormat(BarcodeFormat_DATA_MATRIX)) {[m
[31m-      readers_.push_back(Ref<Reader>(new zxing::datamatrix::DataMatrixReader()));[m
[31m-    }[m
[31m-    //TODO: add PDF417 here once PDF417 reader is implemented[m
[31m-    if (addOneDReader && tryHarder) {[m
[31m-      readers_.push_back(Ref<Reader>(new zxing::oned::MultiFormatOneDReader(hints)));[m
[31m-    }[m
[31m-    if (readers_.size() == 0) {[m
[31m-      if (!tryHarder) {[m
[31m-        readers_.push_back(Ref<Reader>(new zxing::oned::MultiFormatOneDReader(hints)));[m
[31m-      }[m
[31m-      readers_.push_back(Ref<Reader>(new zxing::qrcode::QRCodeReader()));[m
[31m-      if (tryHarder) {[m
[31m-        readers_.push_back(Ref<Reader>(new zxing::oned::MultiFormatOneDReader(hints)));[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  Ref<Result> MultiFormatReader::decodeInternal(Ref<BinaryBitmap> image) {[m
[31m-    for (unsigned int i = 0; i < readers_.size(); i++) {[m
[31m-      try {[m
[31m-        return readers_[i]->decode(image, hints_);[m
[31m-      } catch (ReaderException const& re) {[m
[31m-        // continue[m
[31m-      }[m
[31m-    }[m
[31m-    throw ReaderException("No code detected");[m
[31m-  }[m
[31m-[m
[31m-  MultiFormatReader::~MultiFormatReader() {[m
[31m-[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// file: zxing/NotFoundException.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- * Copyright 20011 ZXing authors[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/NotFoundException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-  NotFoundException::NotFoundException(const char *msg)[m
[31m-    : ReaderException(msg) {}[m
[31m-[m
[31m-  NotFoundException::~NotFoundException() throw() {[m
[31m-  }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/Reader.cpp[m
[31m-[m
[31m-/*[m
[31m- *  Reader.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 13/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/Reader.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-Reader::~Reader() { }[m
[31m-[m
[31m-Ref<Result> Reader::decode(Ref<BinaryBitmap> image) {[m
[31m-  return decode(image, DecodeHints::DEFAULT_HINT);[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/ReaderException.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  ReaderException.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 13/05/2008.[m
[31m- *  Copyright 2008-2011 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-ReaderException::ReaderException() {}[m
[31m-[m
[31m-ReaderException::ReaderException(const char *msg) :[m
[31m-    Exception(msg) {[m
[31m-}[m
[31m-[m
[31m-ReaderException::~ReaderException() throw() {[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/Result.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Result.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 13/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/Result.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-using namespace std;[m
[31m-[m
[31m-Result::Result(Ref<String> text, ArrayRef<unsigned char> rawBytes, std::vector<Ref<ResultPoint> > resultPoints,[m
[31m-               BarcodeFormat format) :[m
[31m-  text_(text), rawBytes_(rawBytes), resultPoints_(resultPoints), format_(format) {[m
[31m-}[m
[31m-[m
[31m-Result::~Result() {[m
[31m-}[m
[31m-[m
[31m-Ref<String> Result::getText() {[m
[31m-  return text_;[m
[31m-}[m
[31m-[m
[31m-ArrayRef<unsigned char> Result::getRawBytes() {[m
[31m-  return rawBytes_;[m
[31m-}[m
[31m-[m
[31m-const std::vector<Ref<ResultPoint> >& Result::getResultPoints() const {[m
[31m-  return resultPoints_;[m
[31m-}[m
[31m-[m
[31m-std::vector<Ref<ResultPoint> >& Result::getResultPoints() {[m
[31m-  return resultPoints_;[m
[31m-}[m
[31m-[m
[31m-BarcodeFormat Result::getBarcodeFormat() const {[m
[31m-  return format_;[m
[31m-}[m
[31m-[m
[31m-ostream& operator<<(ostream &out, Result& result) {[m
[31m-  if (result.text_ != 0) {[m
[31m-    out << result.text_->getText();[m
[31m-  } else {[m
[31m-    out << "[" << result.rawBytes_->size() << " bytes]";[m
[31m-  }[m
[31m-  return out;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/ResultPoint.cpp[m
[31m-[m
[31m-/*[m
[31m- *  ResultPoint.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 13/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-// #include <math.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-ResultPoint::ResultPoint() : posX_(0), posY_(0) {}[m
[31m-[m
[31m-ResultPoint::ResultPoint(float x, float y) : posX_(x), posY_(y) {}[m
[31m-[m
[31m-ResultPoint::~ResultPoint() {}[m
[31m-[m
[31m-float ResultPoint::getX() const {[m
[31m-  return posX_;[m
[31m-}[m
[31m-[m
[31m-float ResultPoint::getY() const {[m
[31m-  return posY_;[m
[31m-}[m
[31m-[m
[31m-bool ResultPoint::equals(Ref<ResultPoint> other) {[m
[31m-  return posX_ == other->getX() && posY_ == other->getY();[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * <p>Orders an array of three ResultPoints in an order [A,B,C] such that AB < AC and[m
[31m- * BC < AC and the angle between BC and BA is less than 180 degrees.[m
[31m- */[m
[31m-void ResultPoint::orderBestPatterns(std::vector<Ref<ResultPoint> > &patterns) {[m
[31m-    // Find distances between pattern centers[m
[31m-    float zeroOneDistance = distance(patterns[0]->getX(), patterns[1]->getX(),patterns[0]->getY(), patterns[1]->getY());[m
[31m-    float oneTwoDistance = distance(patterns[1]->getX(), patterns[2]->getX(),patterns[1]->getY(), patterns[2]->getY());[m
[31m-    float zeroTwoDistance = distance(patterns[0]->getX(), patterns[2]->getX(),patterns[0]->getY(), patterns[2]->getY());[m
[31m-[m
[31m-    Ref<ResultPoint> pointA, pointB, pointC;[m
[31m-    // Assume one closest to other two is B; A and C will just be guesses at first[m
[31m-    if (oneTwoDistance >= zeroOneDistance && oneTwoDistance >= zeroTwoDistance) {[m
[31m-      pointB = patterns[0];[m
[31m-      pointA = patterns[1];[m
[31m-      pointC = patterns[2];[m
[31m-    } else if (zeroTwoDistance >= oneTwoDistance && zeroTwoDistance >= zeroOneDistance) {[m
[31m-      pointB = patterns[1];[m
[31m-      pointA = patterns[0];[m
[31m-      pointC = patterns[2];[m
[31m-    } else {[m
[31m-      pointB = patterns[2];[m
[31m-      pointA = patterns[0];[m
[31m-      pointC = patterns[1];[m
[31m-    }[m
[31m-[m
[31m-    // Use cross product to figure out whether A and C are correct or flipped.[m
[31m-    // This asks whether BC x BA has a positive z component, which is the arrangement[m
[31m-    // we want for A, B, C. If it's negative, then we've got it flipped around and[m
[31m-    // should swap A and C.[m
[31m-    if (crossProductZ(pointA, pointB, pointC) < 0.0f) {[m
[31m-      Ref<ResultPoint> temp = pointA;[m
[31m-      pointA = pointC;[m
[31m-      pointC = temp;[m
[31m-    }[m
[31m-[m
[31m-    patterns[0] = pointA;[m
[31m-    patterns[1] = pointB;[m
[31m-    patterns[2] = pointC;[m
[31m-}[m
[31m-[m
[31m-float ResultPoint::distance(Ref<ResultPoint> point1, Ref<ResultPoint> point2) {[m
[31m-  return distance(point1->getX(), point1->getY(), point2->getX(), point2->getY());[m
[31m-}[m
[31m-[m
[31m-float ResultPoint::distance(float x1, float x2, float y1, float y2) {[m
[31m-  float xDiff = x1 - x2;[m
[31m-  float yDiff = y1 - y2;[m
[31m-  return (float) sqrt((double) (xDiff * xDiff + yDiff * yDiff));[m
[31m-}[m
[31m-[m
[31m-float ResultPoint::crossProductZ(Ref<ResultPoint> pointA, Ref<ResultPoint> pointB, Ref<ResultPoint> pointC) {[m
[31m-  float bX = pointB->getX();[m
[31m-  float bY = pointB->getY();[m
[31m-  return ((pointC->getX() - bX) * (pointA->getY() - bY)) - ((pointC->getY() - bY) * (pointA->getX() - bX));[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/ResultPointCallback.cpp[m
[31m-[m
[31m-/*[m
[31m- *  ResultPointCallback.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ResultPointCallback.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-ResultPointCallback::~ResultPointCallback() {}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/Array.cpp[m
[31m-[m
[31m-/*[m
[31m- *  Array.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 07/05/2008.[m
[31m- *  Copyright 2008 Google UK. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Array.h>[m
[31m-[m
[31m-[m
[31m-// file: zxing/common/BitArray.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/BitArray.h>[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-[m
[31m-size_t BitArray::wordsForBits(size_t bits) {[m
[31m-  int arraySize = (bits + bitsPerWord_ - 1) >> logBits_;[m
[31m-  return arraySize;[m
[31m-}[m
[31m-[m
[31m-BitArray::BitArray(size_t size) :[m
[31m-    size_(size), bits_(wordsForBits(size), (const unsigned int)0) {[m
[31m-}[m
[31m-[m
[31m-BitArray::~BitArray() {[m
[31m-}[m
[31m-[m
[31m-size_t BitArray::getSize() {[m
[31m-  return size_;[m
[31m-}[m
[31m-[m
[31m-void BitArray::setBulk(size_t i, unsigned int newBits) {[m
[31m-  bits_[i >> logBits_] = newBits;[m
[31m-}[m
[31m-[m
[31m-void BitArray::setRange(int start, int end) {[m
[31m-  if (end < start) {[m
[31m-    throw IllegalArgumentException("invalid call to BitArray::setRange");[m
[31m-  }[m
[31m-  if (end == start) {[m
[31m-    return;[m
[31m-  }[m
[31m-  end--; // will be easier to treat this as the last actually set bit -- inclusive[m
[31m-  int firstInt = start >> 5;[m
[31m-  int lastInt = end >> 5;[m
[31m-  for (int i = firstInt; i <= lastInt; i++) {[m
[31m-    int firstBit = i > firstInt ? 0 : start & 0x1F;[m
[31m-    int lastBit = i < lastInt ? 31 : end & 0x1F;[m
[31m-    int mask;[m
[31m-    if (firstBit == 0 && lastBit == 31) {[m
[31m-      mask = -1;[m
[31m-    } else {[m
[31m-      mask = 0;[m
[31m-      for (int j = firstBit; j <= lastBit; j++) {[m
[31m-        mask |= 1 << j;[m
[31m-      }[m
[31m-    }[m
[31m-    bits_[i] |= mask;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-void BitArray::clear() {[m
[31m-  size_t max = bits_.size();[m
[31m-  for (size_t i = 0; i < max; i++) {[m
[31m-    bits_[i] = 0;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-bool BitArray::isRange(size_t start, size_t end, bool value) {[m
[31m-  if (end < start) {[m
[31m-    throw IllegalArgumentException("end must be after start");[m
[31m-  }[m
[31m-  if (end == start) {[m
[31m-    return true;[m
[31m-  }[m
[31m-  // treat the 'end' as inclusive, rather than exclusive[m
[31m-  end--;[m
[31m-  size_t firstWord = start >> logBits_;[m
[31m-  size_t lastWord = end >> logBits_;[m
[31m-  for (size_t i = firstWord; i <= lastWord; i++) {[m
[31m-    size_t firstBit = i > firstWord ? 0 : start & bitsMask_;[m
[31m-    size_t lastBit = i < lastWord ? bitsPerWord_ - 1: end & bitsMask_;[m
[31m-    unsigned int mask;[m
[31m-    if (firstBit == 0 && lastBit == bitsPerWord_ - 1) {[m
[31m-      mask = numeric_limits<unsigned int>::max();[m
[31m-    } else {[m
[31m-      mask = 0;[m
[31m-      for (size_t j = firstBit; j <= lastBit; j++) {[m
[31m-        mask |= 1 << j;[m
[31m-      }[m
[31m-    }[m
[31m-    if (value) {[m
[31m-      if ((bits_[i] & mask) != mask) {[m
[31m-        return false;[m
[31m-      }[m
[31m-    } else {[m
[31m-      if ((bits_[i] & mask) != 0) {[m
[31m-        return false;[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-  return true;[m
[31m-}[m
[31m-[m
[31m-vector<unsigned int>& BitArray::getBitArray() {[m
[31m-  return bits_;[m
[31m-}[m
[31m-[m
[31m-void BitArray::reverse() {[m
[31m-  std::vector<unsigned int> newBits(bits_.size(),(const unsigned int) 0);[m
[31m-  for (size_t i = 0; i < size_; i++) {[m
[31m-    if (get(size_ - i - 1)) {[m
[31m-      newBits[i >> logBits_] |= 1<< (i & bitsMask_);[m
[31m-    }[m
[31m-  }[m
[31m-  bits_ = newBits;[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/BitMatrix.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-// #include <iostream>[m
[31m-// #include <sstream>[m
[31m-// #include <string>[m
[31m-[m
[31m-using std::ostream;[m
[31m-using std::ostringstream;[m
[31m-[m
[31m-using zxing::BitMatrix;[m
[31m-using zxing::BitArray;[m
[31m-using zxing::Ref;[m
[31m-[m
[31m-namespace {[m
[31m-  size_t wordsForSize(size_t width,[m
[31m-                      size_t height,[m
[31m-                      unsigned int bitsPerWord,[m
[31m-                      unsigned int logBits) {[m
[31m-    size_t bits = width * height;[m
[31m-    int arraySize = (bits + bitsPerWord - 1) >> logBits;[m
[31m-    return arraySize;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-BitMatrix::BitMatrix(size_t dimension) :[m
[31m-  width_(dimension), height_(dimension), words_(0), bits_(NULL) {[m
[31m-  words_ = wordsForSize(width_, height_, bitsPerWord, logBits);[m
[31m-  bits_ = new unsigned int[words_];[m
[31m-  clear();[m
[31m-}[m
[31m-[m
[31m-BitMatrix::BitMatrix(size_t width, size_t height) :[m
[31m-  width_(width), height_(height), words_(0), bits_(NULL) {[m
[31m-  words_ = wordsForSize(width_, height_, bitsPerWord, logBits);[m
[31m-  bits_ = new unsigned int[words_];[m
[31m-  clear();[m
[31m-}[m
[31m-[m
[31m-BitMatrix::~BitMatrix() {[m
[31m-  delete[] bits_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void BitMatrix::flip(size_t x, size_t y) {[m
[31m-  size_t offset = x + width_ * y;[m
[31m-  bits_[offset >> logBits] ^= 1 << (offset & bitsMask);[m
[31m-}[m
[31m-[m
[31m-void BitMatrix::clear() {[m
[31m-  std::fill(bits_, bits_+words_, 0);[m
[31m-}[m
[31m-[m
[31m-void BitMatrix::setRegion(size_t left, size_t top, size_t width, size_t height) {[m
[31m-  if ((long)top < 0 || (long)left < 0) {[m
[31m-    throw IllegalArgumentException("topI and leftJ must be nonnegative");[m
[31m-  }[m
[31m-  if (height < 1 || width < 1) {[m
[31m-    throw IllegalArgumentException("height and width must be at least 1");[m
[31m-  }[m
[31m-  size_t right = left + width;[m
[31m-  size_t bottom = top + height;[m
[31m-  if (right > width_ || bottom > height_) {[m
[31m-    throw IllegalArgumentException("top + height and left + width must be <= matrix dimension");[m
[31m-  }[m
[31m-  for (size_t y = top; y < bottom; y++) {[m
[31m-    int yOffset = width_ * y;[m
[31m-    for (size_t x = left; x < right; x++) {[m
[31m-      size_t offset = x + yOffset;[m
[31m-      bits_[offset >> logBits] |= 1 << (offset & bitsMask);[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-Ref<BitArray> BitMatrix::getRow(int y, Ref<BitArray> row) {[m
[31m-  if (row.empty() || row->getSize() < width_) {[m
[31m-    row = new BitArray(width_);[m
[31m-  } else {[m
[31m-    row->clear();[m
[31m-  }[m
[31m-  size_t start = y * width_;[m
[31m-  size_t end = start + width_ - 1; // end is inclusive[m
[31m-  size_t firstWord = start >> logBits;[m
[31m-  size_t lastWord = end >> logBits;[m
[31m-  size_t bitOffset = start & bitsMask;[m
[31m-  for (size_t i = firstWord; i <= lastWord; i++) {[m
[31m-    size_t firstBit = i > firstWord ? 0 : start & bitsMask;[m
[31m-    size_t lastBit = i < lastWord ? bitsPerWord - 1 : end & bitsMask;[m
[31m-    unsigned int mask;[m
[31m-    if (firstBit == 0 && lastBit == logBits) {[m
[31m-      mask = std::numeric_limits<unsigned int>::max();[m
[31m-    } else {[m
[31m-      mask = 0;[m
[31m-      for (size_t j = firstBit; j <= lastBit; j++) {[m
[31m-        mask |= 1 << j;[m
[31m-      }[m
[31m-    }[m
[31m-    row->setBulk((i - firstWord) << logBits, (bits_[i] & mask) >> bitOffset);[m
[31m-    if (firstBit == 0 && bitOffset != 0) {[m
[31m-      unsigned int prevBulk = row->getBitArray()[i - firstWord - 1];[m
[31m-      prevBulk |= (bits_[i] & mask) << (bitsPerWord - bitOffset);[m
[31m-      row->setBulk((i - firstWord - 1) << logBits, prevBulk);[m
[31m-    }[m
[31m-  }[m
[31m-  return row;[m
[31m-}[m
[31m-[m
[31m-size_t BitMatrix::getWidth() const {[m
[31m-  return width_;[m
[31m-}[m
[31m-[m
[31m-size_t BitMatrix::getHeight() const {[m
[31m-  return height_;[m
[31m-}[m
[31m-[m
[31m-size_t BitMatrix::getDimension() const {[m
[31m-  return width_;[m
[31m-}[m
[31m-[m
[31m-unsigned int* BitMatrix::getBits() const {[m
[31m-  return bits_;[m
[31m-}[m
[31m-[m
[31m-namespace zxing {[m
[31m-  ostream& operator<<(ostream &out, const BitMatrix &bm) {[m
[31m-    for (size_t y = 0; y < bm.height_; y++) {[m
[31m-      for (size_t x = 0; x < bm.width_; x++) {[m
[31m-        out << (bm.get(x, y) ? "X " : "  ");[m
[31m-      }[m
[31m-      out << "\n";[m
[31m-    }[m
[31m-    return out;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-const char* BitMatrix::description() {[m
[31m-  ostringstream out;[m
[31m-  out << *this;[m
[31m-  return out.str().c_str();[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/BitSource.cpp[m
[31m-[m
[31m-/*[m
[31m- *  BitSource.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 09/05/2008.[m
[31m- *  Copyright 2008 Google UK. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/BitSource.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-int BitSource::readBits(int numBits) {[m
[31m-  if (numBits < 0 || numBits > 32) {[m
[31m-    throw IllegalArgumentException("cannot read <1 or >32 bits");[m
[31m-  } else if (numBits > available()) {[m
[31m-    throw IllegalArgumentException("reading more bits than are available");[m
[31m-  }[m
[31m-[m
[31m-  int result = 0;[m
[31m-[m
[31m-  // First, read remainder from current byte[m
[31m-  if (bitOffset_ > 0) {[m
[31m-    int bitsLeft = 8 - bitOffset_;[m
[31m-    int toRead = numBits < bitsLeft ? numBits : bitsLeft;[m
[31m-    int bitsToNotRead = bitsLeft - toRead;[m
[31m-    int mask = (0xFF >> (8 - toRead)) << bitsToNotRead;[m
[31m-    result = (bytes_[byteOffset_] & mask) >> bitsToNotRead;[m
[31m-    numBits -= toRead;[m
[31m-    bitOffset_ += toRead;[m
[31m-    if (bitOffset_ == 8) {[m
[31m-      bitOffset_ = 0;[m
[31m-      byteOffset_++;[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  // Next read whole bytes[m
[31m-  if (numBits > 0) {[m
[31m-    while (numBits >= 8) {[m
[31m-      result = (result << 8) | (bytes_[byteOffset_] & 0xFF);[m
[31m-      byteOffset_++;[m
[31m-      numBits -= 8;[m
[31m-    }[m
[31m-[m
[31m-[m
[31m-    // Finally read a partial byte[m
[31m-    if (numBits > 0) {[m
[31m-      int bitsToNotRead = 8 - numBits;[m
[31m-      int mask = (0xFF >> bitsToNotRead) << bitsToNotRead;[m
[31m-      result = (result << numBits) | ((bytes_[byteOffset_] & mask) >> bitsToNotRead);[m
[31m-      bitOffset_ += numBits;[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-int BitSource::available() {[m
[31m-  return 8 * (bytes_.size() - byteOffset_) - bitOffset_;[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/CharacterSetECI.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- * Copyright 2008-2011 ZXing authors[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/CharacterSetECI.h>[m
[31m-// #include <sstream>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-using std::string;[m
[31m-[m
[31m-using zxing::common::CharacterSetECI;[m
[31m-using zxing::IllegalArgumentException;[m
[31m-[m
[31m-std::map<int, CharacterSetECI*> CharacterSetECI::VALUE_TO_ECI;[m
[31m-std::map<std::string, CharacterSetECI*> CharacterSetECI::NAME_TO_ECI;[m
[31m-[m
[31m-const bool CharacterSetECI::inited = CharacterSetECI::init_tables();[m
[31m-[m
[31m-bool CharacterSetECI::init_tables() {[m
[31m-  addCharacterSet(0, "Cp437");[m
[31m-  { char const* s[] = {"ISO8859_1", "ISO-8859-1", 0};[m
[31m-    addCharacterSet(1, s); }[m
[31m-  addCharacterSet(2, "Cp437");[m
[31m-  { char const* s[] = {"ISO8859_1", "ISO-8859-1", 0};[m
[31m-    addCharacterSet(3, s); }[m
[31m-  addCharacterSet(4, "ISO8859_2");[m
[31m-  addCharacterSet(5, "ISO8859_3");[m
[31m-  addCharacterSet(6, "ISO8859_4");[m
[31m-  addCharacterSet(7, "ISO8859_5");[m
[31m-  addCharacterSet(8, "ISO8859_6");[m
[31m-  addCharacterSet(9, "ISO8859_7");[m
[31m-  addCharacterSet(10, "ISO8859_8");[m
[31m-  addCharacterSet(11, "ISO8859_9");[m
[31m-  addCharacterSet(12, "ISO8859_10");[m
[31m-  addCharacterSet(13, "ISO8859_11");[m
[31m-  addCharacterSet(15, "ISO8859_13");[m
[31m-  addCharacterSet(16, "ISO8859_14");[m
[31m-  addCharacterSet(17, "ISO8859_15");[m
[31m-  addCharacterSet(18, "ISO8859_16");[m
[31m-  { char const* s[] = {"SJIS", "Shift_JIS", 0};[m
[31m-    addCharacterSet(20, s ); }[m
[31m-  return true;[m
[31m-}[m
[31m-[m
[31m-CharacterSetECI::CharacterSetECI(int value, char const* encodingName_)[m
[31m-  : ECI(value), encodingName(encodingName_) {}[m
[31m-[m
[31m-char const* CharacterSetECI::getEncodingName() {[m
[31m-  return encodingName;[m
[31m-}[m
[31m-[m
[31m-void CharacterSetECI::addCharacterSet(int value, char const* encodingName) {[m
[31m-  CharacterSetECI* eci = new CharacterSetECI(value, encodingName);[m
[31m-  VALUE_TO_ECI[value] = eci; // can't use valueOf[m
[31m-  NAME_TO_ECI[string(encodingName)] = eci;[m
[31m-}[m
[31m-[m
[31m-void CharacterSetECI::addCharacterSet(int value, char const* const* encodingNames) {[m
[31m-  CharacterSetECI* eci = new CharacterSetECI(value, encodingNames[0]);[m
[31m-  VALUE_TO_ECI[value] = eci;[m
[31m-  for (int i = 0; encodingNames[i]; i++) {[m
[31m-    NAME_TO_ECI[string(encodingNames[i])] = eci;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-CharacterSetECI* CharacterSetECI::getCharacterSetECIByValue(int value) {[m
[31m-  if (value < 0 || value >= 900) {[m
[31m-    std::ostringstream oss;[m
[31m-    oss << "Bad ECI value: " << value;[m
[31m-    throw IllegalArgumentException(oss.str().c_str());[m
[31m-  }[m
[31m-  return VALUE_TO_ECI[value];[m
[31m-}[m
[31m-[m
[31m-CharacterSetECI* CharacterSetECI::getCharacterSetECIByName(string const& name) {[m
[31m-  return NAME_TO_ECI[name];[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/Counted.cpp[m
[31m-[m
[31m-/*[m
[31m- *  Counted.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 07/05/2008.[m
[31m- *  Copyright 2008 Google UK. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-template<class T>[m
[31m-ostream& operator<<(ostream &out, Ref<T>& ref) {[m
[31m-  out << "Ref(" << (ref.object_ ? (*ref.object_) : "NULL") << ")";[m
[31m-  return out;[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/DecoderResult.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  DecoderResult.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 20/05/2008.[m
[31m- *  Copyright 2008-2011 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/DecoderResult.h>[m
[31m-[m
[31m-using namespace std;[m
[31m-using namespace zxing;[m
[31m-[m
[31m-DecoderResult::DecoderResult(ArrayRef<unsigned char> rawBytes,[m
[31m-                             Ref<String> text,[m
[31m-                             ArrayRef< ArrayRef<unsigned char> >& byteSegments,[m
[31m-                             string const& ecLevel) :[m
[31m-  rawBytes_(rawBytes),[m
[31m-  text_(text),[m
[31m-  byteSegments_(byteSegments),[m
[31m-  ecLevel_(ecLevel) {}[m
[31m-[m
[31m-DecoderResult::DecoderResult(ArrayRef<unsigned char> rawBytes,[m
[31m-                             Ref<String> text)[m
[31m-  : rawBytes_(rawBytes), text_(text) {}[m
[31m-[m
[31m-ArrayRef<unsigned char> DecoderResult::getRawBytes() {[m
[31m-  return rawBytes_;[m
[31m-}[m
[31m-[m
[31m-Ref<String> DecoderResult::getText() {[m
[31m-  return text_;[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/DetectorResult.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  DetectorResult.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 14/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/DetectorResult.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-DetectorResult::DetectorResult(Ref<BitMatrix> bits, std::vector<Ref<ResultPoint> > points, Ref<PerspectiveTransform> transform) :[m
[31m-  bits_(bits), points_(points), transform_(transform) {[m
[31m-}[m
[31m-[m
[31m-Ref<BitMatrix> DetectorResult::getBits() {[m
[31m-  return bits_;[m
[31m-}[m
[31m-[m
[31m-std::vector<Ref<ResultPoint> > DetectorResult::getPoints() {[m
[31m-  return points_;[m
[31m-}[m
[31m-[m
[31m-Ref<PerspectiveTransform> DetectorResult::getTransform() {[m
[31m-  return transform_;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/ECI.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- * Copyright 2008-2011 ZXing authors[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/ECI.h>[m
[31m-// #include <sstream>[m
[31m-// #include <zxing/common/CharacterSetECI.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-using zxing::common::ECI;[m
[31m-using zxing::IllegalArgumentException;[m
[31m-[m
[31m-ECI::ECI(int value_) : value(value_) {}[m
[31m-[m
[31m-int ECI::getValue() const {[m
[31m-  return value;[m
[31m-}[m
[31m-[m
[31m-ECI* ECI::getECIByValue(int value) {[m
[31m-  if (value < 0 || value > 999999) {[m
[31m-    std::ostringstream oss;[m
[31m-    oss << "Bad ECI value: " << value;[m
[31m-    throw IllegalArgumentException(oss.str().c_str());[m
[31m-  }[m
[31m-  if (value < 900) { // Character set ECIs use 000000 - 000899[m
[31m-    return CharacterSetECI::getCharacterSetECIByValue(value);[m
[31m-  }[m
[31m-  return 0;[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/EdgeDetector.cpp[m
[31m-[m
[31m-/*[m
[31m- *  EdgeDetector.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Ralf Kistner on 7/12/2009.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/EdgeDetector.h>[m
[31m-// #include <algorithm>[m
[31m-// #include <cmath>[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace EdgeDetector {[m
[31m-[m
[31m-void findEdgePoints(std::vector<Point>& points, const BitMatrix& image, Point start, Point end, bool invert, int skip, float deviation) {[m
[31m-  float xdist = end.x - start.x;[m
[31m-  float ydist = end.y - start.y;[m
[31m-  float length = sqrt(xdist * xdist + ydist * ydist);[m
[31m-[m
[31m-[m
[31m-  int var;[m
[31m-[m
[31m-  if (abs(xdist) > abs(ydist)) {[m
[31m-    // Horizontal[m
[31m-    if (xdist < 0)[m
[31m-      skip = -skip;[m
[31m-[m
[31m-    var = int(abs(deviation * length / xdist));[m
[31m-[m
[31m-    float dy = ydist / xdist * skip;[m
[31m-    bool left = (skip < 0) ^ invert;[m
[31m-    int x = int(start.x);[m
[31m-[m
[31m-    int steps = int(xdist / skip);[m
[31m-    for (int i = 0; i < steps; i++) {[m
[31m-      x += skip;[m
[31m-      if (x < 0 || x >= (int)image.getWidth())[m
[31m-        continue; // In case we start off the edge[m
[31m-      int my = int(start.y + dy * i);[m
[31m-      int ey = min(my + var + 1, (int)image.getHeight() - 1);[m
[31m-      int sy = max(my - var, 0);[m
[31m-      for (int y = sy + 1; y < ey; y++) {[m
[31m-        if (left) {[m
[31m-          if (image.get(x, y) && !image.get(x, y + 1)) {[m
[31m-            points.push_back(Point(x, y + 0.5f));[m
[31m-          }[m
[31m-        } else {[m
[31m-          if (!image.get(x, y) && image.get(x, y + 1)) {[m
[31m-            points.push_back(Point(x, y + 0.5f));[m
[31m-          }[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-  } else {[m
[31m-    // Vertical[m
[31m-    if (ydist < 0)[m
[31m-      skip = -skip;[m
[31m-[m
[31m-    var = int(abs(deviation * length / ydist));[m
[31m-[m
[31m-    float dx = xdist / ydist * skip;[m
[31m-    bool down = (skip > 0) ^ invert;[m
[31m-    int y = int(start.y);[m
[31m-[m
[31m-    int steps = int(ydist / skip);[m
[31m-    for (int i = 0; i < steps; i++) {[m
[31m-      y += skip;[m
[31m-      if (y < 0 || y >= (int)image.getHeight())[m
[31m-        continue; // In case we start off the edge[m
[31m-      int mx = int(start.x + dx * i);[m
[31m-      int ex = min(mx + var + 1, (int)image.getWidth() - 1);[m
[31m-      int sx = max(mx - var, 0);[m
[31m-      for (int x = sx + 1; x < ex; x++) {[m
[31m-        if (down) {[m
[31m-          if (image.get(x, y) && !image.get(x + 1, y)) {[m
[31m-            points.push_back(Point(x + 0.5f, y));[m
[31m-          }[m
[31m-[m
[31m-        } else {[m
[31m-          if (!image.get(x, y) && image.get(x + 1, y)) {[m
[31m-            points.push_back(Point(x + 0.5f, y));[m
[31m-          }[m
[31m-        }[m
[31m-[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-Line findLine(const BitMatrix& image, Line estimate, bool invert, int deviation, float threshold, int skip) {[m
[31m-  float t = threshold * threshold;[m
[31m-[m
[31m-  Point start = estimate.start;[m
[31m-  Point end = estimate.end;[m
[31m-[m
[31m-  vector<Point> edges;[m
[31m-  edges.clear();[m
[31m-  findEdgePoints(edges, image, start, end, invert, skip, deviation);[m
[31m-[m
[31m-  int n = edges.size();[m
[31m-[m
[31m-  float xdist = end.x - start.x;[m
[31m-  float ydist = end.y - start.y;[m
[31m-[m
[31m-  bool horizontal = abs(xdist) > abs(ydist);[m
[31m-[m
[31m-  float max = 0;[m
[31m-  Line bestLine(start, end);  // prepopulate with the given line, in case we can't find any line for some reason[m
[31m-[m
[31m-  for (int i = -deviation; i < deviation; i++) {[m
[31m-    float x1, y1;[m
[31m-    if (horizontal) {[m
[31m-      y1 = start.y + i;[m
[31m-      x1 = start.x - i * ydist / xdist;[m
[31m-    } else {[m
[31m-      y1 = start.y - i * xdist / ydist;[m
[31m-      x1 = start.x + i;[m
[31m-    }[m
[31m-[m
[31m-    for (int j = -deviation; j < deviation; j++) {[m
[31m-      float x2, y2;[m
[31m-      if (horizontal) {[m
[31m-        y2 = end.y + j;[m
[31m-        x2 = end.x - j * ydist / xdist;[m
[31m-      } else {[m
[31m-        y2 = end.y - j * xdist / ydist;[m
[31m-        x2 = end.x + j;[m
[31m-      }[m
[31m-[m
[31m-      float dx = x1 - x2;[m
[31m-      float dy = y1 - y2;[m
[31m-      float length = sqrt(dx * dx + dy * dy);[m
[31m-[m
[31m-      float score = 0;[m
[31m-[m
[31m-      for(int k = 0; k < n; k++) {[m
[31m-        const Point& edge = edges[k];[m
[31m-        float dist = ((x1 - edge.x) * dy - (y1 - edge.y) * dx) / length;[m
[31m-        // Similar to least squares method[m
[31m-        float s = t - dist * dist;[m
[31m-        if (s > 0)[m
[31m-          score += s;[m
[31m-      }[m
[31m-[m
[31m-      if (score > max) {[m
[31m-        max = score;[m
[31m-        bestLine.start = Point(x1, y1);[m
[31m-        bestLine.end = Point(x2, y2);[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  return bestLine;[m
[31m-}[m
[31m-[m
[31m-Point intersection(Line a, Line b) {[m
[31m-  float dxa = a.start.x - a.end.x;[m
[31m-  float dxb = b.start.x - b.end.x;[m
[31m-  float dya = a.start.y - a.end.y;[m
[31m-  float dyb = b.start.y - b.end.y;[m
[31m-[m
[31m-  float p = a.start.x * a.end.y - a.start.y * a.end.x;[m
[31m-  float q = b.start.x * b.end.y - b.start.y * b.end.x;[m
[31m-  float denom = dxa * dyb - dya * dxb;[m
[31m-  if(denom == 0)  // Lines don't intersect[m
[31m-    return Point(INFINITY, INFINITY);[m
[31m-[m
[31m-  float x = (p * dxb - dxa * q) / denom;[m
[31m-  float y = (p * dyb - dya * q) / denom;[m
[31m-[m
[31m-  return Point(x, y);[m
[31m-}[m
[31m-[m
[31m-} // namespace EdgeDetector[m
[31m-} // namespace zxing[m
[31m-[m
[31m-// file: zxing/common/GlobalHistogramBinarizer.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  GlobalHistogramBinarizer.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/GlobalHistogramBinarizer.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-using namespace std;[m
[31m-[m
[31m-const int LUMINANCE_BITS_25 = 5;[m
[31m-const int LUMINANCE_SHIFT_25 = 8 - LUMINANCE_BITS_25;[m
[31m-const int LUMINANCE_BUCKETS_25 = 1 << LUMINANCE_BITS_25;[m
[31m-[m
[31m-GlobalHistogramBinarizer::GlobalHistogramBinarizer(Ref<LuminanceSource> source) :[m
[31m-  Binarizer(source), cached_matrix_(NULL), cached_row_(NULL), cached_row_num_(-1) {[m
[31m-[m
[31m-}[m
[31m-[m
[31m-GlobalHistogramBinarizer::~GlobalHistogramBinarizer() {[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Ref<BitArray> GlobalHistogramBinarizer::getBlackRow(int y, Ref<BitArray> row) {[m
[31m-  if (y == cached_row_num_) {[m
[31m-    if (cached_row_ != NULL) {[m
[31m-      return cached_row_;[m
[31m-    } else {[m
[31m-      throw IllegalArgumentException("Too little dynamic range in luminance");[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  vector<int> histogram(LUMINANCE_BUCKETS_25, 0);[m
[31m-  LuminanceSource& source = *getLuminanceSource();[m
[31m-  int width = source.getWidth();[m
[31m-  if (row == NULL || static_cast<int>(row->getSize()) < width) {[m
[31m-    row = new BitArray(width);[m
[31m-  } else {[m
[31m-    row->clear();[m
[31m-  }[m
[31m-[m
[31m-  //TODO(flyashi): cache this instead of allocating and deleting per row[m
[31m-  unsigned char* row_pixels = NULL;[m
[31m-  try {[m
[31m-    row_pixels = new unsigned char[width];[m
[31m-    row_pixels = source.getRow(y, row_pixels);[m
[31m-    for (int x = 0; x < width; x++) {[m
[31m-      histogram[row_pixels[x] >> LUMINANCE_SHIFT_25]++;[m
[31m-    }[m
[31m-    int blackPoint = estimate(histogram);[m
[31m-[m
[31m-    BitArray& array = *row;[m
[31m-    int left = row_pixels[0];[m
[31m-    int center = row_pixels[1];[m
[31m-    for (int x = 1; x < width - 1; x++) {[m
[31m-      int right = row_pixels[x + 1];[m
[31m-      // A simple -1 4 -1 box filter with a weight of 2.[m
[31m-      int luminance = ((center << 2) - left - right) >> 1;[m
[31m-      if (luminance < blackPoint) {[m
[31m-        array.set(x);[m
[31m-      }[m
[31m-      left = center;[m
[31m-      center = right;[m
[31m-    }[m
[31m-[m
[31m-    cached_row_ = row;[m
[31m-    cached_row_num_ = y;[m
[31m-    delete [] row_pixels;[m
[31m-    return row;[m
[31m-  } catch (IllegalArgumentException const& iae) {[m
[31m-    // Cache the fact that this row failed.[m
[31m-    cached_row_ = NULL;[m
[31m-    cached_row_num_ = y;[m
[31m-    delete [] row_pixels;[m
[31m-    throw iae;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-Ref<BitMatrix> GlobalHistogramBinarizer::getBlackMatrix() {[m
[31m-  if (cached_matrix_ != NULL) {[m
[31m-    return cached_matrix_;[m
[31m-  }[m
[31m-[m
[31m-  // Faster than working with the reference[m
[31m-  LuminanceSource& source = *getLuminanceSource();[m
[31m-  int width = source.getWidth();[m
[31m-  int height = source.getHeight();[m
[31m-  vector<int> histogram(LUMINANCE_BUCKETS_25, 0);[m
[31m-[m
[31m-  // Quickly calculates the histogram by sampling four rows from the image.[m
[31m-  // This proved to be more robust on the blackbox tests than sampling a[m
[31m-  // diagonal as we used to do.[m
[31m-  ArrayRef<unsigned char> ref (width);[m
[31m-  unsigned char* row = &ref[0];[m
[31m-  for (int y = 1; y < 5; y++) {[m
[31m-    int rownum = height * y / 5;[m
[31m-    int right = (width << 2) / 5;[m
[31m-    row = source.getRow(rownum, row);[m
[31m-    for (int x = width / 5; x < right; x++) {[m
[31m-      histogram[row[x] >> LUMINANCE_SHIFT_25]++;[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  int blackPoint = estimate(histogram);[m
[31m-[m
[31m-  Ref<BitMatrix> matrix_ref(new BitMatrix(width, height));[m
[31m-  BitMatrix& matrix = *matrix_ref;[m
[31m-  for (int y = 0; y < height; y++) {[m
[31m-    row = source.getRow(y, row);[m
[31m-    for (int x = 0; x < width; x++) {[m
[31m-      if (row[x] < blackPoint)[m
[31m-        matrix.set(x, y);[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  cached_matrix_ = matrix_ref;[m
[31m-  // delete [] row;[m
[31m-  return matrix_ref;[m
[31m-}[m
[31m-[m
[31m-int GlobalHistogramBinarizer::estimate(vector<int> &histogram) {[m
[31m-  int numBuckets = histogram.size();[m
[31m-  int maxBucketCount = 0;[m
[31m-[m
[31m-  // Find tallest peak in histogram[m
[31m-  int firstPeak = 0;[m
[31m-  int firstPeakSize = 0;[m
[31m-  for (int i = 0; i < numBuckets; i++) {[m
[31m-    if (histogram[i] > firstPeakSize) {[m
[31m-      firstPeak = i;[m
[31m-      firstPeakSize = histogram[i];[m
[31m-    }[m
[31m-    if (histogram[i] > maxBucketCount) {[m
[31m-      maxBucketCount = histogram[i];[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  // Find second-tallest peak -- well, another peak that is tall and not[m
[31m-  // so close to the first one[m
[31m-  int secondPeak = 0;[m
[31m-  int secondPeakScore = 0;[m
[31m-  for (int i = 0; i < numBuckets; i++) {[m
[31m-    int distanceToBiggest = i - firstPeak;[m
[31m-    // Encourage more distant second peaks by multiplying by square of distance[m
[31m-    int score = histogram[i] * distanceToBiggest * distanceToBiggest;[m
[31m-    if (score > secondPeakScore) {[m
[31m-      secondPeak = i;[m
[31m-      secondPeakScore = score;[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  // Put firstPeak first[m
[31m-  if (firstPeak > secondPeak) {[m
[31m-    int temp = firstPeak;[m
[31m-    firstPeak = secondPeak;[m
[31m-    secondPeak = temp;[m
[31m-  }[m
[31m-[m
[31m-  // Kind of arbitrary; if the two peaks are very close, then we figure there is[m
[31m-  // so little dynamic range in the image, that discriminating black and white[m
[31m-  // is too error-prone.[m
[31m-  // Decoding the image/line is either pointless, or may in some cases lead to[m
[31m-  // a false positive for 1D formats, which are relatively lenient.[m
[31m-  // We arbitrarily say "close" is[m
[31m-  // "<= 1/16 of the total histogram buckets apart"[m
[31m-  if (secondPeak - firstPeak <= numBuckets >> 4) {[m
[31m-    throw IllegalArgumentException("Too little dynamic range in luminance");[m
[31m-  }[m
[31m-[m
[31m-  // Find a valley between them that is low and closer to the white peak[m
[31m-  int bestValley = secondPeak - 1;[m
[31m-  int bestValleyScore = -1;[m
[31m-  for (int i = secondPeak - 1; i > firstPeak; i--) {[m
[31m-    int fromFirst = i - firstPeak;[m
[31m-    // Favor a "valley" that is not too close to either peak -- especially not[m
[31m-    // the black peak -- and that has a low value of course[m
[31m-    int score = fromFirst * fromFirst * (secondPeak - i) *[m
[31m-      (maxBucketCount - histogram[i]);[m
[31m-    if (score > bestValleyScore) {[m
[31m-      bestValley = i;[m
[31m-      bestValleyScore = score;[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  return bestValley << LUMINANCE_SHIFT_25;[m
[31m-}[m
[31m-[m
[31m-Ref<Binarizer> GlobalHistogramBinarizer::createBinarizer(Ref<LuminanceSource> source) {[m
[31m-  return Ref<Binarizer> (new GlobalHistogramBinarizer(source));[m
[31m-}[m
[31m-[m
[31m-} // namespace zxing[m
[31m-[m
[31m-// file: zxing/common/GreyscaleLuminanceSource.cpp[m
[31m-[m
[31m-/*[m
[31m- *  GreyscaleLuminanceSource.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/GreyscaleLuminanceSource.h>[m
[31m-// #include <zxing/common/GreyscaleRotatedLuminanceSource.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-GreyscaleLuminanceSource::GreyscaleLuminanceSource(unsigned char* greyData, int dataWidth,[m
[31m-    int dataHeight, int left, int top, int width, int height) : greyData_(greyData),[m
[31m-    dataWidth_(dataWidth), dataHeight_(dataHeight), left_(left), top_(top), width_(width),[m
[31m-    height_(height) {[m
[31m-[m
[31m-  if (left + width > dataWidth || top + height > dataHeight || top < 0 || left < 0) {[m
[31m-    throw IllegalArgumentException("Crop rectangle does not fit within image data.");[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-unsigned char* GreyscaleLuminanceSource::getRow(int y, unsigned char* row) {[m
[31m-  if (y < 0 || y >= this->getHeight()) {[m
[31m-    throw IllegalArgumentException("Requested row is outside the image.");[m
[31m-  }[m
[31m-  int width = getWidth();[m
[31m-  // TODO(flyashi): determine if row has enough size.[m
[31m-  if (row == NULL) {[m
[31m-    row = new unsigned char[width_];[m
[31m-  }[m
[31m-  int offset = (y + top_) * dataWidth_ + left_;[m
[31m-  memcpy(row, &greyData_[offset], width);[m
[31m-  return row;[m
[31m-}[m
[31m-[m
[31m-unsigned char* GreyscaleLuminanceSource::getMatrix() {[m
[31m-  int size = width_ * height_;[m
[31m-  unsigned char* result = new unsigned char[size];[m
[31m-  if (left_ == 0 && top_ == 0 && dataWidth_ == width_ && dataHeight_ == height_) {[m
[31m-    memcpy(result, greyData_, size);[m
[31m-  } else {[m
[31m-    for (int row = 0; row < height_; row++) {[m
[31m-      memcpy(result + row * width_, greyData_ + (top_ + row) * dataWidth_ + left_, width_);[m
[31m-    }[m
[31m-  }[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-Ref<LuminanceSource> GreyscaleLuminanceSource::rotateCounterClockwise() {[m
[31m-  // Intentionally flip the left, top, width, and height arguments as needed. dataWidth and[m
[31m-  // dataHeight are always kept unrotated.[m
[31m-  return Ref<LuminanceSource> (new GreyscaleRotatedLuminanceSource(greyData_, dataWidth_,[m
[31m-      dataHeight_, top_, left_, height_, width_));[m
[31m-}[m
[31m-[m
[31m-} /* namespace */[m
[31m-[m
[31m-// file: zxing/common/GreyscaleRotatedLuminanceSource.cpp[m
[31m-[m
[31m-/*[m
[31m- *  GreyscaleRotatedLuminanceSource.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-[m
[31m-// #include <zxing/common/GreyscaleRotatedLuminanceSource.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-// Note that dataWidth and dataHeight are not reversed, as we need to be able to traverse the[m
[31m-// greyData correctly, which does not get rotated.[m
[31m-GreyscaleRotatedLuminanceSource::GreyscaleRotatedLuminanceSource(unsigned char* greyData,[m
[31m-    int dataWidth, int dataHeight, int left, int top, int width, int height) : greyData_(greyData),[m
[31m-    dataWidth_(dataWidth), dataHeight_(dataHeight), left_(left), top_(top), width_(width),[m
[31m-    height_(height) {[m
[31m-[m
[31m-  // Intentionally comparing to the opposite dimension since we're rotated.[m
[31m-  if (left + width > dataHeight || top + height > dataWidth) {[m
[31m-    throw IllegalArgumentException("Crop rectangle does not fit within image data.");[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// The API asks for rows, but we're rotated, so we return columns.[m
[31m-unsigned char* GreyscaleRotatedLuminanceSource::getRow(int y, unsigned char* row) {[m
[31m-  if (y < 0 || y >= getHeight()) {[m
[31m-    throw IllegalArgumentException("Requested row is outside the image");[m
[31m-  }[m
[31m-  int width = getWidth();[m
[31m-  if (row == NULL) {[m
[31m-    row = new unsigned char[width];[m
[31m-  }[m
[31m-  int offset = (left_ * dataWidth_) + (dataWidth_ - (y + top_));[m
[31m-  for (int x = 0; x < width; x++) {[m
[31m-    row[x] = greyData_[offset];[m
[31m-    offset += dataWidth_;[m
[31m-  }[m
[31m-  return row;[m
[31m-}[m
[31m-[m
[31m-unsigned char* GreyscaleRotatedLuminanceSource::getMatrix() {[m
[31m-  unsigned char* result = new unsigned char[width_ * height_];[m
[31m-  // This depends on getRow() honoring its second parameter.[m
[31m-  for (int y = 0; y < height_; y++) {[m
[31m-    getRow(y, &result[y * width_]);[m
[31m-  }[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-} // namespace[m
[31m-[m
[31m-// file: zxing/common/GridSampler.cpp[m
[31m-[m
[31m-/*[m
[31m- *  GridSampler.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 18/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/GridSampler.h>[m
[31m-// #include <zxing/common/PerspectiveTransform.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <iostream>[m
[31m-// #include <sstream>[m
[31m-[m
[31m-namespace zxing {[m
[31m-using namespace std;[m
[31m-[m
[31m-GridSampler GridSampler::gridSampler;[m
[31m-[m
[31m-GridSampler::GridSampler() {[m
[31m-}[m
[31m-[m
[31m-Ref<BitMatrix> GridSampler::sampleGrid(Ref<BitMatrix> image, int dimension, Ref<PerspectiveTransform> transform) {[m
[31m-  Ref<BitMatrix> bits(new BitMatrix(dimension));[m
[31m-  vector<float> points(dimension << 1, (const float)0.0f);[m
[31m-  for (int y = 0; y < dimension; y++) {[m
[31m-    int max = points.size();[m
[31m-    float yValue = (float)y + 0.5f;[m
[31m-    for (int x = 0; x < max; x += 2) {[m
[31m-      points[x] = (float)(x >> 1) + 0.5f;[m
[31m-      points[x + 1] = yValue;[m
[31m-    }[m
[31m-    transform->transformPoints(points);[m
[31m-    checkAndNudgePoints(image, points);[m
[31m-    for (int x = 0; x < max; x += 2) {[m
[31m-      if (image->get((int)points[x], (int)points[x + 1])) {[m
[31m-        bits->set(x >> 1, y);[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-  return bits;[m
[31m-}[m
[31m-[m
[31m-Ref<BitMatrix> GridSampler::sampleGrid(Ref<BitMatrix> image, int dimensionX, int dimensionY, Ref<PerspectiveTransform> transform) {[m
[31m-  Ref<BitMatrix> bits(new BitMatrix(dimensionX, dimensionY));[m
[31m-  vector<float> points(dimensionX << 1, (const float)0.0f);[m
[31m-  for (int y = 0; y < dimensionY; y++) {[m
[31m-    int max = points.size();[m
[31m-    float yValue = (float)y + 0.5f;[m
[31m-    for (int x = 0; x < max; x += 2) {[m
[31m-      points[x] = (float)(x >> 1) + 0.5f;[m
[31m-      points[x + 1] = yValue;[m
[31m-    }[m
[31m-    transform->transformPoints(points);[m
[31m-    checkAndNudgePoints(image, points);[m
[31m-    for (int x = 0; x < max; x += 2) {[m
[31m-      if (image->get((int)points[x], (int)points[x + 1])) {[m
[31m-        bits->set(x >> 1, y);[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-  return bits;[m
[31m-}[m
[31m-[m
[31m-Ref<BitMatrix> GridSampler::sampleGrid(Ref<BitMatrix> image, int dimension, float p1ToX, float p1ToY, float p2ToX,[m
[31m-                                       float p2ToY, float p3ToX, float p3ToY, float p4ToX, float p4ToY, float p1FromX, float p1FromY, float p2FromX,[m
[31m-                                       float p2FromY, float p3FromX, float p3FromY, float p4FromX, float p4FromY) {[m
[31m-  Ref<PerspectiveTransform> transform(PerspectiveTransform::quadrilateralToQuadrilateral(p1ToX, p1ToY, p2ToX, p2ToY,[m
[31m-                                      p3ToX, p3ToY, p4ToX, p4ToY, p1FromX, p1FromY, p2FromX, p2FromY, p3FromX, p3FromY, p4FromX, p4FromY));[m
[31m-[m
[31m-  return sampleGrid(image, dimension, transform);[m
[31m-[m
[31m-}[m
[31m-[m
[31m-void GridSampler::checkAndNudgePoints(Ref<BitMatrix> image, vector<float> &points) {[m
[31m-  int width = image->getWidth();[m
[31m-  int height = image->getHeight();[m
[31m-[m
[31m-[m
[31m-  // The Java code assumes that if the start and end points are in bounds, the rest will also be.[m
[31m-  // However, in some unusual cases points in the middle may also be out of bounds.[m
[31m-  // Since we can't rely on an ArrayIndexOutOfBoundsException like Java, we check every point.[m
[31m-[m
[31m-  for (size_t offset = 0; offset < points.size(); offset += 2) {[m
[31m-    int x = (int)points[offset];[m
[31m-    int y = (int)points[offset + 1];[m
[31m-    if (x < -1 || x > width || y < -1 || y > height) {[m
[31m-      ostringstream s;[m
[31m-      s << "Transformed point out of bounds at " << x << "," << y;[m
[31m-      throw ReaderException(s.str().c_str());[m
[31m-    }[m
[31m-[m
[31m-    if (x == -1) {[m
[31m-      points[offset] = 0.0f;[m
[31m-    } else if (x == width) {[m
[31m-      points[offset] = width - 1;[m
[31m-    }[m
[31m-    if (y == -1) {[m
[31m-      points[offset + 1] = 0.0f;[m
[31m-    } else if (y == height) {[m
[31m-      points[offset + 1] = height - 1;[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-}[m
[31m-[m
[31m-GridSampler &GridSampler::getInstance() {[m
[31m-  return gridSampler;[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/HybridBinarizer.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  HybridBinarizer.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/HybridBinarizer.h>[m
[31m-[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-using namespace std;[m
[31m-using namespace zxing;[m
[31m-[m
[31m-namespace {[m
[31m-  const int BLOCK_SIZE_POWER = 3;[m
[31m-  const int BLOCK_SIZE = 1 << BLOCK_SIZE_POWER;[m
[31m-  const int BLOCK_SIZE_MASK = BLOCK_SIZE - 1;[m
[31m-  const int MINIMUM_DIMENSION = BLOCK_SIZE * 5;[m
[31m-}[m
[31m-[m
[31m-HybridBinarizer::HybridBinarizer(Ref<LuminanceSource> source) :[m
[31m-  GlobalHistogramBinarizer(source), matrix_(NULL), cached_row_(NULL), cached_row_num_(-1) {[m
[31m-}[m
[31m-[m
[31m-HybridBinarizer::~HybridBinarizer() {[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Ref<Binarizer>[m
[31m-HybridBinarizer::createBinarizer(Ref<LuminanceSource> source) {[m
[31m-  return Ref<Binarizer> (new HybridBinarizer(source));[m
[31m-}[m
[31m-[m
[31m-Ref<BitMatrix> HybridBinarizer::getBlackMatrix() {[m
[31m-  // Calculates the final BitMatrix once for all requests. This could[m
[31m-  // be called once from the constructor instead, but there are some[m
[31m-  // advantages to doing it lazily, such as making profiling easier,[m
[31m-  // and not doing heavy lifting when callers don't expect it.[m
[31m-  if (matrix_) {[m
[31m-    return matrix_;[m
[31m-  }[m
[31m-  LuminanceSource& source = *getLuminanceSource();[m
[31m-  if (source.getWidth() >= MINIMUM_DIMENSION &&[m
[31m-      source.getHeight() >= MINIMUM_DIMENSION) {[m
[31m-    unsigned char* luminances = source.getMatrix();[m
[31m-    int width = source.getWidth();[m
[31m-    int height = source.getHeight();[m
[31m-    int subWidth = width >> BLOCK_SIZE_POWER;[m
[31m-    if ((width & BLOCK_SIZE_MASK) != 0) {[m
[31m-      subWidth++;[m
[31m-    }[m
[31m-    int subHeight = height >> BLOCK_SIZE_POWER;[m
[31m-    if ((height & BLOCK_SIZE_MASK) != 0) {[m
[31m-      subHeight++;[m
[31m-    }[m
[31m-    int* blackPoints =[m
[31m-      calculateBlackPoints(luminances, subWidth, subHeight, width, height);[m
[31m-[m
[31m-    Ref<BitMatrix> newMatrix (new BitMatrix(width, height));[m
[31m-    calculateThresholdForBlock(luminances,[m
[31m-                               subWidth,[m
[31m-                               subHeight,[m
[31m-                               width,[m
[31m-                               height,[m
[31m-                               blackPoints,[m
[31m-                               newMatrix);[m
[31m-    matrix_ = newMatrix;[m
[31m-[m
[31m-    // N.B.: these deletes are inadequate if anything between the new[m
[31m-    // and this point can throw.  As of this writing, it doesn't look[m
[31m-    // like they do.[m
[31m-[m
[31m-    delete [] blackPoints;[m
[31m-    delete [] luminances;[m
[31m-  } else {[m
[31m-    // If the image is too small, fall back to the global histogram approach.[m
[31m-    matrix_ = GlobalHistogramBinarizer::getBlackMatrix();[m
[31m-  }[m
[31m-  return matrix_;[m
[31m-}[m
[31m-[m
[31m-void[m
[31m-HybridBinarizer::calculateThresholdForBlock(unsigned char* luminances,[m
[31m-                                            int subWidth,[m
[31m-                                            int subHeight,[m
[31m-                                            int width,[m
[31m-                                            int height,[m
[31m-                                            int blackPoints[],[m
[31m-                                            Ref<BitMatrix> const& matrix) {[m
[31m-  for (int y = 0; y < subHeight; y++) {[m
[31m-    int yoffset = y << BLOCK_SIZE_POWER;[m
[31m-    if (yoffset + BLOCK_SIZE >= height) {[m
[31m-      yoffset = height - BLOCK_SIZE;[m
[31m-    }[m
[31m-    for (int x = 0; x < subWidth; x++) {[m
[31m-      int xoffset = x << BLOCK_SIZE_POWER;[m
[31m-      if (xoffset + BLOCK_SIZE >= width) {[m
[31m-        xoffset = width - BLOCK_SIZE;[m
[31m-      }[m
[31m-      int left = (x > 1) ? x : 2;[m
[31m-      left = (left < subWidth - 2) ? left : subWidth - 3;[m
[31m-      int top = (y > 1) ? y : 2;[m
[31m-      top = (top < subHeight - 2) ? top : subHeight - 3;[m
[31m-      int sum = 0;[m
[31m-      for (int z = -2; z <= 2; z++) {[m
[31m-        int *blackRow = &blackPoints[(top + z) * subWidth];[m
[31m-        sum += blackRow[left - 2];[m
[31m-        sum += blackRow[left - 1];[m
[31m-        sum += blackRow[left];[m
[31m-        sum += blackRow[left + 1];[m
[31m-        sum += blackRow[left + 2];[m
[31m-      }[m
[31m-      int average = sum / 25;[m
[31m-      threshold8x8Block(luminances, xoffset, yoffset, average, width, matrix);[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-void HybridBinarizer::threshold8x8Block(unsigned char* luminances,[m
[31m-                                        int xoffset,[m
[31m-                                        int yoffset,[m
[31m-                                        int threshold,[m
[31m-                                        int stride,[m
[31m-                                        Ref<BitMatrix> const& matrix) {[m
[31m-  for (int y = 0, offset = yoffset * stride + xoffset;[m
[31m-       y < BLOCK_SIZE;[m
[31m-       y++,  offset += stride) {[m
[31m-    for (int x = 0; x < BLOCK_SIZE; x++) {[m
[31m-      int pixel = luminances[offset + x] & 0xff;[m
[31m-      if (pixel <= threshold) {[m
[31m-        matrix->set(xoffset + x, yoffset + y);[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-namespace {[m
[31m-  inline int getBlackPointFromNeighbors(int* blackPoints, int subWidth, int x, int y) {[m
[31m-    return (blackPoints[(y-1)*subWidth+x] +[m
[31m-            2*blackPoints[y*subWidth+x-1] +[m
[31m-            blackPoints[(y-1)*subWidth+x-1]) >> 2;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-int* HybridBinarizer::calculateBlackPoints(unsigned char* luminances, int subWidth, int subHeight,[m
[31m-    int width, int height) {[m
[31m-  int *blackPoints = new int[subHeight * subWidth];[m
[31m-  for (int y = 0; y < subHeight; y++) {[m
[31m-    int yoffset = y << BLOCK_SIZE_POWER;[m
[31m-    if (yoffset + BLOCK_SIZE >= height) {[m
[31m-      yoffset = height - BLOCK_SIZE;[m
[31m-    }[m
[31m-    for (int x = 0; x < subWidth; x++) {[m
[31m-      int xoffset = x << BLOCK_SIZE_POWER;[m
[31m-      if (xoffset + BLOCK_SIZE >= width) {[m
[31m-        xoffset = width - BLOCK_SIZE;[m
[31m-      }[m
[31m-      int sum = 0;[m
[31m-      int min = 0xFF;[m
[31m-      int max = 0;[m
[31m-      for (int yy = 0, offset = yoffset * width + xoffset;[m
[31m-           yy < BLOCK_SIZE;[m
[31m-           yy++, offset += width) {[m
[31m-        for (int xx = 0; xx < BLOCK_SIZE; xx++) {[m
[31m-          int pixel = luminances[offset + xx] & 0xFF;[m
[31m-          sum += pixel;[m
[31m-          if (pixel < min) {[m
[31m-            min = pixel;[m
[31m-          }[m
[31m-          if (pixel > max) {[m
[31m-            max = pixel;[m
[31m-          }[m
[31m-        }[m
[31m-      }[m
[31m-[m
[31m-      // See[m
[31m-      // http://groups.google.com/group/zxing/browse_thread/thread/d06efa2c35a7ddc0[m
[31m-      int average = sum >> 6;[m
[31m-      if (max - min <= 24) {[m
[31m-        average = min >> 1;[m
[31m-        if (y > 0 && x > 0) {[m
[31m-          int bp = getBlackPointFromNeighbors(blackPoints, subWidth, x, y);[m
[31m-          if (min < bp) {[m
[31m-            average = bp;[m
[31m-          }[m
[31m-        }[m
[31m-      }[m
[31m-      blackPoints[y * subWidth + x] = average;[m
[31m-    }[m
[31m-  }[m
[31m-  return blackPoints;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// file: zxing/common/IllegalArgumentException.cpp[m
[31m-[m
[31m-/*[m
[31m- *  IllegalArgumentException.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 06/05/2008.[m
[31m- *  Copyright 2008 Google UK. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-IllegalArgumentException::IllegalArgumentException(const char *msg) :[m
[31m-    Exception(msg) {[m
[31m-}[m
[31m-IllegalArgumentException::~IllegalArgumentException() throw() {[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/PerspectiveTransform.cpp[m
[31m-[m
[31m-/*[m
[31m- *  PerspectiveTransform.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 12/05/2008.[m
[31m- *  Copyright 2008 Google UK. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/PerspectiveTransform.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-using namespace std;[m
[31m-[m
[31m-PerspectiveTransform::PerspectiveTransform(float inA11, float inA21,[m
[31m-                                           float inA31, float inA12,[m
[31m-                                           float inA22, float inA32,[m
[31m-                                           float inA13, float inA23,[m
[31m-                                           float inA33) :[m
[31m-  a11(inA11), a12(inA12), a13(inA13), a21(inA21), a22(inA22), a23(inA23),[m
[31m-  a31(inA31), a32(inA32), a33(inA33) {}[m
[31m-[m
[31m-Ref<PerspectiveTransform> PerspectiveTransform::quadrilateralToQuadrilateral(float x0, float y0, float x1, float y1,[m
[31m-    float x2, float y2, float x3, float y3, float x0p, float y0p, float x1p, float y1p, float x2p, float y2p,[m
[31m-    float x3p, float y3p) {[m
[31m-  Ref<PerspectiveTransform> qToS = PerspectiveTransform::quadrilateralToSquare(x0, y0, x1, y1, x2, y2, x3, y3);[m
[31m-  Ref<PerspectiveTransform> sToQ =[m
[31m-    PerspectiveTransform::squareToQuadrilateral(x0p, y0p, x1p, y1p, x2p, y2p, x3p, y3p);[m
[31m-  return sToQ->times(qToS);[m
[31m-}[m
[31m-[m
[31m-Ref<PerspectiveTransform> PerspectiveTransform::squareToQuadrilateral(float x0, float y0, float x1, float y1, float x2,[m
[31m-    float y2, float x3, float y3) {[m
[31m-  float dy2 = y3 - y2;[m
[31m-  float dy3 = y0 - y1 + y2 - y3;[m
[31m-  if (dy2 == 0.0f && dy3 == 0.0f) {[m
[31m-    Ref<PerspectiveTransform> result(new PerspectiveTransform(x1 - x0, x2 - x1, x0, y1 - y0, y2 - y1, y0, 0.0f,[m
[31m-                                     0.0f, 1.0f));[m
[31m-    return result;[m
[31m-  } else {[m
[31m-    float dx1 = x1 - x2;[m
[31m-    float dx2 = x3 - x2;[m
[31m-    float dx3 = x0 - x1 + x2 - x3;[m
[31m-    float dy1 = y1 - y2;[m
[31m-    float denominator = dx1 * dy2 - dx2 * dy1;[m
[31m-    float a13 = (dx3 * dy2 - dx2 * dy3) / denominator;[m
[31m-    float a23 = (dx1 * dy3 - dx3 * dy1) / denominator;[m
[31m-    Ref<PerspectiveTransform> result(new PerspectiveTransform(x1 - x0 + a13 * x1, x3 - x0 + a23 * x3, x0, y1 - y0[m
[31m-                                     + a13 * y1, y3 - y0 + a23 * y3, y0, a13, a23, 1.0f));[m
[31m-    return result;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-Ref<PerspectiveTransform> PerspectiveTransform::quadrilateralToSquare(float x0, float y0, float x1, float y1, float x2,[m
[31m-    float y2, float x3, float y3) {[m
[31m-  // Here, the adjoint serves as the inverse:[m
[31m-  return squareToQuadrilateral(x0, y0, x1, y1, x2, y2, x3, y3)->buildAdjoint();[m
[31m-}[m
[31m-[m
[31m-Ref<PerspectiveTransform> PerspectiveTransform::buildAdjoint() {[m
[31m-  // Adjoint is the transpose of the cofactor matrix:[m
[31m-  Ref<PerspectiveTransform> result(new PerspectiveTransform(a22 * a33 - a23 * a32, a23 * a31 - a21 * a33, a21 * a32[m
[31m-                                   - a22 * a31, a13 * a32 - a12 * a33, a11 * a33 - a13 * a31, a12 * a31 - a11 * a32, a12 * a23 - a13 * a22,[m
[31m-                                   a13 * a21 - a11 * a23, a11 * a22 - a12 * a21));[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-Ref<PerspectiveTransform> PerspectiveTransform::times(Ref<PerspectiveTransform> other) {[m
[31m-  Ref<PerspectiveTransform> result(new PerspectiveTransform(a11 * other->a11 + a21 * other->a12 + a31 * other->a13,[m
[31m-                                   a11 * other->a21 + a21 * other->a22 + a31 * other->a23, a11 * other->a31 + a21 * other->a32 + a31[m
[31m-                                   * other->a33, a12 * other->a11 + a22 * other->a12 + a32 * other->a13, a12 * other->a21 + a22[m
[31m-                                   * other->a22 + a32 * other->a23, a12 * other->a31 + a22 * other->a32 + a32 * other->a33, a13[m
[31m-                                   * other->a11 + a23 * other->a12 + a33 * other->a13, a13 * other->a21 + a23 * other->a22 + a33[m
[31m-                                   * other->a23, a13 * other->a31 + a23 * other->a32 + a33 * other->a33));[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-void PerspectiveTransform::transformPoints(vector<float> &points) {[m
[31m-  int max = points.size();[m
[31m-  for (int i = 0; i < max; i += 2) {[m
[31m-    float x = points[i];[m
[31m-    float y = points[i + 1];[m
[31m-    float denominator = a13 * x + a23 * y + a33;[m
[31m-    points[i] = (a11 * x + a21 * y + a31) / denominator;[m
[31m-    points[i + 1] = (a12 * x + a22 * y + a32) / denominator;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-ostream& operator<<(ostream& out, const PerspectiveTransform &pt) {[m
[31m-  out << pt.a11 << ", " << pt.a12 << ", " << pt.a13 << ", \n";[m
[31m-  out << pt.a21 << ", " << pt.a22 << ", " << pt.a23 << ", \n";[m
[31m-  out << pt.a31 << ", " << pt.a32 << ", " << pt.a33 << "\n";[m
[31m-  return out;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/Str.cpp[m
[31m-[m
[31m-/*[m
[31m- *  String.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 20/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Str.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-using namespace std;[m
[31m-[m
[31m-String::String(const std::string &text) :[m
[31m-    text_(text) {[m
[31m-}[m
[31m-const std::string& String::getText() const {[m
[31m-  return text_;[m
[31m-}[m
[31m-[m
[31m-ostream &operator<<(ostream &out, const String &s) {[m
[31m-  out << s.text_;[m
[31m-  return out;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/StringUtils.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-[m
[31m-/*[m
[31m- * Copyright (C) 2010-2011 ZXing authors[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/StringUtils.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-[m
[31m-using namespace std;[m
[31m-using namespace zxing;[m
[31m-using namespace zxing::common;[m
[31m-[m
[31m-// N.B.: these are the iconv strings for at least some versions of iconv[m
[31m-[m
[31m-char const* const StringUtils::PLATFORM_DEFAULT_ENCODING = "UTF-8";[m
[31m-char const* const StringUtils::ASCII = "ASCII";[m
[31m-char const* const StringUtils::SHIFT_JIS = "SHIFT_JIS";[m
[31m-char const* const StringUtils::GB2312 = "GBK";[m
[31m-char const* const StringUtils::EUC_JP = "EUC-JP";[m
[31m-char const* const StringUtils::UTF8 = "UTF-8";[m
[31m-char const* const StringUtils::ISO88591 = "ISO8859-1";[m
[31m-const bool StringUtils::ASSUME_SHIFT_JIS = false;[m
[31m-[m
[31m-string[m
[31m-StringUtils::guessEncoding(unsigned char* bytes, int length, Hashtable const& hints) {[m
[31m-  Hashtable::const_iterator i = hints.find(DecodeHints::CHARACTER_SET);[m
[31m-  if (i != hints.end()) {[m
[31m-    return i->second;[m
[31m-  }[m
[31m-  // Does it start with the UTF-8 byte order mark? then guess it's UTF-8[m
[31m-  if (length > 3 &&[m
[31m-      bytes[0] == (unsigned char) 0xEF &&[m
[31m-      bytes[1] == (unsigned char) 0xBB &&[m
[31m-      bytes[2] == (unsigned char) 0xBF) {[m
[31m-    return UTF8;[m
[31m-  }[m
[31m-  // For now, merely tries to distinguish ISO-8859-1, UTF-8 and Shift_JIS,[m
[31m-  // which should be by far the most common encodings. ISO-8859-1[m
[31m-  // should not have bytes in the 0x80 - 0x9F range, while Shift_JIS[m
[31m-  // uses this as a first byte of a two-byte character. If we see this[m
[31m-  // followed by a valid second byte in Shift_JIS, assume it is Shift_JIS.[m
[31m-  // If we see something else in that second byte, we'll make the risky guess[m
[31m-  // that it's UTF-8.[m
[31m-  bool canBeISO88591 = true;[m
[31m-  bool canBeShiftJIS = true;[m
[31m-  bool canBeUTF8 = true;[m
[31m-  int utf8BytesLeft = 0;[m
[31m-  int maybeDoubleByteCount = 0;[m
[31m-  int maybeSingleByteKatakanaCount = 0;[m
[31m-  bool sawLatin1Supplement = false;[m
[31m-  bool sawUTF8Start = false;[m
[31m-  bool lastWasPossibleDoubleByteStart = false;[m
[31m-[m
[31m-  for (int i = 0;[m
[31m-       i < length && (canBeISO88591 || canBeShiftJIS || canBeUTF8);[m
[31m-       i++) {[m
[31m-[m
[31m-    int value = bytes[i] & 0xFF;[m
[31m-[m
[31m-    // UTF-8 stuff[m
[31m-    if (value >= 0x80 && value <= 0xBF) {[m
[31m-      if (utf8BytesLeft > 0) {[m
[31m-        utf8BytesLeft--;[m
[31m-      }[m
[31m-    } else {[m
[31m-      if (utf8BytesLeft > 0) {[m
[31m-        canBeUTF8 = false;[m
[31m-      }[m
[31m-      if (value >= 0xC0 && value <= 0xFD) {[m
[31m-        sawUTF8Start = true;[m
[31m-        int valueCopy = value;[m
[31m-        while ((valueCopy & 0x40) != 0) {[m
[31m-          utf8BytesLeft++;[m
[31m-          valueCopy <<= 1;[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    // ISO-8859-1 stuff[m
[31m-[m
[31m-    if ((value == 0xC2 || value == 0xC3) && i < length - 1) {[m
[31m-      // This is really a poor hack. The slightly more exotic characters people might want to put in[m
[31m-      // a QR Code, by which I mean the Latin-1 supplement characters (e.g. u-umlaut) have encodings[m
[31m-      // that start with 0xC2 followed by [0xA0,0xBF], or start with 0xC3 followed by [0x80,0xBF].[m
[31m-      int nextValue = bytes[i + 1] & 0xFF;[m
[31m-      if (nextValue <= 0xBF &&[m
[31m-          ((value == 0xC2 && nextValue >= 0xA0) || (value == 0xC3 && nextValue >= 0x80))) {[m
[31m-        sawLatin1Supplement = true;[m
[31m-      }[m
[31m-    }[m
[31m-    if (value >= 0x7F && value <= 0x9F) {[m
[31m-      canBeISO88591 = false;[m
[31m-    }[m
[31m-[m
[31m-    // Shift_JIS stuff[m
[31m-[m
[31m-    if (value >= 0xA1 && value <= 0xDF) {[m
[31m-      // count the number of characters that might be a Shift_JIS single-byte Katakana character[m
[31m-      if (!lastWasPossibleDoubleByteStart) {[m
[31m-        maybeSingleByteKatakanaCount++;[m
[31m-      }[m
[31m-    }[m
[31m-    if (!lastWasPossibleDoubleByteStart &&[m
[31m-        ((value >= 0xF0 && value <= 0xFF) || value == 0x80 || value == 0xA0)) {[m
[31m-      canBeShiftJIS = false;[m
[31m-    }[m
[31m-    if ((value >= 0x81 && value <= 0x9F) || (value >= 0xE0 && value <= 0xEF)) {[m
[31m-      // These start double-byte characters in Shift_JIS. Let's see if it's followed by a valid[m
[31m-      // second byte.[m
[31m-      if (lastWasPossibleDoubleByteStart) {[m
[31m-        // If we just checked this and the last byte for being a valid double-byte[m
[31m-        // char, don't check starting on this byte. If this and the last byte[m
[31m-        // formed a valid pair, then this shouldn't be checked to see if it starts[m
[31m-        // a double byte pair of course.[m
[31m-        lastWasPossibleDoubleByteStart = false;[m
[31m-      } else {[m
[31m-        // ... otherwise do check to see if this plus the next byte form a valid[m
[31m-        // double byte pair encoding a character.[m
[31m-        lastWasPossibleDoubleByteStart = true;[m
[31m-        if (i >= length - 1) {[m
[31m-          canBeShiftJIS = false;[m
[31m-        } else {[m
[31m-          int nextValue = bytes[i + 1] & 0xFF;[m
[31m-          if (nextValue < 0x40 || nextValue > 0xFC) {[m
[31m-            canBeShiftJIS = false;[m
[31m-          } else {[m
[31m-            maybeDoubleByteCount++;[m
[31m-          }[m
[31m-          // There is some conflicting information out there about which bytes can follow which in[m
[31m-          // double-byte Shift_JIS characters. The rule above seems to be the one that matches practice.[m
[31m-        }[m
[31m-      }[m
[31m-    } else {[m
[31m-      lastWasPossibleDoubleByteStart = false;[m
[31m-    }[m
[31m-  }[m
[31m-  if (utf8BytesLeft > 0) {[m
[31m-    canBeUTF8 = false;[m
[31m-  }[m
[31m-[m
[31m-  // Easy -- if assuming Shift_JIS and no evidence it can't be, done[m
[31m-  if (canBeShiftJIS && ASSUME_SHIFT_JIS) {[m
[31m-    return SHIFT_JIS;[m
[31m-  }[m
[31m-  if (canBeUTF8 && sawUTF8Start) {[m
[31m-    return UTF8;[m
[31m-  }[m
[31m-  // Distinguishing Shift_JIS and ISO-8859-1 can be a little tough. The crude heuristic is:[m
[31m-  // - If we saw[m
[31m-  //   - at least 3 bytes that starts a double-byte value (bytes that are rare in ISO-8859-1), or[m
[31m-  //   - over 5% of bytes could be single-byte Katakana (also rare in ISO-8859-1),[m
[31m-  // - and, saw no sequences that are invalid in Shift_JIS, then we conclude Shift_JIS[m
[31m-  if (canBeShiftJIS && (maybeDoubleByteCount >= 3 || 20 * maybeSingleByteKatakanaCount > length)) {[m
[31m-    return SHIFT_JIS;[m
[31m-  }[m
[31m-  // Otherwise, we default to ISO-8859-1 unless we know it can't be[m
[31m-  if (!sawLatin1Supplement && canBeISO88591) {[m
[31m-    return ISO88591;[m
[31m-  }[m
[31m-  // Otherwise, we take a wild guess with platform encoding[m
[31m-  return PLATFORM_DEFAULT_ENCODING;[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/detector/MonochromeRectangleDetector.cpp[m
[31m-[m
[31m-/*[m
[31m- *  MonochromeRectangleDetector.cpp[m
[31m- *  y_wmk[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 y_wmk authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/NotFoundException.h>[m
[31m-// #include <zxing/common/detector/MonochromeRectangleDetector.h>[m
[31m-// #include <sstream>[m
[31m-[m
[31m-namespace zxing {[m
[31m-using namespace std;[m
[31m-[m
[31m-std::vector<Ref<ResultPoint> > MonochromeRectangleDetector::detect() {[m
[31m-    int height = image_->getHeight();[m
[31m-    int width = image_->getWidth();[m
[31m-    int halfHeight = height >> 1;[m
[31m-    int halfWidth = width >> 1;[m
[31m-    int deltaY = max(1, height / (MAX_MODULES << 3));[m
[31m-    int deltaX = max(1, width / (MAX_MODULES << 3));[m
[31m-[m
[31m-    int top = 0;[m
[31m-    int bottom = height;[m
[31m-    int left = 0;[m
[31m-    int right = width;[m
[31m-    Ref<ResultPoint> pointA(findCornerFromCenter(halfWidth, 0, left, right,[m
[31m-        halfHeight, -deltaY, top, bottom, halfWidth >> 1));[m
[31m-    top = (int) pointA->getY() - 1;;[m
[31m-    Ref<ResultPoint> pointB(findCornerFromCenter(halfWidth, -deltaX, left, right,[m
[31m-        halfHeight, 0, top, bottom, halfHeight >> 1));[m
[31m-    left = (int) pointB->getX() - 1;[m
[31m-    Ref<ResultPoint> pointC(findCornerFromCenter(halfWidth, deltaX, left, right,[m
[31m-        halfHeight, 0, top, bottom, halfHeight >> 1));[m
[31m-    right = (int) pointC->getX() + 1;[m
[31m-    Ref<ResultPoint> pointD(findCornerFromCenter(halfWidth, 0, left, right,[m
[31m-        halfHeight, deltaY, top, bottom, halfWidth >> 1));[m
[31m-    bottom = (int) pointD->getY() + 1;[m
[31m-[m
[31m-    // Go try to find point A again with better information -- might have been off at first.[m
[31m-    pointA.reset(findCornerFromCenter(halfWidth, 0, left, right,[m
[31m-        halfHeight, -deltaY, top, bottom, halfWidth >> 2));[m
[31m-[m
[31m-	  std::vector<Ref<ResultPoint> > corners(4);[m
[31m-  	corners[0].reset(pointA);[m
[31m-  	corners[1].reset(pointB);[m
[31m-  	corners[2].reset(pointC);[m
[31m-  	corners[3].reset(pointD);[m
[31m-    return corners;[m
[31m-  }[m
[31m-[m
[31m-Ref<ResultPoint> MonochromeRectangleDetector::findCornerFromCenter(int centerX, int deltaX, int left, int right,[m
[31m-      int centerY, int deltaY, int top, int bottom, int maxWhiteRun) {[m
[31m-	  Ref<TwoInts> lastRange(NULL);[m
[31m-    for (int y = centerY, x = centerX;[m
[31m-         y < bottom && y >= top && x < right && x >= left;[m
[31m-         y += deltaY, x += deltaX) {[m
[31m-      Ref<TwoInts> range(NULL);[m
[31m-      if (deltaX == 0) {[m
[31m-        // horizontal slices, up and down[m
[31m-        range = blackWhiteRange(y, maxWhiteRun, left, right, true);[m
[31m-      } else {[m
[31m-        // vertical slices, left and right[m
[31m-        range = blackWhiteRange(x, maxWhiteRun, top, bottom, false);[m
[31m-      }[m
[31m-      if (range == NULL) {[m
[31m-        if (lastRange == NULL) {[m
[31m-			    throw NotFoundException("Couldn't find corners (lastRange = NULL) ");[m
[31m-        } else {[m
[31m-        // lastRange was found[m
[31m-        if (deltaX == 0) {[m
[31m-          int lastY = y - deltaY;[m
[31m-          if (lastRange->start < centerX) {[m
[31m-            if (lastRange->end > centerX) {[m
[31m-              // straddle, choose one or the other based on direction[m
[31m-			        Ref<ResultPoint> result(new ResultPoint(deltaY > 0 ? lastRange->start : lastRange->end, lastY));[m
[31m-			        return result;[m
[31m-            }[m
[31m-			      Ref<ResultPoint> result(new ResultPoint(lastRange->start, lastY));[m
[31m-			      return result;[m
[31m-          } else {[m
[31m-			      Ref<ResultPoint> result(new ResultPoint(lastRange->end, lastY));[m
[31m-			      return result;[m
[31m-            }[m
[31m-        } else {[m
[31m-          int lastX = x - deltaX;[m
[31m-          if (lastRange->start < centerY) {[m
[31m-            if (lastRange->end > centerY) {[m
[31m-			        Ref<ResultPoint> result(new ResultPoint(lastX, deltaX < 0 ? lastRange->start : lastRange->end));[m
[31m-			        return result;[m
[31m-            }[m
[31m-			      Ref<ResultPoint> result(new ResultPoint(lastX, lastRange->start));[m
[31m-			      return result;[m
[31m-          } else {[m
[31m-			      Ref<ResultPoint> result(new ResultPoint(lastX, lastRange->end));[m
[31m-			      return result;[m
[31m-            }[m
[31m-          }[m
[31m-        }[m
[31m-      }[m
[31m-      lastRange = range;[m
[31m-    }[m
[31m-    throw NotFoundException("Couldn't find corners");[m
[31m-  }[m
[31m-[m
[31m-Ref<TwoInts> MonochromeRectangleDetector::blackWhiteRange(int fixedDimension, int maxWhiteRun, int minDim, int maxDim,[m
[31m-      bool horizontal) {[m
[31m-[m
[31m-	  int center = (minDim + maxDim) >> 1;[m
[31m-[m
[31m-    // Scan left/up first[m
[31m-    int start = center;[m
[31m-    while (start >= minDim) {[m
[31m-      if (horizontal ? image_->get(start, fixedDimension) : image_->get(fixedDimension, start)) {[m
[31m-        start--;[m
[31m-      } else {[m
[31m-        int whiteRunStart = start;[m
[31m-        do {[m
[31m-          start--;[m
[31m-        } while (start >= minDim && !(horizontal ? image_->get(start, fixedDimension) :[m
[31m-            image_->get(fixedDimension, start)));[m
[31m-        int whiteRunSize = whiteRunStart - start;[m
[31m-        if (start < minDim || whiteRunSize > maxWhiteRun) {[m
[31m-          start = whiteRunStart;[m
[31m-          break;[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-    start++;[m
[31m-[m
[31m-    // Then try right/down[m
[31m-    int end = center;[m
[31m-    while (end < maxDim) {[m
[31m-      if (horizontal ? image_->get(end, fixedDimension) : image_->get(fixedDimension, end)) {[m
[31m-        end++;[m
[31m-      } else {[m
[31m-        int whiteRunStart = end;[m
[31m-        do {[m
[31m-          end++;[m
[31m-        } while (end < maxDim && !(horizontal ? image_->get(end, fixedDimension) :[m
[31m-            image_->get(fixedDimension, end)));[m
[31m-        int whiteRunSize = end - whiteRunStart;[m
[31m-        if (end >= maxDim || whiteRunSize > maxWhiteRun) {[m
[31m-          end = whiteRunStart;[m
[31m-          break;[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-    end--;[m
[31m-    Ref<TwoInts> result(NULL);[m
[31m-    if (end > start) {[m
[31m-		  result = new TwoInts;[m
[31m-      result->start = start;[m
[31m-      result->end = end;[m
[31m-    }[m
[31m-    return result;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/detector/WhiteRectangleDetector.cpp[m
[31m-[m
[31m-/*[m
[31m- *  WhiteRectangleDetector.cpp[m
[31m- *  y_wmk[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 y_wmk authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/NotFoundException.h>[m
[31m-// #include <zxing/common/detector/WhiteRectangleDetector.h>[m
[31m-// #include <math.h>[m
[31m-// #include <sstream>[m
[31m-[m
[31m-namespace zxing {[m
[31m-using namespace std;[m
[31m-[m
[31m-int WhiteRectangleDetector::INIT_SIZE = 30;[m
[31m-int WhiteRectangleDetector::CORR = 1;[m
[31m-[m
[31m-[m
[31m-WhiteRectangleDetector::WhiteRectangleDetector(Ref<BitMatrix> image) : image_(image) {[m
[31m-  width_ = image->getWidth();[m
[31m-  height_ = image->getHeight();[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * <p>[m
[31m- * Detects a candidate barcode-like rectangular region within an image. It[m
[31m- * starts around the center of the image, increases the size of the candidate[m
[31m- * region until it finds a white rectangular region.[m
[31m- * </p>[m
[31m- *[m
[31m- * @return {@link vector<Ref<ResultPoint> >} describing the corners of the rectangular[m
[31m- *         region. The first and last points are opposed on the diagonal, as[m
[31m- *         are the second and third. The first point will be the topmost[m
[31m- *         point and the last, the bottommost. The second point will be[m
[31m- *         leftmost and the third, the rightmost[m
[31m- * @throws NotFoundException if no Data Matrix Code can be found[m
[31m-*/[m
[31m-std::vector<Ref<ResultPoint> > WhiteRectangleDetector::detect() {[m
[31m-  int left = (width_ - INIT_SIZE) >> 1;[m
[31m-  int right = (width_ + INIT_SIZE) >> 1;[m
[31m-  int up = (height_ - INIT_SIZE) >> 1;[m
[31m-  int down = (height_ + INIT_SIZE) >> 1;[m
[31m-  if (up < 0 || left < 0 || down >= height_ || right >= width_) {[m
[31m-    throw NotFoundException("Invalid dimensions WhiteRectangleDetector");[m
[31m-  }[m
[31m-[m
[31m-  bool sizeExceeded = false;[m
[31m-  bool aBlackPointFoundOnBorder = true;[m
[31m-  bool atLeastOneBlackPointFoundOnBorder = false;[m
[31m-[m
[31m-  while (aBlackPointFoundOnBorder) {[m
[31m-    aBlackPointFoundOnBorder = false;[m
[31m-[m
[31m-    // .....[m
[31m-    // .   |[m
[31m-    // .....[m
[31m-    bool rightBorderNotWhite = true;[m
[31m-    while (rightBorderNotWhite && right < width_) {[m
[31m-      rightBorderNotWhite = containsBlackPoint(up, down, right, false);[m
[31m-      if (rightBorderNotWhite) {[m
[31m-        right++;[m
[31m-        aBlackPointFoundOnBorder = true;[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    if (right >= width_) {[m
[31m-      sizeExceeded = true;[m
[31m-      break;[m
[31m-    }[m
[31m-[m
[31m-    // .....[m
[31m-    // .   .[m
[31m-    // .___.[m
[31m-    bool bottomBorderNotWhite = true;[m
[31m-    while (bottomBorderNotWhite && down < height_) {[m
[31m-      bottomBorderNotWhite = containsBlackPoint(left, right, down, true);[m
[31m-      if (bottomBorderNotWhite) {[m
[31m-        down++;[m
[31m-        aBlackPointFoundOnBorder = true;[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    if (down >= height_) {[m
[31m-      sizeExceeded = true;[m
[31m-      break;[m
[31m-    }[m
[31m-[m
[31m-    // .....[m
[31m-    // |   .[m
[31m-    // .....[m
[31m-    bool leftBorderNotWhite = true;[m
[31m-    while (leftBorderNotWhite && left >= 0) {[m
[31m-      leftBorderNotWhite = containsBlackPoint(up, down, left, false);[m
[31m-      if (leftBorderNotWhite) {[m
[31m-        left--;[m
[31m-        aBlackPointFoundOnBorder = true;[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    if (left < 0) {[m
[31m-      sizeExceeded = true;[m
[31m-      break;[m
[31m-    }[m
[31m-[m
[31m-    // .___.[m
[31m-    // .   .[m
[31m-    // .....[m
[31m-    bool topBorderNotWhite = true;[m
[31m-    while (topBorderNotWhite && up >= 0) {[m
[31m-      topBorderNotWhite = containsBlackPoint(left, right, up, true);[m
[31m-      if (topBorderNotWhite) {[m
[31m-        up--;[m
[31m-        aBlackPointFoundOnBorder = true;[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    if (up < 0) {[m
[31m-      sizeExceeded = true;[m
[31m-      break;[m
[31m-    }[m
[31m-[m
[31m-    if (aBlackPointFoundOnBorder) {[m
[31m-      atLeastOneBlackPointFoundOnBorder = true;[m
[31m-    }[m
[31m-[m
[31m-  }[m
[31m-  if (!sizeExceeded && atLeastOneBlackPointFoundOnBorder) {[m
[31m-[m
[31m-    int maxSize = right - left;[m
[31m-[m
[31m-    Ref<ResultPoint> z(NULL);[m
[31m-    //go up right[m
[31m-    for (int i = 1; i < maxSize; i++) {[m
[31m-      z = getBlackPointOnSegment(left, down - i, left + i, down);[m
[31m-      if (z != NULL) {[m
[31m-        break;[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    if (z == NULL) {[m
[31m-      throw NotFoundException("z == NULL");[m
[31m-    }[m
[31m-[m
[31m-    Ref<ResultPoint> t(NULL);[m
[31m-    //go down right[m
[31m-    for (int i = 1; i < maxSize; i++) {[m
[31m-      t = getBlackPointOnSegment(left, up + i, left + i, up);[m
[31m-      if (t != NULL) {[m
[31m-        break;[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    if (t == NULL) {[m
[31m-      throw NotFoundException("t == NULL");[m
[31m-    }[m
[31m-[m
[31m-    Ref<ResultPoint> x(NULL);[m
[31m-    //go down left[m
[31m-    for (int i = 1; i < maxSize; i++) {[m
[31m-      x = getBlackPointOnSegment(right, up + i, right - i, up);[m
[31m-      if (x != NULL) {[m
[31m-        break;[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    if (x == NULL) {[m
[31m-      throw NotFoundException("x == NULL");[m
[31m-    }[m
[31m-[m
[31m-    Ref<ResultPoint> y(NULL);[m
[31m-    //go up left[m
[31m-    for (int i = 1; i < maxSize; i++) {[m
[31m-      y = getBlackPointOnSegment(right, down - i, right - i, down);[m
[31m-      if (y != NULL) {[m
[31m-        break;[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    if (y == NULL) {[m
[31m-      throw NotFoundException("y == NULL");[m
[31m-    }[m
[31m-[m
[31m-    return centerEdges(y, z, x, t);[m
[31m-[m
[31m-  } else {[m
[31m-    throw NotFoundException("No black point found on border");[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * Ends up being a bit faster than Math.round(). This merely rounds its[m
[31m- * argument to the nearest int, where x.5 rounds up.[m
[31m- */[m
[31m-int WhiteRectangleDetector::round(float d) {[m
[31m-  return (int) (d + 0.5f);[m
[31m-}[m
[31m-[m
[31m-Ref<ResultPoint> WhiteRectangleDetector::getBlackPointOnSegment(float aX, float aY, float bX, float bY) {[m
[31m-  int dist = distanceL2(aX, aY, bX, bY);[m
[31m-  float xStep = (bX - aX) / dist;[m
[31m-  float yStep = (bY - aY) / dist;[m
[31m-  for (int i = 0; i < dist; i++) {[m
[31m-    int x = round(aX + i * xStep);[m
[31m-    int y = round(aY + i * yStep);[m
[31m-    if (image_->get(x, y)) {[m
[31m-      Ref<ResultPoint> point(new ResultPoint(x, y));[m
[31m-      return point;[m
[31m-    }[m
[31m-  }[m
[31m-  Ref<ResultPoint> point(NULL);[m
[31m-  return point;[m
[31m-}[m
[31m-[m
[31m-int WhiteRectangleDetector::distanceL2(float aX, float aY, float bX, float bY) {[m
[31m-  float xDiff = aX - bX;[m
[31m-  float yDiff = aY - bY;[m
[31m-  return round((float)sqrt(xDiff * xDiff + yDiff * yDiff));[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * recenters the points of a constant distance towards the center[m
[31m- *[m
[31m- * @param y bottom most point[m
[31m- * @param z left most point[m
[31m- * @param x right most point[m
[31m- * @param t top most point[m
[31m- * @return {@link vector<Ref<ResultPoint> >} describing the corners of the rectangular[m
[31m- *         region. The first and last points are opposed on the diagonal, as[m
[31m- *         are the second and third. The first point will be the topmost[m
[31m- *         point and the last, the bottommost. The second point will be[m
[31m- *         leftmost and the third, the rightmost[m
[31m- */[m
[31m-vector<Ref<ResultPoint> > WhiteRectangleDetector::centerEdges(Ref<ResultPoint> y, Ref<ResultPoint> z,[m
[31m-                                  Ref<ResultPoint> x, Ref<ResultPoint> t) {[m
[31m-[m
[31m-  //[m
[31m-  //       t            t[m
[31m-  //  z                      x[m
[31m-  //        x    OR    z[m
[31m-  //   y                    y[m
[31m-  //[m
[31m-[m
[31m-  float yi = y->getX();[m
[31m-  float yj = y->getY();[m
[31m-  float zi = z->getX();[m
[31m-  float zj = z->getY();[m
[31m-  float xi = x->getX();[m
[31m-  float xj = x->getY();[m
[31m-  float ti = t->getX();[m
[31m-  float tj = t->getY();[m
[31m-[m
[31m-  std::vector<Ref<ResultPoint> > corners(4);[m
[31m-  if (yi < (float)width_/2) {[m
[31m-    Ref<ResultPoint> pointA(new ResultPoint(ti - CORR, tj + CORR));[m
[31m-    Ref<ResultPoint> pointB(new ResultPoint(zi + CORR, zj + CORR));[m
[31m-    Ref<ResultPoint> pointC(new ResultPoint(xi - CORR, xj - CORR));[m
[31m-    Ref<ResultPoint> pointD(new ResultPoint(yi + CORR, yj - CORR));[m
[31m-	  corners[0].reset(pointA);[m
[31m-	  corners[1].reset(pointB);[m
[31m-	  corners[2].reset(pointC);[m
[31m-	  corners[3].reset(pointD);[m
[31m-  } else {[m
[31m-    Ref<ResultPoint> pointA(new ResultPoint(ti + CORR, tj + CORR));[m
[31m-    Ref<ResultPoint> pointB(new ResultPoint(zi + CORR, zj - CORR));[m
[31m-    Ref<ResultPoint> pointC(new ResultPoint(xi - CORR, xj + CORR));[m
[31m-    Ref<ResultPoint> pointD(new ResultPoint(yi - CORR, yj - CORR));[m
[31m-	  corners[0].reset(pointA);[m
[31m-	  corners[1].reset(pointB);[m
[31m-	  corners[2].reset(pointC);[m
[31m-	  corners[3].reset(pointD);[m
[31m-  }[m
[31m-  return corners;[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * Determines whether a segment contains a black point[m
[31m- *[m
[31m- * @param a          min value of the scanned coordinate[m
[31m- * @param b          max value of the scanned coordinate[m
[31m- * @param fixed      value of fixed coordinate[m
[31m- * @param horizontal set to true if scan must be horizontal, false if vertical[m
[31m- * @return true if a black point has been found, else false.[m
[31m- */[m
[31m-bool WhiteRectangleDetector::containsBlackPoint(int a, int b, int fixed, bool horizontal) {[m
[31m-  if (horizontal) {[m
[31m-    for (int x = a; x <= b; x++) {[m
[31m-      if (image_->get(x, fixed)) {[m
[31m-        return true;[m
[31m-      }[m
[31m-    }[m
[31m-  } else {[m
[31m-    for (int y = a; y <= b; y++) {[m
[31m-      if (image_->get(fixed, y)) {[m
[31m-        return true;[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  return false;[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/reedsolomon/GF256.cpp[m
[31m-[m
[31m-/*[m
[31m- *  GF256.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 05/05/2008.[m
[31m- *  Copyright 2008 Google UK. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <vector>[m
[31m-// #include <iostream>[m
[31m-// #include <zxing/common/reedsolomon/GF256.h>[m
[31m-// #include <zxing/common/reedsolomon/GF256Poly.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-using namespace std;[m
[31m-[m
[31m-static inline ArrayRef<int> makeArray(int value) {[m
[31m-  ArrayRef<int> valuesRef(new Array<int> (value, 1));[m
[31m-  return valuesRef;[m
[31m-}[m
[31m-[m
[31m-static inline Ref<GF256Poly> refPoly(GF256 &field, int value) {[m
[31m-  ArrayRef<int> values(makeArray(value));[m
[31m-  Ref<GF256Poly> result(new GF256Poly(field, values));[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-GF256::GF256(int primitive) :[m
[31m-    exp_(256, (const int)0), log_(256, (const int)0), zero_(refPoly(*this, 0)), one_(refPoly(*this, 1)) {[m
[31m-  int x = 1;[m
[31m-  for (int i = 0; i < 256; i++) {[m
[31m-    exp_[i] = x;[m
[31m-    x <<= 1;[m
[31m-    if (x >= 0x100) {[m
[31m-      x ^= primitive;[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  // log(0) == 0, but should never be used[m
[31m-  log_[0] = 0;[m
[31m-  for (int i = 0; i < 255; i++) {[m
[31m-    log_[exp_[i]] = i;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-Ref<GF256Poly> GF256::getZero() {[m
[31m-  return zero_;[m
[31m-}[m
[31m-[m
[31m-Ref<GF256Poly> GF256::getOne() {[m
[31m-  return one_;[m
[31m-}[m
[31m-[m
[31m-Ref<GF256Poly> GF256::buildMonomial(int degree, int coefficient) {[m
[31m-#ifdef DEBUG[m
[31m-  cout << __FUNCTION__ << "\n";[m
[31m-#endif[m
[31m-  if (degree < 0) {[m
[31m-    throw IllegalArgumentException("Degree must be non-negative");[m
[31m-  }[m
[31m-  if (coefficient == 0) {[m
[31m-    return zero_;[m
[31m-  }[m
[31m-  int nCoefficients = degree + 1;[m
[31m-  ArrayRef<int> coefficients(new Array<int> (nCoefficients));[m
[31m-  coefficients[0] = coefficient;[m
[31m-  Ref<GF256Poly> result(new GF256Poly(*this, coefficients));[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-int GF256::addOrSubtract(int a, int b) {[m
[31m-  return a ^ b;[m
[31m-}[m
[31m-[m
[31m-int GF256::exp(int a) {[m
[31m-  return exp_[a];[m
[31m-}[m
[31m-[m
[31m-int GF256::log(int a) {[m
[31m-  if (a == 0) {[m
[31m-    throw IllegalArgumentException("Cannot take the logarithm of 0");[m
[31m-  }[m
[31m-  return log_[a];[m
[31m-}[m
[31m-[m
[31m-int GF256::inverse(int a) {[m
[31m-  if (a == 0) {[m
[31m-    throw IllegalArgumentException("Cannot calculate the inverse of 0");[m
[31m-  }[m
[31m-  return exp_[255 - log_[a]];[m
[31m-}[m
[31m-[m
[31m-int GF256::multiply(int a, int b) {[m
[31m-  if (a == 0 || b == 0) {[m
[31m-    return 0;[m
[31m-  }[m
[31m-  int logSum = log_[a] + log_[b];[m
[31m-  // index is a sped-up alternative to logSum % 255 since sum[m
[31m-  // is in [0,510]. Thanks to jmsachs for the idea[m
[31m-  return exp_[(logSum & 0xFF) + (logSum >> 8)];[m
[31m-}[m
[31m-[m
[31m-GF256 GF256::QR_CODE_FIELD(0x011D); // x^8 + x^4 + x^3 + x^2 + 1[m
[31m-GF256 GF256::DATA_MATRIX_FIELD(0x012D); // x^8 + x^5 + x^3 + x^2 + 1[m
[31m-[m
[31m-ostream& operator<<(ostream& out, const GF256& field) {[m
[31m-  out << "Field[\nexp=(";[m
[31m-  out << field.exp_[0];[m
[31m-  for (int i = 1; i < 256; i++) {[m
[31m-    out << "," << field.exp_[i];[m
[31m-  }[m
[31m-  out << "),\nlog=(";[m
[31m-  out << field.log_[0];[m
[31m-  for (int i = 1; i < 256; i++) {[m
[31m-    out << "," << field.log_[i];[m
[31m-  }[m
[31m-  out << ")\n]";[m
[31m-  return out;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/reedsolomon/GF256Poly.cpp[m
[31m-[m
[31m-/*[m
[31m- *  GF256Poly.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 05/05/2008.[m
[31m- *  Copyright 2008 Google UK. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <iostream>[m
[31m-// #include <sstream>[m
[31m-// #include <zxing/common/reedsolomon/GF256Poly.h>[m
[31m-// #include <zxing/common/reedsolomon/GF256.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-using namespace std;[m
[31m-[m
[31m-void GF256Poly::fixCoefficients() {[m
[31m-  int coefficientsLength = coefficients.size();[m
[31m-  if (coefficientsLength > 1 && coefficients[0] == 0) {[m
[31m-    // Leading term must be non-zero for anything except[m
[31m-    // the constant polynomial "0"[m
[31m-    int firstNonZero = 1;[m
[31m-    while (firstNonZero < coefficientsLength && coefficients[firstNonZero] == 0) {[m
[31m-      firstNonZero++;[m
[31m-    }[m
[31m-    if (firstNonZero == coefficientsLength) {[m
[31m-      coefficientsLength = field.getZero()->coefficients.size();[m
[31m-      coefficients.reset(new Array<int> (coefficientsLength));[m
[31m-      *coefficients = *(field.getZero()->coefficients);[m
[31m-    } else {[m
[31m-      ArrayRef<int> c(coefficients);[m
[31m-      coefficientsLength -= firstNonZero;[m
[31m-      coefficients.reset(new Array<int> (coefficientsLength));[m
[31m-      for (int i = 0; i < coefficientsLength; i++) {[m
[31m-        coefficients[i] = c[i + firstNonZero];[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-GF256Poly::GF256Poly(GF256 &f, ArrayRef<int> c) :[m
[31m-    Counted(), field(f), coefficients(c) {[m
[31m-  fixCoefficients();[m
[31m-}[m
[31m-[m
[31m-GF256Poly::~GF256Poly() {[m
[31m-[m
[31m-}[m
[31m-[m
[31m-int GF256Poly::getDegree() {[m
[31m-  return coefficients.size() - 1;[m
[31m-}[m
[31m-[m
[31m-bool GF256Poly::isZero() {[m
[31m-  return coefficients[0] == 0;[m
[31m-}[m
[31m-[m
[31m-int GF256Poly::getCoefficient(int degree) {[m
[31m-  return coefficients[coefficients.size() - 1 - degree];[m
[31m-}[m
[31m-[m
[31m-int GF256Poly::evaluateAt(int a) {[m
[31m-  if (a == 0) {[m
[31m-    return getCoefficient(0);[m
[31m-  }[m
[31m-  int size = coefficients.size();[m
[31m-  if (a == 1) {[m
[31m-    // Just the sum of the coefficients[m
[31m-    int result = 0;[m
[31m-    for (int i = 0; i < size; i++) {[m
[31m-      result = GF256::addOrSubtract(result, coefficients[i]);[m
[31m-    }[m
[31m-    return result;[m
[31m-  }[m
[31m-  int result = coefficients[0];[m
[31m-  for (int i = 1; i < size; i++) {[m
[31m-    result = GF256::addOrSubtract(field.multiply(a, result), coefficients[i]);[m
[31m-  }[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-Ref<GF256Poly> GF256Poly::addOrSubtract(Ref<GF256Poly> b) {[m
[31m-  if (&field != &b->field) {[m
[31m-    throw IllegalArgumentException("Fields must be the same");[m
[31m-  }[m
[31m-  if (isZero()) {[m
[31m-    return b;[m
[31m-  }[m
[31m-  if (b->isZero()) {[m
[31m-    return Ref<GF256Poly>(this);[m
[31m-  }[m
[31m-[m
[31m-  ArrayRef<int> largerCoefficients = coefficients;[m
[31m-  ArrayRef<int> smallerCoefficients = b->coefficients;[m
[31m-  if (smallerCoefficients.size() > largerCoefficients.size()) {[m
[31m-    ArrayRef<int> tmp(smallerCoefficients);[m
[31m-    smallerCoefficients = largerCoefficients;[m
[31m-    largerCoefficients = tmp;[m
[31m-  }[m
[31m-[m
[31m-  ArrayRef<int> sumDiff(new Array<int> (largerCoefficients.size()));[m
[31m-[m
[31m-  unsigned lengthDiff = largerCoefficients.size() - smallerCoefficients.size();[m
[31m-  for (unsigned i = 0; i < lengthDiff; i++) {[m
[31m-    sumDiff[i] = largerCoefficients[i];[m
[31m-  }[m
[31m-  for (unsigned i = lengthDiff; i < largerCoefficients.size(); i++) {[m
[31m-    sumDiff[i] = GF256::addOrSubtract(smallerCoefficients[i - lengthDiff], largerCoefficients[i]);[m
[31m-  }[m
[31m-  return Ref<GF256Poly>(new GF256Poly(field, sumDiff));[m
[31m-}[m
[31m-[m
[31m-Ref<GF256Poly> GF256Poly::multiply(Ref<GF256Poly> b) {[m
[31m-  if (&field != &b->field) {[m
[31m-    throw IllegalArgumentException("Fields must be the same");[m
[31m-  }[m
[31m-  if (isZero() || b->isZero()) {[m
[31m-    return field.getZero();[m
[31m-  }[m
[31m-  ArrayRef<int> aCoefficients = coefficients;[m
[31m-  int aLength = aCoefficients.size();[m
[31m-  ArrayRef<int> bCoefficients = b->coefficients;[m
[31m-  int bLength = bCoefficients.size();[m
[31m-  int productLength = aLength + bLength - 1;[m
[31m-  ArrayRef<int> product(new Array<int> (productLength));[m
[31m-  for (int i = 0; i < aLength; i++) {[m
[31m-    int aCoeff = aCoefficients[i];[m
[31m-    for (int j = 0; j < bLength; j++) {[m
[31m-      product[i + j] = GF256::addOrSubtract(product[i + j], field.multiply(aCoeff, bCoefficients[j]));[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  return Ref<GF256Poly>(new GF256Poly(field, product));[m
[31m-}[m
[31m-[m
[31m-Ref<GF256Poly> GF256Poly::multiply(int scalar) {[m
[31m-  if (scalar == 0) {[m
[31m-    return field.getZero();[m
[31m-  }[m
[31m-  if (scalar == 1) {[m
[31m-    return Ref<GF256Poly>(this);[m
[31m-  }[m
[31m-  int size = coefficients.size();[m
[31m-  ArrayRef<int> product(new Array<int> (size));[m
[31m-  for (int i = 0; i < size; i++) {[m
[31m-    product[i] = field.multiply(coefficients[i], scalar);[m
[31m-  }[m
[31m-  return Ref<GF256Poly>(new GF256Poly(field, product));[m
[31m-}[m
[31m-[m
[31m-Ref<GF256Poly> GF256Poly::multiplyByMonomial(int degree, int coefficient) {[m
[31m-  if (degree < 0) {[m
[31m-    throw IllegalArgumentException("Degree must be non-negative");[m
[31m-  }[m
[31m-  if (coefficient == 0) {[m
[31m-    return field.getZero();[m
[31m-  }[m
[31m-  int size = coefficients.size();[m
[31m-  ArrayRef<int> product(new Array<int> (size + degree));[m
[31m-  for (int i = 0; i < size; i++) {[m
[31m-    product[i] = field.multiply(coefficients[i], coefficient);[m
[31m-  }[m
[31m-  return Ref<GF256Poly>(new GF256Poly(field, product));[m
[31m-}[m
[31m-[m
[31m-const char *GF256Poly::description() const {[m
[31m-  ostringstream result;[m
[31m-  result << *this;[m
[31m-  return result.str().c_str();[m
[31m-}[m
[31m-[m
[31m-ostream& operator<<(ostream& out, const GF256Poly& p) {[m
[31m-  GF256Poly &poly = const_cast<GF256Poly&>(p);[m
[31m-  out << "Poly[" << poly.coefficients.size() << "]";[m
[31m-  if (poly.coefficients.size() > 0) {[m
[31m-    out << "(" << poly.coefficients[0];[m
[31m-    for (unsigned i = 1; i < poly.coefficients.size(); i++) {[m
[31m-      out << "," << poly.coefficients[i];[m
[31m-    }[m
[31m-    out << ")";[m
[31m-  }[m
[31m-  return out;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/reedsolomon/ReedSolomonDecoder.cpp[m
[31m-[m
[31m-/*[m
[31m- *  ReedSolomonDecoder.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 05/05/2008.[m
[31m- *  Copyright 2008 Google UK. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <iostream>[m
[31m-[m
[31m-// #include <memory>[m
[31m-// #include <zxing/common/reedsolomon/ReedSolomonDecoder.h>[m
[31m-// #include <zxing/common/reedsolomon/GF256.h>[m
[31m-// #include <zxing/common/reedsolomon/GF256Poly.h>[m
[31m-// #include <zxing/common/reedsolomon/ReedSolomonException.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-ReedSolomonDecoder::ReedSolomonDecoder(GF256 &fld) :[m
[31m-    field(fld) {[m
[31m-}[m
[31m-[m
[31m-ReedSolomonDecoder::~ReedSolomonDecoder() {[m
[31m-}[m
[31m-[m
[31m-void ReedSolomonDecoder::decode(ArrayRef<int> received, int twoS) {[m
[31m-[m
[31m-  Ref<GF256Poly> poly(new GF256Poly(field, received));[m
[31m-[m
[31m-[m
[31m-#ifdef DEBUG[m
[31m-  cout << "decoding with poly " << *poly << "\n";[m
[31m-#endif[m
[31m-[m
[31m-  ArrayRef<int> syndromeCoefficients(new Array<int> (twoS));[m
[31m-[m
[31m-[m
[31m-#ifdef DEBUG[m
[31m-  cout << "syndromeCoefficients array = " <<[m
[31m-       syndromeCoefficients.array_ << "\n";[m
[31m-#endif[m
[31m-[m
[31m-  bool dataMatrix = (&field == &GF256::DATA_MATRIX_FIELD);[m
[31m-  bool noError = true;[m
[31m-  for (int i = 0; i < twoS; i++) {[m
[31m-    int eval = poly->evaluateAt(field.exp(dataMatrix ? i + 1 : i));[m
[31m-    syndromeCoefficients[syndromeCoefficients->size() - 1 - i] = eval;[m
[31m-    if (eval != 0) {[m
[31m-      noError = false;[m
[31m-    }[m
[31m-  }[m
[31m-  if (noError) {[m
[31m-    return;[m
[31m-  }[m
[31m-[m
[31m-  Ref<GF256Poly> syndrome(new GF256Poly(field, syndromeCoefficients));[m
[31m-  Ref<GF256Poly> monomial(field.buildMonomial(twoS, 1));[m
[31m-  vector<Ref<GF256Poly> > sigmaOmega(runEuclideanAlgorithm(monomial, syndrome, twoS));[m
[31m-  ArrayRef<int> errorLocations = findErrorLocations(sigmaOmega[0]);[m
[31m-  ArrayRef<int> errorMagitudes = findErrorMagnitudes(sigmaOmega[1], errorLocations, dataMatrix);[m
[31m-  for (unsigned i = 0; i < errorLocations->size(); i++) {[m
[31m-    int position = received->size() - 1 - field.log(errorLocations[i]);[m
[31m-    //TODO: check why the position would be invalid[m
[31m-    if (position < 0 || (size_t)position >= received.size())[m
[31m-      throw IllegalArgumentException("Invalid position (ReedSolomonDecoder)");[m
[31m-    received[position] = GF256::addOrSubtract(received[position], errorMagitudes[i]);[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-vector<Ref<GF256Poly> > ReedSolomonDecoder::runEuclideanAlgorithm(Ref<GF256Poly> a, Ref<GF256Poly> b, int R) {[m
[31m-  // Assume a's degree is >= b's[m
[31m-  if (a->getDegree() < b->getDegree()) {[m
[31m-    Ref<GF256Poly> tmp = a;[m
[31m-    a = b;[m
[31m-    b = tmp;[m
[31m-  }[m
[31m-[m
[31m-  Ref<GF256Poly> rLast(a);[m
[31m-  Ref<GF256Poly> r(b);[m
[31m-  Ref<GF256Poly> sLast(field.getOne());[m
[31m-  Ref<GF256Poly> s(field.getZero());[m
[31m-  Ref<GF256Poly> tLast(field.getZero());[m
[31m-  Ref<GF256Poly> t(field.getOne());[m
[31m-[m
[31m-[m
[31m-  // Run Euclidean algorithm until r's degree is less than R/2[m
[31m-  while (r->getDegree() >= R / 2) {[m
[31m-    Ref<GF256Poly> rLastLast(rLast);[m
[31m-    Ref<GF256Poly> sLastLast(sLast);[m
[31m-    Ref<GF256Poly> tLastLast(tLast);[m
[31m-    rLast = r;[m
[31m-    sLast = s;[m
[31m-    tLast = t;[m
[31m-[m
[31m-[m
[31m-    // Divide rLastLast by rLast, with quotient q and remainder r[m
[31m-    if (rLast->isZero()) {[m
[31m-      // Oops, Euclidean algorithm already terminated?[m
[31m-      throw ReedSolomonException("r_{i-1} was zero");[m
[31m-    }[m
[31m-    r = rLastLast;[m
[31m-    Ref<GF256Poly> q(field.getZero());[m
[31m-    int denominatorLeadingTerm = rLast->getCoefficient(rLast->getDegree());[m
[31m-    int dltInverse = field.inverse(denominatorLeadingTerm);[m
[31m-    while (r->getDegree() >= rLast->getDegree() && !r->isZero()) {[m
[31m-      int degreeDiff = r->getDegree() - rLast->getDegree();[m
[31m-      int scale = field.multiply(r->getCoefficient(r->getDegree()), dltInverse);[m
[31m-      q = q->addOrSubtract(field.buildMonomial(degreeDiff, scale));[m
[31m-      r = r->addOrSubtract(rLast->multiplyByMonomial(degreeDiff, scale));[m
[31m-    }[m
[31m-[m
[31m-    s = q->multiply(sLast)->addOrSubtract(sLastLast);[m
[31m-    t = q->multiply(tLast)->addOrSubtract(tLastLast);[m
[31m-  }[m
[31m-[m
[31m-  int sigmaTildeAtZero = t->getCoefficient(0);[m
[31m-  if (sigmaTildeAtZero == 0) {[m
[31m-    throw ReedSolomonException("sigmaTilde(0) was zero");[m
[31m-  }[m
[31m-[m
[31m-  int inverse = field.inverse(sigmaTildeAtZero);[m
[31m-  Ref<GF256Poly> sigma(t->multiply(inverse));[m
[31m-  Ref<GF256Poly> omega(r->multiply(inverse));[m
[31m-[m
[31m-[m
[31m-#ifdef DEBUG[m
[31m-  cout << "t = " << *t << "\n";[m
[31m-  cout << "r = " << *r << "\n";[m
[31m-  cout << "sigma = " << *sigma << "\n";[m
[31m-  cout << "omega = " << *omega << "\n";[m
[31m-#endif[m
[31m-[m
[31m-  vector<Ref<GF256Poly> > result(2);[m
[31m-  result[0] = sigma;[m
[31m-  result[1] = omega;[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-ArrayRef<int> ReedSolomonDecoder::findErrorLocations(Ref<GF256Poly> errorLocator) {[m
[31m-  // This is a direct application of Chien's search[m
[31m-  int numErrors = errorLocator->getDegree();[m
[31m-  if (numErrors == 1) { // shortcut[m
[31m-    ArrayRef<int> result(1);[m
[31m-    result[0] = errorLocator->getCoefficient(1);[m
[31m-    return result;[m
[31m-  }[m
[31m-  ArrayRef<int> result(numErrors);[m
[31m-  int e = 0;[m
[31m-  for (int i = 1; i < 256 && e < numErrors; i++) {[m
[31m-    // cout << "errorLocator(" << i << ") == " << errorLocator->evaluateAt(i) << "\n";[m
[31m-    if (errorLocator->evaluateAt(i) == 0) {[m
[31m-      result[e] = field.inverse(i);[m
[31m-      e++;[m
[31m-    }[m
[31m-  }[m
[31m-  if (e != numErrors) {[m
[31m-    throw ReedSolomonException("Error locator degree does not match number of roots");[m
[31m-  }[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-ArrayRef<int> ReedSolomonDecoder::findErrorMagnitudes(Ref<GF256Poly> errorEvaluator, ArrayRef<int> errorLocations, bool dataMatrix) {[m
[31m-  // This is directly applying Forney's Formula[m
[31m-  int s = errorLocations.size();[m
[31m-  ArrayRef<int> result(s);[m
[31m-  for (int i = 0; i < s; i++) {[m
[31m-    int xiInverse = field.inverse(errorLocations[i]);[m
[31m-    int denominator = 1;[m
[31m-    for (int j = 0; j < s; j++) {[m
[31m-      if (i != j) {[m
[31m-        denominator = field.multiply(denominator, GF256::addOrSubtract(1, field.multiply(errorLocations[j],[m
[31m-                                     xiInverse)));[m
[31m-      }[m
[31m-    }[m
[31m-    result[i] = field.multiply(errorEvaluator->evaluateAt(xiInverse), field.inverse(denominator));[m
[31m-[m
[31m-    if (dataMatrix) {[m
[31m-      result[i] = field.multiply(result[i], xiInverse);[m
[31m-	}[m
[31m-  }[m
[31m-  return result;[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/common/reedsolomon/ReedSolomonException.cpp[m
[31m-[m
[31m-/*[m
[31m- *  ReedSolomonException.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 06/05/2008.[m
[31m- *  Copyright 2008 Google UK. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/reedsolomon/ReedSolomonException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-ReedSolomonException::ReedSolomonException(const char *msg) throw() :[m
[31m-    Exception(msg) {[m
[31m-}[m
[31m-ReedSolomonException::~ReedSolomonException() throw() {[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-[m
[31m-// file: zxing/datamatrix/DataMatrixReader.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  DataMatrixReader.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/datamatrix/DataMatrixReader.h>[m
[31m-// #include <zxing/datamatrix/detector/Detector.h>[m
[31m-// #include <iostream>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-DataMatrixReader::DataMatrixReader() :[m
[31m-    decoder_() {[m
[31m-}[m
[31m-[m
[31m-Ref<Result> DataMatrixReader::decode(Ref<BinaryBitmap> image, DecodeHints hints) {[m
[31m-  (void)hints;[m
[31m-#ifdef DEBUG[m
[31m-  cout << "decoding image " << image.object_ << ":\n" << flush;[m
[31m-#endif[m
[31m-[m
[31m-  Detector detector(image->getBlackMatrix());[m
[31m-[m
[31m-[m
[31m-#ifdef DEBUG[m
[31m-  cout << "(1) created detector " << &detector << "\n" << flush;[m
[31m-#endif[m
[31m-[m
[31m-  Ref<DetectorResult> detectorResult(detector.detect());[m
[31m-#ifdef DEBUG[m
[31m-  cout << "(2) detected, have detectorResult " << detectorResult.object_ << "\n" << flush;[m
[31m-#endif[m
[31m-[m
[31m-  std::vector<Ref<ResultPoint> > points(detectorResult->getPoints());[m
[31m-[m
[31m-[m
[31m-#ifdef DEBUG[m
[31m-  cout << "(3) extracted points " << &points << "\n" << flush;[m
[31m-  cout << "found " << points.size() << " points:\n";[m
[31m-  for (size_t i = 0; i < points.size(); i++) {[m
[31m-    cout << "   " << points[i]->getX() << "," << points[i]->getY() << "\n";[m
[31m-  }[m
[31m-  cout << "bits:\n";[m
[31m-  cout << *(detectorResult->getBits()) << "\n";[m
[31m-#endif[m
[31m-[m
[31m-  Ref<DecoderResult> decoderResult(decoder_.decode(detectorResult->getBits()));[m
[31m-#ifdef DEBUG[m
[31m-  cout << "(4) decoded, have decoderResult " << decoderResult.object_ << "\n" << flush;[m
[31m-#endif[m
[31m-[m
[31m-  Ref<Result> result([m
[31m-    new Result(decoderResult->getText(), decoderResult->getRawBytes(), points, BarcodeFormat_DATA_MATRIX));[m
[31m-#ifdef DEBUG[m
[31m-  cout << "(5) created result " << result.object_ << ", returning\n" << flush;[m
[31m-#endif[m
[31m-[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-DataMatrixReader::~DataMatrixReader() {[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/datamatrix/Version.cpp[m
[31m-[m
[31m-/*[m
[31m- *  Version.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/datamatrix/Version.h>[m
[31m-// #include <limits>[m
[31m-// #include <iostream>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-using namespace std;[m
[31m-[m
[31m-ECB::ECB(int count, int dataCodewords) :[m
[31m-    count_(count), dataCodewords_(dataCodewords) {[m
[31m-}[m
[31m-[m
[31m-int ECB::getCount() {[m
[31m-  return count_;[m
[31m-}[m
[31m-[m
[31m-int ECB::getDataCodewords() {[m
[31m-  return dataCodewords_;[m
[31m-}[m
[31m-[m
[31m-ECBlocks::ECBlocks(int ecCodewords, ECB *ecBlocks) :[m
[31m-    ecCodewords_(ecCodewords), ecBlocks_(1, ecBlocks) {[m
[31m-}[m
[31m-[m
[31m-ECBlocks::ECBlocks(int ecCodewords, ECB *ecBlocks1, ECB *ecBlocks2) :[m
[31m-    ecCodewords_(ecCodewords), ecBlocks_(1, ecBlocks1) {[m
[31m-  ecBlocks_.push_back(ecBlocks2);[m
[31m-}[m
[31m-[m
[31m-int ECBlocks::getECCodewords() {[m
[31m-  return ecCodewords_;[m
[31m-}[m
[31m-[m
[31m-std::vector<ECB*>& ECBlocks::getECBlocks() {[m
[31m-  return ecBlocks_;[m
[31m-}[m
[31m-[m
[31m-ECBlocks::~ECBlocks() {[m
[31m-  for (size_t i = 0; i < ecBlocks_.size(); i++) {[m
[31m-    delete ecBlocks_[i];[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-vector<Ref<Version> > Version::VERSIONS;[m
[31m-static int N_VERSIONS = Version::buildVersions();[m
[31m-[m
[31m-Version::Version(int versionNumber, int symbolSizeRows, int symbolSizeColumns, int dataRegionSizeRows,[m
[31m-		int dataRegionSizeColumns, ECBlocks* ecBlocks) : versionNumber_(versionNumber),[m
[31m-		symbolSizeRows_(symbolSizeRows), symbolSizeColumns_(symbolSizeColumns),[m
[31m-		dataRegionSizeRows_(dataRegionSizeRows), dataRegionSizeColumns_(dataRegionSizeColumns),[m
[31m-		ecBlocks_(ecBlocks), totalCodewords_(0) {[m
[31m-    // Calculate the total number of codewords[m
[31m-    int total = 0;[m
[31m-    int ecCodewords = ecBlocks_->getECCodewords();[m
[31m-    vector<ECB*> &ecbArray = ecBlocks_->getECBlocks();[m
[31m-    for (unsigned int i = 0; i < ecbArray.size(); i++) {[m
[31m-      ECB *ecBlock = ecbArray[i];[m
[31m-      total += ecBlock->getCount() * (ecBlock->getDataCodewords() + ecCodewords);[m
[31m-    }[m
[31m-    totalCodewords_ = total;[m
[31m-}[m
[31m-[m
[31m-Version::~Version() {[m
[31m-    delete ecBlocks_;[m
[31m-}[m
[31m-[m
[31m-int Version::getVersionNumber() {[m
[31m-  return versionNumber_;[m
[31m-}[m
[31m-[m
[31m-int Version::getSymbolSizeRows() {[m
[31m-  return symbolSizeRows_;[m
[31m-}[m
[31m-[m
[31m-int Version::getSymbolSizeColumns() {[m
[31m-  return symbolSizeColumns_;[m
[31m-}[m
[31m-[m
[31m-int Version::getDataRegionSizeRows() {[m
[31m-  return dataRegionSizeRows_;[m
[31m-}[m
[31m-[m
[31m-int Version::getDataRegionSizeColumns() {[m
[31m-  return dataRegionSizeColumns_;[m
[31m-}[m
[31m-[m
[31m-int Version::getTotalCodewords() {[m
[31m-  return totalCodewords_;[m
[31m-}[m
[31m-[m
[31m-ECBlocks* Version::getECBlocks() {[m
[31m-  return ecBlocks_;[m
[31m-}[m
[31m-[m
[31m-Ref<Version> Version::getVersionForDimensions(int numRows, int numColumns) {[m
[31m-    if ((numRows & 0x01) != 0 || (numColumns & 0x01) != 0) {[m
[31m-      throw ReaderException("Number of rows and columns must be even");[m
[31m-    }[m
[31m-[m
[31m-    // TODO(bbrown): This is doing a linear search through the array of versions.[m
[31m-    // If we interleave the rectangular versions with the square versions we could[m
[31m-    // do a binary search.[m
[31m-    for (int i = 0; i < N_VERSIONS; ++i){[m
[31m-      Ref<Version> version(VERSIONS[i]);[m
[31m-      if (version->getSymbolSizeRows() == numRows && version->getSymbolSizeColumns() == numColumns) {[m
[31m-        return version;[m
[31m-      }[m
[31m-    }[m
[31m-    throw ReaderException("Error version not found");[m
[31m-  }[m
[31m-[m
[31m-/**[m
[31m- * See ISO 16022:2006 5.5.1 Table 7[m
[31m- */[m
[31m-int Version::buildVersions() {[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(1, 10, 10, 8, 8,[m
[31m-            					  new ECBlocks(5, new ECB(1, 3)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(2, 12, 12, 10, 10,[m
[31m-            					  new ECBlocks(7, new ECB(1, 5)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(3, 14, 14, 12, 12,[m
[31m-            					  new ECBlocks(10, new ECB(1, 8)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(4, 16, 16, 14, 14,[m
[31m-            					  new ECBlocks(12, new ECB(1, 12)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(5, 18, 18, 16, 16,[m
[31m-            					  new ECBlocks(14, new ECB(1, 18)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(6, 20, 20, 18, 18,[m
[31m-            					  new ECBlocks(18, new ECB(1, 22)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(7, 22, 22, 20, 20,[m
[31m-            					  new ECBlocks(20, new ECB(1, 30)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(8, 24, 24, 22, 22,[m
[31m-            					  new ECBlocks(24, new ECB(1, 36)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(9, 26, 26, 24, 24,[m
[31m-            					  new ECBlocks(28, new ECB(1, 44)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(10, 32, 32, 14, 14,[m
[31m-            					  new ECBlocks(36, new ECB(1, 62)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(11, 36, 36, 16, 16,[m
[31m-            					  new ECBlocks(42, new ECB(1, 86)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(12, 40, 40, 18, 18,[m
[31m-            					  new ECBlocks(48, new ECB(1, 114)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(13, 44, 44, 20, 20,[m
[31m-            					  new ECBlocks(56, new ECB(1, 144)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(14, 48, 48, 22, 22,[m
[31m-            					  new ECBlocks(68, new ECB(1, 174)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(15, 52, 52, 24, 24,[m
[31m-            					  new ECBlocks(42, new ECB(2, 102)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(16, 64, 64, 14, 14,[m
[31m-            					  new ECBlocks(56, new ECB(2, 140)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(17, 72, 72, 16, 16,[m
[31m-            					  new ECBlocks(36, new ECB(4, 92)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new  Version(18, 80, 80, 18, 18,[m
[31m-            					  new ECBlocks(48, new ECB(4, 114)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(19, 88, 88, 20, 20,[m
[31m-            					  new ECBlocks(56, new ECB(4, 144)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(20, 96, 96, 22, 22,[m
[31m-            					  new ECBlocks(68, new ECB(4, 174)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(21, 104, 104, 24, 24,[m
[31m-            					  new ECBlocks(56, new ECB(6, 136)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(22, 120, 120, 18, 18,[m
[31m-            					  new ECBlocks(68, new ECB(6, 175)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(23, 132, 132, 20, 20,[m
[31m-            					  new ECBlocks(62, new ECB(8, 163)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(24, 144, 144, 22, 22,[m
[31m-            					  new ECBlocks(62, new ECB(8, 156), new ECB(2, 155)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(25, 8, 18, 6, 16,[m
[31m-            					  new ECBlocks(7, new ECB(1, 5)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(26, 8, 32, 6, 14,[m
[31m-            					  new ECBlocks(11, new ECB(1, 10)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(27, 12, 26, 10, 24,[m
[31m-					              new ECBlocks(14, new ECB(1, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(28, 12, 36, 10, 16,[m
[31m-					              new ECBlocks(18, new ECB(1, 22)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(29, 16, 36, 14, 16,[m
[31m-					              new ECBlocks(24, new ECB(1, 32)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(30, 16, 48, 14, 22,[m
[31m-					              new ECBlocks(28, new ECB(1, 49)))));[m
[31m-  return VERSIONS.size();[m
[31m-}[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/datamatrix/decoder/BitMatrixParser.cpp[m
[31m-[m
[31m-/*[m
[31m- *  BitMatrixParser.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/datamatrix/decoder/BitMatrixParser.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-// #include <iostream>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-int BitMatrixParser::copyBit(size_t x, size_t y, int versionBits) {[m
[31m-  return bitMatrix_->get(x, y) ? (versionBits << 1) | 0x1 : versionBits << 1;[m
[31m-}[m
[31m-[m
[31m-BitMatrixParser::BitMatrixParser(Ref<BitMatrix> bitMatrix) : bitMatrix_(NULL),[m
[31m-                                                             parsedVersion_(NULL),[m
[31m-                                                             readBitMatrix_(NULL) {[m
[31m-  size_t dimension = bitMatrix->getDimension();[m
[31m-  if (dimension < 8 || dimension > 144 || (dimension & 0x01) != 0)[m
[31m-    throw ReaderException("Dimension must be even, > 8 < 144");[m
[31m-[m
[31m-  parsedVersion_ = readVersion(bitMatrix);[m
[31m-  bitMatrix_ = extractDataRegion(bitMatrix);[m
[31m-  readBitMatrix_ = new BitMatrix(bitMatrix_->getWidth(), bitMatrix_->getHeight());[m
[31m-}[m
[31m-[m
[31m-Ref<Version> BitMatrixParser::readVersion(Ref<BitMatrix> bitMatrix) {[m
[31m-  if (parsedVersion_ != 0) {[m
[31m-    return parsedVersion_;[m
[31m-  }[m
[31m-[m
[31m-  int numRows = bitMatrix->getHeight();//getDimension();[m
[31m-  int numColumns = bitMatrix->getWidth();//numRows;[m
[31m-[m
[31m-  Ref<Version> version = parsedVersion_->getVersionForDimensions(numRows, numColumns);[m
[31m-  if (version != 0) {[m
[31m-    return version;[m
[31m-  }[m
[31m-  throw ReaderException("Couldn't decode version");[m
[31m-}[m
[31m-[m
[31m-ArrayRef<unsigned char> BitMatrixParser::readCodewords() {[m
[31m-  	ArrayRef<unsigned char> result(parsedVersion_->getTotalCodewords());[m
[31m-  	int resultOffset = 0;[m
[31m-    int row = 4;[m
[31m-    int column = 0;[m
[31m-[m
[31m-    int numRows = bitMatrix_->getHeight();[m
[31m-    int numColumns = bitMatrix_->getWidth();[m
[31m-[m
[31m-    bool corner1Read = false;[m
[31m-    bool corner2Read = false;[m
[31m-    bool corner3Read = false;[m
[31m-    bool corner4Read = false;[m
[31m-[m
[31m-    // Read all of the codewords[m
[31m-    do {[m
[31m-      // Check the four corner cases[m
[31m-      if ((row == numRows) && (column == 0) && !corner1Read) {[m
[31m-        result[resultOffset++] = (unsigned char) readCorner1(numRows, numColumns);[m
[31m-        row -= 2;[m
[31m-        column +=2;[m
[31m-        corner1Read = true;[m
[31m-      } else if ((row == numRows-2) && (column == 0) && ((numColumns & 0x03) != 0) && !corner2Read) {[m
[31m-        result[resultOffset++] = (unsigned char) readCorner2(numRows, numColumns);[m
[31m-        row -= 2;[m
[31m-        column +=2;[m
[31m-        corner2Read = true;[m
[31m-      } else if ((row == numRows+4) && (column == 2) && ((numColumns & 0x07) == 0) && !corner3Read) {[m
[31m-        result[resultOffset++] = (unsigned char) readCorner3(numRows, numColumns);[m
[31m-        row -= 2;[m
[31m-        column +=2;[m
[31m-        corner3Read = true;[m
[31m-      } else if ((row == numRows-2) && (column == 0) && ((numColumns & 0x07) == 4) && !corner4Read) {[m
[31m-        result[resultOffset++] = (unsigned char) readCorner4(numRows, numColumns);[m
[31m-        row -= 2;[m
[31m-        column +=2;[m
[31m-        corner4Read = true;[m
[31m-      } else {[m
[31m-        // Sweep upward diagonally to the right[m
[31m-        do {[m
[31m-          if ((row < numRows) && (column >= 0) && !readBitMatrix_->get(column, row)) {[m
[31m-            result[resultOffset++] = (unsigned char) readUtah(row, column, numRows, numColumns);[m
[31m-          }[m
[31m-          row -= 2;[m
[31m-          column +=2;[m
[31m-        } while ((row >= 0) && (column < numColumns));[m
[31m-        row += 1;[m
[31m-        column +=3;[m
[31m-[m
[31m-        // Sweep downward diagonally to the left[m
[31m-        do {[m
[31m-          if ((row >= 0) && (column < numColumns) && !readBitMatrix_->get(column, row)) {[m
[31m-             result[resultOffset++] = (unsigned char) readUtah(row, column, numRows, numColumns);[m
[31m-          }[m
[31m-          row += 2;[m
[31m-          column -=2;[m
[31m-        } while ((row < numRows) && (column >= 0));[m
[31m-        row += 3;[m
[31m-        column +=1;[m
[31m-      }[m
[31m-    } while ((row < numRows) || (column < numColumns));[m
[31m-[m
[31m-    if (resultOffset != parsedVersion_->getTotalCodewords()) {[m
[31m-      throw ReaderException("Did not read all codewords");[m
[31m-    }[m
[31m-    return result;[m
[31m-}[m
[31m-[m
[31m-bool BitMatrixParser::readModule(int row, int column, int numRows, int numColumns) {[m
[31m-    // Adjust the row and column indices based on boundary wrapping[m
[31m-    if (row < 0) {[m
[31m-      row += numRows;[m
[31m-      column += 4 - ((numRows + 4) & 0x07);[m
[31m-    }[m
[31m-    if (column < 0) {[m
[31m-      column += numColumns;[m
[31m-      row += 4 - ((numColumns + 4) & 0x07);[m
[31m-    }[m
[31m-    readBitMatrix_->set(column, row);[m
[31m-    return bitMatrix_->get(column, row);[m
[31m-  }[m
[31m-[m
[31m-int BitMatrixParser::readUtah(int row, int column, int numRows, int numColumns) {[m
[31m-    int currentByte = 0;[m
[31m-    if (readModule(row - 2, column - 2, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(row - 2, column - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(row - 1, column - 2, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(row - 1, column - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(row - 1, column, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(row, column - 2, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(row, column - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(row, column, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    return currentByte;[m
[31m-  }[m
[31m-[m
[31m-int BitMatrixParser::readCorner1(int numRows, int numColumns) {[m
[31m-    int currentByte = 0;[m
[31m-    if (readModule(numRows - 1, 0, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(numRows - 1, 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(numRows - 1, 2, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(0, numColumns - 2, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(0, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(1, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(2, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(3, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    return currentByte;[m
[31m-  }[m
[31m-[m
[31m-int BitMatrixParser::readCorner2(int numRows, int numColumns) {[m
[31m-    int currentByte = 0;[m
[31m-    if (readModule(numRows - 3, 0, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(numRows - 2, 0, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(numRows - 1, 0, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(0, numColumns - 4, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(0, numColumns - 3, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(0, numColumns - 2, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(0, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(1, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    return currentByte;[m
[31m-  }[m
[31m-[m
[31m-int BitMatrixParser::readCorner3(int numRows, int numColumns) {[m
[31m-    int currentByte = 0;[m
[31m-    if (readModule(numRows - 1, 0, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(numRows - 1, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(0, numColumns - 3, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(0, numColumns - 2, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(0, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(1, numColumns - 3, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(1, numColumns - 2, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(1, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    return currentByte;[m
[31m-  }[m
[31m-[m
[31m-int BitMatrixParser::readCorner4(int numRows, int numColumns) {[m
[31m-    int currentByte = 0;[m
[31m-    if (readModule(numRows - 3, 0, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(numRows - 2, 0, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(numRows - 1, 0, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(0, numColumns - 2, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(0, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(1, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(2, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    currentByte <<= 1;[m
[31m-    if (readModule(3, numColumns - 1, numRows, numColumns)) {[m
[31m-      currentByte |= 1;[m
[31m-    }[m
[31m-    return currentByte;[m
[31m-  }[m
[31m-[m
[31m-Ref<BitMatrix> BitMatrixParser::extractDataRegion(Ref<BitMatrix> bitMatrix) {[m
[31m-    int symbolSizeRows = parsedVersion_->getSymbolSizeRows();[m
[31m-    int symbolSizeColumns = parsedVersion_->getSymbolSizeColumns();[m
[31m-[m
[31m-    if ((int)bitMatrix->getHeight() != symbolSizeRows) {[m
[31m-      throw IllegalArgumentException("Dimension of bitMatrix must match the version size");[m
[31m-    }[m
[31m-[m
[31m-    int dataRegionSizeRows = parsedVersion_->getDataRegionSizeRows();[m
[31m-    int dataRegionSizeColumns = parsedVersion_->getDataRegionSizeColumns();[m
[31m-[m
[31m-    int numDataRegionsRow = symbolSizeRows / dataRegionSizeRows;[m
[31m-    int numDataRegionsColumn = symbolSizeColumns / dataRegionSizeColumns;[m
[31m-[m
[31m-    int sizeDataRegionRow = numDataRegionsRow * dataRegionSizeRows;[m
[31m-    int sizeDataRegionColumn = numDataRegionsColumn * dataRegionSizeColumns;[m
[31m-[m
[31m-    Ref<BitMatrix> bitMatrixWithoutAlignment(new BitMatrix(sizeDataRegionColumn, sizeDataRegionRow));[m
[31m-    for (int dataRegionRow = 0; dataRegionRow < numDataRegionsRow; ++dataRegionRow) {[m
[31m-      int dataRegionRowOffset = dataRegionRow * dataRegionSizeRows;[m
[31m-      for (int dataRegionColumn = 0; dataRegionColumn < numDataRegionsColumn; ++dataRegionColumn) {[m
[31m-        int dataRegionColumnOffset = dataRegionColumn * dataRegionSizeColumns;[m
[31m-        for (int i = 0; i < dataRegionSizeRows; ++i) {[m
[31m-          int readRowOffset = dataRegionRow * (dataRegionSizeRows + 2) + 1 + i;[m
[31m-          int writeRowOffset = dataRegionRowOffset + i;[m
[31m-          for (int j = 0; j < dataRegionSizeColumns; ++j) {[m
[31m-            int readColumnOffset = dataRegionColumn * (dataRegionSizeColumns + 2) + 1 + j;[m
[31m-            if (bitMatrix->get(readColumnOffset, readRowOffset)) {[m
[31m-              int writeColumnOffset = dataRegionColumnOffset + j;[m
[31m-              bitMatrixWithoutAlignment->set(writeColumnOffset, writeRowOffset);[m
[31m-            }[m
[31m-          }[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-    return bitMatrixWithoutAlignment;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/datamatrix/decoder/DataBlock.cpp[m
[31m-[m
[31m-/*[m
[31m- *  DataBlock.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/datamatrix/decoder/DataBlock.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-DataBlock::DataBlock(int numDataCodewords, ArrayRef<unsigned char> codewords) :[m
[31m-    numDataCodewords_(numDataCodewords), codewords_(codewords) {[m
[31m-}[m
[31m-[m
[31m-int DataBlock::getNumDataCodewords() {[m
[31m-  return numDataCodewords_;[m
[31m-}[m
[31m-[m
[31m-ArrayRef<unsigned char> DataBlock::getCodewords() {[m
[31m-  return codewords_;[m
[31m-}[m
[31m-[m
[31m-std::vector<Ref<DataBlock> > DataBlock::getDataBlocks(ArrayRef<unsigned char> rawCodewords, Version *version) {[m
[31m-  // Figure out the number and size of data blocks used by this version and[m
[31m-  // error correction level[m
[31m-  ECBlocks* ecBlocks = version->getECBlocks();[m
[31m-[m
[31m-  // First count the total number of data blocks[m
[31m-  int totalBlocks = 0;[m
[31m-  vector<ECB*> ecBlockArray = ecBlocks->getECBlocks();[m
[31m-  for (size_t i = 0; i < ecBlockArray.size(); i++) {[m
[31m-    totalBlocks += ecBlockArray[i]->getCount();[m
[31m-  }[m
[31m-[m
[31m-  // Now establish DataBlocks of the appropriate size and number of data codewords[m
[31m-  std::vector<Ref<DataBlock> > result(totalBlocks);[m
[31m-  int numResultBlocks = 0;[m
[31m-  for (size_t j = 0; j < ecBlockArray.size(); j++) {[m
[31m-    ECB *ecBlock = ecBlockArray[j];[m
[31m-    for (int i = 0; i < ecBlock->getCount(); i++) {[m
[31m-      int numDataCodewords = ecBlock->getDataCodewords();[m
[31m-      int numBlockCodewords = ecBlocks->getECCodewords() + numDataCodewords;[m
[31m-      ArrayRef<unsigned char> buffer(numBlockCodewords);[m
[31m-      Ref<DataBlock> blockRef(new DataBlock(numDataCodewords, buffer));[m
[31m-      result[numResultBlocks++] = blockRef;[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  // All blocks have the same amount of data, except that the last n[m
[31m-  // (where n may be 0) have 1 more byte. Figure out where these start.[m
[31m-  int shorterBlocksTotalCodewords = result[0]->codewords_.size();[m
[31m-  int longerBlocksStartAt = result.size() - 1;[m
[31m-  while (longerBlocksStartAt >= 0) {[m
[31m-    int numCodewords = result[longerBlocksStartAt]->codewords_.size();[m
[31m-    if (numCodewords == shorterBlocksTotalCodewords) {[m
[31m-      break;[m
[31m-    }[m
[31m-    if (numCodewords != shorterBlocksTotalCodewords + 1) {[m
[31m-      throw IllegalArgumentException("Data block sizes differ by more than 1");[m
[31m-    }[m
[31m-    longerBlocksStartAt--;[m
[31m-  }[m
[31m-  longerBlocksStartAt++;[m
[31m-[m
[31m-  int shorterBlocksNumDataCodewords = shorterBlocksTotalCodewords - ecBlocks->getECCodewords();[m
[31m-  // The last elements of result may be 1 element longer;[m
[31m-  // first fill out as many elements as all of them have[m
[31m-  int rawCodewordsOffset = 0;[m
[31m-  for (int i = 0; i < shorterBlocksNumDataCodewords; i++) {[m
[31m-    for (int j = 0; j < numResultBlocks; j++) {[m
[31m-      result[j]->codewords_[i] = rawCodewords[rawCodewordsOffset++];[m
[31m-    }[m
[31m-  }[m
[31m-  // Fill out the last data block in the longer ones[m
[31m-  for (int j = longerBlocksStartAt; j < numResultBlocks; j++) {[m
[31m-    result[j]->codewords_[shorterBlocksNumDataCodewords] = rawCodewords[rawCodewordsOffset++];[m
[31m-  }[m
[31m-  // Now add in error correction blocks[m
[31m-  int max = result[0]->codewords_.size();[m
[31m-  for (int i = shorterBlocksNumDataCodewords; i < max; i++) {[m
[31m-    for (int j = 0; j < numResultBlocks; j++) {[m
[31m-      int iOffset = j < longerBlocksStartAt ? i : i + 1;[m
[31m-      result[j]->codewords_[iOffset] = rawCodewords[rawCodewordsOffset++];[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  if ((size_t)rawCodewordsOffset != rawCodewords.size()) {[m
[31m-    throw IllegalArgumentException("rawCodewordsOffset != rawCodewords.length");[m
[31m-  }[m
[31m-[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/datamatrix/decoder/DecodedBitStreamParser.cpp[m
[31m-[m
[31m-/*[m
[31m- *  DecodedBitStreamParser.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/FormatException.h>[m
[31m-// #include <zxing/datamatrix/decoder/DecodedBitStreamParser.h>[m
[31m-// #include <iostream>[m
[31m-// #include <zxing/common/DecoderResult.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-const char DecodedBitStreamParser::C40_BASIC_SET_CHARS[] = {[m
[31m-    '*', '*', '*', ' ', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',[m
[31m-    'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N',[m
[31m-    'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'[m
[31m-};[m
[31m-[m
[31m-const char DecodedBitStreamParser::C40_SHIFT2_SET_CHARS[] = {[m
[31m-    '!', '"', '#', '$', '%', '&', '\'', '(', ')', '*', '+', ',', '-', '.',[m
[31m-    '/', ':', ';', '<', '=', '>', '?', '@', '[', '\\', ']', '^', '_'[m
[31m-};[m
[31m-[m
[31m-const char DecodedBitStreamParser::TEXT_BASIC_SET_CHARS[] = {[m
[31m-    '*', '*', '*', ' ', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',[m
[31m-    'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',[m
[31m-    'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'[m
[31m-};[m
[31m-[m
[31m-const char DecodedBitStreamParser::TEXT_SHIFT3_SET_CHARS[] = {[m
[31m-    '\'', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N',[m
[31m-    'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '{', '|', '}', '~', (char) 127[m
[31m-};[m
[31m-[m
[31m-Ref<DecoderResult> DecodedBitStreamParser::decode(ArrayRef<unsigned char> bytes) {[m
[31m-  Ref<BitSource> bits(new BitSource(bytes));[m
[31m-  ostringstream result;[m
[31m-  ostringstream resultTrailer;[m
[31m-  vector<unsigned char> byteSegments;[m
[31m-  int mode = ASCII_ENCODE;[m
[31m-  do {[m
[31m-    if (mode == ASCII_ENCODE) {[m
[31m-      mode = decodeAsciiSegment(bits, result, resultTrailer);[m
[31m-    } else {[m
[31m-      switch (mode) {[m
[31m-        case C40_ENCODE:[m
[31m-          decodeC40Segment(bits, result);[m
[31m-          break;[m
[31m-        case TEXT_ENCODE:[m
[31m-          decodeTextSegment(bits, result);[m
[31m-          break;[m
[31m-        case ANSIX12_ENCODE:[m
[31m-          decodeAnsiX12Segment(bits, result);[m
[31m-          break;[m
[31m-        case EDIFACT_ENCODE:[m
[31m-          decodeEdifactSegment(bits, result);[m
[31m-          break;[m
[31m-        case BASE256_ENCODE:[m
[31m-          decodeBase256Segment(bits, result, byteSegments);[m
[31m-          break;[m
[31m-        default:[m
[31m-          throw FormatException("Unsupported mode indicator");[m
[31m-      }[m
[31m-      mode = ASCII_ENCODE;[m
[31m-    }[m
[31m-  } while (mode != PAD_ENCODE && bits->available() > 0);[m
[31m-[m
[31m-  if (resultTrailer.str().size() > 0) {[m
[31m-    result << resultTrailer.str();[m
[31m-  }[m
[31m-  ArrayRef<unsigned char> rawBytes(bytes);[m
[31m-  Ref<String> text(new String(result.str()));[m
[31m-  return Ref<DecoderResult>(new DecoderResult(rawBytes, text));[m
[31m-}[m
[31m-[m
[31m-int DecodedBitStreamParser::decodeAsciiSegment(Ref<BitSource> bits, ostringstream & result,[m
[31m-  ostringstream & resultTrailer) {[m
[31m-  bool upperShift = false;[m
[31m-  do {[m
[31m-    int oneByte = bits->readBits(8);[m
[31m-    if (oneByte == 0) {[m
[31m-      throw FormatException("Not enough bits to decode");[m
[31m-    } else if (oneByte <= 128) {  // ASCII data (ASCII value + 1)[m
[31m-      oneByte = upperShift ? (oneByte + 128) : oneByte;[m
[31m-      // upperShift = false;[m
[31m-      result << (char) (oneByte - 1);[m
[31m-      return ASCII_ENCODE;[m
[31m-    } else if (oneByte == 129) {  // Pad[m
[31m-      return PAD_ENCODE;[m
[31m-    } else if (oneByte <= 229) {  // 2-digit data 00-99 (Numeric Value + 130)[m
[31m-      int value = oneByte - 130;[m
[31m-      if (value < 10) { // padd with '0' for single digit values[m
[31m-        result << '0';[m
[31m-      }[m
[31m-      result << value;[m
[31m-    } else if (oneByte == 230) {  // Latch to C40 encodation[m
[31m-      return C40_ENCODE;[m
[31m-    } else if (oneByte == 231) {  // Latch to Base 256 encodation[m
[31m-      return BASE256_ENCODE;[m
[31m-    } else if (oneByte == 232) {  // FNC1[m
[31m-      result << ((char) 29); // translate as ASCII 29[m
[31m-    } else if (oneByte == 233 || oneByte == 234) {[m
[31m-      // Structured Append, Reader Programming[m
[31m-      // Ignore these symbols for now[m
[31m-      // throw FormatException.getInstance();[m
[31m-    } else if (oneByte == 235) {  // Upper Shift (shift to Extended ASCII)[m
[31m-      upperShift = true;[m
[31m-    } else if (oneByte == 236) {  // 05 Macro[m
[31m-        result << ("[)>RS05GS");[m
[31m-        resultTrailer << ("RSEOT");[m
[31m-    } else if (oneByte == 237) {  // 06 Macro[m
[31m-      result << ("[)>RS06GS");[m
[31m-      resultTrailer <<  ("RSEOT");[m
[31m-    } else if (oneByte == 238) {  // Latch to ANSI X12 encodation[m
[31m-      return ANSIX12_ENCODE;[m
[31m-    } else if (oneByte == 239) {  // Latch to Text encodation[m
[31m-      return TEXT_ENCODE;[m
[31m-    } else if (oneByte == 240) {  // Latch to EDIFACT encodation[m
[31m-      return EDIFACT_ENCODE;[m
[31m-    } else if (oneByte == 241) {  // ECI Character[m
[31m-      // TODO(bbrown): I think we need to support ECI[m
[31m-      // throw FormatException.getInstance();[m
[31m-      // Ignore this symbol for now[m
[31m-    } else if (oneByte >= 242) { // Not to be used in ASCII encodation[m
[31m-      // ... but work around encoders that end with 254, latch back to ASCII[m
[31m-      if (oneByte == 254 && bits->available() == 0) {[m
[31m-        // Ignore[m
[31m-      } else {[m
[31m-        throw FormatException("Not to be used in ASCII encodation");[m
[31m-      }[m
[31m-    }[m
[31m-  } while (bits->available() > 0);[m
[31m-  return ASCII_ENCODE;[m
[31m-}[m
[31m-[m
[31m-void DecodedBitStreamParser::decodeC40Segment(Ref<BitSource> bits, ostringstream & result) {[m
[31m-  // Three C40 values are encoded in a 16-bit value as[m
[31m-  // (1600 * C1) + (40 * C2) + C3 + 1[m
[31m-  // TODO(bbrown): The Upper Shift with C40 doesn't work in the 4 value scenario all the time[m
[31m-  bool upperShift = false;[m
[31m-[m
[31m-  int* cValues = new int[3];[m
[31m-  int shift = 0;[m
[31m-  do {[m
[31m-    // If there is only one byte left then it will be encoded as ASCII[m
[31m-    if (bits->available() == 8) {[m
[31m-      return;[m
[31m-    }[m
[31m-    int firstByte = bits->readBits(8);[m
[31m-    if (firstByte == 254) {  // Unlatch codeword[m
[31m-      return;[m
[31m-    }[m
[31m-[m
[31m-    parseTwoBytes(firstByte, bits->readBits(8), cValues);[m
[31m-[m
[31m-    for (int i = 0; i < 3; i++) {[m
[31m-      int cValue = cValues[i];[m
[31m-      switch (shift) {[m
[31m-        case 0:[m
[31m-          if (cValue < 3) {[m
[31m-            shift = cValue + 1;[m
[31m-          } else {[m
[31m-            if (upperShift) {[m
[31m-              result << (char) (C40_BASIC_SET_CHARS[cValue] + 128);[m
[31m-              upperShift = false;[m
[31m-            } else {[m
[31m-              result << C40_BASIC_SET_CHARS[cValue];[m
[31m-            }[m
[31m-          }[m
[31m-          break;[m
[31m-        case 1:[m
[31m-          if (upperShift) {[m
[31m-            result << (char) (cValue + 128);[m
[31m-            upperShift = false;[m
[31m-          } else {[m
[31m-            result << (char) cValue;[m
[31m-          }[m
[31m-          shift = 0;[m
[31m-          break;[m
[31m-        case 2:[m
[31m-          if (cValue < 27) {[m
[31m-            if (upperShift) {[m
[31m-              result << (char) (C40_SHIFT2_SET_CHARS[cValue] + 128);[m
[31m-              upperShift = false;[m
[31m-            } else {[m
[31m-              result << C40_SHIFT2_SET_CHARS[cValue];[m
[31m-            }[m
[31m-          } else if (cValue == 27) {  // FNC1[m
[31m-            result << ((char) 29); // translate as ASCII 29[m
[31m-          } else if (cValue == 30) {  // Upper Shift[m
[31m-            upperShift = true;[m
[31m-          } else {[m
[31m-            throw FormatException("decodeC40Segment: Upper Shift");[m
[31m-          }[m
[31m-          shift = 0;[m
[31m-          break;[m
[31m-        case 3:[m
[31m-          if (upperShift) {[m
[31m-            result << (char) (cValue + 224);[m
[31m-            upperShift = false;[m
[31m-          } else {[m
[31m-            result << (char) (cValue + 96);[m
[31m-          }[m
[31m-          shift = 0;[m
[31m-          break;[m
[31m-        default:[m
[31m-          throw FormatException("decodeC40Segment: no case");[m
[31m-      }[m
[31m-    }[m
[31m-  } while (bits->available() > 0);[m
[31m-}[m
[31m-[m
[31m-void DecodedBitStreamParser::decodeTextSegment(Ref<BitSource> bits, ostringstream & result) {[m
[31m-  // Three Text values are encoded in a 16-bit value as[m
[31m-  // (1600 * C1) + (40 * C2) + C3 + 1[m
[31m-  // TODO(bbrown): The Upper Shift with Text doesn't work in the 4 value scenario all the time[m
[31m-  bool upperShift = false;[m
[31m-[m
[31m-  int* cValues = new int[3];[m
[31m-  int shift = 0;[m
[31m-  do {[m
[31m-    // If there is only one byte left then it will be encoded as ASCII[m
[31m-    if (bits->available() == 8) {[m
[31m-      return;[m
[31m-    }[m
[31m-    int firstByte = bits->readBits(8);[m
[31m-    if (firstByte == 254) {  // Unlatch codeword[m
[31m-      return;[m
[31m-    }[m
[31m-[m
[31m-    parseTwoBytes(firstByte, bits->readBits(8), cValues);[m
[31m-[m
[31m-    for (int i = 0; i < 3; i++) {[m
[31m-      int cValue = cValues[i];[m
[31m-      switch (shift) {[m
[31m-        case 0:[m
[31m-          if (cValue < 3) {[m
[31m-            shift = cValue + 1;[m
[31m-          } else {[m
[31m-            if (upperShift) {[m
[31m-              result << (char) (TEXT_BASIC_SET_CHARS[cValue] + 128);[m
[31m-              upperShift = false;[m
[31m-            } else {[m
[31m-              result << (TEXT_BASIC_SET_CHARS[cValue]);[m
[31m-            }[m
[31m-          }[m
[31m-          break;[m
[31m-        case 1:[m
[31m-          if (upperShift) {[m
[31m-            result << (char) (cValue + 128);[m
[31m-            upperShift = false;[m
[31m-          } else {[m
[31m-            result << (char) (cValue);[m
[31m-          }[m
[31m-          shift = 0;[m
[31m-          break;[m
[31m-        case 2:[m
[31m-          // Shift 2 for Text is the same encoding as C40[m
[31m-          if (cValue < 27) {[m
[31m-            if (upperShift) {[m
[31m-              result << (char) (C40_SHIFT2_SET_CHARS[cValue] + 128);[m
[31m-              upperShift = false;[m
[31m-            } else {[m
[31m-              result << (C40_SHIFT2_SET_CHARS[cValue]);[m
[31m-            }[m
[31m-          } else if (cValue == 27) {  // FNC1[m
[31m-            result << ((char) 29); // translate as ASCII 29[m
[31m-          } else if (cValue == 30) {  // Upper Shift[m
[31m-            upperShift = true;[m
[31m-          } else {[m
[31m-            throw FormatException("decodeTextSegment: Upper Shift");[m
[31m-          }[m
[31m-          shift = 0;[m
[31m-          break;[m
[31m-        case 3:[m
[31m-          if (upperShift) {[m
[31m-            result << (char) (TEXT_SHIFT3_SET_CHARS[cValue] + 128);[m
[31m-            upperShift = false;[m
[31m-          } else {[m
[31m-            result << (TEXT_SHIFT3_SET_CHARS[cValue]);[m
[31m-          }[m
[31m-          shift = 0;[m
[31m-          break;[m
[31m-        default:[m
[31m-          throw FormatException("decodeTextSegment: no case");[m
[31m-      }[m
[31m-    }[m
[31m-  } while (bits->available() > 0);[m
[31m-}[m
[31m-[m
[31m-void DecodedBitStreamParser::decodeAnsiX12Segment(Ref<BitSource> bits, ostringstream & result) {[m
[31m-  // Three ANSI X12 values are encoded in a 16-bit value as[m
[31m-  // (1600 * C1) + (40 * C2) + C3 + 1[m
[31m-[m
[31m-  int* cValues = new int[3];[m
[31m-  do {[m
[31m-    // If there is only one byte left then it will be encoded as ASCII[m
[31m-    if (bits->available() == 8) {[m
[31m-      return;[m
[31m-    }[m
[31m-    int firstByte = bits->readBits(8);[m
[31m-    if (firstByte == 254) {  // Unlatch codeword[m
[31m-      return;[m
[31m-    }[m
[31m-[m
[31m-    parseTwoBytes(firstByte, bits->readBits(8), cValues);[m
[31m-[m
[31m-    for (int i = 0; i < 3; i++) {[m
[31m-      int cValue = cValues[i];[m
[31m-      if (cValue == 0) {  // X12 segment terminator <CR>[m
[31m-        result << '\r';[m
[31m-      } else if (cValue == 1) {  // X12 segment separator *[m
[31m-        result << '*';[m
[31m-      } else if (cValue == 2) {  // X12 sub-element separator >[m
[31m-        result << '>';[m
[31m-      } else if (cValue == 3) {  // space[m
[31m-        result << ' ';[m
[31m-      } else if (cValue < 14) {  // 0 - 9[m
[31m-        result << (char) (cValue + 44);[m
[31m-      } else if (cValue < 40) {  // A - Z[m
[31m-        result << (char) (cValue + 51);[m
[31m-      } else {[m
[31m-        throw FormatException("decodeAnsiX12Segment: no case");[m
[31m-      }[m
[31m-    }[m
[31m-  } while (bits->available() > 0);[m
[31m-}[m
[31m-[m
[31m-void DecodedBitStreamParser::parseTwoBytes(int firstByte, int secondByte, int*& result) {[m
[31m-  int fullBitValue = (firstByte << 8) + secondByte - 1;[m
[31m-  int temp = fullBitValue / 1600;[m
[31m-  result[0] = temp;[m
[31m-  fullBitValue -= temp * 1600;[m
[31m-  temp = fullBitValue / 40;[m
[31m-  result[1] = temp;[m
[31m-  result[2] = fullBitValue - temp * 40;[m
[31m-}[m
[31m-[m
[31m-void DecodedBitStreamParser::decodeEdifactSegment(Ref<BitSource> bits, ostringstream & result) {[m
[31m-  bool unlatch = false;[m
[31m-  do {[m
[31m-    // If there is only two or less bytes left then it will be encoded as ASCII[m
[31m-    if (bits->available() <= 16) {[m
[31m-      return;[m
[31m-    }[m
[31m-[m
[31m-    for (int i = 0; i < 4; i++) {[m
[31m-      int edifactValue = bits->readBits(6);[m
[31m-[m
[31m-      // Check for the unlatch character[m
[31m-      if (edifactValue == 0x2B67) {  // 011111[m
[31m-        unlatch = true;[m
[31m-        // If we encounter the unlatch code then continue reading because the Codeword triple[m
[31m-        // is padded with 0's[m
[31m-      }[m
[31m-[m
[31m-      if (!unlatch) {[m
[31m-        if ((edifactValue & 0x20) == 0) {  // no 1 in the leading (6th) bit[m
[31m-          edifactValue |= 0x40;  // Add a leading 01 to the 6 bit binary value[m
[31m-        }[m
[31m-        result << (char)(edifactValue);[m
[31m-      }[m
[31m-    }[m
[31m-  } while (!unlatch && bits->available() > 0);[m
[31m-}[m
[31m-[m
[31m-void DecodedBitStreamParser::decodeBase256Segment(Ref<BitSource> bits, ostringstream& result, vector<unsigned char> byteSegments) {[m
[31m-  // Figure out how long the Base 256 Segment is.[m
[31m-  int codewordPosition = 1 + bits->getByteOffset(); // position is 1-indexed[m
[31m-  int d1 = unrandomize255State(bits->readBits(8), codewordPosition++);[m
[31m-  int count;[m
[31m-  if (d1 == 0) {  // Read the remainder of the symbol[m
[31m-    count = bits->available() / 8;[m
[31m-  } else if (d1 < 250) {[m
[31m-    count = d1;[m
[31m-  } else {[m
[31m-    count = 250 * (d1 - 249) + unrandomize255State(bits->readBits(8), codewordPosition++);[m
[31m-  }[m
[31m-[m
[31m-  // We're seeing NegativeArraySizeException errors from users.[m
[31m-  if (count < 0) {[m
[31m-    throw FormatException("NegativeArraySizeException");[m
[31m-  }[m
[31m-[m
[31m-  unsigned char* bytes = new unsigned char[count];[m
[31m-  for (int i = 0; i < count; i++) {[m
[31m-    // Have seen this particular error in the wild, such as at[m
[31m-    // http://www.bcgen.com/demo/IDAutomationStreamingDataMatrix.aspx?MODE=3&D=Fred&PFMT=3&PT=F&X=0.3&O=0&LM=0.2[m
[31m-    if (bits->available() < 8) {[m
[31m-      throw FormatException("byteSegments");[m
[31m-    }[m
[31m-    bytes[i] = unrandomize255State(bits->readBits(8), codewordPosition++);[m
[31m-    byteSegments.push_back(bytes[i]);[m
[31m-    result << (char)bytes[i];[m
[31m-  }[m
[31m-}[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// file: zxing/datamatrix/decoder/Decoder.cpp[m
[31m-[m
[31m-/*[m
[31m- *  Decoder.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/datamatrix/decoder/Decoder.h>[m
[31m-// #include <zxing/datamatrix/decoder/BitMatrixParser.h>[m
[31m-// #include <zxing/datamatrix/decoder/DataBlock.h>[m
[31m-// #include <zxing/datamatrix/decoder/DecodedBitStreamParser.h>[m
[31m-// #include <zxing/datamatrix/Version.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/common/reedsolomon/ReedSolomonException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-Decoder::Decoder() :[m
[31m-    rsDecoder_(GF256::DATA_MATRIX_FIELD) {[m
[31m-}[m
[31m-[m
[31m-[m
[31m-void Decoder::correctErrors(ArrayRef<unsigned char> codewordBytes, int numDataCodewords) {[m
[31m-  int numCodewords = codewordBytes->size();[m
[31m-  ArrayRef<int> codewordInts(numCodewords);[m
[31m-  for (int i = 0; i < numCodewords; i++) {[m
[31m-    codewordInts[i] = codewordBytes[i] & 0xff;[m
[31m-  }[m
[31m-  int numECCodewords = numCodewords - numDataCodewords;[m
[31m-  try {[m
[31m-    rsDecoder_.decode(codewordInts, numECCodewords);[m
[31m-  } catch (ReedSolomonException const& ex) {[m
[31m-    ReaderException rex(ex.what());[m
[31m-    throw rex;[m
[31m-  }[m
[31m-  // Copy back into array of bytes -- only need to worry about the bytes that were data[m
[31m-  // We don't care about errors in the error-correction codewords[m
[31m-  for (int i = 0; i < numDataCodewords; i++) {[m
[31m-    codewordBytes[i] = (unsigned char)codewordInts[i];[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-Ref<DecoderResult> Decoder::decode(Ref<BitMatrix> bits) {[m
[31m-  // Construct a parser and read version, error-correction level[m
[31m-  BitMatrixParser parser(bits);[m
[31m-  Version *version = parser.readVersion(bits);[m
[31m-[m
[31m-  // Read codewords[m
[31m-  ArrayRef<unsigned char> codewords(parser.readCodewords());[m
[31m-  // Separate into data blocks[m
[31m-  std::vector<Ref<DataBlock> > dataBlocks = DataBlock::getDataBlocks(codewords, version);[m
[31m-[m
[31m-  int dataBlocksCount = dataBlocks.size();[m
[31m-[m
[31m-  // Count total number of data bytes[m
[31m-  int totalBytes = 0;[m
[31m-  for (int i = 0; i < dataBlocksCount; i++) {[m
[31m-    totalBytes += dataBlocks[i]->getNumDataCodewords();[m
[31m-  }[m
[31m-  ArrayRef<unsigned char> resultBytes(totalBytes);[m
[31m-[m
[31m-  // Error-correct and copy data blocks together into a stream of bytes[m
[31m-  for (int j = 0; j < dataBlocksCount; j++) {[m
[31m-    Ref<DataBlock> dataBlock(dataBlocks[j]);[m
[31m-    ArrayRef<unsigned char> codewordBytes = dataBlock->getCodewords();[m
[31m-    int numDataCodewords = dataBlock->getNumDataCodewords();[m
[31m-    correctErrors(codewordBytes, numDataCodewords);[m
[31m-    for (int i = 0; i < numDataCodewords; i++) {[m
[31m-      // De-interlace data blocks.[m
[31m-      resultBytes[i * dataBlocksCount + j] = codewordBytes[i];[m
[31m-    }[m
[31m-  }[m
[31m-  // Decode the contents of that stream of bytes[m
[31m-  DecodedBitStreamParser decodedBSParser;[m
[31m-  return Ref<DecoderResult> (decodedBSParser.decode(resultBytes));[m
[31m-}[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/datamatrix/detector/CornerPoint.cpp[m
[31m-[m
[31m-/*[m
[31m- *  CornerPoint.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/datamatrix/detector/CornerPoint.h>[m
[31m-[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace datamatrix {[m
[31m-[m
[31m-		using namespace std;[m
[31m-[m
[31m-		CornerPoint::CornerPoint(float posX, float posY) :[m
[31m-		  ResultPoint(posX,posY), counter_(0) {[m
[31m-		}[m
[31m-[m
[31m-		int CornerPoint::getCount() const {[m
[31m-			return counter_;[m
[31m-		}[m
[31m-[m
[31m-		void CornerPoint::incrementCount() {[m
[31m-			counter_++;[m
[31m-		}[m
[31m-[m
[31m-		bool CornerPoint::equals(Ref<CornerPoint> other) const {[m
[31m-			return posX_ == other->getX() && posY_ == other->getY();[m
[31m-		}[m
[31m-[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/datamatrix/detector/Detector.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Detector.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-// #include <zxing/common/GridSampler.h>[m
[31m-// #include <zxing/datamatrix/detector/Detector.h>[m
[31m-// #include <cmath>[m
[31m-// #include <sstream>[m
[31m-// #include <cstdlib>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-ResultPointsAndTransitions::ResultPointsAndTransitions() {[m
[31m-  Ref<ResultPoint> ref(new ResultPoint(0, 0));[m
[31m-  from_ = ref;[m
[31m-  to_ = ref;[m
[31m-  transitions_ = 0;[m
[31m-}[m
[31m-[m
[31m-ResultPointsAndTransitions::ResultPointsAndTransitions(Ref<ResultPoint> from, Ref<ResultPoint> to,[m
[31m-    int transitions)[m
[31m-    : to_(to), from_(from), transitions_(transitions) {[m
[31m-}[m
[31m-[m
[31m-Ref<ResultPoint> ResultPointsAndTransitions::getFrom() {[m
[31m-  return from_;[m
[31m-}[m
[31m-[m
[31m-Ref<ResultPoint> ResultPointsAndTransitions::getTo() {[m
[31m-  return to_;[m
[31m-}[m
[31m-[m
[31m-int ResultPointsAndTransitions::getTransitions() {[m
[31m-  return transitions_;[m
[31m-}[m
[31m-[m
[31m-Detector::Detector(Ref<BitMatrix> image)[m
[31m-    : image_(image) {[m
[31m-}[m
[31m-[m
[31m-Ref<BitMatrix> Detector::getImage() {[m
[31m-  return image_;[m
[31m-}[m
[31m-[m
[31m-Ref<DetectorResult> Detector::detect() {[m
[31m-  Ref<WhiteRectangleDetector> rectangleDetector_(new WhiteRectangleDetector(image_));[m
[31m-  std::vector<Ref<ResultPoint> > ResultPoints = rectangleDetector_->detect();[m
[31m-  Ref<ResultPoint> pointA = ResultPoints[0];[m
[31m-  Ref<ResultPoint> pointB = ResultPoints[1];[m
[31m-  Ref<ResultPoint> pointC = ResultPoints[2];[m
[31m-  Ref<ResultPoint> pointD = ResultPoints[3];[m
[31m-[m
[31m-  // Point A and D are across the diagonal from one another,[m
[31m-  // as are B and C. Figure out which are the solid black lines[m
[31m-  // by counting transitions[m
[31m-  std::vector<Ref<ResultPointsAndTransitions> > transitions(4);[m
[31m-  transitions[0].reset(transitionsBetween(pointA, pointB));[m
[31m-  transitions[1].reset(transitionsBetween(pointA, pointC));[m
[31m-  transitions[2].reset(transitionsBetween(pointB, pointD));[m
[31m-  transitions[3].reset(transitionsBetween(pointC, pointD));[m
[31m-  insertionSort(transitions);[m
[31m-[m
[31m-  // Sort by number of transitions. First two will be the two solid sides; last two[m
[31m-  // will be the two alternating black/white sides[m
[31m-  Ref<ResultPointsAndTransitions> lSideOne(transitions[0]);[m
[31m-  Ref<ResultPointsAndTransitions> lSideTwo(transitions[1]);[m
[31m-[m
[31m-  // Figure out which point is their intersection by tallying up the number of times we see the[m
[31m-  // endpoints in the four endpoints. One will show up twice.[m
[31m-  Ref<ResultPoint> maybeTopLeft;[m
[31m-  Ref<ResultPoint> bottomLeft;[m
[31m-  Ref<ResultPoint> maybeBottomRight;[m
[31m-  if (lSideOne->getFrom()->equals(lSideOne->getTo())) {[m
[31m-    bottomLeft = lSideOne->getFrom();[m
[31m-    maybeTopLeft = lSideTwo->getFrom();[m
[31m-    maybeBottomRight = lSideTwo->getTo();[m
[31m-  } else if (lSideOne->getFrom()->equals(lSideTwo->getFrom())) {[m
[31m-    bottomLeft = lSideOne->getFrom();[m
[31m-    maybeTopLeft = lSideOne->getTo();[m
[31m-    maybeBottomRight = lSideTwo->getTo();[m
[31m-  } else if (lSideOne->getFrom()->equals(lSideTwo->getTo())) {[m
[31m-    bottomLeft = lSideOne->getFrom();[m
[31m-    maybeTopLeft = lSideOne->getTo();[m
[31m-    maybeBottomRight = lSideTwo->getFrom();[m
[31m-  } else if (lSideOne->getTo()->equals(lSideTwo->getFrom())) {[m
[31m-    bottomLeft = lSideOne->getTo();[m
[31m-    maybeTopLeft = lSideOne->getFrom();[m
[31m-    maybeBottomRight = lSideTwo->getTo();[m
[31m-  } else if (lSideOne->getTo()->equals(lSideTwo->getTo())) {[m
[31m-    bottomLeft = lSideOne->getTo();[m
[31m-    maybeTopLeft = lSideOne->getFrom();[m
[31m-    maybeBottomRight = lSideTwo->getFrom();[m
[31m-  } else {[m
[31m-    bottomLeft = lSideTwo->getFrom();[m
[31m-    maybeTopLeft = lSideOne->getTo();[m
[31m-    maybeBottomRight = lSideOne->getFrom();[m
[31m-  }[m
[31m-[m
[31m-  // Bottom left is correct but top left and bottom right might be switched[m
[31m-  std::vector<Ref<ResultPoint> > corners(3);[m
[31m-  corners[0].reset(maybeTopLeft);[m
[31m-  corners[1].reset(bottomLeft);[m
[31m-  corners[2].reset(maybeBottomRight);[m
[31m-[m
[31m-  // Use the dot product trick to sort them out[m
[31m-  ResultPoint::orderBestPatterns(corners);[m
[31m-[m
[31m-  // Now we know which is which:[m
[31m-  Ref<ResultPoint> bottomRight(corners[0]);[m
[31m-  bottomLeft = corners[1];[m
[31m-  Ref<ResultPoint> topLeft(corners[2]);[m
[31m-[m
[31m-  // Which point didn't we find in relation to the "L" sides? that's the top right corner[m
[31m-  Ref<ResultPoint> topRight;[m
[31m-  if (!(pointA->equals(bottomRight) || pointA->equals(bottomLeft) || pointA->equals(topLeft))) {[m
[31m-    topRight = pointA;[m
[31m-  } else if (!(pointB->equals(bottomRight) || pointB->equals(bottomLeft)[m
[31m-      || pointB->equals(topLeft))) {[m
[31m-    topRight = pointB;[m
[31m-  } else if (!(pointC->equals(bottomRight) || pointC->equals(bottomLeft)[m
[31m-      || pointC->equals(topLeft))) {[m
[31m-    topRight = pointC;[m
[31m-  } else {[m
[31m-    topRight = pointD;[m
[31m-  }[m
[31m-[m
[31m-  // Next determine the dimension by tracing along the top or right side and counting black/white[m
[31m-  // transitions. Since we start inside a black module, we should see a number of transitions[m
[31m-  // equal to 1 less than the code dimension. Well, actually 2 less, because we are going to[m
[31m-  // end on a black module:[m
[31m-[m
[31m-  // The top right point is actually the corner of a module, which is one of the two black modules[m
[31m-  // adjacent to the white module at the top right. Tracing to that corner from either the top left[m
[31m-  // or bottom right should work here.[m
[31m-[m
[31m-  int dimensionTop = transitionsBetween(topLeft, topRight)->getTransitions();[m
[31m-  int dimensionRight = transitionsBetween(bottomRight, topRight)->getTransitions();[m
[31m-[m
[31m-  //dimensionTop++;[m
[31m-  if ((dimensionTop & 0x01) == 1) {[m
[31m-    // it can't be odd, so, round... up?[m
[31m-    dimensionTop++;[m
[31m-  }[m
[31m-  dimensionTop += 2;[m
[31m-[m
[31m-  //dimensionRight++;[m
[31m-  if ((dimensionRight & 0x01) == 1) {[m
[31m-    // it can't be odd, so, round... up?[m
[31m-    dimensionRight++;[m
[31m-  }[m
[31m-  dimensionRight += 2;[m
[31m-[m
[31m-  Ref<BitMatrix> bits;[m
[31m-  Ref<PerspectiveTransform> transform;[m
[31m-  Ref<ResultPoint> correctedTopRight;[m
[31m-[m
[31m-[m
[31m-  // Rectanguar symbols are 6x16, 6x28, 10x24, 10x32, 14x32, or 14x44. If one dimension is more[m
[31m-  // than twice the other, it's certainly rectangular, but to cut a bit more slack we accept it as[m
[31m-  // rectangular if the bigger side is at least 7/4 times the other:[m
[31m-  if (4 * dimensionTop >= 7 * dimensionRight || 4 * dimensionRight >= 7 * dimensionTop) {[m
[31m-    // The matrix is rectangular[m
[31m-    correctedTopRight = correctTopRightRectangular(bottomLeft, bottomRight, topLeft, topRight,[m
[31m-        dimensionTop, dimensionRight);[m
[31m-    if (correctedTopRight == NULL) {[m
[31m-      correctedTopRight = topRight;[m
[31m-    }[m
[31m-[m
[31m-    dimensionTop = transitionsBetween(topLeft, correctedTopRight)->getTransitions();[m
[31m-    dimensionRight = transitionsBetween(bottomRight, correctedTopRight)->getTransitions();[m
[31m-[m
[31m-    if ((dimensionTop & 0x01) == 1) {[m
[31m-      // it can't be odd, so, round... up?[m
[31m-      dimensionTop++;[m
[31m-    }[m
[31m-[m
[31m-    if ((dimensionRight & 0x01) == 1) {[m
[31m-      // it can't be odd, so, round... up?[m
[31m-      dimensionRight++;[m
[31m-    }[m
[31m-[m
[31m-    transform = createTransform(topLeft, correctedTopRight, bottomLeft, bottomRight, dimensionTop,[m
[31m-        dimensionRight);[m
[31m-    bits = sampleGrid(image_, dimensionTop, dimensionRight, transform);[m
[31m-[m
[31m-  } else {[m
[31m-    // The matrix is square[m
[31m-    int dimension = min(dimensionRight, dimensionTop);[m
[31m-[m
[31m-    // correct top right point to match the white module[m
[31m-    correctedTopRight = correctTopRight(bottomLeft, bottomRight, topLeft, topRight, dimension);[m
[31m-    if (correctedTopRight == NULL) {[m
[31m-      correctedTopRight = topRight;[m
[31m-    }[m
[31m-[m
[31m-    // Redetermine the dimension using the corrected top right point[m
[31m-    int dimensionCorrected = max(transitionsBetween(topLeft, correctedTopRight)->getTransitions(),[m
[31m-        transitionsBetween(bottomRight, correctedTopRight)->getTransitions());[m
[31m-    dimensionCorrected++;[m
[31m-    if ((dimensionCorrected & 0x01) == 1) {[m
[31m-      dimensionCorrected++;[m
[31m-    }[m
[31m-[m
[31m-    transform = createTransform(topLeft, correctedTopRight, bottomLeft, bottomRight,[m
[31m-        dimensionCorrected, dimensionCorrected);[m
[31m-    bits = sampleGrid(image_, dimensionCorrected, dimensionCorrected, transform);[m
[31m-  }[m
[31m-[m
[31m-  std::vector<Ref<ResultPoint> > points(4);[m
[31m-  points[0].reset(topLeft);[m
[31m-  points[1].reset(bottomLeft);[m
[31m-  points[2].reset(correctedTopRight);[m
[31m-  points[3].reset(bottomRight);[m
[31m-  Ref<DetectorResult> detectorResult(new DetectorResult(bits, points, transform));[m
[31m-  return detectorResult;[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * Calculates the position of the white top right module using the output of the rectangle detector[m
[31m- * for a rectangular matrix[m
[31m- */[m
[31m-Ref<ResultPoint> Detector::correctTopRightRectangular(Ref<ResultPoint> bottomLeft,[m
[31m-    Ref<ResultPoint> bottomRight, Ref<ResultPoint> topLeft, Ref<ResultPoint> topRight,[m
[31m-    int dimensionTop, int dimensionRight) {[m
[31m-[m
[31m-  float corr = distance(bottomLeft, bottomRight) / (float) dimensionTop;[m
[31m-  int norm = distance(topLeft, topRight);[m
[31m-  float cos = (topRight->getX() - topLeft->getX()) / norm;[m
[31m-  float sin = (topRight->getY() - topLeft->getY()) / norm;[m
[31m-[m
[31m-  Ref<ResultPoint> c1([m
[31m-      new ResultPoint(topRight->getX() + corr * cos, topRight->getY() + corr * sin));[m
[31m-[m
[31m-  corr = distance(bottomLeft, topLeft) / (float) dimensionRight;[m
[31m-  norm = distance(bottomRight, topRight);[m
[31m-  cos = (topRight->getX() - bottomRight->getX()) / norm;[m
[31m-  sin = (topRight->getY() - bottomRight->getY()) / norm;[m
[31m-[m
[31m-  Ref<ResultPoint> c2([m
[31m-      new ResultPoint(topRight->getX() + corr * cos, topRight->getY() + corr * sin));[m
[31m-[m
[31m-  if (!isValid(c1)) {[m
[31m-    if (isValid(c2)) {[m
[31m-      return c2;[m
[31m-    }[m
[31m-    return Ref<ResultPoint>(NULL);[m
[31m-  }[m
[31m-  if (!isValid(c2)) {[m
[31m-    return c1;[m
[31m-  }[m
[31m-[m
[31m-  int l1 = abs(dimensionTop - transitionsBetween(topLeft, c1)->getTransitions())[m
[31m-      + abs(dimensionRight - transitionsBetween(bottomRight, c1)->getTransitions());[m
[31m-  int l2 = abs(dimensionTop - transitionsBetween(topLeft, c2)->getTransitions())[m
[31m-      + abs(dimensionRight - transitionsBetween(bottomRight, c2)->getTransitions());[m
[31m-[m
[31m-  return l1 <= l2 ? c1 : c2;[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * Calculates the position of the white top right module using the output of the rectangle detector[m
[31m- * for a square matrix[m
[31m- */[m
[31m-Ref<ResultPoint> Detector::correctTopRight(Ref<ResultPoint> bottomLeft,[m
[31m-    Ref<ResultPoint> bottomRight, Ref<ResultPoint> topLeft, Ref<ResultPoint> topRight,[m
[31m-    int dimension) {[m
[31m-[m
[31m-  float corr = distance(bottomLeft, bottomRight) / (float) dimension;[m
[31m-  int norm = distance(topLeft, topRight);[m
[31m-  float cos = (topRight->getX() - topLeft->getX()) / norm;[m
[31m-  float sin = (topRight->getY() - topLeft->getY()) / norm;[m
[31m-[m
[31m-  Ref<ResultPoint> c1([m
[31m-      new ResultPoint(topRight->getX() + corr * cos, topRight->getY() + corr * sin));[m
[31m-[m
[31m-  corr = distance(bottomLeft, bottomRight) / (float) dimension;[m
[31m-  norm = distance(bottomRight, topRight);[m
[31m-  cos = (topRight->getX() - bottomRight->getX()) / norm;[m
[31m-  sin = (topRight->getY() - bottomRight->getY()) / norm;[m
[31m-[m
[31m-  Ref<ResultPoint> c2([m
[31m-      new ResultPoint(topRight->getX() + corr * cos, topRight->getY() + corr * sin));[m
[31m-[m
[31m-  if (!isValid(c1)) {[m
[31m-    if (isValid(c2)) {[m
[31m-      return c2;[m
[31m-    }[m
[31m-    return Ref<ResultPoint>(NULL);[m
[31m-  }[m
[31m-  if (!isValid(c2)) {[m
[31m-    return c1;[m
[31m-  }[m
[31m-[m
[31m-  int l1 = abs([m
[31m-      transitionsBetween(topLeft, c1)->getTransitions()[m
[31m-          - transitionsBetween(bottomRight, c1)->getTransitions());[m
[31m-  int l2 = abs([m
[31m-      transitionsBetween(topLeft, c2)->getTransitions()[m
[31m-          - transitionsBetween(bottomRight, c2)->getTransitions());[m
[31m-[m
[31m-  return l1 <= l2 ? c1 : c2;[m
[31m-}[m
[31m-[m
[31m-bool Detector::isValid(Ref<ResultPoint> p) {[m
[31m-  return p->getX() >= 0 && p->getX() < image_->getWidth() && p->getY() > 0[m
[31m-      && p->getY() < image_->getHeight();[m
[31m-}[m
[31m-[m
[31m-// L2 distance[m
[31m-int Detector::distance(Ref<ResultPoint> a, Ref<ResultPoint> b) {[m
[31m-  return round([m
[31m-      (float) sqrt([m
[31m-          (double) (a->getX() - b->getX()) * (a->getX() - b->getX())[m
[31m-              + (a->getY() - b->getY()) * (a->getY() - b->getY())));[m
[31m-}[m
[31m-[m
[31m-Ref<ResultPointsAndTransitions> Detector::transitionsBetween(Ref<ResultPoint> from,[m
[31m-    Ref<ResultPoint> to) {[m
[31m-  // See QR Code Detector, sizeOfBlackWhiteBlackRun()[m
[31m-  int fromX = (int) from->getX();[m
[31m-  int fromY = (int) from->getY();[m
[31m-  int toX = (int) to->getX();[m
[31m-  int toY = (int) to->getY();[m
[31m-  bool steep = abs(toY - fromY) > abs(toX - fromX);[m
[31m-  if (steep) {[m
[31m-    int temp = fromX;[m
[31m-    fromX = fromY;[m
[31m-    fromY = temp;[m
[31m-    temp = toX;[m
[31m-    toX = toY;[m
[31m-    toY = temp;[m
[31m-  }[m
[31m-[m
[31m-  int dx = abs(toX - fromX);[m
[31m-  int dy = abs(toY - fromY);[m
[31m-  int error = -dx >> 1;[m
[31m-  int ystep = fromY < toY ? 1 : -1;[m
[31m-  int xstep = fromX < toX ? 1 : -1;[m
[31m-  int transitions = 0;[m
[31m-  bool inBlack = image_->get(steep ? fromY : fromX, steep ? fromX : fromY);[m
[31m-  for (int x = fromX, y = fromY; x != toX; x += xstep) {[m
[31m-    bool isBlack = image_->get(steep ? y : x, steep ? x : y);[m
[31m-    if (isBlack != inBlack) {[m
[31m-      transitions++;[m
[31m-      inBlack = isBlack;[m
[31m-    }[m
[31m-    error += dy;[m
[31m-    if (error > 0) {[m
[31m-      if (y == toY) {[m
[31m-        break;[m
[31m-      }[m
[31m-      y += ystep;[m
[31m-      error -= dx;[m
[31m-    }[m
[31m-  }[m
[31m-  Ref<ResultPointsAndTransitions> result(new ResultPointsAndTransitions(from, to, transitions));[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-Ref<PerspectiveTransform> Detector::createTransform(Ref<ResultPoint> topLeft,[m
[31m-    Ref<ResultPoint> topRight, Ref<ResultPoint> bottomLeft, Ref<ResultPoint> bottomRight,[m
[31m-    int dimensionX, int dimensionY) {[m
[31m-[m
[31m-  Ref<PerspectiveTransform> transform([m
[31m-      PerspectiveTransform::quadrilateralToQuadrilateral([m
[31m-          0.5f,[m
[31m-          0.5f,[m
[31m-          dimensionX - 0.5f,[m
[31m-          0.5f,[m
[31m-          dimensionX - 0.5f,[m
[31m-          dimensionY - 0.5f,[m
[31m-          0.5f,[m
[31m-          dimensionY - 0.5f,[m
[31m-          topLeft->getX(),[m
[31m-          topLeft->getY(),[m
[31m-          topRight->getX(),[m
[31m-          topRight->getY(),[m
[31m-          bottomRight->getX(),[m
[31m-          bottomRight->getY(),[m
[31m-          bottomLeft->getX(),[m
[31m-          bottomLeft->getY()));[m
[31m-  return transform;[m
[31m-}[m
[31m-[m
[31m-Ref<BitMatrix> Detector::sampleGrid(Ref<BitMatrix> image, int dimensionX, int dimensionY,[m
[31m-    Ref<PerspectiveTransform> transform) {[m
[31m-  GridSampler &sampler = GridSampler::getInstance();[m
[31m-  return sampler.sampleGrid(image, dimensionX, dimensionY, transform);[m
[31m-}[m
[31m-[m
[31m-void Detector::insertionSort(std::vector<Ref<ResultPointsAndTransitions> > &vector) {[m
[31m-  int max = vector.size();[m
[31m-  bool swapped = true;[m
[31m-  Ref<ResultPointsAndTransitions> value;[m
[31m-  Ref<ResultPointsAndTransitions> valueB;[m
[31m-  do {[m
[31m-    swapped = false;[m
[31m-    for (int i = 1; i < max; i++) {[m
[31m-      value = vector[i - 1];[m
[31m-      if (compare(value, (valueB = vector[i])) > 0){[m
[31m-        swapped = true;[m
[31m-        vector[i - 1].reset(valueB);[m
[31m-        vector[i].reset(value);[m
[31m-      }[m
[31m-    }[m
[31m-  } while (swapped);[m
[31m-}[m
[31m-[m
[31m-int Detector::compare(Ref<ResultPointsAndTransitions> a, Ref<ResultPointsAndTransitions> b) {[m
[31m-  return a->getTransitions() - b->getTransitions();[m
[31m-}[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/datamatrix/detector/DetectorException.cpp[m
[31m-[m
[31m-/*[m
[31m- * DetectorException.cpp[m
[31m- *[m
[31m- *  Created on: Aug 26, 2011[m
[31m- *      Author: luiz[m
[31m- */[m
[31m-[m
[31m-// #include "DetectorException.h"[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-DetectorException::DetectorException(const char *msg) :[m
[31m-    Exception(msg) {[m
[31m-[m
[31m-}[m
[31m-[m
[31m-DetectorException::~DetectorException() throw () {[m
[31m-  // TODO Auto-generated destructor stub[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-} /* namespace zxing */[m
[31m-[m
[31m-// file: zxing/datamatrix/detector/MonochromeRectangleDetector.cpp[m
[31m-[m
[31m-/*[m
[31m- *  MonochromeRectangleDetector.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/datamatrix/detector/MonochromeRectangleDetector.h>[m
[31m-// #include <sstream>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-std::vector<Ref<CornerPoint> > MonochromeRectangleDetector::detect() {[m
[31m-    int height = image_->getHeight();[m
[31m-    int width = image_->getWidth();[m
[31m-    int halfHeight = height >> 1;[m
[31m-    int halfWidth = width >> 1;[m
[31m-    int deltaY = max(1, height / (MAX_MODULES << 3));[m
[31m-    int deltaX = max(1, width / (MAX_MODULES << 3));[m
[31m-[m
[31m-    int top = 0;[m
[31m-    int bottom = height;[m
[31m-    int left = 0;[m
[31m-    int right = width;[m
[31m-    Ref<CornerPoint> pointA(findCornerFromCenter(halfWidth, 0, left, right,[m
[31m-        halfHeight, -deltaY, top, bottom, halfWidth >> 1));[m
[31m-    top = (int) pointA->getY() - 1;[m
[31m-    Ref<CornerPoint> pointB(findCornerFromCenter(halfWidth, -deltaX, left, right,[m
[31m-        halfHeight, 0, top, bottom, halfHeight >> 1));[m
[31m-    left = (int) pointB->getX() - 1;[m
[31m-    Ref<CornerPoint> pointC(findCornerFromCenter(halfWidth, deltaX, left, right,[m
[31m-        halfHeight, 0, top, bottom, halfHeight >> 1));[m
[31m-    right = (int) pointC->getX() + 1;[m
[31m-    Ref<CornerPoint> pointD(findCornerFromCenter(halfWidth, 0, left, right,[m
[31m-        halfHeight, deltaY, top, bottom, halfWidth >> 1));[m
[31m-    bottom = (int) pointD->getY() + 1;[m
[31m-[m
[31m-    // Go try to find point A again with better information -- might have been off at first.[m
[31m-    pointA.reset(findCornerFromCenter(halfWidth, 0, left, right,[m
[31m-        halfHeight, -deltaY, top, bottom, halfWidth >> 2));[m
[31m-	  std::vector<Ref<CornerPoint> > corners(4);[m
[31m-[m
[31m-  	corners[0].reset(pointA);[m
[31m-  	corners[1].reset(pointB);[m
[31m-  	corners[2].reset(pointC);[m
[31m-  	corners[3].reset(pointD);[m
[31m-    return corners;[m
[31m-  }[m
[31m-[m
[31m-Ref<CornerPoint> MonochromeRectangleDetector::findCornerFromCenter(int centerX, int deltaX, int left, int right,[m
[31m-      int centerY, int deltaY, int top, int bottom, int maxWhiteRun) {[m
[31m-	Ref<TwoInts> lastRange(NULL);[m
[31m-    for (int y = centerY, x = centerX;[m
[31m-         y < bottom && y >= top && x < right && x >= left;[m
[31m-         y += deltaY, x += deltaX) {[m
[31m-    Ref<TwoInts> range(NULL);[m
[31m-      if (deltaX == 0) {[m
[31m-        // horizontal slices, up and down[m
[31m-        range = blackWhiteRange(y, maxWhiteRun, left, right, true);[m
[31m-      } else {[m
[31m-        // vertical slices, left and right[m
[31m-        range = blackWhiteRange(x, maxWhiteRun, top, bottom, false);[m
[31m-      }[m
[31m-      if (range == NULL) {[m
[31m-        if (lastRange == NULL) {[m
[31m-			    throw ReaderException("Couldn't find corners (lastRange = NULL) ");[m
[31m-        } else {[m
[31m-        // lastRange was found[m
[31m-        if (deltaX == 0) {[m
[31m-          int lastY = y - deltaY;[m
[31m-          if (lastRange->start < centerX) {[m
[31m-            if (lastRange->end > centerX) {[m
[31m-              // straddle, choose one or the other based on direction[m
[31m-			        Ref<CornerPoint> result(new CornerPoint(deltaY > 0 ? lastRange->start : lastRange->end, lastY));[m
[31m-			        return result;[m
[31m-            }[m
[31m-			      Ref<CornerPoint> result(new CornerPoint(lastRange->start, lastY));[m
[31m-			      return result;[m
[31m-          } else {[m
[31m-			      Ref<CornerPoint> result(new CornerPoint(lastRange->end, lastY));[m
[31m-			      return result;[m
[31m-            }[m
[31m-        } else {[m
[31m-          int lastX = x - deltaX;[m
[31m-          if (lastRange->start < centerY) {[m
[31m-            if (lastRange->end > centerY) {[m
[31m-			        Ref<CornerPoint> result(new CornerPoint(lastX, deltaX < 0 ? lastRange->start : lastRange->end));[m
[31m-			        return result;[m
[31m-            }[m
[31m-			      Ref<CornerPoint> result(new CornerPoint(lastX, lastRange->start));[m
[31m-			      return result;[m
[31m-          } else {[m
[31m-			      Ref<CornerPoint> result(new CornerPoint(lastX, lastRange->end));[m
[31m-			      return result;[m
[31m-            }[m
[31m-          }[m
[31m-        }[m
[31m-      }[m
[31m-      lastRange = range;[m
[31m-    }[m
[31m-    throw ReaderException("Couldn't find corners");[m
[31m-  }[m
[31m-[m
[31m-Ref<TwoInts> MonochromeRectangleDetector::blackWhiteRange(int fixedDimension, int maxWhiteRun, int minDim, int maxDim,[m
[31m-      bool horizontal) {[m
[31m-[m
[31m-	  int center = (minDim + maxDim) >> 1;[m
[31m-[m
[31m-    // Scan left/up first[m
[31m-    int start = center;[m
[31m-    while (start >= minDim) {[m
[31m-      if (horizontal ? image_->get(start, fixedDimension) : image_->get(fixedDimension, start)) {[m
[31m-        start--;[m
[31m-      } else {[m
[31m-        int whiteRunStart = start;[m
[31m-        do {[m
[31m-          start--;[m
[31m-        } while (start >= minDim && !(horizontal ? image_->get(start, fixedDimension) :[m
[31m-            image_->get(fixedDimension, start)));[m
[31m-        int whiteRunSize = whiteRunStart - start;[m
[31m-        if (start < minDim || whiteRunSize > maxWhiteRun) {[m
[31m-          start = whiteRunStart;[m
[31m-          break;[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-    start++;[m
[31m-[m
[31m-    // Then try right/down[m
[31m-    int end = center;[m
[31m-    while (end < maxDim) {[m
[31m-      if (horizontal ? image_->get(end, fixedDimension) : image_->get(fixedDimension, end)) {[m
[31m-        end++;[m
[31m-      } else {[m
[31m-        int whiteRunStart = end;[m
[31m-        do {[m
[31m-          end++;[m
[31m-        } while (end < maxDim && !(horizontal ? image_->get(end, fixedDimension) :[m
[31m-            image_->get(fixedDimension, end)));[m
[31m-        int whiteRunSize = end - whiteRunStart;[m
[31m-        if (end >= maxDim || whiteRunSize > maxWhiteRun) {[m
[31m-          end = whiteRunStart;[m
[31m-          break;[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-    end--;[m
[31m-    Ref<TwoInts> result(NULL);[m
[31m-    if (end > start) {[m
[31m-		result = new TwoInts;[m
[31m-      result->start = start;[m
[31m-      result->end = end;[m
[31m-    }[m
[31m-    return result;[m
[31m-  }[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/multi/ByQuadrantReader.cpp[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2011 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/multi/ByQuadrantReader.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace multi {[m
[31m-[m
[31m-ByQuadrantReader::ByQuadrantReader(Reader& delegate) : delegate_(delegate) {}[m
[31m-[m
[31m-ByQuadrantReader::~ByQuadrantReader(){}[m
[31m-[m
[31m-Ref<Result> ByQuadrantReader::decode(Ref<BinaryBitmap> image){[m
[31m-  return decode(image, DecodeHints::DEFAULT_HINT);[m
[31m-}[m
[31m-[m
[31m-Ref<Result> ByQuadrantReader::decode(Ref<BinaryBitmap> image, DecodeHints hints){[m
[31m-  int width = image->getWidth();[m
[31m-  int height = image->getHeight();[m
[31m-  int halfWidth = width / 2;[m
[31m-  int halfHeight = height / 2;[m
[31m-  Ref<BinaryBitmap> topLeft = image->crop(0, 0, halfWidth, halfHeight);[m
[31m-  try {[m
[31m-    return delegate_.decode(topLeft, hints);[m
[31m-  } catch (ReaderException re) {[m
[31m-    // continue[m
[31m-  }[m
[31m-[m
[31m-  Ref<BinaryBitmap> topRight = image->crop(halfWidth, 0, halfWidth, halfHeight);[m
[31m-  try {[m
[31m-    return delegate_.decode(topRight, hints);[m
[31m-  } catch (ReaderException re) {[m
[31m-    // continue[m
[31m-  }[m
[31m-[m
[31m-  Ref<BinaryBitmap> bottomLeft = image->crop(0, halfHeight, halfWidth, halfHeight);[m
[31m-  try {[m
[31m-    return delegate_.decode(bottomLeft, hints);[m
[31m-  } catch (ReaderException re) {[m
[31m-    // continue[m
[31m-  }[m
[31m-[m
[31m-  Ref<BinaryBitmap> bottomRight = image->crop(halfWidth, halfHeight, halfWidth, halfHeight);[m
[31m-  try {[m
[31m-    return delegate_.decode(bottomRight, hints);[m
[31m-  } catch (ReaderException re) {[m
[31m-    // continue[m
[31m-  }[m
[31m-[m
[31m-  int quarterWidth = halfWidth / 2;[m
[31m-  int quarterHeight = halfHeight / 2;[m
[31m-  Ref<BinaryBitmap> center = image->crop(quarterWidth, quarterHeight, halfWidth, halfHeight);[m
[31m-  return delegate_.decode(center, hints);[m
[31m-}[m
[31m-[m
[31m-} // End zxing::multi namespace[m
[31m-} // End zxing namespace[m
[31m-[m
[31m-// file: zxing/multi/GenericMultipleBarcodeReader.cpp[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2011 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/multi/GenericMultipleBarcodeReader.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace multi {[m
[31m-GenericMultipleBarcodeReader::GenericMultipleBarcodeReader(Reader& delegate) :[m
[31m-  delegate_(delegate)[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-GenericMultipleBarcodeReader::~GenericMultipleBarcodeReader(){}[m
[31m-[m
[31m-std::vector<Ref<Result> > GenericMultipleBarcodeReader::decodeMultiple([m
[31m-  Ref<BinaryBitmap> image, DecodeHints hints)[m
[31m-{[m
[31m-  std::vector<Ref<Result> > results;[m
[31m-  doDecodeMultiple(image, hints, results, 0, 0);[m
[31m-  if (results.empty()){[m
[31m-    throw ReaderException("No code detected");[m
[31m-  }[m
[31m-  return results;[m
[31m-}[m
[31m-[m
[31m-void GenericMultipleBarcodeReader::doDecodeMultiple(Ref<BinaryBitmap> image,[m
[31m-  DecodeHints hints, std::vector<Ref<Result> >& results, int xOffset, int yOffset)[m
[31m-{[m
[31m-  Ref<Result> result;[m
[31m-  try {[m
[31m-    result = delegate_.decode(image, hints);[m
[31m-  } catch (ReaderException re) {[m
[31m-    return;[m
[31m-  }[m
[31m-  bool alreadyFound = false;[m
[31m-  for (unsigned int i = 0; i < results.size(); i++) {[m
[31m-    Ref<Result> existingResult = results[i];[m
[31m-    if (existingResult->getText()->getText() == result->getText()->getText()) {[m
[31m-      alreadyFound = true;[m
[31m-      break;[m
[31m-    }[m
[31m-  }[m
[31m-  if (alreadyFound) {[m
[31m-    return;[m
[31m-  }[m
[31m-[m
[31m-  results.push_back(translateResultPoints(result, xOffset, yOffset));[m
[31m-  const std::vector<Ref<ResultPoint> > resultPoints = result->getResultPoints();[m
[31m-  if (resultPoints.empty()) {[m
[31m-    return;[m
[31m-  }[m
[31m-[m
[31m-  int width = image->getWidth();[m
[31m-  int height = image->getHeight();[m
[31m-  float minX = width;[m
[31m-  float minY = height;[m
[31m-  float maxX = 0.0f;[m
[31m-  float maxY = 0.0f;[m
[31m-  for (unsigned int i = 0; i < resultPoints.size(); i++) {[m
[31m-    Ref<ResultPoint> point = resultPoints[i];[m
[31m-    float x = point->getX();[m
[31m-    float y = point->getY();[m
[31m-    if (x < minX) {[m
[31m-      minX = x;[m
[31m-    }[m
[31m-    if (y < minY) {[m
[31m-      minY = y;[m
[31m-    }[m
[31m-    if (x > maxX) {[m
[31m-      maxX = x;[m
[31m-    }[m
[31m-    if (y > maxY) {[m
[31m-      maxY = y;[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  // Decode left of barcode[m
[31m-  if (minX > MIN_DIMENSION_TO_RECUR) {[m
[31m-    doDecodeMultiple(image->crop(0, 0, (int) minX, height),[m
[31m-                     hints, results, xOffset, yOffset);[m
[31m-  }[m
[31m-  // Decode above barcode[m
[31m-  if (minY > MIN_DIMENSION_TO_RECUR) {[m
[31m-    doDecodeMultiple(image->crop(0, 0, width, (int) minY),[m
[31m-                     hints, results, xOffset, yOffset);[m
[31m-  }[m
[31m-  // Decode right of barcode[m
[31m-  if (maxX < width - MIN_DIMENSION_TO_RECUR) {[m
[31m-    doDecodeMultiple(image->crop((int) maxX, 0, width - (int) maxX, height),[m
[31m-                     hints, results, xOffset + (int) maxX, yOffset);[m
[31m-  }[m
[31m-  // Decode below barcode[m
[31m-  if (maxY < height - MIN_DIMENSION_TO_RECUR) {[m
[31m-    doDecodeMultiple(image->crop(0, (int) maxY, width, height - (int) maxY),[m
[31m-                     hints, results, xOffset, yOffset + (int) maxY);[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-Ref<Result> GenericMultipleBarcodeReader::translateResultPoints(Ref<Result> result, int xOffset, int yOffset){[m
[31m-  const std::vector<Ref<ResultPoint> > oldResultPoints = result->getResultPoints();[m
[31m-  if (oldResultPoints.empty()) {[m
[31m-    return result;[m
[31m-  }[m
[31m-  std::vector<Ref<ResultPoint> > newResultPoints;[m
[31m-  for (unsigned int i = 0; i < oldResultPoints.size(); i++) {[m
[31m-    Ref<ResultPoint> oldPoint = oldResultPoints[i];[m
[31m-    newResultPoints.push_back(Ref<ResultPoint>(new ResultPoint(oldPoint->getX() + xOffset, oldPoint->getY() + yOffset)));[m
[31m-  }[m
[31m-  return Ref<Result>(new Result(result->getText(), result->getRawBytes(), newResultPoints, result->getBarcodeFormat()));[m
[31m-}[m
[31m-[m
[31m-} // End zxing::multi namespace[m
[31m-} // End zxing namespace[m
[31m-[m
[31m-// file: zxing/multi/MultipleBarcodeReader.cpp[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2011 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/multi/MultipleBarcodeReader.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace multi {[m
[31m-[m
[31m-MultipleBarcodeReader::~MultipleBarcodeReader() { }[m
[31m-[m
[31m-std::vector<Ref<Result> > MultipleBarcodeReader::decodeMultiple(Ref<BinaryBitmap> image) {[m
[31m-  return decodeMultiple(image, DecodeHints::DEFAULT_HINT);[m
[31m-}[m
[31m-[m
[31m-} // End zxing::multi namespace[m
[31m-} // End zxing namespace[m
[31m-[m
[31m-// file: zxing/multi/qrcode/QRCodeMultiReader.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Copyright 2011 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/multi/qrcode/QRCodeMultiReader.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/multi/qrcode/detector/MultiDetector.h>[m
[31m-// #include <zxing/BarcodeFormat.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace multi {[m
[31m-QRCodeMultiReader::QRCodeMultiReader(){}[m
[31m-[m
[31m-QRCodeMultiReader::~QRCodeMultiReader(){}[m
[31m-[m
[31m-std::vector<Ref<Result> > QRCodeMultiReader::decodeMultiple(Ref<BinaryBitmap> image,[m
[31m-  DecodeHints hints)[m
[31m-{[m
[31m-  std::vector<Ref<Result> > results;[m
[31m-  MultiDetector detector(image->getBlackMatrix());[m
[31m-[m
[31m-  std::vector<Ref<DetectorResult> > detectorResult =  detector.detectMulti(hints);[m
[31m-  for (unsigned int i = 0; i < detectorResult.size(); i++) {[m
[31m-    try {[m
[31m-      Ref<DecoderResult> decoderResult = getDecoder().decode(detectorResult[i]->getBits());[m
[31m-      std::vector<Ref<ResultPoint> > points = detectorResult[i]->getPoints();[m
[31m-      Ref<Result> result = Ref<Result>(new Result(decoderResult->getText(),[m
[31m-      decoderResult->getRawBytes(),[m
[31m-      points, BarcodeFormat_QR_CODE));[m
[31m-      // result->putMetadata(ResultMetadataType.BYTE_SEGMENTS, decoderResult->getByteSegments());[m
[31m-      // result->putMetadata(ResultMetadataType.ERROR_CORRECTION_LEVEL, decoderResult->getECLevel().toString());[m
[31m-      results.push_back(result);[m
[31m-    } catch (ReaderException re) {[m
[31m-    // ignore and continue[m
[31m-    }[m
[31m-  }[m
[31m-  if (results.empty()){[m
[31m-    throw ReaderException("No code detected");[m
[31m-  }[m
[31m-  return results;[m
[31m-}[m
[31m-[m
[31m-} // End zxing::multi namespace[m
[31m-} // End zxing namespace[m
[31m-[m
[31m-// file: zxing/multi/qrcode/detector/MultiDetector.cpp[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2011 ZXing authors[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/multi/qrcode/detector/MultiDetector.h>[m
[31m-// #include <zxing/multi/qrcode/detector/MultiFinderPatternFinder.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace multi {[m
[31m-using namespace zxing::qrcode;[m
[31m-[m
[31m-MultiDetector::MultiDetector(Ref<BitMatrix> image) : Detector(image) {}[m
[31m-[m
[31m-MultiDetector::~MultiDetector(){}[m
[31m-[m
[31m-std::vector<Ref<DetectorResult> > MultiDetector::detectMulti(DecodeHints hints){[m
[31m-  Ref<BitMatrix> image = getImage();[m
[31m-  MultiFinderPatternFinder finder = MultiFinderPatternFinder(image, hints.getResultPointCallback());[m
[31m-  std::vector<Ref<FinderPatternInfo> > info = finder.findMulti(hints);[m
[31m-  std::vector<Ref<DetectorResult> > result;[m
[31m-  for(unsigned int i = 0; i < info.size(); i++){[m
[31m-    try{[m
[31m-      result.push_back(processFinderPatternInfo(info[i]));[m
[31m-    } catch (ReaderException e){[m
[31m-      // ignore[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-} // End zxing::multi namespace[m
[31m-} // End zxing namespace[m
[31m-[m
[31m-// file: zxing/multi/qrcode/detector/MultiFinderPatternFinder.cpp[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2011 ZXing authors[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <algorithm>[m
[31m-// #include <math.h>[m
[31m-// #include <stdlib.h>[m
[31m-// #include <zxing/multi/qrcode/detector/MultiFinderPatternFinder.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing{[m
[31m-namespace multi {[m
[31m-using namespace zxing::qrcode;[m
[31m-[m
[31m-const float MultiFinderPatternFinder::MAX_MODULE_COUNT_PER_EDGE = 180;[m
[31m-const float MultiFinderPatternFinder::MIN_MODULE_COUNT_PER_EDGE = 9;[m
[31m-const float MultiFinderPatternFinder::DIFF_MODSIZE_CUTOFF_PERCENT = 0.05f;[m
[31m-const float MultiFinderPatternFinder::DIFF_MODSIZE_CUTOFF = 0.5f;[m
[31m-[m
[31m-bool compareModuleSize(Ref<FinderPattern> a, Ref<FinderPattern> b){[m
[31m-    float value = a->getEstimatedModuleSize() - b->getEstimatedModuleSize();[m
[31m-    return value < 0.0;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-MultiFinderPatternFinder::MultiFinderPatternFinder(Ref<BitMatrix> image,[m
[31m-  Ref<ResultPointCallback> resultPointCallback) :[m
[31m-    FinderPatternFinder(image, resultPointCallback)[m
[31m-{[m
[31m-}[m
[31m-[m
[31m-MultiFinderPatternFinder::~MultiFinderPatternFinder(){}[m
[31m-[m
[31m-std::vector<Ref<FinderPatternInfo> > MultiFinderPatternFinder::findMulti(DecodeHints const& hints){[m
[31m-  bool tryHarder = hints.getTryHarder();[m
[31m-  Ref<BitMatrix> image = image_; // Protected member[m
[31m-  int maxI = image->getHeight();[m
[31m-  int maxJ = image->getWidth();[m
[31m-  // We are looking for black/white/black/white/black modules in[m
[31m-  // 1:1:3:1:1 ratio; this tracks the number of such modules seen so far[m
[31m-[m
[31m-  // Let's assume that the maximum version QR Code we support takes up 1/4 the height of the[m
[31m-  // image, and then account for the center being 3 modules in size. This gives the smallest[m
[31m-  // number of pixels the center could be, so skip this often. When trying harder, look for all[m
[31m-  // QR versions regardless of how dense they are.[m
[31m-  int iSkip = (int) (maxI / (MAX_MODULES * 4.0f) * 3);[m
[31m-  if (iSkip < MIN_SKIP || tryHarder) {[m
[31m-    iSkip = MIN_SKIP;[m
[31m-  }[m
[31m-[m
[31m-  int stateCount[5];[m
[31m-  for (int i = iSkip - 1; i < maxI; i += iSkip) {[m
[31m-    // Get a row of black/white values[m
[31m-    stateCount[0] = 0;[m
[31m-    stateCount[1] = 0;[m
[31m-    stateCount[2] = 0;[m
[31m-    stateCount[3] = 0;[m
[31m-    stateCount[4] = 0;[m
[31m-    int currentState = 0;[m
[31m-    for (int j = 0; j < maxJ; j++) {[m
[31m-      if (image->get(j, i)) {[m
[31m-        // Black pixel[m
[31m-        if ((currentState & 1) == 1) { // Counting white pixels[m
[31m-          currentState++;[m
[31m-        }[m
[31m-        stateCount[currentState]++;[m
[31m-      } else { // White pixel[m
[31m-        if ((currentState & 1) == 0) { // Counting black pixels[m
[31m-          if (currentState == 4) { // A winner?[m
[31m-            if (foundPatternCross(stateCount)) { // Yes[m
[31m-              bool confirmed = handlePossibleCenter(stateCount, i, j);[m
[31m-              if (!confirmed) {[m
[31m-                do { // Advance to next black pixel[m
[31m-                  j++;[m
[31m-                } while (j < maxJ && !image->get(j, i));[m
[31m-                  j--; // back up to that last white pixel[m
[31m-              }[m
[31m-              // Clear state to start looking again[m
[31m-              currentState = 0;[m
[31m-              stateCount[0] = 0;[m
[31m-              stateCount[1] = 0;[m
[31m-              stateCount[2] = 0;[m
[31m-              stateCount[3] = 0;[m
[31m-              stateCount[4] = 0;[m
[31m-            } else { // No, shift counts back by two[m
[31m-              stateCount[0] = stateCount[2];[m
[31m-              stateCount[1] = stateCount[3];[m
[31m-              stateCount[2] = stateCount[4];[m
[31m-              stateCount[3] = 1;[m
[31m-              stateCount[4] = 0;[m
[31m-              currentState = 3;[m
[31m-            }[m
[31m-          } else {[m
[31m-            stateCount[++currentState]++;[m
[31m-          }[m
[31m-        } else { // Counting white pixels[m
[31m-            stateCount[currentState]++;[m
[31m-        }[m
[31m-      }[m
[31m-    } // for j=...[m
[31m-[m
[31m-    if (foundPatternCross(stateCount)) {[m
[31m-      handlePossibleCenter(stateCount, i, maxJ);[m
[31m-    } // end if foundPatternCross[m
[31m-  } // for i=iSkip-1 ...[m
[31m-  std::vector<std::vector<Ref<FinderPattern> > > patternInfo = selectBestPatterns();[m
[31m-  std::vector<Ref<FinderPatternInfo> > result;[m
[31m-  for (unsigned int i = 0; i < patternInfo.size(); i++) {[m
[31m-    std::vector<Ref<FinderPattern> > pattern = patternInfo[i];[m
[31m-    FinderPatternFinder::orderBestPatterns(pattern);[m
[31m-    result.push_back(Ref<FinderPatternInfo>(new FinderPatternInfo(pattern)));[m
[31m-  }[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-std::vector<std::vector<Ref<FinderPattern> > > MultiFinderPatternFinder::selectBestPatterns(){[m
[31m-  std::vector<Ref<FinderPattern> > possibleCenters = possibleCenters_;[m
[31m-[m
[31m-  int size = possibleCenters.size();[m
[31m-[m
[31m-  if (size < 3) {[m
[31m-    // Couldn't find enough finder patterns[m
[31m-    throw ReaderException("No code detected");[m
[31m-  }[m
[31m-[m
[31m-  std::vector<std::vector<Ref<FinderPattern> > > results;[m
[31m-[m
[31m-  /*[m
[31m-  * Begin HE modifications to safely detect multiple codes of equal size[m
[31m-  */[m
[31m-  if (size == 3) {[m
[31m-    results.push_back(possibleCenters_);[m
[31m-    return results;[m
[31m-  }[m
[31m-[m
[31m-  // Sort by estimated module size to speed up the upcoming checks[m
[31m-  //TODO do a sort based on module size[m
[31m-  std::sort(possibleCenters.begin(), possibleCenters.end(), compareModuleSize);[m
[31m-[m
[31m-  /*[m
[31m-  * Now lets start: build a list of tuples of three finder locations that[m
[31m-  *  - feature similar module sizes[m
[31m-  *  - are placed in a distance so the estimated module count is within the QR specification[m
[31m-  *  - have similar distance between upper left/right and left top/bottom finder patterns[m
[31m-  *  - form a triangle with 90° angle (checked by comparing top right/bottom left distance[m
[31m-  *    with pythagoras)[m
[31m-  *[m
[31m-  * Note: we allow each point to be used for more than one code region: this might seem[m
[31m-  * counterintuitive at first, but the performance penalty is not that big. At this point,[m
[31m-  * we cannot make a good quality decision whether the three finders actually represent[m
[31m-  * a QR code, or are just by chance layouted so it looks like there might be a QR code there.[m
[31m-  * So, if the layout seems right, lets have the decoder try to decode.[m
[31m-  */[m
[31m-[m
[31m-  for (int i1 = 0; i1 < (size - 2); i1++) {[m
[31m-    Ref<FinderPattern> p1 = possibleCenters[i1];[m
[31m-    for (int i2 = i1 + 1; i2 < (size - 1); i2++) {[m
[31m-      Ref<FinderPattern> p2 = possibleCenters[i2];[m
[31m-      // Compare the expected module sizes; if they are really off, skip[m
[31m-      float vModSize12 = (p1->getEstimatedModuleSize() - p2->getEstimatedModuleSize()) / std::min(p1->getEstimatedModuleSize(), p2->getEstimatedModuleSize());[m
[31m-      float vModSize12A = abs(p1->getEstimatedModuleSize() - p2->getEstimatedModuleSize());[m
[31m-      if (vModSize12A > DIFF_MODSIZE_CUTOFF && vModSize12 >= DIFF_MODSIZE_CUTOFF_PERCENT) {[m
[31m-        // break, since elements are ordered by the module size deviation there cannot be[m
[31m-        // any more interesting elements for the given p1.[m
[31m-        break;[m
[31m-      }[m
[31m-      for (int i3 = i2 + 1; i3 < size; i3++) {[m
[31m-        Ref<FinderPattern> p3 = possibleCenters[i3];[m
[31m-        // Compare the expected module sizes; if they are really off, skip[m
[31m-        float vModSize23 = (p2->getEstimatedModuleSize() - p3->getEstimatedModuleSize()) / std::min(p2->getEstimatedModuleSize(), p3->getEstimatedModuleSize());[m
[31m-        float vModSize23A = abs(p2->getEstimatedModuleSize() - p3->getEstimatedModuleSize());[m
[31m-        if (vModSize23A > DIFF_MODSIZE_CUTOFF && vModSize23 >= DIFF_MODSIZE_CUTOFF_PERCENT) {[m
[31m-          // break, since elements are ordered by the module size deviation there cannot be[m
[31m-          // any more interesting elements for the given p1.[m
[31m-          break;[m
[31m-        }[m
[31m-        std::vector<Ref<FinderPattern> > test;[m
[31m-        test.push_back(p1);[m
[31m-        test.push_back(p2);[m
[31m-        test.push_back(p3);[m
[31m-        FinderPatternFinder::orderBestPatterns(test);[m
[31m-        // Calculate the distances: a = topleft-bottomleft, b=topleft-topright, c = diagonal[m
[31m-        Ref<FinderPatternInfo> info = Ref<FinderPatternInfo>(new FinderPatternInfo(test));[m
[31m-        float dA = FinderPatternFinder::distance(info->getTopLeft(), info->getBottomLeft());[m
[31m-        float dC = FinderPatternFinder::distance(info->getTopRight(), info->getBottomLeft());[m
[31m-        float dB = FinderPatternFinder::distance(info->getTopLeft(), info->getTopRight());[m
[31m-        // Check the sizes[m
[31m-        float estimatedModuleCount = (dA + dB) / (p1->getEstimatedModuleSize() * 2.0f);[m
[31m-        if (estimatedModuleCount > MAX_MODULE_COUNT_PER_EDGE || estimatedModuleCount < MIN_MODULE_COUNT_PER_EDGE) {[m
[31m-          continue;[m
[31m-        }[m
[31m-        // Calculate the difference of the edge lengths in percent[m
[31m-        float vABBC = abs((dA - dB) / std::min(dA, dB));[m
[31m-        if (vABBC >= 0.1f) {[m
[31m-          continue;[m
[31m-        }[m
[31m-        // Calculate the diagonal length by assuming a 90° angle at topleft[m
[31m-        float dCpy = (float) sqrt(dA * dA + dB * dB);[m
[31m-        // Compare to the real distance in %[m
[31m-        float vPyC = abs((dC - dCpy) / std::min(dC, dCpy));[m
[31m-        if (vPyC >= 0.1f) {[m
[31m-          continue;[m
[31m-        }[m
[31m-        // All tests passed![m
[31m-        results.push_back(test);[m
[31m-      } // end iterate p3[m
[31m-    } // end iterate p2[m
[31m-  } // end iterate p1[m
[31m-  if (results.empty()){[m
[31m-    // Nothing found![m
[31m-    throw ReaderException("No code detected");[m
[31m-  }[m
[31m-  return results;[m
[31m-}[m
[31m-[m
[31m-} // End zxing::multi namespace[m
[31m-} // End zxing namespace[m
[31m-[m
[31m-// file: zxing/oned/Code128Reader.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "Code128Reader.h"[m
[31m-// #include <zxing/oned/OneDResultPoint.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <math.h>[m
[31m-// #include <string.h>[m
[31m-// #include <sstream>[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace oned {[m
[31m-[m
[31m-		const int CODE_PATTERNS_LENGTH = 107;[m
[31m-		const int countersLength = 6;[m
[31m-		static const int CODE_PATTERNS[CODE_PATTERNS_LENGTH][countersLength] = {[m
[31m-			{2, 1, 2, 2, 2, 2}, /* 0 */[m
[31m-			{2, 2, 2, 1, 2, 2},[m
[31m-			{2, 2, 2, 2, 2, 1},[m
[31m-			{1, 2, 1, 2, 2, 3},[m
[31m-			{1, 2, 1, 3, 2, 2},[m
[31m-			{1, 3, 1, 2, 2, 2}, /* 5 */[m
[31m-			{1, 2, 2, 2, 1, 3},[m
[31m-			{1, 2, 2, 3, 1, 2},[m
[31m-			{1, 3, 2, 2, 1, 2},[m
[31m-			{2, 2, 1, 2, 1, 3},[m
[31m-			{2, 2, 1, 3, 1, 2}, /* 10 */[m
[31m-			{2, 3, 1, 2, 1, 2},[m
[31m-			{1, 1, 2, 2, 3, 2},[m
[31m-			{1, 2, 2, 1, 3, 2},[m
[31m-			{1, 2, 2, 2, 3, 1},[m
[31m-			{1, 1, 3, 2, 2, 2}, /* 15 */[m
[31m-			{1, 2, 3, 1, 2, 2},[m
[31m-			{1, 2, 3, 2, 2, 1},[m
[31m-			{2, 2, 3, 2, 1, 1},[m
[31m-			{2, 2, 1, 1, 3, 2},[m
[31m-			{2, 2, 1, 2, 3, 1}, /* 20 */[m
[31m-			{2, 1, 3, 2, 1, 2},[m
[31m-			{2, 2, 3, 1, 1, 2},[m
[31m-			{3, 1, 2, 1, 3, 1},[m
[31m-			{3, 1, 1, 2, 2, 2},[m
[31m-			{3, 2, 1, 1, 2, 2}, /* 25 */[m
[31m-			{3, 2, 1, 2, 2, 1},[m
[31m-			{3, 1, 2, 2, 1, 2},[m
[31m-			{3, 2, 2, 1, 1, 2},[m
[31m-			{3, 2, 2, 2, 1, 1},[m
[31m-			{2, 1, 2, 1, 2, 3}, /* 30 */[m
[31m-			{2, 1, 2, 3, 2, 1},[m
[31m-			{2, 3, 2, 1, 2, 1},[m
[31m-			{1, 1, 1, 3, 2, 3},[m
[31m-			{1, 3, 1, 1, 2, 3},[m
[31m-			{1, 3, 1, 3, 2, 1}, /* 35 */[m
[31m-			{1, 1, 2, 3, 1, 3},[m
[31m-			{1, 3, 2, 1, 1, 3},[m
[31m-			{1, 3, 2, 3, 1, 1},[m
[31m-			{2, 1, 1, 3, 1, 3},[m
[31m-			{2, 3, 1, 1, 1, 3}, /* 40 */[m
[31m-			{2, 3, 1, 3, 1, 1},[m
[31m-			{1, 1, 2, 1, 3, 3},[m
[31m-			{1, 1, 2, 3, 3, 1},[m
[31m-			{1, 3, 2, 1, 3, 1},[m
[31m-			{1, 1, 3, 1, 2, 3}, /* 45 */[m
[31m-			{1, 1, 3, 3, 2, 1},[m
[31m-			{1, 3, 3, 1, 2, 1},[m
[31m-			{3, 1, 3, 1, 2, 1},[m
[31m-			{2, 1, 1, 3, 3, 1},[m
[31m-			{2, 3, 1, 1, 3, 1}, /* 50 */[m
[31m-			{2, 1, 3, 1, 1, 3},[m
[31m-			{2, 1, 3, 3, 1, 1},[m
[31m-			{2, 1, 3, 1, 3, 1},[m
[31m-			{3, 1, 1, 1, 2, 3},[m
[31m-			{3, 1, 1, 3, 2, 1}, /* 55 */[m
[31m-			{3, 3, 1, 1, 2, 1},[m
[31m-			{3, 1, 2, 1, 1, 3},[m
[31m-			{3, 1, 2, 3, 1, 1},[m
[31m-			{3, 3, 2, 1, 1, 1},[m
[31m-			{3, 1, 4, 1, 1, 1}, /* 60 */[m
[31m-			{2, 2, 1, 4, 1, 1},[m
[31m-			{4, 3, 1, 1, 1, 1},[m
[31m-			{1, 1, 1, 2, 2, 4},[m
[31m-			{1, 1, 1, 4, 2, 2},[m
[31m-			{1, 2, 1, 1, 2, 4}, /* 65 */[m
[31m-			{1, 2, 1, 4, 2, 1},[m
[31m-			{1, 4, 1, 1, 2, 2},[m
[31m-			{1, 4, 1, 2, 2, 1},[m
[31m-			{1, 1, 2, 2, 1, 4},[m
[31m-			{1, 1, 2, 4, 1, 2}, /* 70 */[m
[31m-			{1, 2, 2, 1, 1, 4},[m
[31m-			{1, 2, 2, 4, 1, 1},[m
[31m-			{1, 4, 2, 1, 1, 2},[m
[31m-			{1, 4, 2, 2, 1, 1},[m
[31m-			{2, 4, 1, 2, 1, 1}, /* 75 */[m
[31m-			{2, 2, 1, 1, 1, 4},[m
[31m-			{4, 1, 3, 1, 1, 1},[m
[31m-			{2, 4, 1, 1, 1, 2},[m
[31m-			{1, 3, 4, 1, 1, 1},[m
[31m-			{1, 1, 1, 2, 4, 2}, /* 80 */[m
[31m-			{1, 2, 1, 1, 4, 2},[m
[31m-			{1, 2, 1, 2, 4, 1},[m
[31m-			{1, 1, 4, 2, 1, 2},[m
[31m-			{1, 2, 4, 1, 1, 2},[m
[31m-			{1, 2, 4, 2, 1, 1}, /* 85 */[m
[31m-			{4, 1, 1, 2, 1, 2},[m
[31m-			{4, 2, 1, 1, 1, 2},[m
[31m-			{4, 2, 1, 2, 1, 1},[m
[31m-			{2, 1, 2, 1, 4, 1},[m
[31m-			{2, 1, 4, 1, 2, 1}, /* 90 */[m
[31m-			{4, 1, 2, 1, 2, 1},[m
[31m-			{1, 1, 1, 1, 4, 3},[m
[31m-			{1, 1, 1, 3, 4, 1},[m
[31m-			{1, 3, 1, 1, 4, 1},[m
[31m-			{1, 1, 4, 1, 1, 3}, /* 95 */[m
[31m-			{1, 1, 4, 3, 1, 1},[m
[31m-			{4, 1, 1, 1, 1, 3},[m
[31m-			{4, 1, 1, 3, 1, 1},[m
[31m-			{1, 1, 3, 1, 4, 1},[m
[31m-			{1, 1, 4, 1, 3, 1}, /* 100 */[m
[31m-			{3, 1, 1, 1, 4, 1},[m
[31m-			{4, 1, 1, 1, 3, 1},[m
[31m-			{2, 1, 1, 4, 1, 2},[m
[31m-			{2, 1, 1, 2, 1, 4},[m
[31m-			{2, 1, 1, 2, 3, 2}, /* 105 */[m
[31m-			{2, 3, 3, 1, 1, 1}[m
[31m-		};[m
[31m-[m
[31m-[m
[31m-		Code128Reader::Code128Reader(){[m
[31m-		}[m
[31m-[m
[31m-		int* Code128Reader::findStartPattern(Ref<BitArray> row){[m
[31m-			int width = row->getSize();[m
[31m-			int rowOffset = 0;[m
[31m-			while (rowOffset < width) {[m
[31m-				if (row->get(rowOffset)) {[m
[31m-					break;[m
[31m-				}[m
[31m-				rowOffset++;[m
[31m-			}[m
[31m-[m
[31m-			int counterPosition = 0;[m
[31m-			int counters[countersLength] = {0,0,0,0,0,0};[m
[31m-			int patternStart = rowOffset;[m
[31m-			bool isWhite = false;[m
[31m-			int patternLength =  sizeof(counters) / sizeof(int);[m
[31m-[m
[31m-			for (int i = rowOffset; i < width; i++) {[m
[31m-				bool pixel = row->get(i);[m
[31m-				if (pixel ^ isWhite) {[m
[31m-					counters[counterPosition]++;[m
[31m-				} else {[m
[31m-					if (counterPosition == patternLength - 1) {[m
[31m-						unsigned int bestVariance = MAX_AVG_VARIANCE;[m
[31m-						int bestMatch = -1;[m
[31m-						for (int startCode = CODE_START_A; startCode <= CODE_START_C; startCode++) {[m
[31m-							unsigned int variance = patternMatchVariance(counters, sizeof(counters) / sizeof(int),[m
[31m-							    CODE_PATTERNS[startCode], MAX_INDIVIDUAL_VARIANCE);[m
[31m-							if (variance < bestVariance) {[m
[31m-								bestVariance = variance;[m
[31m-								bestMatch = startCode;[m
[31m-							}[m
[31m-						}[m
[31m-						if (bestMatch >= 0) {[m
[31m-							// Look for whitespace before start pattern, >= 50% of width of start pattern[m
[31m-              if (row->isRange(std::max(0, patternStart - (i - patternStart) / 2), patternStart,[m
[31m-							    false)) {[m
[31m-								int* resultValue = new int[3];[m
[31m-								resultValue[0] = patternStart;[m
[31m-								resultValue[1] = i;[m
[31m-								resultValue[2] = bestMatch;[m
[31m-								return resultValue;[m
[31m-							}[m
[31m-						}[m
[31m-						patternStart += counters[0] + counters[1];[m
[31m-						for (int y = 2; y < patternLength; y++) {[m
[31m-							counters[y - 2] = counters[y];[m
[31m-						}[m
[31m-						counters[patternLength - 2] = 0;[m
[31m-						counters[patternLength - 1] = 0;[m
[31m-						counterPosition--;[m
[31m-					} else {[m
[31m-						counterPosition++;[m
[31m-					}[m
[31m-					counters[counterPosition] = 1;[m
[31m-					isWhite = !isWhite;[m
[31m-				}[m
[31m-			}[m
[31m-			throw ReaderException("");[m
[31m-		}[m
[31m-[m
[31m-		int Code128Reader::decodeCode(Ref<BitArray> row, int counters[], int countersCount,[m
[31m-		    int rowOffset) {[m
[31m-		  if (!recordPattern(row, rowOffset, counters, countersCount)) {[m
[31m-		    throw ReaderException("");[m
[31m-		  }[m
[31m-			unsigned int bestVariance = MAX_AVG_VARIANCE; // worst variance we'll accept[m
[31m-			int bestMatch = -1;[m
[31m-			for (int d = 0; d < CODE_PATTERNS_LENGTH; d++) {[m
[31m-				int pattern[countersLength];[m
[31m-[m
[31m-				for(int ind = 0; ind< countersLength; ind++){[m
[31m-					pattern[ind] = CODE_PATTERNS[d][ind];[m
[31m-				}[m
[31m-//				memcpy(pattern, CODE_PATTERNS[d], countersLength);[m
[31m-				unsigned int variance = patternMatchVariance(counters, countersCount, pattern,[m
[31m-				    MAX_INDIVIDUAL_VARIANCE);[m
[31m-				if (variance < bestVariance) {[m
[31m-					bestVariance = variance;[m
[31m-					bestMatch = d;[m
[31m-				}[m
[31m-			}[m
[31m-			// TODO We're overlooking the fact that the STOP pattern has 7 values, not 6.[m
[31m-			if (bestMatch >= 0) {[m
[31m-				return bestMatch;[m
[31m-			} else {[m
[31m-				throw ReaderException("");[m
[31m-			}[m
[31m-		}[m
[31m-[m
[31m-		Ref<Result> Code128Reader::decodeRow(int rowNumber, Ref<BitArray> row) {[m
[31m-		  int* startPatternInfo = NULL;[m
[31m-		  try {[m
[31m-        startPatternInfo = findStartPattern(row);[m
[31m-        int startCode = startPatternInfo[2];[m
[31m-        int codeSet;[m
[31m-        switch (startCode) {[m
[31m-          case CODE_START_A:[m
[31m-            codeSet = CODE_CODE_A;[m
[31m-            break;[m
[31m-          case CODE_START_B:[m
[31m-            codeSet = CODE_CODE_B;[m
[31m-            break;[m
[31m-          case CODE_START_C:[m
[31m-            codeSet = CODE_CODE_C;[m
[31m-            break;[m
[31m-          default:[m
[31m-            throw ReaderException("");[m
[31m-        }[m
[31m-[m
[31m-        bool done = false;[m
[31m-        bool isNextShifted = false;[m
[31m-[m
[31m-        std::string tmpResultString;[m
[31m-        std::stringstream tmpResultSStr; // used if its Code 128C[m
[31m-[m
[31m-        int lastStart = startPatternInfo[0];[m
[31m-        int nextStart = startPatternInfo[1];[m
[31m-        int counters[countersLength] = {0,0,0,0,0,0};[m
[31m-[m
[31m-        int lastCode = 0;[m
[31m-        int code = 0;[m
[31m-        int checksumTotal = startCode;[m
[31m-        int multiplier = 0;[m
[31m-        bool lastCharacterWasPrintable = true;[m
[31m-[m
[31m-        while (!done) {[m
[31m-          bool unshift = isNextShifted;[m
[31m-          isNextShifted = false;[m
[31m-[m
[31m-          // Save off last code[m
[31m-          lastCode = code;[m
[31m-[m
[31m-          // Decode another code from image[m
[31m-          try {[m
[31m-            code = decodeCode(row, counters, sizeof(counters)/sizeof(int), nextStart);[m
[31m-          } catch (ReaderException const& re) {[m
[31m-            throw re;[m
[31m-          }[m
[31m-[m
[31m-          // Remember whether the last code was printable or not (excluding CODE_STOP)[m
[31m-          if (code != CODE_STOP) {[m
[31m-            lastCharacterWasPrintable = true;[m
[31m-          }[m
[31m-[m
[31m-          // Add to checksum computation (if not CODE_STOP of course)[m
[31m-          if (code != CODE_STOP) {[m
[31m-            multiplier++;[m
[31m-            checksumTotal += multiplier * code;[m
[31m-          }[m
[31m-[m
[31m-          // Advance to where the next code will to start[m
[31m-          lastStart = nextStart;[m
[31m-          int _countersLength = sizeof(counters) / sizeof(int);[m
[31m-          for (int i = 0; i < _countersLength; i++) {[m
[31m-            nextStart += counters[i];[m
[31m-          }[m
[31m-[m
[31m-          // Take care of illegal start codes[m
[31m-          switch (code) {[m
[31m-            case CODE_START_A:[m
[31m-            case CODE_START_B:[m
[31m-            case CODE_START_C:[m
[31m-              throw ReaderException("");[m
[31m-          }[m
[31m-[m
[31m-          switch (codeSet) {[m
[31m-[m
[31m-            case CODE_CODE_A:[m
[31m-              if (code < 64) {[m
[31m-                tmpResultString.append(1, (char) (' ' + code));[m
[31m-              } else if (code < 96) {[m
[31m-                tmpResultString.append(1, (char) (code - 64));[m
[31m-              } else {[m
[31m-                // Don't let CODE_STOP, which always appears, affect whether whether we think the[m
[31m-                // last code was printable or not.[m
[31m-                if (code != CODE_STOP) {[m
[31m-                  lastCharacterWasPrintable = false;[m
[31m-                }[m
[31m-                switch (code) {[m
[31m-                  case CODE_FNC_1:[m
[31m-                  case CODE_FNC_2:[m
[31m-                  case CODE_FNC_3:[m
[31m-                  case CODE_FNC_4_A:[m
[31m-                    // do nothing?[m
[31m-                    break;[m
[31m-                  case CODE_SHIFT:[m
[31m-                    isNextShifted = true;[m
[31m-                    codeSet = CODE_CODE_B;[m
[31m-                    break;[m
[31m-                  case CODE_CODE_B:[m
[31m-                    codeSet = CODE_CODE_B;[m
[31m-                    break;[m
[31m-                  case CODE_CODE_C:[m
[31m-                    codeSet = CODE_CODE_C;[m
[31m-                    break;[m
[31m-                  case CODE_STOP:[m
[31m-                    done = true;[m
[31m-                    break;[m
[31m-                }[m
[31m-              }[m
[31m-              break;[m
[31m-            case CODE_CODE_B:[m
[31m-              if (code < 96) {[m
[31m-                tmpResultString.append(1, (char) (' ' + code));[m
[31m-              } else {[m
[31m-                if (code != CODE_STOP) {[m
[31m-                  lastCharacterWasPrintable = false;[m
[31m-                }[m
[31m-                switch (code) {[m
[31m-                  case CODE_FNC_1:[m
[31m-                  case CODE_FNC_2:[m
[31m-                  case CODE_FNC_3:[m
[31m-                  case CODE_FNC_4_B:[m
[31m-                    // do nothing?[m
[31m-                    break;[m
[31m-                  case CODE_SHIFT:[m
[31m-                    isNextShifted = true;[m
[31m-                    codeSet = CODE_CODE_C;[m
[31m-                    break;[m
[31m-                  case CODE_CODE_A:[m
[31m-                    codeSet = CODE_CODE_A;[m
[31m-                    break;[m
[31m-                  case CODE_CODE_C:[m
[31m-                    codeSet = CODE_CODE_C;[m
[31m-                    break;[m
[31m-                  case CODE_STOP:[m
[31m-                    done = true;[m
[31m-                    break;[m
[31m-                }[m
[31m-              }[m
[31m-              break;[m
[31m-            case CODE_CODE_C:[m
[31m-              tmpResultSStr.str(std::string());[m
[31m-              // the code read in this case is the number encoded directly[m
[31m-              if (code < 100) {[m
[31m-                if (code < 10) {[m
[31m- 					        tmpResultSStr << '0';[m
[31m- 				        }[m
[31m-                tmpResultSStr << code;[m
[31m- 				        tmpResultString.append(tmpResultSStr.str());[m
[31m-              } else {[m
[31m-                if (code != CODE_STOP) {[m
[31m-                  lastCharacterWasPrintable = false;[m
[31m-                }[m
[31m-                switch (code) {[m
[31m-                  case CODE_FNC_1:[m
[31m-                    // do nothing?[m
[31m-                    break;[m
[31m-                  case CODE_CODE_A:[m
[31m-                    codeSet = CODE_CODE_A;[m
[31m-                    break;[m
[31m-                  case CODE_CODE_B:[m
[31m-                    codeSet = CODE_CODE_B;[m
[31m-                    break;[m
[31m-                  case CODE_STOP:[m
[31m-                    done = true;[m
[31m-                    break;[m
[31m-                }[m
[31m-              }[m
[31m-              break;[m
[31m-          }[m
[31m-[m
[31m-          // Unshift back to another code set if we were shifted[m
[31m-          if (unshift) {[m
[31m-            switch (codeSet) {[m
[31m-              case CODE_CODE_A:[m
[31m-                codeSet = CODE_CODE_C;[m
[31m-                break;[m
[31m-              case CODE_CODE_B:[m
[31m-                codeSet = CODE_CODE_A;[m
[31m-                break;[m
[31m-              case CODE_CODE_C:[m
[31m-                codeSet = CODE_CODE_B;[m
[31m-                break;[m
[31m-            }[m
[31m-          }[m
[31m-[m
[31m-        }[m
[31m-[m
[31m-        // Check for ample whitespace following pattern, but, to do this we first need to remember that[m
[31m-        // we fudged decoding CODE_STOP since it actually has 7 bars, not 6. There is a black bar left[m
[31m-        // to read off. Would be slightly better to properly read. Here we just skip it:[m
[31m-        int width = row->getSize();[m
[31m-        while (nextStart < width && row->get(nextStart)) {[m
[31m-          nextStart++;[m
[31m-        }[m
[31m-        if (!row->isRange(nextStart,[m
[31m-                          std::min(width, nextStart + (nextStart - lastStart) / 2),[m
[31m-                          false)) {[m
[31m-          throw ReaderException("");[m
[31m-        }[m
[31m-[m
[31m-        // Pull out from sum the value of the penultimate check code[m
[31m-        checksumTotal -= multiplier * lastCode;[m
[31m-        // lastCode is the checksum then:[m
[31m-        if (checksumTotal % 103 != lastCode) {[m
[31m-          throw ReaderException("");[m
[31m-        }[m
[31m-[m
[31m-        // Need to pull out the check digits from string[m
[31m-        int resultLength = tmpResultString.length();[m
[31m-        // Only bother if the result had at least one character, and if the checksum digit happened to[m
[31m-        // be a printable character. If it was just interpreted as a control code, nothing to remove.[m
[31m-        if (resultLength > 0 && lastCharacterWasPrintable) {[m
[31m-          if (codeSet == CODE_CODE_C) {[m
[31m-            tmpResultString.erase(resultLength - 2, resultLength);[m
[31m-          } else {[m
[31m-            tmpResultString.erase(resultLength - 1, resultLength);[m
[31m-          }[m
[31m-        }[m
[31m-[m
[31m-        Ref<String> resultString(new String(tmpResultString));[m
[31m-        if (tmpResultString.length() == 0) {[m
[31m-          // Almost surely a false positive[m
[31m-          throw ReaderException("");[m
[31m-        }[m
[31m-[m
[31m-        float left = (float) (startPatternInfo[1] + startPatternInfo[0]) / 2.0f;[m
[31m-        float right = (float) (nextStart + lastStart) / 2.0f;[m
[31m-[m
[31m-        std::vector< Ref<ResultPoint> > resultPoints(2);[m
[31m-        Ref<OneDResultPoint> resultPoint1(new OneDResultPoint(left, (float) rowNumber));[m
[31m-        Ref<OneDResultPoint> resultPoint2(new OneDResultPoint(right, (float) rowNumber));[m
[31m-        resultPoints[0] = resultPoint1;[m
[31m-        resultPoints[1] = resultPoint2;[m
[31m-[m
[31m-        delete [] startPatternInfo;[m
[31m-        ArrayRef<unsigned char> resultBytes(1);[m
[31m-        return Ref<Result>(new Result(resultString, resultBytes, resultPoints,[m
[31m-            BarcodeFormat_CODE_128));[m
[31m-			} catch (ReaderException const& re) {[m
[31m-			  delete [] startPatternInfo;[m
[31m-			  return Ref<Result>();[m
[31m-			}[m
[31m-		}[m
[31m-[m
[31m-		void Code128Reader::append(char* s, char c){[m
[31m-			int len = strlen(s);[m
[31m-			s[len] = c;[m
[31m-			s[len + 1] = '\0';[m
[31m-		}[m
[31m-[m
[31m-		Code128Reader::~Code128Reader(){[m
[31m-		}[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/oned/Code39Reader.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "Code39Reader.h"[m
[31m-// #include <zxing/oned/OneDResultPoint.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <math.h>[m
[31m-// #include <limits.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace oned {[m
[31m-[m
[31m-  static const char* ALPHABET = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. *$/+%";[m
[31m-[m
[31m-[m
[31m-  /**[m
[31m-   * These represent the encodings of characters, as patterns of wide and narrow[m
[31m-   * bars.[m
[31m-   * The 9 least-significant bits of each int correspond to the pattern of wide[m
[31m-   * and narrow, with 1s representing "wide" and 0s representing narrow.[m
[31m-   */[m
[31m-  const int CHARACTER_ENCODINGS_LEN = 44;[m
[31m-  static int CHARACTER_ENCODINGS[CHARACTER_ENCODINGS_LEN] = {[m
[31m-    0x034, 0x121, 0x061, 0x160, 0x031, 0x130, 0x070, 0x025, 0x124, 0x064, // 0-9[m
[31m-    0x109, 0x049, 0x148, 0x019, 0x118, 0x058, 0x00D, 0x10C, 0x04C, 0x01C, // A-J[m
[31m-    0x103, 0x043, 0x142, 0x013, 0x112, 0x052, 0x007, 0x106, 0x046, 0x016, // K-T[m
[31m-    0x181, 0x0C1, 0x1C0, 0x091, 0x190, 0x0D0, 0x085, 0x184, 0x0C4, 0x094, // U-*[m
[31m-    0x0A8, 0x0A2, 0x08A, 0x02A // $-%[m
[31m-  };[m
[31m-[m
[31m-  static int ASTERISK_ENCODING = 0x094;[m
[31m-  static const char* ALPHABET_STRING =[m
[31m-    "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. *$/+%";[m
[31m-[m
[31m-[m
[31m-  /**[m
[31m-   * Creates a reader that assumes all encoded data is data, and does not treat[m
[31m-   * the final character as a check digit. It will not decoded "extended[m
[31m-   * Code 39" sequences.[m
[31m-   */[m
[31m-  Code39Reader::Code39Reader() : alphabet_string(ALPHABET_STRING),[m
[31m-                                 usingCheckDigit(false),[m
[31m-                                 extendedMode(false) {[m
[31m-  }[m
[31m-[m
[31m-  /**[m
[31m-   * Creates a reader that can be configured to check the last character as a[m
[31m-   * check digit. It will not decoded "extended Code 39" sequences.[m
[31m-   *[m
[31m-   * @param usingCheckDigit if true, treat the last data character as a check[m
[31m-   * digit, not data, and verify that the checksum passes.[m
[31m-   */[m
[31m-  Code39Reader::Code39Reader(bool usingCheckDigit_) :[m
[31m-    alphabet_string(ALPHABET_STRING),[m
[31m-    usingCheckDigit(usingCheckDigit_),[m
[31m-    extendedMode(false) {[m
[31m-  }[m
[31m-[m
[31m-[m
[31m-  Code39Reader::Code39Reader(bool usingCheckDigit_, bool extendedMode_) :[m
[31m-    alphabet_string(ALPHABET_STRING),[m
[31m-    usingCheckDigit(usingCheckDigit_),[m
[31m-    extendedMode(extendedMode_) {[m
[31m-  }[m
[31m-[m
[31m-  Ref<Result> Code39Reader::decodeRow(int rowNumber, Ref<BitArray> row) {[m
[31m-    int* start = NULL;[m
[31m-    try {[m
[31m-      start = findAsteriskPattern(row);[m
[31m-      int nextStart = start[1];[m
[31m-      int end = row->getSize();[m
[31m-[m
[31m-      // Read off white space[m
[31m-      while (nextStart < end && !row->get(nextStart)) {[m
[31m-        nextStart++;[m
[31m-      }[m
[31m-[m
[31m-      std::string tmpResultString;[m
[31m-[m
[31m-      const int countersLen = 9;[m
[31m-      int counters[countersLen];[m
[31m-      for (int i = 0; i < countersLen; i++) {[m
[31m-        counters[i] = 0;[m
[31m-      }[m
[31m-      char decodedChar;[m
[31m-      int lastStart;[m
[31m-      do {[m
[31m-        if (!recordPattern(row, nextStart, counters, countersLen)) {[m
[31m-          throw ReaderException("");[m
[31m-        }[m
[31m-        int pattern = toNarrowWidePattern(counters, countersLen);[m
[31m-        if (pattern < 0) {[m
[31m-          throw ReaderException("pattern < 0");[m
[31m-        }[m
[31m-        decodedChar = patternToChar(pattern);[m
[31m-        tmpResultString.append(1, decodedChar);[m
[31m-        lastStart = nextStart;[m
[31m-        for (int i = 0; i < countersLen; i++) {[m
[31m-          nextStart += counters[i];[m
[31m-        }[m
[31m-        // Read off white space[m
[31m-        while (nextStart < end && !row->get(nextStart)) {[m
[31m-          nextStart++;[m
[31m-        }[m
[31m-      } while (decodedChar != '*');[m
[31m-      tmpResultString.erase(tmpResultString.length()-1, 1);// remove asterisk[m
[31m-[m
[31m-      // Look for whitespace after pattern:[m
[31m-      int lastPatternSize = 0;[m
[31m-      for (int i = 0; i < countersLen; i++) {[m
[31m-        lastPatternSize += counters[i];[m
[31m-      }[m
[31m-      int whiteSpaceAfterEnd = nextStart - lastStart - lastPatternSize;[m
[31m-      // If 50% of last pattern size, following last pattern, is not whitespace,[m
[31m-      // fail (but if it's whitespace to the very end of the image, that's OK)[m
[31m-      if (nextStart != end && whiteSpaceAfterEnd / 2 < lastPatternSize) {[m
[31m-        throw ReaderException("too short end white space");[m
[31m-      }[m
[31m-[m
[31m-      if (usingCheckDigit) {[m
[31m-        int max = tmpResultString.length() - 1;[m
[31m-        unsigned int total = 0;[m
[31m-        for (int i = 0; i < max; i++) {[m
[31m-          total += alphabet_string.find_first_of(tmpResultString[i], 0);[m
[31m-        }[m
[31m-        if (total % 43 != alphabet_string.find_first_of(tmpResultString[max], 0)) {[m
[31m-          throw ReaderException("");[m
[31m-        }[m
[31m-        tmpResultString.erase(max, 1);[m
[31m-      }[m
[31m-[m
[31m-      Ref<String> resultString(new String(tmpResultString));[m
[31m-      if (extendedMode) {[m
[31m-        resultString = decodeExtended(tmpResultString);[m
[31m-      }[m
[31m-[m
[31m-      if (tmpResultString.length() == 0) {[m
[31m-        // Almost surely a false positive[m
[31m-        throw ReaderException("");[m
[31m-      }[m
[31m-[m
[31m-      float left = (float) (start[1] + start[0]) / 2.0f;[m
[31m-      float right = (float) (nextStart + lastStart) / 2.0f;[m
[31m-[m
[31m-      std::vector< Ref<ResultPoint> > resultPoints(2);[m
[31m-      Ref<OneDResultPoint> resultPoint1([m
[31m-        new OneDResultPoint(left, (float) rowNumber));[m
[31m-      Ref<OneDResultPoint> resultPoint2([m
[31m-        new OneDResultPoint(right, (float) rowNumber));[m
[31m-      resultPoints[0] = resultPoint1;[m
[31m-      resultPoints[1] = resultPoint2;[m
[31m-[m
[31m-      ArrayRef<unsigned char> resultBytes(1);[m
[31m-[m
[31m-      Ref<Result> res(new Result([m
[31m-                        resultString, resultBytes, resultPoints, BarcodeFormat_CODE_39));[m
[31m-[m
[31m-      delete [] start;[m
[31m-      return res;[m
[31m-    } catch (ReaderException const& re) {[m
[31m-      delete [] start;[m
[31m-      return Ref<Result>();[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  int* Code39Reader::findAsteriskPattern(Ref<BitArray> row){[m
[31m-    int width = row->getSize();[m
[31m-    int rowOffset = 0;[m
[31m-    while (rowOffset < width) {[m
[31m-      if (row->get(rowOffset)) {[m
[31m-        break;[m
[31m-      }[m
[31m-      rowOffset++;[m
[31m-    }[m
[31m-[m
[31m-    int counterPosition = 0;[m
[31m-    const int countersLen = 9;[m
[31m-    int counters[countersLen];[m
[31m-    for (int i = 0; i < countersLen; i++) {[m
[31m-      counters[i] = 0;[m
[31m-    }[m
[31m-    int patternStart = rowOffset;[m
[31m-    bool isWhite = false;[m
[31m-    int patternLength = countersLen;[m
[31m-[m
[31m-    for (int i = rowOffset; i < width; i++) {[m
[31m-      bool pixel = row->get(i);[m
[31m-      if (pixel ^ isWhite) {[m
[31m-        counters[counterPosition]++;[m
[31m-      } else {[m
[31m-        if (counterPosition == patternLength - 1) {[m
[31m-          if (toNarrowWidePattern(counters, countersLen) == ASTERISK_ENCODING) {[m
[31m-            // Look for whitespace before start pattern, >= 50% of width of[m
[31m-            // start pattern.[m
[31m-            if (row->isRange(std::max(0, patternStart - ((i - patternStart) >> 1)), patternStart, false)) {[m
[31m-              int* resultValue = new int[2];[m
[31m-              resultValue[0] = patternStart;[m
[31m-              resultValue[1] = i;[m
[31m-              return resultValue;[m
[31m-            }[m
[31m-          }[m
[31m-          patternStart += counters[0] + counters[1];[m
[31m-          for (int y = 2; y < patternLength; y++) {[m
[31m-            counters[y - 2] = counters[y];[m
[31m-          }[m
[31m-          counters[patternLength - 2] = 0;[m
[31m-          counters[patternLength - 1] = 0;[m
[31m-          counterPosition--;[m
[31m-        } else {[m
[31m-          counterPosition++;[m
[31m-        }[m
[31m-        counters[counterPosition] = 1;[m
[31m-        isWhite = !isWhite;[m
[31m-      }[m
[31m-    }[m
[31m-    throw ReaderException("");[m
[31m-  }[m
[31m-[m
[31m-  // For efficiency, returns -1 on failure. Not throwing here saved as many as[m
[31m-  // 700 exceptions per image when using some of our blackbox images.[m
[31m-  int Code39Reader::toNarrowWidePattern(int counters[], int countersLen){[m
[31m-    int numCounters = countersLen;[m
[31m-    int maxNarrowCounter = 0;[m
[31m-    int wideCounters;[m
[31m-    do {[m
[31m-      int minCounter = INT_MAX;[m
[31m-      for (int i = 0; i < numCounters; i++) {[m
[31m-        int counter = counters[i];[m
[31m-        if (counter < minCounter && counter > maxNarrowCounter) {[m
[31m-          minCounter = counter;[m
[31m-        }[m
[31m-      }[m
[31m-      maxNarrowCounter = minCounter;[m
[31m-      wideCounters = 0;[m
[31m-      int totalWideCountersWidth = 0;[m
[31m-      int pattern = 0;[m
[31m-      for (int i = 0; i < numCounters; i++) {[m
[31m-        int counter = counters[i];[m
[31m-        if (counters[i] > maxNarrowCounter) {[m
[31m-          pattern |= 1 << (numCounters - 1 - i);[m
[31m-          wideCounters++;[m
[31m-          totalWideCountersWidth += counter;[m
[31m-        }[m
[31m-      }[m
[31m-      if (wideCounters == 3) {[m
[31m-        // Found 3 wide counters, but are they close enough in width?[m
[31m-        // We can perform a cheap, conservative check to see if any individual[m
[31m-        // counter is more than 1.5 times the average:[m
[31m-        for (int i = 0; i < numCounters && wideCounters > 0; i++) {[m
[31m-          int counter = counters[i];[m
[31m-          if (counters[i] > maxNarrowCounter) {[m
[31m-            wideCounters--;[m
[31m-            // totalWideCountersWidth = 3 * average, so this checks if[m
[31m-            // counter >= 3/2 * average.[m
[31m-            if ((counter << 1) >= totalWideCountersWidth) {[m
[31m-              return -1;[m
[31m-            }[m
[31m-          }[m
[31m-        }[m
[31m-        return pattern;[m
[31m-      }[m
[31m-    } while (wideCounters > 3);[m
[31m-    return -1;[m
[31m-  }[m
[31m-[m
[31m-  char Code39Reader::patternToChar(int pattern){[m
[31m-    for (int i = 0; i < CHARACTER_ENCODINGS_LEN; i++) {[m
[31m-      if (CHARACTER_ENCODINGS[i] == pattern) {[m
[31m-        return ALPHABET[i];[m
[31m-      }[m
[31m-    }[m
[31m-    throw ReaderException("");[m
[31m-  }[m
[31m-[m
[31m-  Ref<String> Code39Reader::decodeExtended(std::string encoded){[m
[31m-    int length = encoded.length();[m
[31m-    std::string tmpDecoded;[m
[31m-    for (int i = 0; i < length; i++) {[m
[31m-      char c = encoded[i];[m
[31m-      if (c == '+' || c == '$' || c == '%' || c == '/') {[m
[31m-        char next = encoded[i + 1];[m
[31m-        char decodedChar = '\0';[m
[31m-        switch (c) {[m
[31m-          case '+':[m
[31m-            // +A to +Z map to a to z[m
[31m-            if (next >= 'A' && next <= 'Z') {[m
[31m-              decodedChar = (char) (next + 32);[m
[31m-            } else {[m
[31m-              throw ReaderException("");[m
[31m-            }[m
[31m-            break;[m
[31m-          case '$':[m
[31m-            // $A to $Z map to control codes SH to SB[m
[31m-            if (next >= 'A' && next <= 'Z') {[m
[31m-              decodedChar = (char) (next - 64);[m
[31m-            } else {[m
[31m-              throw ReaderException("");[m
[31m-            }[m
[31m-            break;[m
[31m-          case '%':[m
[31m-            // %A to %E map to control codes ESC to US[m
[31m-            if (next >= 'A' && next <= 'E') {[m
[31m-              decodedChar = (char) (next - 38);[m
[31m-            } else if (next >= 'F' && next <= 'W') {[m
[31m-              decodedChar = (char) (next - 11);[m
[31m-            } else {[m
[31m-              throw ReaderException("");[m
[31m-            }[m
[31m-            break;[m
[31m-          case '/':[m
[31m-            // /A to /O map to ! to , and /Z maps to :[m
[31m-            if (next >= 'A' && next <= 'O') {[m
[31m-              decodedChar = (char) (next - 32);[m
[31m-            } else if (next == 'Z') {[m
[31m-              decodedChar = ':';[m
[31m-            } else {[m
[31m-              throw ReaderException("");[m
[31m-            }[m
[31m-            break;[m
[31m-        }[m
[31m-        tmpDecoded.append(1, decodedChar);[m
[31m-        // bump up i again since we read two characters[m
[31m-        i++;[m
[31m-      } else {[m
[31m-        tmpDecoded.append(1, c);[m
[31m-      }[m
[31m-    }[m
[31m-    Ref<String> decoded(new String(tmpDecoded));[m
[31m-    return decoded;[m
[31m-  }[m
[31m-} // namespace oned[m
[31m-} // namespace zxing[m
[31m-[m
[31m-[m
[31m-// file: zxing/oned/EAN13Reader.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "EAN13Reader.h"[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-[m
[31m-    static const int FIRST_DIGIT_ENCODINGS[10] = {[m
[31m-      0x00, 0x0B, 0x0D, 0xE, 0x13, 0x19, 0x1C, 0x15, 0x16, 0x1A[m
[31m-    };[m
[31m-[m
[31m-    EAN13Reader::EAN13Reader() { }[m
[31m-[m
[31m-    int EAN13Reader::decodeMiddle(Ref<BitArray> row, int startGuardBegin, int startGuardEnd,[m
[31m-        std::string& resultString) {[m
[31m-      (void)startGuardBegin;[m
[31m-      const int countersLen = 4;[m
[31m-      int counters[countersLen] = { 0, 0, 0, 0 };[m
[31m-[m
[31m-      int end = row->getSize();[m
[31m-      int rowOffset = startGuardEnd;[m
[31m-      int lgPatternFound = 0;[m
[31m-[m
[31m-      for (int x = 0; x < 6 && rowOffset < end; x++) {[m
[31m-        int bestMatch = decodeDigit(row, counters, countersLen, rowOffset,[m
[31m-            UPC_EAN_PATTERNS_L_AND_G_PATTERNS);[m
[31m-        if (bestMatch < 0) {[m
[31m-          return -1;[m
[31m-        }[m
[31m-        resultString.append(1, (char) ('0' + bestMatch % 10));[m
[31m-        for (int i = 0; i < countersLen; i++) {[m
[31m-          rowOffset += counters[i];[m
[31m-        }[m
[31m-        if (bestMatch >= 10) {[m
[31m-          lgPatternFound |= 1 << (5 - x);[m
[31m-        }[m
[31m-      }[m
[31m-[m
[31m-      if (!determineFirstDigit(resultString, lgPatternFound)) {[m
[31m-        return -1;[m
[31m-      }[m
[31m-[m
[31m-      int middleRangeStart;[m
[31m-      int middleRangeEnd;[m
[31m-      if (findGuardPattern(row, rowOffset, true, (int*)getMIDDLE_PATTERN(),[m
[31m-            getMIDDLE_PATTERN_LEN(), &middleRangeStart, &middleRangeEnd)) {[m
[31m-        rowOffset = middleRangeEnd;[m
[31m-        for (int x = 0; x < 6 && rowOffset < end; x++) {[m
[31m-          int bestMatch = decodeDigit(row, counters, countersLen, rowOffset,[m
[31m-              UPC_EAN_PATTERNS_L_PATTERNS);[m
[31m-          if (bestMatch < 0) {[m
[31m-            return -1;[m
[31m-          }[m
[31m-          resultString.append(1, (char) ('0' + bestMatch));[m
[31m-          for (int i = 0; i < countersLen; i++) {[m
[31m-            rowOffset += counters[i];[m
[31m-          }[m
[31m-        }[m
[31m-        return rowOffset;[m
[31m-      }[m
[31m-      return -1;[m
[31m-    }[m
[31m-[m
[31m-    bool EAN13Reader::determineFirstDigit(std::string& resultString, int lgPatternFound) {[m
[31m-      for (int d = 0; d < 10; d++) {[m
[31m-        if (lgPatternFound == FIRST_DIGIT_ENCODINGS[d]) {[m
[31m-          resultString.insert(0, 1, (char) ('0' + d));[m
[31m-          return true;[m
[31m-        }[m
[31m-      }[m
[31m-      return false;[m
[31m-    }[m
[31m-[m
[31m-    BarcodeFormat EAN13Reader::getBarcodeFormat(){[m
[31m-      return BarcodeFormat_EAN_13;[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// file: zxing/oned/EAN8Reader.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "EAN8Reader.h"[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-[m
[31m-    EAN8Reader::EAN8Reader(){ }[m
[31m-[m
[31m-    int EAN8Reader::decodeMiddle(Ref<BitArray> row, int startGuardBegin, int startGuardEnd,[m
[31m-        std::string& resultString){[m
[31m-      (void)startGuardBegin;[m
[31m-      const int countersLen = 4;[m
[31m-      int counters[countersLen] = { 0, 0, 0, 0 };[m
[31m-[m
[31m-      int end = row->getSize();[m
[31m-      int rowOffset = startGuardEnd;[m
[31m-[m
[31m-      for (int x = 0; x < 4 && rowOffset < end; x++) {[m
[31m-        int bestMatch = decodeDigit(row, counters, countersLen, rowOffset,[m
[31m-            UPC_EAN_PATTERNS_L_PATTERNS);[m
[31m-        if (bestMatch < 0) {[m
[31m-          return -1;[m
[31m-        }[m
[31m-        resultString.append(1, (char) ('0' + bestMatch));[m
[31m-        for (int i = 0; i < countersLen; i++) {[m
[31m-          rowOffset += counters[i];[m
[31m-        }[m
[31m-      }[m
[31m-[m
[31m-      int middleRangeStart;[m
[31m-      int middleRangeEnd;[m
[31m-      if (findGuardPattern(row, rowOffset, true, (int*)getMIDDLE_PATTERN(),[m
[31m-            getMIDDLE_PATTERN_LEN(), &middleRangeStart, &middleRangeEnd)) {[m
[31m-        rowOffset = middleRangeEnd;[m
[31m-        for (int x = 0; x < 4 && rowOffset < end; x++) {[m
[31m-          int bestMatch = decodeDigit(row, counters, countersLen, rowOffset,[m
[31m-              UPC_EAN_PATTERNS_L_PATTERNS);[m
[31m-          if (bestMatch < 0) {[m
[31m-            return -1;[m
[31m-          }[m
[31m-          resultString.append(1, (char) ('0' + bestMatch));[m
[31m-          for (int i = 0; i < countersLen; i++) {[m
[31m-            rowOffset += counters[i];[m
[31m-          }[m
[31m-        }[m
[31m-        return rowOffset;[m
[31m-      }[m
[31m-      return -1;[m
[31m-    }[m
[31m-[m
[31m-    BarcodeFormat EAN8Reader::getBarcodeFormat(){[m
[31m-      return BarcodeFormat_EAN_8;[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// file: zxing/oned/ITFReader.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "ITFReader.h"[m
[31m-// #include <zxing/oned/OneDResultPoint.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <math.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-[m
[31m-    static const int W = 3; // Pixel width of a wide line[m
[31m-    static const int N = 1; // Pixed width of a narrow line[m
[31m-[m
[31m-    const int DEFAULT_ALLOWED_LENGTHS_LEN = 10;[m
[31m-    const int DEFAULT_ALLOWED_LENGTHS[DEFAULT_ALLOWED_LENGTHS_LEN] = { 44, 24, 20, 18, 16, 14, 12, 10, 8, 6 };[m
[31m-[m
[31m-    /**[m
[31m-     * Start/end guard pattern.[m
[31m-     *[m
[31m-     * Note: The end pattern is reversed because the row is reversed before[m
[31m-     * searching for the END_PATTERN[m
[31m-     */[m
[31m-    static const int START_PATTERN_LEN = 4;[m
[31m-    static const int START_PATTERN[START_PATTERN_LEN] = {N, N, N, N};[m
[31m-[m
[31m-    static const int END_PATTERN_REVERSED_LEN = 3;[m
[31m-    static const int END_PATTERN_REVERSED[END_PATTERN_REVERSED_LEN] = {N, N, W};[m
[31m-[m
[31m-    /**[m
[31m-     * Patterns of Wide / Narrow lines to indicate each digit[m
[31m-     */[m
[31m-    static const int PATTERNS_LEN = 10;[m
[31m-    static const int PATTERNS[PATTERNS_LEN][5] = {[m
[31m-      {N, N, W, W, N}, // 0[m
[31m-      {W, N, N, N, W}, // 1[m
[31m-      {N, W, N, N, W}, // 2[m
[31m-      {W, W, N, N, N}, // 3[m
[31m-      {N, N, W, N, W}, // 4[m
[31m-      {W, N, W, N, N}, // 5[m
[31m-      {N, W, W, N, N}, // 6[m
[31m-      {N, N, N, W, W}, // 7[m
[31m-      {W, N, N, W, N}, // 8[m
[31m-      {N, W, N, W, N}  // 9[m
[31m-    };[m
[31m-[m
[31m-[m
[31m-    ITFReader::ITFReader() : narrowLineWidth(-1) {[m
[31m-    }[m
[31m-[m
[31m-[m
[31m-    Ref<Result> ITFReader::decodeRow(int rowNumber, Ref<BitArray> row) {[m
[31m-      int* startRange = 0;[m
[31m-      int* endRange = 0;[m
[31m-      try {[m
[31m-        // Find out where the Middle section (payload) starts & ends[m
[31m-        startRange = decodeStart(row);[m
[31m-        endRange = decodeEnd(row);[m
[31m-[m
[31m-        std::string tmpResult;[m
[31m-        decodeMiddle(row, startRange[1], endRange[0], tmpResult);[m
[31m-[m
[31m-        // To avoid false positives with 2D barcodes (and other patterns), make[m
[31m-        // an assumption that the decoded string must be a known length[m
[31m-        int length = tmpResult.length();[m
[31m-        bool lengthOK = false;[m
[31m-        for (int i = 0; i < DEFAULT_ALLOWED_LENGTHS_LEN; i++) {[m
[31m-          if (length == DEFAULT_ALLOWED_LENGTHS[i]) {[m
[31m-            lengthOK = true;[m
[31m-            break;[m
[31m-          }[m
[31m-        }[m
[31m-        if (!lengthOK) {[m
[31m-          throw ReaderException("not enough characters count");[m
[31m-        }[m
[31m-[m
[31m-        Ref<String> resultString(new String(tmpResult));[m
[31m-[m
[31m-        std::vector< Ref<ResultPoint> > resultPoints(2);[m
[31m-        Ref<OneDResultPoint> resultPoint1(new OneDResultPoint(startRange[1], (float) rowNumber));[m
[31m-        Ref<OneDResultPoint> resultPoint2(new OneDResultPoint(endRange[0], (float) rowNumber));[m
[31m-        resultPoints[0] = resultPoint1;[m
[31m-        resultPoints[1] = resultPoint2;[m
[31m-[m
[31m-        delete [] startRange;[m
[31m-        delete [] endRange;[m
[31m-        ArrayRef<unsigned char> resultBytes(1);[m
[31m-        return Ref<Result>(new Result(resultString, resultBytes, resultPoints, BarcodeFormat_ITF));[m
[31m-      } catch (ReaderException const& re) {[m
[31m-        delete [] startRange;[m
[31m-        delete [] endRange;[m
[31m-        return Ref<Result>();[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * @param row          row of black/white values to search[m
[31m-     * @param payloadStart offset of start pattern[m
[31m-     * @param resultString {@link StringBuffer} to append decoded chars to[m
[31m-     * @throws ReaderException if decoding could not complete successfully[m
[31m-     */[m
[31m-    void ITFReader::decodeMiddle(Ref<BitArray> row, int payloadStart, int payloadEnd,[m
[31m-        std::string& resultString) {[m
[31m-      // Digits are interleaved in pairs - 5 black lines for one digit, and the[m
[31m-      // 5[m
[31m-      // interleaved white lines for the second digit.[m
[31m-      // Therefore, need to scan 10 lines and then[m
[31m-      // split these into two arrays[m
[31m-      int counterDigitPairLen = 10;[m
[31m-      int counterDigitPair[counterDigitPairLen];[m
[31m-      for (int i=0; i<counterDigitPairLen; i++) {[m
[31m-        counterDigitPair[i] = 0;[m
[31m-      }[m
[31m-[m
[31m-      int counterBlack[5];[m
[31m-      int counterWhite[5];[m
[31m-      for (int i=0; i<5; i++) {[m
[31m-        counterBlack[i] = 0;[m
[31m-        counterWhite[i] = 0;[m
[31m-      }[m
[31m-[m
[31m-      while (payloadStart < payloadEnd) {[m
[31m-        // Get 10 runs of black/white.[m
[31m-        if (!recordPattern(row, payloadStart, counterDigitPair, counterDigitPairLen)) {[m
[31m-          throw ReaderException("");[m
[31m-        }[m
[31m-        // Split them into each array[m
[31m-        for (int k = 0; k < 5; k++) {[m
[31m-          int twoK = k << 1;[m
[31m-          counterBlack[k] = counterDigitPair[twoK];[m
[31m-          counterWhite[k] = counterDigitPair[twoK + 1];[m
[31m-        }[m
[31m-[m
[31m-        int bestMatch = decodeDigit(counterBlack, 5);[m
[31m-        resultString.append(1, (char) ('0' + bestMatch));[m
[31m-        bestMatch = decodeDigit(counterWhite, 5);[m
[31m-        resultString.append(1, (char) ('0' + bestMatch));[m
[31m-[m
[31m-        for (int i = 0; i < counterDigitPairLen; i++) {[m
[31m-          payloadStart += counterDigitPair[i];[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Identify where the start of the middle / payload section starts.[m
[31m-     *[m
[31m-     * @param row row of black/white values to search[m
[31m-     * @return Array, containing index of start of 'start block' and end of[m
[31m-     *         'start block'[m
[31m-     * @throws ReaderException[m
[31m-     */[m
[31m-    int* ITFReader::decodeStart(Ref<BitArray> row) {[m
[31m-      int endStart = skipWhiteSpace(row);[m
[31m-      int* startPattern = 0;[m
[31m-      try {[m
[31m-          startPattern = findGuardPattern(row, endStart, START_PATTERN, START_PATTERN_LEN);[m
[31m-[m
[31m-          // Determine the width of a narrow line in pixels. We can do this by[m
[31m-          // getting the width of the start pattern and dividing by 4 because its[m
[31m-          // made up of 4 narrow lines.[m
[31m-          narrowLineWidth = (startPattern[1] - startPattern[0]) >> 2;[m
[31m-          validateQuietZone(row, startPattern[0]);[m
[31m-          return startPattern;[m
[31m-      } catch (ReaderException const& re) {[m
[31m-          delete [] startPattern;[m
[31m-        throw re;[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Identify where the end of the middle / payload section ends.[m
[31m-     *[m
[31m-     * @param row row of black/white values to search[m
[31m-     * @return Array, containing index of start of 'end block' and end of 'end[m
[31m-     *         block'[m
[31m-     * @throws ReaderException[m
[31m-     */[m
[31m-[m
[31m-    int* ITFReader::decodeEnd(Ref<BitArray> row) {[m
[31m-      // For convenience, reverse the row and then[m
[31m-      // search from 'the start' for the end block[m
[31m-      row->reverse();[m
[31m-                        int* endPattern = 0;[m
[31m-      try {[m
[31m-        int endStart = skipWhiteSpace(row);[m
[31m-        endPattern = findGuardPattern(row, endStart, END_PATTERN_REVERSED, END_PATTERN_REVERSED_LEN);[m
[31m-[m
[31m-        // The start & end patterns must be pre/post fixed by a quiet zone. This[m
[31m-        // zone must be at least 10 times the width of a narrow line.[m
[31m-        // ref: http://www.barcode-1.net/i25code.html[m
[31m-        validateQuietZone(row, endPattern[0]);[m
[31m-[m
[31m-        // Now recalculate the indices of where the 'endblock' starts & stops to[m
[31m-        // accommodate[m
[31m-        // the reversed nature of the search[m
[31m-        int temp = endPattern[0];[m
[31m-        endPattern[0] = row->getSize() - endPattern[1];[m
[31m-        endPattern[1] = row->getSize() - temp;[m
[31m-[m
[31m-        row->reverse();[m
[31m-        return endPattern;[m
[31m-      } catch (ReaderException const& re) {[m
[31m-                                delete [] endPattern;[m
[31m-        row->reverse();[m
[31m-        throw re;[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * The start & end patterns must be pre/post fixed by a quiet zone. This[m
[31m-     * zone must be at least 10 times the width of a narrow line.  Scan back until[m
[31m-     * we either get to the start of the barcode or match the necessary number of[m
[31m-     * quiet zone pixels.[m
[31m-     *[m
[31m-     * Note: Its assumed the row is reversed when using this method to find[m
[31m-     * quiet zone after the end pattern.[m
[31m-     *[m
[31m-     * ref: http://www.barcode-1.net/i25code.html[m
[31m-     *[m
[31m-     * @param row bit array representing the scanned barcode.[m
[31m-     * @param startPattern index into row of the start or end pattern.[m
[31m-     * @throws ReaderException if the quiet zone cannot be found, a ReaderException is thrown.[m
[31m-     */[m
[31m-    void ITFReader::validateQuietZone(Ref<BitArray> row, int startPattern) {[m
[31m-      (void)row;[m
[31m-      (void)startPattern;[m
[31m-//#pragma mark needs some corrections[m
[31m-//      int quietCount = narrowLineWidth * 10;  // expect to find this many pixels of quiet zone[m
[31m-//[m
[31m-//      for (int i = startPattern - 1; quietCount > 0 && i >= 0; i--) {[m
[31m-//        if (row->get(i)) {[m
[31m-//          break;[m
[31m-//        }[m
[31m-//        quietCount--;[m
[31m-//      }[m
[31m-//      if (quietCount != 0) {[m
[31m-//        // Unable to find the necessary number of quiet zone pixels.[m
[31m-//        throw ReaderException("Unable to find the necessary number of quiet zone pixels");[m
[31m-//      }[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Skip all whitespace until we get to the first black line.[m
[31m-     *[m
[31m-     * @param row row of black/white values to search[m
[31m-     * @return index of the first black line.[m
[31m-     * @throws ReaderException Throws exception if no black lines are found in the row[m
[31m-     */[m
[31m-    int ITFReader::skipWhiteSpace(Ref<BitArray> row) {[m
[31m-      int width = row->getSize();[m
[31m-      int endStart = 0;[m
[31m-      while (endStart < width) {[m
[31m-        if (row->get(endStart)) {[m
[31m-          break;[m
[31m-        }[m
[31m-        endStart++;[m
[31m-      }[m
[31m-      if (endStart == width) {[m
[31m-        throw ReaderException("");[m
[31m-      }[m
[31m-      return endStart;[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * @param row       row of black/white values to search[m
[31m-     * @param rowOffset position to start search[m
[31m-     * @param pattern   pattern of counts of number of black and white pixels that are[m
[31m-     *                  being searched for as a pattern[m
[31m-     * @return start/end horizontal offset of guard pattern, as an array of two[m
[31m-     *         ints[m
[31m-     * @throws ReaderException if pattern is not found[m
[31m-     */[m
[31m-    int* ITFReader::findGuardPattern(Ref<BitArray> row, int rowOffset, const int pattern[],[m
[31m-        int patternLen) {[m
[31m-      // TODO: This is very similar to implementation in UPCEANReader. Consider if they can be[m
[31m-      // merged to a single method.[m
[31m-      int patternLength = patternLen;[m
[31m-      int counters[patternLength];[m
[31m-      for (int i=0; i<patternLength; i++) {[m
[31m-        counters[i] = 0;[m
[31m-      }[m
[31m-      int width = row->getSize();[m
[31m-      bool isWhite = false;[m
[31m-[m
[31m-      int counterPosition = 0;[m
[31m-      int patternStart = rowOffset;[m
[31m-      for (int x = rowOffset; x < width; x++) {[m
[31m-        bool pixel = row->get(x);[m
[31m-        if (pixel ^ isWhite) {[m
[31m-          counters[counterPosition]++;[m
[31m-        } else {[m
[31m-          if (counterPosition == patternLength - 1) {[m
[31m-            if (patternMatchVariance(counters, patternLength, pattern,[m
[31m-                MAX_INDIVIDUAL_VARIANCE) < MAX_AVG_VARIANCE) {[m
[31m-              int* resultValue = new int[2];[m
[31m-              resultValue[0] = patternStart;[m
[31m-              resultValue[1] = x;[m
[31m-              return resultValue;[m
[31m-            }[m
[31m-            patternStart += counters[0] + counters[1];[m
[31m-            for (int y = 2; y < patternLength; y++) {[m
[31m-              counters[y - 2] = counters[y];[m
[31m-            }[m
[31m-            counters[patternLength - 2] = 0;[m
[31m-            counters[patternLength - 1] = 0;[m
[31m-            counterPosition--;[m
[31m-          } else {[m
[31m-            counterPosition++;[m
[31m-          }[m
[31m-          counters[counterPosition] = 1;[m
[31m-          isWhite = !isWhite;[m
[31m-        }[m
[31m-      }[m
[31m-      throw ReaderException("");[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Attempts to decode a sequence of ITF black/white lines into single[m
[31m-     * digit.[m
[31m-     *[m
[31m-     * @param counters the counts of runs of observed black/white/black/... values[m
[31m-     * @return The decoded digit[m
[31m-     * @throws ReaderException if digit cannot be decoded[m
[31m-     */[m
[31m-    int ITFReader::decodeDigit(int counters[], int countersLen){[m
[31m-      unsigned int bestVariance = MAX_AVG_VARIANCE; // worst variance we'll accept[m
[31m-      int bestMatch = -1;[m
[31m-      int max = PATTERNS_LEN;[m
[31m-      for (int i = 0; i < max; i++) {[m
[31m-        int pattern[countersLen];[m
[31m-        for(int ind = 0; ind<countersLen; ind++){[m
[31m-          pattern[ind] = PATTERNS[i][ind];[m
[31m-        }[m
[31m-        unsigned int variance = patternMatchVariance(counters, countersLen, pattern,[m
[31m-            MAX_INDIVIDUAL_VARIANCE);[m
[31m-        if (variance < bestVariance) {[m
[31m-          bestVariance = variance;[m
[31m-          bestMatch = i;[m
[31m-        }[m
[31m-      }[m
[31m-      if (bestMatch >= 0) {[m
[31m-        return bestMatch;[m
[31m-      } else {[m
[31m-        throw ReaderException("digit didint found");[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    ITFReader::~ITFReader(){[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// file: zxing/oned/MultiFormatOneDReader.cpp[m
[31m-[m
[31m-/*[m
[31m- *  MultiFormatOneDReader.cpp[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "MultiFormatOneDReader.h"[m
[31m-[m
[31m-// #include <zxing/oned/MultiFormatUPCEANReader.h>[m
[31m-// #include <zxing/oned/Code39Reader.h>[m
[31m-// #include <zxing/oned/Code128Reader.h>[m
[31m-// #include <zxing/oned/ITFReader.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-    MultiFormatOneDReader::MultiFormatOneDReader(DecodeHints hints) : readers() {[m
[31m-      if (hints.containsFormat(BarcodeFormat_EAN_13) ||[m
[31m-          hints.containsFormat(BarcodeFormat_EAN_8) ||[m
[31m-          hints.containsFormat(BarcodeFormat_UPC_A) ||[m
[31m-          hints.containsFormat(BarcodeFormat_UPC_E)) {[m
[31m-        readers.push_back(Ref<OneDReader>(new MultiFormatUPCEANReader(hints)));[m
[31m-      }[m
[31m-      if (hints.containsFormat(BarcodeFormat_CODE_39)) {[m
[31m-        readers.push_back(Ref<OneDReader>(new Code39Reader()));[m
[31m-      }[m
[31m-      if (hints.containsFormat(BarcodeFormat_CODE_128)) {[m
[31m-        readers.push_back(Ref<OneDReader>(new Code128Reader()));[m
[31m-      }[m
[31m-      if (hints.containsFormat(BarcodeFormat_ITF)) {[m
[31m-        readers.push_back(Ref<OneDReader>(new ITFReader()));[m
[31m-      }[m
[31m-      if (readers.size() == 0) {[m
[31m-        readers.push_back(Ref<OneDReader>(new MultiFormatUPCEANReader(hints)));[m
[31m-        readers.push_back(Ref<OneDReader>(new Code39Reader()));[m
[31m-        readers.push_back(Ref<OneDReader>(new Code128Reader()));[m
[31m-        readers.push_back(Ref<OneDReader>(new ITFReader()));[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    Ref<Result> MultiFormatOneDReader::decodeRow(int rowNumber, Ref<BitArray> row) {[m
[31m-      int size = readers.size();[m
[31m-      for (int i = 0; i < size; i++) {[m
[31m-        OneDReader* reader = readers[i];[m
[31m-        Ref<Result> result = reader->decodeRow(rowNumber, row);[m
[31m-        if (!result.empty()) {[m
[31m-          return result;[m
[31m-        }[m
[31m-      }[m
[31m-      return Ref<Result>();[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// file: zxing/oned/MultiFormatUPCEANReader.cpp[m
[31m-[m
[31m-/*[m
[31m- *  MultiFormatUPCEANReader.cpp[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-// #include "MultiFormatUPCEANReader.h"[m
[31m-[m
[31m-// #include <zxing/oned/EAN13Reader.h>[m
[31m-// #include <zxing/oned/EAN8Reader.h>[m
[31m-// #include <zxing/oned/UPCEReader.h>[m
[31m-// #include <zxing/oned/UPCAReader.h>[m
[31m-// #include <zxing/oned/OneDResultPoint.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <math.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-[m
[31m-    MultiFormatUPCEANReader::MultiFormatUPCEANReader(DecodeHints hints) : readers() {[m
[31m-      if (hints.containsFormat(BarcodeFormat_EAN_13)) {[m
[31m-        readers.push_back(Ref<OneDReader>(new EAN13Reader()));[m
[31m-      } else if (hints.containsFormat(BarcodeFormat_UPC_A)) {[m
[31m-        readers.push_back(Ref<OneDReader>(new UPCAReader()));[m
[31m-      }[m
[31m-      if (hints.containsFormat(BarcodeFormat_EAN_8)) {[m
[31m-        readers.push_back(Ref<OneDReader>(new EAN8Reader()));[m
[31m-      }[m
[31m-      if (hints.containsFormat(BarcodeFormat_UPC_E)) {[m
[31m-        readers.push_back(Ref<OneDReader>(new UPCEReader()));[m
[31m-      }[m
[31m-      if (readers.size() == 0) {[m
[31m-        readers.push_back(Ref<OneDReader>(new EAN13Reader()));[m
[31m-        // UPC-A is covered by EAN-13[m
[31m-        readers.push_back(Ref<OneDReader>(new EAN8Reader()));[m
[31m-        readers.push_back(Ref<OneDReader>(new UPCEReader()));[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    Ref<Result> MultiFormatUPCEANReader::decodeRow(int rowNumber, Ref<BitArray> row) {[m
[31m-      // Compute this location once and reuse it on multiple implementations[m
[31m-      int size = readers.size();[m
[31m-      for (int i = 0; i < size; i++) {[m
[31m-        Ref<OneDReader> reader = readers[i];[m
[31m-        Ref<Result> result = reader->decodeRow(rowNumber, row);[m
[31m-        if (result.empty()) {[m
[31m-          continue;[m
[31m-        }[m
[31m-[m
[31m-        // Special case: a 12-digit code encoded in UPC-A is identical to a "0"[m
[31m-        // followed by those 12 digits encoded as EAN-13. Each will recognize such a code,[m
[31m-        // UPC-A as a 12-digit string and EAN-13 as a 13-digit string starting with "0".[m
[31m-        // Individually these are correct and their readers will both read such a code[m
[31m-        // and correctly call it EAN-13, or UPC-A, respectively.[m
[31m-        //[m
[31m-        // In this case, if we've been looking for both types, we'd like to call it[m
[31m-        // a UPC-A code. But for efficiency we only run the EAN-13 decoder to also read[m
[31m-        // UPC-A. So we special case it here, and convert an EAN-13 result to a UPC-A[m
[31m-        // result if appropriate.[m
[31m-        if (result->getBarcodeFormat() == BarcodeFormat_EAN_13) {[m
[31m-          const std::string& text = (result->getText())->getText();[m
[31m-          if (text[0] == '0') {[m
[31m-            Ref<String> resultString(new String(text.substr(1)));[m
[31m-            Ref<Result> res(new Result(resultString, result->getRawBytes(),[m
[31m-                result->getResultPoints(), BarcodeFormat_UPC_A));[m
[31m-            return res;[m
[31m-          }[m
[31m-        }[m
[31m-        return result;[m
[31m-      }[m
[31m-      return Ref<Result>();[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// file: zxing/oned/OneDReader.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  OneDReader.cpp[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "OneDReader.h"[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/oned/OneDResultPoint.h>[m
[31m-// #include <math.h>[m
[31m-// #include <limits.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-    using namespace std;[m
[31m-[m
[31m-    OneDReader::OneDReader() {[m
[31m-    }[m
[31m-[m
[31m-    Ref<Result> OneDReader::decode(Ref<BinaryBitmap> image, DecodeHints hints) {[m
[31m-      Ref<Result> result = doDecode(image, hints);[m
[31m-      if (result.empty()) { // && hints.getTryHarder() && image->isRotateSupported()) {[m
[31m-        Ref<BinaryBitmap> rotatedImage(image->rotateCounterClockwise());[m
[31m-        result = doDecode(rotatedImage, hints);[m
[31m-        if (!result.empty()) {[m
[31m-          /*[m
[31m-          // Record that we found it rotated 90 degrees CCW / 270 degrees CW[m
[31m-          Hashtable metadata = result.getResultMetadata();[m
[31m-          int orientation = 270;[m
[31m-          if (metadata != null && metadata.containsKey(ResultMetadataType.ORIENTATION)) {[m
[31m-            // But if we found it reversed in doDecode(), add in that result here:[m
[31m-            orientation = (orientation +[m
[31m-                     ((Integer) metadata.get(ResultMetadataType.ORIENTATION)).intValue()) % 360;[m
[31m-          }[m
[31m-          result.putMetadata(ResultMetadataType.ORIENTATION, new Integer(orientation));[m
[31m-          */[m
[31m-          // Update result points[m
[31m-          std::vector<Ref<ResultPoint> >& points (result->getResultPoints());[m
[31m-          int height = rotatedImage->getHeight();[m
[31m-          for (size_t i = 0; i < points.size(); i++) {[m
[31m-            points[i].reset(new OneDResultPoint(height - points[i]->getY() - 1, points[i]->getX()));[m
[31m-          }[m
[31m-        }[m
[31m-      }[m
[31m-      if (result.empty()) {[m
[31m-        throw ReaderException("");[m
[31m-      }[m
[31m-      return result;[m
[31m-    }[m
[31m-[m
[31m-    Ref<Result> OneDReader::doDecode(Ref<BinaryBitmap> image, DecodeHints hints) {[m
[31m-      int width = image->getWidth();[m
[31m-      int height = image->getHeight();[m
[31m-      Ref<BitArray> row(new BitArray(width));[m
[31m-      int middle = height >> 1;[m
[31m-      bool tryHarder = hints.getTryHarder();[m
[31m-      int rowStep = (int)fmax(1, height >> (tryHarder ? 8 : 5));[m
[31m-      int maxLines;[m
[31m-      if (tryHarder) {[m
[31m-        maxLines = height; // Look at the whole image, not just the center[m
[31m-      } else {[m
[31m-        maxLines = 15; // 15 rows spaced 1/32 apart is roughly the middle half of the image[m
[31m-      }[m
[31m-[m
[31m-      for (int x = 0; x < maxLines; x++) {[m
[31m-        // Scanning from the middle out. Determine which row we're looking at next:[m
[31m-        int rowStepsAboveOrBelow = (x + 1) >> 1;[m
[31m-        bool isAbove = (x & 0x01) == 0; // i.e. is x even?[m
[31m-        int rowNumber = middle + rowStep * (isAbove ? rowStepsAboveOrBelow : -rowStepsAboveOrBelow);[m
[31m-        if (rowNumber < 0 || rowNumber >= height) {[m
[31m-          // Oops, if we run off the top or bottom, stop[m
[31m-          break;[m
[31m-        }[m
[31m-[m
[31m-        // Estimate black point for this row and load it:[m
[31m-        try {[m
[31m-          row = image->getBlackRow(rowNumber, row);[m
[31m-        } catch (ReaderException const& re) {[m
[31m-          continue;[m
[31m-        } catch (IllegalArgumentException const& re) {[m
[31m-          continue;[m
[31m-        }[m
[31m-[m
[31m-        // While we have the image data in a BitArray, it's fairly cheap to reverse it in place to[m
[31m-        // handle decoding upside down barcodes.[m
[31m-        for (int attempt = 0; attempt < 2; attempt++) {[m
[31m-          if (attempt == 1) {[m
[31m-            row->reverse(); // reverse the row and continue[m
[31m-          }[m
[31m-[m
[31m-          // Look for a barcode[m
[31m-          Ref<Result> result = decodeRow(rowNumber, row);[m
[31m-          // We found our barcode[m
[31m-          if (!result.empty()) {[m
[31m-            if (attempt == 1) {[m
[31m-              // But it was upside down, so note that[m
[31m-              // result.putMetadata(ResultMetadataType.ORIENTATION, new Integer(180));[m
[31m-              // And remember to flip the result points horizontally.[m
[31m-              std::vector<Ref<ResultPoint> > points(result->getResultPoints());[m
[31m-              // if there's exactly two points (which there should be), flip the x coordinate[m
[31m-              // if there's not exactly 2, I don't know what do do with it[m
[31m-              if (points.size() == 2) {[m
[31m-                Ref<ResultPoint> pointZero(new OneDResultPoint(width - points[0]->getX() - 1,[m
[31m-                    points[0]->getY()));[m
[31m-                points[0] = pointZero;[m
[31m-[m
[31m-                Ref<ResultPoint> pointOne(new OneDResultPoint(width - points[1]->getX() - 1,[m
[31m-                    points[1]->getY()));[m
[31m-                points[1] = pointOne;[m
[31m-[m
[31m-                result.reset(new Result(result->getText(), result->getRawBytes(), points,[m
[31m-                    result->getBarcodeFormat()));[m
[31m-              }[m
[31m-            }[m
[31m-            return result;[m
[31m-          }[m
[31m-        }[m
[31m-      }[m
[31m-      return Ref<Result>();[m
[31m-    }[m
[31m-[m
[31m-    unsigned int OneDReader::patternMatchVariance(int counters[], int countersSize,[m
[31m-        const int pattern[], int maxIndividualVariance) {[m
[31m-      int numCounters = countersSize;[m
[31m-      unsigned int total = 0;[m
[31m-      unsigned int patternLength = 0;[m
[31m-      for (int i = 0; i < numCounters; i++) {[m
[31m-        total += counters[i];[m
[31m-        patternLength += pattern[i];[m
[31m-      }[m
[31m-      if (total < patternLength) {[m
[31m-        // If we don't even have one pixel per unit of bar width, assume this is too small[m
[31m-        // to reliably match, so fail:[m
[31m-        return INT_MAX;[m
[31m-      }[m
[31m-      // We're going to fake floating-point math in integers. We just need to use more bits.[m
[31m-      // Scale up patternLength so that intermediate values below like scaledCounter will have[m
[31m-      // more "significant digits"[m
[31m-      unsigned int unitBarWidth = (total << INTEGER_MATH_SHIFT) / patternLength;[m
[31m-      maxIndividualVariance = (maxIndividualVariance * unitBarWidth) >> INTEGER_MATH_SHIFT;[m
[31m-[m
[31m-      unsigned int totalVariance = 0;[m
[31m-      for (int x = 0; x < numCounters; x++) {[m
[31m-        int counter = counters[x] << INTEGER_MATH_SHIFT;[m
[31m-        int scaledPattern = pattern[x] * unitBarWidth;[m
[31m-        int variance = counter > scaledPattern ? counter - scaledPattern : scaledPattern - counter;[m
[31m-        if (variance > maxIndividualVariance) {[m
[31m-          return INT_MAX;[m
[31m-        }[m
[31m-        totalVariance += variance;[m
[31m-      }[m
[31m-      return totalVariance / total;[m
[31m-    }[m
[31m-[m
[31m-    bool OneDReader::recordPattern(Ref<BitArray> row, int start, int counters[], int countersCount) {[m
[31m-      int numCounters = countersCount;//sizeof(counters) / sizeof(int);[m
[31m-      for (int i = 0; i < numCounters; i++) {[m
[31m-        counters[i] = 0;[m
[31m-      }[m
[31m-      int end = row->getSize();[m
[31m-      if (start >= end) {[m
[31m-        return false;[m
[31m-      }[m
[31m-      bool isWhite = !row->get(start);[m
[31m-      int counterPosition = 0;[m
[31m-      int i = start;[m
[31m-      while (i < end) {[m
[31m-        bool pixel = row->get(i);[m
[31m-        if (pixel ^ isWhite) { // that is, exactly one is true[m
[31m-          counters[counterPosition]++;[m
[31m-        } else {[m
[31m-          counterPosition++;[m
[31m-          if (counterPosition == numCounters) {[m
[31m-            break;[m
[31m-          } else {[m
[31m-            counters[counterPosition] = 1;[m
[31m-            isWhite ^= true; // isWhite = !isWhite;[m
[31m-          }[m
[31m-        }[m
[31m-        i++;[m
[31m-      }[m
[31m-      // If we read fully the last section of pixels and filled up our counters -- or filled[m
[31m-      // the last counter but ran off the side of the image, OK. Otherwise, a problem.[m
[31m-      if (!(counterPosition == numCounters || (counterPosition == numCounters - 1 && i == end))) {[m
[31m-        return false;[m
[31m-      }[m
[31m-      return true;[m
[31m-    }[m
[31m-[m
[31m-    OneDReader::~OneDReader() {[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// file: zxing/oned/OneDResultPoint.cpp[m
[31m-[m
[31m-/*[m
[31m- *  OneDResultPoint.cpp[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "OneDResultPoint.h"[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace oned {[m
[31m-[m
[31m-		OneDResultPoint::OneDResultPoint(float posX, float posY) : ResultPoint(posX,posY) {[m
[31m-		}[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/oned/UPCAReader.cpp[m
[31m-[m
[31m-/*[m
[31m- *  UPCAReader.cpp[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "UPCAReader.h"[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-    UPCAReader::UPCAReader() : ean13Reader() {[m
[31m-    }[m
[31m-[m
[31m-    Ref<Result> UPCAReader::decodeRow(int rowNumber, Ref<BitArray> row) {[m
[31m-      return maybeReturnResult(ean13Reader.decodeRow(rowNumber, row));[m
[31m-    }[m
[31m-[m
[31m-    Ref<Result> UPCAReader::decodeRow(int rowNumber, Ref<BitArray> row, int startGuardBegin,[m
[31m-        int startGuardEnd) {[m
[31m-      return maybeReturnResult(ean13Reader.decodeRow(rowNumber, row, startGuardBegin,[m
[31m-          startGuardEnd));[m
[31m-    }[m
[31m-[m
[31m-    Ref<Result> UPCAReader::decode(Ref<BinaryBitmap> image, DecodeHints hints) {[m
[31m-      return maybeReturnResult(ean13Reader.decode(image, hints));[m
[31m-    }[m
[31m-[m
[31m-    int UPCAReader::decodeMiddle(Ref<BitArray> row, int startGuardBegin, int startGuardEnd,[m
[31m-        std::string& resultString) {[m
[31m-      return ean13Reader.decodeMiddle(row, startGuardBegin, startGuardEnd, resultString);[m
[31m-    }[m
[31m-[m
[31m-    Ref<Result> UPCAReader::maybeReturnResult(Ref<Result> result) {[m
[31m-      if (result.empty()) {[m
[31m-        return result;[m
[31m-      }[m
[31m-      const std::string& text = (result->getText())->getText();[m
[31m-      if (text[0] == '0') {[m
[31m-        Ref<String> resultString(new String(text.substr(1)));[m
[31m-        Ref<Result> res(new Result(resultString, result->getRawBytes(), result->getResultPoints(),[m
[31m-            BarcodeFormat_UPC_A));[m
[31m-        return res;[m
[31m-      }[m
[31m-      return Ref<Result>();[m
[31m-    }[m
[31m-[m
[31m-    BarcodeFormat UPCAReader::getBarcodeFormat(){[m
[31m-      return BarcodeFormat_UPC_A;[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// file: zxing/oned/UPCEANReader.cpp[m
[31m-[m
[31m-/*[m
[31m- *  UPCEANReader.cpp[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "UPCEANReader.h"[m
[31m-// #include <zxing/oned/OneDResultPoint.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-[m
[31m-    /**[m
[31m-     * Start/end guard pattern.[m
[31m-     */[m
[31m-    static const int START_END_PATTERN[3] = {1, 1, 1};[m
[31m-[m
[31m-    /**[m
[31m-     * Pattern marking the middle of a UPC/EAN pattern, separating the two halves.[m
[31m-     */[m
[31m-    static const int MIDDLE_PATTERN_LEN = 5;[m
[31m-    static const int MIDDLE_PATTERN[MIDDLE_PATTERN_LEN] = {1, 1, 1, 1, 1};[m
[31m-[m
[31m-    /**[m
[31m-     * "Odd", or "L" patterns used to encode UPC/EAN digits.[m
[31m-     */[m
[31m-    const int L_PATTERNS_LEN = 10;[m
[31m-    const int L_PATTERNS_SUB_LEN = 4;[m
[31m-    const int L_PATTERNS[L_PATTERNS_LEN][L_PATTERNS_SUB_LEN] = {[m
[31m-      {3, 2, 1, 1}, // 0[m
[31m-      {2, 2, 2, 1}, // 1[m
[31m-      {2, 1, 2, 2}, // 2[m
[31m-      {1, 4, 1, 1}, // 3[m
[31m-      {1, 1, 3, 2}, // 4[m
[31m-      {1, 2, 3, 1}, // 5[m
[31m-      {1, 1, 1, 4}, // 6[m
[31m-      {1, 3, 1, 2}, // 7[m
[31m-      {1, 2, 1, 3}, // 8[m
[31m-      {3, 1, 1, 2}  // 9[m
[31m-    };[m
[31m-[m
[31m-    /**[m
[31m-     * As above but also including the "even", or "G" patterns used to encode UPC/EAN digits.[m
[31m-     */[m
[31m-    const int L_AND_G_PATTERNS_LEN = 20;[m
[31m-    const int L_AND_G_PATTERNS_SUB_LEN = 4;[m
[31m-    const int L_AND_G_PATTERNS[L_AND_G_PATTERNS_LEN][L_AND_G_PATTERNS_SUB_LEN] = {[m
[31m-      {3, 2, 1, 1}, // 0[m
[31m-      {2, 2, 2, 1}, // 1[m
[31m-      {2, 1, 2, 2}, // 2[m
[31m-      {1, 4, 1, 1}, // 3[m
[31m-      {1, 1, 3, 2}, // 4[m
[31m-      {1, 2, 3, 1}, // 5[m
[31m-      {1, 1, 1, 4}, // 6[m
[31m-      {1, 3, 1, 2}, // 7[m
[31m-      {1, 2, 1, 3}, // 8[m
[31m-      {3, 1, 1, 2}, // 9[m
[31m-      {1, 1, 2, 3}, // 10 reversed 0[m
[31m-      {1, 2, 2, 2}, // 11 reversed 1[m
[31m-      {2, 2, 1, 2}, // 12 reversed 2[m
[31m-      {1, 1, 4, 1}, // 13 reversed 3[m
[31m-      {2, 3, 1, 1}, // 14 reversed 4[m
[31m-      {1, 3, 2, 1}, // 15 reversed 5[m
[31m-      {4, 1, 1, 1}, // 16 reversed 6[m
[31m-      {2, 1, 3, 1}, // 17 reversed 7[m
[31m-      {3, 1, 2, 1}, // 18 reversed 8[m
[31m-      {2, 1, 1, 3}  // 19 reversed 9[m
[31m-    };[m
[31m-[m
[31m-[m
[31m-    int UPCEANReader::getMIDDLE_PATTERN_LEN() {[m
[31m-      return MIDDLE_PATTERN_LEN;[m
[31m-    }[m
[31m-[m
[31m-    const int* UPCEANReader::getMIDDLE_PATTERN() {[m
[31m-      return MIDDLE_PATTERN;[m
[31m-    }[m
[31m-[m
[31m-    UPCEANReader::UPCEANReader() {[m
[31m-    }[m
[31m-[m
[31m-[m
[31m-    Ref<Result> UPCEANReader::decodeRow(int rowNumber, Ref<BitArray> row) {[m
[31m-      int rangeStart;[m
[31m-      int rangeEnd;[m
[31m-			if (findStartGuardPattern(row, &rangeStart, &rangeEnd)) {[m
[31m-        try {[m
[31m-          return decodeRow(rowNumber, row, rangeStart, rangeEnd);[m
[31m-        } catch (ReaderException const& re) {[m
[31m-        }[m
[31m-			}[m
[31m-			return Ref<Result>();[m
[31m-    }[m
[31m-[m
[31m-    Ref<Result> UPCEANReader::decodeRow(int rowNumber, Ref<BitArray> row, int startGuardBegin,[m
[31m-        int startGuardEnd) {[m
[31m-      std::string tmpResultString;[m
[31m-      std::string& tmpResultStringRef = tmpResultString;[m
[31m-      int endStart = decodeMiddle(row, startGuardBegin, startGuardEnd, tmpResultStringRef);[m
[31m-      if (endStart < 0) {[m
[31m-        return Ref<Result>();[m
[31m-      }[m
[31m-[m
[31m-      int endGuardBegin;[m
[31m-      int endGuardEnd;[m
[31m-      if (!decodeEnd(row, endStart, &endGuardBegin, &endGuardEnd)) {[m
[31m-        return Ref<Result>();[m
[31m-      }[m
[31m-[m
[31m-      // Make sure there is a quiet zone at least as big as the end pattern after the barcode.[m
[31m-      // The spec might want more whitespace, but in practice this is the maximum we can count on.[m
[31m-      size_t quietEnd = endGuardEnd + (endGuardEnd - endGuardBegin);[m
[31m-      if (quietEnd >= row->getSize() || !row->isRange(endGuardEnd, quietEnd, false)) {[m
[31m-        return Ref<Result>();[m
[31m-      }[m
[31m-[m
[31m-      if (!checkChecksum(tmpResultString)) {[m
[31m-        return Ref<Result>();[m
[31m-      }[m
[31m-[m
[31m-      Ref<String> resultString(new String(tmpResultString));[m
[31m-      float left = (float) (startGuardBegin + startGuardEnd) / 2.0f;[m
[31m-      float right = (float) (endGuardBegin + endGuardEnd) / 2.0f;[m
[31m-[m
[31m-      std::vector< Ref<ResultPoint> > resultPoints(2);[m
[31m-      Ref<OneDResultPoint> resultPoint1(new OneDResultPoint(left, (float) rowNumber));[m
[31m-      Ref<OneDResultPoint> resultPoint2(new OneDResultPoint(right, (float) rowNumber));[m
[31m-      resultPoints[0] = resultPoint1;[m
[31m-      resultPoints[1] = resultPoint2;[m
[31m-[m
[31m-      ArrayRef<unsigned char> resultBytes(1);[m
[31m-      return Ref<Result>(new Result(resultString, resultBytes, resultPoints, getBarcodeFormat()));[m
[31m-    }[m
[31m-[m
[31m-    bool UPCEANReader::findStartGuardPattern(Ref<BitArray> row, int* rangeStart, int* rangeEnd) {[m
[31m-      int nextStart = 0;[m
[31m-      while (findGuardPattern(row, nextStart, false, START_END_PATTERN,[m
[31m-          sizeof(START_END_PATTERN) / sizeof(int), rangeStart, rangeEnd)) {[m
[31m-        int start = *rangeStart;[m
[31m-        nextStart = *rangeEnd;[m
[31m-        // Make sure there is a quiet zone at least as big as the start pattern before the barcode.[m
[31m-        // If this check would run off the left edge of the image, do not accept this barcode,[m
[31m-        // as it is very likely to be a false positive.[m
[31m-        int quietStart = start - (nextStart - start);[m
[31m-        if (quietStart >= 0 && row->isRange(quietStart, start, false)) {[m
[31m-          return true;[m
[31m-        }[m
[31m-      }[m
[31m-      return false;[m
[31m-    }[m
[31m-[m
[31m-    bool UPCEANReader::findGuardPattern(Ref<BitArray> row, int rowOffset, bool whiteFirst,[m
[31m-        const int pattern[], int patternLen, int* start, int* end) {[m
[31m-      int patternLength = patternLen;[m
[31m-      int counters[patternLength];[m
[31m-      int countersCount = sizeof(counters) / sizeof(int);[m
[31m-      for (int i = 0; i < countersCount; i++) {[m
[31m-        counters[i] = 0;[m
[31m-      }[m
[31m-      int width = row->getSize();[m
[31m-      bool isWhite = false;[m
[31m-      while (rowOffset < width) {[m
[31m-        isWhite = !row->get(rowOffset);[m
[31m-        if (whiteFirst == isWhite) {[m
[31m-          break;[m
[31m-        }[m
[31m-        rowOffset++;[m
[31m-      }[m
[31m-[m
[31m-      int counterPosition = 0;[m
[31m-      int patternStart = rowOffset;[m
[31m-      for (int x = rowOffset; x < width; x++) {[m
[31m-        bool pixel = row->get(x);[m
[31m-        if (pixel ^ isWhite) {[m
[31m-          counters[counterPosition]++;[m
[31m-        } else {[m
[31m-          if (counterPosition == patternLength - 1) {[m
[31m-            if (patternMatchVariance(counters, countersCount, pattern,[m
[31m-                MAX_INDIVIDUAL_VARIANCE) < MAX_AVG_VARIANCE) {[m
[31m-              *start = patternStart;[m
[31m-              *end = x;[m
[31m-              return true;[m
[31m-            }[m
[31m-            patternStart += counters[0] + counters[1];[m
[31m-            for (int y = 2; y < patternLength; y++) {[m
[31m-              counters[y - 2] = counters[y];[m
[31m-            }[m
[31m-            counters[patternLength - 2] = 0;[m
[31m-            counters[patternLength - 1] = 0;[m
[31m-            counterPosition--;[m
[31m-          } else {[m
[31m-            counterPosition++;[m
[31m-          }[m
[31m-          counters[counterPosition] = 1;[m
[31m-          isWhite = !isWhite;[m
[31m-        }[m
[31m-      }[m
[31m-      return false;[m
[31m-    }[m
[31m-[m
[31m-    bool UPCEANReader::decodeEnd(Ref<BitArray> row, int endStart, int* endGuardBegin,[m
[31m-        int* endGuardEnd) {[m
[31m-      return findGuardPattern(row, endStart, false, START_END_PATTERN,[m
[31m-          sizeof(START_END_PATTERN) / sizeof(int), endGuardBegin, endGuardEnd);[m
[31m-    }[m
[31m-[m
[31m-    int UPCEANReader::decodeDigit(Ref<BitArray> row, int counters[], int countersLen, int rowOffset,[m
[31m-        UPC_EAN_PATTERNS patternType) {[m
[31m-      if (!recordPattern(row, rowOffset, counters, countersLen)) {[m
[31m-        return -1;[m
[31m-      }[m
[31m-      unsigned int bestVariance = MAX_AVG_VARIANCE; // worst variance we'll accept[m
[31m-      int bestMatch = -1;[m
[31m-[m
[31m-      int max = 0;[m
[31m-      switch (patternType) {[m
[31m-        case UPC_EAN_PATTERNS_L_PATTERNS:[m
[31m-          max = L_PATTERNS_LEN;[m
[31m-          for (int i = 0; i < max; i++) {[m
[31m-            int pattern[countersLen];[m
[31m-            for(int j = 0; j< countersLen; j++){[m
[31m-              pattern[j] = L_PATTERNS[i][j];[m
[31m-            }[m
[31m-[m
[31m-            unsigned int variance = patternMatchVariance(counters, countersLen, pattern,[m
[31m-                MAX_INDIVIDUAL_VARIANCE);[m
[31m-            if (variance < bestVariance) {[m
[31m-              bestVariance = variance;[m
[31m-              bestMatch = i;[m
[31m-            }[m
[31m-          }[m
[31m-          break;[m
[31m-        case UPC_EAN_PATTERNS_L_AND_G_PATTERNS:[m
[31m-          max = L_AND_G_PATTERNS_LEN;[m
[31m-          for (int i = 0; i < max; i++) {[m
[31m-            int pattern[countersLen];[m
[31m-            for(int j = 0; j< countersLen; j++){[m
[31m-              pattern[j] = L_AND_G_PATTERNS[i][j];[m
[31m-            }[m
[31m-[m
[31m-            unsigned int variance = patternMatchVariance(counters, countersLen, pattern,[m
[31m-                MAX_INDIVIDUAL_VARIANCE);[m
[31m-            if (variance < bestVariance) {[m
[31m-              bestVariance = variance;[m
[31m-              bestMatch = i;[m
[31m-            }[m
[31m-          }[m
[31m-          break;[m
[31m-        default:[m
[31m-          break;[m
[31m-      }[m
[31m-      return bestMatch;[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * @return {@link #checkStandardUPCEANChecksum(String)}[m
[31m-     */[m
[31m-    bool UPCEANReader::checkChecksum(std::string s) {[m
[31m-      return checkStandardUPCEANChecksum(s);[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Computes the UPC/EAN checksum on a string of digits, and reports[m
[31m-     * whether the checksum is correct or not.[m
[31m-     *[m
[31m-     * @param s string of digits to check[m
[31m-     * @return true iff string of digits passes the UPC/EAN checksum algorithm[m
[31m-     */[m
[31m-    bool UPCEANReader::checkStandardUPCEANChecksum(std::string s) {[m
[31m-      int length = s.length();[m
[31m-      if (length == 0) {[m
[31m-        return false;[m
[31m-      }[m
[31m-[m
[31m-      int sum = 0;[m
[31m-      for (int i = length - 2; i >= 0; i -= 2) {[m
[31m-        int digit = (int) s[i] - (int) '0';[m
[31m-        if (digit < 0 || digit > 9) {[m
[31m-          return false;[m
[31m-        }[m
[31m-        sum += digit;[m
[31m-      }[m
[31m-      sum *= 3;[m
[31m-      for (int i = length - 1; i >= 0; i -= 2) {[m
[31m-        int digit = (int) s[i] - (int) '0';[m
[31m-        if (digit < 0 || digit > 9) {[m
[31m-          return false;[m
[31m-        }[m
[31m-        sum += digit;[m
[31m-      }[m
[31m-      return sum % 10 == 0;[m
[31m-    }[m
[31m-[m
[31m-    UPCEANReader::~UPCEANReader() {[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// file: zxing/oned/UPCEReader.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "UPCEReader.h"[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-[m
[31m-    /**[m
[31m-     * The pattern that marks the middle, and end, of a UPC-E pattern.[m
[31m-     * There is no "second half" to a UPC-E barcode.[m
[31m-     */[m
[31m-    static const int MIDDLE_END_PATTERN[6] = {1, 1, 1, 1, 1, 1};[m
[31m-[m
[31m-    /**[m
[31m-     * See {@link #L_AND_G_PATTERNS}; these values similarly represent patterns of[m
[31m-     * even-odd parity encodings of digits that imply both the number system (0 or 1)[m
[31m-     * used, and the check digit.[m
[31m-     */[m
[31m-    static const int NUMSYS_AND_CHECK_DIGIT_PATTERNS[2][10] = {[m
[31m-      {0x38, 0x34, 0x32, 0x31, 0x2C, 0x26, 0x23, 0x2A, 0x29, 0x25},[m
[31m-      {0x07, 0x0B, 0x0D, 0x0E, 0x13, 0x19, 0x1C, 0x15, 0x16, 0x1A}[m
[31m-    };[m
[31m-[m
[31m-    UPCEReader::UPCEReader() {[m
[31m-    }[m
[31m-[m
[31m-    int UPCEReader::decodeMiddle(Ref<BitArray> row, int startGuardBegin, int startGuardEnd,[m
[31m-        std::string& resultString) {[m
[31m-      (void)startGuardBegin;[m
[31m-      const int countersLen = 4;[m
[31m-      int counters[countersLen] = { 0, 0, 0, 0 };[m
[31m-[m
[31m-      int end = row->getSize();[m
[31m-      int rowOffset = startGuardEnd;[m
[31m-      int lgPatternFound = 0;[m
[31m-[m
[31m-      for (int x = 0; x < 6 && rowOffset < end; x++) {[m
[31m-        int bestMatch = decodeDigit(row, counters, countersLen, rowOffset,[m
[31m-            UPC_EAN_PATTERNS_L_AND_G_PATTERNS);[m
[31m-        if (bestMatch < 0) {[m
[31m-          return -1;[m
[31m-        }[m
[31m-        resultString.append(1, (char) ('0' + bestMatch % 10));[m
[31m-        for (int i = 0; i < countersLen; i++) {[m
[31m-          rowOffset += counters[i];[m
[31m-        }[m
[31m-        if (bestMatch >= 10) {[m
[31m-          lgPatternFound |= 1 << (5 - x);[m
[31m-        }[m
[31m-      }[m
[31m-[m
[31m-      if (!determineNumSysAndCheckDigit(resultString, lgPatternFound)) {[m
[31m-        return -1;[m
[31m-      }[m
[31m-      return rowOffset;[m
[31m-    }[m
[31m-[m
[31m-    bool UPCEReader::decodeEnd(Ref<BitArray> row, int endStart, int* endGuardBegin,[m
[31m-        int* endGuardEnd) {[m
[31m-      return findGuardPattern(row, endStart, true, MIDDLE_END_PATTERN,[m
[31m-          sizeof(MIDDLE_END_PATTERN) / sizeof(int), endGuardBegin, endGuardEnd);[m
[31m-    }[m
[31m-[m
[31m-    bool UPCEReader::checkChecksum(std::string s){[m
[31m-      return UPCEANReader::checkChecksum(convertUPCEtoUPCA(s));[m
[31m-    }[m
[31m-[m
[31m-[m
[31m-    bool UPCEReader::determineNumSysAndCheckDigit(std::string& resultString, int lgPatternFound) {[m
[31m-      for (int numSys = 0; numSys <= 1; numSys++) {[m
[31m-        for (int d = 0; d < 10; d++) {[m
[31m-          if (lgPatternFound == NUMSYS_AND_CHECK_DIGIT_PATTERNS[numSys][d]) {[m
[31m-            resultString.insert(0, 1, (char) ('0' + numSys));[m
[31m-            resultString.append(1, (char) ('0' + d));[m
[31m-            return true;[m
[31m-          }[m
[31m-        }[m
[31m-      }[m
[31m-      return false;[m
[31m-    }[m
[31m-[m
[31m-    /**[m
[31m-     * Expands a UPC-E value back into its full, equivalent UPC-A code value.[m
[31m-     *[m
[31m-     * @param upce UPC-E code as string of digits[m
[31m-     * @return equivalent UPC-A code as string of digits[m
[31m-     */[m
[31m-    std::string UPCEReader::convertUPCEtoUPCA(std::string upce) {[m
[31m-      std::string result;[m
[31m-      result.append(1, upce[0]);[m
[31m-      char lastChar = upce[6];[m
[31m-      switch (lastChar) {[m
[31m-        case '0':[m
[31m-        case '1':[m
[31m-        case '2':[m
[31m-          result.append(upce.substr(1,2));[m
[31m-          result.append(1, lastChar);[m
[31m-          result.append("0000");[m
[31m-          result.append(upce.substr(3,3));[m
[31m-          break;[m
[31m-        case '3':[m
[31m-          result.append(upce.substr(1,3));[m
[31m-          result.append("00000");[m
[31m-          result.append(upce.substr(4,2));[m
[31m-          break;[m
[31m-        case '4':[m
[31m-          result.append(upce.substr(1,4));[m
[31m-          result.append("00000");[m
[31m-          result.append(1, upce[5]);[m
[31m-          break;[m
[31m-        default:[m
[31m-          result.append(upce.substr(1,5));[m
[31m-          result.append("0000");[m
[31m-          result.append(1, lastChar);[m
[31m-          break;[m
[31m-      }[m
[31m-      result.append(1, upce[7]);[m
[31m-      return result;[m
[31m-    }[m
[31m-[m
[31m-[m
[31m-    BarcodeFormat UPCEReader::getBarcodeFormat() {[m
[31m-      return BarcodeFormat_UPC_E;[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/ErrorCorrectionLevel.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  ErrorCorrectionLevel.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 15/05/2008.[m
[31m- *  Copyright 2008-2011 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/ErrorCorrectionLevel.h>[m
[31m-[m
[31m-using std::string;[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-ErrorCorrectionLevel::ErrorCorrectionLevel(int inOrdinal,[m
[31m-                                           int bits,[m
[31m-                                           char const* name) :[m
[31m-  ordinal_(inOrdinal), bits_(bits), name_(name) {}[m
[31m-[m
[31m-int ErrorCorrectionLevel::ordinal() const {[m
[31m-  return ordinal_;[m
[31m-}[m
[31m-[m
[31m-int ErrorCorrectionLevel::bits() const {[m
[31m-  return bits_;[m
[31m-}[m
[31m-[m
[31m-string const& ErrorCorrectionLevel::name() const {[m
[31m-  return name_;[m
[31m-}[m
[31m-[m
[31m-ErrorCorrectionLevel::operator string const& () const {[m
[31m-  return name_;[m
[31m-}[m
[31m-[m
[31m-ErrorCorrectionLevel& ErrorCorrectionLevel::forBits(int bits) {[m
[31m-  if (bits < 0 || bits >= N_LEVELS) {[m
[31m-    throw ReaderException("Ellegal error correction level bits");[m
[31m-  }[m
[31m-  return *FOR_BITS[bits];[m
[31m-}[m
[31m-[m
[31m-  ErrorCorrectionLevel ErrorCorrectionLevel::L(0, 0x01, "L");[m
[31m-  ErrorCorrectionLevel ErrorCorrectionLevel::M(1, 0x00, "M");[m
[31m-  ErrorCorrectionLevel ErrorCorrectionLevel::Q(2, 0x03, "Q");[m
[31m-  ErrorCorrectionLevel ErrorCorrectionLevel::H(3, 0x02, "H");[m
[31m-ErrorCorrectionLevel *ErrorCorrectionLevel::FOR_BITS[] = { &M, &L, &H, &Q };[m
[31m-int ErrorCorrectionLevel::N_LEVELS = 4;[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/FormatInformation.cpp[m
[31m-[m
[31m-/*[m
[31m- *  FormatInformation.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 18/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/FormatInformation.h>[m
[31m-// #include <limits>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-int FormatInformation::FORMAT_INFO_MASK_QR = 0x5412;[m
[31m-int FormatInformation::FORMAT_INFO_DECODE_LOOKUP[][2] = { { 0x5412, 0x00 }, { 0x5125, 0x01 }, { 0x5E7C, 0x02 }, {[m
[31m-    0x5B4B, 0x03 }, { 0x45F9, 0x04 }, { 0x40CE, 0x05 }, { 0x4F97, 0x06 }, { 0x4AA0, 0x07 }, { 0x77C4, 0x08 }, {[m
[31m-    0x72F3, 0x09 }, { 0x7DAA, 0x0A }, { 0x789D, 0x0B }, { 0x662F, 0x0C }, { 0x6318, 0x0D }, { 0x6C41, 0x0E }, {[m
[31m-    0x6976, 0x0F }, { 0x1689, 0x10 }, { 0x13BE, 0x11 }, { 0x1CE7, 0x12 }, { 0x19D0, 0x13 }, { 0x0762, 0x14 }, {[m
[31m-    0x0255, 0x15 }, { 0x0D0C, 0x16 }, { 0x083B, 0x17 }, { 0x355F, 0x18 }, { 0x3068, 0x19 }, { 0x3F31, 0x1A }, {[m
[31m-    0x3A06, 0x1B }, { 0x24B4, 0x1C }, { 0x2183, 0x1D }, { 0x2EDA, 0x1E }, { 0x2BED, 0x1F },[m
[31m-};[m
[31m-int FormatInformation::N_FORMAT_INFO_DECODE_LOOKUPS = 32;[m
[31m-[m
[31m-int FormatInformation::BITS_SET_IN_HALF_BYTE[] = { 0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4 };[m
[31m-[m
[31m-FormatInformation::FormatInformation(int formatInfo) :[m
[31m-    errorCorrectionLevel_(ErrorCorrectionLevel::forBits((formatInfo >> 3) & 0x03)), dataMask_([m
[31m-      (unsigned char)(formatInfo & 0x07)) {[m
[31m-}[m
[31m-[m
[31m-ErrorCorrectionLevel& FormatInformation::getErrorCorrectionLevel() {[m
[31m-  return errorCorrectionLevel_;[m
[31m-}[m
[31m-[m
[31m-unsigned char FormatInformation::getDataMask() {[m
[31m-  return dataMask_;[m
[31m-}[m
[31m-[m
[31m-int FormatInformation::numBitsDiffering(unsigned int a, unsigned int b) {[m
[31m-  a ^= b;[m
[31m-  return BITS_SET_IN_HALF_BYTE[a & 0x0F] + BITS_SET_IN_HALF_BYTE[(a >> 4 & 0x0F)] + BITS_SET_IN_HALF_BYTE[(a >> 8[m
[31m-         & 0x0F)] + BITS_SET_IN_HALF_BYTE[(a >> 12 & 0x0F)] + BITS_SET_IN_HALF_BYTE[(a >> 16 & 0x0F)][m
[31m-         + BITS_SET_IN_HALF_BYTE[(a >> 20 & 0x0F)] + BITS_SET_IN_HALF_BYTE[(a >> 24 & 0x0F)][m
[31m-         + BITS_SET_IN_HALF_BYTE[(a >> 28 & 0x0F)];[m
[31m-}[m
[31m-[m
[31m-Ref<FormatInformation> FormatInformation::decodeFormatInformation(int maskedFormatInfo1, int maskedFormatInfo2) {[m
[31m-  Ref<FormatInformation> result(doDecodeFormatInformation(maskedFormatInfo1, maskedFormatInfo2));[m
[31m-  if (result != 0) {[m
[31m-    return result;[m
[31m-  }[m
[31m-  // Should return null, but, some QR codes apparently[m
[31m-  // do not mask this info. Try again by actually masking the pattern[m
[31m-  // first[m
[31m-  return doDecodeFormatInformation(maskedFormatInfo1 ^ FORMAT_INFO_MASK_QR,[m
[31m-                                   maskedFormatInfo2  ^ FORMAT_INFO_MASK_QR);[m
[31m-}[m
[31m-Ref<FormatInformation> FormatInformation::doDecodeFormatInformation(int maskedFormatInfo1, int maskedFormatInfo2) {[m
[31m-  // Find the int in FORMAT_INFO_DECODE_LOOKUP with fewest bits differing[m
[31m-  int bestDifference = numeric_limits<int>::max();[m
[31m-  int bestFormatInfo = 0;[m
[31m-  for (int i = 0; i < N_FORMAT_INFO_DECODE_LOOKUPS; i++) {[m
[31m-    int* decodeInfo = FORMAT_INFO_DECODE_LOOKUP[i];[m
[31m-    int targetInfo = decodeInfo[0];[m
[31m-    if (targetInfo == maskedFormatInfo1 || targetInfo == maskedFormatInfo2) {[m
[31m-      // Found an exact match[m
[31m-      Ref<FormatInformation> result(new FormatInformation(decodeInfo[1]));[m
[31m-      return result;[m
[31m-    }[m
[31m-    int bitsDifference = numBitsDiffering(maskedFormatInfo1, targetInfo);[m
[31m-    if (bitsDifference < bestDifference) {[m
[31m-      bestFormatInfo = decodeInfo[1];[m
[31m-      bestDifference = bitsDifference;[m
[31m-    }[m
[31m-    if (maskedFormatInfo1 != maskedFormatInfo2) {[m
[31m-        // also try the other option[m
[31m-        bitsDifference = numBitsDiffering(maskedFormatInfo2, targetInfo);[m
[31m-        if (bitsDifference < bestDifference) {[m
[31m-            bestFormatInfo = decodeInfo[1];[m
[31m-          bestDifference = bitsDifference;[m
[31m-        }[m
[31m-      }[m
[31m-  }[m
[31m-  if (bestDifference <= 3) {[m
[31m-    Ref<FormatInformation> result(new FormatInformation(bestFormatInfo));[m
[31m-    return result;[m
[31m-  }[m
[31m-  Ref<FormatInformation> result;[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-bool operator==(const FormatInformation &a, const FormatInformation &b) {[m
[31m-  return &(a.errorCorrectionLevel_) == &(b.errorCorrectionLevel_) && a.dataMask_ == b.dataMask_;[m
[31m-}[m
[31m-[m
[31m-ostream& operator<<(ostream& out, const FormatInformation& fi) {[m
[31m-  const FormatInformation *fip = &fi;[m
[31m-  out << "FormatInformation @ " << fip;[m
[31m-  return out;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/QRCodeReader.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  QRCodeReader.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 20/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/QRCodeReader.h>[m
[31m-// #include <zxing/qrcode/detector/Detector.h>[m
[31m-[m
[31m-// #include <iostream>[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace qrcode {[m
[31m-[m
[31m-		using namespace std;[m
[31m-[m
[31m-		QRCodeReader::QRCodeReader() :decoder_() {[m
[31m-		}[m
[31m-		//TODO: see if any of the other files in the qrcode tree need tryHarder[m
[31m-		Ref<Result> QRCodeReader::decode(Ref<BinaryBitmap> image, DecodeHints hints) {[m
[31m-#ifdef DEBUG[m
[31m-			cout << "decoding image " << image.object_ << ":\n" << flush;[m
[31m-#endif[m
[31m-[m
[31m-			Detector detector(image->getBlackMatrix());[m
[31m-[m
[31m-[m
[31m-#ifdef DEBUG[m
[31m-			cout << "(1) created detector " << &detector << "\n" << flush;[m
[31m-#endif[m
[31m-[m
[31m-			Ref<DetectorResult> detectorResult(detector.detect(hints));[m
[31m-#ifdef DEBUG[m
[31m-			cout << "(2) detected, have detectorResult " << detectorResult.object_ << "\n" << flush;[m
[31m-#endif[m
[31m-[m
[31m-			std::vector<Ref<ResultPoint> > points(detectorResult->getPoints());[m
[31m-[m
[31m-[m
[31m-#ifdef DEBUG[m
[31m-			cout << "(3) extracted points " << &points << "\n" << flush;[m
[31m-			cout << "found " << points.size() << " points:\n";[m
[31m-			for (size_t i = 0; i < points.size(); i++) {[m
[31m-				cout << "   " << points[i]->getX() << "," << points[i]->getY() << "\n";[m
[31m-			}[m
[31m-			cout << "bits:\n";[m
[31m-			cout << *(detectorResult->getBits()) << "\n";[m
[31m-#endif[m
[31m-[m
[31m-			Ref<DecoderResult> decoderResult(decoder_.decode(detectorResult->getBits()));[m
[31m-#ifdef DEBUG[m
[31m-			cout << "(4) decoded, have decoderResult " << decoderResult.object_ << "\n" << flush;[m
[31m-#endif[m
[31m-[m
[31m-			Ref<Result> result([m
[31m-							   new Result(decoderResult->getText(), decoderResult->getRawBytes(), points, BarcodeFormat_QR_CODE));[m
[31m-#ifdef DEBUG[m
[31m-			cout << "(5) created result " << result.object_ << ", returning\n" << flush;[m
[31m-#endif[m
[31m-[m
[31m-			return result;[m
[31m-		}[m
[31m-[m
[31m-		QRCodeReader::~QRCodeReader() {[m
[31m-		}[m
[31m-[m
[31m-    Decoder& QRCodeReader::getDecoder() {[m
[31m-        return decoder_;[m
[31m-    }[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/Version.cpp[m
[31m-[m
[31m-/*[m
[31m- *  Version.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 14/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/Version.h>[m
[31m-// #include <zxing/qrcode/FormatInformation.h>[m
[31m-// #include <limits>[m
[31m-// #include <iostream>[m
[31m-// #include <cstdarg>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-using namespace std;[m
[31m-[m
[31m-ECB::ECB(int count, int dataCodewords) :[m
[31m-    count_(count), dataCodewords_(dataCodewords) {[m
[31m-}[m
[31m-[m
[31m-int ECB::getCount() {[m
[31m-  return count_;[m
[31m-}[m
[31m-[m
[31m-int ECB::getDataCodewords() {[m
[31m-  return dataCodewords_;[m
[31m-}[m
[31m-[m
[31m-ECBlocks::ECBlocks(int ecCodewords, ECB *ecBlocks) :[m
[31m-    ecCodewords_(ecCodewords), ecBlocks_(1, ecBlocks) {[m
[31m-}[m
[31m-[m
[31m-ECBlocks::ECBlocks(int ecCodewords, ECB *ecBlocks1, ECB *ecBlocks2) :[m
[31m-    ecCodewords_(ecCodewords), ecBlocks_(1, ecBlocks1) {[m
[31m-  ecBlocks_.push_back(ecBlocks2);[m
[31m-}[m
[31m-[m
[31m-int ECBlocks::getECCodewords() {[m
[31m-  return ecCodewords_;[m
[31m-}[m
[31m-[m
[31m-std::vector<ECB*>& ECBlocks::getECBlocks() {[m
[31m-  return ecBlocks_;[m
[31m-}[m
[31m-[m
[31m-ECBlocks::~ECBlocks() {[m
[31m-  for (size_t i = 0; i < ecBlocks_.size(); i++) {[m
[31m-    delete ecBlocks_[i];[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-unsigned int Version::VERSION_DECODE_INFO[] = { 0x07C94, 0x085BC, 0x09A99, 0x0A4D3, 0x0BBF6, 0x0C762, 0x0D847, 0x0E60D,[m
[31m-    0x0F928, 0x10B78, 0x1145D, 0x12A17, 0x13532, 0x149A6, 0x15683, 0x168C9, 0x177EC, 0x18EC4, 0x191E1, 0x1AFAB,[m
[31m-    0x1B08E, 0x1CC1A, 0x1D33F, 0x1ED75, 0x1F250, 0x209D5, 0x216F0, 0x228BA, 0x2379F, 0x24B0B, 0x2542E, 0x26A64,[m
[31m-    0x27541, 0x28C69[m
[31m-                                              };[m
[31m-int Version::N_VERSION_DECODE_INFOS = 34;[m
[31m-vector<Ref<Version> > Version::VERSIONS;[m
[31m-static int N_VERSIONS = Version::buildVersions();[m
[31m-[m
[31m-int Version::getVersionNumber() {[m
[31m-  return versionNumber_;[m
[31m-}[m
[31m-[m
[31m-vector<int> &Version::getAlignmentPatternCenters() {[m
[31m-  return alignmentPatternCenters_;[m
[31m-}[m
[31m-[m
[31m-int Version::getTotalCodewords() {[m
[31m-  return totalCodewords_;[m
[31m-}[m
[31m-[m
[31m-int Version::getDimensionForVersion() {[m
[31m-  return 17 + 4 * versionNumber_;[m
[31m-}[m
[31m-[m
[31m-ECBlocks& Version::getECBlocksForLevel(ErrorCorrectionLevel &ecLevel) {[m
[31m-  return *ecBlocks_[ecLevel.ordinal()];[m
[31m-}[m
[31m-[m
[31m-Version *Version::getProvisionalVersionForDimension(int dimension) {[m
[31m-  if (dimension % 4 != 1) {[m
[31m-    throw ReaderException("Dimension must be 1 mod 4");[m
[31m-  }[m
[31m-  return Version::getVersionForNumber((dimension - 17) >> 2);[m
[31m-}[m
[31m-[m
[31m-Version *Version::getVersionForNumber(int versionNumber) {[m
[31m-  if (versionNumber < 1 || versionNumber > N_VERSIONS) {[m
[31m-    throw ReaderException("versionNumber must be between 1 and 40");[m
[31m-  }[m
[31m-[m
[31m-  return VERSIONS[versionNumber - 1];[m
[31m-}[m
[31m-[m
[31m-Version::Version(int versionNumber, vector<int> *alignmentPatternCenters, ECBlocks *ecBlocks1, ECBlocks *ecBlocks2,[m
[31m-                 ECBlocks *ecBlocks3, ECBlocks *ecBlocks4) :[m
[31m-    versionNumber_(versionNumber), alignmentPatternCenters_(*alignmentPatternCenters), ecBlocks_(4), totalCodewords_(0) {[m
[31m-  ecBlocks_[0] = ecBlocks1;[m
[31m-  ecBlocks_[1] = ecBlocks2;[m
[31m-  ecBlocks_[2] = ecBlocks3;[m
[31m-  ecBlocks_[3] = ecBlocks4;[m
[31m-[m
[31m-  int total = 0;[m
[31m-  int ecCodewords = ecBlocks1->getECCodewords();[m
[31m-  vector<ECB*> &ecbArray = ecBlocks1->getECBlocks();[m
[31m-  for (size_t i = 0; i < ecbArray.size(); i++) {[m
[31m-    ECB *ecBlock = ecbArray[i];[m
[31m-    total += ecBlock->getCount() * (ecBlock->getDataCodewords() + ecCodewords);[m
[31m-  }[m
[31m-  totalCodewords_ = total;[m
[31m-}[m
[31m-[m
[31m-Version::~Version() {[m
[31m-  delete &alignmentPatternCenters_;[m
[31m-  for (size_t i = 0; i < ecBlocks_.size(); i++) {[m
[31m-    delete ecBlocks_[i];[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-Version *Version::decodeVersionInformation(unsigned int versionBits) {[m
[31m-  int bestDifference = numeric_limits<int>::max();[m
[31m-  size_t bestVersion = 0;[m
[31m-  for (int i = 0; i < N_VERSION_DECODE_INFOS; i++) {[m
[31m-    unsigned targetVersion = VERSION_DECODE_INFO[i];[m
[31m-    // Do the version info bits match exactly? done.[m
[31m-    if (targetVersion == versionBits) {[m
[31m-      return getVersionForNumber(i + 7);[m
[31m-    }[m
[31m-    // Otherwise see if this is the closest to a real version info bit[m
[31m-    // string we have seen so far[m
[31m-    int bitsDifference = FormatInformation::numBitsDiffering(versionBits, targetVersion);[m
[31m-    if (bitsDifference < bestDifference) {[m
[31m-      bestVersion = i + 7;[m
[31m-      bestDifference = bitsDifference;[m
[31m-    }[m
[31m-  }[m
[31m-  // We can tolerate up to 3 bits of error since no two version info codewords will[m
[31m-  // differ in less than 4 bits.[m
[31m-  if (bestDifference <= 3) {[m
[31m-    return getVersionForNumber(bestVersion);[m
[31m-  }[m
[31m-  // If we didn't find a close enough match, fail[m
[31m-  return 0;[m
[31m-}[m
[31m-[m
[31m-Ref<BitMatrix> Version::buildFunctionPattern() {[m
[31m-  int dimension = getDimensionForVersion();[m
[31m-  Ref<BitMatrix> functionPattern(new BitMatrix(dimension));[m
[31m-[m
[31m-[m
[31m-  // Top left finder pattern + separator + format[m
[31m-  functionPattern->setRegion(0, 0, 9, 9);[m
[31m-  // Top right finder pattern + separator + format[m
[31m-  functionPattern->setRegion(dimension - 8, 0, 8, 9);[m
[31m-  // Bottom left finder pattern + separator + format[m
[31m-  functionPattern->setRegion(0, dimension - 8, 9, 8);[m
[31m-[m
[31m-[m
[31m-  // Alignment patterns[m
[31m-  size_t max = alignmentPatternCenters_.size();[m
[31m-  for (size_t x = 0; x < max; x++) {[m
[31m-    int i = alignmentPatternCenters_[x] - 2;[m
[31m-    for (size_t y = 0; y < max; y++) {[m
[31m-      if ((x == 0 && (y == 0 || y == max - 1)) || (x == max - 1 && y == 0)) {[m
[31m-        // No alignment patterns near the three finder patterns[m
[31m-        continue;[m
[31m-      }[m
[31m-      functionPattern->setRegion(alignmentPatternCenters_[y] - 2, i, 5, 5);[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  // Vertical timing pattern[m
[31m-  functionPattern->setRegion(6, 9, 1, dimension - 17);[m
[31m-  // Horizontal timing pattern[m
[31m-  functionPattern->setRegion(9, 6, dimension - 17, 1);[m
[31m-[m
[31m-  if (versionNumber_ > 6) {[m
[31m-    // Version info, top right[m
[31m-    functionPattern->setRegion(dimension - 11, 0, 3, 6);[m
[31m-    // Version info, bottom left[m
[31m-    functionPattern->setRegion(0, dimension - 11, 6, 3);[m
[31m-  }[m
[31m-[m
[31m-[m
[31m-  //#ifdef DEBUG[m
[31m-  //	cout << "version " << versionNumber_ << " built function pattern:\n";[m
[31m-  //	cout << *functionPattern;[m
[31m-  //#endif[m
[31m-[m
[31m-  return functionPattern;[m
[31m-}[m
[31m-[m
[31m-static vector<int> *intArray(size_t n...) {[m
[31m-  va_list ap;[m
[31m-  va_start(ap, n);[m
[31m-  vector<int> *result = new vector<int>(n);[m
[31m-  for (size_t i = 0; i < n; i++) {[m
[31m-    (*result)[i] = va_arg(ap, int);[m
[31m-  }[m
[31m-  va_end(ap);[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-int Version::buildVersions() {[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(1, intArray(0),[m
[31m-                                  new ECBlocks(7, new ECB(1, 19)),[m
[31m-                                  new ECBlocks(10, new ECB(1, 16)),[m
[31m-                                  new ECBlocks(13, new ECB(1, 13)),[m
[31m-                                  new ECBlocks(17, new ECB(1, 9)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(2, intArray(2, 6, 18),[m
[31m-                                  new ECBlocks(10, new ECB(1, 34)),[m
[31m-                                  new ECBlocks(16, new ECB(1, 28)),[m
[31m-                                  new ECBlocks(22, new ECB(1, 22)),[m
[31m-                                  new ECBlocks(28, new ECB(1, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(3, intArray(2, 6, 22),[m
[31m-                                  new ECBlocks(15, new ECB(1, 55)),[m
[31m-                                  new ECBlocks(26, new ECB(1, 44)),[m
[31m-                                  new ECBlocks(18, new ECB(2, 17)),[m
[31m-                                  new ECBlocks(22, new ECB(2, 13)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(4, intArray(2, 6, 26),[m
[31m-                                  new ECBlocks(20, new ECB(1, 80)),[m
[31m-                                  new ECBlocks(18, new ECB(2, 32)),[m
[31m-                                  new ECBlocks(26, new ECB(2, 24)),[m
[31m-                                  new ECBlocks(16, new ECB(4, 9)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(5, intArray(2, 6, 30),[m
[31m-                                  new ECBlocks(26, new ECB(1, 108)),[m
[31m-                                  new ECBlocks(24, new ECB(2, 43)),[m
[31m-                                  new ECBlocks(18, new ECB(2, 15),[m
[31m-                                               new ECB(2, 16)),[m
[31m-                                  new ECBlocks(22, new ECB(2, 11),[m
[31m-                                               new ECB(2, 12)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(6, intArray(2, 6, 34),[m
[31m-                                  new ECBlocks(18, new ECB(2, 68)),[m
[31m-                                  new ECBlocks(16, new ECB(4, 27)),[m
[31m-                                  new ECBlocks(24, new ECB(4, 19)),[m
[31m-                                  new ECBlocks(28, new ECB(4, 15)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(7, intArray(3, 6, 22, 38),[m
[31m-                                  new ECBlocks(20, new ECB(2, 78)),[m
[31m-                                  new ECBlocks(18, new ECB(4, 31)),[m
[31m-                                  new ECBlocks(18, new ECB(2, 14),[m
[31m-                                               new ECB(4, 15)),[m
[31m-                                  new ECBlocks(26, new ECB(4, 13),[m
[31m-                                               new ECB(1, 14)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(8, intArray(3, 6, 24, 42),[m
[31m-                                  new ECBlocks(24, new ECB(2, 97)),[m
[31m-                                  new ECBlocks(22, new ECB(2, 38),[m
[31m-                                               new ECB(2, 39)),[m
[31m-                                  new ECBlocks(22, new ECB(4, 18),[m
[31m-                                               new ECB(2, 19)),[m
[31m-                                  new ECBlocks(26, new ECB(4, 14),[m
[31m-                                               new ECB(2, 15)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(9, intArray(3, 6, 26, 46),[m
[31m-                                  new ECBlocks(30, new ECB(2, 116)),[m
[31m-                                  new ECBlocks(22, new ECB(3, 36),[m
[31m-                                               new ECB(2, 37)),[m
[31m-                                  new ECBlocks(20, new ECB(4, 16),[m
[31m-                                               new ECB(4, 17)),[m
[31m-                                  new ECBlocks(24, new ECB(4, 12),[m
[31m-                                               new ECB(4, 13)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(10, intArray(3, 6, 28, 50),[m
[31m-                                  new ECBlocks(18, new ECB(2, 68),[m
[31m-                                               new ECB(2, 69)),[m
[31m-                                  new ECBlocks(26, new ECB(4, 43),[m
[31m-                                               new ECB(1, 44)),[m
[31m-                                  new ECBlocks(24, new ECB(6, 19),[m
[31m-                                               new ECB(2, 20)),[m
[31m-                                  new ECBlocks(28, new ECB(6, 15),[m
[31m-                                               new ECB(2, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(11, intArray(3, 6, 30, 54),[m
[31m-                                  new ECBlocks(20, new ECB(4, 81)),[m
[31m-                                  new ECBlocks(30, new ECB(1, 50),[m
[31m-                                               new ECB(4, 51)),[m
[31m-                                  new ECBlocks(28, new ECB(4, 22),[m
[31m-                                               new ECB(4, 23)),[m
[31m-                                  new ECBlocks(24, new ECB(3, 12),[m
[31m-                                               new ECB(8, 13)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(12, intArray(3, 6, 32, 58),[m
[31m-                                  new ECBlocks(24, new ECB(2, 92),[m
[31m-                                               new ECB(2, 93)),[m
[31m-                                  new ECBlocks(22, new ECB(6, 36),[m
[31m-                                               new ECB(2, 37)),[m
[31m-                                  new ECBlocks(26, new ECB(4, 20),[m
[31m-                                               new ECB(6, 21)),[m
[31m-                                  new ECBlocks(28, new ECB(7, 14),[m
[31m-                                               new ECB(4, 15)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(13, intArray(3, 6, 34, 62),[m
[31m-                                  new ECBlocks(26, new ECB(4, 107)),[m
[31m-                                  new ECBlocks(22, new ECB(8, 37),[m
[31m-                                               new ECB(1, 38)),[m
[31m-                                  new ECBlocks(24, new ECB(8, 20),[m
[31m-                                               new ECB(4, 21)),[m
[31m-                                  new ECBlocks(22, new ECB(12, 11),[m
[31m-                                               new ECB(4, 12)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(14, intArray(4, 6, 26, 46, 66),[m
[31m-                                  new ECBlocks(30, new ECB(3, 115),[m
[31m-                                               new ECB(1, 116)),[m
[31m-                                  new ECBlocks(24, new ECB(4, 40),[m
[31m-                                               new ECB(5, 41)),[m
[31m-                                  new ECBlocks(20, new ECB(11, 16),[m
[31m-                                               new ECB(5, 17)),[m
[31m-                                  new ECBlocks(24, new ECB(11, 12),[m
[31m-                                               new ECB(5, 13)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(15, intArray(4, 6, 26, 48, 70),[m
[31m-                                  new ECBlocks(22, new ECB(5, 87),[m
[31m-                                               new ECB(1, 88)),[m
[31m-                                  new ECBlocks(24, new ECB(5, 41),[m
[31m-                                               new ECB(5, 42)),[m
[31m-                                  new ECBlocks(30, new ECB(5, 24),[m
[31m-                                               new ECB(7, 25)),[m
[31m-                                  new ECBlocks(24, new ECB(11, 12),[m
[31m-                                               new ECB(7, 13)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(16, intArray(4, 6, 26, 50, 74),[m
[31m-                                  new ECBlocks(24, new ECB(5, 98),[m
[31m-                                               new ECB(1, 99)),[m
[31m-                                  new ECBlocks(28, new ECB(7, 45),[m
[31m-                                               new ECB(3, 46)),[m
[31m-                                  new ECBlocks(24, new ECB(15, 19),[m
[31m-                                               new ECB(2, 20)),[m
[31m-                                  new ECBlocks(30, new ECB(3, 15),[m
[31m-                                               new ECB(13, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(17, intArray(4, 6, 30, 54, 78),[m
[31m-                                  new ECBlocks(28, new ECB(1, 107),[m
[31m-                                               new ECB(5, 108)),[m
[31m-                                  new ECBlocks(28, new ECB(10, 46),[m
[31m-                                               new ECB(1, 47)),[m
[31m-                                  new ECBlocks(28, new ECB(1, 22),[m
[31m-                                               new ECB(15, 23)),[m
[31m-                                  new ECBlocks(28, new ECB(2, 14),[m
[31m-                                               new ECB(17, 15)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(18, intArray(4, 6, 30, 56, 82),[m
[31m-                                  new ECBlocks(30, new ECB(5, 120),[m
[31m-                                               new ECB(1, 121)),[m
[31m-                                  new ECBlocks(26, new ECB(9, 43),[m
[31m-                                               new ECB(4, 44)),[m
[31m-                                  new ECBlocks(28, new ECB(17, 22),[m
[31m-                                               new ECB(1, 23)),[m
[31m-                                  new ECBlocks(28, new ECB(2, 14),[m
[31m-                                               new ECB(19, 15)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(19, intArray(4, 6, 30, 58, 86),[m
[31m-                                  new ECBlocks(28, new ECB(3, 113),[m
[31m-                                               new ECB(4, 114)),[m
[31m-                                  new ECBlocks(26, new ECB(3, 44),[m
[31m-                                               new ECB(11, 45)),[m
[31m-                                  new ECBlocks(26, new ECB(17, 21),[m
[31m-                                               new ECB(4, 22)),[m
[31m-                                  new ECBlocks(26, new ECB(9, 13),[m
[31m-                                               new ECB(16, 14)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(20, intArray(4, 6, 34, 62, 90),[m
[31m-                                  new ECBlocks(28, new ECB(3, 107),[m
[31m-                                               new ECB(5, 108)),[m
[31m-                                  new ECBlocks(26, new ECB(3, 41),[m
[31m-                                               new ECB(13, 42)),[m
[31m-                                  new ECBlocks(30, new ECB(15, 24),[m
[31m-                                               new ECB(5, 25)),[m
[31m-                                  new ECBlocks(28, new ECB(15, 15),[m
[31m-                                               new ECB(10, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(21, intArray(5, 6, 28, 50, 72, 94),[m
[31m-                                  new ECBlocks(28, new ECB(4, 116),[m
[31m-                                               new ECB(4, 117)),[m
[31m-                                  new ECBlocks(26, new ECB(17, 42)),[m
[31m-                                  new ECBlocks(28, new ECB(17, 22),[m
[31m-                                               new ECB(6, 23)),[m
[31m-                                  new ECBlocks(30, new ECB(19, 16),[m
[31m-                                               new ECB(6, 17)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(22, intArray(5, 6, 26, 50, 74, 98),[m
[31m-                                  new ECBlocks(28, new ECB(2, 111),[m
[31m-                                               new ECB(7, 112)),[m
[31m-                                  new ECBlocks(28, new ECB(17, 46)),[m
[31m-                                  new ECBlocks(30, new ECB(7, 24),[m
[31m-                                               new ECB(16, 25)),[m
[31m-                                  new ECBlocks(24, new ECB(34, 13)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(23, intArray(5, 6, 30, 54, 78, 102),[m
[31m-                                  new ECBlocks(30, new ECB(4, 121),[m
[31m-                                               new ECB(5, 122)),[m
[31m-                                  new ECBlocks(28, new ECB(4, 47),[m
[31m-                                               new ECB(14, 48)),[m
[31m-                                  new ECBlocks(30, new ECB(11, 24),[m
[31m-                                               new ECB(14, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(16, 15),[m
[31m-                                               new ECB(14, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(24, intArray(5, 6, 28, 54, 80, 106),[m
[31m-                                  new ECBlocks(30, new ECB(6, 117),[m
[31m-                                               new ECB(4, 118)),[m
[31m-                                  new ECBlocks(28, new ECB(6, 45),[m
[31m-                                               new ECB(14, 46)),[m
[31m-                                  new ECBlocks(30, new ECB(11, 24),[m
[31m-                                               new ECB(16, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(30, 16),[m
[31m-                                               new ECB(2, 17)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(25, intArray(5, 6, 32, 58, 84, 110),[m
[31m-                                  new ECBlocks(26, new ECB(8, 106),[m
[31m-                                               new ECB(4, 107)),[m
[31m-                                  new ECBlocks(28, new ECB(8, 47),[m
[31m-                                               new ECB(13, 48)),[m
[31m-                                  new ECBlocks(30, new ECB(7, 24),[m
[31m-                                               new ECB(22, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(22, 15),[m
[31m-                                               new ECB(13, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(26, intArray(5, 6, 30, 58, 86, 114),[m
[31m-                                  new ECBlocks(28, new ECB(10, 114),[m
[31m-                                               new ECB(2, 115)),[m
[31m-                                  new ECBlocks(28, new ECB(19, 46),[m
[31m-                                               new ECB(4, 47)),[m
[31m-                                  new ECBlocks(28, new ECB(28, 22),[m
[31m-                                               new ECB(6, 23)),[m
[31m-                                  new ECBlocks(30, new ECB(33, 16),[m
[31m-                                               new ECB(4, 17)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(27, intArray(5, 6, 34, 62, 90, 118),[m
[31m-                                  new ECBlocks(30, new ECB(8, 122),[m
[31m-                                               new ECB(4, 123)),[m
[31m-                                  new ECBlocks(28, new ECB(22, 45),[m
[31m-                                               new ECB(3, 46)),[m
[31m-                                  new ECBlocks(30, new ECB(8, 23),[m
[31m-                                               new ECB(26, 24)),[m
[31m-                                  new ECBlocks(30, new ECB(12, 15),[m
[31m-                                               new ECB(28, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(28, intArray(6, 6, 26, 50, 74, 98, 122),[m
[31m-                                  new ECBlocks(30, new ECB(3, 117),[m
[31m-                                               new ECB(10, 118)),[m
[31m-                                  new ECBlocks(28, new ECB(3, 45),[m
[31m-                                               new ECB(23, 46)),[m
[31m-                                  new ECBlocks(30, new ECB(4, 24),[m
[31m-                                               new ECB(31, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(11, 15),[m
[31m-                                               new ECB(31, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(29, intArray(6, 6, 30, 54, 78, 102, 126),[m
[31m-                                  new ECBlocks(30, new ECB(7, 116),[m
[31m-                                               new ECB(7, 117)),[m
[31m-                                  new ECBlocks(28, new ECB(21, 45),[m
[31m-                                               new ECB(7, 46)),[m
[31m-                                  new ECBlocks(30, new ECB(1, 23),[m
[31m-                                               new ECB(37, 24)),[m
[31m-                                  new ECBlocks(30, new ECB(19, 15),[m
[31m-                                               new ECB(26, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(30, intArray(6, 6, 26, 52, 78, 104, 130),[m
[31m-                                  new ECBlocks(30, new ECB(5, 115),[m
[31m-                                               new ECB(10, 116)),[m
[31m-                                  new ECBlocks(28, new ECB(19, 47),[m
[31m-                                               new ECB(10, 48)),[m
[31m-                                  new ECBlocks(30, new ECB(15, 24),[m
[31m-                                               new ECB(25, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(23, 15),[m
[31m-                                               new ECB(25, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(31, intArray(6, 6, 30, 56, 82, 108, 134),[m
[31m-                                  new ECBlocks(30, new ECB(13, 115),[m
[31m-                                               new ECB(3, 116)),[m
[31m-                                  new ECBlocks(28, new ECB(2, 46),[m
[31m-                                               new ECB(29, 47)),[m
[31m-                                  new ECBlocks(30, new ECB(42, 24),[m
[31m-                                               new ECB(1, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(23, 15),[m
[31m-                                               new ECB(28, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(32, intArray(6, 6, 34, 60, 86, 112, 138),[m
[31m-                                  new ECBlocks(30, new ECB(17, 115)),[m
[31m-                                  new ECBlocks(28, new ECB(10, 46),[m
[31m-                                               new ECB(23, 47)),[m
[31m-                                  new ECBlocks(30, new ECB(10, 24),[m
[31m-                                               new ECB(35, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(19, 15),[m
[31m-                                               new ECB(35, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(33, intArray(6, 6, 30, 58, 86, 114, 142),[m
[31m-                                  new ECBlocks(30, new ECB(17, 115),[m
[31m-                                               new ECB(1, 116)),[m
[31m-                                  new ECBlocks(28, new ECB(14, 46),[m
[31m-                                               new ECB(21, 47)),[m
[31m-                                  new ECBlocks(30, new ECB(29, 24),[m
[31m-                                               new ECB(19, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(11, 15),[m
[31m-                                               new ECB(46, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(34, intArray(6, 6, 34, 62, 90, 118, 146),[m
[31m-                                  new ECBlocks(30, new ECB(13, 115),[m
[31m-                                               new ECB(6, 116)),[m
[31m-                                  new ECBlocks(28, new ECB(14, 46),[m
[31m-                                               new ECB(23, 47)),[m
[31m-                                  new ECBlocks(30, new ECB(44, 24),[m
[31m-                                               new ECB(7, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(59, 16),[m
[31m-                                               new ECB(1, 17)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(35, intArray(7, 6, 30, 54, 78,[m
[31m-                                  102, 126, 150),[m
[31m-                                  new ECBlocks(30, new ECB(12, 121),[m
[31m-                                               new ECB(7, 122)),[m
[31m-                                  new ECBlocks(28, new ECB(12, 47),[m
[31m-                                               new ECB(26, 48)),[m
[31m-                                  new ECBlocks(30, new ECB(39, 24),[m
[31m-                                               new ECB(14, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(22, 15),[m
[31m-                                               new ECB(41, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(36, intArray(7, 6, 24, 50, 76,[m
[31m-                                  102, 128, 154),[m
[31m-                                  new ECBlocks(30, new ECB(6, 121),[m
[31m-                                               new ECB(14, 122)),[m
[31m-                                  new ECBlocks(28, new ECB(6, 47),[m
[31m-                                               new ECB(34, 48)),[m
[31m-                                  new ECBlocks(30, new ECB(46, 24),[m
[31m-                                               new ECB(10, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(2, 15),[m
[31m-                                               new ECB(64, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(37, intArray(7, 6, 28, 54, 80,[m
[31m-                                  106, 132, 158),[m
[31m-                                  new ECBlocks(30, new ECB(17, 122),[m
[31m-                                               new ECB(4, 123)),[m
[31m-                                  new ECBlocks(28, new ECB(29, 46),[m
[31m-                                               new ECB(14, 47)),[m
[31m-                                  new ECBlocks(30, new ECB(49, 24),[m
[31m-                                               new ECB(10, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(24, 15),[m
[31m-                                               new ECB(46, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(38, intArray(7, 6, 32, 58, 84,[m
[31m-                                  110, 136, 162),[m
[31m-                                  new ECBlocks(30, new ECB(4, 122),[m
[31m-                                               new ECB(18, 123)),[m
[31m-                                  new ECBlocks(28, new ECB(13, 46),[m
[31m-                                               new ECB(32, 47)),[m
[31m-                                  new ECBlocks(30, new ECB(48, 24),[m
[31m-                                               new ECB(14, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(42, 15),[m
[31m-                                               new ECB(32, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(39, intArray(7, 6, 26, 54, 82,[m
[31m-                                  110, 138, 166),[m
[31m-                                  new ECBlocks(30, new ECB(20, 117),[m
[31m-                                               new ECB(4, 118)),[m
[31m-                                  new ECBlocks(28, new ECB(40, 47),[m
[31m-                                               new ECB(7, 48)),[m
[31m-                                  new ECBlocks(30, new ECB(43, 24),[m
[31m-                                               new ECB(22, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(10, 15),[m
[31m-                                               new ECB(67, 16)))));[m
[31m-  VERSIONS.push_back(Ref<Version>(new Version(40, intArray(7, 6, 30, 58, 86,[m
[31m-                                  114, 142, 170),[m
[31m-                                  new ECBlocks(30, new ECB(19, 118),[m
[31m-                                               new ECB(6, 119)),[m
[31m-                                  new ECBlocks(28, new ECB(18, 47),[m
[31m-                                               new ECB(31, 48)),[m
[31m-                                  new ECBlocks(30, new ECB(34, 24),[m
[31m-                                               new ECB(34, 25)),[m
[31m-                                  new ECBlocks(30, new ECB(20, 15),[m
[31m-                                               new ECB(61, 16)))));[m
[31m-  return VERSIONS.size();[m
[31m-}[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/decoder/BitMatrixParser.cpp[m
[31m-[m
[31m-/*[m
[31m- *  BitMatrixParser.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 20/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/decoder/BitMatrixParser.h>[m
[31m-// #include <zxing/qrcode/decoder/DataMask.h>[m
[31m-[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-int BitMatrixParser::copyBit(size_t x, size_t y, int versionBits) {[m
[31m-  return bitMatrix_->get(x, y) ? (versionBits << 1) | 0x1 : versionBits << 1;[m
[31m-}[m
[31m-[m
[31m-BitMatrixParser::BitMatrixParser(Ref<BitMatrix> bitMatrix) :[m
[31m-    bitMatrix_(bitMatrix), parsedVersion_(0), parsedFormatInfo_() {[m
[31m-  size_t dimension = bitMatrix->getDimension();[m
[31m-  if ((dimension < 21) || (dimension & 0x03) != 1) {[m
[31m-    throw ReaderException("Dimension must be 1 mod 4 and >= 21");[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-Ref<FormatInformation> BitMatrixParser::readFormatInformation() {[m
[31m-  if (parsedFormatInfo_ != 0) {[m
[31m-    return parsedFormatInfo_;[m
[31m-  }[m
[31m-[m
[31m-  // Read top-left format info bits[m
[31m-  int formatInfoBits1 = 0;[m
[31m-  for (int i = 0; i < 6; i++) {[m
[31m-    formatInfoBits1 = copyBit(i, 8, formatInfoBits1);[m
[31m-  }[m
[31m-  // .. and skip a bit in the timing pattern ...[m
[31m-  formatInfoBits1 = copyBit(7, 8, formatInfoBits1);[m
[31m-  formatInfoBits1 = copyBit(8, 8, formatInfoBits1);[m
[31m-  formatInfoBits1 = copyBit(8, 7, formatInfoBits1);[m
[31m-  // .. and skip a bit in the timing pattern ...[m
[31m-  for (int j = 5; j >= 0; j--) {[m
[31m-    formatInfoBits1 = copyBit(8, j, formatInfoBits1);[m
[31m-  }[m
[31m-[m
[31m-  // Read the top-right/bottom-left pattern[m
[31m-  int dimension = bitMatrix_->getDimension();[m
[31m-  int formatInfoBits2 = 0;[m
[31m-  int jMin = dimension - 7;[m
[31m-  for (int j = dimension - 1; j >= jMin; j--) {[m
[31m-    formatInfoBits2 = copyBit(8, j, formatInfoBits2);[m
[31m-  }[m
[31m-  for (int i = dimension - 8; i < dimension; i++) {[m
[31m-    formatInfoBits2 = copyBit(i, 8, formatInfoBits2);[m
[31m-  }[m
[31m-[m
[31m-  parsedFormatInfo_ = FormatInformation::decodeFormatInformation(formatInfoBits1,formatInfoBits2);[m
[31m-  if (parsedFormatInfo_ != 0) {[m
[31m-    return parsedFormatInfo_;[m
[31m-  }[m
[31m-  throw ReaderException("Could not decode format information");[m
[31m-}[m
[31m-[m
[31m-Version *BitMatrixParser::readVersion() {[m
[31m-  if (parsedVersion_ != 0) {[m
[31m-    return parsedVersion_;[m
[31m-  }[m
[31m-[m
[31m-  int dimension = bitMatrix_->getDimension();[m
[31m-[m
[31m-  int provisionalVersion = (dimension - 17) >> 2;[m
[31m-  if (provisionalVersion <= 6) {[m
[31m-    return Version::getVersionForNumber(provisionalVersion);[m
[31m-  }[m
[31m-[m
[31m-  // Read top-right version info: 3 wide by 6 tall[m
[31m-  int versionBits = 0;[m
[31m-  for (int y = 5; y >= 0; y--) {[m
[31m-    int xMin = dimension - 11;[m
[31m-    for (int x = dimension - 9; x >= xMin; x--) {[m
[31m-      versionBits = copyBit(x, y, versionBits);[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  parsedVersion_ = Version::decodeVersionInformation(versionBits);[m
[31m-  if (parsedVersion_ != 0 && parsedVersion_->getDimensionForVersion() == dimension) {[m
[31m-    return parsedVersion_;[m
[31m-  }[m
[31m-[m
[31m-  // Hmm, failed. Try bottom left: 6 wide by 3 tall[m
[31m-  versionBits = 0;[m
[31m-  for (int x = 5; x >= 0; x--) {[m
[31m-    int yMin = dimension - 11;[m
[31m-    for (int y = dimension - 9; y >= yMin; y--) {[m
[31m-      versionBits = copyBit(x, y, versionBits);[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  parsedVersion_ = Version::decodeVersionInformation(versionBits);[m
[31m-  if (parsedVersion_ != 0 && parsedVersion_->getDimensionForVersion() == dimension) {[m
[31m-    return parsedVersion_;[m
[31m-  }[m
[31m-  throw ReaderException("Could not decode version");[m
[31m-}[m
[31m-[m
[31m-ArrayRef<unsigned char> BitMatrixParser::readCodewords() {[m
[31m-  Ref<FormatInformation> formatInfo = readFormatInformation();[m
[31m-  Version *version = readVersion();[m
[31m-[m
[31m-[m
[31m-  //	cerr << *bitMatrix_ << endl;[m
[31m-  //	cerr << bitMatrix_->getDimension() << endl;[m
[31m-[m
[31m-  // Get the data mask for the format used in this QR Code. This will exclude[m
[31m-  // some bits from reading as we wind through the bit matrix.[m
[31m-  DataMask &dataMask = DataMask::forReference((int)formatInfo->getDataMask());[m
[31m-  //	cout << (int)formatInfo->getDataMask() << endl;[m
[31m-  int dimension = bitMatrix_->getDimension();[m
[31m-  dataMask.unmaskBitMatrix(*bitMatrix_, dimension);[m
[31m-[m
[31m-[m
[31m-  //		cerr << *bitMatrix_ << endl;[m
[31m-  //	cerr << version->getTotalCodewords() << endl;[m
[31m-[m
[31m-  Ref<BitMatrix> functionPattern = version->buildFunctionPattern();[m
[31m-[m
[31m-[m
[31m-  //	cout << *functionPattern << endl;[m
[31m-[m
[31m-  bool readingUp = true;[m
[31m-  ArrayRef<unsigned char> result(version->getTotalCodewords());[m
[31m-  int resultOffset = 0;[m
[31m-  int currentByte = 0;[m
[31m-  int bitsRead = 0;[m
[31m-  // Read columns in pairs, from right to left[m
[31m-  for (int x = dimension - 1; x > 0; x -= 2) {[m
[31m-    if (x == 6) {[m
[31m-      // Skip whole column with vertical alignment pattern;[m
[31m-      // saves time and makes the other code proceed more cleanly[m
[31m-      x--;[m
[31m-    }[m
[31m-    // Read alternatingly from bottom to top then top to bottom[m
[31m-    for (int counter = 0; counter < dimension; counter++) {[m
[31m-      int y = readingUp ? dimension - 1 - counter : counter;[m
[31m-      for (int col = 0; col < 2; col++) {[m
[31m-        // Ignore bits covered by the function pattern[m
[31m-        if (!functionPattern->get(x - col, y)) {[m
[31m-          // Read a bit[m
[31m-          bitsRead++;[m
[31m-          currentByte <<= 1;[m
[31m-          if (bitMatrix_->get(x - col, y)) {[m
[31m-            currentByte |= 1;[m
[31m-          }[m
[31m-          // If we've made a whole byte, save it off[m
[31m-          if (bitsRead == 8) {[m
[31m-            result[resultOffset++] = (unsigned char)currentByte;[m
[31m-            bitsRead = 0;[m
[31m-            currentByte = 0;[m
[31m-          }[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-    readingUp = !readingUp; // switch directions[m
[31m-  }[m
[31m-[m
[31m-  if (resultOffset != version->getTotalCodewords()) {[m
[31m-    throw ReaderException("Did not read all codewords");[m
[31m-  }[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/decoder/DataBlock.cpp[m
[31m-[m
[31m-/*[m
[31m- *  DataBlock.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 19/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/decoder/DataBlock.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-DataBlock::DataBlock(int numDataCodewords, ArrayRef<unsigned char> codewords) :[m
[31m-    numDataCodewords_(numDataCodewords), codewords_(codewords) {[m
[31m-}[m
[31m-[m
[31m-int DataBlock::getNumDataCodewords() {[m
[31m-  return numDataCodewords_;[m
[31m-}[m
[31m-[m
[31m-ArrayRef<unsigned char> DataBlock::getCodewords() {[m
[31m-  return codewords_;[m
[31m-}[m
[31m-[m
[31m-[m
[31m-std::vector<Ref<DataBlock> > DataBlock::getDataBlocks(ArrayRef<unsigned char> rawCodewords, Version *version,[m
[31m-    ErrorCorrectionLevel &ecLevel) {[m
[31m-[m
[31m-[m
[31m-  // Figure out the number and size of data blocks used by this version and[m
[31m-  // error correction level[m
[31m-  ECBlocks &ecBlocks = version->getECBlocksForLevel(ecLevel);[m
[31m-[m
[31m-[m
[31m-  // First count the total number of data blocks[m
[31m-  int totalBlocks = 0;[m
[31m-  vector<ECB*> ecBlockArray = ecBlocks.getECBlocks();[m
[31m-  for (size_t i = 0; i < ecBlockArray.size(); i++) {[m
[31m-    totalBlocks += ecBlockArray[i]->getCount();[m
[31m-  }[m
[31m-[m
[31m-  // Now establish DataBlocks of the appropriate size and number of data codewords[m
[31m-  std::vector<Ref<DataBlock> > result(totalBlocks);[m
[31m-  int numResultBlocks = 0;[m
[31m-  for (size_t j = 0; j < ecBlockArray.size(); j++) {[m
[31m-    ECB *ecBlock = ecBlockArray[j];[m
[31m-    for (int i = 0; i < ecBlock->getCount(); i++) {[m
[31m-      int numDataCodewords = ecBlock->getDataCodewords();[m
[31m-      int numBlockCodewords = ecBlocks.getECCodewords() + numDataCodewords;[m
[31m-      ArrayRef<unsigned char> buffer(numBlockCodewords);[m
[31m-      Ref<DataBlock> blockRef(new DataBlock(numDataCodewords, buffer));[m
[31m-      result[numResultBlocks++] = blockRef;[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  // All blocks have the same amount of data, except that the last n[m
[31m-  // (where n may be 0) have 1 more byte. Figure out where these start.[m
[31m-  int shorterBlocksTotalCodewords = result[0]->codewords_.size();[m
[31m-  int longerBlocksStartAt = result.size() - 1;[m
[31m-  while (longerBlocksStartAt >= 0) {[m
[31m-    int numCodewords = result[longerBlocksStartAt]->codewords_.size();[m
[31m-    if (numCodewords == shorterBlocksTotalCodewords) {[m
[31m-      break;[m
[31m-    }[m
[31m-    if (numCodewords != shorterBlocksTotalCodewords + 1) {[m
[31m-      throw IllegalArgumentException("Data block sizes differ by more than 1");[m
[31m-    }[m
[31m-    longerBlocksStartAt--;[m
[31m-  }[m
[31m-  longerBlocksStartAt++;[m
[31m-[m
[31m-  int shorterBlocksNumDataCodewords = shorterBlocksTotalCodewords - ecBlocks.getECCodewords();[m
[31m-  // The last elements of result may be 1 element longer;[m
[31m-  // first fill out as many elements as all of them have[m
[31m-  int rawCodewordsOffset = 0;[m
[31m-  for (int i = 0; i < shorterBlocksNumDataCodewords; i++) {[m
[31m-    for (int j = 0; j < numResultBlocks; j++) {[m
[31m-      result[j]->codewords_[i] = rawCodewords[rawCodewordsOffset++];[m
[31m-    }[m
[31m-  }[m
[31m-  // Fill out the last data block in the longer ones[m
[31m-  for (int j = longerBlocksStartAt; j < numResultBlocks; j++) {[m
[31m-    result[j]->codewords_[shorterBlocksNumDataCodewords] = rawCodewords[rawCodewordsOffset++];[m
[31m-  }[m
[31m-  // Now add in error correction blocks[m
[31m-  int max = result[0]->codewords_.size();[m
[31m-  for (int i = shorterBlocksNumDataCodewords; i < max; i++) {[m
[31m-    for (int j = 0; j < numResultBlocks; j++) {[m
[31m-      int iOffset = j < longerBlocksStartAt ? i : i + 1;[m
[31m-      result[j]->codewords_[iOffset] = rawCodewords[rawCodewordsOffset++];[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  if ((size_t)rawCodewordsOffset != rawCodewords.size()) {[m
[31m-    throw IllegalArgumentException("rawCodewordsOffset != rawCodewords.length");[m
[31m-  }[m
[31m-[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/decoder/DataMask.cpp[m
[31m-[m
[31m-/*[m
[31m- *  DataMask.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 19/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/decoder/DataMask.h>[m
[31m-[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-DataMask::DataMask() {[m
[31m-}[m
[31m-[m
[31m-DataMask::~DataMask() {[m
[31m-}[m
[31m-[m
[31m-vector<Ref<DataMask> > DataMask::DATA_MASKS;[m
[31m-static int N_DATA_MASKS = DataMask::buildDataMasks();[m
[31m-[m
[31m-DataMask &DataMask::forReference(int reference) {[m
[31m-  if (reference < 0 || reference > 7) {[m
[31m-    throw IllegalArgumentException("reference must be between 0 and 7");[m
[31m-  }[m
[31m-  return *DATA_MASKS[reference];[m
[31m-}[m
[31m-[m
[31m-void DataMask::unmaskBitMatrix(BitMatrix& bits, size_t dimension) {[m
[31m-  for (size_t y = 0; y < dimension; y++) {[m
[31m-    for (size_t x = 0; x < dimension; x++) {[m
[31m-      // TODO: check why the coordinates have to be swapped[m
[31m-      if (isMasked(y, x)) {[m
[31m-        bits.flip(x, y);[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-/**[m
[31m- * 000: mask bits for which (x + y) mod 2 == 0[m
[31m- */[m
[31m-class DataMask000 : public DataMask {[m
[31m-public:[m
[31m-  bool isMasked(size_t x, size_t y) {[m
[31m-    //		return ((x + y) & 0x01) == 0;[m
[31m-    return ((x + y) % 2) == 0;[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-/**[m
[31m- * 001: mask bits for which x mod 2 == 0[m
[31m- */[m
[31m-class DataMask001 : public DataMask {[m
[31m-public:[m
[31m-  bool isMasked(size_t x, size_t) {[m
[31m-    //		return (x & 0x01) == 0;[m
[31m-    return (x % 2) == 0;[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-/**[m
[31m- * 010: mask bits for which y mod 3 == 0[m
[31m- */[m
[31m-class DataMask010 : public DataMask {[m
[31m-public:[m
[31m-  bool isMasked(size_t, size_t y) {[m
[31m-    return y % 3 == 0;[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-/**[m
[31m- * 011: mask bits for which (x + y) mod 3 == 0[m
[31m- */[m
[31m-class DataMask011 : public DataMask {[m
[31m-public:[m
[31m-  bool isMasked(size_t x, size_t y) {[m
[31m-    return (x + y) % 3 == 0;[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-/**[m
[31m- * 100: mask bits for which (x/2 + y/3) mod 2 == 0[m
[31m- */[m
[31m-class DataMask100 : public DataMask {[m
[31m-public:[m
[31m-  bool isMasked(size_t x, size_t y) {[m
[31m-    //		return (((x >> 1) + (y / 3)) & 0x01) == 0;[m
[31m-    return (((x >> 1) + (y / 3)) % 2) == 0;[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-/**[m
[31m- * 101: mask bits for which xy mod 2 + xy mod 3 == 0[m
[31m- */[m
[31m-class DataMask101 : public DataMask {[m
[31m-public:[m
[31m-  bool isMasked(size_t x, size_t y) {[m
[31m-    size_t temp = x * y;[m
[31m-    //		return (temp & 0x01) + (temp % 3) == 0;[m
[31m-    return (temp % 2) + (temp % 3) == 0;[m
[31m-[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-/**[m
[31m- * 110: mask bits for which (xy mod 2 + xy mod 3) mod 2 == 0[m
[31m- */[m
[31m-class DataMask110 : public DataMask {[m
[31m-public:[m
[31m-  bool isMasked(size_t x, size_t y) {[m
[31m-    size_t temp = x * y;[m
[31m-    //		return (((temp & 0x01) + (temp % 3)) & 0x01) == 0;[m
[31m-    return (((temp % 2) + (temp % 3)) % 2) == 0;[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-/**[m
[31m- * 111: mask bits for which ((x+y)mod 2 + xy mod 3) mod 2 == 0[m
[31m- */[m
[31m-class DataMask111 : public DataMask {[m
[31m-public:[m
[31m-  bool isMasked(size_t x, size_t y) {[m
[31m-    //		return ((((x + y) & 0x01) + ((x * y) % 3)) & 0x01) == 0;[m
[31m-    return ((((x + y) % 2) + ((x * y) % 3)) % 2) == 0;[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-int DataMask::buildDataMasks() {[m
[31m-  DATA_MASKS.push_back(Ref<DataMask> (new DataMask000()));[m
[31m-  DATA_MASKS.push_back(Ref<DataMask> (new DataMask001()));[m
[31m-  DATA_MASKS.push_back(Ref<DataMask> (new DataMask010()));[m
[31m-  DATA_MASKS.push_back(Ref<DataMask> (new DataMask011()));[m
[31m-  DATA_MASKS.push_back(Ref<DataMask> (new DataMask100()));[m
[31m-  DATA_MASKS.push_back(Ref<DataMask> (new DataMask101()));[m
[31m-  DATA_MASKS.push_back(Ref<DataMask> (new DataMask110()));[m
[31m-  DATA_MASKS.push_back(Ref<DataMask> (new DataMask111()));[m
[31m-  return DATA_MASKS.size();[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/decoder/DecodedBitStreamParser.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  DecodedBitStreamParser.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 20/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/decoder/DecodedBitStreamParser.h>[m
[31m-// #include <zxing/common/CharacterSetECI.h>[m
[31m-// #include <zxing/FormatException.h>[m
[31m-// #include <zxing/common/StringUtils.h>[m
[31m-// #include <iostream>[m
[31m-#ifndef NO_ICONV[m
[31m-// #include <iconv.h>[m
[31m-#endif[m
[31m-[m
[31m-// Required for compatibility. TODO: test on Symbian[m
[31m-#ifdef ZXING_ICONV_CONST[m
[31m-#undef ICONV_CONST[m
[31m-#define ICONV_CONST const[m
[31m-#endif[m
[31m-[m
[31m-#ifndef ICONV_CONST[m
[31m-#define ICONV_CONST /**/[m
[31m-#endif[m
[31m-[m
[31m-using namespace std;[m
[31m-using namespace zxing;[m
[31m-using namespace zxing::qrcode;[m
[31m-using namespace zxing::common;[m
[31m-[m
[31m-const char DecodedBitStreamParser::ALPHANUMERIC_CHARS[] =[m
[31m-{ '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B',[m
[31m-  'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N',[m
[31m-  'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',[m
[31m-  'Y', 'Z', ' ', '$', '%', '*', '+', '-', '.', '/', ':'[m
[31m-};[m
[31m-[m
[31m-namespace {int GB2312_SUBSET = 1;}[m
[31m-[m
[31m-void DecodedBitStreamParser::append(std::string &result,[m
[31m-                                    string const& in,[m
[31m-                                    const char *src) {[m
[31m-  append(result, (unsigned char const*)in.c_str(), in.length(), src);[m
[31m-}[m
[31m-[m
[31m-void DecodedBitStreamParser::append(std::string &result,[m
[31m-                                    const unsigned char *bufIn,[m
[31m-                                    size_t nIn,[m
[31m-                                    const char *src) {[m
[31m-#ifndef NO_ICONV[m
[31m-  if (nIn == 0) {[m
[31m-    return;[m
[31m-  }[m
[31m-[m
[31m-  iconv_t cd = iconv_open(StringUtils::UTF8, src);[m
[31m-  if (cd == (iconv_t)-1) {[m
[31m-    result.append((const char *)bufIn, nIn);[m
[31m-    return;[m
[31m-  }[m
[31m-[m
[31m-  const int maxOut = 4 * nIn + 1;[m
[31m-  unsigned char* bufOut = new unsigned char[maxOut];[m
[31m-[m
[31m-  ICONV_CONST char *fromPtr = (ICONV_CONST char *)bufIn;[m
[31m-  size_t nFrom = nIn;[m
[31m-  char *toPtr = (char *)bufOut;[m
[31m-  size_t nTo = maxOut;[m
[31m-[m
[31m-  while (nFrom > 0) {[m
[31m-    size_t oneway = iconv(cd, &fromPtr, &nFrom, &toPtr, &nTo);[m
[31m-    if (oneway == (size_t)(-1)) {[m
[31m-      iconv_close(cd);[m
[31m-      delete[] bufOut;[m
[31m-      throw ReaderException("error converting characters");[m
[31m-    }[m
[31m-  }[m
[31m-  iconv_close(cd);[m
[31m-[m
[31m-  int nResult = maxOut - nTo;[m
[31m-  bufOut[nResult] = '\0';[m
[31m-  result.append((const char *)bufOut);[m
[31m-  delete[] bufOut;[m
[31m-#else[m
[31m-  result.append((const char *)bufIn, nIn);[m
[31m-#endif[m
[31m-}[m
[31m-[m
[31m-void DecodedBitStreamParser::decodeHanziSegment(Ref<BitSource> bits_,[m
[31m-                                                string& result,[m
[31m-                                                int count) {[m
[31m-    BitSource& bits (*bits_);[m
[31m-    // Don't crash trying to read more bits than we have available.[m
[31m-    if (count * 13 > bits.available()) {[m
[31m-      throw FormatException();[m
[31m-    }[m
[31m-[m
[31m-    // Each character will require 2 bytes. Read the characters as 2-byte pairs[m
[31m-    // and decode as GB2312 afterwards[m
[31m-    size_t nBytes = 2 * count;[m
[31m-    unsigned char* buffer = new unsigned char[nBytes];[m
[31m-    int offset = 0;[m
[31m-    while (count > 0) {[m
[31m-      // Each 13 bits encodes a 2-byte character[m
[31m-      int twoBytes = bits.readBits(13);[m
[31m-      int assembledTwoBytes = ((twoBytes / 0x060) << 8) | (twoBytes % 0x060);[m
[31m-      if (assembledTwoBytes < 0x003BF) {[m
[31m-        // In the 0xA1A1 to 0xAAFE range[m
[31m-        assembledTwoBytes += 0x0A1A1;[m
[31m-      } else {[m
[31m-        // In the 0xB0A1 to 0xFAFE range[m
[31m-        assembledTwoBytes += 0x0A6A1;[m
[31m-      }[m
[31m-      buffer[offset] = (unsigned char) ((assembledTwoBytes >> 8) & 0xFF);[m
[31m-      buffer[offset + 1] = (unsigned char) (assembledTwoBytes & 0xFF);[m
[31m-      offset += 2;[m
[31m-      count--;[m
[31m-    }[m
[31m-[m
[31m-    try {[m
[31m-      append(result, buffer, nBytes, StringUtils::GB2312);[m
[31m-    } catch (ReaderException const& re) {[m
[31m-      delete [] buffer;[m
[31m-      throw FormatException();[m
[31m-    }[m
[31m-[m
[31m-    delete [] buffer;[m
[31m-  }[m
[31m-[m
[31m-void DecodedBitStreamParser::decodeKanjiSegment(Ref<BitSource> bits, std::string &result, int count) {[m
[31m-  // Each character will require 2 bytes. Read the characters as 2-byte pairs[m
[31m-  // and decode as Shift_JIS afterwards[m
[31m-  size_t nBytes = 2 * count;[m
[31m-  unsigned char* buffer = new unsigned char[nBytes];[m
[31m-  int offset = 0;[m
[31m-  while (count > 0) {[m
[31m-    // Each 13 bits encodes a 2-byte character[m
[31m-[m
[31m-    int twoBytes = bits->readBits(13);[m
[31m-    int assembledTwoBytes = ((twoBytes / 0x0C0) << 8) | (twoBytes % 0x0C0);[m
[31m-    if (assembledTwoBytes < 0x01F00) {[m
[31m-      // In the 0x8140 to 0x9FFC range[m
[31m-      assembledTwoBytes += 0x08140;[m
[31m-    } else {[m
[31m-      // In the 0xE040 to 0xEBBF range[m
[31m-      assembledTwoBytes += 0x0C140;[m
[31m-    }[m
[31m-    buffer[offset] = (unsigned char)(assembledTwoBytes >> 8);[m
[31m-    buffer[offset + 1] = (unsigned char)assembledTwoBytes;[m
[31m-    offset += 2;[m
[31m-    count--;[m
[31m-  }[m
[31m-[m
[31m-  append(result, buffer, nBytes, StringUtils::SHIFT_JIS);[m
[31m-  delete[] buffer;[m
[31m-}[m
[31m-[m
[31m-void DecodedBitStreamParser::decodeByteSegment(Ref<BitSource> bits_,[m
[31m-                                               string& result,[m
[31m-                                               int count,[m
[31m-                                               CharacterSetECI* currentCharacterSetECI,[m
[31m-                                               ArrayRef< ArrayRef<unsigned char> >& byteSegments,[m
[31m-                                               Hashtable const& hints) {[m
[31m-  int nBytes = count;[m
[31m-  BitSource& bits (*bits_);[m
[31m-  // Don't crash trying to read more bits than we have available.[m
[31m-  if (count << 3 > bits.available()) {[m
[31m-    throw FormatException();[m
[31m-  }[m
[31m-[m
[31m-  ArrayRef<unsigned char> bytes_ (count);[m
[31m-  unsigned char* readBytes = &(*bytes_)[0];[m
[31m-  for (int i = 0; i < count; i++) {[m
[31m-    readBytes[i] = (unsigned char) bits.readBits(8);[m
[31m-  }[m
[31m-  string encoding;[m
[31m-  if (currentCharacterSetECI == 0) {[m
[31m-    // The spec isn't clear on this mode; see[m
[31m-    // section 6.4.5: t does not say which encoding to assuming[m
[31m-    // upon decoding. I have seen ISO-8859-1 used as well as[m
[31m-    // Shift_JIS -- without anything like an ECI designator to[m
[31m-    // give a hint.[m
[31m-    encoding = StringUtils::guessEncoding(readBytes, count, hints);[m
[31m-  } else {[m
[31m-    encoding = currentCharacterSetECI->getEncodingName();[m
[31m-  }[m
[31m-  try {[m
[31m-    append(result, readBytes, nBytes, encoding.c_str());[m
[31m-  } catch (ReaderException const& re) {[m
[31m-    throw FormatException();[m
[31m-  }[m
[31m-  byteSegments->values().push_back(bytes_);[m
[31m-}[m
[31m-[m
[31m-void DecodedBitStreamParser::decodeNumericSegment(Ref<BitSource> bits, std::string &result, int count) {[m
[31m-  int nBytes = count;[m
[31m-  unsigned char* bytes = new unsigned char[nBytes];[m
[31m-  int i = 0;[m
[31m-  // Read three digits at a time[m
[31m-  while (count >= 3) {[m
[31m-    // Each 10 bits encodes three digits[m
[31m-    if (bits->available() < 10) {[m
[31m-      throw ReaderException("format exception");[m
[31m-    }[m
[31m-    int threeDigitsBits = bits->readBits(10);[m
[31m-    if (threeDigitsBits >= 1000) {[m
[31m-      ostringstream s;[m
[31m-      s << "Illegal value for 3-digit unit: " << threeDigitsBits;[m
[31m-      delete[] bytes;[m
[31m-      throw ReaderException(s.str().c_str());[m
[31m-    }[m
[31m-    bytes[i++] = ALPHANUMERIC_CHARS[threeDigitsBits / 100];[m
[31m-    bytes[i++] = ALPHANUMERIC_CHARS[(threeDigitsBits / 10) % 10];[m
[31m-    bytes[i++] = ALPHANUMERIC_CHARS[threeDigitsBits % 10];[m
[31m-    count -= 3;[m
[31m-  }[m
[31m-  if (count == 2) {[m
[31m-    if (bits->available() < 7) {[m
[31m-      throw ReaderException("format exception");[m
[31m-    }[m
[31m-    // Two digits left over to read, encoded in 7 bits[m
[31m-    int twoDigitsBits = bits->readBits(7);[m
[31m-    if (twoDigitsBits >= 100) {[m
[31m-      ostringstream s;[m
[31m-      s << "Illegal value for 2-digit unit: " << twoDigitsBits;[m
[31m-      delete[] bytes;[m
[31m-      throw ReaderException(s.str().c_str());[m
[31m-    }[m
[31m-    bytes[i++] = ALPHANUMERIC_CHARS[twoDigitsBits / 10];[m
[31m-    bytes[i++] = ALPHANUMERIC_CHARS[twoDigitsBits % 10];[m
[31m-  } else if (count == 1) {[m
[31m-    if (bits->available() < 4) {[m
[31m-      throw ReaderException("format exception");[m
[31m-    }[m
[31m-    // One digit left over to read[m
[31m-    int digitBits = bits->readBits(4);[m
[31m-    if (digitBits >= 10) {[m
[31m-      ostringstream s;[m
[31m-      s << "Illegal value for digit unit: " << digitBits;[m
[31m-      delete[] bytes;[m
[31m-      throw ReaderException(s.str().c_str());[m
[31m-    }[m
[31m-    bytes[i++] = ALPHANUMERIC_CHARS[digitBits];[m
[31m-  }[m
[31m-  append(result, bytes, nBytes, StringUtils::ASCII);[m
[31m-  delete[] bytes;[m
[31m-}[m
[31m-[m
[31m-char DecodedBitStreamParser::toAlphaNumericChar(size_t value) {[m
[31m-  if (value >= sizeof(DecodedBitStreamParser::ALPHANUMERIC_CHARS)) {[m
[31m-    throw FormatException();[m
[31m-  }[m
[31m-  return ALPHANUMERIC_CHARS[value];[m
[31m-}[m
[31m-[m
[31m-void DecodedBitStreamParser::decodeAlphanumericSegment(Ref<BitSource> bits_,[m
[31m-                                                       string& result,[m
[31m-                                                       int count,[m
[31m-                                                       bool fc1InEffect) {[m
[31m-  BitSource& bits (*bits_);[m
[31m-  ostringstream bytes;[m
[31m-  // Read two characters at a time[m
[31m-  while (count > 1) {[m
[31m-    int nextTwoCharsBits = bits.readBits(11);[m
[31m-    bytes << toAlphaNumericChar(nextTwoCharsBits / 45);[m
[31m-    bytes << toAlphaNumericChar(nextTwoCharsBits % 45);[m
[31m-    count -= 2;[m
[31m-  }[m
[31m-  if (count == 1) {[m
[31m-    // special case: one character left[m
[31m-    bytes << toAlphaNumericChar(bits.readBits(6));[m
[31m-  }[m
[31m-  // See section 6.4.8.1, 6.4.8.2[m
[31m-  string s = bytes.str();[m
[31m-  if (fc1InEffect) {[m
[31m-    // We need to massage the result a bit if in an FNC1 mode:[m
[31m-    ostringstream r;[m
[31m-    for (size_t i = 0; i < s.length(); i++) {[m
[31m-      if (s[i] != '%') {[m
[31m-        r << s[i];[m
[31m-      } else {[m
[31m-        if (i < s.length() - 1 && s[i + 1] == '%') {[m
[31m-          // %% is rendered as %[m
[31m-          r << s[i++];[m
[31m-        } else {[m
[31m-          // In alpha mode, % should be converted to FNC1 separator 0x1D[m
[31m-          r << (char)0x1D;[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-    s = r.str();[m
[31m-  }[m
[31m-  append(result, s, StringUtils::ASCII);[m
[31m-}[m
[31m-[m
[31m-namespace {[m
[31m-  int parseECIValue(BitSource bits) {[m
[31m-    int firstByte = bits.readBits(8);[m
[31m-    if ((firstByte & 0x80) == 0) {[m
[31m-      // just one byte[m
[31m-      return firstByte & 0x7F;[m
[31m-    }[m
[31m-    if ((firstByte & 0xC0) == 0x80) {[m
[31m-      // two bytes[m
[31m-      int secondByte = bits.readBits(8);[m
[31m-      return ((firstByte & 0x3F) << 8) | secondByte;[m
[31m-    }[m
[31m-    if ((firstByte & 0xE0) == 0xC0) {[m
[31m-      // three bytes[m
[31m-      int secondThirdBytes = bits.readBits(16);[m
[31m-      return ((firstByte & 0x1F) << 16) | secondThirdBytes;[m
[31m-    }[m
[31m-    throw IllegalArgumentException("Bad ECI bits starting with byte ");[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-Ref<DecoderResult>[m
[31m-DecodedBitStreamParser::decode(ArrayRef<unsigned char> bytes,[m
[31m-                               Version* version,[m
[31m-                               ErrorCorrectionLevel const& ecLevel,[m
[31m-                               Hashtable const& hints) {[m
[31m-  Ref<BitSource> bits_ (new BitSource(bytes));[m
[31m-  BitSource& bits (*bits_);[m
[31m-  string result;[m
[31m-  CharacterSetECI* currentCharacterSetECI = 0;[m
[31m-  bool fc1InEffect = false;[m
[31m-  ArrayRef< ArrayRef<unsigned char> > byteSegments (size_t(0));[m
[31m-  Mode* mode = 0;[m
[31m-  do {[m
[31m-    // While still another segment to read...[m
[31m-    if (bits.available() < 4) {[m
[31m-      // OK, assume we're done. Really, a TERMINATOR mode should have been recorded here[m
[31m-      mode = &Mode::TERMINATOR;[m
[31m-    } else {[m
[31m-      try {[m
[31m-        mode = &Mode::forBits(bits.readBits(4)); // mode is encoded by 4 bits[m
[31m-      } catch (IllegalArgumentException const& iae) {[m
[31m-        throw iae;[m
[31m-        // throw FormatException.getFormatInstance();[m
[31m-      }[m
[31m-    }[m
[31m-    if (mode != &Mode::TERMINATOR) {[m
[31m-      if ((mode == &Mode::FNC1_FIRST_POSITION) || (mode == &Mode::FNC1_SECOND_POSITION)) {[m
[31m-        // We do little with FNC1 except alter the parsed result a bit according to the spec[m
[31m-        fc1InEffect = true;[m
[31m-      } else if (mode == &Mode::STRUCTURED_APPEND) {[m
[31m-        // not really supported; all we do is ignore it[m
[31m-        // Read next 8 bits (symbol sequence #) and 8 bits (parity data), then continue[m
[31m-        bits.readBits(16);[m
[31m-      } else if (mode == &Mode::ECI) {[m
[31m-        // Count doesn't apply to ECI[m
[31m-        int value = parseECIValue(bits);[m
[31m-        currentCharacterSetECI = CharacterSetECI::getCharacterSetECIByValue(value);[m
[31m-        if (currentCharacterSetECI == 0) {[m
[31m-          throw FormatException();[m
[31m-        }[m
[31m-      } else {[m
[31m-        // First handle Hanzi mode which does not start with character count[m
[31m-        if (mode == &Mode::HANZI) {[m
[31m-          //chinese mode contains a sub set indicator right after mode indicator[m
[31m-          int subset = bits.readBits(4);[m
[31m-          int countHanzi = bits.readBits(mode->getCharacterCountBits(version));[m
[31m-          if (subset == GB2312_SUBSET) {[m
[31m-            decodeHanziSegment(bits_, result, countHanzi);[m
[31m-          }[m
[31m-        } else {[m
[31m-          // "Normal" QR code modes:[m
[31m-          // How many characters will follow, encoded in this mode?[m
[31m-          int count = bits.readBits(mode->getCharacterCountBits(version));[m
[31m-          if (mode == &Mode::NUMERIC) {[m
[31m-            decodeNumericSegment(bits_, result, count);[m
[31m-          } else if (mode == &Mode::ALPHANUMERIC) {[m
[31m-            decodeAlphanumericSegment(bits_, result, count, fc1InEffect);[m
[31m-          } else if (mode == &Mode::BYTE) {[m
[31m-            decodeByteSegment(bits_, result, count, currentCharacterSetECI, byteSegments, hints);[m
[31m-          } else if (mode == &Mode::KANJI) {[m
[31m-            decodeKanjiSegment(bits_, result, count);[m
[31m-          } else {[m
[31m-            throw FormatException();[m
[31m-          }[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-  } while (mode != &Mode::TERMINATOR);[m
[31m-[m
[31m-  return Ref<DecoderResult>(new DecoderResult(bytes, Ref<String>(new String(result)), byteSegments, (string)ecLevel));[m
[31m-}[m
[31m-[m
[31m-[m
[31m-// file: zxing/qrcode/decoder/Decoder.cpp[m
[31m-[m
[31m-/*[m
[31m- *  Decoder.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 20/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/decoder/Decoder.h>[m
[31m-// #include <zxing/qrcode/decoder/BitMatrixParser.h>[m
[31m-// #include <zxing/qrcode/ErrorCorrectionLevel.h>[m
[31m-// #include <zxing/qrcode/Version.h>[m
[31m-// #include <zxing/qrcode/decoder/DataBlock.h>[m
[31m-// #include <zxing/qrcode/decoder/DecodedBitStreamParser.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/common/reedsolomon/ReedSolomonException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-Decoder::Decoder() :[m
[31m-    rsDecoder_(GF256::QR_CODE_FIELD) {[m
[31m-}[m
[31m-[m
[31m-void Decoder::correctErrors(ArrayRef<unsigned char> codewordBytes, int numDataCodewords) {[m
[31m-  int numCodewords = codewordBytes->size();[m
[31m-  ArrayRef<int> codewordInts(numCodewords);[m
[31m-  for (int i = 0; i < numCodewords; i++) {[m
[31m-    codewordInts[i] = codewordBytes[i] & 0xff;[m
[31m-  }[m
[31m-  int numECCodewords = numCodewords - numDataCodewords;[m
[31m-[m
[31m-  try {[m
[31m-    rsDecoder_.decode(codewordInts, numECCodewords);[m
[31m-  } catch (ReedSolomonException const& ex) {[m
[31m-    ReaderException rex(ex.what());[m
[31m-    throw rex;[m
[31m-  }[m
[31m-[m
[31m-  for (int i = 0; i < numDataCodewords; i++) {[m
[31m-    codewordBytes[i] = (unsigned char)codewordInts[i];[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-Ref<DecoderResult> Decoder::decode(Ref<BitMatrix> bits) {[m
[31m-  // Construct a parser and read version, error-correction level[m
[31m-  BitMatrixParser parser(bits);[m
[31m-[m
[31m-  Version *version = parser.readVersion();[m
[31m-  ErrorCorrectionLevel &ecLevel = parser.readFormatInformation()->getErrorCorrectionLevel();[m
[31m-[m
[31m-[m
[31m-  // Read codewords[m
[31m-  ArrayRef<unsigned char> codewords(parser.readCodewords());[m
[31m-[m
[31m-[m
[31m-  // Separate into data blocks[m
[31m-  std::vector<Ref<DataBlock> > dataBlocks(DataBlock::getDataBlocks(codewords, version, ecLevel));[m
[31m-[m
[31m-[m
[31m-  // Count total number of data bytes[m
[31m-  int totalBytes = 0;[m
[31m-  for (size_t i = 0; i < dataBlocks.size(); i++) {[m
[31m-    totalBytes += dataBlocks[i]->getNumDataCodewords();[m
[31m-  }[m
[31m-  ArrayRef<unsigned char> resultBytes(totalBytes);[m
[31m-  int resultOffset = 0;[m
[31m-[m
[31m-[m
[31m-  // Error-correct and copy data blocks together into a stream of bytes[m
[31m-  for (size_t j = 0; j < dataBlocks.size(); j++) {[m
[31m-    Ref<DataBlock> dataBlock(dataBlocks[j]);[m
[31m-    ArrayRef<unsigned char> codewordBytes = dataBlock->getCodewords();[m
[31m-    int numDataCodewords = dataBlock->getNumDataCodewords();[m
[31m-    correctErrors(codewordBytes, numDataCodewords);[m
[31m-    for (int i = 0; i < numDataCodewords; i++) {[m
[31m-      resultBytes[resultOffset++] = codewordBytes[i];[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  return DecodedBitStreamParser::decode(resultBytes,[m
[31m-                                        version,[m
[31m-                                        ecLevel,[m
[31m-                                        DecodedBitStreamParser::Hashtable());[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/decoder/Mode.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Mode.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 19/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/decoder/Mode.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/qrcode/Version.h>[m
[31m-// #include <sstream>[m
[31m-[m
[31m-using zxing::qrcode::Mode;[m
[31m-using std::ostringstream;[m
[31m-[m
[31m-Mode Mode::TERMINATOR(0, 0, 0, 0x00, "TERMINATOR");[m
[31m-Mode Mode::NUMERIC(10, 12, 14, 0x01, "NUMERIC");[m
[31m-Mode Mode::ALPHANUMERIC(9, 11, 13, 0x02, "ALPHANUMERIC");[m
[31m-Mode Mode::STRUCTURED_APPEND(0, 0, 0, 0x03, "STRUCTURED_APPEND");[m
[31m-Mode Mode::BYTE(8, 16, 16, 0x04, "BYTE");[m
[31m-Mode Mode::ECI(0, 0, 0, 0x07, "ECI");[m
[31m-Mode Mode::KANJI(8, 10, 12, 0x08, "KANJI");[m
[31m-Mode Mode::FNC1_FIRST_POSITION(0, 0, 0, 0x05, "FNC1_FIRST_POSITION");[m
[31m-Mode Mode::FNC1_SECOND_POSITION(0, 0, 0, 0x09, "FNC1_SECOND_POSITION");[m
[31m-Mode Mode::HANZI(8, 10, 12, 0x0D, "HANZI");[m
[31m-[m
[31m-Mode::Mode(int cbv0_9, int cbv10_26, int cbv27, int bits, char const* name) :[m
[31m-    characterCountBitsForVersions0To9_(cbv0_9), characterCountBitsForVersions10To26_(cbv10_26),[m
[31m-    characterCountBitsForVersions27AndHigher_(cbv27), bits_(bits), name_(name) {[m
[31m-}[m
[31m-[m
[31m-Mode& Mode::forBits(int bits) {[m
[31m-    switch (bits) {[m
[31m-    case 0x0:[m
[31m-        return TERMINATOR;[m
[31m-    case 0x1:[m
[31m-        return NUMERIC;[m
[31m-    case 0x2:[m
[31m-        return ALPHANUMERIC;[m
[31m-    case 0x3:[m
[31m-        return STRUCTURED_APPEND;[m
[31m-    case 0x4:[m
[31m-        return BYTE;[m
[31m-    case 0x5:[m
[31m-        return FNC1_FIRST_POSITION;[m
[31m-    case 0x7:[m
[31m-        return ECI;[m
[31m-    case 0x8:[m
[31m-        return KANJI;[m
[31m-    case 0x9:[m
[31m-        return FNC1_SECOND_POSITION;[m
[31m-    case 0xD:[m
[31m-        // 0xD is defined in GBT 18284-2000, may not be supported in foreign country[m
[31m-        return HANZI;[m
[31m-    default:[m
[31m-        ostringstream s;[m
[31m-        s << "Illegal mode bits: " << bits;[m
[31m-        throw ReaderException(s.str().c_str());[m
[31m-    }[m
[31m-}[m
[31m-[m
[31m-int Mode::getCharacterCountBits(Version *version) {[m
[31m-  int number = version->getVersionNumber();[m
[31m-  if (number <= 9) {[m
[31m-    return characterCountBitsForVersions0To9_;[m
[31m-  } else if (number <= 26) {[m
[31m-    return characterCountBitsForVersions10To26_;[m
[31m-  } else {[m
[31m-    return characterCountBitsForVersions27AndHigher_;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/detector/AlignmentPattern.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  AlignmentPattern.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 13/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/detector/AlignmentPattern.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-AlignmentPattern::AlignmentPattern(float posX, float posY, float estimatedModuleSize) :[m
[31m-    ResultPoint(posX,posY), estimatedModuleSize_(estimatedModuleSize) {[m
[31m-}[m
[31m-[m
[31m-bool AlignmentPattern::aboutEquals(float moduleSize, float i, float j) const {[m
[31m-  if (abs(i - getY()) <= moduleSize && abs(j - getX()) <= moduleSize) {[m
[31m-    float moduleSizeDiff = abs(moduleSize - estimatedModuleSize_);[m
[31m-    return moduleSizeDiff <= 1.0f || moduleSizeDiff <= estimatedModuleSize_;[m
[31m-  }[m
[31m-  return false;[m
[31m-}[m
[31m-[m
[31m-Ref<AlignmentPattern> AlignmentPattern::combineEstimate(float i, float j, float newModuleSize) const {[m
[31m-  float combinedX = (getX() + j) / 2.0f;[m
[31m-  float combinedY = (getY() + i) / 2.0f;[m
[31m-  float combinedModuleSize = (estimatedModuleSize_ + newModuleSize) / 2.0f;[m
[31m-  Ref<AlignmentPattern> result[m
[31m-    (new AlignmentPattern(combinedX, combinedY, combinedModuleSize));[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/detector/AlignmentPatternFinder.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  AlignmentPatternFinder.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 14/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "AlignmentPatternFinder.h"[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/common/BitArray.h>[m
[31m-// #include <vector>[m
[31m-// #include <cmath>[m
[31m-// #include <cstdlib>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-float AlignmentPatternFinder::centerFromEnd(vector<int> &stateCount, int end) {[m
[31m-  return (float)(end - stateCount[2]) - stateCount[1] / 2.0f;[m
[31m-}[m
[31m-[m
[31m-bool AlignmentPatternFinder::foundPatternCross(vector<int> &stateCount) {[m
[31m-  float maxVariance = moduleSize_ / 2.0f;[m
[31m-  for (size_t i = 0; i < 3; i++) {[m
[31m-    if (abs(moduleSize_ - stateCount[i]) >= maxVariance) {[m
[31m-      return false;[m
[31m-    }[m
[31m-  }[m
[31m-  return true;[m
[31m-}[m
[31m-[m
[31m-float AlignmentPatternFinder::crossCheckVertical(size_t startI, size_t centerJ, int maxCount,[m
[31m-    int originalStateCountTotal) {[m
[31m-  int maxI = image_->getHeight();[m
[31m-  vector<int> stateCount(3, 0);[m
[31m-[m
[31m-[m
[31m-  // Start counting up from center[m
[31m-  int i = startI;[m
[31m-  while (i >= 0 && image_->get(centerJ, i) && stateCount[1] <= maxCount) {[m
[31m-    stateCount[1]++;[m
[31m-    i--;[m
[31m-  }[m
[31m-  // If already too many modules in this state or ran off the edge:[m
[31m-  if (i < 0 || stateCount[1] > maxCount) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-  while (i >= 0 && !image_->get(centerJ, i) && stateCount[0] <= maxCount) {[m
[31m-    stateCount[0]++;[m
[31m-    i--;[m
[31m-  }[m
[31m-  if (stateCount[0] > maxCount) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-[m
[31m-  // Now also count down from center[m
[31m-  i = startI + 1;[m
[31m-  while (i < maxI && image_->get(centerJ, i) && stateCount[1] <= maxCount) {[m
[31m-    stateCount[1]++;[m
[31m-    i++;[m
[31m-  }[m
[31m-  if (i == maxI || stateCount[1] > maxCount) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-  while (i < maxI && !image_->get(centerJ, i) && stateCount[2] <= maxCount) {[m
[31m-    stateCount[2]++;[m
[31m-    i++;[m
[31m-  }[m
[31m-  if (stateCount[2] > maxCount) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-[m
[31m-  int stateCountTotal = stateCount[0] + stateCount[1] + stateCount[2];[m
[31m-  if (5 * abs(stateCountTotal - originalStateCountTotal) >= 2 * originalStateCountTotal) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-[m
[31m-  return foundPatternCross(stateCount) ? centerFromEnd(stateCount, i) : NAN;[m
[31m-}[m
[31m-[m
[31m-Ref<AlignmentPattern> AlignmentPatternFinder::handlePossibleCenter(vector<int> &stateCount, size_t i, size_t j) {[m
[31m-  int stateCountTotal = stateCount[0] + stateCount[1] + stateCount[2];[m
[31m-  float centerJ = centerFromEnd(stateCount, j);[m
[31m-  float centerI = crossCheckVertical(i, (int)centerJ, 2 * stateCount[1], stateCountTotal);[m
[31m-  if (!isnan(centerI)) {[m
[31m-    float estimatedModuleSize = (float)(stateCount[0] + stateCount[1] + stateCount[2]) / 3.0f;[m
[31m-    int max = possibleCenters_->size();[m
[31m-    for (int index = 0; index < max; index++) {[m
[31m-      Ref<AlignmentPattern> center((*possibleCenters_)[index]);[m
[31m-      // Look for about the same center and module size:[m
[31m-      if (center->aboutEquals(estimatedModuleSize, centerI, centerJ)) {[m
[31m-        return center->combineEstimate(centerI, centerJ, estimatedModuleSize);[m
[31m-      }[m
[31m-    }[m
[31m-    AlignmentPattern *tmp = new AlignmentPattern(centerJ, centerI, estimatedModuleSize);[m
[31m-    // Hadn't found this before; save it[m
[31m-    tmp->retain();[m
[31m-    possibleCenters_->push_back(tmp);[m
[31m-    if (callback_ != 0) {[m
[31m-      callback_->foundPossibleResultPoint(*tmp);[m
[31m-    }[m
[31m-  }[m
[31m-  Ref<AlignmentPattern> result;[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-AlignmentPatternFinder::AlignmentPatternFinder(Ref<BitMatrix> image, size_t startX, size_t startY, size_t width,[m
[31m-                                               size_t height, float moduleSize,[m
[31m-                                               Ref<ResultPointCallback>const& callback) :[m
[31m-    image_(image), possibleCenters_(new vector<AlignmentPattern *> ()), startX_(startX), startY_(startY),[m
[31m-    width_(width), height_(height), moduleSize_(moduleSize), callback_(callback) {[m
[31m-}[m
[31m-[m
[31m-AlignmentPatternFinder::~AlignmentPatternFinder() {[m
[31m-  for (size_t i = 0; i < possibleCenters_->size(); i++) {[m
[31m-    (*possibleCenters_)[i]->release();[m
[31m-    (*possibleCenters_)[i] = 0;[m
[31m-  }[m
[31m-  delete possibleCenters_;[m
[31m-}[m
[31m-[m
[31m-Ref<AlignmentPattern> AlignmentPatternFinder::find() {[m
[31m-  size_t maxJ = startX_ + width_;[m
[31m-  size_t middleI = startY_ + (height_ >> 1);[m
[31m-  //      Ref<BitArray> luminanceRow(new BitArray(width_));[m
[31m-  // We are looking for black/white/black modules in 1:1:1 ratio;[m
[31m-  // this tracks the number of black/white/black modules seen so far[m
[31m-  vector<int> stateCount(3, 0);[m
[31m-  for (size_t iGen = 0; iGen < height_; iGen++) {[m
[31m-    // Search from middle outwards[m
[31m-    size_t i = middleI + ((iGen & 0x01) == 0 ? ((iGen + 1) >> 1) : -((iGen + 1) >> 1));[m
[31m-    //        image_->getBlackRow(i, luminanceRow, startX_, width_);[m
[31m-    stateCount[0] = 0;[m
[31m-    stateCount[1] = 0;[m
[31m-    stateCount[2] = 0;[m
[31m-    size_t j = startX_;[m
[31m-    // Burn off leading white pixels before anything else; if we start in the middle of[m
[31m-    // a white run, it doesn't make sense to count its length, since we don't know if the[m
[31m-    // white run continued to the left of the start point[m
[31m-    while (j < maxJ && !image_->get(j, i)) {[m
[31m-      j++;[m
[31m-    }[m
[31m-    int currentState = 0;[m
[31m-    while (j < maxJ) {[m
[31m-      if (image_->get(j, i)) {[m
[31m-        // Black pixel[m
[31m-        if (currentState == 1) { // Counting black pixels[m
[31m-          stateCount[currentState]++;[m
[31m-        } else { // Counting white pixels[m
[31m-          if (currentState == 2) { // A winner?[m
[31m-            if (foundPatternCross(stateCount)) { // Yes[m
[31m-              Ref<AlignmentPattern> confirmed(handlePossibleCenter(stateCount, i, j));[m
[31m-              if (confirmed != 0) {[m
[31m-                return confirmed;[m
[31m-              }[m
[31m-            }[m
[31m-            stateCount[0] = stateCount[2];[m
[31m-            stateCount[1] = 1;[m
[31m-            stateCount[2] = 0;[m
[31m-            currentState = 1;[m
[31m-          } else {[m
[31m-            stateCount[++currentState]++;[m
[31m-          }[m
[31m-        }[m
[31m-      } else { // White pixel[m
[31m-        if (currentState == 1) { // Counting black pixels[m
[31m-          currentState++;[m
[31m-        }[m
[31m-        stateCount[currentState]++;[m
[31m-      }[m
[31m-      j++;[m
[31m-    }[m
[31m-    if (foundPatternCross(stateCount)) {[m
[31m-      Ref<AlignmentPattern> confirmed(handlePossibleCenter(stateCount, i, maxJ));[m
[31m-      if (confirmed != 0) {[m
[31m-        return confirmed;[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-  }[m
[31m-[m
[31m-  // Hmm, nothing we saw was observed and confirmed twice. If we had[m
[31m-  // any guess at all, return it.[m
[31m-  if (possibleCenters_->size() > 0) {[m
[31m-    Ref<AlignmentPattern> center((*possibleCenters_)[0]);[m
[31m-    return center;[m
[31m-  }[m
[31m-[m
[31m-  throw zxing::ReaderException("Could not find alignment pattern");[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/detector/Detector.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Detector.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 14/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/detector/Detector.h>[m
[31m-// #include <zxing/qrcode/detector/FinderPatternFinder.h>[m
[31m-// #include <zxing/qrcode/detector/FinderPattern.h>[m
[31m-// #include <zxing/qrcode/detector/AlignmentPattern.h>[m
[31m-// #include <zxing/qrcode/detector/AlignmentPatternFinder.h>[m
[31m-// #include <zxing/qrcode/Version.h>[m
[31m-// #include <zxing/common/GridSampler.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-// #include <cmath>[m
[31m-// #include <sstream>[m
[31m-// #include <cstdlib>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-Detector::Detector(Ref<BitMatrix> image) :[m
[31m-    image_(image) {[m
[31m-}[m
[31m-[m
[31m-Ref<BitMatrix> Detector::getImage() {[m
[31m-   return image_;[m
[31m-}[m
[31m-[m
[31m-Ref<DetectorResult> Detector::detect(DecodeHints const& hints) {[m
[31m-  callback_ = hints.getResultPointCallback();[m
[31m-  FinderPatternFinder finder(image_, hints.getResultPointCallback());[m
[31m-  Ref<FinderPatternInfo> info(finder.find(hints));[m
[31m-  return processFinderPatternInfo(info);[m
[31m-}[m
[31m-[m
[31m-Ref<DetectorResult> Detector::processFinderPatternInfo(Ref<FinderPatternInfo> info){[m
[31m-  Ref<FinderPattern> topLeft(info->getTopLeft());[m
[31m-  Ref<FinderPattern> topRight(info->getTopRight());[m
[31m-  Ref<FinderPattern> bottomLeft(info->getBottomLeft());[m
[31m-[m
[31m-  float moduleSize = calculateModuleSize(topLeft, topRight, bottomLeft);[m
[31m-  if (moduleSize < 1.0f) {[m
[31m-    throw zxing::ReaderException("bad module size");[m
[31m-  }[m
[31m-  int dimension = computeDimension(topLeft, topRight, bottomLeft, moduleSize);[m
[31m-  Version *provisionalVersion = Version::getProvisionalVersionForDimension(dimension);[m
[31m-  int modulesBetweenFPCenters = provisionalVersion->getDimensionForVersion() - 7;[m
[31m-[m
[31m-  Ref<AlignmentPattern> alignmentPattern;[m
[31m-  // Anything above version 1 has an alignment pattern[m
[31m-  if (provisionalVersion->getAlignmentPatternCenters().size() > 0) {[m
[31m-[m
[31m-[m
[31m-    // Guess where a "bottom right" finder pattern would have been[m
[31m-    float bottomRightX = topRight->getX() - topLeft->getX() + bottomLeft->getX();[m
[31m-    float bottomRightY = topRight->getY() - topLeft->getY() + bottomLeft->getY();[m
[31m-[m
[31m-[m
[31m-    // Estimate that alignment pattern is closer by 3 modules[m
[31m-    // from "bottom right" to known top left location[m
[31m-    float correctionToTopLeft = 1.0f - 3.0f / (float)modulesBetweenFPCenters;[m
[31m-    int estAlignmentX = (int)(topLeft->getX() + correctionToTopLeft * (bottomRightX - topLeft->getX()));[m
[31m-    int estAlignmentY = (int)(topLeft->getY() + correctionToTopLeft * (bottomRightY - topLeft->getY()));[m
[31m-[m
[31m-[m
[31m-    // Kind of arbitrary -- expand search radius before giving up[m
[31m-    for (int i = 4; i <= 16; i <<= 1) {[m
[31m-      try {[m
[31m-        alignmentPattern = findAlignmentInRegion(moduleSize, estAlignmentX, estAlignmentY, (float)i);[m
[31m-        break;[m
[31m-      } catch (zxing::ReaderException const& re) {[m
[31m-        // try next round[m
[31m-      }[m
[31m-    }[m
[31m-    if (alignmentPattern == 0) {[m
[31m-      // Try anyway[m
[31m-    }[m
[31m-[m
[31m-  }[m
[31m-[m
[31m-  Ref<PerspectiveTransform> transform = createTransform(topLeft, topRight, bottomLeft, alignmentPattern, dimension);[m
[31m-  Ref<BitMatrix> bits(sampleGrid(image_, dimension, transform));[m
[31m-  std::vector<Ref<ResultPoint> > points(alignmentPattern == 0 ? 3 : 4);[m
[31m-  points[0].reset(bottomLeft);[m
[31m-  points[1].reset(topLeft);[m
[31m-  points[2].reset(topRight);[m
[31m-  if (alignmentPattern != 0) {[m
[31m-    points[3].reset(alignmentPattern);[m
[31m-  }[m
[31m-[m
[31m-  Ref<DetectorResult> result(new DetectorResult(bits, points, transform));[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-Ref<PerspectiveTransform> Detector::createTransform(Ref<ResultPoint> topLeft, Ref<ResultPoint> topRight, Ref <[m
[31m-    ResultPoint > bottomLeft, Ref<ResultPoint> alignmentPattern, int dimension) {[m
[31m-[m
[31m-  float dimMinusThree = (float)dimension - 3.5f;[m
[31m-  float bottomRightX;[m
[31m-  float bottomRightY;[m
[31m-  float sourceBottomRightX;[m
[31m-  float sourceBottomRightY;[m
[31m-  if (alignmentPattern != 0) {[m
[31m-    bottomRightX = alignmentPattern->getX();[m
[31m-    bottomRightY = alignmentPattern->getY();[m
[31m-    sourceBottomRightX = sourceBottomRightY = dimMinusThree - 3.0f;[m
[31m-  } else {[m
[31m-    // Don't have an alignment pattern, just make up the bottom-right point[m
[31m-    bottomRightX = (topRight->getX() - topLeft->getX()) + bottomLeft->getX();[m
[31m-    bottomRightY = (topRight->getY() - topLeft->getY()) + bottomLeft->getY();[m
[31m-    sourceBottomRightX = sourceBottomRightY = dimMinusThree;[m
[31m-  }[m
[31m-[m
[31m-  Ref<PerspectiveTransform> transform(PerspectiveTransform::quadrilateralToQuadrilateral(3.5f, 3.5f, dimMinusThree, 3.5f, sourceBottomRightX,[m
[31m-                                      sourceBottomRightY, 3.5f, dimMinusThree, topLeft->getX(), topLeft->getY(), topRight->getX(),[m
[31m-                                      topRight->getY(), bottomRightX, bottomRightY, bottomLeft->getX(), bottomLeft->getY()));[m
[31m-[m
[31m-  return transform;[m
[31m-}[m
[31m-[m
[31m-Ref<BitMatrix> Detector::sampleGrid(Ref<BitMatrix> image, int dimension, Ref<PerspectiveTransform> transform) {[m
[31m-  GridSampler &sampler = GridSampler::getInstance();[m
[31m-  return sampler.sampleGrid(image, dimension, transform);[m
[31m-}[m
[31m-[m
[31m-int Detector::computeDimension(Ref<ResultPoint> topLeft, Ref<ResultPoint> topRight, Ref<ResultPoint> bottomLeft,[m
[31m-                               float moduleSize) {[m
[31m-  int tltrCentersDimension = int(FinderPatternFinder::distance(topLeft, topRight) / moduleSize + 0.5f);[m
[31m-  int tlblCentersDimension = int(FinderPatternFinder::distance(topLeft, bottomLeft) / moduleSize + 0.5f);[m
[31m-  int dimension = ((tltrCentersDimension + tlblCentersDimension) >> 1) + 7;[m
[31m-  switch (dimension & 0x03) { // mod 4[m
[31m-  case 0:[m
[31m-    dimension++;[m
[31m-    break;[m
[31m-    // 1? do nothing[m
[31m-  case 2:[m
[31m-    dimension--;[m
[31m-    break;[m
[31m-  case 3:[m
[31m-    ostringstream s;[m
[31m-    s << "Bad dimension: " << dimension;[m
[31m-    throw zxing::ReaderException(s.str().c_str());[m
[31m-  }[m
[31m-  return dimension;[m
[31m-}[m
[31m-[m
[31m-float Detector::calculateModuleSize(Ref<ResultPoint> topLeft, Ref<ResultPoint> topRight, Ref<ResultPoint> bottomLeft) {[m
[31m-  // Take the average[m
[31m-  return (calculateModuleSizeOneWay(topLeft, topRight) + calculateModuleSizeOneWay(topLeft, bottomLeft)) / 2.0f;[m
[31m-}[m
[31m-[m
[31m-float Detector::calculateModuleSizeOneWay(Ref<ResultPoint> pattern, Ref<ResultPoint> otherPattern) {[m
[31m-  float moduleSizeEst1 = sizeOfBlackWhiteBlackRunBothWays((int)pattern->getX(), (int)pattern->getY(),[m
[31m-                         (int)otherPattern->getX(), (int)otherPattern->getY());[m
[31m-  float moduleSizeEst2 = sizeOfBlackWhiteBlackRunBothWays((int)otherPattern->getX(), (int)otherPattern->getY(),[m
[31m-                         (int)pattern->getX(), (int)pattern->getY());[m
[31m-  if (isnan(moduleSizeEst1)) {[m
[31m-    return moduleSizeEst2;[m
[31m-  }[m
[31m-  if (isnan(moduleSizeEst2)) {[m
[31m-    return moduleSizeEst1;[m
[31m-  }[m
[31m-  // Average them, and divide by 7 since we've counted the width of 3 black modules,[m
[31m-  // and 1 white and 1 black module on either side. Ergo, divide sum by 14.[m
[31m-  return (moduleSizeEst1 + moduleSizeEst2) / 14.0f;[m
[31m-}[m
[31m-[m
[31m-float Detector::sizeOfBlackWhiteBlackRunBothWays(int fromX, int fromY, int toX, int toY) {[m
[31m-[m
[31m-    float result = sizeOfBlackWhiteBlackRun(fromX, fromY, toX, toY);[m
[31m-[m
[31m-    // Now count other way -- don't run off image though of course[m
[31m-    float scale = 1.0f;[m
[31m-    int otherToX = fromX - (toX - fromX);[m
[31m-    if (otherToX < 0) {[m
[31m-      scale = (float) fromX / (float) (fromX - otherToX);[m
[31m-      otherToX = 0;[m
[31m-    } else if (otherToX >= (int)image_->getWidth()) {[m
[31m-      scale = (float) (image_->getWidth() - 1 - fromX) / (float) (otherToX - fromX);[m
[31m-      otherToX = image_->getWidth() - 1;[m
[31m-    }[m
[31m-    int otherToY = (int) (fromY - (toY - fromY) * scale);[m
[31m-[m
[31m-    scale = 1.0f;[m
[31m-    if (otherToY < 0) {[m
[31m-      scale = (float) fromY / (float) (fromY - otherToY);[m
[31m-      otherToY = 0;[m
[31m-    } else if (otherToY >= (int)image_->getHeight()) {[m
[31m-      scale = (float) (image_->getHeight() - 1 - fromY) / (float) (otherToY - fromY);[m
[31m-      otherToY = image_->getHeight() - 1;[m
[31m-    }[m
[31m-    otherToX = (int) (fromX + (otherToX - fromX) * scale);[m
[31m-[m
[31m-    result += sizeOfBlackWhiteBlackRun(fromX, fromY, otherToX, otherToY);[m
[31m-[m
[31m-    // Middle pixel is double-counted this way; subtract 1[m
[31m-    return result - 1.0f;[m
[31m-}[m
[31m-[m
[31m-float Detector::sizeOfBlackWhiteBlackRun(int fromX, int fromY, int toX, int toY) {[m
[31m-    // Mild variant of Bresenham's algorithm;[m
[31m-    // see http://en.wikipedia.org/wiki/Bresenham's_line_algorithm[m
[31m-    bool steep = abs(toY - fromY) > abs(toX - fromX);[m
[31m-    if (steep) {[m
[31m-      int temp = fromX;[m
[31m-      fromX = fromY;[m
[31m-      fromY = temp;[m
[31m-      temp = toX;[m
[31m-      toX = toY;[m
[31m-      toY = temp;[m
[31m-    }[m
[31m-[m
[31m-    int dx = abs(toX - fromX);[m
[31m-    int dy = abs(toY - fromY);[m
[31m-    int error = -dx >> 1;[m
[31m-    int xstep = fromX < toX ? 1 : -1;[m
[31m-    int ystep = fromY < toY ? 1 : -1;[m
[31m-[m
[31m-    // In black pixels, looking for white, first or second time.[m
[31m-    int state = 0;[m
[31m-    // Loop up until x == toX, but not beyond[m
[31m-    int xLimit = toX + xstep;[m
[31m-    for (int x = fromX, y = fromY; x != xLimit; x += xstep) {[m
[31m-      int realX = steep ? y : x;[m
[31m-      int realY = steep ? x : y;[m
[31m-[m
[31m-      // Does current pixel mean we have moved white to black or vice versa?[m
[31m-      if (!((state == 1) ^ image_->get(realX, realY))) {[m
[31m-        if (state == 2) {[m
[31m-          int diffX = x - fromX;[m
[31m-          int diffY = y - fromY;[m
[31m-          return (float) sqrt((double) (diffX * diffX + diffY * diffY));[m
[31m-        }[m
[31m-        state++;[m
[31m-      }[m
[31m-[m
[31m-      error += dy;[m
[31m-      if (error > 0) {[m
[31m-        if (y == toY) {[m
[31m-          break;[m
[31m-        }[m
[31m-        y += ystep;[m
[31m-        error -= dx;[m
[31m-      }[m
[31m-    }[m
[31m-    // Found black-white-black; give the benefit of the doubt that the next pixel outside the image[m
[31m-    // is "white" so this last point at (toX+xStep,toY) is the right ending. This is really a[m
[31m-    // small approximation; (toX+xStep,toY+yStep) might be really correct. Ignore this.[m
[31m-    if (state == 2) {[m
[31m-      int diffX = toX + xstep - fromX;[m
[31m-      int diffY = toY - fromY;[m
[31m-      return (float) sqrt((double) (diffX * diffX + diffY * diffY));[m
[31m-    }[m
[31m-    // else we didn't find even black-white-black; no estimate is really possible[m
[31m-    return NAN;[m
[31m-}[m
[31m-[m
[31m-Ref<AlignmentPattern> Detector::findAlignmentInRegion(float overallEstModuleSize, int estAlignmentX, int estAlignmentY,[m
[31m-    float allowanceFactor) {[m
[31m-  // Look for an alignment pattern (3 modules in size) around where it[m
[31m-  // should be[m
[31m-  int allowance = (int)(allowanceFactor * overallEstModuleSize);[m
[31m-  int alignmentAreaLeftX = max(0, estAlignmentX - allowance);[m
[31m-  int alignmentAreaRightX = min((int)(image_->getWidth() - 1), estAlignmentX + allowance);[m
[31m-  if (alignmentAreaRightX - alignmentAreaLeftX < overallEstModuleSize * 3) {[m
[31m-      throw zxing::ReaderException("region too small to hold alignment pattern");[m
[31m-  }[m
[31m-  int alignmentAreaTopY = max(0, estAlignmentY - allowance);[m
[31m-  int alignmentAreaBottomY = min((int)(image_->getHeight() - 1), estAlignmentY + allowance);[m
[31m-  if (alignmentAreaBottomY - alignmentAreaTopY < overallEstModuleSize * 3) {[m
[31m-      throw zxing::ReaderException("region too small to hold alignment pattern");[m
[31m-  }[m
[31m-[m
[31m-  AlignmentPatternFinder alignmentFinder(image_, alignmentAreaLeftX, alignmentAreaTopY, alignmentAreaRightX[m
[31m-                                         - alignmentAreaLeftX, alignmentAreaBottomY - alignmentAreaTopY, overallEstModuleSize, callback_);[m
[31m-  return alignmentFinder.find();[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/detector/FinderPattern.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  FinderPattern.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 13/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/detector/FinderPattern.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace qrcode {[m
[31m-[m
[31m-		using namespace std;[m
[31m-[m
[31m-		FinderPattern::FinderPattern(float posX, float posY, float estimatedModuleSize) :[m
[31m-		ResultPoint(posX,posY), estimatedModuleSize_(estimatedModuleSize), count_(1) {[m
[31m-		}[m
[31m-[m
[31m-		FinderPattern::FinderPattern(float posX, float posY, float estimatedModuleSize, int count) :[m
[31m-		ResultPoint(posX,posY), estimatedModuleSize_(estimatedModuleSize), count_(count) {[m
[31m-		}[m
[31m-[m
[31m-		int FinderPattern::getCount() const {[m
[31m-			return count_;[m
[31m-		}[m
[31m-[m
[31m-		float FinderPattern::getEstimatedModuleSize() const {[m
[31m-			return estimatedModuleSize_;[m
[31m-		}[m
[31m-[m
[31m-		void FinderPattern::incrementCount() {[m
[31m-			count_++;[m
[31m-		}[m
[31m-[m
[31m-/*[m
[31m-		bool FinderPattern::aboutEquals(float moduleSize, float i, float j) const {[m
[31m-			return abs(i - posY_) <= moduleSize && abs(j - posX_) <= moduleSize && (abs(moduleSize - estimatedModuleSize_)[m
[31m-																					<= 1.0f || abs(moduleSize - estimatedModuleSize_) / estimatedModuleSize_ <= 0.1f);[m
[31m-		}[m
[31m-*/[m
[31m-    bool FinderPattern::aboutEquals(float moduleSize, float i, float j) const {[m
[31m-      if (abs(i - getY()) <= moduleSize && abs(j - getX()) <= moduleSize) {[m
[31m-        float moduleSizeDiff = abs(moduleSize - estimatedModuleSize_);[m
[31m-        return moduleSizeDiff <= 1.0f || moduleSizeDiff <= estimatedModuleSize_;[m
[31m-      }[m
[31m-      return false;[m
[31m-    }[m
[31m-[m
[31m-    Ref<FinderPattern> FinderPattern::combineEstimate(float i, float j, float newModuleSize) const {[m
[31m-      int combinedCount = count_ + 1;[m
[31m-      float combinedX = (count_ * getX() + j) / combinedCount;[m
[31m-      float combinedY = (count_ * getY() + i) / combinedCount;[m
[31m-      float combinedModuleSize = (count_ * getEstimatedModuleSize() + newModuleSize) / combinedCount;[m
[31m-      return Ref<FinderPattern>(new FinderPattern(combinedX, combinedY, combinedModuleSize, combinedCount));[m
[31m-    }[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/detector/FinderPatternFinder.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  FinderPatternFinder.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 13/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/detector/FinderPatternFinder.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-// #include <vector>[m
[31m-// #include <cmath>[m
[31m-// #include <cstdlib>[m
[31m-// #include <algorithm>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-class FurthestFromAverageComparator {[m
[31m-private:[m
[31m-  const float averageModuleSize_;[m
[31m-public:[m
[31m-  FurthestFromAverageComparator(float averageModuleSize) :[m
[31m-    averageModuleSize_(averageModuleSize) {[m
[31m-  }[m
[31m-  bool operator()(Ref<FinderPattern> a, Ref<FinderPattern> b) {[m
[31m-    float dA = abs(a->getEstimatedModuleSize() - averageModuleSize_);[m
[31m-    float dB = abs(b->getEstimatedModuleSize() - averageModuleSize_);[m
[31m-    return dA > dB;[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-class CenterComparator {[m
[31m-  const float averageModuleSize_;[m
[31m-public:[m
[31m-  CenterComparator(float averageModuleSize) :[m
[31m-    averageModuleSize_(averageModuleSize) {[m
[31m-  }[m
[31m-  bool operator()(Ref<FinderPattern> a, Ref<FinderPattern> b) {[m
[31m-    // N.B.: we want the result in descending order ...[m
[31m-    if (a->getCount() != b->getCount()) {[m
[31m-      return a->getCount() > b->getCount();[m
[31m-    } else {[m
[31m-      float dA = abs(a->getEstimatedModuleSize() - averageModuleSize_);[m
[31m-      float dB = abs(b->getEstimatedModuleSize() - averageModuleSize_);[m
[31m-      return dA < dB;[m
[31m-    }[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-int FinderPatternFinder::CENTER_QUORUM = 2;[m
[31m-int FinderPatternFinder::MIN_SKIP = 3;[m
[31m-int FinderPatternFinder::MAX_MODULES = 57;[m
[31m-[m
[31m-float FinderPatternFinder::centerFromEnd(int* stateCount, int end) {[m
[31m-  return (float)(end - stateCount[4] - stateCount[3]) - stateCount[2] / 2.0f;[m
[31m-}[m
[31m-[m
[31m-bool FinderPatternFinder::foundPatternCross(int* stateCount) {[m
[31m-  int totalModuleSize = 0;[m
[31m-  for (int i = 0; i < 5; i++) {[m
[31m-    if (stateCount[i] == 0) {[m
[31m-      return false;[m
[31m-    }[m
[31m-    totalModuleSize += stateCount[i];[m
[31m-  }[m
[31m-  if (totalModuleSize < 7) {[m
[31m-    return false;[m
[31m-  }[m
[31m-  float moduleSize = (float)totalModuleSize / 7.0f;[m
[31m-  float maxVariance = moduleSize / 2.0f;[m
[31m-  // Allow less than 50% variance from 1-1-3-1-1 proportions[m
[31m-  return abs(moduleSize - stateCount[0]) < maxVariance && abs(moduleSize - stateCount[1]) < maxVariance && abs(3.0f[m
[31m-         * moduleSize - stateCount[2]) < 3.0f * maxVariance && abs(moduleSize - stateCount[3]) < maxVariance && abs([m
[31m-           moduleSize - stateCount[4]) < maxVariance;[m
[31m-}[m
[31m-[m
[31m-float FinderPatternFinder::crossCheckVertical(size_t startI, size_t centerJ, int maxCount, int originalStateCountTotal) {[m
[31m-[m
[31m-  int maxI = image_->getHeight();[m
[31m-  int stateCount[5];[m
[31m-  for (int i = 0; i < 5; i++)[m
[31m-    stateCount[i] = 0;[m
[31m-[m
[31m-[m
[31m-  // Start counting up from center[m
[31m-  int i = startI;[m
[31m-  while (i >= 0 && image_->get(centerJ, i)) {[m
[31m-    stateCount[2]++;[m
[31m-    i--;[m
[31m-  }[m
[31m-  if (i < 0) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-  while (i >= 0 && !image_->get(centerJ, i) && stateCount[1] <= maxCount) {[m
[31m-    stateCount[1]++;[m
[31m-    i--;[m
[31m-  }[m
[31m-  // If already too many modules in this state or ran off the edge:[m
[31m-  if (i < 0 || stateCount[1] > maxCount) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-  while (i >= 0 && image_->get(centerJ, i) && stateCount[0] <= maxCount) {[m
[31m-    stateCount[0]++;[m
[31m-    i--;[m
[31m-  }[m
[31m-  if (stateCount[0] > maxCount) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-[m
[31m-  // Now also count down from center[m
[31m-  i = startI + 1;[m
[31m-  while (i < maxI && image_->get(centerJ, i)) {[m
[31m-    stateCount[2]++;[m
[31m-    i++;[m
[31m-  }[m
[31m-  if (i == maxI) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-  while (i < maxI && !image_->get(centerJ, i) && stateCount[3] < maxCount) {[m
[31m-    stateCount[3]++;[m
[31m-    i++;[m
[31m-  }[m
[31m-  if (i == maxI || stateCount[3] >= maxCount) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-  while (i < maxI && image_->get(centerJ, i) && stateCount[4] < maxCount) {[m
[31m-    stateCount[4]++;[m
[31m-    i++;[m
[31m-  }[m
[31m-  if (stateCount[4] >= maxCount) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-[m
[31m-  // If we found a finder-pattern-like section, but its size is more than 40% different than[m
[31m-  // the original, assume it's a false positive[m
[31m-  int stateCountTotal = stateCount[0] + stateCount[1] + stateCount[2] + stateCount[3] + stateCount[4];[m
[31m-  if (5 * abs(stateCountTotal - originalStateCountTotal) >= 2 * originalStateCountTotal) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-[m
[31m-  return foundPatternCross(stateCount) ? centerFromEnd(stateCount, i) : NAN;[m
[31m-}[m
[31m-[m
[31m-float FinderPatternFinder::crossCheckHorizontal(size_t startJ, size_t centerI, int maxCount,[m
[31m-    int originalStateCountTotal) {[m
[31m-[m
[31m-  int maxJ = image_->getWidth();[m
[31m-  int stateCount[5];[m
[31m-  for (int i = 0; i < 5; i++)[m
[31m-    stateCount[i] = 0;[m
[31m-[m
[31m-  int j = startJ;[m
[31m-  while (j >= 0 && image_->get(j, centerI)) {[m
[31m-    stateCount[2]++;[m
[31m-    j--;[m
[31m-  }[m
[31m-  if (j < 0) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-  while (j >= 0 && !image_->get(j, centerI) && stateCount[1] <= maxCount) {[m
[31m-    stateCount[1]++;[m
[31m-    j--;[m
[31m-  }[m
[31m-  if (j < 0 || stateCount[1] > maxCount) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-  while (j >= 0 && image_->get(j, centerI) && stateCount[0] <= maxCount) {[m
[31m-    stateCount[0]++;[m
[31m-    j--;[m
[31m-  }[m
[31m-  if (stateCount[0] > maxCount) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-[m
[31m-  j = startJ + 1;[m
[31m-  while (j < maxJ && image_->get(j, centerI)) {[m
[31m-    stateCount[2]++;[m
[31m-    j++;[m
[31m-  }[m
[31m-  if (j == maxJ) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-  while (j < maxJ && !image_->get(j, centerI) && stateCount[3] < maxCount) {[m
[31m-    stateCount[3]++;[m
[31m-    j++;[m
[31m-  }[m
[31m-  if (j == maxJ || stateCount[3] >= maxCount) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-  while (j < maxJ && image_->get(j, centerI) && stateCount[4] < maxCount) {[m
[31m-    stateCount[4]++;[m
[31m-    j++;[m
[31m-  }[m
[31m-  if (stateCount[4] >= maxCount) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-[m
[31m-  // If we found a finder-pattern-like section, but its size is significantly different than[m
[31m-  // the original, assume it's a false positive[m
[31m-  int stateCountTotal = stateCount[0] + stateCount[1] + stateCount[2] + stateCount[3] + stateCount[4];[m
[31m-  if (5 * abs(stateCountTotal - originalStateCountTotal) >= originalStateCountTotal) {[m
[31m-    return NAN;[m
[31m-  }[m
[31m-[m
[31m-  return foundPatternCross(stateCount) ? centerFromEnd(stateCount, j) : NAN;[m
[31m-}[m
[31m-[m
[31m-bool FinderPatternFinder::handlePossibleCenter(int* stateCount, size_t i, size_t j) {[m
[31m-  int stateCountTotal = stateCount[0] + stateCount[1] + stateCount[2] + stateCount[3] + stateCount[4];[m
[31m-  float centerJ = centerFromEnd(stateCount, j);[m
[31m-  float centerI = crossCheckVertical(i, (size_t)centerJ, stateCount[2], stateCountTotal);[m
[31m-  if (!isnan(centerI)) {[m
[31m-    // Re-cross check[m
[31m-    centerJ = crossCheckHorizontal((size_t)centerJ, (size_t)centerI, stateCount[2], stateCountTotal);[m
[31m-    if (!isnan(centerJ)) {[m
[31m-      float estimatedModuleSize = (float)stateCountTotal / 7.0f;[m
[31m-      bool found = false;[m
[31m-      size_t max = possibleCenters_.size();[m
[31m-      for (size_t index = 0; index < max; index++) {[m
[31m-        Ref<FinderPattern> center = possibleCenters_[index];[m
[31m-        // Look for about the same center and module size:[m
[31m-        if (center->aboutEquals(estimatedModuleSize, centerI, centerJ)) {[m
[31m-          possibleCenters_[index] = center->combineEstimate(centerI, centerJ, estimatedModuleSize);[m
[31m-          found = true;[m
[31m-          break;[m
[31m-        }[m
[31m-      }[m
[31m-      if (!found) {[m
[31m-        Ref<FinderPattern> newPattern(new FinderPattern(centerJ, centerI, estimatedModuleSize));[m
[31m-        possibleCenters_.push_back(newPattern);[m
[31m-        if (callback_ != 0) {[m
[31m-          callback_->foundPossibleResultPoint(*newPattern);[m
[31m-        }[m
[31m-      }[m
[31m-      return true;[m
[31m-    }[m
[31m-  }[m
[31m-  return false;[m
[31m-}[m
[31m-[m
[31m-int FinderPatternFinder::findRowSkip() {[m
[31m-  size_t max = possibleCenters_.size();[m
[31m-  if (max <= 1) {[m
[31m-    return 0;[m
[31m-  }[m
[31m-  Ref<FinderPattern> firstConfirmedCenter;[m
[31m-  for (size_t i = 0; i < max; i++) {[m
[31m-    Ref<FinderPattern> center = possibleCenters_[i];[m
[31m-    if (center->getCount() >= CENTER_QUORUM) {[m
[31m-      if (firstConfirmedCenter == 0) {[m
[31m-        firstConfirmedCenter = center;[m
[31m-      } else {[m
[31m-        // We have two confirmed centers[m
[31m-        // How far down can we skip before resuming looking for the next[m
[31m-        // pattern? In the worst case, only the difference between the[m
[31m-        // difference in the x / y coordinates of the two centers.[m
[31m-        // This is the case where you find top left first. Draw it out.[m
[31m-        hasSkipped_ = true;[m
[31m-        return (int)(abs(firstConfirmedCenter->getX() - center->getX()) - abs(firstConfirmedCenter->getY()[m
[31m-                     - center->getY()))/2;[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-  return 0;[m
[31m-}[m
[31m-[m
[31m-bool FinderPatternFinder::haveMultiplyConfirmedCenters() {[m
[31m-  int confirmedCount = 0;[m
[31m-  float totalModuleSize = 0.0f;[m
[31m-  size_t max = possibleCenters_.size();[m
[31m-  for (size_t i = 0; i < max; i++) {[m
[31m-    Ref<FinderPattern> pattern = possibleCenters_[i];[m
[31m-    if (pattern->getCount() >= CENTER_QUORUM) {[m
[31m-      confirmedCount++;[m
[31m-      totalModuleSize += pattern->getEstimatedModuleSize();[m
[31m-    }[m
[31m-  }[m
[31m-  if (confirmedCount < 3) {[m
[31m-    return false;[m
[31m-  }[m
[31m-  // OK, we have at least 3 confirmed centers, but, it's possible that one is a "false positive"[m
[31m-  // and that we need to keep looking. We detect this by asking if the estimated module sizes[m
[31m-  // vary too much. We arbitrarily say that when the total deviation from average exceeds[m
[31m-  // 5% of the total module size estimates, it's too much.[m
[31m-  float average = totalModuleSize / max;[m
[31m-  float totalDeviation = 0.0f;[m
[31m-  for (size_t i = 0; i < max; i++) {[m
[31m-    Ref<FinderPattern> pattern = possibleCenters_[i];[m
[31m-    totalDeviation += abs(pattern->getEstimatedModuleSize() - average);[m
[31m-  }[m
[31m-  return totalDeviation <= 0.05f * totalModuleSize;[m
[31m-}[m
[31m-[m
[31m-vector<Ref<FinderPattern> > FinderPatternFinder::selectBestPatterns() {[m
[31m-  size_t startSize = possibleCenters_.size();[m
[31m-[m
[31m-  if (startSize < 3) {[m
[31m-    // Couldn't find enough finder patterns[m
[31m-    throw zxing::ReaderException("Could not find three finder patterns");[m
[31m-  }[m
[31m-[m
[31m-  // Filter outlier possibilities whose module size is too different[m
[31m-  if (startSize > 3) {[m
[31m-    // But we can only afford to do so if we have at least 4 possibilities to choose from[m
[31m-    float totalModuleSize = 0.0f;[m
[31m-    float square = 0.0f;[m
[31m-    for (size_t i = 0; i < startSize; i++) {[m
[31m-      float size = possibleCenters_[i]->getEstimatedModuleSize();[m
[31m-      totalModuleSize += size;[m
[31m-      square += size * size;[m
[31m-    }[m
[31m-    float average = totalModuleSize / (float) startSize;[m
[31m-    float stdDev = (float)sqrt(square / startSize - average * average);[m
[31m-[m
[31m-    sort(possibleCenters_.begin(), possibleCenters_.end(), FurthestFromAverageComparator(average));[m
[31m-[m
[31m-    float limit = max(0.2f * average, stdDev);[m
[31m-[m
[31m-    for (size_t i = 0; i < possibleCenters_.size() && possibleCenters_.size() > 3; i++) {[m
[31m-      if (abs(possibleCenters_[i]->getEstimatedModuleSize() - average) > limit) {[m
[31m-        possibleCenters_.erase(possibleCenters_.begin()+i);[m
[31m-        i--;[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  if (possibleCenters_.size() > 3) {[m
[31m-    // Throw away all but those first size candidate points we found.[m
[31m-    float totalModuleSize = 0.0f;[m
[31m-    for (size_t i = 0; i < possibleCenters_.size(); i++) {[m
[31m-      float size = possibleCenters_[i]->getEstimatedModuleSize();[m
[31m-      totalModuleSize += size;[m
[31m-    }[m
[31m-    float average = totalModuleSize / (float) possibleCenters_.size();[m
[31m-    sort(possibleCenters_.begin(), possibleCenters_.end(), CenterComparator(average));[m
[31m-  }[m
[31m-[m
[31m-  if (possibleCenters_.size() > 3) {[m
[31m-    possibleCenters_.erase(possibleCenters_.begin()+3,possibleCenters_.end());[m
[31m-  }[m
[31m-[m
[31m-  vector<Ref<FinderPattern> > result(3);[m
[31m-  result[0] = possibleCenters_[0];[m
[31m-  result[1] = possibleCenters_[1];[m
[31m-  result[2] = possibleCenters_[2];[m
[31m-  return result;[m
[31m-}[m
[31m-[m
[31m-vector<Ref<FinderPattern> > FinderPatternFinder::orderBestPatterns(vector<Ref<FinderPattern> > patterns) {[m
[31m-  // Find distances between pattern centers[m
[31m-  float abDistance = distance(patterns[0], patterns[1]);[m
[31m-  float bcDistance = distance(patterns[1], patterns[2]);[m
[31m-  float acDistance = distance(patterns[0], patterns[2]);[m
[31m-[m
[31m-  Ref<FinderPattern> topLeft;[m
[31m-  Ref<FinderPattern> topRight;[m
[31m-  Ref<FinderPattern> bottomLeft;[m
[31m-  // Assume one closest to other two is top left;[m
[31m-  // topRight and bottomLeft will just be guesses below at first[m
[31m-  if (bcDistance >= abDistance && bcDistance >= acDistance) {[m
[31m-    topLeft = patterns[0];[m
[31m-    topRight = patterns[1];[m
[31m-    bottomLeft = patterns[2];[m
[31m-  } else if (acDistance >= bcDistance && acDistance >= abDistance) {[m
[31m-    topLeft = patterns[1];[m
[31m-    topRight = patterns[0];[m
[31m-    bottomLeft = patterns[2];[m
[31m-  } else {[m
[31m-    topLeft = patterns[2];[m
[31m-    topRight = patterns[0];[m
[31m-    bottomLeft = patterns[1];[m
[31m-  }[m
[31m-[m
[31m-  // Use cross product to figure out which of other1/2 is the bottom left[m
[31m-  // pattern. The vector "top-left -> bottom-left" x "top-left -> top-right"[m
[31m-  // should yield a vector with positive z component[m
[31m-  if ((bottomLeft->getY() - topLeft->getY()) * (topRight->getX() - topLeft->getX()) < (bottomLeft->getX()[m
[31m-      - topLeft->getX()) * (topRight->getY() - topLeft->getY())) {[m
[31m-    Ref<FinderPattern> temp = topRight;[m
[31m-    topRight = bottomLeft;[m
[31m-    bottomLeft = temp;[m
[31m-  }[m
[31m-[m
[31m-  vector<Ref<FinderPattern> > results(3);[m
[31m-  results[0] = bottomLeft;[m
[31m-  results[1] = topLeft;[m
[31m-  results[2] = topRight;[m
[31m-  return results;[m
[31m-}[m
[31m-[m
[31m-float FinderPatternFinder::distance(Ref<ResultPoint> p1, Ref<ResultPoint> p2) {[m
[31m-  float dx = p1->getX() - p2->getX();[m
[31m-  float dy = p1->getY() - p2->getY();[m
[31m-  return (float)sqrt(dx * dx + dy * dy);[m
[31m-}[m
[31m-[m
[31m-FinderPatternFinder::FinderPatternFinder(Ref<BitMatrix> image,[m
[31m-                                           Ref<ResultPointCallback>const& callback) :[m
[31m-    image_(image), possibleCenters_(), hasSkipped_(false), callback_(callback) {[m
[31m-}[m
[31m-[m
[31m-Ref<FinderPatternInfo> FinderPatternFinder::find(DecodeHints const& hints) {[m
[31m-  bool tryHarder = hints.getTryHarder();[m
[31m-[m
[31m-  size_t maxI = image_->getHeight();[m
[31m-  size_t maxJ = image_->getWidth();[m
[31m-[m
[31m-[m
[31m-  // We are looking for black/white/black/white/black modules in[m
[31m-  // 1:1:3:1:1 ratio; this tracks the number of such modules seen so far[m
[31m-[m
[31m-  // As this is used often, we use an integer array instead of vector[m
[31m-  int stateCount[5];[m
[31m-  bool done = false;[m
[31m-[m
[31m-[m
[31m-  // Let's assume that the maximum version QR Code we support takes up 1/4[m
[31m-  // the height of the image, and then account for the center being 3[m
[31m-  // modules in size. This gives the smallest number of pixels the center[m
[31m-  // could be, so skip this often. When trying harder, look for all[m
[31m-  // QR versions regardless of how dense they are.[m
[31m-  int iSkip = (3 * maxI) / (4 * MAX_MODULES);[m
[31m-  if (iSkip < MIN_SKIP || tryHarder) {[m
[31m-      iSkip = MIN_SKIP;[m
[31m-  }[m
[31m-[m
[31m-  // This is slightly faster than using the Ref. Efficiency is important here[m
[31m-  BitMatrix& matrix = *image_;[m
[31m-[m
[31m-  for (size_t i = iSkip - 1; i < maxI && !done; i += iSkip) {[m
[31m-    // Get a row of black/white values[m
[31m-[m
[31m-    stateCount[0] = 0;[m
[31m-    stateCount[1] = 0;[m
[31m-    stateCount[2] = 0;[m
[31m-    stateCount[3] = 0;[m
[31m-    stateCount[4] = 0;[m
[31m-    int currentState = 0;[m
[31m-    for (size_t j = 0; j < maxJ; j++) {[m
[31m-      if (matrix.get(j, i)) {[m
[31m-        // Black pixel[m
[31m-        if ((currentState & 1) == 1) { // Counting white pixels[m
[31m-          currentState++;[m
[31m-        }[m
[31m-        stateCount[currentState]++;[m
[31m-      } else { // White pixel[m
[31m-        if ((currentState & 1) == 0) { // Counting black pixels[m
[31m-          if (currentState == 4) { // A winner?[m
[31m-            if (foundPatternCross(stateCount)) { // Yes[m
[31m-              bool confirmed = handlePossibleCenter(stateCount, i, j);[m
[31m-              if (confirmed) {[m
[31m-                // Start examining every other line. Checking each line turned out to be too[m
[31m-                // expensive and didn't improve performance.[m
[31m-                iSkip = 2;[m
[31m-                if (hasSkipped_) {[m
[31m-                  done = haveMultiplyConfirmedCenters();[m
[31m-                } else {[m
[31m-                  int rowSkip = findRowSkip();[m
[31m-                  if (rowSkip > stateCount[2]) {[m
[31m-                    // Skip rows between row of lower confirmed center[m
[31m-                    // and top of presumed third confirmed center[m
[31m-                    // but back up a bit to get a full chance of detecting[m
[31m-                    // it, entire width of center of finder pattern[m
[31m-[m
[31m-                    // Skip by rowSkip, but back off by stateCount[2] (size[m
[31m-                    // of last center of pattern we saw) to be conservative,[m
[31m-                    // and also back off by iSkip which is about to be[m
[31m-                    // re-added[m
[31m-                    i += rowSkip - stateCount[2] - iSkip;[m
[31m-                    j = maxJ - 1;[m
[31m-                  }[m
[31m-                }[m
[31m-              } else {[m
[31m-                stateCount[0] = stateCount[2];[m
[31m-                stateCount[1] = stateCount[3];[m
[31m-                stateCount[2] = stateCount[4];[m
[31m-                stateCount[3] = 1;[m
[31m-                stateCount[4] = 0;[m
[31m-                currentState = 3;[m
[31m-                continue;[m
[31m-              }[m
[31m-              // Clear state to start looking again[m
[31m-              currentState = 0;[m
[31m-              stateCount[0] = 0;[m
[31m-              stateCount[1] = 0;[m
[31m-              stateCount[2] = 0;[m
[31m-              stateCount[3] = 0;[m
[31m-              stateCount[4] = 0;[m
[31m-            } else { // No, shift counts back by two[m
[31m-              stateCount[0] = stateCount[2];[m
[31m-              stateCount[1] = stateCount[3];[m
[31m-              stateCount[2] = stateCount[4];[m
[31m-              stateCount[3] = 1;[m
[31m-              stateCount[4] = 0;[m
[31m-              currentState = 3;[m
[31m-            }[m
[31m-          } else {[m
[31m-            stateCount[++currentState]++;[m
[31m-          }[m
[31m-        } else { // Counting white pixels[m
[31m-          stateCount[currentState]++;[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-    if (foundPatternCross(stateCount)) {[m
[31m-      bool confirmed = handlePossibleCenter(stateCount, i, maxJ);[m
[31m-      if (confirmed) {[m
[31m-        iSkip = stateCount[0];[m
[31m-        if (hasSkipped_) {[m
[31m-          // Found a third one[m
[31m-          done = haveMultiplyConfirmedCenters();[m
[31m-        }[m
[31m-      }[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  vector<Ref<FinderPattern> > patternInfo = selectBestPatterns();[m
[31m-  patternInfo = orderBestPatterns(patternInfo);[m
[31m-[m
[31m-  Ref<FinderPatternInfo> result(new FinderPatternInfo(patternInfo));[m
[31m-  return result;[m
[31m-}[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/detector/FinderPatternInfo.cpp[m
[31m-[m
[31m-/*[m
[31m- *  FinderPatternInfo.cpp[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Christian Brunschen on 13/05/2008.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/detector/FinderPatternInfo.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-FinderPatternInfo::FinderPatternInfo(std::vector<Ref<FinderPattern> > patternCenters) :[m
[31m-    bottomLeft_(patternCenters[0]), topLeft_(patternCenters[1]), topRight_(patternCenters[2]) {[m
[31m-}[m
[31m-[m
[31m-Ref<FinderPattern> FinderPatternInfo::getBottomLeft() {[m
[31m-  return bottomLeft_;[m
[31m-}[m
[31m-Ref<FinderPattern> FinderPatternInfo::getTopLeft() {[m
[31m-  return topLeft_;[m
[31m-}[m
[31m-Ref<FinderPattern> FinderPatternInfo::getTopRight() {[m
[31m-  return topRight_;[m
[31m-}[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-// file: zxing/qrcode/detector/QREdgeDetector.cpp[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-/*[m
[31m- *  Created by Ralf Kistner on 7/12/2009.[m
[31m- *  Copyright 2008 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/detector/QREdgeDetector.h>[m
[31m-// #include <zxing/common/EdgeDetector.h>[m
[31m-// #include <cstdlib>[m
[31m-[m
[31m-using namespace std;[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-static const float patternEdgeThreshold = 2;[m
[31m-static const int patternEdgeWidth = 3;[m
[31m-static const float patternEdgeSearchRatio = 1.1;[m
[31m-static const int patternEdgeSkip = 2;[m
[31m-[m
[31m-static const float accurateEdgeThreshold = 3.3;[m
[31m-static const int accurateEdgeWidth = 7;[m
[31m-static const int accurateEdgeSkip = 2;[m
[31m-[m
[31m-static Point guessLastPattern(Point topLeft, Point topRight, Point bottomLeft) {[m
[31m-  return Point(topRight.x - topLeft.x + bottomLeft.x, topRight.y - topLeft.y + bottomLeft.y);[m
[31m-}[m
[31m-[m
[31m-static Point rp(Ref<ResultPoint> rp) {[m
[31m-  return Point(rp->getX(), rp->getY());[m
[31m-}[m
[31m-[m
[31m-QREdgeDetector::QREdgeDetector(Ref<BitMatrix> image) : Detector(image) { }[m
[31m-[m
[31m-Ref<PerspectiveTransform> QREdgeDetector::createTransform(Ref<ResultPoint> topLeft, Ref<ResultPoint> topRight, Ref <[m
[31m-      ResultPoint > bottomLeft, Ref<ResultPoint> alignmentPattern, int dimension) {[m
[31m-[m
[31m-  if(alignmentPattern == NULL) {[m
[31m-    Point corner = findCorner(*Detector::getImage(), rp(topLeft), rp(topRight), rp(bottomLeft), dimension);[m
[31m-    return get1CornerTransform(rp(topLeft), rp(topRight), rp(bottomLeft), corner, dimension);[m
[31m-  } else {[m
[31m-    return Detector::createTransform(topLeft, topRight, bottomLeft, alignmentPattern, dimension);[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-[m
[31m-[m
[31m-[m
[31m-Point QREdgeDetector::findCorner(const BitMatrix& image, Point topLeft, Point topRight, Point bottomLeft, int dimension) {[m
[31m-  (void)dimension;[m
[31m-  Point bottomRight = guessLastPattern(topLeft, topRight, bottomLeft);[m
[31m-[m
[31m-  Line bottomEst = findPatternEdge(image, bottomLeft, topLeft, bottomRight, false);[m
[31m-  Line rightEst = findPatternEdge(image, topRight, topLeft, bottomRight, true);[m
[31m-[m
[31m-  //return EdgeDetector::intersection(bottomEst, rightEst);[m
[31m-[m
[31m-  Line bottom = EdgeDetector::findLine(image, bottomEst, false, accurateEdgeWidth, accurateEdgeThreshold, accurateEdgeSkip);[m
[31m-  Line right = EdgeDetector::findLine(image, rightEst, true, accurateEdgeWidth, accurateEdgeThreshold, accurateEdgeSkip);[m
[31m-[m
[31m-[m
[31m-  return EdgeDetector::intersection(bottom, right);[m
[31m-}[m
[31m-[m
[31m-Line QREdgeDetector::findPatternEdge(const BitMatrix& image, Point pattern, Point opposite, Point direction, bool invert) {[m
[31m-  Point start = endOfReverseBlackWhiteBlackRun(image, pattern, opposite);[m
[31m-[m
[31m-  float dx = pattern.x - start.x;[m
[31m-  float dy = pattern.y - start.y;[m
[31m-  float dist = sqrt(dx*dx + dy*dy);[m
[31m-[m
[31m-  float dirX = direction.x - pattern.x;[m
[31m-  float dirY = direction.y - pattern.y;[m
[31m-  float dirSize = sqrt(dirX*dirX + dirY*dirY);[m
[31m-[m
[31m-  float nx = dirX/dirSize;[m
[31m-  float ny = dirY/dirSize;[m
[31m-[m
[31m-  float search = dist * patternEdgeSearchRatio;[m
[31m-  Point a(start.x + nx*search, start.y + ny*search);[m
[31m-  Point b(start.x - nx*search, start.y - ny*search);[m
[31m-[m
[31m-  return EdgeDetector::findLine(image, Line(a, b), invert, patternEdgeWidth, patternEdgeThreshold, patternEdgeSkip);[m
[31m-}[m
[31m-[m
[31m-[m
[31m-Ref<PerspectiveTransform> QREdgeDetector::get1CornerTransform(Point topLeft, Point topRight, Point bottomLeft, Point corner, int dimension) {[m
[31m-  float dimMinusThree = (float) dimension - 3.5f;[m
[31m-[m
[31m-  Ref<PerspectiveTransform> transform(PerspectiveTransform::quadrilateralToQuadrilateral(3.5f, 3.5f, dimMinusThree, 3.5f, dimension,[m
[31m-                                      dimension, 3.5f, dimMinusThree, topLeft.x, topLeft.y, topRight.x,[m
[31m-                                      topRight.y, corner.x, corner.y, bottomLeft.x, bottomLeft.y));[m
[31m-[m
[31m-  return transform;[m
[31m-}[m
[31m-[m
[31m-// Adapted from "sizeOfBlackWhiteBlackRun" in zxing::qrcode::Detector[m
[31m-Point QREdgeDetector::endOfReverseBlackWhiteBlackRun(const BitMatrix& image, Point from, Point to) {[m
[31m-  int fromX = (int)from.x;[m
[31m-  int fromY = (int)from.y;[m
[31m-  int toX = (int)to.x;[m
[31m-  int toY = (int)to.y;[m
[31m-[m
[31m-  bool steep = abs(toY - fromY) > abs(toX - fromX);[m
[31m-  if (steep) {[m
[31m-    int temp = fromX;[m
[31m-    fromX = fromY;[m
[31m-    fromY = temp;[m
[31m-    temp = toX;[m
[31m-    toX = toY;[m
[31m-    toY = temp;[m
[31m-  }[m
[31m-[m
[31m-  int dx = abs(toX - fromX);[m
[31m-  int dy = abs(toY - fromY);[m
[31m-  int error = -dx >> 1;[m
[31m-  int ystep = fromY < toY ? -1 : 1;[m
[31m-  int xstep = fromX < toX ? -1 : 1;[m
[31m-  int state = 0; // In black pixels, looking for white, first or second time[m
[31m-[m
[31m-  // In case there are no points, prepopulate to from[m
[31m-  int realX = fromX;[m
[31m-  int realY = fromY;[m
[31m-  for (int x = fromX, y = fromY; x != toX; x += xstep) {[m
[31m-    realX = steep ? y : x;[m
[31m-    realY = steep ? x : y;[m
[31m-[m
[31m-    if(realX < 0 || realY < 0 || realX >= (int)image.getWidth() || realY >= (int)image.getHeight())[m
[31m-      break;[m
[31m-[m
[31m-    if (state == 1) { // In white pixels, looking for black[m
[31m-      if (image.get(realX, realY)) {[m
[31m-        state++;[m
[31m-      }[m
[31m-    } else {[m
[31m-      if (!image.get(realX, realY)) {[m
[31m-        state++;[m
[31m-      }[m
[31m-    }[m
[31m-[m
[31m-    if (state == 3) { // Found black, white, black, and stumbled back onto white; done[m
[31m-      return Point(realX, realY);[m
[31m-    }[m
[31m-    error += dy;[m
[31m-    if (error > 0) {[m
[31m-      y += ystep;[m
[31m-      error -= dx;[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  // B-W-B run not found, return the last point visited.[m
[31m-  return Point(realX, realY);[m
[31m-}[m
[31m-[m
[31m-} // namespace qrcode[m
[31m-} // namespace zxing[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/ios/zxing-all-in-one.h b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/ios/zxing-all-in-one.h[m
[1mdeleted file mode 100755[m
[1mindex 2718ca9..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/ios/zxing-all-in-one.h[m
[1m+++ /dev/null[m
[36m@@ -1,5007 +0,0 @@[m
[31m-#include <map>[m
[31m-#include <exception>[m
[31m-#include <algorithm>[m
[31m-#include <typeinfo>[m
[31m-#include <string>[m
[31m-#include <limits>[m
[31m-#include <limits.h>[m
[31m-#include <sstream>[m
[31m-#include <cstdarg>[m
[31m-#include <math.h>[m
[31m-#include <vector>[m
[31m-#include <cmath>[m
[31m-#include <string.h>[m
[31m-#include <memory>[m
[31m-#include <cstdlib>[m
[31m-#include <iostream>[m
[31m-#include <stdlib.h>[m
[31m-#include <iconv.h>[m
[31m-[m
[31m-// file: zxing/Exception.h[m
[31m-[m
[31m-#ifndef __EXCEPTION_H__[m
[31m-// #define __EXCEPTION_H__[m
[31m-[m
[31m-/*[m
[31m- *  Exception.h[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <string>[m
[31m-// #include <exception>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class Exception : public std::exception {[m
[31m-private:[m
[31m-  std::string message;[m
[31m-[m
[31m-public:[m
[31m-  Exception();[m
[31m-  Exception(const char *msg);[m
[31m-  virtual const char* what() const throw();[m
[31m-  virtual ~Exception() throw();[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-#endif // __EXCEPTION_H__[m
[31m-[m
[31m-// file: zxing/common/IllegalArgumentException.h[m
[31m-[m
[31m-#ifndef __ILLEGAL_ARGUMENT_EXCEPTION_H__[m
[31m-// #define __ILLEGAL_ARGUMENT_EXCEPTION_H__[m
[31m-[m
[31m-/*[m
[31m- *  IllegalArgumentException.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/Exception.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-class IllegalArgumentException : public zxing::Exception {[m
[31m-public:[m
[31m-  IllegalArgumentException(const char *msg);[m
[31m-  ~IllegalArgumentException() throw();[m
[31m-};[m
[31m-}[m
[31m-[m
[31m-#endif // __ILLEGAL_ARGUMENT_EXCEPTION_H__[m
[31m-[m
[31m-// file: zxing/common/Counted.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __COUNTED_H__[m
[31m-// #define __COUNTED_H__[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-//#define DEBUG_COUNTING[m
[31m-[m
[31m-// #include <iostream>[m
[31m-[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-// #include <typeinfo>[m
[31m-#endif[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-/* base class for reference-counted objects */[m
[31m-class Counted {[m
[31m-private:[m
[31m-  unsigned int count_;[m
[31m-public:[m
[31m-  Counted() :[m
[31m-      count_(0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "instantiating " << typeid(*this).name() << " " << this <<[m
[31m-         " @ " << count_ << "\n";[m
[31m-#endif[m
[31m-  }[m
[31m-  virtual ~Counted() {[m
[31m-  }[m
[31m-  Counted *retain() {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "retaining " << typeid(*this).name() << " " << this <<[m
[31m-         " @ " << count_;[m
[31m-#endif[m
[31m-    count_++;[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "->" << count_ << "\n";[m
[31m-#endif[m
[31m-    return this;[m
[31m-  }[m
[31m-  void release() {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "releasing " << typeid(*this).name() << " " << this <<[m
[31m-         " @ " << count_;[m
[31m-#endif[m
[31m-    if (count_ == 0 || count_ == 54321) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-      cout << "\nOverreleasing already-deleted object " << this << "!!!\n";[m
[31m-#endif[m
[31m-      throw 4711;[m
[31m-    }[m
[31m-    count_--;[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "->" << count_ << "\n";[m
[31m-#endif[m
[31m-    if (count_ == 0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-      cout << "deleting " << typeid(*this).name() << " " << this << "\n";[m
[31m-#endif[m
[31m-      count_ = 0xDEADF001;[m
[31m-      delete this;[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-[m
[31m-  /* return the current count for denugging purposes or similar */[m
[31m-  int count() const {[m
[31m-    return count_;[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-/* counting reference to reference-counted objects */[m
[31m-template<typename T> class Ref {[m
[31m-private:[m
[31m-public:[m
[31m-  T *object_;[m
[31m-  explicit Ref(T *o = 0) :[m
[31m-      object_(0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "instantiating Ref " << this << " from pointer" << o << "\n";[m
[31m-#endif[m
[31m-    reset(o);[m
[31m-  }[m
[31m-[m
[31m-  explicit Ref(const T &o) :[m
[31m-      object_(0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "instantiating Ref " << this << " from reference\n";[m
[31m-#endif[m
[31m-    reset(const_cast<T *>(&o));[m
[31m-  }[m
[31m-[m
[31m-  Ref(const Ref &other) :[m
[31m-      object_(0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "instantiating Ref " << this << " from Ref " << &other << "\n";[m
[31m-#endif[m
[31m-    reset(other.object_);[m
[31m-  }[m
[31m-[m
[31m-  template<class Y>[m
[31m-  Ref(const Ref<Y> &other) :[m
[31m-      object_(0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "instantiating Ref " << this << " from reference\n";[m
[31m-#endif[m
[31m-    reset(other.object_);[m
[31m-  }[m
[31m-[m
[31m-  ~Ref() {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "destroying Ref " << this << " with " <<[m
[31m-         (object_ ? typeid(*object_).name() : "NULL") << " " << object_ << "\n";[m
[31m-#endif[m
[31m-    if (object_) {[m
[31m-      object_->release();[m
[31m-    }[m
[31m-  }[m
[31m-[m
[31m-  void reset(T *o) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "resetting Ref " << this << " from " <<[m
[31m-         (object_ ? typeid(*object_).name() : "NULL") << " " << object_ <<[m
[31m-         " to " << (o ? typeid(*o).name() : "NULL") << " " << o << "\n";[m
[31m-#endif[m
[31m-    if (o) {[m
[31m-      o->retain();[m
[31m-    }[m
[31m-    if (object_ != 0) {[m
[31m-      object_->release();[m
[31m-    }[m
[31m-    object_ = o;[m
[31m-  }[m
[31m-  Ref& operator=(const Ref &other) {[m
[31m-    reset(other.object_);[m
[31m-    return *this;[m
[31m-  }[m
[31m-  template<class Y>[m
[31m-  Ref& operator=(const Ref<Y> &other) {[m
[31m-    reset(other.object_);[m
[31m-    return *this;[m
[31m-  }[m
[31m-  Ref& operator=(T* o) {[m
[31m-    reset(o);[m
[31m-    return *this;[m
[31m-  }[m
[31m-  template<class Y>[m
[31m-  Ref& operator=(Y* o) {[m
[31m-    reset(o);[m
[31m-    return *this;[m
[31m-  }[m
[31m-[m
[31m-  T& operator*() {[m
[31m-    return *object_;[m
[31m-  }[m
[31m-  T* operator->() const {[m
[31m-    return object_;[m
[31m-  }[m
[31m-  operator T*() const {[m
[31m-    return object_;[m
[31m-  }[m
[31m-[m
[31m-  bool operator==(const T* that) {[m
[31m-    return object_ == that;[m
[31m-  }[m
[31m-  bool operator==(const Ref &other) const {[m
[31m-    return object_ == other.object_ || *object_ == *(other.object_);[m
[31m-  }[m
[31m-  template<class Y>[m
[31m-  bool operator==(const Ref<Y> &other) const {[m
[31m-    return object_ == other.object_ || *object_ == *(other.object_);[m
[31m-  }[m
[31m-[m
[31m-  bool operator!=(const T* that) {[m
[31m-    return !(*this == that);[m
[31m-  }[m
[31m-[m
[31m-  bool empty() const {[m
[31m-    return object_ == 0;[m
[31m-  }[m
[31m-[m
[31m-  template<class Y>[m
[31m-  friend std::ostream& operator<<(std::ostream &out, Ref<Y>& ref);[m
[31m-};[m
[31m-}[m
[31m-[m
[31m-#endif // __COUNTED_H__[m
[31m-[m
[31m-// file: zxing/common/BitArray.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __BIT_ARRAY_H__[m
[31m-// #define __BIT_ARRAY_H__[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/IllegalArgumentException.h>[m
[31m-// #include <vector>[m
[31m-// #include <limits>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-#define ZX_LOG_DIGITS(digits) \[m
[31m-    ((digits == 8) ? 3 : \[m
[31m-     ((digits == 16) ? 4 : \[m
[31m-      ((digits == 32) ? 5 : \[m
[31m-       ((digits == 64) ? 6 : \[m
[31m-        ((digits == 128) ? 7 : \[m
[31m-         (-1))))))[m
[31m-[m
[31m-class BitArray : public Counted {[m
[31m-private:[m
[31m-  size_t size_;[m
[31m-  std::vector<unsigned int> bits_;[m
[31m-  static const unsigned int bitsPerWord_ =[m
[31m-    std::numeric_limits<unsigned int>::digits;[m
[31m-  static const unsigned int logBits_ = ZX_LOG_DIGITS(bitsPerWord_);[m
[31m-  static const unsigned int bitsMask_ = (1 << logBits_) - 1;[m
[31m-  static size_t wordsForBits(size_t bits);[m
[31m-  explicit BitArray();[m
[31m-[m
[31m-public:[m
[31m-  BitArray(size_t size);[m
[31m-  ~BitArray();[m
[31m-  size_t getSize();[m
[31m-[m
[31m-  bool get(size_t i) {[m
[31m-    return (bits_[i >> logBits_] & (1 << (i & bitsMask_))) != 0;[m
[31m-  }[m
[31m-[m
[31m-  void set(size_t i) {[m
[31m-    bits_[i >> logBits_] |= 1 << (i & bitsMask_);[m
[31m-  }[m
[31m-[m
[31m-  void setBulk(size_t i, unsigned int newBits);[m
[31m-  void setRange(int start, int end);[m
[31m-  void clear();[m
[31m-  bool isRange(size_t start, size_t end, bool value);[m
[31m-  std::vector<unsigned int>& getBitArray();[m
[31m-  void reverse();[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif // __BIT_ARRAY_H__[m
[31m-[m
[31m-// file: zxing/common/BitMatrix.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __BIT_MATRIX_H__[m
[31m-// #define __BIT_MATRIX_H__[m
[31m-[m
[31m-/*[m
[31m- *  BitMatrix.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/BitArray.h>[m
[31m-// #include <limits>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class BitMatrix : public Counted {[m
[31m-private:[m
[31m-  size_t width_;[m
[31m-  size_t height_;[m
[31m-  size_t words_;[m
[31m-  unsigned int* bits_;[m
[31m-[m
[31m-#define ZX_LOG_DIGITS(digits) \[m
[31m-    ((digits == 8) ? 3 : \[m
[31m-     ((digits == 16) ? 4 : \[m
[31m-      ((digits == 32) ? 5 : \[m
[31m-       ((digits == 64) ? 6 : \[m
[31m-        ((digits == 128) ? 7 : \[m
[31m-         (-1))))))[m
[31m-[m
[31m-  static const unsigned int bitsPerWord =[m
[31m-    std::numeric_limits<unsigned int>::digits;[m
[31m-  static const unsigned int logBits = ZX_LOG_DIGITS(bitsPerWord);[m
[31m-  static const unsigned int bitsMask = (1 << logBits) - 1;[m
[31m-[m
[31m-public:[m
[31m-  BitMatrix(size_t dimension);[m
[31m-  BitMatrix(size_t width, size_t height);[m
[31m-[m
[31m-  ~BitMatrix();[m
[31m-[m
[31m-  bool get(size_t x, size_t y) const {[m
[31m-    size_t offset = x + width_ * y;[m
[31m-    return ((bits_[offset >> logBits] >> (offset & bitsMask)) & 0x01) != 0;[m
[31m-  }[m
[31m-[m
[31m-  void set(size_t x, size_t y) {[m
[31m-    size_t offset = x + width_ * y;[m
[31m-    bits_[offset >> logBits] |= 1 << (offset & bitsMask);[m
[31m-  }[m
[31m-[m
[31m-  void flip(size_t x, size_t y);[m
[31m-  void clear();[m
[31m-  void setRegion(size_t left, size_t top, size_t width, size_t height);[m
[31m-  Ref<BitArray> getRow(int y, Ref<BitArray> row);[m
[31m-[m
[31m-  size_t getDimension() const;[m
[31m-  size_t getWidth() const;[m
[31m-  size_t getHeight() const;[m
[31m-[m
[31m-  unsigned int* getBits() const;[m
[31m-[m
[31m-  friend std::ostream& operator<<(std::ostream &out, const BitMatrix &bm);[m
[31m-  const char *description();[m
[31m-[m
[31m-private:[m
[31m-  BitMatrix(const BitMatrix&);[m
[31m-  BitMatrix& operator =(const BitMatrix&);[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif // __BIT_MATRIX_H__[m
[31m-[m
[31m-// file: zxing/common/Array.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __ARRAY_H__[m
[31m-// #define __ARRAY_H__[m
[31m-[m
[31m-/*[m
[31m- *  Array.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <vector>[m
[31m-[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-// #include <iostream>[m
[31m-// #include <typeinfo>[m
[31m-#endif[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-template<typename T> class Array : public Counted {[m
[31m-protected:[m
[31m-public:[m
[31m-  std::vector<T> values_;[m
[31m-  Array(size_t n) :[m
[31m-      Counted(), values_(n, T()) {[m
[31m-  }[m
[31m-  Array(T *ts, size_t n) :[m
[31m-      Counted(), values_(ts, ts+n) {[m
[31m-  }[m
[31m-  Array(T v, size_t n) :[m
[31m-      Counted(), values_(n, v) {[m
[31m-  }[m
[31m-  Array(std::vector<T> &v) :[m
[31m-      Counted(), values_(v) {[m
[31m-  }[m
[31m-  Array(Array<T> &other) :[m
[31m-      Counted(), values_(other.values_) {[m
[31m-  }[m
[31m-  Array(Array<T> *other) :[m
[31m-      Counted(), values_(other->values_) {[m
[31m-  }[m
[31m-  virtual ~Array() {[m
[31m-  }[m
[31m-  Array<T>& operator=(const Array<T> &other) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "assigning values from Array " << &other << " to this Array " << this << ", ";[m
[31m-#endif[m
[31m-    values_ = other.values_;[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "new size = " << values_.size() << "\n";[m
[31m-#endif[m
[31m-    return *this;[m
[31m-  }[m
[31m-  Array<T>& operator=(const std::vector<T> &array) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "assigning values from Array " << &array << " to this Array " << this << ", ";[m
[31m-#endif[m
[31m-    values_ = array;[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "new size = " << values_.size() << "\n";[m
[31m-#endif[m
[31m-    return *this;[m
[31m-  }[m
[31m-  T operator[](size_t i) const {[m
[31m-    return values_[i];[m
[31m-  }[m
[31m-  T& operator[](size_t i) {[m
[31m-    return values_[i];[m
[31m-  }[m
[31m-  size_t size() const {[m
[31m-    return values_.size();[m
[31m-  }[m
[31m-  std::vector<T> values() const {[m
[31m-    return values_;[m
[31m-  }[m
[31m-  std::vector<T>& values() {[m
[31m-    return values_;[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-template<typename T> class ArrayRef : public Counted {[m
[31m-private:[m
[31m-public:[m
[31m-  Array<T> *array_;[m
[31m-  ArrayRef() :[m
[31m-      array_(0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "instantiating empty ArrayRef " << this << "\n";[m
[31m-#endif[m
[31m-  }[m
[31m-  ArrayRef(size_t n) :[m
[31m-      array_(0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "instantiating ArrayRef " << this << "with size " << n << "\n";[m
[31m-#endif[m
[31m-    reset(new Array<T> (n));[m
[31m-  }[m
[31m-  ArrayRef(T *ts, size_t n) :[m
[31m-      array_(0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "instantiating ArrayRef " << this << "with " << n << " elements at " << (void *)ts << "\n";[m
[31m-#endif[m
[31m-    reset(new Array<T> (ts, n));[m
[31m-  }[m
[31m-  ArrayRef(Array<T> *a) :[m
[31m-      array_(0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "instantiating ArrayRef " << this << " from pointer:\n";[m
[31m-#endif[m
[31m-    reset(a);[m
[31m-  }[m
[31m-  ArrayRef(const Array<T> &a) :[m
[31m-      array_(0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "instantiating ArrayRef " << this << " from reference to Array " << (void *)&a << ":\n";[m
[31m-#endif[m
[31m-    reset(const_cast<Array<T> *>(&a));[m
[31m-  }[m
[31m-  ArrayRef(const ArrayRef &other) :[m
[31m-      Counted(), array_(0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "instantiating ArrayRef " << this << " from ArrayRef " << &other << ":\n";[m
[31m-#endif[m
[31m-    reset(other.array_);[m
[31m-  }[m
[31m-[m
[31m-  template<class Y>[m
[31m-  ArrayRef(const ArrayRef<Y> &other) :[m
[31m-      array_(0) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "instantiating ArrayRef " << this << " from ArrayRef " << &other << ":\n";[m
[31m-#endif[m
[31m-    reset(static_cast<const Array<T> *>(other.array_));[m
[31m-  }[m
[31m-[m
[31m-  ~ArrayRef() {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "destroying ArrayRef " << this << " with " << (array_ ? typeid(*array_).name() : "NULL") << " "[m
[31m-         << array_ << "\n";[m
[31m-#endif[m
[31m-    if (array_) {[m
[31m-      array_->release();[m
[31m-    }[m
[31m-    array_ = 0;[m
[31m-  }[m
[31m-[m
[31m-  T operator[](size_t i) const {[m
[31m-    return (*array_)[i];[m
[31m-  }[m
[31m-  T& operator[](size_t i) {[m
[31m-    return (*array_)[i];[m
[31m-  }[m
[31m-  size_t size() const {[m
[31m-    return array_->size();[m
[31m-  }[m
[31m-[m
[31m-  void reset(Array<T> *a) {[m
[31m-#ifdef DEBUG_COUNTING[m
[31m-    cout << "resetting ArrayRef " << this << " from " << (array_ ? typeid(*array_).name() : "NULL") << " "[m
[31m-         << array_ << " to " << (a ? typeid(*a).name() : "NULL") << " " << a << "\n";[m
[31m-#endif[m
[31m-    if (a) {[m
[31m-      a->retain();[m
[31m-    }[m
[31m-    if (array_) {[m
[31m-      array_->release();[m
[31m-    }[m
[31m-    array_ = a;[m
[31m-  }[m
[31m-  void reset(const ArrayRef<T> &other) {[m
[31m-    reset(other.array_);[m
[31m-  }[m
[31m-  ArrayRef<T>& operator=(const ArrayRef<T> &other) {[m
[31m-    reset(other);[m
[31m-    return *this;[m
[31m-  }[m
[31m-  ArrayRef<T>& operator=(Array<T> *a) {[m
[31m-    reset(a);[m
[31m-    return *this;[m
[31m-  }[m
[31m-[m
[31m-  Array<T>& operator*() {[m
[31m-    return *array_;[m
[31m-  }[m
[31m-  Array<T>* operator->() {[m
[31m-    return array_;[m
[31m-  }[m
[31m-};[m
[31m-[m
[31m-} // namespace zxing[m
[31m-[m
[31m-#endif // __ARRAY_H__[m
[31m-[m
[31m-// file: zxing/common/Str.h[m
[31m-[m
[31m-#ifndef __STR_H__[m
[31m-// #define __STR_H__[m
[31m-[m
[31m-/*[m
[31m- *  Str.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <string>[m
[31m-// #include <iostream>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class String : public Counted {[m
[31m-private:[m
[31m-  std::string text_;[m
[31m-public:[m
[31m-  String(const std::string &text);[m
[31m-  const std::string &getText() const;[m
[31m-  friend std::ostream &operator<<(std::ostream &out, const String &s);[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif // __COMMON__STRING_H__[m
[31m-[m
[31m-// file: zxing/common/BitSource.h[m
[31m-[m
[31m-#ifndef __BIT_SOURCE_H__[m
[31m-// #define __BIT_SOURCE_H__[m
[31m-[m
[31m-/*[m
[31m- *  BitSource.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Array.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-/**[m
[31m- * <p>This provides an easy abstraction to read bits at a time from a sequence of bytes, where the[m
[31m- * number of bits read is not often a multiple of 8.</p>[m
[31m- *[m
[31m- * <p>This class is not thread-safe.</p>[m
[31m- *[m
[31m- * @author srowen@google.com (Sean Owen)[m
[31m- * @author christian.brunschen@gmail.com (Christian Brunschen)[m
[31m- */[m
[31m-class BitSource : public Counted {[m
[31m-  typedef unsigned char byte;[m
[31m-private:[m
[31m-  ArrayRef<byte> bytes_;[m
[31m-  int byteOffset_;[m
[31m-  int bitOffset_;[m
[31m-public:[m
[31m-  /**[m
[31m-   * @param bytes bytes from which this will read bits. Bits will be read from the first byte first.[m
[31m-   * Bits are read within a byte from most-significant to least-significant bit.[m
[31m-   */[m
[31m-  BitSource(ArrayRef<byte> &bytes) :[m
[31m-      bytes_(bytes), byteOffset_(0), bitOffset_(0) {[m
[31m-  }[m
[31m-[m
[31m-  int getByteOffset() {[m
[31m-    return byteOffset_;[m
[31m-  }[m
[31m-[m
[31m-  /**[m
[31m-   * @param numBits number of bits to read[m
[31m-   * @return int representing the bits read. The bits will appear as the least-significant[m
[31m-   *         bits of the int[m
[31m-   * @throws IllegalArgumentException if numBits isn't in [1,32][m
[31m-   */[m
[31m-  int readBits(int numBits);[m
[31m-[m
[31m-  /**[m
[31m-   * @return number of bits that can be read successfully[m
[31m-   */[m
[31m-  int available();[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif // __BIT_SOURCE_H__[m
[31m-[m
[31m-// file: zxing/common/DecoderResult.h[m
[31m-[m
[31m-#ifndef __DECODER_RESULT_H__[m
[31m-// #define __DECODER_RESULT_H__[m
[31m-[m
[31m-/*[m
[31m- *  DecoderResult.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <string>[m
[31m-// #include <zxing/common/Str.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class DecoderResult : public Counted {[m
[31m-private:[m
[31m-  ArrayRef<unsigned char> rawBytes_;[m
[31m-  Ref<String> text_;[m
[31m-  ArrayRef< ArrayRef<unsigned char> > byteSegments_;[m
[31m-  std::string ecLevel_;[m
[31m-[m
[31m-public:[m
[31m-  DecoderResult(ArrayRef<unsigned char> rawBytes,[m
[31m-                Ref<String> text,[m
[31m-                ArrayRef< ArrayRef<unsigned char> >& byteSegments,[m
[31m-                std::string const& ecLevel);[m
[31m-[m
[31m-  DecoderResult(ArrayRef<unsigned char> rawBytes, Ref<String> text);[m
[31m-[m
[31m-  ArrayRef<unsigned char> getRawBytes();[m
[31m-  Ref<String> getText();[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif // __DECODER_RESULT_H__[m
[31m-[m
[31m-// file: zxing/common/PerspectiveTransform.h[m
[31m-[m
[31m-#ifndef __PERSPECTIVE_TANSFORM_H__[m
[31m-// #define __PERSPECTIVE_TANSFORM_H__[m
[31m-[m
[31m-/*[m
[31m- *  PerspectiveTransform.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <vector>[m
[31m-[m
[31m-namespace zxing {[m
[31m-class PerspectiveTransform : public Counted {[m
[31m-private:[m
[31m-  float a11, a12, a13, a21, a22, a23, a31, a32, a33;[m
[31m-  PerspectiveTransform(float a11, float a21, float a31, float a12, float a22, float a32, float a13, float a23,[m
[31m-                       float a33);[m
[31m-[m
[31m-public:[m
[31m-  static Ref<PerspectiveTransform>[m
[31m-  quadrilateralToQuadrilateral(float x0, float y0, float x1, float y1, float x2, float y2, float x3, float y3,[m
[31m-                               float x0p, float y0p, float x1p, float y1p, float x2p, float y2p, float x3p, float y3p);[m
[31m-  static Ref<PerspectiveTransform> squareToQuadrilateral(float x0, float y0, float x1, float y1, float x2, float y2,[m
[31m-      float x3, float y3);[m
[31m-  static Ref<PerspectiveTransform> quadrilateralToSquare(float x0, float y0, float x1, float y1, float x2, float y2,[m
[31m-      float x3, float y3);[m
[31m-  Ref<PerspectiveTransform> buildAdjoint();[m
[31m-  Ref<PerspectiveTransform> times(Ref<PerspectiveTransform> other);[m
[31m-  void transformPoints(std::vector<float> &points);[m
[31m-[m
[31m-  friend std::ostream& operator<<(std::ostream& out, const PerspectiveTransform &pt);[m
[31m-};[m
[31m-}[m
[31m-[m
[31m-#endif // __PERSPECTIVE_TANSFORM_H__[m
[31m-[m
[31m-// file: zxing/ResultPoint.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __RESULT_POINT_H__[m
[31m-// #define __RESULT_POINT_H__[m
[31m-[m
[31m-/*[m
[31m- *  ResultPoint.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <vector>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class ResultPoint : public Counted {[m
[31m-protected:[m
[31m-  float posX_;[m
[31m-  float posY_;[m
[31m-[m
[31m-public:[m
[31m-  ResultPoint();[m
[31m-  ResultPoint(float x, float y);[m
[31m-  virtual ~ResultPoint();[m
[31m-[m
[31m-  virtual float getX() const;[m
[31m-  virtual float getY() const;[m
[31m-[m
[31m-  bool equals(Ref<ResultPoint> other);[m
[31m-[m
[31m-  static void orderBestPatterns(std::vector<Ref<ResultPoint> > &patterns);[m
[31m-  static float distance(Ref<ResultPoint> point1, Ref<ResultPoint> point2);[m
[31m-  static float distance(float x1, float x2, float y1, float y2);[m
[31m-[m
[31m-private:[m
[31m-  static float crossProductZ(Ref<ResultPoint> pointA, Ref<ResultPoint> pointB, Ref<ResultPoint> pointC);[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif // __RESULT_POINT_H__[m
[31m-[m
[31m-// file: zxing/common/DetectorResult.h[m
[31m-[m
[31m-#ifndef __DETECTOR_RESULT_H__[m
[31m-// #define __DETECTOR_RESULT_H__[m
[31m-[m
[31m-/*[m
[31m- *  DetectorResult.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <vector>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-// #include <zxing/common/PerspectiveTransform.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class DetectorResult : public Counted {[m
[31m-private:[m
[31m-  Ref<BitMatrix> bits_;[m
[31m-  std::vector<Ref<ResultPoint> > points_;[m
[31m-  Ref<PerspectiveTransform> transform_;[m
[31m-[m
[31m-public:[m
[31m-  DetectorResult(Ref<BitMatrix> bits, std::vector<Ref<ResultPoint> > points, Ref<PerspectiveTransform> transform);[m
[31m-  Ref<BitMatrix> getBits();[m
[31m-  std::vector<Ref<ResultPoint> > getPoints();[m
[31m-  Ref<PerspectiveTransform> getTransform();[m
[31m-};[m
[31m-}[m
[31m-[m
[31m-#endif // __DETECTOR_RESULT_H__[m
[31m-[m
[31m-// file: zxing/common/Point.h[m
[31m-[m
[31m-#ifndef __POINT_H__[m
[31m-// #define __POINT_H__[m
[31m-[m
[31m-/*[m
[31m- *  Point.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-namespace zxing {[m
[31m-class PointI {[m
[31m-public:[m
[31m-  int x;[m
[31m-  int y;[m
[31m-};[m
[31m-[m
[31m-class Point {[m
[31m-public:[m
[31m-  Point() : x(0.0f), y(0.0f) {};[m
[31m-  Point(float x_, float y_) : x(x_), y(y_) {};[m
[31m-[m
[31m-  float x;[m
[31m-  float y;[m
[31m-};[m
[31m-[m
[31m-class Line {[m
[31m-public:[m
[31m-  Line(Point start_, Point end_) : start(start_), end(end_) {};[m
[31m-[m
[31m-  Point start;[m
[31m-  Point end;[m
[31m-};[m
[31m-}[m
[31m-#endif // POINT_H_[m
[31m-[m
[31m-// file: zxing/common/EdgeDetector.h[m
[31m-[m
[31m-#ifndef __EDGEDETECTOR_H__[m
[31m-// #define __EDGEDETECTOR_H__[m
[31m-/*[m
[31m- *  EdgeDetector.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-[m
[31m-[m
[31m-// #include <vector>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/Point.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace EdgeDetector {[m
[31m-[m
[31m-void findEdgePoints(std::vector<Point>& points, const BitMatrix& image, Point start, Point end, bool invert, int skip, float deviation);[m
[31m-Line findLine(const BitMatrix& image, Line estimate, bool invert, int deviation, float threshold, int skip);[m
[31m-[m
[31m-Point intersection(Line a, Line b);[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-#endif /* EDGEDETECTOR_H_ */[m
[31m-[m
[31m-// file: zxing/LuminanceSource.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __LUMINANCESOURCE_H__[m
[31m-// #define __LUMINANCESOURCE_H__[m
[31m-/*[m
[31m- *  LuminanceSource.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <string.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class LuminanceSource : public Counted {[m
[31m-public:[m
[31m-  LuminanceSource();[m
[31m-  virtual ~LuminanceSource();[m
[31m-[m
[31m-  virtual int getWidth() const = 0;[m
[31m-  virtual int getHeight() const = 0;[m
[31m-[m
[31m-  // Callers take ownership of the returned memory and must call delete [] on it themselves.[m
[31m-  virtual unsigned char* getRow(int y, unsigned char* row) = 0;[m
[31m-  virtual unsigned char* getMatrix() = 0;[m
[31m-[m
[31m-  virtual bool isCropSupported() const;[m
[31m-  virtual Ref<LuminanceSource> crop(int left, int top, int width, int height);[m
[31m-[m
[31m-  virtual bool isRotateSupported() const;[m
[31m-  virtual Ref<LuminanceSource> rotateCounterClockwise();[m
[31m-[m
[31m-  operator std::string (); // should be const but don't want to make sure a[m
[31m-                           // large breaking change right now[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif /* LUMINANCESOURCE_H_ */[m
[31m-[m
[31m-// file: zxing/Binarizer.h[m
[31m-[m
[31m-#ifndef BINARIZER_H_[m
[31m-#define BINARIZER_H_[m
[31m-[m
[31m-/*[m
[31m- *  Binarizer.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/LuminanceSource.h>[m
[31m-// #include <zxing/common/BitArray.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class Binarizer : public Counted {[m
[31m- private:[m
[31m-  Ref<LuminanceSource> source_;[m
[31m-[m
[31m- public:[m
[31m-  Binarizer(Ref<LuminanceSource> source);[m
[31m-  virtual ~Binarizer();[m
[31m-[m
[31m-  virtual Ref<BitArray> getBlackRow(int y, Ref<BitArray> row) = 0;[m
[31m-  virtual Ref<BitMatrix> getBlackMatrix() = 0;[m
[31m-[m
[31m-  Ref<LuminanceSource> getLuminanceSource() const ;[m
[31m-  virtual Ref<Binarizer> createBinarizer(Ref<LuminanceSource> source) = 0;[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-#endif /* BINARIZER_H_ */[m
[31m-[m
[31m-// file: zxing/common/GlobalHistogramBinarizer.h[m
[31m-[m
[31m-#ifndef __GLOBALHISTOGRAMBINARIZER_H__[m
[31m-// #define __GLOBALHISTOGRAMBINARIZER_H__[m
[31m-/*[m
[31m- *  GlobalHistogramBinarizer.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <vector>[m
[31m-// #include <zxing/Binarizer.h>[m
[31m-// #include <zxing/common/BitArray.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-	class GlobalHistogramBinarizer : public Binarizer {[m
[31m-	 private:[m
[31m-    Ref<BitMatrix> cached_matrix_;[m
[31m-	  Ref<BitArray> cached_row_;[m
[31m-	  int cached_row_num_;[m
[31m-[m
[31m-	public:[m
[31m-		GlobalHistogramBinarizer(Ref<LuminanceSource> source);[m
[31m-		virtual ~GlobalHistogramBinarizer();[m
[31m-[m
[31m-		virtual Ref<BitArray> getBlackRow(int y, Ref<BitArray> row);[m
[31m-		virtual Ref<BitMatrix> getBlackMatrix();[m
[31m-		static int estimate(std::vector<int> &histogram);[m
[31m-		Ref<Binarizer> createBinarizer(Ref<LuminanceSource> source);[m
[31m-	};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif /* GLOBALHISTOGRAMBINARIZER_H_ */[m
[31m-[m
[31m-// file: zxing/common/GreyscaleLuminanceSource.h[m
[31m-[m
[31m-#ifndef __GREYSCALE_LUMINANCE_SOURCE__[m
[31m-#define __GREYSCALE_LUMINANCE_SOURCE__[m
[31m-/*[m
[31m- *  GreyscaleLuminanceSource.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/LuminanceSource.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class GreyscaleLuminanceSource : public LuminanceSource {[m
[31m-[m
[31m- private:[m
[31m-  unsigned char* greyData_;[m
[31m-  int dataWidth_;[m
[31m-  int dataHeight_;[m
[31m-  int left_;[m
[31m-  int top_;[m
[31m-  int width_;[m
[31m-  int height_;[m
[31m-[m
[31m- public:[m
[31m-  GreyscaleLuminanceSource(unsigned char* greyData, int dataWidth, int dataHeight, int left,[m
[31m-      int top, int width, int height);[m
[31m-[m
[31m-  unsigned char* getRow(int y, unsigned char* row);[m
[31m-  unsigned char* getMatrix();[m
[31m-[m
[31m-  bool isRotateSupported() const {[m
[31m-    return true;[m
[31m-  }[m
[31m-[m
[31m-  int getWidth() const {[m
[31m-    return width_;[m
[31m-  }[m
[31m-[m
[31m-  int getHeight() const {[m
[31m-    return height_;[m
[31m-  }[m
[31m-[m
[31m-  Ref<LuminanceSource> rotateCounterClockwise();[m
[31m-[m
[31m-};[m
[31m-[m
[31m-} /* namespace */[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/common/GreyscaleRotatedLuminanceSource.h[m
[31m-[m
[31m-#ifndef __GREYSCALE_ROTATED_LUMINANCE_SOURCE__[m
[31m-#define __GREYSCALE_ROTATED_LUMINANCE_SOURCE__[m
[31m-/*[m
[31m- *  GreyscaleRotatedLuminanceSource.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-[m
[31m-// #include <zxing/LuminanceSource.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class GreyscaleRotatedLuminanceSource : public LuminanceSource {[m
[31m- private:[m
[31m-  unsigned char* greyData_;[m
[31m-  int dataWidth_;[m
[31m-  int dataHeight_;[m
[31m-  int left_;[m
[31m-  int top_;[m
[31m-  int width_;[m
[31m-  int height_;[m
[31m-[m
[31m-public:[m
[31m-  GreyscaleRotatedLuminanceSource(unsigned char* greyData, int dataWidth, int dataHeight,[m
[31m-      int left, int top, int width, int height);[m
[31m-[m
[31m-  unsigned char* getRow(int y, unsigned char* row);[m
[31m-  unsigned char* getMatrix();[m
[31m-[m
[31m-  bool isRotateSupported() const {[m
[31m-    return false;[m
[31m-  }[m
[31m-[m
[31m-  int getWidth() const {[m
[31m-    return width_;[m
[31m-  }[m
[31m-[m
[31m-  int getHeight() const {[m
[31m-    return height_;[m
[31m-  }[m
[31m-[m
[31m-};[m
[31m-[m
[31m-} /* namespace */[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/common/GridSampler.h[m
[31m-[m
[31m-#ifndef __GRID_SAMPLER_H__[m
[31m-// #define __GRID_SAMPLER_H__[m
[31m-[m
[31m-/*[m
[31m- *  GridSampler.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/PerspectiveTransform.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-class GridSampler {[m
[31m-private:[m
[31m-  static GridSampler gridSampler;[m
[31m-  GridSampler();[m
[31m-[m
[31m-public:[m
[31m-  Ref<BitMatrix> sampleGrid(Ref<BitMatrix> image, int dimension, Ref<PerspectiveTransform> transform);[m
[31m-  Ref<BitMatrix> sampleGrid(Ref<BitMatrix> image, int dimensionX, int dimensionY, Ref<PerspectiveTransform> transform);[m
[31m-[m
[31m-  Ref<BitMatrix> sampleGrid(Ref<BitMatrix> image, int dimension, float p1ToX, float p1ToY, float p2ToX, float p2ToY,[m
[31m-                            float p3ToX, float p3ToY, float p4ToX, float p4ToY, float p1FromX, float p1FromY, float p2FromX,[m
[31m-                            float p2FromY, float p3FromX, float p3FromY, float p4FromX, float p4FromY);[m
[31m-  static void checkAndNudgePoints(Ref<BitMatrix> image, std::vector<float> &points);[m
[31m-  static GridSampler &getInstance();[m
[31m-};[m
[31m-}[m
[31m-[m
[31m-#endif // __GRID_SAMPLER_H__[m
[31m-[m
[31m-// file: zxing/common/HybridBinarizer.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __HYBRIDBINARIZER_H__[m
[31m-// #define __HYBRIDBINARIZER_H__[m
[31m-/*[m
[31m- *  HybridBinarizer.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <vector>[m
[31m-// #include <zxing/Binarizer.h>[m
[31m-// #include <zxing/common/GlobalHistogramBinarizer.h>[m
[31m-// #include <zxing/common/BitArray.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-	class HybridBinarizer : public GlobalHistogramBinarizer {[m
[31m-	 private:[m
[31m-    Ref<BitMatrix> matrix_;[m
[31m-	  Ref<BitArray> cached_row_;[m
[31m-	  int cached_row_num_;[m
[31m-[m
[31m-	public:[m
[31m-		HybridBinarizer(Ref<LuminanceSource> source);[m
[31m-		virtual ~HybridBinarizer();[m
[31m-[m
[31m-		virtual Ref<BitMatrix> getBlackMatrix();[m
[31m-		Ref<Binarizer> createBinarizer(Ref<LuminanceSource> source);[m
[31m-  private:[m
[31m-    // We'll be using one-D arrays because C++ can't dynamically allocate 2D[m
[31m-    // arrays[m
[31m-    int* calculateBlackPoints(unsigned char* luminances,[m
[31m-                              int subWidth,[m
[31m-                              int subHeight,[m
[31m-                              int width,[m
[31m-                              int height);[m
[31m-    void calculateThresholdForBlock(unsigned char* luminances,[m
[31m-                                    int subWidth,[m
[31m-                                    int subHeight,[m
[31m-                                    int width,[m
[31m-                                    int height,[m
[31m-                                    int blackPoints[],[m
[31m-                                    Ref<BitMatrix> const& matrix);[m
[31m-    void threshold8x8Block(unsigned char* luminances,[m
[31m-                           int xoffset,[m
[31m-                           int yoffset,[m
[31m-                           int threshold,[m
[31m-                           int stride,[m
[31m-                           Ref<BitMatrix> const& matrix);[m
[31m-	};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/common/reedsolomon/GF256.h[m
[31m-[m
[31m-#ifndef __GF256_H__[m
[31m-// #define __GF256_H__[m
[31m-[m
[31m-/*[m
[31m- *  GF256.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <memory>[m
[31m-// #include <vector>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-class GF256Poly;[m
[31m-[m
[31m-class GF256 {[m
[31m-  /**[m
[31m-   * <p>This class contains utility methods for performing mathematical[m
[31m-   * operations over the Galois Field GF(256). Operations use a given[m
[31m-   * primitive polynomial in calculations.</p>[m
[31m-   *[m
[31m-   * <p>Throughout this package, elements of GF(256) are represented as an[m
[31m-   * <code>int</code> for convenience and speed (but at the cost of memory).[m
[31m-   * Only the bottom 8 bits are really used.</p>[m
[31m-   *[m
[31m-   * @author srowen@google.com (Sean Owen)[m
[31m-   * @author christian.brunschen@gmail.com (Christian Brunschen)[m
[31m-   */[m
[31m-private:[m
[31m-  std::vector<int> exp_;[m
[31m-  std::vector<int> log_;[m
[31m-  Ref<GF256Poly> zero_;[m
[31m-  Ref<GF256Poly> one_;[m
[31m-[m
[31m-  GF256(int primitive);[m
[31m-[m
[31m-public:[m
[31m-  Ref<GF256Poly> getZero();[m
[31m-  Ref<GF256Poly> getOne();[m
[31m-  Ref<GF256Poly> buildMonomial(int degree, int coefficient);[m
[31m-  static int addOrSubtract(int a, int b);[m
[31m-  int exp(int a);[m
[31m-  int log(int a);[m
[31m-  int inverse(int a);[m
[31m-  int multiply(int a, int b);[m
[31m-[m
[31m-  static GF256 QR_CODE_FIELD;[m
[31m-  static GF256 DATA_MATRIX_FIELD;[m
[31m-[m
[31m-  friend std::ostream& operator<<(std::ostream& out, const GF256& field);[m
[31m-};[m
[31m-}[m
[31m-[m
[31m-#endif // __GF256_H__[m
[31m-[m
[31m-// file: zxing/common/reedsolomon/GF256Poly.h[m
[31m-[m
[31m-#ifndef __GF256_POLY_H__[m
[31m-// #define __GF256_POLY_H__[m
[31m-[m
[31m-/*[m
[31m- *  GF256Poly.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <memory>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-class GF256;[m
[31m-[m
[31m-class GF256Poly : public Counted {[m
[31m-private:[m
[31m-  GF256 &field;[m
[31m-  ArrayRef<int> coefficients;[m
[31m-  void fixCoefficients();[m
[31m-public:[m
[31m-  GF256Poly(GF256 &field, ArrayRef<int> c);[m
[31m-  ~GF256Poly();[m
[31m-[m
[31m-  int getDegree();[m
[31m-  bool isZero();[m
[31m-  int getCoefficient(int degree);[m
[31m-  int evaluateAt(int a);[m
[31m-  Ref<GF256Poly> addOrSubtract(Ref<GF256Poly> other);[m
[31m-  Ref<GF256Poly> multiply(Ref<GF256Poly> other);[m
[31m-  Ref<GF256Poly> multiply(int scalar);[m
[31m-  Ref<GF256Poly> multiplyByMonomial(int degree, int coefficient);[m
[31m-  const char *description() const;[m
[31m-  friend std::ostream& operator<<(std::ostream& out, const GF256Poly& poly);[m
[31m-[m
[31m-};[m
[31m-}[m
[31m-[m
[31m-#endif // __GF256_POLY_H__[m
[31m-[m
[31m-// file: zxing/common/reedsolomon/ReedSolomonDecoder.h[m
[31m-[m
[31m-#ifndef __REED_SOLOMON_DECODER_H__[m
[31m-// #define __REED_SOLOMON_DECODER_H__[m
[31m-[m
[31m-/*[m
[31m- *  ReedSolomonDecoder.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <memory>[m
[31m-// #include <vector>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-class GF256;[m
[31m-class GF256Poly;[m
[31m-[m
[31m-class ReedSolomonDecoder {[m
[31m-private:[m
[31m-  GF256 &field;[m
[31m-public:[m
[31m-  ReedSolomonDecoder(GF256 &fld);[m
[31m-  ~ReedSolomonDecoder();[m
[31m-  void decode(ArrayRef<int> received, int twoS);[m
[31m-private:[m
[31m-  std::vector<Ref<GF256Poly> > runEuclideanAlgorithm(Ref<GF256Poly> a, Ref<GF256Poly> b, int R);[m
[31m-  ArrayRef<int> findErrorLocations(Ref<GF256Poly> errorLocator);[m
[31m-  ArrayRef<int> findErrorMagnitudes(Ref<GF256Poly> errorEvaluator, ArrayRef<int> errorLocations, bool dataMatrix);[m
[31m-};[m
[31m-}[m
[31m-[m
[31m-#endif // __REED_SOLOMON_DECODER_H__[m
[31m-[m
[31m-// file: zxing/common/reedsolomon/ReedSolomonException.h[m
[31m-[m
[31m-#ifndef __REED_SOLOMON_EXCEPTION_H__[m
[31m-// #define __REED_SOLOMON_EXCEPTION_H__[m
[31m-[m
[31m-/*[m
[31m- *  ReedSolomonException.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/Exception.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-class ReedSolomonException : public Exception {[m
[31m-public:[m
[31m-  ReedSolomonException(const char *msg) throw();[m
[31m-  ~ReedSolomonException() throw();[m
[31m-};[m
[31m-}[m
[31m-[m
[31m-#endif // __REED_SOLOMON_EXCEPTION_H__[m
[31m-[m
[31m-// file: zxing/BarcodeFormat.h[m
[31m-[m
[31m-#ifndef __BARCODE_FORMAT_H__[m
[31m-// #define __BARCODE_FORMAT_H__[m
[31m-[m
[31m-/*[m
[31m- *  BarcodeFormat.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-	typedef enum BarcodeFormat {[m
[31m-		BarcodeFormat_None = 0,[m
[31m-		BarcodeFormat_QR_CODE,[m
[31m-		BarcodeFormat_DATA_MATRIX,[m
[31m-		BarcodeFormat_UPC_E,[m
[31m-		BarcodeFormat_UPC_A,[m
[31m-		BarcodeFormat_EAN_8,[m
[31m-		BarcodeFormat_EAN_13,[m
[31m-		BarcodeFormat_CODE_128,[m
[31m-		BarcodeFormat_CODE_39,[m
[31m-		BarcodeFormat_ITF[m
[31m-	} BarcodeFormat;[m
[31m-[m
[31m-	/* if you update the enum, please update the name in BarcodeFormat.cpp */[m
[31m-	extern const char *barcodeFormatNames[];[m
[31m-}[m
[31m-[m
[31m-#endif // __BARCODE_FORMAT_H__[m
[31m-[m
[31m-// file: zxing/BinaryBitmap.h[m
[31m-[m
[31m-#ifndef __BINARYBITMAP_H__[m
[31m-// #define __BINARYBITMAP_H__[m
[31m-[m
[31m-/*[m
[31m- *  BinaryBitmap.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/BitArray.h>[m
[31m-// #include <zxing/Binarizer.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-	class BinaryBitmap : public Counted {[m
[31m-	private:[m
[31m-		Ref<Binarizer> binarizer_;[m
[31m-		int cached_y_;[m
[31m-[m
[31m-	public:[m
[31m-		BinaryBitmap(Ref<Binarizer> binarizer);[m
[31m-		virtual ~BinaryBitmap();[m
[31m-[m
[31m-		Ref<BitArray> getBlackRow(int y, Ref<BitArray> row);[m
[31m-		Ref<BitMatrix> getBlackMatrix();[m
[31m-[m
[31m-		Ref<LuminanceSource> getLuminanceSource() const;[m
[31m-[m
[31m-		int getWidth() const;[m
[31m-		int getHeight() const;[m
[31m-[m
[31m-		bool isRotateSupported() const;[m
[31m-		Ref<BinaryBitmap> rotateCounterClockwise();[m
[31m-[m
[31m-		bool isCropSupported() const;[m
[31m-		Ref<BinaryBitmap> crop(int left, int top, int width, int height);[m
[31m-[m
[31m-	};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif /* BINARYBITMAP_H_ */[m
[31m-[m
[31m-// file: zxing/ResultPointCallback.h[m
[31m-[m
[31m-#ifndef __RESULT_POINT_CALLBACK_H__[m
[31m-// #define __RESULT_POINT_CALLBACK_H__[m
[31m-[m
[31m-/*[m
[31m- *  ResultPointCallback.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class ResultPoint;[m
[31m-[m
[31m-class ResultPointCallback : public Counted {[m
[31m-protected:[m
[31m-  ResultPointCallback() {}[m
[31m-public:[m
[31m-  virtual void foundPossibleResultPoint(ResultPoint const& point) = 0;[m
[31m-  virtual ~ResultPointCallback();[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif // __RESULT_POINT_CALLBACK_H__[m
[31m-[m
[31m-// file: zxing/DecodeHints.h[m
[31m-[m
[31m-#ifndef __DECODEHINTS_H_[m
[31m-#define __DECODEHINTS_H_[m
[31m-/*[m
[31m- *  DecodeHintType.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/BarcodeFormat.h>[m
[31m-// #include <zxing/ResultPointCallback.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-typedef unsigned int DecodeHintType;[m
[31m-[m
[31m-class DecodeHints {[m
[31m-[m
[31m- private:[m
[31m-[m
[31m-  DecodeHintType hints;[m
[31m-[m
[31m-  Ref<ResultPointCallback> callback;[m
[31m-[m
[31m- public:[m
[31m-[m
[31m-  static const DecodeHintType BARCODEFORMAT_QR_CODE_HINT = 1 << BarcodeFormat_QR_CODE;[m
[31m-  static const DecodeHintType BARCODEFORMAT_DATA_MATRIX_HINT = 1 << BarcodeFormat_DATA_MATRIX;[m
[31m-  static const DecodeHintType BARCODEFORMAT_UPC_E_HINT = 1 << BarcodeFormat_UPC_E;[m
[31m-  static const DecodeHintType BARCODEFORMAT_UPC_A_HINT = 1 << BarcodeFormat_UPC_A;[m
[31m-  static const DecodeHintType BARCODEFORMAT_EAN_8_HINT = 1 << BarcodeFormat_EAN_8;[m
[31m-  static const DecodeHintType BARCODEFORMAT_EAN_13_HINT = 1 << BarcodeFormat_EAN_13;[m
[31m-  static const DecodeHintType BARCODEFORMAT_CODE_128_HINT = 1 << BarcodeFormat_CODE_128;[m
[31m-  static const DecodeHintType BARCODEFORMAT_CODE_39_HINT = 1 << BarcodeFormat_CODE_39;[m
[31m-  static const DecodeHintType BARCODEFORMAT_ITF_HINT = 1 << BarcodeFormat_ITF;[m
[31m-  static const DecodeHintType CHARACTER_SET = 1 << 30;[m
[31m-  static const DecodeHintType TRYHARDER_HINT = 1 << 31;[m
[31m-[m
[31m-  static const DecodeHints PRODUCT_HINT;[m
[31m-  static const DecodeHints ONED_HINT;[m
[31m-  static const DecodeHints DEFAULT_HINT;[m
[31m-[m
[31m-  DecodeHints();[m
[31m-  DecodeHints(DecodeHintType init);[m
[31m-[m
[31m-  void addFormat(BarcodeFormat toadd);[m
[31m-  bool containsFormat(BarcodeFormat tocheck) const;[m
[31m-  void setTryHarder(bool toset);[m
[31m-  bool getTryHarder() const;[m
[31m-[m
[31m-  void setResultPointCallback(Ref<ResultPointCallback> const&);[m
[31m-  Ref<ResultPointCallback> getResultPointCallback() const;[m
[31m-[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/Result.h[m
[31m-[m
[31m-#ifndef __RESULT_H__[m
[31m-// #define __RESULT_H__[m
[31m-[m
[31m-/*[m
[31m- *  Result.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <string>[m
[31m-// #include <vector>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Str.h>[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-// #include <zxing/BarcodeFormat.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class Result : public Counted {[m
[31m-private:[m
[31m-  Ref<String> text_;[m
[31m-  ArrayRef<unsigned char> rawBytes_;[m
[31m-  std::vector<Ref<ResultPoint> > resultPoints_;[m
[31m-  BarcodeFormat format_;[m
[31m-[m
[31m-public:[m
[31m-  Result(Ref<String> text, ArrayRef<unsigned char> rawBytes, std::vector<Ref<ResultPoint> > resultPoints,[m
[31m-         BarcodeFormat format);[m
[31m-  ~Result();[m
[31m-  Ref<String> getText();[m
[31m-  ArrayRef<unsigned char> getRawBytes();[m
[31m-  const std::vector<Ref<ResultPoint> >& getResultPoints() const;[m
[31m-  std::vector<Ref<ResultPoint> >& getResultPoints();[m
[31m-  BarcodeFormat getBarcodeFormat() const;[m
[31m-[m
[31m-  friend std::ostream& operator<<(std::ostream &out, Result& result);[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-#endif // __RESULT_H__[m
[31m-[m
[31m-// file: zxing/Reader.h[m
[31m-[m
[31m-#ifndef __READER_H__[m
[31m-// #define __READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  Reader.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/BinaryBitmap.h>[m
[31m-// #include <zxing/Result.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m- class Reader : public Counted {[m
[31m-  protected:[m
[31m-   Reader() {}[m
[31m-  public:[m
[31m-   virtual Ref<Result> decode(Ref<BinaryBitmap> image);[m
[31m-   virtual Ref<Result> decode(Ref<BinaryBitmap> image, DecodeHints hints) = 0;[m
[31m-   virtual ~Reader();[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-[m
[31m-#endif // __READER_H__[m
[31m-[m
[31m-// file: zxing/MultiFormatReader.h[m
[31m-[m
[31m-#ifndef __MULTI_FORMAT_READER_H__[m
[31m-// #define __MULTI_FORMAT_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  MultiFormatBarcodeReader.h[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-[m
[31m-// #include <zxing/Reader.h>[m
[31m-// #include <zxing/common/BitArray.h>[m
[31m-// #include <zxing/Result.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  class MultiFormatReader : public Reader {[m
[31m-[m
[31m-  private:[m
[31m-    Ref<Result> decodeInternal(Ref<BinaryBitmap> image);[m
[31m-[m
[31m-    std::vector<Ref<Reader> > readers_;[m
[31m-    DecodeHints hints_;[m
[31m-[m
[31m-  public:[m
[31m-    MultiFormatReader();[m
[31m-[m
[31m-    Ref<Result> decode(Ref<BinaryBitmap> image);[m
[31m-    Ref<Result> decode(Ref<BinaryBitmap> image, DecodeHints hints);[m
[31m-    Ref<Result> decodeWithState(Ref<BinaryBitmap> image);[m
[31m-    void setHints(DecodeHints hints);[m
[31m-    ~MultiFormatReader();[m
[31m-  };[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/ReaderException.h[m
[31m-[m
[31m-#ifndef __READER_EXCEPTION_H__[m
[31m-// #define __READER_EXCEPTION_H__[m
[31m-[m
[31m-/*[m
[31m- *  ReaderException.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/Exception.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class ReaderException : public Exception {[m
[31m-public:[m
[31m-  ReaderException();[m
[31m-  ReaderException(const char *msg);[m
[31m-  ~ReaderException() throw();[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-#endif // __READER_EXCEPTION_H__[m
[31m-[m
[31m-// file: zxing/datamatrix/decoder/Decoder.h[m
[31m-[m
[31m-#ifndef __DECODER_DM_H__[m
[31m-// #define __DECODER_DM_H__[m
[31m-[m
[31m-/*[m
[31m- *  Decoder.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/reedsolomon/ReedSolomonDecoder.h>[m
[31m-// #include <zxing/common/reedsolomon/GF256.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/common/DecoderResult.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-class Decoder {[m
[31m-private:[m
[31m-  ReedSolomonDecoder rsDecoder_;[m
[31m-[m
[31m-  void correctErrors(ArrayRef<unsigned char> bytes, int numDataCodewords);[m
[31m-[m
[31m-public:[m
[31m-  Decoder();[m
[31m-[m
[31m-  Ref<DecoderResult> decode(Ref<BitMatrix> bits);[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __DECODER_DM_H__[m
[31m-[m
[31m-// file: zxing/datamatrix/DataMatrixReader.h[m
[31m-[m
[31m-#ifndef __DATA_MATRIX_READER_H__[m
[31m-// #define __DATA_MATRIX_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  DataMatrixReader.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/Reader.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-// #include <zxing/datamatrix/decoder/Decoder.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-class DataMatrixReader : public Reader {[m
[31m-private:[m
[31m-  Decoder decoder_;[m
[31m-[m
[31m-public:[m
[31m-  DataMatrixReader();[m
[31m-  virtual Ref<Result> decode(Ref<BinaryBitmap> image, DecodeHints hints);[m
[31m-  virtual ~DataMatrixReader();[m
[31m-[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __DATA_MATRIX_READER_H__[m
[31m-[m
[31m-// file: zxing/datamatrix/Version.h[m
[31m-[m
[31m-#ifndef __VERSION_H__[m
[31m-// #define __VERSION_H__[m
[31m-[m
[31m-/*[m
[31m- *  Version.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <vector>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-class ECB {[m
[31m-private:[m
[31m-  int count_;[m
[31m-  int dataCodewords_;[m
[31m-public:[m
[31m-  ECB(int count, int dataCodewords);[m
[31m-  int getCount();[m
[31m-  int getDataCodewords();[m
[31m-};[m
[31m-[m
[31m-class ECBlocks {[m
[31m-private:[m
[31m-  int ecCodewords_;[m
[31m-  std::vector<ECB*> ecBlocks_;[m
[31m-public:[m
[31m-  ECBlocks(int ecCodewords, ECB *ecBlocks);[m
[31m-  ECBlocks(int ecCodewords, ECB *ecBlocks1, ECB *ecBlocks2);[m
[31m-  int getECCodewords();[m
[31m-  std::vector<ECB*>& getECBlocks();[m
[31m-  ~ECBlocks();[m
[31m-};[m
[31m-[m
[31m-class Version : public Counted {[m
[31m-private:[m
[31m-  int versionNumber_;[m
[31m-  int symbolSizeRows_;[m
[31m-  int symbolSizeColumns_;[m
[31m-  int dataRegionSizeRows_;[m
[31m-  int dataRegionSizeColumns_;[m
[31m-  ECBlocks* ecBlocks_;[m
[31m-  int totalCodewords_;[m
[31m-  Version(int versionNumber, int symbolSizeRows, int symbolSizeColumns, int dataRegionSizeRows,[m
[31m-		  int dataRegionSizeColumns, ECBlocks *ecBlocks);[m
[31m-[m
[31m-public:[m
[31m-  static std::vector<Ref<Version> > VERSIONS;[m
[31m-[m
[31m-  ~Version();[m
[31m-  int getVersionNumber();[m
[31m-  int getSymbolSizeRows();[m
[31m-  int getSymbolSizeColumns();[m
[31m-  int getDataRegionSizeRows();[m
[31m-  int getDataRegionSizeColumns();[m
[31m-  int getTotalCodewords();[m
[31m-  ECBlocks* getECBlocks();[m
[31m-  static int  buildVersions();[m
[31m-  Ref<Version> getVersionForDimensions(int numRows, int numColumns);[m
[31m-[m
[31m-private:[m
[31m-  Version(const Version&);[m
[31m-  Version & operator=(const Version&);[m
[31m-};[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __VERSION_H__[m
[31m-[m
[31m-// file: zxing/datamatrix/decoder/BitMatrixParser.h[m
[31m-[m
[31m-#ifndef __BIT_MATRIX_PARSER_DM_H__[m
[31m-// #define __BIT_MATRIX_PARSER_DM_H__[m
[31m-[m
[31m-/*[m
[31m- *  BitMatrixParser.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/datamatrix/Version.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-class BitMatrixParser : public Counted {[m
[31m-private:[m
[31m-  Ref<BitMatrix> bitMatrix_;[m
[31m-  Ref<Version> parsedVersion_;[m
[31m-  Ref<BitMatrix> readBitMatrix_;[m
[31m-[m
[31m-  int copyBit(size_t x, size_t y, int versionBits);[m
[31m-[m
[31m-public:[m
[31m-  BitMatrixParser(Ref<BitMatrix> bitMatrix);[m
[31m-  Ref<Version> readVersion(Ref<BitMatrix> bitMatrix);[m
[31m-  ArrayRef<unsigned char> readCodewords();[m
[31m-  bool readModule(int row, int column, int numRows, int numColumns);[m
[31m-[m
[31m-private:[m
[31m-  int readUtah(int row, int column, int numRows, int numColumns);[m
[31m-  int readCorner1(int numRows, int numColumns);[m
[31m-  int readCorner2(int numRows, int numColumns);[m
[31m-  int readCorner3(int numRows, int numColumns);[m
[31m-  int readCorner4(int numRows, int numColumns);[m
[31m-  Ref<BitMatrix> extractDataRegion(Ref<BitMatrix> bitMatrix);[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __BIT_MATRIX_PARSER_DM_H__[m
[31m-[m
[31m-// file: zxing/datamatrix/decoder/DataBlock.h[m
[31m-[m
[31m-#ifndef __DATA_BLOCK_DM_H__[m
[31m-// #define __DATA_BLOCK_DM_H__[m
[31m-[m
[31m-/*[m
[31m- *  DataBlock.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <vector>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/datamatrix/Version.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-class DataBlock : public Counted {[m
[31m-private:[m
[31m-  int numDataCodewords_;[m
[31m-  ArrayRef<unsigned char> codewords_;[m
[31m-[m
[31m-  DataBlock(int numDataCodewords, ArrayRef<unsigned char> codewords);[m
[31m-[m
[31m-public:[m
[31m-  static std::vector<Ref<DataBlock> > getDataBlocks(ArrayRef<unsigned char> rawCodewords, Version *version);[m
[31m-[m
[31m-  int getNumDataCodewords();[m
[31m-  ArrayRef<unsigned char> getCodewords();[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __DATA_BLOCK_DM_H__[m
[31m-[m
[31m-// file: zxing/datamatrix/decoder/DecodedBitStreamParser.h[m
[31m-[m
[31m-#ifndef __DECODED_BIT_STREAM_PARSER_DM_H__[m
[31m-// #define __DECODED_BIT_STREAM_PARSER_DM_H__[m
[31m-[m
[31m-/*[m
[31m- *  DecodedBitStreamParser.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <string>[m
[31m-// #include <sstream>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/common/BitSource.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/DecoderResult.h>[m
[31m-[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-class DecodedBitStreamParser {[m
[31m-private:[m
[31m-  static const int PAD_ENCODE = 0;  // Not really an encoding[m
[31m-  static const int ASCII_ENCODE = 1;[m
[31m-  static const int C40_ENCODE = 2;[m
[31m-  static const int TEXT_ENCODE = 3;[m
[31m-  static const int ANSIX12_ENCODE = 4;[m
[31m-  static const int EDIFACT_ENCODE = 5;[m
[31m-  static const int BASE256_ENCODE = 6;[m
[31m-[m
[31m-  /**[m
[31m-   * See ISO 16022:2006, Annex C Table C.1[m
[31m-   * The C40 Basic Character Set (*'s used for placeholders for the shift values)[m
[31m-   */[m
[31m-  static const char C40_BASIC_SET_CHARS[];[m
[31m-[m
[31m-  static const char C40_SHIFT2_SET_CHARS[];[m
[31m-  /**[m
[31m-   * See ISO 16022:2006, Annex C Table C.2[m
[31m-   * The Text Basic Character Set (*'s used for placeholders for the shift values)[m
[31m-   */[m
[31m-  static const char TEXT_BASIC_SET_CHARS[];[m
[31m-[m
[31m-  static const char TEXT_SHIFT3_SET_CHARS[];[m
[31m-  /**[m
[31m-   * See ISO 16022:2006, 5.2.3 and Annex C, Table C.2[m
[31m-   */[m
[31m-  int decodeAsciiSegment(Ref<BitSource> bits, std::ostringstream &result, std::ostringstream &resultTrailer);[m
[31m-  /**[m
[31m-   * See ISO 16022:2006, 5.2.5 and Annex C, Table C.1[m
[31m-   */[m
[31m-  void decodeC40Segment(Ref<BitSource> bits, std::ostringstream &result);[m
[31m-  /**[m
[31m-   * See ISO 16022:2006, 5.2.6 and Annex C, Table C.2[m
[31m-   */[m
[31m-  void decodeTextSegment(Ref<BitSource> bits, std::ostringstream &result);[m
[31m-  /**[m
[31m-   * See ISO 16022:2006, 5.2.7[m
[31m-   */[m
[31m-  void decodeAnsiX12Segment(Ref<BitSource> bits, std::ostringstream &result);[m
[31m-  /**[m
[31m-   * See ISO 16022:2006, 5.2.8 and Annex C Table C.3[m
[31m-   */[m
[31m-  void decodeEdifactSegment(Ref<BitSource> bits, std::ostringstream &result);[m
[31m-  /**[m
[31m-   * See ISO 16022:2006, 5.2.9 and Annex B, B.2[m
[31m-   */[m
[31m-  void decodeBase256Segment(Ref<BitSource> bits, std::ostringstream &result, std::vector<unsigned char> byteSegments);[m
[31m-[m
[31m-  void parseTwoBytes(int firstByte, int secondByte, int*& result);[m
[31m-  /**[m
[31m-   * See ISO 16022:2006, Annex B, B.2[m
[31m-   */[m
[31m-  unsigned char unrandomize255State(int randomizedBase256Codeword,[m
[31m-                                          int base256CodewordPosition) {[m
[31m-    int pseudoRandomNumber = ((149 * base256CodewordPosition) % 255) + 1;[m
[31m-    int tempVariable = randomizedBase256Codeword - pseudoRandomNumber;[m
[31m-    return (unsigned char) (tempVariable >= 0 ? tempVariable : (tempVariable + 256));[m
[31m-  };[m
[31m-  void append(std::ostream &ost, const unsigned char *bufIn, size_t nIn, const char *src);[m
[31m-[m
[31m-public:[m
[31m-  DecodedBitStreamParser() { };[m
[31m-  Ref<DecoderResult> decode(ArrayRef<unsigned char> bytes);[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __DECODED_BIT_STREAM_PARSER_DM_H__[m
[31m-[m
[31m-// file: zxing/datamatrix/detector/CornerPoint.h[m
[31m-[m
[31m-#ifndef __CORNER_FINDER_H__[m
[31m-// #define __CORNER_FINDER_H__[m
[31m-[m
[31m-/*[m
[31m- *  CornerPoint.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-// #include <cmath>[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace datamatrix {[m
[31m-[m
[31m-		class CornerPoint : public ResultPoint {[m
[31m-		private:[m
[31m-			int counter_;[m
[31m-[m
[31m-		public:[m
[31m-			CornerPoint(float posX, float posY);[m
[31m-			int getCount() const;[m
[31m-			void incrementCount();[m
[31m-			bool equals(Ref<CornerPoint> other) const;[m
[31m-		};[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-#endif // __CORNER_FINDER_H__[m
[31m-[m
[31m-// file: zxing/datamatrix/detector/MonochromeRectangleDetector.h[m
[31m-[m
[31m-#ifndef __MONOCHROMERECTANGLEDETECTOR_H__[m
[31m-// #define __MONOCHROMERECTANGLEDETECTOR_H__[m
[31m-[m
[31m-/*[m
[31m- *  MonochromeRectangleDetector.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <vector>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/datamatrix/detector/CornerPoint.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-struct TwoInts: public Counted {[m
[31m-	int start;[m
[31m-	int end;[m
[31m-};[m
[31m-[m
[31m-class MonochromeRectangleDetector : public Counted {[m
[31m-private:[m
[31m-  static const int MAX_MODULES = 32;[m
[31m-  Ref<BitMatrix> image_;[m
[31m-[m
[31m-public:[m
[31m-  MonochromeRectangleDetector(Ref<BitMatrix> image) : image_(image) {  };[m
[31m-[m
[31m-  std::vector<Ref<CornerPoint> > detect();[m
[31m-[m
[31m-private:[m
[31m-  Ref<CornerPoint> findCornerFromCenter(int centerX, int deltaX, int left, int right,[m
[31m-      int centerY, int deltaY, int top, int bottom, int maxWhiteRun);[m
[31m-[m
[31m-  Ref<TwoInts> blackWhiteRange(int fixedDimension, int maxWhiteRun, int minDim, int maxDim,[m
[31m-      bool horizontal);[m
[31m-[m
[31m-  int max(int a, float b) { return (float) a > b ? a : (int) b;};[m
[31m-};[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __MONOCHROMERECTANGLEDETECTOR_H__[m
[31m-[m
[31m-// file: zxing/datamatrix/detector/Detector.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __DETECTOR_H__[m
[31m-// #define __DETECTOR_H__[m
[31m-[m
[31m-/*[m
[31m- *  Detector.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/DetectorResult.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/PerspectiveTransform.h>[m
[31m-// #include <zxing/common/detector/WhiteRectangleDetector.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-class ResultPointsAndTransitions: public Counted {[m
[31m-  private:[m
[31m-    Ref<ResultPoint> to_;[m
[31m-    Ref<ResultPoint> from_;[m
[31m-    int transitions_;[m
[31m-[m
[31m-  public:[m
[31m-    ResultPointsAndTransitions();[m
[31m-    ResultPointsAndTransitions(Ref<ResultPoint> from, Ref<ResultPoint> to, int transitions);[m
[31m-    Ref<ResultPoint> getFrom();[m
[31m-    Ref<ResultPoint> getTo();[m
[31m-    int getTransitions();[m
[31m-};[m
[31m-[m
[31m-class Detector: public Counted {[m
[31m-  private:[m
[31m-    Ref<BitMatrix> image_;[m
[31m-[m
[31m-  protected:[m
[31m-    Ref<BitMatrix> sampleGrid(Ref<BitMatrix> image, int dimensionX, int dimensionY,[m
[31m-        Ref<PerspectiveTransform> transform);[m
[31m-[m
[31m-    void insertionSort(std::vector<Ref<ResultPointsAndTransitions> >& vector);[m
[31m-[m
[31m-    Ref<ResultPoint> correctTopRightRectangular(Ref<ResultPoint> bottomLeft,[m
[31m-        Ref<ResultPoint> bottomRight, Ref<ResultPoint> topLeft, Ref<ResultPoint> topRight,[m
[31m-        int dimensionTop, int dimensionRight);[m
[31m-    Ref<ResultPoint> correctTopRight(Ref<ResultPoint> bottomLeft, Ref<ResultPoint> bottomRight,[m
[31m-        Ref<ResultPoint> topLeft, Ref<ResultPoint> topRight, int dimension);[m
[31m-    bool isValid(Ref<ResultPoint> p);[m
[31m-    int distance(Ref<ResultPoint> a, Ref<ResultPoint> b);[m
[31m-    Ref<ResultPointsAndTransitions> transitionsBetween(Ref<ResultPoint> from, Ref<ResultPoint> to);[m
[31m-    int min(int a, int b) {[m
[31m-      return a > b ? b : a;[m
[31m-    }[m
[31m-    /**[m
[31m-     * Ends up being a bit faster than round(). This merely rounds its[m
[31m-     * argument to the nearest int, where x.5 rounds up.[m
[31m-     */[m
[31m-    int round(float d) {[m
[31m-      return (int) (d + 0.5f);[m
[31m-    }[m
[31m-[m
[31m-  public:[m
[31m-    Ref<BitMatrix> getImage();[m
[31m-    Detector(Ref<BitMatrix> image);[m
[31m-[m
[31m-    virtual Ref<PerspectiveTransform> createTransform(Ref<ResultPoint> topLeft,[m
[31m-        Ref<ResultPoint> topRight, Ref<ResultPoint> bottomLeft, Ref<ResultPoint> bottomRight,[m
[31m-        int dimensionX, int dimensionY);[m
[31m-[m
[31m-    Ref<DetectorResult> detect();[m
[31m-[m
[31m-  private:[m
[31m-    int compare(Ref<ResultPointsAndTransitions> a, Ref<ResultPointsAndTransitions> b);[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __DETECTOR_H__[m
[31m-[m
[31m-// file: zxing/oned/OneDReader.h[m
[31m-[m
[31m-#ifndef __ONED_READER_H__[m
[31m-// #define __ONED_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  OneDReader.h[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/Reader.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace oned {[m
[31m-		class OneDReader : public Reader {[m
[31m-		private:[m
[31m-			static const int INTEGER_MATH_SHIFT = 8;[m
[31m-[m
[31m-			Ref<Result> doDecode(Ref<BinaryBitmap> image, DecodeHints hints);[m
[31m-		public:[m
[31m-			static const int PATTERN_MATCH_RESULT_SCALE_FACTOR = 1 << INTEGER_MATH_SHIFT;[m
[31m-[m
[31m-			OneDReader();[m
[31m-			virtual Ref<Result> decode(Ref<BinaryBitmap> image, DecodeHints hints);[m
[31m-[m
[31m-			// Implementations must not throw any exceptions. If a barcode is not found on this row,[m
[31m-			// a empty ref should be returned e.g. return Ref<Result>();[m
[31m-			virtual Ref<Result> decodeRow(int rowNumber, Ref<BitArray> row) = 0;[m
[31m-[m
[31m-			static unsigned int patternMatchVariance(int counters[], int countersSize,[m
[31m-			    const int pattern[], int maxIndividualVariance);[m
[31m-			static bool recordPattern(Ref<BitArray> row, int start, int counters[], int countersCount);[m
[31m-			virtual ~OneDReader();[m
[31m-		};[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/oned/Code128Reader.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __CODE_128_READER_H__[m
[31m-// #define __CODE_128_READER_H__[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/oned/OneDReader.h>[m
[31m-// #include <zxing/common/BitArray.h>[m
[31m-// #include <zxing/Result.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace oned {[m
[31m-		class Code128Reader : public OneDReader {[m
[31m-[m
[31m-		private:[m
[31m-      enum {MAX_AVG_VARIANCE = (unsigned int) (PATTERN_MATCH_RESULT_SCALE_FACTOR * 250/1000)};[m
[31m-      enum {MAX_INDIVIDUAL_VARIANCE = (int) (PATTERN_MATCH_RESULT_SCALE_FACTOR * 700/1000)};[m
[31m-			static const int CODE_SHIFT = 98;[m
[31m-[m
[31m-			static const int CODE_CODE_C = 99;[m
[31m-			static const int CODE_CODE_B = 100;[m
[31m-			static const int CODE_CODE_A = 101;[m
[31m-[m
[31m-			static const int CODE_FNC_1 = 102;[m
[31m-			static const int CODE_FNC_2 = 97;[m
[31m-			static const int CODE_FNC_3 = 96;[m
[31m-			static const int CODE_FNC_4_A = 101;[m
[31m-			static const int CODE_FNC_4_B = 100;[m
[31m-[m
[31m-			static const int CODE_START_A = 103;[m
[31m-			static const int CODE_START_B = 104;[m
[31m-			static const int CODE_START_C = 105;[m
[31m-			static const int CODE_STOP = 106;[m
[31m-[m
[31m-			static int* findStartPattern(Ref<BitArray> row);[m
[31m-			static int decodeCode(Ref<BitArray> row, int counters[], int countersCount, int rowOffset);[m
[31m-[m
[31m-			void append(char* s, char c);[m
[31m-		public:[m
[31m-			Ref<Result> decodeRow(int rowNumber, Ref<BitArray> row);[m
[31m-			Code128Reader();[m
[31m-			~Code128Reader();[m
[31m-		};[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/oned/Code39Reader.h[m
[31m-[m
[31m-#ifndef __CODE_39_READER_H__[m
[31m-// #define __CODE_39_READER_H__[m
[31m-/*[m
[31m- *  Code39Reader.h[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/oned/OneDReader.h>[m
[31m-// #include <zxing/common/BitArray.h>[m
[31m-// #include <zxing/Result.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace oned {[m
[31m-[m
[31m-		/**[m
[31m-		 * <p>Decodes Code 39 barcodes. This does not support "Full ASCII Code 39" yet.</p>[m
[31m-		 * Ported form Java (author Sean Owen)[m
[31m-		 * @author Lukasz Warchol[m
[31m-		 */[m
[31m-		class Code39Reader : public OneDReader {[m
[31m-[m
[31m-		private:[m
[31m-			std::string alphabet_string;[m
[31m-[m
[31m-			bool usingCheckDigit;[m
[31m-			bool extendedMode;[m
[31m-[m
[31m-			static int* findAsteriskPattern(Ref<BitArray> row);														//throws ReaderException[m
[31m-			static int toNarrowWidePattern(int counters[], int countersLen);[m
[31m-			static char patternToChar(int pattern);																	//throws ReaderException[m
[31m-			static Ref<String> decodeExtended(std::string encoded);													//throws ReaderException[m
[31m-[m
[31m-			void append(char* s, char c);[m
[31m-		public:[m
[31m-			Code39Reader();[m
[31m-			Code39Reader(bool usingCheckDigit_);[m
[31m-			Code39Reader(bool usingCheckDigit_, bool extendedMode_);[m
[31m-[m
[31m-			Ref<Result> decodeRow(int rowNumber, Ref<BitArray> row);[m
[31m-    };[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/oned/UPCEANReader.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __UPC_EAN_READER_H__[m
[31m-// #define __UPC_EAN_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/oned/OneDReader.h>[m
[31m-// #include <zxing/common/BitArray.h>[m
[31m-// #include <zxing/Result.h>[m
[31m-[m
[31m-typedef enum UPC_EAN_PATTERNS {[m
[31m-	UPC_EAN_PATTERNS_L_PATTERNS = 0,[m
[31m-	UPC_EAN_PATTERNS_L_AND_G_PATTERNS[m
[31m-} UPC_EAN_PATTERNS;[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace oned {[m
[31m-		class UPCEANReader : public OneDReader {[m
[31m-[m
[31m-		private:[m
[31m-      enum {MAX_AVG_VARIANCE = (unsigned int) (PATTERN_MATCH_RESULT_SCALE_FACTOR * 420/1000)};[m
[31m-      enum {MAX_INDIVIDUAL_VARIANCE = (int) (PATTERN_MATCH_RESULT_SCALE_FACTOR * 700/1000)};[m
[31m-[m
[31m-			static bool findStartGuardPattern(Ref<BitArray> row, int* rangeStart, int* rangeEnd);[m
[31m-[m
[31m-			virtual bool decodeEnd(Ref<BitArray> row, int endStart, int* endGuardBegin, int* endGuardEnd);[m
[31m-[m
[31m-			static bool checkStandardUPCEANChecksum(std::string s);[m
[31m-		protected:[m
[31m-			static bool findGuardPattern(Ref<BitArray> row, int rowOffset, bool whiteFirst,[m
[31m-			    const int pattern[], int patternLen, int* start, int* end);[m
[31m-[m
[31m-			virtual int getMIDDLE_PATTERN_LEN();[m
[31m-			virtual const int* getMIDDLE_PATTERN();[m
[31m-[m
[31m-		public:[m
[31m-			UPCEANReader();[m
[31m-[m
[31m-      // Returns < 0 on failure, >= 0 on success.[m
[31m-			virtual int decodeMiddle(Ref<BitArray> row, int startGuardBegin, int startGuardEnd,[m
[31m-			    std::string& resultString) = 0;[m
[31m-[m
[31m-			Ref<Result> decodeRow(int rowNumber, Ref<BitArray> row);[m
[31m-[m
[31m-			// TODO(dswitkin): Should this be virtual so that UPCAReader can override it?[m
[31m-			Ref<Result> decodeRow(int rowNumber, Ref<BitArray> row, int startGuardBegin,[m
[31m-          int startGuardEnd);[m
[31m-[m
[31m-      // Returns < 0 on failure, >= 0 on success.[m
[31m-			static int decodeDigit(Ref<BitArray> row, int counters[], int countersLen, int rowOffset,[m
[31m-			    UPC_EAN_PATTERNS patternType);[m
[31m-[m
[31m-			virtual bool checkChecksum(std::string s);[m
[31m-[m
[31m-			virtual BarcodeFormat getBarcodeFormat() = 0;[m
[31m-			virtual ~UPCEANReader();[m
[31m-		};[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/oned/EAN13Reader.h[m
[31m-[m
[31m-#ifndef __EAN_13_READER_H__[m
[31m-// #define __EAN_13_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  EAN13Reader.h[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/oned/UPCEANReader.h>[m
[31m-// #include <zxing/Result.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-    class EAN13Reader : public UPCEANReader {[m
[31m-[m
[31m-    private:[m
[31m-      static bool determineFirstDigit(std::string& resultString, int lgPatternFound);[m
[31m-[m
[31m-    public:[m
[31m-      EAN13Reader();[m
[31m-[m
[31m-      int decodeMiddle(Ref<BitArray> row, int startGuardBegin, int startGuardEnd,[m
[31m-          std::string& resultString);[m
[31m-[m
[31m-      BarcodeFormat getBarcodeFormat();[m
[31m-    };[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/oned/EAN8Reader.h[m
[31m-[m
[31m-#ifndef __EAN_8_READER_H__[m
[31m-// #define __EAN_8_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  EAN8Reader.h[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/oned/UPCEANReader.h>[m
[31m-// #include <zxing/Result.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-    class EAN8Reader : public UPCEANReader {[m
[31m-[m
[31m-    public:[m
[31m-      EAN8Reader();[m
[31m-[m
[31m-      int decodeMiddle(Ref<BitArray> row, int startGuardBegin, int startGuardEnd,[m
[31m-          std::string& resultString);[m
[31m-[m
[31m-      BarcodeFormat getBarcodeFormat();[m
[31m-    };[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/oned/ITFReader.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __ITF_READER_H__[m
[31m-// #define __ITF_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/oned/OneDReader.h>[m
[31m-// #include <zxing/common/BitArray.h>[m
[31m-// #include <zxing/Result.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace oned {[m
[31m-		class ITFReader : public OneDReader {[m
[31m-[m
[31m-		private:[m
[31m-      enum {MAX_AVG_VARIANCE = (unsigned int) (PATTERN_MATCH_RESULT_SCALE_FACTOR * 420/1000)};[m
[31m-			enum {MAX_INDIVIDUAL_VARIANCE = (int) (PATTERN_MATCH_RESULT_SCALE_FACTOR * 800/1000)};[m
[31m-			// Stores the actual narrow line width of the image being decoded.[m
[31m-			int narrowLineWidth;[m
[31m-[m
[31m-			int* decodeStart(Ref<BitArray> row);																		//throws ReaderException[m
[31m-			int* decodeEnd(Ref<BitArray> row);																				//throws ReaderException[m
[31m-			static void decodeMiddle(Ref<BitArray> row, int payloadStart, int payloadEnd, std::string& resultString);	//throws ReaderException[m
[31m-			void validateQuietZone(Ref<BitArray> row, int startPattern);												//throws ReaderException[m
[31m-			static int skipWhiteSpace(Ref<BitArray> row);																//throws ReaderException[m
[31m-[m
[31m-			static int* findGuardPattern(Ref<BitArray> row, int rowOffset, const int pattern[], int patternLen);		//throws ReaderException[m
[31m-			static int decodeDigit(int counters[], int countersLen);													//throws ReaderException[m
[31m-[m
[31m-			void append(char* s, char c);[m
[31m-		public:[m
[31m-			Ref<Result> decodeRow(int rowNumber, Ref<BitArray> row);									///throws ReaderException[m
[31m-			ITFReader();[m
[31m-			~ITFReader();[m
[31m-		};[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/oned/MultiFormatOneDReader.h[m
[31m-[m
[31m-#ifndef __MULTI_FORMAT_ONED_READER_H__[m
[31m-// #define __MULTI_FORMAT_ONED_READER_H__[m
[31m-/*[m
[31m- *  MultiFormatOneDReader.h[m
[31m- *  ZXing[m
[31m- *[m
[31m-  *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/oned/OneDReader.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-    class MultiFormatOneDReader : public OneDReader {[m
[31m-[m
[31m-    private:[m
[31m-      std::vector<Ref<OneDReader> > readers;[m
[31m-    public:[m
[31m-      MultiFormatOneDReader(DecodeHints hints);[m
[31m-[m
[31m-      Ref<Result> decodeRow(int rowNumber, Ref<BitArray> row);[m
[31m-    };[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/oned/MultiFormatUPCEANReader.h[m
[31m-[m
[31m-#ifndef __MULTI_FORMAT_UPC_EAN_READER_H__[m
[31m-// #define __MULTI_FORMAT_UPC_EAN_READER_H__[m
[31m-/*[m
[31m- *  MultiFormatUPCEANReader.h[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/oned/OneDReader.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-    class MultiFormatUPCEANReader : public OneDReader {[m
[31m-[m
[31m-    private:[m
[31m-      std::vector<Ref<OneDReader> > readers;[m
[31m-    public:[m
[31m-      MultiFormatUPCEANReader(DecodeHints hints);[m
[31m-[m
[31m-      Ref<Result> decodeRow(int rowNumber, Ref<BitArray> row);[m
[31m-    };[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/oned/OneDResultPoint.h[m
[31m-[m
[31m-#ifndef __ONED_RESULT_POINT_H__[m
[31m-// #define __ONED_RESULT_POINT_H__[m
[31m-/*[m
[31m- *  OneDResultPoint.h[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-// #include <cmath>[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace oned {[m
[31m-[m
[31m-		class OneDResultPoint : public ResultPoint {[m
[31m-[m
[31m-		public:[m
[31m-			OneDResultPoint(float posX, float posY);[m
[31m-		};[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/oned/UPCAReader.h[m
[31m-[m
[31m-#ifndef __UPCA_READER_H__[m
[31m-// #define __UPCA_READER_H__[m
[31m-/*[m
[31m- *  UPCAReader.h[m
[31m- *  ZXing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/oned/EAN13Reader.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-    class UPCAReader : public UPCEANReader {[m
[31m-[m
[31m-    private:[m
[31m-      EAN13Reader ean13Reader;[m
[31m-      static Ref<Result> maybeReturnResult(Ref<Result> result);[m
[31m-[m
[31m-    public:[m
[31m-      UPCAReader();[m
[31m-[m
[31m-      int decodeMiddle(Ref<BitArray> row, int startGuardBegin, int startGuardEnd,[m
[31m-          std::string& resultString);[m
[31m-[m
[31m-      Ref<Result> decodeRow(int rowNumber, Ref<BitArray> row);[m
[31m-      Ref<Result> decodeRow(int rowNumber, Ref<BitArray> row, int startGuardBegin,[m
[31m-          int startGuardEnd);[m
[31m-      Ref<Result> decode(Ref<BinaryBitmap> image, DecodeHints hints);[m
[31m-[m
[31m-      BarcodeFormat getBarcodeFormat();[m
[31m-    };[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/oned/UPCEReader.h[m
[31m-[m
[31m-#ifndef __UPC_E_READER_H__[m
[31m-// #define __UPC_E_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/oned/UPCEANReader.h>[m
[31m-// #include <zxing/Result.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace oned {[m
[31m-    class UPCEReader : public UPCEANReader {[m
[31m-[m
[31m-    private:[m
[31m-      static bool determineNumSysAndCheckDigit(std::string& resultString, int lgPatternFound);[m
[31m-    protected:[m
[31m-      bool decodeEnd(Ref<BitArray> row, int endStart, int* endGuardBegin, int* endGuardEnd);[m
[31m-      bool checkChecksum(std::string s);[m
[31m-    public:[m
[31m-      UPCEReader();[m
[31m-[m
[31m-      int decodeMiddle(Ref<BitArray> row, int startGuardBegin, int startGuardEnd,[m
[31m-          std::string& resultString);[m
[31m-      static std::string convertUPCEtoUPCA(std::string upce);[m
[31m-[m
[31m-      BarcodeFormat getBarcodeFormat();[m
[31m-    };[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/qrcode/ErrorCorrectionLevel.h[m
[31m-[m
[31m-#ifndef __ERROR_CORRECTION_LEVEL_H__[m
[31m-// #define __ERROR_CORRECTION_LEVEL_H__[m
[31m-[m
[31m-/*[m
[31m- *  ErrorCorrectionLevel.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class ErrorCorrectionLevel {[m
[31m-private:[m
[31m-  int ordinal_;[m
[31m-  int bits_;[m
[31m-  std::string name_;[m
[31m-  ErrorCorrectionLevel(int inOrdinal, int bits, char const* name);[m
[31m-  static ErrorCorrectionLevel *FOR_BITS[];[m
[31m-  static int N_LEVELS;[m
[31m-public:[m
[31m-  static ErrorCorrectionLevel L;[m
[31m-  static ErrorCorrectionLevel M;[m
[31m-  static ErrorCorrectionLevel Q;[m
[31m-  static ErrorCorrectionLevel H;[m
[31m-[m
[31m-  int ordinal() const;[m
[31m-  int bits() const;[m
[31m-  std::string const& name() const;[m
[31m-  operator std::string const& () const;[m
[31m-[m
[31m-  static ErrorCorrectionLevel& forBits(int bits);[m
[31m-};[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __ERROR_CORRECTION_LEVEL_H__[m
[31m-[m
[31m-// file: zxing/qrcode/FormatInformation.h[m
[31m-[m
[31m-#ifndef __FORMAT_INFORMATION_H__[m
[31m-// #define __FORMAT_INFORMATION_H__[m
[31m-[m
[31m-/*[m
[31m- *  FormatInformation.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/ErrorCorrectionLevel.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <iostream>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class FormatInformation : public Counted {[m
[31m-private:[m
[31m-  static int FORMAT_INFO_MASK_QR;[m
[31m-  static int FORMAT_INFO_DECODE_LOOKUP[][2];[m
[31m-  static int N_FORMAT_INFO_DECODE_LOOKUPS;[m
[31m-  static int BITS_SET_IN_HALF_BYTE[];[m
[31m-[m
[31m-  ErrorCorrectionLevel &errorCorrectionLevel_;[m
[31m-  unsigned char dataMask_;[m
[31m-[m
[31m-  FormatInformation(int formatInfo);[m
[31m-[m
[31m-public:[m
[31m-  static int numBitsDiffering(unsigned int a, unsigned int b);[m
[31m-  static Ref<FormatInformation> decodeFormatInformation(int maskedFormatInfo1, int maskedFormatInfo2);[m
[31m-  static Ref<FormatInformation> doDecodeFormatInformation(int maskedFormatInfo1, int maskedFormatInfo2);[m
[31m-  ErrorCorrectionLevel &getErrorCorrectionLevel();[m
[31m-  unsigned char getDataMask();[m
[31m-  friend bool operator==(const FormatInformation &a, const FormatInformation &b);[m
[31m-  friend std::ostream& operator<<(std::ostream& out, const FormatInformation& fi);[m
[31m-};[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __FORMAT_INFORMATION_H__[m
[31m-[m
[31m-// file: zxing/qrcode/decoder/Decoder.h[m
[31m-[m
[31m-#ifndef __DECODER_H__[m
[31m-// #define __DECODER_H__[m
[31m-[m
[31m-/*[m
[31m- *  Decoder.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/reedsolomon/ReedSolomonDecoder.h>[m
[31m-// #include <zxing/common/reedsolomon/GF256.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/common/DecoderResult.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class Decoder {[m
[31m-private:[m
[31m-  ReedSolomonDecoder rsDecoder_;[m
[31m-[m
[31m-  void correctErrors(ArrayRef<unsigned char> bytes, int numDataCodewords);[m
[31m-[m
[31m-public:[m
[31m-  Decoder();[m
[31m-  Ref<DecoderResult> decode(Ref<BitMatrix> bits);[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __DECODER_H__[m
[31m-[m
[31m-// file: zxing/qrcode/QRCodeReader.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __QR_CODE_READER_H__[m
[31m-// #define __QR_CODE_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  QRCodeReader.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/Reader.h>[m
[31m-// #include <zxing/qrcode/decoder/Decoder.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace qrcode {[m
[31m-[m
[31m-		class QRCodeReader : public Reader {[m
[31m-		private:[m
[31m-			Decoder decoder_;[m
[31m-[m
[31m-    protected:[m
[31m-      Decoder& getDecoder();[m
[31m-[m
[31m-		public:[m
[31m-			QRCodeReader();[m
[31m-			virtual Ref<Result> decode(Ref<BinaryBitmap> image, DecodeHints hints);[m
[31m-			virtual ~QRCodeReader();[m
[31m-[m
[31m-		};[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-#endif // __QR_CODE_READER_H__[m
[31m-[m
[31m-// file: zxing/qrcode/Version.h[m
[31m-[m
[31m-#ifndef __VERSION_H__[m
[31m-// #define __VERSION_H__[m
[31m-[m
[31m-/*[m
[31m- *  Version.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/qrcode/ErrorCorrectionLevel.h>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <vector>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class ECB {[m
[31m-private:[m
[31m-  int count_;[m
[31m-  int dataCodewords_;[m
[31m-public:[m
[31m-  ECB(int count, int dataCodewords);[m
[31m-  int getCount();[m
[31m-  int getDataCodewords();[m
[31m-};[m
[31m-[m
[31m-class ECBlocks {[m
[31m-private:[m
[31m-  int ecCodewords_;[m
[31m-  std::vector<ECB*> ecBlocks_;[m
[31m-public:[m
[31m-  ECBlocks(int ecCodewords, ECB *ecBlocks);[m
[31m-  ECBlocks(int ecCodewords, ECB *ecBlocks1, ECB *ecBlocks2);[m
[31m-  int getECCodewords();[m
[31m-  std::vector<ECB*>& getECBlocks();[m
[31m-  ~ECBlocks();[m
[31m-};[m
[31m-[m
[31m-class Version : public Counted {[m
[31m-[m
[31m-private:[m
[31m-  int versionNumber_;[m
[31m-  std::vector<int> &alignmentPatternCenters_;[m
[31m-  std::vector<ECBlocks*> ecBlocks_;[m
[31m-  int totalCodewords_;[m
[31m-  Version(int versionNumber, std::vector<int> *alignmentPatternCenters, ECBlocks *ecBlocks1, ECBlocks *ecBlocks2,[m
[31m-          ECBlocks *ecBlocks3, ECBlocks *ecBlocks4);[m
[31m-[m
[31m-public:[m
[31m-  static unsigned int VERSION_DECODE_INFO[];[m
[31m-  static int N_VERSION_DECODE_INFOS;[m
[31m-  static std::vector<Ref<Version> > VERSIONS;[m
[31m-[m
[31m-  ~Version();[m
[31m-  int getVersionNumber();[m
[31m-  std::vector<int> &getAlignmentPatternCenters();[m
[31m-  int getTotalCodewords();[m
[31m-  int getDimensionForVersion();[m
[31m-  ECBlocks &getECBlocksForLevel(ErrorCorrectionLevel &ecLevel);[m
[31m-  static Version *getProvisionalVersionForDimension(int dimension);[m
[31m-  static Version *getVersionForNumber(int versionNumber);[m
[31m-  static Version *decodeVersionInformation(unsigned int versionBits);[m
[31m-  Ref<BitMatrix> buildFunctionPattern();[m
[31m-  static int buildVersions();[m
[31m-};[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __VERSION_H__[m
[31m-[m
[31m-// file: zxing/qrcode/decoder/BitMatrixParser.h[m
[31m-[m
[31m-#ifndef __BIT_MATRIX_PARSER_H__[m
[31m-// #define __BIT_MATRIX_PARSER_H__[m
[31m-[m
[31m-/*[m
[31m- *  BitMatrixParser.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/qrcode/Version.h>[m
[31m-// #include <zxing/qrcode/FormatInformation.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class BitMatrixParser : public Counted {[m
[31m-private:[m
[31m-  Ref<BitMatrix> bitMatrix_;[m
[31m-  Version *parsedVersion_;[m
[31m-  Ref<FormatInformation> parsedFormatInfo_;[m
[31m-[m
[31m-  int copyBit(size_t x, size_t y, int versionBits);[m
[31m-[m
[31m-public:[m
[31m-  BitMatrixParser(Ref<BitMatrix> bitMatrix);[m
[31m-  Ref<FormatInformation> readFormatInformation();[m
[31m-  Version *readVersion();[m
[31m-  ArrayRef<unsigned char> readCodewords();[m
[31m-[m
[31m-private:[m
[31m-  BitMatrixParser(const BitMatrixParser&);[m
[31m-  BitMatrixParser& operator =(const BitMatrixParser&);[m
[31m-[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __BIT_MATRIX_PARSER_H__[m
[31m-[m
[31m-// file: zxing/qrcode/decoder/DataBlock.h[m
[31m-[m
[31m-#ifndef __DATA_BLOCK_H__[m
[31m-// #define __DATA_BLOCK_H__[m
[31m-[m
[31m-/*[m
[31m- *  DataBlock.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <vector>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/qrcode/Version.h>[m
[31m-// #include <zxing/qrcode/ErrorCorrectionLevel.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class DataBlock : public Counted {[m
[31m-private:[m
[31m-  int numDataCodewords_;[m
[31m-  ArrayRef<unsigned char> codewords_;[m
[31m-[m
[31m-  DataBlock(int numDataCodewords, ArrayRef<unsigned char> codewords);[m
[31m-[m
[31m-public:[m
[31m-  static std::vector<Ref<DataBlock> >[m
[31m-  getDataBlocks(ArrayRef<unsigned char> rawCodewords, Version *version, ErrorCorrectionLevel &ecLevel);[m
[31m-[m
[31m-  int getNumDataCodewords();[m
[31m-  ArrayRef<unsigned char> getCodewords();[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __DATA_BLOCK_H__[m
[31m-[m
[31m-// file: zxing/qrcode/decoder/DataMask.h[m
[31m-[m
[31m-#ifndef __DATA_MASK_H__[m
[31m-// #define __DATA_MASK_H__[m
[31m-[m
[31m-/*[m
[31m- *  DataMask.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-[m
[31m-// #include <vector>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class DataMask : public Counted {[m
[31m-private:[m
[31m-  static std::vector<Ref<DataMask> > DATA_MASKS;[m
[31m-[m
[31m-protected:[m
[31m-[m
[31m-public:[m
[31m-  static int buildDataMasks();[m
[31m-  DataMask();[m
[31m-  virtual ~DataMask();[m
[31m-  void unmaskBitMatrix(BitMatrix& matrix, size_t dimension);[m
[31m-  virtual bool isMasked(size_t x, size_t y) = 0;[m
[31m-  static DataMask& forReference(int reference);[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __DATA_MASK_H__[m
[31m-[m
[31m-// file: zxing/qrcode/decoder/Mode.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __MODE_H__[m
[31m-// #define __MODE_H__[m
[31m-[m
[31m-/*[m
[31m- *  Mode.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/qrcode/Version.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class Mode {[m
[31m-private:[m
[31m-  int characterCountBitsForVersions0To9_;[m
[31m-  int characterCountBitsForVersions10To26_;[m
[31m-  int characterCountBitsForVersions27AndHigher_;[m
[31m-  int bits_;[m
[31m-  std::string name_;[m
[31m-[m
[31m-  Mode(int cbv0_9, int cbv10_26, int cbv27, int bits, char const* name);[m
[31m-[m
[31m-public:[m
[31m-  static Mode TERMINATOR;[m
[31m-  static Mode NUMERIC;[m
[31m-  static Mode ALPHANUMERIC;[m
[31m-  static Mode STRUCTURED_APPEND;[m
[31m-  static Mode BYTE;[m
[31m-  static Mode ECI;[m
[31m-  static Mode KANJI;[m
[31m-  static Mode FNC1_FIRST_POSITION;[m
[31m-  static Mode FNC1_SECOND_POSITION;[m
[31m-  static Mode HANZI;[m
[31m-[m
[31m-  static Mode& forBits(int bits);[m
[31m-  int getCharacterCountBits(Version *version);[m
[31m-};[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __MODE_H__[m
[31m-[m
[31m-// file: zxing/common/ECI.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-[m
[31m-#ifndef __ECI__[m
[31m-#define __ECI__[m
[31m-[m
[31m-/*[m
[31m- * Copyright 2008-2011 ZXing authors[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace common {[m
[31m-    class ECI;[m
[31m-  }[m
[31m-}[m
[31m-class zxing::common::ECI {[m
[31m-private:[m
[31m-  const int value;[m
[31m-[m
[31m-protected:[m
[31m-  ECI(int value);[m
[31m-[m
[31m-public:[m
[31m-  int getValue() const;[m
[31m-[m
[31m-  static ECI* getECIByValue(int value);[m
[31m-};[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/common/CharacterSetECI.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-[m
[31m-#ifndef __CHARACTERSET_ECI__[m
[31m-#define __CHARACTERSET_ECI__[m
[31m-[m
[31m-/*[m
[31m- * Copyright 2008-2011 ZXing authors[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <map>[m
[31m-// #include <zxing/common/ECI.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace common {[m
[31m-    class CharacterSetECI;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-class zxing::common::CharacterSetECI : public ECI {[m
[31m-private:[m
[31m-  static std::map<int, CharacterSetECI*> VALUE_TO_ECI;[m
[31m-  static std::map<std::string, CharacterSetECI*> NAME_TO_ECI;[m
[31m-  static const bool inited;[m
[31m-  static bool init_tables();[m
[31m-[m
[31m-  char const* const encodingName;[m
[31m-[m
[31m-  CharacterSetECI(int value, char const* encodingName);[m
[31m-[m
[31m-  static void addCharacterSet(int value, char const* encodingName);[m
[31m-  static void addCharacterSet(int value, char const* const* encodingNames);[m
[31m-[m
[31m-public:[m
[31m-  char const* getEncodingName();[m
[31m-[m
[31m-  static CharacterSetECI* getCharacterSetECIByValue(int value);[m
[31m-  static CharacterSetECI* getCharacterSetECIByName(std::string const& name);[m
[31m-};[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/qrcode/decoder/DecodedBitStreamParser.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-[m
[31m-#ifndef __DECODED_BIT_STREAM_PARSER_H__[m
[31m-// #define __DECODED_BIT_STREAM_PARSER_H__[m
[31m-[m
[31m-/*[m
[31m- *  DecodedBitStreamParser.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <string>[m
[31m-// #include <sstream>[m
[31m-// #include <map>[m
[31m-// #include <zxing/qrcode/decoder/Mode.h>[m
[31m-// #include <zxing/common/BitSource.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <zxing/common/DecoderResult.h>[m
[31m-// #include <zxing/common/CharacterSetECI.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class DecodedBitStreamParser {[m
[31m-public:[m
[31m-  typedef std::map<DecodeHintType, std::string> Hashtable;[m
[31m-[m
[31m-private:[m
[31m-  static char const ALPHANUMERIC_CHARS[];[m
[31m-  static char toAlphaNumericChar(size_t value);[m
[31m-[m
[31m-  static void decodeHanziSegment(Ref<BitSource> bits, std::string &result, int count);[m
[31m-  static void decodeKanjiSegment(Ref<BitSource> bits, std::string &result, int count);[m
[31m-  static void decodeByteSegment(Ref<BitSource> bits, std::string &result, int count);[m
[31m-  static void decodeByteSegment(Ref<BitSource> bits_,[m
[31m-                                std::string& result,[m
[31m-                                int count,[m
[31m-                                zxing::common::CharacterSetECI* currentCharacterSetECI,[m
[31m-                                ArrayRef< ArrayRef<unsigned char> >& byteSegments,[m
[31m-                                Hashtable const& hints);[m
[31m-  static void decodeAlphanumericSegment(Ref<BitSource> bits, std::string &result, int count, bool fc1InEffect);[m
[31m-  static void decodeNumericSegment(Ref<BitSource> bits, std::string &result, int count);[m
[31m-[m
[31m-  static void append(std::string &ost, const unsigned char *bufIn, size_t nIn, const char *src);[m
[31m-  static void append(std::string &ost, std::string const& in, const char *src);[m
[31m-[m
[31m-public:[m
[31m-  static Ref<DecoderResult> decode(ArrayRef<unsigned char> bytes,[m
[31m-                                   Version *version,[m
[31m-                                   ErrorCorrectionLevel const& ecLevel,[m
[31m-                                   Hashtable const& hints);[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __DECODED_BIT_STREAM_PARSER_H__[m
[31m-[m
[31m-// file: zxing/qrcode/detector/AlignmentPattern.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-[m
[31m-#ifndef __ALIGNMENT_PATTERN_H__[m
[31m-// #define __ALIGNMENT_PATTERN_H__[m
[31m-[m
[31m-/*[m
[31m- *  AlignmentPattern.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-// #include <cmath>[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace qrcode {[m
[31m-[m
[31m-		class AlignmentPattern : public ResultPoint {[m
[31m-		private:[m
[31m-			float estimatedModuleSize_;[m
[31m-[m
[31m-		public:[m
[31m-			AlignmentPattern(float posX, float posY, float estimatedModuleSize);[m
[31m-			bool aboutEquals(float moduleSize, float i, float j) const;[m
[31m-      Ref<AlignmentPattern> combineEstimate(float i, float j,[m
[31m-                                            float newModuleSize) const;[m
[31m-		};[m
[31m-[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-#endif // __ALIGNMENT_PATTERN_H__[m
[31m-[m
[31m-// file: zxing/qrcode/detector/AlignmentPatternFinder.h[m
[31m-[m
[31m-#ifndef __ALIGNMENT_PATTERN_FINDER_H__[m
[31m-// #define __ALIGNMENT_PATTERN_FINDER_H__[m
[31m-[m
[31m-/*[m
[31m- *  AlignmentPatternFinder.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include "AlignmentPattern.h"[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/ResultPointCallback.h>[m
[31m-// #include <vector>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class AlignmentPatternFinder : public Counted {[m
[31m-private:[m
[31m-  static int CENTER_QUORUM;[m
[31m-  static int MIN_SKIP;[m
[31m-  static int MAX_MODULES;[m
[31m-[m
[31m-  Ref<BitMatrix> image_;[m
[31m-  std::vector<AlignmentPattern *> *possibleCenters_;[m
[31m-  size_t startX_;[m
[31m-  size_t startY_;[m
[31m-  size_t width_;[m
[31m-  size_t height_;[m
[31m-  float moduleSize_;[m
[31m-[m
[31m-  static float centerFromEnd(std::vector<int> &stateCount, int end);[m
[31m-  bool foundPatternCross(std::vector<int> &stateCount);[m
[31m-[m
[31m-  float crossCheckVertical(size_t startI, size_t centerJ, int maxCount, int originalStateCountTotal);[m
[31m-[m
[31m-  Ref<AlignmentPattern> handlePossibleCenter(std::vector<int> &stateCount, size_t i, size_t j);[m
[31m-[m
[31m-public:[m
[31m-  AlignmentPatternFinder(Ref<BitMatrix> image, size_t startX, size_t startY, size_t width, size_t height,[m
[31m-                         float moduleSize, Ref<ResultPointCallback>const& callback);[m
[31m-  ~AlignmentPatternFinder();[m
[31m-  Ref<AlignmentPattern> find();[m
[31m-[m
[31m-private:[m
[31m-  AlignmentPatternFinder(const AlignmentPatternFinder&);[m
[31m-  AlignmentPatternFinder& operator =(const AlignmentPatternFinder&);[m
[31m-[m
[31m-  Ref<ResultPointCallback> callback_;[m
[31m-};[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __ALIGNMENT_PATTERN_FINDER_H__[m
[31m-[m
[31m-// file: zxing/qrcode/detector/FinderPattern.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-#ifndef __FINDER_PATTERN_H__[m
[31m-// #define __FINDER_PATTERN_H__[m
[31m-[m
[31m-/*[m
[31m- *  FinderPattern.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-// #include <cmath>[m
[31m-[m
[31m-namespace zxing {[m
[31m-	namespace qrcode {[m
[31m-[m
[31m-		class FinderPattern : public ResultPoint {[m
[31m-		private:[m
[31m-			float estimatedModuleSize_;[m
[31m-			int count_;[m
[31m-[m
[31m-		public:[m
[31m-			FinderPattern(float posX, float posY, float estimatedModuleSize);[m
[31m-			FinderPattern(float posX, float posY, float estimatedModuleSize, int count);[m
[31m-			int getCount() const;[m
[31m-			float getEstimatedModuleSize() const;[m
[31m-			void incrementCount();[m
[31m-			bool aboutEquals(float moduleSize, float i, float j) const;[m
[31m-			Ref<FinderPattern> combineEstimate(float i, float j, float newModuleSize) const;[m
[31m-		};[m
[31m-	}[m
[31m-}[m
[31m-[m
[31m-#endif // __FINDER_PATTERN_H__[m
[31m-[m
[31m-// file: zxing/qrcode/detector/FinderPatternInfo.h[m
[31m-[m
[31m-#ifndef __FINDER_PATTERN_INFO_H__[m
[31m-// #define __FINDER_PATTERN_INFO_H__[m
[31m-[m
[31m-/*[m
[31m- *  FinderPatternInfo.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/detector/FinderPattern.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/Array.h>[m
[31m-// #include <vector>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class FinderPatternInfo : public Counted {[m
[31m-private:[m
[31m-  Ref<FinderPattern> bottomLeft_;[m
[31m-  Ref<FinderPattern> topLeft_;[m
[31m-  Ref<FinderPattern> topRight_;[m
[31m-[m
[31m-public:[m
[31m-  FinderPatternInfo(std::vector<Ref<FinderPattern> > patternCenters);[m
[31m-[m
[31m-  Ref<FinderPattern> getBottomLeft();[m
[31m-  Ref<FinderPattern> getTopLeft();[m
[31m-  Ref<FinderPattern> getTopRight();[m
[31m-};[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __FINDER_PATTERN_INFO_H__[m
[31m-[m
[31m-// file: zxing/qrcode/detector/Detector.h[m
[31m-[m
[31m-#ifndef __DETECTOR_H__[m
[31m-// #define __DETECTOR_H__[m
[31m-[m
[31m-/*[m
[31m- *  Detector.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/DetectorResult.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/qrcode/detector/AlignmentPattern.h>[m
[31m-// #include <zxing/common/PerspectiveTransform.h>[m
[31m-// #include <zxing/ResultPointCallback.h>[m
[31m-// #include <zxing/qrcode/detector/FinderPatternInfo.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class DecodeHints;[m
[31m-[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class Detector : public Counted {[m
[31m-private:[m
[31m-  Ref<BitMatrix> image_;[m
[31m-  Ref<ResultPointCallback> callback_;[m
[31m-[m
[31m-protected:[m
[31m-  Ref<BitMatrix> getImage();[m
[31m-[m
[31m-  static Ref<BitMatrix> sampleGrid(Ref<BitMatrix> image, int dimension, Ref<PerspectiveTransform>);[m
[31m-  static int computeDimension(Ref<ResultPoint> topLeft, Ref<ResultPoint> topRight, Ref<ResultPoint> bottomLeft,[m
[31m-                              float moduleSize);[m
[31m-  float calculateModuleSize(Ref<ResultPoint> topLeft, Ref<ResultPoint> topRight, Ref<ResultPoint> bottomLeft);[m
[31m-  float calculateModuleSizeOneWay(Ref<ResultPoint> pattern, Ref<ResultPoint> otherPattern);[m
[31m-  float sizeOfBlackWhiteBlackRunBothWays(int fromX, int fromY, int toX, int toY);[m
[31m-  float sizeOfBlackWhiteBlackRun(int fromX, int fromY, int toX, int toY);[m
[31m-  Ref<AlignmentPattern> findAlignmentInRegion(float overallEstModuleSize, int estAlignmentX, int estAlignmentY,[m
[31m-      float allowanceFactor);[m
[31m-  Ref<DetectorResult> processFinderPatternInfo(Ref<FinderPatternInfo> info);[m
[31m-public:[m
[31m-[m
[31m-  virtual Ref<PerspectiveTransform> createTransform(Ref<ResultPoint> topLeft, Ref<ResultPoint> topRight, Ref <[m
[31m-      ResultPoint > bottomLeft, Ref<ResultPoint> alignmentPattern, int dimension);[m
[31m-[m
[31m-  Detector(Ref<BitMatrix> image);[m
[31m-  Ref<DetectorResult> detect(DecodeHints const& hints);[m
[31m-};[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __DETECTOR_H__[m
[31m-[m
[31m-// file: zxing/qrcode/detector/FinderPatternFinder.h[m
[31m-[m
[31m-#ifndef __FINDER_PATTERN_FINDER_H__[m
[31m-// #define __FINDER_PATTERN_FINDER_H__[m
[31m-[m
[31m-/*[m
[31m- *  FinderPatternFinder.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/detector/FinderPattern.h>[m
[31m-// #include <zxing/qrcode/detector/FinderPatternInfo.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/ResultPointCallback.h>[m
[31m-// #include <vector>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class DecodeHints;[m
[31m-[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class FinderPatternFinder {[m
[31m-private:[m
[31m-  static int CENTER_QUORUM;[m
[31m-[m
[31m-protected:[m
[31m-  static int MIN_SKIP;[m
[31m-  static int MAX_MODULES;[m
[31m-[m
[31m-  Ref<BitMatrix> image_;[m
[31m-  std::vector<Ref<FinderPattern> > possibleCenters_;[m
[31m-  bool hasSkipped_;[m
[31m-[m
[31m-  Ref<ResultPointCallback> callback_;[m
[31m-[m
[31m-  /** stateCount must be int[5] */[m
[31m-  static float centerFromEnd(int* stateCount, int end);[m
[31m-  static bool foundPatternCross(int* stateCount);[m
[31m-[m
[31m-  float crossCheckVertical(size_t startI, size_t centerJ, int maxCount, int originalStateCountTotal);[m
[31m-  float crossCheckHorizontal(size_t startJ, size_t centerI, int maxCount, int originalStateCountTotal);[m
[31m-[m
[31m-  /** stateCount must be int[5] */[m
[31m-  bool handlePossibleCenter(int* stateCount, size_t i, size_t j);[m
[31m-  int findRowSkip();[m
[31m-  bool haveMultiplyConfirmedCenters();[m
[31m-  std::vector<Ref<FinderPattern> > selectBestPatterns();[m
[31m-  static std::vector<Ref<FinderPattern> > orderBestPatterns(std::vector<Ref<FinderPattern> > patterns);[m
[31m-public:[m
[31m-  static float distance(Ref<ResultPoint> p1, Ref<ResultPoint> p2);[m
[31m-  FinderPatternFinder(Ref<BitMatrix> image, Ref<ResultPointCallback>const&);[m
[31m-  Ref<FinderPatternInfo> find(DecodeHints const& hints);[m
[31m-};[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __FINDER_PATTERN_FINDER_H__[m
[31m-[m
[31m-// file: zxing/qrcode/detector/QREdgeDetector.h[m
[31m-[m
[31m-#ifndef __QREDGEDETECTOR_H__[m
[31m-// #define __QREDGEDETECTOR_H__[m
[31m-/*[m
[31m- *  QREdgeDetector.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-[m
[31m-[m
[31m-// #include <zxing/qrcode/detector/Detector.h>[m
[31m-// #include <zxing/common/Point.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace qrcode {[m
[31m-[m
[31m-class QREdgeDetector : public Detector {[m
[31m-public:[m
[31m-  QREdgeDetector(Ref<BitMatrix> image);[m
[31m-[m
[31m-  virtual Ref<PerspectiveTransform> createTransform(Ref<ResultPoint> topLeft, Ref<ResultPoint> topRight, Ref <[m
[31m-      ResultPoint > bottomLeft, Ref<ResultPoint> alignmentPattern, int dimension);[m
[31m-[m
[31m-private:[m
[31m-  Point findCorner(const BitMatrix& image, Point topLeft, Point topRight, Point bottomLeft, int dimension);[m
[31m-  Line findPatternEdge(const BitMatrix& image, Point pattern, Point opposite, Point direction, bool invert);[m
[31m-[m
[31m-  Point endOfReverseBlackWhiteBlackRun(const BitMatrix& image, Point from, Point to);[m
[31m-[m
[31m-  Ref<PerspectiveTransform> get1CornerTransform(Point topLeft, Point topRight, Point bottomLeft, Point corner, int dimension);[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-}[m
[31m-#endif // QREDGEDETECTOR_H_[m
[31m-[m
[31m-// file: zxing/FormatException.h[m
[31m-[m
[31m-#ifndef __FORMAT_EXCEPTION_H__[m
[31m-// #define __FORMAT_EXCEPTION_H__[m
[31m-[m
[31m-/*[m
[31m- *  FormatException.h[m
[31m- *  zxing[m
[31m- *[m
[31m- *  Copyright 2010 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class FormatException : public ReaderException {[m
[31m-public:[m
[31m-  FormatException();[m
[31m-  FormatException(const char *msg);[m
[31m-  ~FormatException() throw();[m
[31m-};[m
[31m-[m
[31m-}[m
[31m-#endif // __FORMAT_EXCEPTION_H__[m
[31m-[m
[31m-// file: zxing/NotFoundException.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-[m
[31m-#ifndef __NOT_FOUND_EXCEPTION_H__[m
[31m-// #define __NOT_FOUND_EXCEPTION_H__[m
[31m-[m
[31m-/*[m
[31m- * Copyright 20011 ZXing authors[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-  class NotFoundException : public ReaderException {[m
[31m-  public:[m
[31m-    NotFoundException(const char *msg);[m
[31m-    ~NotFoundException() throw();[m
[31m-  };[m
[31m-[m
[31m-}[m
[31m-#endif // __NOT_FOUND_EXCEPTION_H__[m
[31m-[m
[31m-// file: zxing/common/StringUtils.h[m
[31m-[m
[31m-// -*- mode:c++; tab-width:2; indent-tabs-mode:nil; c-basic-offset:2 -*-[m
[31m-[m
[31m-#ifndef __STRING_UTILS__[m
[31m-#define __STRING_UTILS__[m
[31m-[m
[31m-/*[m
[31m- * Copyright (C) 2010-2011 ZXing authors[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <string>[m
[31m-// #include <map>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-  namespace common {[m
[31m-    class StringUtils;[m
[31m-  }[m
[31m-}[m
[31m-[m
[31m-class zxing::common::StringUtils {[m
[31m-private:[m
[31m-  static char const* const PLATFORM_DEFAULT_ENCODING;[m
[31m-[m
[31m-  StringUtils() {}[m
[31m-[m
[31m-public:[m
[31m-  static char const* const ASCII;[m
[31m-  static char const* const SHIFT_JIS;[m
[31m-  static char const* const GB2312;[m
[31m-  static char const* const EUC_JP;[m
[31m-  static char const* const UTF8;[m
[31m-  static char const* const ISO88591;[m
[31m-  static const bool ASSUME_SHIFT_JIS;[m
[31m-[m
[31m-  typedef std::map<DecodeHintType, std::string> Hashtable;[m
[31m-[m
[31m-  static std::string guessEncoding(unsigned char* bytes, int length, Hashtable const& hints);[m
[31m-};[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/common/detector/MonochromeRectangleDetector.h[m
[31m-[m
[31m-#ifndef __MONOCHROMERECTANGLEDETECTOR_H__[m
[31m-// #define __MONOCHROMERECTANGLEDETECTOR_H__[m
[31m-[m
[31m-/*[m
[31m- *  MonochromeRectangleDetector.h[m
[31m- *  y_wmk[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010 y_wmk authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <vector>[m
[31m-// #include <zxing/NotFoundException.h>[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-struct TwoInts: public Counted {[m
[31m-	int start;[m
[31m-	int end;[m
[31m-};[m
[31m-[m
[31m-class MonochromeRectangleDetector : public Counted {[m
[31m-private:[m
[31m-  static const int MAX_MODULES = 32;[m
[31m-  Ref<BitMatrix> image_;[m
[31m-[m
[31m-public:[m
[31m-  MonochromeRectangleDetector(Ref<BitMatrix> image) : image_(image) {  };[m
[31m-[m
[31m-  std::vector<Ref<ResultPoint> > detect();[m
[31m-[m
[31m-private:[m
[31m-  Ref<ResultPoint> findCornerFromCenter(int centerX, int deltaX, int left, int right,[m
[31m-      int centerY, int deltaY, int top, int bottom, int maxWhiteRun);[m
[31m-[m
[31m-  Ref<TwoInts> blackWhiteRange(int fixedDimension, int maxWhiteRun, int minDim, int maxDim,[m
[31m-      bool horizontal);[m
[31m-[m
[31m-  int max(int a, float b) { return (float) a > b ? a : (int) b;};[m
[31m-};[m
[31m-}[m
[31m-[m
[31m-#endif // __MONOCHROMERECTANGLEDETECTOR_H__[m
[31m-[m
[31m-// file: zxing/common/detector/WhiteRectangleDetector.h[m
[31m-[m
[31m-#ifndef __WHITERECTANGLEDETECTOR_H__[m
[31m-// #define __WHITERECTANGLEDETECTOR_H__[m
[31m-[m
[31m-/*[m
[31m- *  WhiteRectangleDetector.h[m
[31m- *[m
[31m- *[m
[31m- *  Created by Luiz Silva on 09/02/2010.[m
[31m- *  Copyright 2010  authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <vector>[m
[31m-// #include <zxing/ReaderException.h>[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-// #include <zxing/common/BitMatrix.h>[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/ResultPoint.h>[m
[31m-[m
[31m-[m
[31m-namespace zxing {[m
[31m-[m
[31m-class WhiteRectangleDetector : public Counted {[m
[31m-  private:[m
[31m-    static int INIT_SIZE;[m
[31m-    static int CORR;[m
[31m-    Ref<BitMatrix> image_;[m
[31m-    int width_;[m
[31m-    int height_;[m
[31m-[m
[31m-  public:[m
[31m-    WhiteRectangleDetector(Ref<BitMatrix> image);[m
[31m-    std::vector<Ref<ResultPoint> > detect();[m
[31m-[m
[31m-  private:[m
[31m-    int round(float a);[m
[31m-    Ref<ResultPoint> getBlackPointOnSegment(float aX, float aY, float bX, float bY);[m
[31m-    int distanceL2(float aX, float aY, float bX, float bY);[m
[31m-    std::vector<Ref<ResultPoint> > centerEdges(Ref<ResultPoint> y, Ref<ResultPoint> z,[m
[31m-                                    Ref<ResultPoint> x, Ref<ResultPoint> t);[m
[31m-    bool containsBlackPoint(int a, int b, int fixed, bool horizontal);[m
[31m-};[m
[31m-}[m
[31m-[m
[31m-#endif[m
[31m-[m
[31m-// file: zxing/datamatrix/detector/DetectorException.h[m
[31m-[m
[31m-/*[m
[31m- * DetectorException.h[m
[31m- *[m
[31m- *  Created on: Aug 26, 2011[m
[31m- *      Author: luiz[m
[31m- */[m
[31m-[m
[31m-#ifndef DETECTOREXCEPTION_H_[m
[31m-#define DETECTOREXCEPTION_H_[m
[31m-[m
[31m-// #include <zxing/Exception.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace datamatrix {[m
[31m-[m
[31m-class DetectorException : public Exception {[m
[31m-  public:[m
[31m-    DetectorException(const char *msg);[m
[31m-    virtual ~DetectorException() throw();[m
[31m-};[m
[31m-} /* namespace nexxera */[m
[31m-} /* namespace zxing */[m
[31m-#endif /* DETECTOREXCEPTION_H_ */[m
[31m-[m
[31m-// file: zxing/multi/ByQuadrantReader.h[m
[31m-[m
[31m-#ifndef __BY_QUADRANT_READER_H__[m
[31m-// #define __BY_QUADRANT_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2011 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/Reader.h>[m
[31m-// #include <zxing/BinaryBitmap.h>[m
[31m-// #include <zxing/Result.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace multi {[m
[31m-class ByQuadrantReader : public Reader {[m
[31m-  private:[m
[31m-    Reader& delegate_;[m
[31m-[m
[31m-  public:[m
[31m-    ByQuadrantReader(Reader& delegate);[m
[31m-    virtual ~ByQuadrantReader();[m
[31m-    virtual Ref<Result> decode(Ref<BinaryBitmap> image);[m
[31m-    virtual Ref<Result> decode(Ref<BinaryBitmap> image, DecodeHints hints);[m
[31m-};[m
[31m-} // End zxing::multi namespace[m
[31m-} // End zxing namespace[m
[31m-[m
[31m-#endif // __BY_QUADRANT_READER_H__[m
[31m-[m
[31m-// file: zxing/multi/MultipleBarcodeReader.h[m
[31m-[m
[31m-#ifndef __MULTIPLE_BARCODE_READER_H__[m
[31m-// #define __MULTIPLE_BARCODE_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2011 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/common/Counted.h>[m
[31m-// #include <zxing/Result.h>[m
[31m-// #include <zxing/BinaryBitmap.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-// #include <vector>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace multi {[m
[31m-class MultipleBarcodeReader : public Counted {[m
[31m-  protected:[m
[31m-    MultipleBarcodeReader() {}[m
[31m-  public:[m
[31m-    virtual std::vector<Ref<Result> > decodeMultiple(Ref<BinaryBitmap> image);[m
[31m-    virtual std::vector<Ref<Result> > decodeMultiple(Ref<BinaryBitmap> image, DecodeHints hints) = 0;[m
[31m-    virtual ~MultipleBarcodeReader();[m
[31m-};[m
[31m-} // End zxing::multi namespace[m
[31m-} // End zxing namespace[m
[31m-[m
[31m-#endif // __MULTIPLE_BARCODE_READER_H__[m
[31m-[m
[31m-// file: zxing/multi/GenericMultipleBarcodeReader.h[m
[31m-[m
[31m-#ifndef __GENERIC_MULTIPLE_BARCODE_READER_H__[m
[31m-// #define __GENERIC_MULTIPLE_BARCODE_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2011 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/multi/MultipleBarcodeReader.h>[m
[31m-// #include <zxing/Reader.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace multi {[m
[31m-class GenericMultipleBarcodeReader : public MultipleBarcodeReader {[m
[31m-  private:[m
[31m-    static Ref<Result> translateResultPoints(Ref<Result> result,[m
[31m-                                             int xOffset,[m
[31m-                                             int yOffset);[m
[31m-    void doDecodeMultiple(Ref<BinaryBitmap> image,[m
[31m-                          DecodeHints hints,[m
[31m-                          std::vector<Ref<Result> >& results,[m
[31m-                          int xOffset,[m
[31m-                          int yOffset);[m
[31m-    Reader& delegate_;[m
[31m-    static const int MIN_DIMENSION_TO_RECUR = 100;[m
[31m-[m
[31m-  public:[m
[31m-    GenericMultipleBarcodeReader(Reader& delegate);[m
[31m-    virtual ~GenericMultipleBarcodeReader();[m
[31m-    virtual std::vector<Ref<Result> > decodeMultiple(Ref<BinaryBitmap> image,[m
[31m-                                                     DecodeHints hints);[m
[31m-};[m
[31m-} // End zxing::multi namespace[m
[31m-} // End zxing namespace[m
[31m-[m
[31m-#endif // __GENERIC_MULTIPLE_BARCODE_READER_H__[m
[31m-[m
[31m-// file: zxing/multi/qrcode/QRCodeMultiReader.h[m
[31m-[m
[31m-#ifndef __QRCODE_MULTI_READER_H__[m
[31m-// #define __QRCODE_MULTI_READER_H__[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2011 ZXing authors All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/multi/MultipleBarcodeReader.h>[m
[31m-// #include <zxing/qrcode/QRCodeReader.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace multi {[m
[31m-class QRCodeMultiReader: public zxing::qrcode::QRCodeReader, public MultipleBarcodeReader {[m
[31m-  public:[m
[31m-    QRCodeMultiReader();[m
[31m-    virtual ~QRCodeMultiReader();[m
[31m-    virtual std::vector<Ref<Result> > decodeMultiple(Ref<BinaryBitmap> image, DecodeHints hints);[m
[31m-};[m
[31m-} // End zxing::multi namespace[m
[31m-} // End zxing namespace[m
[31m-[m
[31m-#endif // __QRCODE_MULTI_READER_H__[m
[31m-[m
[31m-// file: zxing/multi/qrcode/detector/MultiDetector.h[m
[31m-[m
[31m-#ifndef __MULTI_DETECTOR_H__[m
[31m-// #define __MULTI_DETECTOR_H__[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2011 ZXing authors[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/detector/Detector.h>[m
[31m-// #include <zxing/common/DetectorResult.h>[m
[31m-// #include <zxing/DecodeHints.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace multi {[m
[31m-class MultiDetector : public zxing::qrcode::Detector {[m
[31m-  public:[m
[31m-    MultiDetector(Ref<BitMatrix> image);[m
[31m-    virtual ~MultiDetector();[m
[31m-    virtual std::vector<Ref<DetectorResult> > detectMulti(DecodeHints hints);[m
[31m-};[m
[31m-} // End zxing::multi namespace[m
[31m-} // End zxing namespace[m
[31m-[m
[31m-#endif // __MULTI_DETECTOR_H__[m
[31m-[m
[31m-// file: zxing/multi/qrcode/detector/MultiFinderPatternFinder.h[m
[31m-[m
[31m-#ifndef __MULTI_FINDER_PATTERN_FINDER_H__[m
[31m-// #define __MULTI_FINDER_PATTERN_FINDER_H__[m
[31m-[m
[31m-/*[m
[31m- *  Copyright 2011 ZXing authors[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License");[m
[31m- * you may not use this file except in compliance with the License.[m
[31m- * You may obtain a copy of the License at[m
[31m- *[m
[31m- *      http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software[m
[31m- * distributed under the License is distributed on an "AS IS" BASIS,[m
[31m- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.[m
[31m- * See the License for the specific language governing permissions and[m
[31m- * limitations under the License.[m
[31m- */[m
[31m-[m
[31m-// #include <zxing/qrcode/detector/FinderPattern.h>[m
[31m-// #include <zxing/qrcode/detector/FinderPatternFinder.h>[m
[31m-// #include <zxing/qrcode/detector/FinderPatternInfo.h>[m
[31m-[m
[31m-namespace zxing {[m
[31m-namespace multi {[m
[31m-class MultiFinderPatternFinder : zxing::qrcode::FinderPatternFinder {[m
[31m-  private:[m
[31m-    std::vector<std::vector<Ref<zxing::qrcode::FinderPattern> > > selectBestPatterns();[m
[31m-[m
[31m-    static const float MAX_MODULE_COUNT_PER_EDGE;[m
[31m-    static const float MIN_MODULE_COUNT_PER_EDGE;[m
[31m-    static const float DIFF_MODSIZE_CUTOFF_PERCENT;[m
[31m-    static const float DIFF_MODSIZE_CUTOFF;[m
[31m-[m
[31m-  public:[m
[31m-    MultiFinderPatternFinder(Ref<BitMatrix> image, Ref<ResultPointCallback> resultPointCallback);[m
[31m-    virtual ~MultiFinderPatternFinder();[m
[31m-    virtual std::vector<Ref<zxing::qrcode::FinderPatternInfo> > findMulti(DecodeHints const& hints);[m
[31m-[m
[31m-[m
[31m-};[m
[31m-}[m
[31m-}[m
[31m-[m
[31m-#endif // __MULTI_FINDER_PATTERN_FINDER_H__[m
[31m-[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/BarcodeScannerProxy.js b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/BarcodeScannerProxy.js[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex 208a49d..cea16d9[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/BarcodeScannerProxy.js[m
[1m+++ b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/BarcodeScannerProxy.js[m
[36m@@ -12,6 +12,7 @@[m [mvar urlutil = require('cordova/urlutil');[m
 [m
 var CAMERA_STREAM_STATE_CHECK_RETRY_TIMEOUT = 200; // milliseconds[m
 var OPERATION_IS_IN_PROGRESS = -2147024567;[m
[32m+[m[32mvar REGDB_E_CLASSNOTREG = -2147221164;[m
 var INITIAL_FOCUS_DELAY = 200; // milliseconds[m
 var CHECK_PLAYING_TIMEOUT = 100; // milliseconds[m
 [m
[36m@@ -155,6 +156,22 @@[m [mBarcodeReader.prototype.init = function (capture, width, height) {[m
     this._width = width;[m
     this._height = height;[m
     this._zxingReader = new ZXing.BarcodeReader();[m
[32m+[m[32m    this._zxingReader.tryHarder = true;[m
[32m+[m
[32m+[m[32m    var formatsList = BarcodeReader.scanCallArgs.args.length > 0 && BarcodeReader.scanCallArgs.args[0].formats;[m[41m	[m
[32m+[m	[32mif (formatsList) {[m[41m		[m
[32m+[m[32m        var possibleFormats = formatsList[m
[32m+[m[32m            .split(",")[m
[32m+[m[32m            .map(format => {[m
[32m+[m[32m                for (var index in BARCODE_FORMAT) {[m
[32m+[m[32m                    if (BARCODE_FORMAT[index] === format) {[m[41m                        [m
[32m+[m[32m                        return index;[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            });[m
[32m+[m
[32m+[m[32m        this._zxingReader.possibleFormats = possibleFormats;[m
[32m+[m[32m    }[m
 };[m
 [m
 /**[m
[36m@@ -250,6 +267,13 @@[m [mmodule.exports = {[m
             capture,[m
             reader;[m
 [m
[32m+[m[32m        // Save call state for suspend/resume[m
[32m+[m[32m        BarcodeReader.scanCallArgs = {[m
[32m+[m[32m            success: success,[m
[32m+[m[32m            fail: fail,[m
[32m+[m[32m            args: args[m
[32m+[m[32m        };[m
[32m+[m
         function updatePreviewForRotation(evt) {[m
             if (!capture) {[m
                 return;[m
[36m@@ -336,15 +360,30 @@[m [mmodule.exports = {[m
             }[m
 [m
             // Multiple calls to focusAsync leads to internal focusing hang on some Windows Phone 8.1 devices[m
[31m-            if (controller.focusControl.focusState === Windows.Media.Devices.MediaCaptureFocusState.searching) {[m
[31m-                return result;[m
[32m+[m[32m            // Also need to wrap in try/catch to avoid crash on Surface 3 - looks like focusState property[m
[32m+[m[32m            // somehow is not accessible there. See https://github.com/phonegap/phonegap-plugin-barcodescanner/issues/288[m
[32m+[m[32m            try {[m
[32m+[m[32m                if (controller.focusControl.focusState === Windows.Media.Devices.MediaCaptureFocusState.searching) {[m
[32m+[m[32m                    return result;[m
[32m+[m[32m                }[m
[32m+[m[32m            } catch (e) {[m
[32m+[m[32m                // Nothing to do - just continue w/ focusing[m
             }[m
 [m
             // The delay prevents focus hang on slow devices[m
             return WinJS.Promise.timeout(INITIAL_FOCUS_DELAY)[m
             .then(function () {[m
                 try {[m
[31m-                    return controller.focusControl.focusAsync();[m
[32m+[m[32m                    return controller.focusControl.focusAsync().then(function () {[m
[32m+[m[32m                        return result;[m
[32m+[m[32m                    }, function (e) {[m
[32m+[m[32m                        // This happens on mutliple taps[m
[32m+[m[32m                        if (e.number !== OPERATION_IS_IN_PROGRESS) {[m
[32m+[m[32m                            console.error('focusAsync failed: ' + e);[m
[32m+[m[32m                            return WinJS.Promise.wrapError(e);[m
[32m+[m[32m                        }[m
[32m+[m[32m                        return result;[m
[32m+[m[32m                    });[m
                 } catch (e) {[m
                     // This happens on mutliple taps[m
                     if (e.number !== OPERATION_IS_IN_PROGRESS) {[m
[36m@@ -383,7 +422,7 @@[m [mmodule.exports = {[m
 [m
             focusControl.configure(focusConfig);[m
 [m
[31m-            // Continuous focus should start only after preview has started. See 'Remarks' at [m
[32m+[m[32m            // Continuous focus should start only after preview has started. See 'Remarks' at[m
             // https://msdn.microsoft.com/en-us/library/windows/apps/windows.media.devices.focuscontrol.configure.aspx[m
             function waitForIsPlaying() {[m
                 var isPlaying = !capturePreview.paused && !capturePreview.ended && capturePreview.readyState > 2;[m
[36m@@ -417,7 +456,18 @@[m [mmodule.exports = {[m
         function startPreview() {[m
             return findCamera()[m
             .then(function (id) {[m
[31m-                var captureSettings = new Windows.Media.Capture.MediaCaptureInitializationSettings();[m
[32m+[m[32m                var captureSettings;[m
[32m+[m
[32m+[m[32m                try {[m
[32m+[m[32m                    captureSettings = new Windows.Media.Capture.MediaCaptureInitializationSettings();[m
[32m+[m[32m                } catch (e) {[m
[32m+[m[32m                    if (e.number === REGDB_E_CLASSNOTREG) {[m
[32m+[m[32m                        throw new Error('Ensure that you have Windows Media Player and Media Feature pack installed.');[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    throw e;[m
[32m+[m[32m                }[m
[32m+[m
                 captureSettings.streamingCaptureMode = Windows.Media.Capture.StreamingCaptureMode.video;[m
                 captureSettings.photoCaptureSource = Windows.Media.Capture.PhotoCaptureSource.videoPreview;[m
                 captureSettings.videoDeviceId = id;[m
[36m@@ -428,7 +478,7 @@[m [mmodule.exports = {[m
             .then(function () {[m
 [m
                 var controller = capture.videoDeviceController;[m
[31m-                var deviceProps = controller.getAvailableMediaStreamProperties(Windows.Media.Capture.MediaStreamType.videoRecord);[m
[32m+[m[32m                var deviceProps = controller.getAvailableMediaStreamProperties(Windows.Media.Capture.MediaStreamType.videoPreview);[m
 [m
                 deviceProps = Array.prototype.slice.call(deviceProps);[m
                 deviceProps = deviceProps.filter(function (prop) {[m
[36m@@ -439,8 +489,15 @@[m [mmodule.exports = {[m
                     return propB.width - propA.width;[m
                 });[m
 [m
[31m-                var maxResProps = deviceProps[0];[m
[31m-                return controller.setMediaStreamPropertiesAsync(Windows.Media.Capture.MediaStreamType.videoRecord, maxResProps)[m
[32m+[m[32m                var preferredProps = deviceProps.filter(function(prop){[m
[32m+[m[32m                    // Filter out props where frame size is between 640*480 and 1280*720[m
[32m+[m[32m                    return prop.width >= 640 && prop.height >= 480 && prop.width <= 1280 && prop.height <= 720;[m
[32m+[m[32m                });[m
[32m+[m
[32m+[m[32m                // prefer video frame size between between 640*480 and 1280*720[m
[32m+[m[32m                // use maximum resolution otherwise[m
[32m+[m[32m                var maxResProps = preferredProps[0] || deviceProps[0];[m
[32m+[m[32m                return controller.setMediaStreamPropertiesAsync(Windows.Media.Capture.MediaStreamType.videoPreview, maxResProps)[m
                 .then(function () {[m
                     return {[m
                         capture: capture,[m
[36m@@ -499,24 +556,50 @@[m [mmodule.exports = {[m
          * Removes preview frame and corresponding objects from window[m
          */[m
         function destroyPreview() {[m
[32m+[m[32m            var promise = WinJS.Promise.as();[m
 [m
             Windows.Graphics.Display.DisplayInformation.getForCurrentView().removeEventListener("orientationchanged", updatePreviewForRotation, false);[m
             document.removeEventListener('backbutton', cancelPreview);[m
 [m
[31m-            capturePreview.pause();[m
[31m-            capturePreview.src = null;[m
[32m+[m[32m            if (capturePreview) {[m
[32m+[m[32m                var isPlaying = !capturePreview.paused && !capturePreview.ended && capturePreview.readyState > 2;[m
[32m+[m[32m                if (isPlaying) {[m
[32m+[m[32m                    capturePreview.pause();[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                // http://stackoverflow.com/a/28060352/4177762[m
[32m+[m[32m                capturePreview.src = "";[m
[32m+[m[32m                if (capturePreview.load) {[m
[32m+[m[32m                    capturePreview.load();[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
 [m
             if (capturePreviewFrame) {[m
[31m-                document.body.removeChild(capturePreviewFrame);[m
[32m+[m[32m                try {[m
[32m+[m[32m                    document.body.removeChild(capturePreviewFrame);[m
[32m+[m[32m                } catch (e) {[m
[32m+[m[32m                    // Catching NotFoundError[m
[32m+[m[32m                    console.error(e);[m
[32m+[m[32m                }[m
             }[m
[32m+[m[32m            capturePreviewFrame = null;[m
 [m
             reader && reader.stop();[m
             reader = null;[m
 [m
[31m-            capture && capture.stopRecordAsync();[m
[32m+[m[32m            if (capture) {[m
[32m+[m[32m                try {[m
[32m+[m[32m                    promise = capture.stopRecordAsync();[m
[32m+[m[32m                } catch (e) {[m
[32m+[m[32m                    // Catching NotFoundError[m
[32m+[m[32m                    console.error(e);[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
             capture = null;[m
 [m
             enableZoomAndScroll();[m
[32m+[m
[32m+[m[32m            return promise;[m
         }[m
 [m
         /**[m
[36m@@ -529,13 +612,15 @@[m [mmodule.exports = {[m
         }[m
 [m
         function checkCancelled() {[m
[31m-            if (BarcodeReader.scanCancelled) {[m
[32m+[m[32m            if (BarcodeReader.scanCancelled || BarcodeReader.suspended) {[m
                 throw new Error('Canceled');[m
             }[m
         }[m
 [m
[31m-        WinJS.Promise.wrap(createPreview())[m
[31m-        .then(function () {[m
[32m+[m[32m        // Timeout is needed so that the .done finalizer below can be attached to the promise.[m
[32m+[m[32m        BarcodeReader.scanPromise = WinJS.Promise.timeout()[m
[32m+[m[32m        .then(function() {[m
[32m+[m[32m            createPreview();[m
             checkCancelled();[m
             return startPreview();[m
         })[m
[36m@@ -552,16 +637,28 @@[m [mmodule.exports = {[m
                 return reader.readCode();[m
             });[m
         })[m
[31m-        .done(function (result) {[m
[32m+[m[32m        .then(function (result) {[m
[32m+[m[32m            // Suppress null result (cancel) on suspending[m
[32m+[m[32m            if (BarcodeReader.suspended) {[m
[32m+[m[32m                return;[m
[32m+[m[32m            }[m
[32m+[m
             destroyPreview();[m
             success({[m
                 text: result && result.text,[m
                 format: result && BARCODE_FORMAT[result.barcodeFormat],[m
                 cancelled: !result[m
             });[m
[31m-        }, function (error) {[m
[31m-            destroyPreview();[m
[32m+[m[32m        });[m
 [m
[32m+[m[32m        // Catching any errors here[m
[32m+[m[32m        BarcodeReader.scanPromise.done(function () { }, function (error) {[m
[32m+[m[32m            // Suppress null result (cancel) on suspending[m
[32m+[m[32m            if (BarcodeReader.suspended) {[m
[32m+[m[32m                return;[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            destroyPreview();[m
             if (error.message == 'Canceled') {[m
                 success({[m
                     cancelled: true[m
[36m@@ -570,6 +667,12 @@[m [mmodule.exports = {[m
                 fail(error);[m
             }[m
         });[m
[32m+[m
[32m+[m[32m        BarcodeReader.videoPreviewIsVisible = function () {[m
[32m+[m[32m            return capturePreviewFrame !== null;[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        BarcodeReader.destroyPreview = destroyPreview;[m
     },[m
 [m
     /**[m
[36m@@ -583,4 +686,53 @@[m [mmodule.exports = {[m
     }[m
 };[m
 [m
[32m+[m[32mvar app = WinJS.Application;[m
[32m+[m
[32m+[m[32mfunction waitForScanEnd() {[m
[32m+[m[32m    return BarcodeReader.scanPromise || WinJS.Promise.as();[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mfunction suspend(args) {[m
[32m+[m[32m    BarcodeReader.suspended = true;[m
[32m+[m[32m    if (args) {[m
[32m+[m[32m        args.setPromise(BarcodeReader.destroyPreview()[m
[32m+[m[32m        .then(waitForScanEnd, waitForScanEnd));[m
[32m+[m[32m    } else {[m
[32m+[m[32m        BarcodeReader.destroyPreview();[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mfunction resume() {[m
[32m+[m[32m    BarcodeReader.suspended = false;[m
[32m+[m[32m    module.exports.scan(BarcodeReader.scanCallArgs.success, BarcodeReader.scanCallArgs.fail, BarcodeReader.scanCallArgs.args);[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mfunction onVisibilityChanged() {[m
[32m+[m[32m    if (document.visibilityState === 'hidden'[m
[32m+[m[32m        && BarcodeReader.videoPreviewIsVisible && BarcodeReader.videoPreviewIsVisible() && BarcodeReader.destroyPreview) {[m
[32m+[m[32m        suspend();[m
[32m+[m[32m    } else if (BarcodeReader.suspended) {[m
[32m+[m[32m        resume();[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// Windows 8.1 projects[m
[32m+[m[32mdocument.addEventListener('msvisibilitychange', onVisibilityChanged);[m
[32m+[m[32m// Windows 10 projects[m
[32m+[m[32mdocument.addEventListener('visibilitychange', onVisibilityChanged);[m
[32m+[m
[32m+[m[32m// About to be suspended[m
[32m+[m[32mapp.addEventListener('checkpoint', function (args) {[m
[32m+[m[32m    if (BarcodeReader.videoPreviewIsVisible && BarcodeReader.videoPreviewIsVisible() && BarcodeReader.destroyPreview) {[m
[32m+[m[32m        suspend(args);[m
[32m+[m[32m    }[m
[32m+[m[32m});[m
[32m+[m
[32m+[m[32m// Resuming from a user suspension[m
[32m+[m[32mWindows.UI.WebUI.WebUIApplication.addEventListener("resuming", function () {[m
[32m+[m[32m    if (BarcodeReader.suspended) {[m
[32m+[m[32m        resume();[m
[32m+[m[32m    }[m
[32m+[m[32m}, false);[m
[32m+[m
 require("cordova/exec/proxy").add("BarcodeScanner", module.exports);[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/assets/plugin-barcodeScanner.css b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/assets/plugin-barcodeScanner.css[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/lib.UW/ANY/ZXing.winmd b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/lib.UW/ANY/ZXing.winmd[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/lib.UW/ARM/ZXing.winmd b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/lib.UW/ARM/ZXing.winmd[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/lib.UW/x64/ZXing.winmd b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/lib.UW/x64/ZXing.winmd[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/lib.UW/x86/ZXing.winmd b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/lib.UW/x86/ZXing.winmd[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/lib/WinRTBarcodeReader.csproj b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/lib/WinRTBarcodeReader.csproj[m
[1mindex fd683c9..7d3c2b3 100755[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/lib/WinRTBarcodeReader.csproj[m
[1m+++ b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/windows/lib/WinRTBarcodeReader.csproj[m
[36m@@ -7,7 +7,7 @@[m
 [m
   Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.[m
 -->[m
[31m-<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">[m
[32m+[m[32m<Project ToolsVersion="12.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">[m
   <Import Project="$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props" Condition="Exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.props')" />[m
   <PropertyGroup>[m
     <Configuration Condition=" '$(Configuration)' == '' ">Debug</Configuration>[m
[36m@@ -23,6 +23,9 @@[m
     <DefaultLanguage>en-US</DefaultLanguage>[m
     <FileAlignment>512</FileAlignment>[m
     <ProjectTypeGuids>{BC8A1FFA-BEE3-4634-8014-F334798102B3};{FAE04EC0-301F-11D3-BF4B-00C04F79EFBC}</ProjectTypeGuids>[m
[32m+[m[32m    <TargetPlatformVersion>8.1</TargetPlatformVersion>[m
[32m+[m[32m    <MinimumVisualStudioVersion>12</MinimumVisualStudioVersion>[m
[32m+[m[32m    <TargetFrameworkVersion />[m
   </PropertyGroup>[m
   <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">[m
     <DebugSymbols>true</DebugSymbols>[m
[36m@@ -120,8 +123,8 @@[m
       <HintPath>ZXing.winmd</HintPath>[m
     </Reference>[m
   </ItemGroup>[m
[31m-  <PropertyGroup Condition=" '$(VisualStudioVersion)' == '' or '$(VisualStudioVersion)' &lt; '11.0' ">[m
[31m-    <VisualStudioVersion>11.0</VisualStudioVersion>[m
[32m+[m[32m  <PropertyGroup Condition=" '$(VisualStudioVersion)' == '' or '$(VisualStudioVersion)' &lt; '12.0' ">[m
[32m+[m[32m    <VisualStudioVersion>12.0</VisualStudioVersion>[m
   </PropertyGroup>[m
   <Import Project="$(MSBuildExtensionsPath)\Microsoft\WindowsXaml\v$(VisualStudioVersion)\Microsoft.Windows.UI.Xaml.CSharp.targets" />[m
   <!-- To modify your build process, add your task inside one of the targets below and uncomment it. [m
[36m@@ -131,4 +134,4 @@[m
   <Target Name="AfterBuild">[m
   </Target>[m
   -->[m
[31m-</Project>[m
[32m+[m[32m</Project>[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/BarcodeScanner.cs b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/BarcodeScanner.cs[m
[1mdeleted file mode 100755[m
[1mindex fc2f540..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/BarcodeScanner.cs[m
[1m+++ /dev/null[m
[36m@@ -1,117 +0,0 @@[m
[31m-﻿﻿/*[m
[31m- * Copyright (c) Microsoft Open Technologies, Inc. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at[m
[31m- *[m
[31m- * http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.[m
[31m- */[m
[31m-[m
[31m- namespace WPCordovaClassLib.Cordova.Commands[m
[31m-{[m
[31m-    using System.Runtime.Serialization;[m
[31m-    using Microsoft.Phone.Tasks;[m
[31m-    using WPCordovaClassLib.Cordova.JSON;[m
[31m-    using ZXing;[m
[31m-[m
[31m-    /// <summary>[m
[31m-    /// Class that extends cordova with Barcode scanner functionality.[m
[31m-    /// </summary>[m
[31m-    public class BarcodeScanner : BaseCommand[m
[31m-    {[m
[31m-        /// <summary>[m
[31m-        /// Scans the barcode.[m
[31m-        /// </summary>[m
[31m-        /// <param name="options">Parameter is ignored.</param>[m
[31m-        public void scan(string options)[m
[31m-        {[m
[31m-            var task = new BarcodeScannerTask();[m
[31m-            task.Completed += this.TaskCompleted;[m
[31m-            task.Show();[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Handler for barcode scanner task.[m
[31m-        /// </summary>[m
[31m-        /// <param name="sender">The sender.</param>[m
[31m-        /// <param name="e">The scan result.</param>[m
[31m-        private void TaskCompleted(object sender, BarcodeScannerTask.ScanResult e)[m
[31m-        {[m
[31m-            PluginResult result;[m
[31m-[m
[31m-            switch (e.TaskResult)[m
[31m-            {[m
[31m-                case TaskResult.OK:[m
[31m-                    result = new PluginResult(PluginResult.Status.OK);[m
[31m-                    result.Message = JsonHelper.Serialize(new BarcodeResult(e.Barcode));[m
[31m-                    break;[m
[31m-                case TaskResult.Cancel:[m
[31m-                    // If scan is cancelled we return PluginResult.Status.OK with Message contains cancelled: true[m
[31m-                    // See plugin docs https://github.com/MSOpenTech/BarcodeScanner#using-the-plugin[m
[31m-                    result = new PluginResult(PluginResult.Status.OK);[m
[31m-                    result.Message = JsonHelper.Serialize(new BarcodeResult());[m
[31m-                    break;[m
[31m-                default:[m
[31m-                    result = new PluginResult(PluginResult.Status.ERROR);[m
[31m-                    break;[m
[31m-            }[m
[31m-[m
[31m-            this.DispatchCommandResult(result);[m
[31m-        }[m
[31m-    }[m
[31m-[m
[31m-    /// <summary>[m
[31m-    /// Represents the barcode scan result, that should be serialized and passed to JS layer.[m
[31m-    /// </summary>[m
[31m-    [DataContract][m
[31m-    public sealed class BarcodeResult[m
[31m-    {[m
[31m-        /// <summary>[m
[31m-        /// Initializes a new instance of the <see cref="BarcodeResult"/> class.[m
[31m-        /// </summary>[m
[31m-        /// <param name="canceled">if set to <c>true</c> [canceled].</param>[m
[31m-        public BarcodeResult(bool canceled = true)[m
[31m-        {[m
[31m-            this.Cancelled = canceled;[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Initializes a new instance of the <see cref="BarcodeResult"/> class.[m
[31m-        /// </summary>[m
[31m-        /// <param name="barcode">The barcode result.</param>[m
[31m-        public BarcodeResult(Result barcode)[m
[31m-        {[m
[31m-            this.Cancelled = false;[m
[31m-            this.Format = barcode.BarcodeFormat.ToString();[m
[31m-            this.Text = barcode.Text;[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Gets a value indicating whether barcode scan is cancelled.[m
[31m-        /// </summary>[m
[31m-        /// <value>[m
[31m-        ///   <c>true</c> if cancelled; otherwise, <c>false</c>.[m
[31m-        /// </value>[m
[31m-        [DataMember(Name = "cancelled")][m
[31m-        public bool Cancelled { get; private set; }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Gets the format of barcode.[m
[31m-        /// </summary>[m
[31m-        /// <value>[m
[31m-        /// The barcode format.[m
[31m-        /// </value>[m
[31m-        [DataMember(Name = "format")][m
[31m-        public string Format { get; private set; }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Gets the barcode text.[m
[31m-        /// </summary>[m
[31m-        /// <value>[m
[31m-        /// The barcode text.[m
[31m-        /// </value>[m
[31m-        [DataMember(Name = "text")][m
[31m-        public string Text { get; private set; }[m
[31m-    }[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/BarcodeScannerTask.cs b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/BarcodeScannerTask.cs[m
[1mdeleted file mode 100755[m
[1mindex d1bbdd7..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/BarcodeScannerTask.cs[m
[1m+++ /dev/null[m
[36m@@ -1,103 +0,0 @@[m
[31m-﻿﻿/*[m
[31m- * Copyright (c) Microsoft Open Technologies, Inc. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at[m
[31m- *[m
[31m- * http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.[m
[31m- */[m
[31m-[m
[31m-namespace WPCordovaClassLib.Cordova.Commands[m
[31m-{[m
[31m-    using System;[m
[31m-    using System.Windows;[m
[31m-    using System.Windows.Navigation;[m
[31m-[m
[31m-    using Microsoft.Phone.Controls;[m
[31m-    using Microsoft.Phone.Tasks;[m
[31m-    using ZXing;[m
[31m-[m
[31m-    /// <summary>[m
[31m-    /// Class that represents barcode scanner task that mimics standart WP8 tasks.[m
[31m-    /// </summary>[m
[31m-    public class BarcodeScannerTask[m
[31m-    {[m
[31m-        /// <summary>[m
[31m-        /// Occurs when task is [completed].[m
[31m-        /// </summary>[m
[31m-        public event EventHandler<ScanResult> Completed;[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Shows barcode scanner interface.[m
[31m-        /// </summary>[m
[31m-        public void Show()[m
[31m-        {[m
[31m-            Deployment.Current.Dispatcher.BeginInvoke(() =>[m
[31m-            {[m
[31m-                var root = Application.Current.RootVisual as PhoneApplicationFrame;[m
[31m-[m
[31m-                if (root == null)[m
[31m-                {[m
[31m-                    return;[m
[31m-                }[m
[31m-[m
[31m-                root.Navigated += this.OnNavigated;[m
[31m-                root.Navigate(new Uri("/Plugins/phonegap-plugin-barcodescanner/BarcodeScannerUI.xaml", UriKind.Relative));[m
[31m-            });[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Called when [navigated].[m
[31m-        /// </summary>[m
[31m-        /// <param name="sender">The sender.</param>[m
[31m-        /// <param name="e">The <see cref="NavigationEventArgs"/> instance containing the event data.</param>[m
[31m-        private void OnNavigated(object sender, NavigationEventArgs e)[m
[31m-        {[m
[31m-            if (!(e.Content is BarcodeScannerUI))[m
[31m-            {[m
[31m-                return;[m
[31m-            }[m
[31m-[m
[31m-            var phoneApplicationFrame = Application.Current.RootVisual as PhoneApplicationFrame;[m
[31m-            if (phoneApplicationFrame != null)[m
[31m-            {[m
[31m-                phoneApplicationFrame.Navigated -= this.OnNavigated;[m
[31m-            }[m
[31m-[m
[31m-            var barcodeScanner = (BarcodeScannerUI)e.Content;[m
[31m-[m
[31m-            if (barcodeScanner != null)[m
[31m-            {[m
[31m-                barcodeScanner.Completed += this.Completed;[m
[31m-            }[m
[31m-            else if (this.Completed != null)[m
[31m-            {[m
[31m-                this.Completed(this, new ScanResult(TaskResult.Cancel));[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Represents barcode scan result.[m
[31m-        /// </summary>[m
[31m-        public class ScanResult : TaskEventArgs[m
[31m-        {[m
[31m-            /// <summary>[m
[31m-            /// Initializes a new instance of the <see cref="ScanResult"/> class.[m
[31m-            /// </summary>[m
[31m-            /// <param name="taskResult">One of the enumeration values that specifies the status of the task.</param>[m
[31m-            public ScanResult(TaskResult taskResult)[m
[31m-                : base(taskResult)[m
[31m-            {[m
[31m-            }[m
[31m-[m
[31m-            /// <summary>[m
[31m-            /// Gets the barcode scan result.[m
[31m-            /// </summary>[m
[31m-            /// <value>[m
[31m-            /// The barcode scan result.[m
[31m-            /// </value>[m
[31m-            public Result Barcode { get; internal set; }[m
[31m-        }[m
[31m-    }[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/BarcodeScannerUI.xaml b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/BarcodeScannerUI.xaml[m
[1mdeleted file mode 100755[m
[1mindex 329d84e..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/BarcodeScannerUI.xaml[m
[1m+++ /dev/null[m
[36m@@ -1,46 +0,0 @@[m
[31m-﻿<!-- [m
[31m-  Copyright (c) Microsoft Open Technologies, Inc. All rights reserved.[m
[31m-  [m
[31m-    Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at[m
[31m-[m
[31m-  http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-  Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.[m
[31m--->[m
[31m-<phone:PhoneApplicationPage[m
[31m-    x:Class="WPCordovaClassLib.Cordova.Commands.BarcodeScannerUI"[m
[31m-    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"[m
[31m-    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"[m
[31m-    xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone"[m
[31m-    xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone"[m
[31m-    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"[m
[31m-    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"[m
[31m-    FontFamily="{StaticResource PhoneFontFamilyNormal}"[m
[31m-    FontSize="{StaticResource PhoneFontSizeNormal}"[m
[31m-    Foreground="{StaticResource PhoneForegroundBrush}"[m
[31m-    SupportedOrientations="Portrait" Orientation="Portrait"[m
[31m-    mc:Ignorable="d"[m
[31m-    shell:SystemTray.IsVisible="True" CacheMode="BitmapCache" >[m
[31m-    <phone:PhoneApplicationPage.ApplicationBar>[m
[31m-        <shell:ApplicationBar IsVisible="True" IsMenuEnabled="False" Mode="Minimized">[m
[31m-            <shell:ApplicationBarIconButton IconUri="/www/Images/appbar.cancel.png" IsEnabled="True" Text="Cancel" Click="CancelScan"/>[m
[31m-        </shell:ApplicationBar>[m
[31m-    </phone:PhoneApplicationPage.ApplicationBar>[m
[31m-[m
[31m-    <Grid Background="Transparent">[m
[31m-        <Canvas x:Name="CameraCanvas">[m
[31m-            <Canvas.Background>[m
[31m-                <VideoBrush x:Name="CameraBrush">[m
[31m-                    <VideoBrush.RelativeTransform>[m
[31m-                        <CompositeTransform[m
[31m-                            CenterX="0.5"[m
[31m-                            CenterY="0.5"[m
[31m-                            Rotation="90"/>[m
[31m-                    </VideoBrush.RelativeTransform>[m
[31m-                </VideoBrush>[m
[31m-            </Canvas.Background>[m
[31m-        </Canvas>[m
[31m-        <Rectangle Margin="0" Stroke="Red" Height="2"/>[m
[31m-    </Grid>[m
[31m-[m
[31m-</phone:PhoneApplicationPage>[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/BarcodeScannerUI.xaml.cs b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/BarcodeScannerUI.xaml.cs[m
[1mdeleted file mode 100755[m
[1mindex 25329ee..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/BarcodeScannerUI.xaml.cs[m
[1m+++ /dev/null[m
[36m@@ -1,182 +0,0 @@[m
[31m-﻿﻿/*[m
[31m- * Copyright (c) Microsoft Open Technologies, Inc. All rights reserved.[m
[31m- *[m
[31m- * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at[m
[31m- *[m
[31m- * http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.[m
[31m- */[m
[31m-[m
[31m-namespace WPCordovaClassLib.Cordova.Commands[m
[31m-{[m
[31m-    using System;[m
[31m-    using System.Windows;[m
[31m-    using System.Windows.Controls;[m
[31m-    using System.Windows.Input;[m
[31m-    using System.Windows.Media.Imaging;[m
[31m-    using System.Windows.Navigation;[m
[31m-    using System.Windows.Threading;[m
[31m-[m
[31m-    using Microsoft.Devices;[m
[31m-    using Microsoft.Phone.Tasks;[m
[31m-[m
[31m-    using ZXing;[m
[31m-[m
[31m-    /// <summary>[m
[31m-    /// Class that represents UI for barcode scanner.[m
[31m-    /// </summary>[m
[31m-    public partial class BarcodeScannerUI[m
[31m-    {[m
[31m-        /// <summary>[m
[31m-        /// The result of scan operation.[m
[31m-        /// </summary>[m
[31m-        private BarcodeScannerTask.ScanResult result;[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// The barcode reader object[m
[31m-        /// </summary>[m
[31m-        private BarcodeReader reader;[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Device camera object[m
[31m-        /// </summary>[m
[31m-        private PhotoCamera camera;[m
[31m-[m
[31m-        private DispatcherTimer timer;[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Initializes a new instance of the <see cref="BarcodeScannerUI"/> class.[m
[31m-        /// This implementation not use camera autofocus.[m
[31m-        /// </summary>[m
[31m-        public BarcodeScannerUI()[m
[31m-        {[m
[31m-            this.InitializeComponent();[m
[31m-[m
[31m-            // Instantiate objects and start camera preview[m
[31m-            this.camera = new PhotoCamera();[m
[31m-            this.reader = new BarcodeReader {Options = {TryHarder = true}};[m
[31m-            this.CameraBrush.SetSource(this.camera);[m
[31m-[m
[31m-            // Bind events[m
[31m-            this.camera.Initialized += this.CameraInitialized;[m
[31m-            this.reader.ResultFound += this.ReaderResultFound;[m
[31m-[m
[31m-            this.timer = new DispatcherTimer {Interval = TimeSpan.FromMilliseconds(100)};[m
[31m-            this.timer.Tick += (sender, args) => ScanForBarcode();[m
[31m-[m
[31m-            this.BackKeyPress += CancelScan;[m
[31m-[m
[31m-            CameraButtons.ShutterKeyHalfPressed += StartCameraFocus;[m
[31m-            camera.AutoFocusCompleted += StartCameraFocus;[m
[31m-[m
[31m-        }[m
[31m-[m
[31m-        private void StartCameraFocus(object sender, EventArgs eventArgs)[m
[31m-        {[m
[31m-            camera.Focus();[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Occurs when barcode scan is [completed].[m
[31m-        /// </summary>[m
[31m-        public event EventHandler<BarcodeScannerTask.ScanResult> Completed;[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Called when a page is no longer the active page in a frame.[m
[31m-        /// </summary>[m
[31m-        /// <param name="e">An object that contains the event data.</param>[m
[31m-        protected override void OnNavigatedFrom(NavigationEventArgs e)[m
[31m-        {[m
[31m-            // If result is null, user is cancelled scan operation[m
[31m-            this.result = this.result ?? new BarcodeScannerTask.ScanResult(TaskResult.Cancel);[m
[31m-            this.Completed(this, this.result);[m
[31m-            this.CleanUp();[m
[31m-            base.OnNavigatedFrom(e);[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Called when device camera initialized.[m
[31m-        /// </summary>[m
[31m-        /// <param name="sender">The sender.</param>[m
[31m-        /// <param name="e">The <see cref="CameraOperationCompletedEventArgs"/> instance containing the event data.</param>[m
[31m-        private void CameraInitialized(object sender, CameraOperationCompletedEventArgs e)[m
[31m-        {[m
[31m-            if (e.Succeeded)[m
[31m-            {[m
[31m-                if (camera.IsFocusSupported)[m
[31m-                {[m
[31m-                    camera.Focus();[m
[31m-                }[m
[31m-[m
[31m-                // Start scan process in separate thread[m
[31m-                this.Dispatcher.BeginInvoke(() => timer.Start());[m
[31m-            }[m
[31m-            else[m
[31m-            {[m
[31m-                this.result = new BarcodeScannerTask.ScanResult(TaskResult.None);[m
[31m-                NavigationService.GoBack();[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        private void ScanForBarcode()[m
[31m-        {[m
[31m-            var cameraBuffer = new WriteableBitmap([m
[31m-                                (int)camera.PreviewResolution.Width,[m
[31m-                                (int)camera.PreviewResolution.Height);[m
[31m-[m
[31m-            camera.GetPreviewBufferArgb32(cameraBuffer.Pixels);[m
[31m-            cameraBuffer.Invalidate();[m
[31m-[m
[31m-            reader.Decode(cameraBuffer);[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Called when reader find barcode.[m
[31m-        /// </summary>[m
[31m-        /// <param name="obj">Scan result object.</param>[m
[31m-        private void ReaderResultFound(Result obj)[m
[31m-        {[m
[31m-            VibrateController.Default.Start(TimeSpan.FromMilliseconds(100));[m
[31m-            this.result = new BarcodeScannerTask.ScanResult(TaskResult.OK) { Barcode = obj };[m
[31m-            NavigationService.GoBack();[m
[31m-        }[m
[31m-[m
[31m-        /// <summary>[m
[31m-        /// Cleans up resources and removes unnecessary callbacks.[m
[31m-        /// </summary>[m
[31m-        private void CleanUp()[m
[31m-        {[m
[31m-            CameraButtons.ShutterKeyHalfPressed -= StartCameraFocus;[m
[31m-            if (this.camera != null)[m
[31m-            {[m
[31m-                this.camera.AutoFocusCompleted -= StartCameraFocus;[m
[31m-                this.camera.Initialized -= this.CameraInitialized;[m
[31m-                this.camera.Dispose();[m
[31m-                this.camera = null;[m
[31m-            }[m
[31m-[m
[31m-            if (this.reader != null)[m
[31m-            {[m
[31m-                this.reader.ResultFound -= this.ReaderResultFound;[m
[31m-                this.reader = null;[m
[31m-            }[m
[31m-[m
[31m-            if (this.timer != null)[m
[31m-            {[m
[31m-                this.timer.Stop();[m
[31m-                this.timer = null;[m
[31m-            }[m
[31m-        }[m
[31m-[m
[31m-        private void ApplicationBarIconButton_Click(object sender, EventArgs e)[m
[31m-        {[m
[31m-            NavigationService.GoBack();[m
[31m-        }[m
[31m-[m
[31m-        private void CancelScan(object sender, EventArgs eventArgs)[m
[31m-        {[m
[31m-            NavigationService.GoBack();[m
[31m-        }[m
[31m-    }[m
[31m-}[m
\ No newline at end of file[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/assets/cancel.png b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/assets/cancel.png[m
[1mdeleted file mode 100755[m
[1mindex 1d7f70b..0000000[m
Binary files a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/assets/cancel.png and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/lib/zxing.wp8.0.dll b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/lib/zxing.wp8.0.dll[m
[1mdeleted file mode 100755[m
[1mindex c6f294a..0000000[m
Binary files a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/src/wp8/lib/zxing.wp8.0.dll and /dev/null differ
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/tests/plugin.xml b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/tests/plugin.xml[m
[1mdeleted file mode 100755[m
[1mindex 5f712ad..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/tests/plugin.xml[m
[1m+++ /dev/null[m
[36m@@ -1,31 +0,0 @@[m
[31m-<?xml version="1.0" encoding="UTF-8"?>[m
[31m-<!--[m
[31m-  Licensed to the Apache Software Foundation (ASF) under one[m
[31m-  or more contributor license agreements.  See the NOTICE file[m
[31m-  distributed with this work for additional information[m
[31m-  regarding copyright ownership.  The ASF licenses this file[m
[31m-  to you under the Apache License, Version 2.0 (the[m
[31m-  "License"); you may not use this file except in compliance[m
[31m-  with the License.  You may obtain a copy of the License at[m
[31m-[m
[31m-    http://www.apache.org/licenses/LICENSE-2.0[m
[31m-[m
[31m-  Unless required by applicable law or agreed to in writing,[m
[31m-  software distributed under the License is distributed on an[m
[31m-  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m-  KIND, either express or implied.  See the License for the[m
[31m-  specific language governing permissions and limitations[m
[31m-  under the License.[m
[31m--->[m
[31m-[m
[31m-<plugin xmlns="http://apache.org/cordova/ns/plugins/1.0"[m
[31m-    xmlns:rim="http://www.blackberry.com/ns/widgets"[m
[31m-    xmlns:android="http://schemas.android.com/apk/res/android"[m
[31m-    id="phonegap-plugin-barcodescanner-tests"[m
[31m-    version="3.1.0">[m
[31m-    <name>PhoneGap BarcodeScanner Plugin Tests</name>[m
[31m-    <license>Apache 2.0</license>[m
[31m-[m
[31m-    <js-module src="tests.js" name="tests">[m
[31m-    </js-module>[m
[31m-</plugin>[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/tests/tests.js b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/tests/tests.js[m
[1mdeleted file mode 100755[m
[1mindex 746dae3..0000000[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/tests/tests.js[m
[1m+++ /dev/null[m
[36m@@ -1,57 +0,0 @@[m
[31m-/*[m
[31m- *[m
[31m- * Licensed to the Apache Software Foundation (ASF) under one[m
[31m- * or more contributor license agreements.  See the NOTICE file[m
[31m- * distributed with this work for additional information[m
[31m- * regarding copyright ownership.  The ASF licenses this file[m
[31m- * to you under the Apache License, Version 2.0 (the[m
[31m- * "License"); you may not use this file except in compliance[m
[31m- * with the License.  You may obtain a copy of the License at[m
[31m- *[m
[31m- *   http://www.apache.org/licenses/LICENSE-2.0[m
[31m- *[m
[31m- * Unless required by applicable law or agreed to in writing,[m
[31m- * software distributed under the License is distributed on an[m
[31m- * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY[m
[31m- * KIND, either express or implied.  See the License for the[m
[31m- * specific language governing permissions and limitations[m
[31m- * under the License.[m
[31m- *[m
[31m-*/[m
[31m-exports.defineAutoTests = function() {[m
[31m-    var scanner;[m
[31m-    describe('cordova.require object should exist', function () {[m
[31m-        it("should exist", function() {[m
[31m-            expect(window.cordova).toBeDefined();[m
[31m-            expect(typeof cordova.require == 'function').toBe(true);[m
[31m-        });[m
[31m-[m
[31m-        it("BarcodeScanner plugin should exist", function() {[m
[31m-            scanner = cordova.plugins.barcodeScanner; [m
[31m-            expect(scanner).toBeDefined();[m
[31m-            expect(typeof scanner == 'object').toBe(true);[m
[31m-        });[m
[31m-[m
[31m-        it("should contain a scan function", function() {[m
[31m-            expect(scanner.scan).toBeDefined();[m
[31m-            expect(typeof scanner.scan == 'function').toBe(true);[m
[31m-        });[m
[31m-[m
[31m-        it("should contain an encode function", function() {[m
[31m-            expect(scanner.encode).toBeDefined();[m
[31m-            expect(typeof scanner.encode == 'function').toBe(true);[m
[31m-        });[m
[31m-[m
[31m-        it("should contain three DestinationType constants", function() {[m
[31m-            expect(scanner.Encode.TEXT_TYPE).toBe("TEXT_TYPE");[m
[31m-            expect(scanner.Encode.EMAIL_TYPE).toBe("EMAIL_TYPE");[m
[31m-            expect(scanner.Encode.PHONE_TYPE).toBe("PHONE_TYPE");[m
[31m-            expect(scanner.Encode.SMS_TYPE).toBe("SMS_TYPE");[m
[31m-        });[m
[31m-        /*[m
[31m-        it("should call scan successfully", function() {[m
[31m-            scanner.scan(function() {}, function() {});[m
[31m-        });[m
[31m-        */[m
[31m-    });[m
[31m-}[m
[1mdiff --git a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/www/barcodescanner.js b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/www/barcodescanner.js[m
[1mold mode 100755[m
[1mnew mode 100644[m
[1mindex d4e0415..f9bba2b[m
[1m--- a/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/www/barcodescanner.js[m
[1m+++ b/cordova_exchange_dist/plugins/phonegap-plugin-barcodescanner/www/barcodescanner.js[m
[36m@@ -1,13 +1,16 @@[m
 /**[m
[31m- * cordova is available under *either* the terms of the modified BSD license *or* the[m
[31m- * MIT License (2008). See http://opensource.org/licenses/alphabetical for full text.[m
[32m+[m[32m * cordova is available under the MIT License (2008).[m
[32m+[m[32m * See http://opensource.org/licenses/alphabetical for full text.[m
  *[m
  * Copyright (c) Matt Kane 2010[m
  * Copyright (c) 2011, IBM Corporation[m
[32m+[m[32m * Copyright (c) 2012-2017, Adobe Systems[m
  */[m
 [m
 [m
[31m-        var exec = require("cordova/exec");[m
[32m+[m[32m        var exec = cordova.require("cordova/exec");[m
[32m+[m
[32m+[m[32m        var scanInProgress = false;[m
 [m
         /**[m
          * Constructor.[m
[36m@@ -76,6 +79,10 @@[m [mBarcodeScanner.prototype.scan = function (successCallback, errorCallback, config[m
                 // do nothing[m
             } else {[m
                 if (typeof(config) === 'object') {[m
[32m+[m[32m                    // string spaces between formats, ZXing does not like that[m
[32m+[m[32m                    if (config.formats) {[m
[32m+[m[32m                        config.formats = config.formats.replace(/\s+/g, '');[m
[32m+[m[32m                    }[m
                     config = [ config ];[m
                 } else {[m
                     config = [];[m
[36m@@ -97,7 +104,30 @@[m [mBarcodeScanner.prototype.scan = function (successCallback, errorCallback, config[m
                 return;[m
             }[m
 [m
[31m-    exec(successCallback, errorCallback, 'BarcodeScanner', 'scan', config);[m
[32m+[m[32m            if (scanInProgress) {[m
[32m+[m[32m                errorCallback('Scan is already in progress');[m
[32m+[m[32m                return;[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            scanInProgress = true;[m
[32m+[m
[32m+[m[32m            exec([m
[32m+[m[32m                function(result) {[m
[32m+[m[32m                    scanInProgress = false;[m
[32m+[m[32m                    // work around bug in ZXing library[m
[32m+[m[32m                    if (result.format === 'UPC_A' && result.text.length === 13) {[m
[32m+[m[32m                        result.text = result.text.substring(1);[m
[32m+[m[32m                    }[m
[32m+[m[32m                    successCallback(result);[m
[32m+[m[32m                },[m
[32m+[m[32m                function(error) {[m
[32m+[m[32m                    scanInProgress = false;[m
[32m+[m[32m                    errorCallback(error);[m
[32m+[m[32m                },[m
[32m+[m[32m                'BarcodeScanner',[m
[32m+[m[32m                'scan',[m
[32m+[m[32m                config[m
[32m+[m[32m            );[m
         };[m
 [m
         //-------------------------------------------------------------------[m
